(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function i(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=i(r);fetch(r.href,s)}})();var KE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Uw(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Une(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if(typeof t=="function"){var i=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};i.prototype=t.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(i,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}),i}var ZP={exports:{}},r_={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var KV;function Nne(){if(KV)return r_;KV=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function i(n,r,s){var a=null;if(s!==void 0&&(a=""+s),r.key!==void 0&&(a=""+r.key),"key"in r){s={};for(var o in r)o!=="key"&&(s[o]=r[o])}else s=r;return r=s.ref,{$$typeof:e,type:n,key:a,ref:r!==void 0?r:null,props:s}}return r_.Fragment=t,r_.jsx=i,r_.jsxs=i,r_}var JV;function zne(){return JV||(JV=1,ZP.exports=Nne()),ZP.exports}var ke=zne(),$P={exports:{}},tn={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ZV;function Fne(){if(ZV)return tn;ZV=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),a=Symbol.for("react.context"),o=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),c=Symbol.for("react.memo"),u=Symbol.for("react.lazy"),h=Symbol.iterator;function d(Y){return Y===null||typeof Y!="object"?null:(Y=h&&Y[h]||Y["@@iterator"],typeof Y=="function"?Y:null)}var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,x={};function y(Y,$,se){this.props=Y,this.context=$,this.refs=x,this.updater=se||p}y.prototype.isReactComponent={},y.prototype.setState=function(Y,$){if(typeof Y!="object"&&typeof Y!="function"&&Y!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Y,$,"setState")},y.prototype.forceUpdate=function(Y){this.updater.enqueueForceUpdate(this,Y,"forceUpdate")};function b(){}b.prototype=y.prototype;function A(Y,$,se){this.props=Y,this.context=$,this.refs=x,this.updater=se||p}var w=A.prototype=new b;w.constructor=A,g(w,y.prototype),w.isPureReactComponent=!0;var E=Array.isArray,D={H:null,A:null,T:null,S:null,V:null},T=Object.prototype.hasOwnProperty;function I(Y,$,se,fe,te,de){return se=de.ref,{$$typeof:e,type:Y,key:$,ref:se!==void 0?se:null,props:de}}function R(Y,$){return I(Y.type,$,void 0,void 0,void 0,Y.props)}function O(Y){return typeof Y=="object"&&Y!==null&&Y.$$typeof===e}function P(Y){var $={"=":"=0",":":"=2"};return"$"+Y.replace(/[=:]/g,function(se){return $[se]})}var U=/\/+/g;function H(Y,$){return typeof Y=="object"&&Y!==null&&Y.key!=null?P(""+Y.key):$.toString(36)}function V(){}function j(Y){switch(Y.status){case"fulfilled":return Y.value;case"rejected":throw Y.reason;default:switch(typeof Y.status=="string"?Y.then(V,V):(Y.status="pending",Y.then(function($){Y.status==="pending"&&(Y.status="fulfilled",Y.value=$)},function($){Y.status==="pending"&&(Y.status="rejected",Y.reason=$)})),Y.status){case"fulfilled":return Y.value;case"rejected":throw Y.reason}}throw Y}function J(Y,$,se,fe,te){var de=typeof Y;(de==="undefined"||de==="boolean")&&(Y=null);var le=!1;if(Y===null)le=!0;else switch(de){case"bigint":case"string":case"number":le=!0;break;case"object":switch(Y.$$typeof){case e:case t:le=!0;break;case u:return le=Y._init,J(le(Y._payload),$,se,fe,te)}}if(le)return te=te(Y),le=fe===""?"."+H(Y,0):fe,E(te)?(se="",le!=null&&(se=le.replace(U,"$&/")+"/"),J(te,$,se,"",function(we){return we})):te!=null&&(O(te)&&(te=R(te,se+(te.key==null||Y&&Y.key===te.key?"":(""+te.key).replace(U,"$&/")+"/")+le)),$.push(te)),1;le=0;var _e=fe===""?".":fe+":";if(E(Y))for(var be=0;be<Y.length;be++)fe=Y[be],de=_e+H(fe,be),le+=J(fe,$,se,de,te);else if(be=d(Y),typeof be=="function")for(Y=be.call(Y),be=0;!(fe=Y.next()).done;)fe=fe.value,de=_e+H(fe,be++),le+=J(fe,$,se,de,te);else if(de==="object"){if(typeof Y.then=="function")return J(j(Y),$,se,fe,te);throw $=String(Y),Error("Objects are not valid as a React child (found: "+($==="[object Object]"?"object with keys {"+Object.keys(Y).join(", ")+"}":$)+"). If you meant to render a collection of children, use an array instead.")}return le}function F(Y,$,se){if(Y==null)return Y;var fe=[],te=0;return J(Y,fe,"","",function(de){return $.call(se,de,te++)}),fe}function X(Y){if(Y._status===-1){var $=Y._result;$=$(),$.then(function(se){(Y._status===0||Y._status===-1)&&(Y._status=1,Y._result=se)},function(se){(Y._status===0||Y._status===-1)&&(Y._status=2,Y._result=se)}),Y._status===-1&&(Y._status=0,Y._result=$)}if(Y._status===1)return Y._result.default;throw Y._result}var W=typeof reportError=="function"?reportError:function(Y){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var $=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof Y=="object"&&Y!==null&&typeof Y.message=="string"?String(Y.message):String(Y),error:Y});if(!window.dispatchEvent($))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",Y);return}console.error(Y)};function ne(){}return tn.Children={map:F,forEach:function(Y,$,se){F(Y,function(){$.apply(this,arguments)},se)},count:function(Y){var $=0;return F(Y,function(){$++}),$},toArray:function(Y){return F(Y,function($){return $})||[]},only:function(Y){if(!O(Y))throw Error("React.Children.only expected to receive a single React element child.");return Y}},tn.Component=y,tn.Fragment=i,tn.Profiler=r,tn.PureComponent=A,tn.StrictMode=n,tn.Suspense=l,tn.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=D,tn.__COMPILER_RUNTIME={__proto__:null,c:function(Y){return D.H.useMemoCache(Y)}},tn.cache=function(Y){return function(){return Y.apply(null,arguments)}},tn.cloneElement=function(Y,$,se){if(Y==null)throw Error("The argument must be a React element, but you passed "+Y+".");var fe=g({},Y.props),te=Y.key,de=void 0;if($!=null)for(le in $.ref!==void 0&&(de=void 0),$.key!==void 0&&(te=""+$.key),$)!T.call($,le)||le==="key"||le==="__self"||le==="__source"||le==="ref"&&$.ref===void 0||(fe[le]=$[le]);var le=arguments.length-2;if(le===1)fe.children=se;else if(1<le){for(var _e=Array(le),be=0;be<le;be++)_e[be]=arguments[be+2];fe.children=_e}return I(Y.type,te,void 0,void 0,de,fe)},tn.createContext=function(Y){return Y={$$typeof:a,_currentValue:Y,_currentValue2:Y,_threadCount:0,Provider:null,Consumer:null},Y.Provider=Y,Y.Consumer={$$typeof:s,_context:Y},Y},tn.createElement=function(Y,$,se){var fe,te={},de=null;if($!=null)for(fe in $.key!==void 0&&(de=""+$.key),$)T.call($,fe)&&fe!=="key"&&fe!=="__self"&&fe!=="__source"&&(te[fe]=$[fe]);var le=arguments.length-2;if(le===1)te.children=se;else if(1<le){for(var _e=Array(le),be=0;be<le;be++)_e[be]=arguments[be+2];te.children=_e}if(Y&&Y.defaultProps)for(fe in le=Y.defaultProps,le)te[fe]===void 0&&(te[fe]=le[fe]);return I(Y,de,void 0,void 0,null,te)},tn.createRef=function(){return{current:null}},tn.forwardRef=function(Y){return{$$typeof:o,render:Y}},tn.isValidElement=O,tn.lazy=function(Y){return{$$typeof:u,_payload:{_status:-1,_result:Y},_init:X}},tn.memo=function(Y,$){return{$$typeof:c,type:Y,compare:$===void 0?null:$}},tn.startTransition=function(Y){var $=D.T,se={};D.T=se;try{var fe=Y(),te=D.S;te!==null&&te(se,fe),typeof fe=="object"&&fe!==null&&typeof fe.then=="function"&&fe.then(ne,W)}catch(de){W(de)}finally{D.T=$}},tn.unstable_useCacheRefresh=function(){return D.H.useCacheRefresh()},tn.use=function(Y){return D.H.use(Y)},tn.useActionState=function(Y,$,se){return D.H.useActionState(Y,$,se)},tn.useCallback=function(Y,$){return D.H.useCallback(Y,$)},tn.useContext=function(Y){return D.H.useContext(Y)},tn.useDebugValue=function(){},tn.useDeferredValue=function(Y,$){return D.H.useDeferredValue(Y,$)},tn.useEffect=function(Y,$,se){var fe=D.H;if(typeof se=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return fe.useEffect(Y,$)},tn.useId=function(){return D.H.useId()},tn.useImperativeHandle=function(Y,$,se){return D.H.useImperativeHandle(Y,$,se)},tn.useInsertionEffect=function(Y,$){return D.H.useInsertionEffect(Y,$)},tn.useLayoutEffect=function(Y,$){return D.H.useLayoutEffect(Y,$)},tn.useMemo=function(Y,$){return D.H.useMemo(Y,$)},tn.useOptimistic=function(Y,$){return D.H.useOptimistic(Y,$)},tn.useReducer=function(Y,$,se){return D.H.useReducer(Y,$,se)},tn.useRef=function(Y){return D.H.useRef(Y)},tn.useState=function(Y){return D.H.useState(Y)},tn.useSyncExternalStore=function(Y,$,se){return D.H.useSyncExternalStore(Y,$,se)},tn.useTransition=function(){return D.H.useTransition()},tn.version="19.1.0",tn}var $V;function og(){return $V||($V=1,$P.exports=Fne()),$P.exports}var ge=og();const JC=Uw(ge);var eO={exports:{}},s_={},tO={exports:{}},iO={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var eH;function Vne(){return eH||(eH=1,function(e){function t(F,X){var W=F.length;F.push(X);e:for(;0<W;){var ne=W-1>>>1,Y=F[ne];if(0<r(Y,X))F[ne]=X,F[W]=Y,W=ne;else break e}}function i(F){return F.length===0?null:F[0]}function n(F){if(F.length===0)return null;var X=F[0],W=F.pop();if(W!==X){F[0]=W;e:for(var ne=0,Y=F.length,$=Y>>>1;ne<$;){var se=2*(ne+1)-1,fe=F[se],te=se+1,de=F[te];if(0>r(fe,W))te<Y&&0>r(de,fe)?(F[ne]=de,F[te]=W,ne=te):(F[ne]=fe,F[se]=W,ne=se);else if(te<Y&&0>r(de,W))F[ne]=de,F[te]=W,ne=te;else break e}}return X}function r(F,X){var W=F.sortIndex-X.sortIndex;return W!==0?W:F.id-X.id}if(e.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;e.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();e.unstable_now=function(){return a.now()-o}}var l=[],c=[],u=1,h=null,d=3,p=!1,g=!1,x=!1,y=!1,b=typeof setTimeout=="function"?setTimeout:null,A=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;function E(F){for(var X=i(c);X!==null;){if(X.callback===null)n(c);else if(X.startTime<=F)n(c),X.sortIndex=X.expirationTime,t(l,X);else break;X=i(c)}}function D(F){if(x=!1,E(F),!g)if(i(l)!==null)g=!0,T||(T=!0,H());else{var X=i(c);X!==null&&J(D,X.startTime-F)}}var T=!1,I=-1,R=5,O=-1;function P(){return y?!0:!(e.unstable_now()-O<R)}function U(){if(y=!1,T){var F=e.unstable_now();O=F;var X=!0;try{e:{g=!1,x&&(x=!1,A(I),I=-1),p=!0;var W=d;try{t:{for(E(F),h=i(l);h!==null&&!(h.expirationTime>F&&P());){var ne=h.callback;if(typeof ne=="function"){h.callback=null,d=h.priorityLevel;var Y=ne(h.expirationTime<=F);if(F=e.unstable_now(),typeof Y=="function"){h.callback=Y,E(F),X=!0;break t}h===i(l)&&n(l),E(F)}else n(l);h=i(l)}if(h!==null)X=!0;else{var $=i(c);$!==null&&J(D,$.startTime-F),X=!1}}break e}finally{h=null,d=W,p=!1}X=void 0}}finally{X?H():T=!1}}}var H;if(typeof w=="function")H=function(){w(U)};else if(typeof MessageChannel<"u"){var V=new MessageChannel,j=V.port2;V.port1.onmessage=U,H=function(){j.postMessage(null)}}else H=function(){b(U,0)};function J(F,X){I=b(function(){F(e.unstable_now())},X)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(F){F.callback=null},e.unstable_forceFrameRate=function(F){0>F||125<F?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<F?Math.floor(1e3/F):5},e.unstable_getCurrentPriorityLevel=function(){return d},e.unstable_next=function(F){switch(d){case 1:case 2:case 3:var X=3;break;default:X=d}var W=d;d=X;try{return F()}finally{d=W}},e.unstable_requestPaint=function(){y=!0},e.unstable_runWithPriority=function(F,X){switch(F){case 1:case 2:case 3:case 4:case 5:break;default:F=3}var W=d;d=F;try{return X()}finally{d=W}},e.unstable_scheduleCallback=function(F,X,W){var ne=e.unstable_now();switch(typeof W=="object"&&W!==null?(W=W.delay,W=typeof W=="number"&&0<W?ne+W:ne):W=ne,F){case 1:var Y=-1;break;case 2:Y=250;break;case 5:Y=1073741823;break;case 4:Y=1e4;break;default:Y=5e3}return Y=W+Y,F={id:u++,callback:X,priorityLevel:F,startTime:W,expirationTime:Y,sortIndex:-1},W>ne?(F.sortIndex=W,t(c,F),i(l)===null&&F===i(c)&&(x?(A(I),I=-1):x=!0,J(D,W-ne))):(F.sortIndex=Y,t(l,F),g||p||(g=!0,T||(T=!0,H()))),F},e.unstable_shouldYield=P,e.unstable_wrapCallback=function(F){var X=d;return function(){var W=d;d=X;try{return F.apply(this,arguments)}finally{d=W}}}}(iO)),iO}var tH;function Hne(){return tH||(tH=1,tO.exports=Vne()),tO.exports}var nO={exports:{}},so={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var iH;function Gne(){if(iH)return so;iH=1;var e=og();function t(l){var c="https://react.dev/errors/"+l;if(1<arguments.length){c+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)c+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+l+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(){}var n={d:{f:i,r:function(){throw Error(t(522))},D:i,C:i,L:i,m:i,X:i,S:i,M:i},p:0,findDOMNode:null},r=Symbol.for("react.portal");function s(l,c,u){var h=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:h==null?null:""+h,children:l,containerInfo:c,implementation:u}}var a=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function o(l,c){if(l==="font")return"";if(typeof c=="string")return c==="use-credentials"?c:""}return so.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,so.createPortal=function(l,c){var u=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!c||c.nodeType!==1&&c.nodeType!==9&&c.nodeType!==11)throw Error(t(299));return s(l,c,null,u)},so.flushSync=function(l){var c=a.T,u=n.p;try{if(a.T=null,n.p=2,l)return l()}finally{a.T=c,n.p=u,n.d.f()}},so.preconnect=function(l,c){typeof l=="string"&&(c?(c=c.crossOrigin,c=typeof c=="string"?c==="use-credentials"?c:"":void 0):c=null,n.d.C(l,c))},so.prefetchDNS=function(l){typeof l=="string"&&n.d.D(l)},so.preinit=function(l,c){if(typeof l=="string"&&c&&typeof c.as=="string"){var u=c.as,h=o(u,c.crossOrigin),d=typeof c.integrity=="string"?c.integrity:void 0,p=typeof c.fetchPriority=="string"?c.fetchPriority:void 0;u==="style"?n.d.S(l,typeof c.precedence=="string"?c.precedence:void 0,{crossOrigin:h,integrity:d,fetchPriority:p}):u==="script"&&n.d.X(l,{crossOrigin:h,integrity:d,fetchPriority:p,nonce:typeof c.nonce=="string"?c.nonce:void 0})}},so.preinitModule=function(l,c){if(typeof l=="string")if(typeof c=="object"&&c!==null){if(c.as==null||c.as==="script"){var u=o(c.as,c.crossOrigin);n.d.M(l,{crossOrigin:u,integrity:typeof c.integrity=="string"?c.integrity:void 0,nonce:typeof c.nonce=="string"?c.nonce:void 0})}}else c==null&&n.d.M(l)},so.preload=function(l,c){if(typeof l=="string"&&typeof c=="object"&&c!==null&&typeof c.as=="string"){var u=c.as,h=o(u,c.crossOrigin);n.d.L(l,u,{crossOrigin:h,integrity:typeof c.integrity=="string"?c.integrity:void 0,nonce:typeof c.nonce=="string"?c.nonce:void 0,type:typeof c.type=="string"?c.type:void 0,fetchPriority:typeof c.fetchPriority=="string"?c.fetchPriority:void 0,referrerPolicy:typeof c.referrerPolicy=="string"?c.referrerPolicy:void 0,imageSrcSet:typeof c.imageSrcSet=="string"?c.imageSrcSet:void 0,imageSizes:typeof c.imageSizes=="string"?c.imageSizes:void 0,media:typeof c.media=="string"?c.media:void 0})}},so.preloadModule=function(l,c){if(typeof l=="string")if(c){var u=o(c.as,c.crossOrigin);n.d.m(l,{as:typeof c.as=="string"&&c.as!=="script"?c.as:void 0,crossOrigin:u,integrity:typeof c.integrity=="string"?c.integrity:void 0})}else n.d.m(l)},so.requestFormReset=function(l){n.d.r(l)},so.unstable_batchedUpdates=function(l,c){return l(c)},so.useFormState=function(l,c,u){return a.H.useFormState(l,c,u)},so.useFormStatus=function(){return a.H.useHostTransitionStatus()},so.version="19.1.0",so}var nH;function kne(){if(nH)return nO.exports;nH=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),nO.exports=Gne(),nO.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rH;function jne(){if(rH)return s_;rH=1;var e=Hne(),t=og(),i=kne();function n(f){var m="https://react.dev/errors/"+f;if(1<arguments.length){m+="?args[]="+encodeURIComponent(arguments[1]);for(var _=2;_<arguments.length;_++)m+="&args[]="+encodeURIComponent(arguments[_])}return"Minified React error #"+f+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)}function s(f){var m=f,_=f;if(f.alternate)for(;m.return;)m=m.return;else{f=m;do m=f,(m.flags&4098)!==0&&(_=m.return),f=m.return;while(f)}return m.tag===3?_:null}function a(f){if(f.tag===13){var m=f.memoizedState;if(m===null&&(f=f.alternate,f!==null&&(m=f.memoizedState)),m!==null)return m.dehydrated}return null}function o(f){if(s(f)!==f)throw Error(n(188))}function l(f){var m=f.alternate;if(!m){if(m=s(f),m===null)throw Error(n(188));return m!==f?null:f}for(var _=f,M=m;;){var B=_.return;if(B===null)break;var N=B.alternate;if(N===null){if(M=B.return,M!==null){_=M;continue}break}if(B.child===N.child){for(N=B.child;N;){if(N===_)return o(B),f;if(N===M)return o(B),m;N=N.sibling}throw Error(n(188))}if(_.return!==M.return)_=B,M=N;else{for(var ee=!1,ce=B.child;ce;){if(ce===_){ee=!0,_=B,M=N;break}if(ce===M){ee=!0,M=B,_=N;break}ce=ce.sibling}if(!ee){for(ce=N.child;ce;){if(ce===_){ee=!0,_=N,M=B;break}if(ce===M){ee=!0,M=N,_=B;break}ce=ce.sibling}if(!ee)throw Error(n(189))}}if(_.alternate!==M)throw Error(n(190))}if(_.tag!==3)throw Error(n(188));return _.stateNode.current===_?f:m}function c(f){var m=f.tag;if(m===5||m===26||m===27||m===6)return f;for(f=f.child;f!==null;){if(m=c(f),m!==null)return m;f=f.sibling}return null}var u=Object.assign,h=Symbol.for("react.element"),d=Symbol.for("react.transitional.element"),p=Symbol.for("react.portal"),g=Symbol.for("react.fragment"),x=Symbol.for("react.strict_mode"),y=Symbol.for("react.profiler"),b=Symbol.for("react.provider"),A=Symbol.for("react.consumer"),w=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),D=Symbol.for("react.suspense"),T=Symbol.for("react.suspense_list"),I=Symbol.for("react.memo"),R=Symbol.for("react.lazy"),O=Symbol.for("react.activity"),P=Symbol.for("react.memo_cache_sentinel"),U=Symbol.iterator;function H(f){return f===null||typeof f!="object"?null:(f=U&&f[U]||f["@@iterator"],typeof f=="function"?f:null)}var V=Symbol.for("react.client.reference");function j(f){if(f==null)return null;if(typeof f=="function")return f.$$typeof===V?null:f.displayName||f.name||null;if(typeof f=="string")return f;switch(f){case g:return"Fragment";case y:return"Profiler";case x:return"StrictMode";case D:return"Suspense";case T:return"SuspenseList";case O:return"Activity"}if(typeof f=="object")switch(f.$$typeof){case p:return"Portal";case w:return(f.displayName||"Context")+".Provider";case A:return(f._context.displayName||"Context")+".Consumer";case E:var m=f.render;return f=f.displayName,f||(f=m.displayName||m.name||"",f=f!==""?"ForwardRef("+f+")":"ForwardRef"),f;case I:return m=f.displayName||null,m!==null?m:j(f.type)||"Memo";case R:m=f._payload,f=f._init;try{return j(f(m))}catch{}}return null}var J=Array.isArray,F=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,X=i.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,W={pending:!1,data:null,method:null,action:null},ne=[],Y=-1;function $(f){return{current:f}}function se(f){0>Y||(f.current=ne[Y],ne[Y]=null,Y--)}function fe(f,m){Y++,ne[Y]=f.current,f.current=m}var te=$(null),de=$(null),le=$(null),_e=$(null);function be(f,m){switch(fe(le,m),fe(de,f),fe(te,null),m.nodeType){case 9:case 11:f=(f=m.documentElement)&&(f=f.namespaceURI)?wV(f):0;break;default:if(f=m.tagName,m=m.namespaceURI)m=wV(m),f=MV(m,f);else switch(f){case"svg":f=1;break;case"math":f=2;break;default:f=0}}se(te),fe(te,f)}function we(){se(te),se(de),se(le)}function Me(f){f.memoizedState!==null&&fe(_e,f);var m=te.current,_=MV(m,f.type);m!==_&&(fe(de,f),fe(te,_))}function Ne(f){de.current===f&&(se(te),se(de)),_e.current===f&&(se(_e),$S._currentValue=W)}var Ge=Object.prototype.hasOwnProperty,We=e.unstable_scheduleCallback,ae=e.unstable_cancelCallback,He=e.unstable_shouldYield,Ke=e.unstable_requestPaint,je=e.unstable_now,Oe=e.unstable_getCurrentPriorityLevel,Qe=e.unstable_ImmediatePriority,$e=e.unstable_UserBlockingPriority,gt=e.unstable_NormalPriority,pe=e.unstable_LowPriority,k=e.unstable_IdlePriority,Q=e.log,xe=e.unstable_setDisableYieldValue,K=null,Re=null;function Le(f){if(typeof Q=="function"&&xe(f),Re&&typeof Re.setStrictMode=="function")try{Re.setStrictMode(K,f)}catch{}}var st=Math.clz32?Math.clz32:vt,Be=Math.log,bt=Math.LN2;function vt(f){return f>>>=0,f===0?32:31-(Be(f)/bt|0)|0}var Xe=256,xt=4194304;function _t(f){var m=f&42;if(m!==0)return m;switch(f&-f){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return f&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return f}}function ye(f,m,_){var M=f.pendingLanes;if(M===0)return 0;var B=0,N=f.suspendedLanes,ee=f.pingedLanes;f=f.warmLanes;var ce=M&134217727;return ce!==0?(M=ce&~N,M!==0?B=_t(M):(ee&=ce,ee!==0?B=_t(ee):_||(_=ce&~f,_!==0&&(B=_t(_))))):(ce=M&~N,ce!==0?B=_t(ce):ee!==0?B=_t(ee):_||(_=M&~f,_!==0&&(B=_t(_)))),B===0?0:m!==0&&m!==B&&(m&N)===0&&(N=B&-B,_=m&-m,N>=_||N===32&&(_&4194048)!==0)?m:B}function Ve(f,m){return(f.pendingLanes&~(f.suspendedLanes&~f.pingedLanes)&m)===0}function At(f,m){switch(f){case 1:case 2:case 4:case 8:case 64:return m+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return m+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ie(){var f=Xe;return Xe<<=1,(Xe&4194048)===0&&(Xe=256),f}function Ce(){var f=xt;return xt<<=1,(xt&62914560)===0&&(xt=4194304),f}function De(f){for(var m=[],_=0;31>_;_++)m.push(f);return m}function at(f,m){f.pendingLanes|=m,m!==268435456&&(f.suspendedLanes=0,f.pingedLanes=0,f.warmLanes=0)}function ut(f,m,_,M,B,N){var ee=f.pendingLanes;f.pendingLanes=_,f.suspendedLanes=0,f.pingedLanes=0,f.warmLanes=0,f.expiredLanes&=_,f.entangledLanes&=_,f.errorRecoveryDisabledLanes&=_,f.shellSuspendCounter=0;var ce=f.entanglements,Ee=f.expirationTimes,rt=f.hiddenUpdates;for(_=ee&~_;0<_;){var Tt=31-st(_),Ot=1<<Tt;ce[Tt]=0,Ee[Tt]=-1;var ht=rt[Tt];if(ht!==null)for(rt[Tt]=null,Tt=0;Tt<ht.length;Tt++){var dt=ht[Tt];dt!==null&&(dt.lane&=-536870913)}_&=~Ot}M!==0&&lt(f,M,0),N!==0&&B===0&&f.tag!==0&&(f.suspendedLanes|=N&~(ee&~m))}function lt(f,m,_){f.pendingLanes|=m,f.suspendedLanes&=~m;var M=31-st(m);f.entangledLanes|=m,f.entanglements[M]=f.entanglements[M]|1073741824|_&4194090}function It(f,m){var _=f.entangledLanes|=m;for(f=f.entanglements;_;){var M=31-st(_),B=1<<M;B&m|f[M]&m&&(f[M]|=m),_&=~B}}function Vt(f){switch(f){case 2:f=1;break;case 8:f=4;break;case 32:f=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:f=128;break;case 268435456:f=134217728;break;default:f=0}return f}function _i(f){return f&=-f,2<f?8<f?(f&134217727)!==0?32:268435456:8:2}function Jt(){var f=X.p;return f!==0?f:(f=window.event,f===void 0?32:jV(f.type))}function An(f,m){var _=X.p;try{return X.p=f,m()}finally{X.p=_}}var $i=Math.random().toString(36).slice(2),jn="__reactFiber$"+$i,xr="__reactProps$"+$i,Gr="__reactContainer$"+$i,kr="__reactEvents$"+$i,ve="__reactListeners$"+$i,et="__reactHandles$"+$i,ft="__reactResources$"+$i,Ye="__reactMarker$"+$i;function ot(f){delete f[jn],delete f[xr],delete f[kr],delete f[ve],delete f[et]}function kt(f){var m=f[jn];if(m)return m;for(var _=f.parentNode;_;){if(m=_[Gr]||_[jn]){if(_=m.alternate,m.child!==null||_!==null&&_.child!==null)for(f=DV(f);f!==null;){if(_=f[jn])return _;f=DV(f)}return m}f=_,_=f.parentNode}return null}function si(f){if(f=f[jn]||f[Gr]){var m=f.tag;if(m===5||m===6||m===13||m===26||m===27||m===3)return f}return null}function oi(f){var m=f.tag;if(m===5||m===26||m===27||m===6)return f.stateNode;throw Error(n(33))}function Zt(f){var m=f[ft];return m||(m=f[ft]={hoistableStyles:new Map,hoistableScripts:new Map}),m}function fi(f){f[Ye]=!0}var Ri=new Set,Pi={};function li(f,m){oe(f,m),oe(f+"Capture",m)}function oe(f,m){for(Pi[f]=m,f=0;f<m.length;f++)Ri.add(m[f])}var Ue=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),nt={},Ze={};function Ie(f){return Ge.call(Ze,f)?!0:Ge.call(nt,f)?!1:Ue.test(f)?Ze[f]=!0:(nt[f]=!0,!1)}function Rt(f,m,_){if(Ie(m))if(_===null)f.removeAttribute(m);else{switch(typeof _){case"undefined":case"function":case"symbol":f.removeAttribute(m);return;case"boolean":var M=m.toLowerCase().slice(0,5);if(M!=="data-"&&M!=="aria-"){f.removeAttribute(m);return}}f.setAttribute(m,""+_)}}function wt(f,m,_){if(_===null)f.removeAttribute(m);else{switch(typeof _){case"undefined":case"function":case"symbol":case"boolean":f.removeAttribute(m);return}f.setAttribute(m,""+_)}}function Nt(f,m,_,M){if(M===null)f.removeAttribute(_);else{switch(typeof M){case"undefined":case"function":case"symbol":case"boolean":f.removeAttribute(_);return}f.setAttributeNS(m,_,""+M)}}var Ht,ai;function $t(f){if(Ht===void 0)try{throw Error()}catch(_){var m=_.stack.trim().match(/\n( *(at )?)/);Ht=m&&m[1]||"",ai=-1<_.stack.indexOf(`
    at`)?" (<anonymous>)":-1<_.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ht+f+ai}var Z=!1;function re(f,m){if(!f||Z)return"";Z=!0;var _=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var M={DetermineComponentFrameRoot:function(){try{if(m){var Ot=function(){throw Error()};if(Object.defineProperty(Ot.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ot,[])}catch(dt){var ht=dt}Reflect.construct(f,[],Ot)}else{try{Ot.call()}catch(dt){ht=dt}f.call(Ot.prototype)}}else{try{throw Error()}catch(dt){ht=dt}(Ot=f())&&typeof Ot.catch=="function"&&Ot.catch(function(){})}}catch(dt){if(dt&&ht&&typeof dt.stack=="string")return[dt.stack,ht.stack]}return[null,null]}};M.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var B=Object.getOwnPropertyDescriptor(M.DetermineComponentFrameRoot,"name");B&&B.configurable&&Object.defineProperty(M.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var N=M.DetermineComponentFrameRoot(),ee=N[0],ce=N[1];if(ee&&ce){var Ee=ee.split(`
`),rt=ce.split(`
`);for(B=M=0;M<Ee.length&&!Ee[M].includes("DetermineComponentFrameRoot");)M++;for(;B<rt.length&&!rt[B].includes("DetermineComponentFrameRoot");)B++;if(M===Ee.length||B===rt.length)for(M=Ee.length-1,B=rt.length-1;1<=M&&0<=B&&Ee[M]!==rt[B];)B--;for(;1<=M&&0<=B;M--,B--)if(Ee[M]!==rt[B]){if(M!==1||B!==1)do if(M--,B--,0>B||Ee[M]!==rt[B]){var Tt=`
`+Ee[M].replace(" at new "," at ");return f.displayName&&Tt.includes("<anonymous>")&&(Tt=Tt.replace("<anonymous>",f.displayName)),Tt}while(1<=M&&0<=B);break}}}finally{Z=!1,Error.prepareStackTrace=_}return(_=f?f.displayName||f.name:"")?$t(_):""}function Se(f){switch(f.tag){case 26:case 27:case 5:return $t(f.type);case 16:return $t("Lazy");case 13:return $t("Suspense");case 19:return $t("SuspenseList");case 0:case 15:return re(f.type,!1);case 11:return re(f.type.render,!1);case 1:return re(f.type,!0);case 31:return $t("Activity");default:return""}}function ue(f){try{var m="";do m+=Se(f),f=f.return;while(f);return m}catch(_){return`
Error generating stack: `+_.message+`
`+_.stack}}function Pe(f){switch(typeof f){case"bigint":case"boolean":case"number":case"string":case"undefined":return f;case"object":return f;default:return""}}function yt(f){var m=f.type;return(f=f.nodeName)&&f.toLowerCase()==="input"&&(m==="checkbox"||m==="radio")}function ti(f){var m=yt(f)?"checked":"value",_=Object.getOwnPropertyDescriptor(f.constructor.prototype,m),M=""+f[m];if(!f.hasOwnProperty(m)&&typeof _<"u"&&typeof _.get=="function"&&typeof _.set=="function"){var B=_.get,N=_.set;return Object.defineProperty(f,m,{configurable:!0,get:function(){return B.call(this)},set:function(ee){M=""+ee,N.call(this,ee)}}),Object.defineProperty(f,m,{enumerable:_.enumerable}),{getValue:function(){return M},setValue:function(ee){M=""+ee},stopTracking:function(){f._valueTracker=null,delete f[m]}}}}function Wn(f){f._valueTracker||(f._valueTracker=ti(f))}function en(f){if(!f)return!1;var m=f._valueTracker;if(!m)return!0;var _=m.getValue(),M="";return f&&(M=yt(f)?f.checked?"true":"false":f.value),f=M,f!==_?(m.setValue(f),!0):!1}function Pr(f){if(f=f||(typeof document<"u"?document:void 0),typeof f>"u")return null;try{return f.activeElement||f.body}catch{return f.body}}var wa=/[\n"\\]/g;function Dn(f){return f.replace(wa,function(m){return"\\"+m.charCodeAt(0).toString(16)+" "})}function rc(f,m,_,M,B,N,ee,ce){f.name="",ee!=null&&typeof ee!="function"&&typeof ee!="symbol"&&typeof ee!="boolean"?f.type=ee:f.removeAttribute("type"),m!=null?ee==="number"?(m===0&&f.value===""||f.value!=m)&&(f.value=""+Pe(m)):f.value!==""+Pe(m)&&(f.value=""+Pe(m)):ee!=="submit"&&ee!=="reset"||f.removeAttribute("value"),m!=null?Bs(f,ee,Pe(m)):_!=null?Bs(f,ee,Pe(_)):M!=null&&f.removeAttribute("value"),B==null&&N!=null&&(f.defaultChecked=!!N),B!=null&&(f.checked=B&&typeof B!="function"&&typeof B!="symbol"),ce!=null&&typeof ce!="function"&&typeof ce!="symbol"&&typeof ce!="boolean"?f.name=""+Pe(ce):f.removeAttribute("name")}function Vn(f,m,_,M,B,N,ee,ce){if(N!=null&&typeof N!="function"&&typeof N!="symbol"&&typeof N!="boolean"&&(f.type=N),m!=null||_!=null){if(!(N!=="submit"&&N!=="reset"||m!=null))return;_=_!=null?""+Pe(_):"",m=m!=null?""+Pe(m):_,ce||m===f.value||(f.value=m),f.defaultValue=m}M=M??B,M=typeof M!="function"&&typeof M!="symbol"&&!!M,f.checked=ce?f.checked:!!M,f.defaultChecked=!!M,ee!=null&&typeof ee!="function"&&typeof ee!="symbol"&&typeof ee!="boolean"&&(f.name=ee)}function Bs(f,m,_){m==="number"&&Pr(f.ownerDocument)===f||f.defaultValue===""+_||(f.defaultValue=""+_)}function jr(f,m,_,M){if(f=f.options,m){m={};for(var B=0;B<_.length;B++)m["$"+_[B]]=!0;for(_=0;_<f.length;_++)B=m.hasOwnProperty("$"+f[_].value),f[_].selected!==B&&(f[_].selected=B),B&&M&&(f[_].defaultSelected=!0)}else{for(_=""+Pe(_),m=null,B=0;B<f.length;B++){if(f[B].value===_){f[B].selected=!0,M&&(f[B].defaultSelected=!0);return}m!==null||f[B].disabled||(m=f[B])}m!==null&&(m.selected=!0)}}function gs(f,m,_){if(m!=null&&(m=""+Pe(m),m!==f.value&&(f.value=m),_==null)){f.defaultValue!==m&&(f.defaultValue=m);return}f.defaultValue=_!=null?""+Pe(_):""}function vs(f,m,_,M){if(m==null){if(M!=null){if(_!=null)throw Error(n(92));if(J(M)){if(1<M.length)throw Error(n(93));M=M[0]}_=M}_==null&&(_=""),m=_}_=Pe(m),f.defaultValue=_,M=f.textContent,M===_&&M!==""&&M!==null&&(f.value=M)}function Ma(f,m){if(m){var _=f.firstChild;if(_&&_===f.lastChild&&_.nodeType===3){_.nodeValue=m;return}}f.textContent=m}var sc=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function yg(f,m,_){var M=m.indexOf("--")===0;_==null||typeof _=="boolean"||_===""?M?f.setProperty(m,""):m==="float"?f.cssFloat="":f[m]="":M?f.setProperty(m,_):typeof _!="number"||_===0||sc.has(m)?m==="float"?f.cssFloat=_:f[m]=(""+_).trim():f[m]=_+"px"}function xg(f,m,_){if(m!=null&&typeof m!="object")throw Error(n(62));if(f=f.style,_!=null){for(var M in _)!_.hasOwnProperty(M)||m!=null&&m.hasOwnProperty(M)||(M.indexOf("--")===0?f.setProperty(M,""):M==="float"?f.cssFloat="":f[M]="");for(var B in m)M=m[B],m.hasOwnProperty(B)&&_[B]!==M&&yg(f,B,M)}else for(var N in m)m.hasOwnProperty(N)&&yg(f,N,m[N])}function $0(f){if(f.indexOf("-")===-1)return!1;switch(f){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Wb=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),AM=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function bg(f){return AM.test(""+f)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":f}var ey=null;function ty(f){return f=f.target||f.srcElement||window,f.correspondingUseElement&&(f=f.correspondingUseElement),f.nodeType===3?f.parentNode:f}var ah=null,Od=null;function Xb(f){var m=si(f);if(m&&(f=m.stateNode)){var _=f[xr]||null;e:switch(f=m.stateNode,m.type){case"input":if(rc(f,_.value,_.defaultValue,_.defaultValue,_.checked,_.defaultChecked,_.type,_.name),m=_.name,_.type==="radio"&&m!=null){for(_=f;_.parentNode;)_=_.parentNode;for(_=_.querySelectorAll('input[name="'+Dn(""+m)+'"][type="radio"]'),m=0;m<_.length;m++){var M=_[m];if(M!==f&&M.form===f.form){var B=M[xr]||null;if(!B)throw Error(n(90));rc(M,B.value,B.defaultValue,B.defaultValue,B.checked,B.defaultChecked,B.type,B.name)}}for(m=0;m<_.length;m++)M=_[m],M.form===f.form&&en(M)}break e;case"textarea":gs(f,_.value,_.defaultValue);break e;case"select":m=_.value,m!=null&&jr(f,!!_.multiple,m,!1)}}}var Sg=!1;function qb(f,m,_){if(Sg)return f(m,_);Sg=!0;try{var M=f(m);return M}finally{if(Sg=!1,(ah!==null||Od!==null)&&(Sc(),ah&&(m=ah,f=Od,Od=ah=null,Xb(m),f)))for(m=0;m<f.length;m++)Xb(f[m])}}function hp(f,m){var _=f.stateNode;if(_===null)return null;var M=_[xr]||null;if(M===null)return null;_=M[m];e:switch(m){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(M=!M.disabled)||(f=f.type,M=!(f==="button"||f==="input"||f==="select"||f==="textarea")),f=!M;break e;default:f=!1}if(f)return null;if(_&&typeof _!="function")throw Error(n(231,m,typeof _));return _}var ac=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),_g=!1;if(ac)try{var dp={};Object.defineProperty(dp,"passive",{get:function(){_g=!0}}),window.addEventListener("test",dp,dp),window.removeEventListener("test",dp,dp)}catch{_g=!1}var iu=null,Yb=null,iy=null;function Qb(){if(iy)return iy;var f,m=Yb,_=m.length,M,B="value"in iu?iu.value:iu.textContent,N=B.length;for(f=0;f<_&&m[f]===B[f];f++);var ee=_-f;for(M=1;M<=ee&&m[_-M]===B[N-M];M++);return iy=B.slice(f,1<M?1-M:void 0)}function oh(f){var m=f.keyCode;return"charCode"in f?(f=f.charCode,f===0&&m===13&&(f=13)):f=m,f===10&&(f=13),32<=f||f===13?f:0}function fp(){return!0}function Ag(){return!1}function Ea(f){function m(_,M,B,N,ee){this._reactName=_,this._targetInst=B,this.type=M,this.nativeEvent=N,this.target=ee,this.currentTarget=null;for(var ce in f)f.hasOwnProperty(ce)&&(_=f[ce],this[ce]=_?_(N):N[ce]);return this.isDefaultPrevented=(N.defaultPrevented!=null?N.defaultPrevented:N.returnValue===!1)?fp:Ag,this.isPropagationStopped=Ag,this}return u(m.prototype,{preventDefault:function(){this.defaultPrevented=!0;var _=this.nativeEvent;_&&(_.preventDefault?_.preventDefault():typeof _.returnValue!="unknown"&&(_.returnValue=!1),this.isDefaultPrevented=fp)},stopPropagation:function(){var _=this.nativeEvent;_&&(_.stopPropagation?_.stopPropagation():typeof _.cancelBubble!="unknown"&&(_.cancelBubble=!0),this.isPropagationStopped=fp)},persist:function(){},isPersistent:fp}),m}var lh={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(f){return f.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},pp=Ea(lh),mp=u({},lh,{view:0,detail:0}),wM=Ea(mp),nu,gp,vp,yp=u({},mp,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Mg,button:0,buttons:0,relatedTarget:function(f){return f.relatedTarget===void 0?f.fromElement===f.srcElement?f.toElement:f.fromElement:f.relatedTarget},movementX:function(f){return"movementX"in f?f.movementX:(f!==vp&&(vp&&f.type==="mousemove"?(nu=f.screenX-vp.screenX,gp=f.screenY-vp.screenY):gp=nu=0,vp=f),nu)},movementY:function(f){return"movementY"in f?f.movementY:gp}}),Kb=Ea(yp),MM=u({},yp,{dataTransfer:0}),gP=Ea(MM),Is=u({},mp,{relatedTarget:0}),ny=Ea(Is),EM=u({},lh,{animationName:0,elapsedTime:0,pseudoElement:0}),TM=Ea(EM),CM=u({},lh,{clipboardData:function(f){return"clipboardData"in f?f.clipboardData:window.clipboardData}}),DM=Ea(CM),wg=u({},lh,{data:0}),ry=Ea(wg),RM={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},PM={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},OM={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Jb(f){var m=this.nativeEvent;return m.getModifierState?m.getModifierState(f):(f=OM[f])?!!m[f]:!1}function Mg(){return Jb}var BM=u({},mp,{key:function(f){if(f.key){var m=RM[f.key]||f.key;if(m!=="Unidentified")return m}return f.type==="keypress"?(f=oh(f),f===13?"Enter":String.fromCharCode(f)):f.type==="keydown"||f.type==="keyup"?PM[f.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Mg,charCode:function(f){return f.type==="keypress"?oh(f):0},keyCode:function(f){return f.type==="keydown"||f.type==="keyup"?f.keyCode:0},which:function(f){return f.type==="keypress"?oh(f):f.type==="keydown"||f.type==="keyup"?f.keyCode:0}}),Zb=Ea(BM),$b=u({},yp,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),sy=Ea($b),IM=u({},mp,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Mg}),eS=Ea(IM),LM=u({},lh,{propertyName:0,elapsedTime:0,pseudoElement:0}),ru=Ea(LM),tS=u({},yp,{deltaX:function(f){return"deltaX"in f?f.deltaX:"wheelDeltaX"in f?-f.wheelDeltaX:0},deltaY:function(f){return"deltaY"in f?f.deltaY:"wheelDeltaY"in f?-f.wheelDeltaY:"wheelDelta"in f?-f.wheelDelta:0},deltaZ:0,deltaMode:0}),vP=Ea(tS),UM=u({},lh,{newState:0,oldState:0}),ch=Ea(UM),su=[9,13,27,32],Eg=ac&&"CompositionEvent"in window,Bd=null;ac&&"documentMode"in document&&(Bd=document.documentMode);var Tg=ac&&"TextEvent"in window&&!Bd,Cg=ac&&(!Eg||Bd&&8<Bd&&11>=Bd),uh=" ",Ls=!1;function Dg(f,m){switch(f){case"keyup":return su.indexOf(m.keyCode)!==-1;case"keydown":return m.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function iS(f){return f=f.detail,typeof f=="object"&&"data"in f?f.data:null}var hh=!1;function Rg(f,m){switch(f){case"compositionend":return iS(m);case"keypress":return m.which!==32?null:(Ls=!0,uh);case"textInput":return f=m.data,f===uh&&Ls?null:f;default:return null}}function nS(f,m){if(hh)return f==="compositionend"||!Eg&&Dg(f,m)?(f=Qb(),iy=Yb=iu=null,hh=!1,f):null;switch(f){case"paste":return null;case"keypress":if(!(m.ctrlKey||m.altKey||m.metaKey)||m.ctrlKey&&m.altKey){if(m.char&&1<m.char.length)return m.char;if(m.which)return String.fromCharCode(m.which)}return null;case"compositionend":return Cg&&m.locale!=="ko"?null:m.data;default:return null}}var ay={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function rS(f){var m=f&&f.nodeName&&f.nodeName.toLowerCase();return m==="input"?!!ay[f.type]:m==="textarea"}function Ja(f,m,_,M){ah?Od?Od.push(M):Od=[M]:ah=M,m=LE(m,"onChange"),0<m.length&&(_=new pp("onChange","change",null,_,M),f.push({event:_,listeners:m}))}var xp=null,Id=null;function NM(f){xV(f,0)}function Pg(f){var m=oi(f);if(en(m))return f}function oy(f,m){if(f==="change")return m}var ly=!1;if(ac){var cy;if(ac){var bp="oninput"in document;if(!bp){var Sp=document.createElement("div");Sp.setAttribute("oninput","return;"),bp=typeof Sp.oninput=="function"}cy=bp}else cy=!1;ly=cy&&(!document.documentMode||9<document.documentMode)}function pr(){xp&&(xp.detachEvent("onpropertychange",zM),Id=xp=null)}function zM(f){if(f.propertyName==="value"&&Pg(Id)){var m=[];Ja(m,Id,f,ty(f)),qb(NM,m)}}function yP(f,m,_){f==="focusin"?(pr(),xp=m,Id=_,xp.attachEvent("onpropertychange",zM)):f==="focusout"&&pr()}function FM(f){if(f==="selectionchange"||f==="keyup"||f==="keydown")return Pg(Id)}function Og(f,m){if(f==="click")return Pg(m)}function dh(f,m){if(f==="input"||f==="change")return Pg(m)}function VM(f,m){return f===m&&(f!==0||1/f===1/m)||f!==f&&m!==m}var Za=typeof Object.is=="function"?Object.is:VM;function Il(f,m){if(Za(f,m))return!0;if(typeof f!="object"||f===null||typeof m!="object"||m===null)return!1;var _=Object.keys(f),M=Object.keys(m);if(_.length!==M.length)return!1;for(M=0;M<_.length;M++){var B=_[M];if(!Ge.call(m,B)||!Za(f[B],m[B]))return!1}return!0}function $a(f){for(;f&&f.firstChild;)f=f.firstChild;return f}function sS(f,m){var _=$a(f);f=0;for(var M;_;){if(_.nodeType===3){if(M=f+_.textContent.length,f<=m&&M>=m)return{node:_,offset:m-f};f=M}e:{for(;_;){if(_.nextSibling){_=_.nextSibling;break e}_=_.parentNode}_=void 0}_=$a(_)}}function aS(f,m){return f&&m?f===m?!0:f&&f.nodeType===3?!1:m&&m.nodeType===3?aS(f,m.parentNode):"contains"in f?f.contains(m):f.compareDocumentPosition?!!(f.compareDocumentPosition(m)&16):!1:!1}function oS(f){f=f!=null&&f.ownerDocument!=null&&f.ownerDocument.defaultView!=null?f.ownerDocument.defaultView:window;for(var m=Pr(f.document);m instanceof f.HTMLIFrameElement;){try{var _=typeof m.contentWindow.location.href=="string"}catch{_=!1}if(_)f=m.contentWindow;else break;m=Pr(f.document)}return m}function Bg(f){var m=f&&f.nodeName&&f.nodeName.toLowerCase();return m&&(m==="input"&&(f.type==="text"||f.type==="search"||f.type==="tel"||f.type==="url"||f.type==="password")||m==="textarea"||f.contentEditable==="true")}var lS=ac&&"documentMode"in document&&11>=document.documentMode,au=null,uy=null,Ig=null,hy=!1;function cS(f,m,_){var M=_.window===_?_.document:_.nodeType===9?_:_.ownerDocument;hy||au==null||au!==Pr(M)||(M=au,"selectionStart"in M&&Bg(M)?M={start:M.selectionStart,end:M.selectionEnd}:(M=(M.ownerDocument&&M.ownerDocument.defaultView||window).getSelection(),M={anchorNode:M.anchorNode,anchorOffset:M.anchorOffset,focusNode:M.focusNode,focusOffset:M.focusOffset}),Ig&&Il(Ig,M)||(Ig=M,M=LE(uy,"onSelect"),0<M.length&&(m=new pp("onSelect","select",null,m,_),f.push({event:m,listeners:M}),m.target=au)))}function Us(f,m){var _={};return _[f.toLowerCase()]=m.toLowerCase(),_["Webkit"+f]="webkit"+m,_["Moz"+f]="moz"+m,_}var fh={animationend:Us("Animation","AnimationEnd"),animationiteration:Us("Animation","AnimationIteration"),animationstart:Us("Animation","AnimationStart"),transitionrun:Us("Transition","TransitionRun"),transitionstart:Us("Transition","TransitionStart"),transitioncancel:Us("Transition","TransitionCancel"),transitionend:Us("Transition","TransitionEnd")},dy={},HM={};ac&&(HM=document.createElement("div").style,"AnimationEvent"in window||(delete fh.animationend.animation,delete fh.animationiteration.animation,delete fh.animationstart.animation),"TransitionEvent"in window||delete fh.transitionend.transition);function ou(f){if(dy[f])return dy[f];if(!fh[f])return f;var m=fh[f],_;for(_ in m)if(m.hasOwnProperty(_)&&_ in HM)return dy[f]=m[_];return f}var Ta=ou("animationend"),uS=ou("animationiteration"),eo=ou("animationstart"),GM=ou("transitionrun"),lu=ou("transitionstart"),_p=ou("transitioncancel"),cu=ou("transitionend"),fy=new Map,Lg="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Lg.push("scrollEnd");function ys(f,m){fy.set(f,m),li(m,[f])}var hS=new WeakMap;function Ns(f,m){if(typeof f=="object"&&f!==null){var _=hS.get(f);return _!==void 0?_:(m={value:f,source:m,stack:ue(m)},hS.set(f,m),m)}return{value:f,source:m,stack:ue(m)}}var na=[],sl=0,py=0;function Ug(){for(var f=sl,m=py=sl=0;m<f;){var _=na[m];na[m++]=null;var M=na[m];na[m++]=null;var B=na[m];na[m++]=null;var N=na[m];if(na[m++]=null,M!==null&&B!==null){var ee=M.pending;ee===null?B.next=B:(B.next=ee.next,ee.next=B),M.pending=B}N!==0&&dS(_,B,N)}}function ph(f,m,_,M){na[sl++]=f,na[sl++]=m,na[sl++]=_,na[sl++]=M,py|=M,f.lanes|=M,f=f.alternate,f!==null&&(f.lanes|=M)}function my(f,m,_,M){return ph(f,m,_,M),Ap(f)}function uu(f,m){return ph(f,null,null,m),Ap(f)}function dS(f,m,_){f.lanes|=_;var M=f.alternate;M!==null&&(M.lanes|=_);for(var B=!1,N=f.return;N!==null;)N.childLanes|=_,M=N.alternate,M!==null&&(M.childLanes|=_),N.tag===22&&(f=N.stateNode,f===null||f._visibility&1||(B=!0)),f=N,N=N.return;return f.tag===3?(N=f.stateNode,B&&m!==null&&(B=31-st(_),f=N.hiddenUpdates,M=f[B],M===null?f[B]=[m]:M.push(m),m.lane=_|536870912),N):null}function Ap(f){if(50<bc)throw bc=0,Zd=null,Error(n(185));for(var m=f.return;m!==null;)f=m,m=f.return;return f.tag===3?f.stateNode:null}var mh={};function fS(f,m,_,M){this.tag=f,this.key=_,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=m,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=M,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function to(f,m,_,M){return new fS(f,m,_,M)}function Ng(f){return f=f.prototype,!(!f||!f.isReactComponent)}function Or(f,m){var _=f.alternate;return _===null?(_=to(f.tag,m,f.key,f.mode),_.elementType=f.elementType,_.type=f.type,_.stateNode=f.stateNode,_.alternate=f,f.alternate=_):(_.pendingProps=m,_.type=f.type,_.flags=0,_.subtreeFlags=0,_.deletions=null),_.flags=f.flags&65011712,_.childLanes=f.childLanes,_.lanes=f.lanes,_.child=f.child,_.memoizedProps=f.memoizedProps,_.memoizedState=f.memoizedState,_.updateQueue=f.updateQueue,m=f.dependencies,_.dependencies=m===null?null:{lanes:m.lanes,firstContext:m.firstContext},_.sibling=f.sibling,_.index=f.index,_.ref=f.ref,_.refCleanup=f.refCleanup,_}function pS(f,m){f.flags&=65011714;var _=f.alternate;return _===null?(f.childLanes=0,f.lanes=m,f.child=null,f.subtreeFlags=0,f.memoizedProps=null,f.memoizedState=null,f.updateQueue=null,f.dependencies=null,f.stateNode=null):(f.childLanes=_.childLanes,f.lanes=_.lanes,f.child=_.child,f.subtreeFlags=0,f.deletions=null,f.memoizedProps=_.memoizedProps,f.memoizedState=_.memoizedState,f.updateQueue=_.updateQueue,f.type=_.type,m=_.dependencies,f.dependencies=m===null?null:{lanes:m.lanes,firstContext:m.firstContext}),f}function xs(f,m,_,M,B,N){var ee=0;if(M=f,typeof f=="function")Ng(f)&&(ee=1);else if(typeof f=="string")ee=Ane(f,_,te.current)?26:f==="html"||f==="head"||f==="body"?27:5;else e:switch(f){case O:return f=to(31,_,m,B),f.elementType=O,f.lanes=N,f;case g:return gh(_.children,B,N,m);case x:ee=8,B|=24;break;case y:return f=to(12,_,m,B|2),f.elementType=y,f.lanes=N,f;case D:return f=to(13,_,m,B),f.elementType=D,f.lanes=N,f;case T:return f=to(19,_,m,B),f.elementType=T,f.lanes=N,f;default:if(typeof f=="object"&&f!==null)switch(f.$$typeof){case b:case w:ee=10;break e;case A:ee=9;break e;case E:ee=11;break e;case I:ee=14;break e;case R:ee=16,M=null;break e}ee=29,_=Error(n(130,f===null?"null":typeof f,"")),M=null}return m=to(ee,_,m,B),m.elementType=f,m.type=M,m.lanes=N,m}function gh(f,m,_,M){return f=to(7,f,M,m),f.lanes=_,f}function zg(f,m,_){return f=to(6,f,null,m),f.lanes=_,f}function gy(f,m,_){return m=to(4,f.children!==null?f.children:[],f.key,m),m.lanes=_,m.stateNode={containerInfo:f.containerInfo,pendingChildren:null,implementation:f.implementation},m}var wp=[],io=0,Fg=null,Mp=0,zs=[],wo=0,vh=null,oc=1,lc="";function hu(f,m){wp[io++]=Mp,wp[io++]=Fg,Fg=f,Mp=m}function vy(f,m,_){zs[wo++]=oc,zs[wo++]=lc,zs[wo++]=vh,vh=f;var M=oc;f=lc;var B=32-st(M)-1;M&=~(1<<B),_+=1;var N=32-st(m)+B;if(30<N){var ee=B-B%5;N=(M&(1<<ee)-1).toString(32),M>>=ee,B-=ee,oc=1<<32-st(m)+B|_<<B|M,lc=N+f}else oc=1<<N|_<<B|M,lc=f}function mS(f){f.return!==null&&(hu(f,1),vy(f,1,0))}function gS(f){for(;f===Fg;)Fg=wp[--io],wp[io]=null,Mp=wp[--io],wp[io]=null;for(;f===vh;)vh=zs[--wo],zs[wo]=null,lc=zs[--wo],zs[wo]=null,oc=zs[--wo],zs[wo]=null}var Ca=null,br=null,wn=!1,al=null,Mo=!1,yy=Error(n(519));function yh(f){var m=Error(n(418,""));throw Ld(Ns(m,f)),yy}function kM(f){var m=f.stateNode,_=f.type,M=f.memoizedProps;switch(m[jn]=f,m[xr]=M,_){case"dialog":un("cancel",m),un("close",m);break;case"iframe":case"object":case"embed":un("load",m);break;case"video":case"audio":for(_=0;_<qS.length;_++)un(qS[_],m);break;case"source":un("error",m);break;case"img":case"image":case"link":un("error",m),un("load",m);break;case"details":un("toggle",m);break;case"input":un("invalid",m),Vn(m,M.value,M.defaultValue,M.checked,M.defaultChecked,M.type,M.name,!0),Wn(m);break;case"select":un("invalid",m);break;case"textarea":un("invalid",m),vs(m,M.value,M.defaultValue,M.children),Wn(m)}_=M.children,typeof _!="string"&&typeof _!="number"&&typeof _!="bigint"||m.textContent===""+_||M.suppressHydrationWarning===!0||AV(m.textContent,_)?(M.popover!=null&&(un("beforetoggle",m),un("toggle",m)),M.onScroll!=null&&un("scroll",m),M.onScrollEnd!=null&&un("scrollend",m),M.onClick!=null&&(m.onclick=UE),m=!0):m=!1,m||yh(f)}function vS(f){for(Ca=f.return;Ca;)switch(Ca.tag){case 5:case 13:Mo=!1;return;case 27:case 3:Mo=!0;return;default:Ca=Ca.return}}function Ll(f){if(f!==Ca)return!1;if(!wn)return vS(f),wn=!0,!1;var m=f.tag,_;if((_=m!==3&&m!==27)&&((_=m===5)&&(_=f.type,_=!(_!=="form"&&_!=="button")||zP(f.type,f.memoizedProps)),_=!_),_&&br&&yh(f),vS(f),m===13){if(f=f.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(n(317));e:{for(f=f.nextSibling,m=0;f;){if(f.nodeType===8)if(_=f.data,_==="/$"){if(m===0){br=Mu(f.nextSibling);break e}m--}else _!=="$"&&_!=="$!"&&_!=="$?"||m++;f=f.nextSibling}br=null}}else m===27?(m=br,Kp(f.type)?(f=GP,GP=null,br=f):br=m):br=Ca?Mu(f.stateNode.nextSibling):null;return!0}function Ep(){br=Ca=null,wn=!1}function On(){var f=al;return f!==null&&(Ai===null?Ai=f:Ai.push.apply(Ai,f),al=null),f}function Ld(f){al===null?al=[f]:al.push(f)}var yS=$(null),xh=null,du=null;function bh(f,m,_){fe(yS,m._currentValue),m._currentValue=_}function fu(f){f._currentValue=yS.current,se(yS)}function xS(f,m,_){for(;f!==null;){var M=f.alternate;if((f.childLanes&m)!==m?(f.childLanes|=m,M!==null&&(M.childLanes|=m)):M!==null&&(M.childLanes&m)!==m&&(M.childLanes|=m),f===_)break;f=f.return}}function Vg(f,m,_,M){var B=f.child;for(B!==null&&(B.return=f);B!==null;){var N=B.dependencies;if(N!==null){var ee=B.child;N=N.firstContext;e:for(;N!==null;){var ce=N;N=B;for(var Ee=0;Ee<m.length;Ee++)if(ce.context===m[Ee]){N.lanes|=_,ce=N.alternate,ce!==null&&(ce.lanes|=_),xS(N.return,_,f),M||(ee=null);break e}N=ce.next}}else if(B.tag===18){if(ee=B.return,ee===null)throw Error(n(341));ee.lanes|=_,N=ee.alternate,N!==null&&(N.lanes|=_),xS(ee,_,f),ee=null}else ee=B.child;if(ee!==null)ee.return=B;else for(ee=B;ee!==null;){if(ee===f){ee=null;break}if(B=ee.sibling,B!==null){B.return=ee.return,ee=B;break}ee=ee.return}B=ee}}function ol(f,m,_,M){f=null;for(var B=m,N=!1;B!==null;){if(!N){if((B.flags&524288)!==0)N=!0;else if((B.flags&262144)!==0)break}if(B.tag===10){var ee=B.alternate;if(ee===null)throw Error(n(387));if(ee=ee.memoizedProps,ee!==null){var ce=B.type;Za(B.pendingProps.value,ee.value)||(f!==null?f.push(ce):f=[ce])}}else if(B===_e.current){if(ee=B.alternate,ee===null)throw Error(n(387));ee.memoizedState.memoizedState!==B.memoizedState.memoizedState&&(f!==null?f.push($S):f=[$S])}B=B.return}f!==null&&Vg(m,f,_,M),m.flags|=262144}function Hg(f){for(f=f.firstContext;f!==null;){if(!Za(f.context._currentValue,f.memoizedValue))return!0;f=f.next}return!1}function cc(f){xh=f,du=null,f=f.dependencies,f!==null&&(f.firstContext=null)}function wr(f){return xy(xh,f)}function Gg(f,m){return xh===null&&cc(f),xy(f,m)}function xy(f,m){var _=m._currentValue;if(m={context:m,memoizedValue:_,next:null},du===null){if(f===null)throw Error(n(308));du=m,f.dependencies={lanes:0,firstContext:m},f.flags|=524288}else du=du.next=m;return _}var bS=typeof AbortController<"u"?AbortController:function(){var f=[],m=this.signal={aborted:!1,addEventListener:function(_,M){f.push(M)}};this.abort=function(){m.aborted=!0,f.forEach(function(_){return _()})}},xP=e.unstable_scheduleCallback,jM=e.unstable_NormalPriority,Wr={$$typeof:w,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function by(){return{controller:new bS,data:new Map,refCount:0}}function Tp(f){f.refCount--,f.refCount===0&&xP(jM,function(){f.controller.abort()})}var Cp=null,kg=0,ji=0,Dp=null;function Eo(f,m){if(Cp===null){var _=Cp=[];kg=0,ji=DP(),Dp={status:"pending",value:void 0,then:function(M){_.push(M)}}}return kg++,m.then(Sy,Sy),m}function Sy(){if(--kg===0&&Cp!==null){Dp!==null&&(Dp.status="fulfilled");var f=Cp;Cp=null,ji=0,Dp=null;for(var m=0;m<f.length;m++)(0,f[m])()}}function bP(f,m){var _=[],M={status:"pending",value:null,reason:null,then:function(B){_.push(B)}};return f.then(function(){M.status="fulfilled",M.value=m;for(var B=0;B<_.length;B++)(0,_[B])(m)},function(B){for(M.status="rejected",M.reason=B,B=0;B<_.length;B++)(0,_[B])(void 0)}),M}var jg=F.S;F.S=function(f,m){typeof m=="object"&&m!==null&&typeof m.then=="function"&&Eo(f,m),jg!==null&&jg(f,m)};var ll=$(null);function Sh(){var f=ll.current;return f!==null?f:Fi.pooledCache}function Wg(f,m){m===null?fe(ll,ll.current):fe(ll,m.pool)}function _y(){var f=Sh();return f===null?null:{parent:Wr._currentValue,pool:f}}var Xg=Error(n(460)),SS=Error(n(474)),Ul=Error(n(542)),qg={then:function(){}};function Ay(f){return f=f.status,f==="fulfilled"||f==="rejected"}function Rp(){}function wy(f,m,_){switch(_=f[_],_===void 0?f.push(m):_!==m&&(m.then(Rp,Rp),m=_),m.status){case"fulfilled":return m.value;case"rejected":throw f=m.reason,WM(f),f;default:if(typeof m.status=="string")m.then(Rp,Rp);else{if(f=Fi,f!==null&&100<f.shellSuspendCounter)throw Error(n(482));f=m,f.status="pending",f.then(function(M){if(m.status==="pending"){var B=m;B.status="fulfilled",B.value=M}},function(M){if(m.status==="pending"){var B=m;B.status="rejected",B.reason=M}})}switch(m.status){case"fulfilled":return m.value;case"rejected":throw f=m.reason,WM(f),f}throw cl=m,Xg}}var cl=null;function _S(){if(cl===null)throw Error(n(459));var f=cl;return cl=null,f}function WM(f){if(f===Xg||f===Ul)throw Error(n(483))}var pu=!1;function AS(f){f.updateQueue={baseState:f.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Bi(f,m){f=f.updateQueue,m.updateQueue===f&&(m.updateQueue={baseState:f.baseState,firstBaseUpdate:f.firstBaseUpdate,lastBaseUpdate:f.lastBaseUpdate,shared:f.shared,callbacks:null})}function uc(f){return{lane:f,tag:0,payload:null,callback:null,next:null}}function mu(f,m,_){var M=f.updateQueue;if(M===null)return null;if(M=M.shared,(Bn&2)!==0){var B=M.pending;return B===null?m.next=m:(m.next=B.next,B.next=m),M.pending=m,m=Ap(f),dS(f,null,_),m}return ph(f,M,m,_),Ap(f)}function Ud(f,m,_){if(m=m.updateQueue,m!==null&&(m=m.shared,(_&4194048)!==0)){var M=m.lanes;M&=f.pendingLanes,_|=M,m.lanes=_,It(f,_)}}function Pp(f,m){var _=f.updateQueue,M=f.alternate;if(M!==null&&(M=M.updateQueue,_===M)){var B=null,N=null;if(_=_.firstBaseUpdate,_!==null){do{var ee={lane:_.lane,tag:_.tag,payload:_.payload,callback:null,next:null};N===null?B=N=ee:N=N.next=ee,_=_.next}while(_!==null);N===null?B=N=m:N=N.next=m}else B=N=m;_={baseState:M.baseState,firstBaseUpdate:B,lastBaseUpdate:N,shared:M.shared,callbacks:M.callbacks},f.updateQueue=_;return}f=_.lastBaseUpdate,f===null?_.firstBaseUpdate=m:f.next=m,_.lastBaseUpdate=m}var wS=!1;function Yg(){if(wS){var f=Dp;if(f!==null)throw f}}function Op(f,m,_,M){wS=!1;var B=f.updateQueue;pu=!1;var N=B.firstBaseUpdate,ee=B.lastBaseUpdate,ce=B.shared.pending;if(ce!==null){B.shared.pending=null;var Ee=ce,rt=Ee.next;Ee.next=null,ee===null?N=rt:ee.next=rt,ee=Ee;var Tt=f.alternate;Tt!==null&&(Tt=Tt.updateQueue,ce=Tt.lastBaseUpdate,ce!==ee&&(ce===null?Tt.firstBaseUpdate=rt:ce.next=rt,Tt.lastBaseUpdate=Ee))}if(N!==null){var Ot=B.baseState;ee=0,Tt=rt=Ee=null,ce=N;do{var ht=ce.lane&-536870913,dt=ht!==ce.lane;if(dt?(pi&ht)===ht:(M&ht)===ht){ht!==0&&ht===ji&&(wS=!0),Tt!==null&&(Tt=Tt.next={lane:0,tag:ce.tag,payload:ce.payload,callback:null,next:null});e:{var Li=f,Ci=ce;ht=m;var ar=_;switch(Ci.tag){case 1:if(Li=Ci.payload,typeof Li=="function"){Ot=Li.call(ar,Ot,ht);break e}Ot=Li;break e;case 3:Li.flags=Li.flags&-65537|128;case 0:if(Li=Ci.payload,ht=typeof Li=="function"?Li.call(ar,Ot,ht):Li,ht==null)break e;Ot=u({},Ot,ht);break e;case 2:pu=!0}}ht=ce.callback,ht!==null&&(f.flags|=64,dt&&(f.flags|=8192),dt=B.callbacks,dt===null?B.callbacks=[ht]:dt.push(ht))}else dt={lane:ht,tag:ce.tag,payload:ce.payload,callback:ce.callback,next:null},Tt===null?(rt=Tt=dt,Ee=Ot):Tt=Tt.next=dt,ee|=ht;if(ce=ce.next,ce===null){if(ce=B.shared.pending,ce===null)break;dt=ce,ce=dt.next,dt.next=null,B.lastBaseUpdate=dt,B.shared.pending=null}}while(!0);Tt===null&&(Ee=Ot),B.baseState=Ee,B.firstBaseUpdate=rt,B.lastBaseUpdate=Tt,N===null&&(B.shared.lanes=0),jl|=ee,f.lanes=ee,f.memoizedState=Ot}}function Bp(f,m){if(typeof f!="function")throw Error(n(191,f));f.call(m)}function XM(f,m){var _=f.callbacks;if(_!==null)for(f.callbacks=null,f=0;f<_.length;f++)Bp(_[f],m)}var Ip=$(null),My=$(0);function qM(f,m){f=ml,fe(My,f),fe(Ip,m),ml=f|m.baseLanes}function MS(){fe(My,ml),fe(Ip,Ip.current)}function Qg(){ml=My.current,se(Ip),se(My)}var gu=0,Wi=null,Nn=null,Xr=null,Ey=!1,_h=!1,Da=!1,is=0,ul=0,Fs=null,YM=0;function Br(){throw Error(n(321))}function ra(f,m){if(m===null)return!1;for(var _=0;_<m.length&&_<f.length;_++)if(!Za(f[_],m[_]))return!1;return!0}function vu(f,m,_,M,B,N){return gu=N,Wi=m,m.memoizedState=null,m.updateQueue=null,m.lanes=0,F.H=f===null||f.memoizedState===null?Ly:HS,Da=!1,N=_(M,B),Da=!1,_h&&(N=KM(m,_,M,B)),QM(f),N}function QM(f){F.H=Zg;var m=Nn!==null&&Nn.next!==null;if(gu=0,Xr=Nn=Wi=null,Ey=!1,ul=0,Fs=null,m)throw Error(n(300));f===null||bs||(f=f.dependencies,f!==null&&Hg(f)&&(bs=!0))}function KM(f,m,_,M){Wi=f;var B=0;do{if(_h&&(Fs=null),ul=0,_h=!1,25<=B)throw Error(n(301));if(B+=1,Xr=Nn=null,f.updateQueue!=null){var N=f.updateQueue;N.lastEffect=null,N.events=null,N.stores=null,N.memoCache!=null&&(N.memoCache.index=0)}F.H=_E,N=m(_,M)}while(_h);return N}function SP(){var f=F.H,m=f.useState()[0];return m=typeof m.then=="function"?Nl(m):m,f=f.useState()[0],(Nn!==null?Nn.memoizedState:null)!==f&&(Wi.flags|=1024),m}function ES(){var f=is!==0;return is=0,f}function Ty(f,m,_){m.updateQueue=f.updateQueue,m.flags&=-2053,f.lanes&=~_}function TS(f){if(Ey){for(f=f.memoizedState;f!==null;){var m=f.queue;m!==null&&(m.pending=null),f=f.next}Ey=!1}gu=0,Xr=Nn=Wi=null,_h=!1,ul=is=0,Fs=null}function Ra(){var f={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Xr===null?Wi.memoizedState=Xr=f:Xr=Xr.next=f,Xr}function qr(){if(Nn===null){var f=Wi.alternate;f=f!==null?f.memoizedState:null}else f=Nn.next;var m=Xr===null?Wi.memoizedState:Xr.next;if(m!==null)Xr=m,Nn=f;else{if(f===null)throw Wi.alternate===null?Error(n(467)):Error(n(310));Nn=f,f={memoizedState:Nn.memoizedState,baseState:Nn.baseState,baseQueue:Nn.baseQueue,queue:Nn.queue,next:null},Xr===null?Wi.memoizedState=Xr=f:Xr=Xr.next=f}return Xr}function Ah(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Nl(f){var m=ul;return ul+=1,Fs===null&&(Fs=[]),f=wy(Fs,f,m),m=Wi,(Xr===null?m.memoizedState:Xr.next)===null&&(m=m.alternate,F.H=m===null||m.memoizedState===null?Ly:HS),f}function Cy(f){if(f!==null&&typeof f=="object"){if(typeof f.then=="function")return Nl(f);if(f.$$typeof===w)return wr(f)}throw Error(n(438,String(f)))}function CS(f){var m=null,_=Wi.updateQueue;if(_!==null&&(m=_.memoCache),m==null){var M=Wi.alternate;M!==null&&(M=M.updateQueue,M!==null&&(M=M.memoCache,M!=null&&(m={data:M.data.map(function(B){return B.slice()}),index:0})))}if(m==null&&(m={data:[],index:0}),_===null&&(_=Ah(),Wi.updateQueue=_),_.memoCache=m,_=m.data[m.index],_===void 0)for(_=m.data[m.index]=Array(f),M=0;M<f;M++)_[M]=P;return m.index++,_}function yu(f,m){return typeof m=="function"?m(f):m}function wh(f){var m=qr();return DS(m,Nn,f)}function DS(f,m,_){var M=f.queue;if(M===null)throw Error(n(311));M.lastRenderedReducer=_;var B=f.baseQueue,N=M.pending;if(N!==null){if(B!==null){var ee=B.next;B.next=N.next,N.next=ee}m.baseQueue=B=N,M.pending=null}if(N=f.baseState,B===null)f.memoizedState=N;else{m=B.next;var ce=ee=null,Ee=null,rt=m,Tt=!1;do{var Ot=rt.lane&-536870913;if(Ot!==rt.lane?(pi&Ot)===Ot:(gu&Ot)===Ot){var ht=rt.revertLane;if(ht===0)Ee!==null&&(Ee=Ee.next={lane:0,revertLane:0,action:rt.action,hasEagerState:rt.hasEagerState,eagerState:rt.eagerState,next:null}),Ot===ji&&(Tt=!0);else if((gu&ht)===ht){rt=rt.next,ht===ji&&(Tt=!0);continue}else Ot={lane:0,revertLane:rt.revertLane,action:rt.action,hasEagerState:rt.hasEagerState,eagerState:rt.eagerState,next:null},Ee===null?(ce=Ee=Ot,ee=N):Ee=Ee.next=Ot,Wi.lanes|=ht,jl|=ht;Ot=rt.action,Da&&_(N,Ot),N=rt.hasEagerState?rt.eagerState:_(N,Ot)}else ht={lane:Ot,revertLane:rt.revertLane,action:rt.action,hasEagerState:rt.hasEagerState,eagerState:rt.eagerState,next:null},Ee===null?(ce=Ee=ht,ee=N):Ee=Ee.next=ht,Wi.lanes|=Ot,jl|=Ot;rt=rt.next}while(rt!==null&&rt!==m);if(Ee===null?ee=N:Ee.next=ce,!Za(N,f.memoizedState)&&(bs=!0,Tt&&(_=Dp,_!==null)))throw _;f.memoizedState=N,f.baseState=ee,f.baseQueue=Ee,M.lastRenderedState=N}return B===null&&(M.lanes=0),[f.memoizedState,M.dispatch]}function RS(f){var m=qr(),_=m.queue;if(_===null)throw Error(n(311));_.lastRenderedReducer=f;var M=_.dispatch,B=_.pending,N=m.memoizedState;if(B!==null){_.pending=null;var ee=B=B.next;do N=f(N,ee.action),ee=ee.next;while(ee!==B);Za(N,m.memoizedState)||(bs=!0),m.memoizedState=N,m.baseQueue===null&&(m.baseState=N),_.lastRenderedState=N}return[N,M]}function JM(f,m,_){var M=Wi,B=qr(),N=wn;if(N){if(_===void 0)throw Error(n(407));_=_()}else _=m();var ee=!Za((Nn||B).memoizedState,_);ee&&(B.memoizedState=_,bs=!0),B=B.queue;var ce=$M.bind(null,M,B,f);if(Np(2048,8,ce,[f]),B.getSnapshot!==m||ee||Xr!==null&&Xr.memoizedState.tag&1){if(M.flags|=2048,Up(9,Kg(),ZM.bind(null,M,B,_,m),null),Fi===null)throw Error(n(349));N||(gu&124)!==0||Lp(M,m,_)}return _}function Lp(f,m,_){f.flags|=16384,f={getSnapshot:m,value:_},m=Wi.updateQueue,m===null?(m=Ah(),Wi.updateQueue=m,m.stores=[f]):(_=m.stores,_===null?m.stores=[f]:_.push(f))}function ZM(f,m,_,M){m.value=_,m.getSnapshot=M,eE(m)&&tE(f)}function $M(f,m,_){return _(function(){eE(m)&&tE(f)})}function eE(f){var m=f.getSnapshot;f=f.value;try{var _=m();return!Za(f,_)}catch{return!0}}function tE(f){var m=uu(f,2);m!==null&&Ba(m,f,2)}function PS(f){var m=Ra();if(typeof f=="function"){var _=f;if(f=_(),Da){Le(!0);try{_()}finally{Le(!1)}}}return m.memoizedState=m.baseState=f,m.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:yu,lastRenderedState:f},m}function iE(f,m,_,M){return f.baseState=_,DS(f,Nn,typeof M=="function"?M:yu)}function _P(f,m,_,M,B){if(Iy(f))throw Error(n(485));if(f=m.action,f!==null){var N={payload:B,action:f,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(ee){N.listeners.push(ee)}};F.T!==null?_(!0):N.isTransition=!1,M(N),_=m.pending,_===null?(N.next=m.pending=N,nE(m,N)):(N.next=_.next,m.pending=_.next=N)}}function nE(f,m){var _=m.action,M=m.payload,B=f.state;if(m.isTransition){var N=F.T,ee={};F.T=ee;try{var ce=_(B,M),Ee=F.S;Ee!==null&&Ee(ee,ce),rE(f,m,ce)}catch(rt){OS(f,m,rt)}finally{F.T=N}}else try{N=_(B,M),rE(f,m,N)}catch(rt){OS(f,m,rt)}}function rE(f,m,_){_!==null&&typeof _=="object"&&typeof _.then=="function"?_.then(function(M){sE(f,m,M)},function(M){return OS(f,m,M)}):sE(f,m,_)}function sE(f,m,_){m.status="fulfilled",m.value=_,aE(m),f.state=_,m=f.pending,m!==null&&(_=m.next,_===m?f.pending=null:(_=_.next,m.next=_,nE(f,_)))}function OS(f,m,_){var M=f.pending;if(f.pending=null,M!==null){M=M.next;do m.status="rejected",m.reason=_,aE(m),m=m.next;while(m!==M)}f.action=null}function aE(f){f=f.listeners;for(var m=0;m<f.length;m++)(0,f[m])()}function BS(f,m){return m}function oE(f,m){if(wn){var _=Fi.formState;if(_!==null){e:{var M=Wi;if(wn){if(br){t:{for(var B=br,N=Mo;B.nodeType!==8;){if(!N){B=null;break t}if(B=Mu(B.nextSibling),B===null){B=null;break t}}N=B.data,B=N==="F!"||N==="F"?B:null}if(B){br=Mu(B.nextSibling),M=B.data==="F!";break e}}yh(M)}M=!1}M&&(m=_[0])}}return _=Ra(),_.memoizedState=_.baseState=m,M={pending:null,lanes:0,dispatch:null,lastRenderedReducer:BS,lastRenderedState:m},_.queue=M,_=bE.bind(null,Wi,M),M.dispatch=_,M=PS(!1),N=By.bind(null,Wi,!1,M.queue),M=Ra(),B={state:m,dispatch:null,action:f,pending:null},M.queue=B,_=_P.bind(null,Wi,B,N,_),B.dispatch=_,M.memoizedState=f,[m,_,!1]}function lE(f){var m=qr();return cE(m,Nn,f)}function cE(f,m,_){if(m=DS(f,m,BS)[0],f=wh(yu)[0],typeof m=="object"&&m!==null&&typeof m.then=="function")try{var M=Nl(m)}catch(ee){throw ee===Xg?Ul:ee}else M=m;m=qr();var B=m.queue,N=B.dispatch;return _!==m.memoizedState&&(Wi.flags|=2048,Up(9,Kg(),AP.bind(null,B,_),null)),[M,N,f]}function AP(f,m){f.action=m}function uE(f){var m=qr(),_=Nn;if(_!==null)return cE(m,_,f);qr(),m=m.memoizedState,_=qr();var M=_.queue.dispatch;return _.memoizedState=f,[m,M,!1]}function Up(f,m,_,M){return f={tag:f,create:_,deps:M,inst:m,next:null},m=Wi.updateQueue,m===null&&(m=Ah(),Wi.updateQueue=m),_=m.lastEffect,_===null?m.lastEffect=f.next=f:(M=_.next,_.next=f,f.next=M,m.lastEffect=f),f}function Kg(){return{destroy:void 0,resource:void 0}}function IS(){return qr().memoizedState}function Dy(f,m,_,M){var B=Ra();M=M===void 0?null:M,Wi.flags|=f,B.memoizedState=Up(1|m,Kg(),_,M)}function Np(f,m,_,M){var B=qr();M=M===void 0?null:M;var N=B.memoizedState.inst;Nn!==null&&M!==null&&ra(M,Nn.memoizedState.deps)?B.memoizedState=Up(m,N,_,M):(Wi.flags|=f,B.memoizedState=Up(1|m,N,_,M))}function LS(f,m){Dy(8390656,8,f,m)}function US(f,m){Np(2048,8,f,m)}function Ry(f,m){return Np(4,2,f,m)}function Py(f,m){return Np(4,4,f,m)}function hE(f,m){if(typeof m=="function"){f=f();var _=m(f);return function(){typeof _=="function"?_():m(null)}}if(m!=null)return f=f(),m.current=f,function(){m.current=null}}function dE(f,m,_){_=_!=null?_.concat([f]):null,Np(4,4,hE.bind(null,m,f),_)}function NS(){}function fE(f,m){var _=qr();m=m===void 0?null:m;var M=_.memoizedState;return m!==null&&ra(m,M[1])?M[0]:(_.memoizedState=[f,m],f)}function zS(f,m){var _=qr();m=m===void 0?null:m;var M=_.memoizedState;if(m!==null&&ra(m,M[1]))return M[0];if(M=f(),Da){Le(!0);try{f()}finally{Le(!1)}}return _.memoizedState=[M,m],M}function Oy(f,m,_){return _===void 0||(gu&1073741824)!==0?f.memoizedState=m:(f.memoizedState=_,f=Xy(),Wi.lanes|=f,jl|=f,_)}function pE(f,m,_,M){return Za(_,m)?_:Ip.current!==null?(f=Oy(f,_,M),Za(f,m)||(bs=!0),f):(gu&42)===0?(bs=!0,f.memoizedState=_):(f=Xy(),Wi.lanes|=f,jl|=f,m)}function mE(f,m,_,M,B){var N=X.p;X.p=N!==0&&8>N?N:8;var ee=F.T,ce={};F.T=ce,By(f,!1,m,_);try{var Ee=B(),rt=F.S;if(rt!==null&&rt(ce,Ee),Ee!==null&&typeof Ee=="object"&&typeof Ee.then=="function"){var Tt=bP(Ee,M);Jg(f,m,Tt,Tr(f))}else Jg(f,m,M,Tr(f))}catch(Ot){Jg(f,m,{then:function(){},status:"rejected",reason:Ot},Tr())}finally{X.p=N,F.T=ee}}function wP(){}function FS(f,m,_,M){if(f.tag!==5)throw Error(n(476));var B=gE(f).queue;mE(f,B,m,W,_===null?wP:function(){return vE(f),_(M)})}function gE(f){var m=f.memoizedState;if(m!==null)return m;m={memoizedState:W,baseState:W,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:yu,lastRenderedState:W},next:null};var _={};return m.next={memoizedState:_,baseState:_,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:yu,lastRenderedState:_},next:null},f.memoizedState=m,f=f.alternate,f!==null&&(f.memoizedState=m),m}function vE(f){var m=gE(f).next.queue;Jg(f,m,{},Tr())}function VS(){return wr($S)}function yE(){return qr().memoizedState}function xE(){return qr().memoizedState}function MP(f){for(var m=f.return;m!==null;){switch(m.tag){case 24:case 3:var _=Tr();f=uc(_);var M=mu(m,f,_);M!==null&&(Ba(M,m,_),Ud(M,m,_)),m={cache:by()},f.payload=m;return}m=m.return}}function EP(f,m,_){var M=Tr();_={lane:M,revertLane:0,action:_,hasEagerState:!1,eagerState:null,next:null},Iy(f)?SE(m,_):(_=my(f,m,_,M),_!==null&&(Ba(_,f,M),To(_,m,M)))}function bE(f,m,_){var M=Tr();Jg(f,m,_,M)}function Jg(f,m,_,M){var B={lane:M,revertLane:0,action:_,hasEagerState:!1,eagerState:null,next:null};if(Iy(f))SE(m,B);else{var N=f.alternate;if(f.lanes===0&&(N===null||N.lanes===0)&&(N=m.lastRenderedReducer,N!==null))try{var ee=m.lastRenderedState,ce=N(ee,_);if(B.hasEagerState=!0,B.eagerState=ce,Za(ce,ee))return ph(f,m,B,0),Fi===null&&Ug(),!1}catch{}finally{}if(_=my(f,m,B,M),_!==null)return Ba(_,f,M),To(_,m,M),!0}return!1}function By(f,m,_,M){if(M={lane:2,revertLane:DP(),action:M,hasEagerState:!1,eagerState:null,next:null},Iy(f)){if(m)throw Error(n(479))}else m=my(f,_,M,2),m!==null&&Ba(m,f,2)}function Iy(f){var m=f.alternate;return f===Wi||m!==null&&m===Wi}function SE(f,m){_h=Ey=!0;var _=f.pending;_===null?m.next=m:(m.next=_.next,_.next=m),f.pending=m}function To(f,m,_){if((_&4194048)!==0){var M=m.lanes;M&=f.pendingLanes,_|=M,m.lanes=_,It(f,_)}}var Zg={readContext:wr,use:Cy,useCallback:Br,useContext:Br,useEffect:Br,useImperativeHandle:Br,useLayoutEffect:Br,useInsertionEffect:Br,useMemo:Br,useReducer:Br,useRef:Br,useState:Br,useDebugValue:Br,useDeferredValue:Br,useTransition:Br,useSyncExternalStore:Br,useId:Br,useHostTransitionStatus:Br,useFormState:Br,useActionState:Br,useOptimistic:Br,useMemoCache:Br,useCacheRefresh:Br},Ly={readContext:wr,use:Cy,useCallback:function(f,m){return Ra().memoizedState=[f,m===void 0?null:m],f},useContext:wr,useEffect:LS,useImperativeHandle:function(f,m,_){_=_!=null?_.concat([f]):null,Dy(4194308,4,hE.bind(null,m,f),_)},useLayoutEffect:function(f,m){return Dy(4194308,4,f,m)},useInsertionEffect:function(f,m){Dy(4,2,f,m)},useMemo:function(f,m){var _=Ra();m=m===void 0?null:m;var M=f();if(Da){Le(!0);try{f()}finally{Le(!1)}}return _.memoizedState=[M,m],M},useReducer:function(f,m,_){var M=Ra();if(_!==void 0){var B=_(m);if(Da){Le(!0);try{_(m)}finally{Le(!1)}}}else B=m;return M.memoizedState=M.baseState=B,f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:f,lastRenderedState:B},M.queue=f,f=f.dispatch=EP.bind(null,Wi,f),[M.memoizedState,f]},useRef:function(f){var m=Ra();return f={current:f},m.memoizedState=f},useState:function(f){f=PS(f);var m=f.queue,_=bE.bind(null,Wi,m);return m.dispatch=_,[f.memoizedState,_]},useDebugValue:NS,useDeferredValue:function(f,m){var _=Ra();return Oy(_,f,m)},useTransition:function(){var f=PS(!1);return f=mE.bind(null,Wi,f.queue,!0,!1),Ra().memoizedState=f,[!1,f]},useSyncExternalStore:function(f,m,_){var M=Wi,B=Ra();if(wn){if(_===void 0)throw Error(n(407));_=_()}else{if(_=m(),Fi===null)throw Error(n(349));(pi&124)!==0||Lp(M,m,_)}B.memoizedState=_;var N={value:_,getSnapshot:m};return B.queue=N,LS($M.bind(null,M,N,f),[f]),M.flags|=2048,Up(9,Kg(),ZM.bind(null,M,N,_,m),null),_},useId:function(){var f=Ra(),m=Fi.identifierPrefix;if(wn){var _=lc,M=oc;_=(M&~(1<<32-st(M)-1)).toString(32)+_,m=""+m+"R"+_,_=is++,0<_&&(m+="H"+_.toString(32)),m+=""}else _=YM++,m=""+m+"r"+_.toString(32)+"";return f.memoizedState=m},useHostTransitionStatus:VS,useFormState:oE,useActionState:oE,useOptimistic:function(f){var m=Ra();m.memoizedState=m.baseState=f;var _={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return m.queue=_,m=By.bind(null,Wi,!0,_),_.dispatch=m,[f,m]},useMemoCache:CS,useCacheRefresh:function(){return Ra().memoizedState=MP.bind(null,Wi)}},HS={readContext:wr,use:Cy,useCallback:fE,useContext:wr,useEffect:US,useImperativeHandle:dE,useInsertionEffect:Ry,useLayoutEffect:Py,useMemo:zS,useReducer:wh,useRef:IS,useState:function(){return wh(yu)},useDebugValue:NS,useDeferredValue:function(f,m){var _=qr();return pE(_,Nn.memoizedState,f,m)},useTransition:function(){var f=wh(yu)[0],m=qr().memoizedState;return[typeof f=="boolean"?f:Nl(f),m]},useSyncExternalStore:JM,useId:yE,useHostTransitionStatus:VS,useFormState:lE,useActionState:lE,useOptimistic:function(f,m){var _=qr();return iE(_,Nn,f,m)},useMemoCache:CS,useCacheRefresh:xE},_E={readContext:wr,use:Cy,useCallback:fE,useContext:wr,useEffect:US,useImperativeHandle:dE,useInsertionEffect:Ry,useLayoutEffect:Py,useMemo:zS,useReducer:RS,useRef:IS,useState:function(){return RS(yu)},useDebugValue:NS,useDeferredValue:function(f,m){var _=qr();return Nn===null?Oy(_,f,m):pE(_,Nn.memoizedState,f,m)},useTransition:function(){var f=RS(yu)[0],m=qr().memoizedState;return[typeof f=="boolean"?f:Nl(f),m]},useSyncExternalStore:JM,useId:yE,useHostTransitionStatus:VS,useFormState:uE,useActionState:uE,useOptimistic:function(f,m){var _=qr();return Nn!==null?iE(_,Nn,f,m):(_.baseState=f,[f,_.queue.dispatch])},useMemoCache:CS,useCacheRefresh:xE},Nd=null,$g=0;function ev(f){var m=$g;return $g+=1,Nd===null&&(Nd=[]),wy(Nd,f,m)}function zp(f,m){m=m.props.ref,f.ref=m!==void 0?m:null}function Uy(f,m){throw m.$$typeof===h?Error(n(525)):(f=Object.prototype.toString.call(m),Error(n(31,f==="[object Object]"?"object with keys {"+Object.keys(m).join(", ")+"}":f)))}function AE(f){var m=f._init;return m(f._payload)}function wE(f){function m(qe,Fe){if(f){var tt=qe.deletions;tt===null?(qe.deletions=[Fe],qe.flags|=16):tt.push(Fe)}}function _(qe,Fe){if(!f)return null;for(;Fe!==null;)m(qe,Fe),Fe=Fe.sibling;return null}function M(qe){for(var Fe=new Map;qe!==null;)qe.key!==null?Fe.set(qe.key,qe):Fe.set(qe.index,qe),qe=qe.sibling;return Fe}function B(qe,Fe){return qe=Or(qe,Fe),qe.index=0,qe.sibling=null,qe}function N(qe,Fe,tt){return qe.index=tt,f?(tt=qe.alternate,tt!==null?(tt=tt.index,tt<Fe?(qe.flags|=67108866,Fe):tt):(qe.flags|=67108866,Fe)):(qe.flags|=1048576,Fe)}function ee(qe){return f&&qe.alternate===null&&(qe.flags|=67108866),qe}function ce(qe,Fe,tt,Pt){return Fe===null||Fe.tag!==6?(Fe=zg(tt,qe.mode,Pt),Fe.return=qe,Fe):(Fe=B(Fe,tt),Fe.return=qe,Fe)}function Ee(qe,Fe,tt,Pt){var ni=tt.type;return ni===g?Tt(qe,Fe,tt.props.children,Pt,tt.key):Fe!==null&&(Fe.elementType===ni||typeof ni=="object"&&ni!==null&&ni.$$typeof===R&&AE(ni)===Fe.type)?(Fe=B(Fe,tt.props),zp(Fe,tt),Fe.return=qe,Fe):(Fe=xs(tt.type,tt.key,tt.props,null,qe.mode,Pt),zp(Fe,tt),Fe.return=qe,Fe)}function rt(qe,Fe,tt,Pt){return Fe===null||Fe.tag!==4||Fe.stateNode.containerInfo!==tt.containerInfo||Fe.stateNode.implementation!==tt.implementation?(Fe=gy(tt,qe.mode,Pt),Fe.return=qe,Fe):(Fe=B(Fe,tt.children||[]),Fe.return=qe,Fe)}function Tt(qe,Fe,tt,Pt,ni){return Fe===null||Fe.tag!==7?(Fe=gh(tt,qe.mode,Pt,ni),Fe.return=qe,Fe):(Fe=B(Fe,tt),Fe.return=qe,Fe)}function Ot(qe,Fe,tt){if(typeof Fe=="string"&&Fe!==""||typeof Fe=="number"||typeof Fe=="bigint")return Fe=zg(""+Fe,qe.mode,tt),Fe.return=qe,Fe;if(typeof Fe=="object"&&Fe!==null){switch(Fe.$$typeof){case d:return tt=xs(Fe.type,Fe.key,Fe.props,null,qe.mode,tt),zp(tt,Fe),tt.return=qe,tt;case p:return Fe=gy(Fe,qe.mode,tt),Fe.return=qe,Fe;case R:var Pt=Fe._init;return Fe=Pt(Fe._payload),Ot(qe,Fe,tt)}if(J(Fe)||H(Fe))return Fe=gh(Fe,qe.mode,tt,null),Fe.return=qe,Fe;if(typeof Fe.then=="function")return Ot(qe,ev(Fe),tt);if(Fe.$$typeof===w)return Ot(qe,Gg(qe,Fe),tt);Uy(qe,Fe)}return null}function ht(qe,Fe,tt,Pt){var ni=Fe!==null?Fe.key:null;if(typeof tt=="string"&&tt!==""||typeof tt=="number"||typeof tt=="bigint")return ni!==null?null:ce(qe,Fe,""+tt,Pt);if(typeof tt=="object"&&tt!==null){switch(tt.$$typeof){case d:return tt.key===ni?Ee(qe,Fe,tt,Pt):null;case p:return tt.key===ni?rt(qe,Fe,tt,Pt):null;case R:return ni=tt._init,tt=ni(tt._payload),ht(qe,Fe,tt,Pt)}if(J(tt)||H(tt))return ni!==null?null:Tt(qe,Fe,tt,Pt,null);if(typeof tt.then=="function")return ht(qe,Fe,ev(tt),Pt);if(tt.$$typeof===w)return ht(qe,Fe,Gg(qe,tt),Pt);Uy(qe,tt)}return null}function dt(qe,Fe,tt,Pt,ni){if(typeof Pt=="string"&&Pt!==""||typeof Pt=="number"||typeof Pt=="bigint")return qe=qe.get(tt)||null,ce(Fe,qe,""+Pt,ni);if(typeof Pt=="object"&&Pt!==null){switch(Pt.$$typeof){case d:return qe=qe.get(Pt.key===null?tt:Pt.key)||null,Ee(Fe,qe,Pt,ni);case p:return qe=qe.get(Pt.key===null?tt:Pt.key)||null,rt(Fe,qe,Pt,ni);case R:var ln=Pt._init;return Pt=ln(Pt._payload),dt(qe,Fe,tt,Pt,ni)}if(J(Pt)||H(Pt))return qe=qe.get(tt)||null,Tt(Fe,qe,Pt,ni,null);if(typeof Pt.then=="function")return dt(qe,Fe,tt,ev(Pt),ni);if(Pt.$$typeof===w)return dt(qe,Fe,tt,Gg(Fe,Pt),ni);Uy(Fe,Pt)}return null}function Li(qe,Fe,tt,Pt){for(var ni=null,ln=null,ui=Fe,Oi=Fe=0,oa=null;ui!==null&&Oi<tt.length;Oi++){ui.index>Oi?(oa=ui,ui=null):oa=ui.sibling;var Ln=ht(qe,ui,tt[Oi],Pt);if(Ln===null){ui===null&&(ui=oa);break}f&&ui&&Ln.alternate===null&&m(qe,ui),Fe=N(Ln,Fe,Oi),ln===null?ni=Ln:ln.sibling=Ln,ln=Ln,ui=oa}if(Oi===tt.length)return _(qe,ui),wn&&hu(qe,Oi),ni;if(ui===null){for(;Oi<tt.length;Oi++)ui=Ot(qe,tt[Oi],Pt),ui!==null&&(Fe=N(ui,Fe,Oi),ln===null?ni=ui:ln.sibling=ui,ln=ui);return wn&&hu(qe,Oi),ni}for(ui=M(ui);Oi<tt.length;Oi++)oa=dt(ui,qe,Oi,tt[Oi],Pt),oa!==null&&(f&&oa.alternate!==null&&ui.delete(oa.key===null?Oi:oa.key),Fe=N(oa,Fe,Oi),ln===null?ni=oa:ln.sibling=oa,ln=oa);return f&&ui.forEach(function(tm){return m(qe,tm)}),wn&&hu(qe,Oi),ni}function Ci(qe,Fe,tt,Pt){if(tt==null)throw Error(n(151));for(var ni=null,ln=null,ui=Fe,Oi=Fe=0,oa=null,Ln=tt.next();ui!==null&&!Ln.done;Oi++,Ln=tt.next()){ui.index>Oi?(oa=ui,ui=null):oa=ui.sibling;var tm=ht(qe,ui,Ln.value,Pt);if(tm===null){ui===null&&(ui=oa);break}f&&ui&&tm.alternate===null&&m(qe,ui),Fe=N(tm,Fe,Oi),ln===null?ni=tm:ln.sibling=tm,ln=tm,ui=oa}if(Ln.done)return _(qe,ui),wn&&hu(qe,Oi),ni;if(ui===null){for(;!Ln.done;Oi++,Ln=tt.next())Ln=Ot(qe,Ln.value,Pt),Ln!==null&&(Fe=N(Ln,Fe,Oi),ln===null?ni=Ln:ln.sibling=Ln,ln=Ln);return wn&&hu(qe,Oi),ni}for(ui=M(ui);!Ln.done;Oi++,Ln=tt.next())Ln=dt(ui,qe,Oi,Ln.value,Pt),Ln!==null&&(f&&Ln.alternate!==null&&ui.delete(Ln.key===null?Oi:Ln.key),Fe=N(Ln,Fe,Oi),ln===null?ni=Ln:ln.sibling=Ln,ln=Ln);return f&&ui.forEach(function(Lne){return m(qe,Lne)}),wn&&hu(qe,Oi),ni}function ar(qe,Fe,tt,Pt){if(typeof tt=="object"&&tt!==null&&tt.type===g&&tt.key===null&&(tt=tt.props.children),typeof tt=="object"&&tt!==null){switch(tt.$$typeof){case d:e:{for(var ni=tt.key;Fe!==null;){if(Fe.key===ni){if(ni=tt.type,ni===g){if(Fe.tag===7){_(qe,Fe.sibling),Pt=B(Fe,tt.props.children),Pt.return=qe,qe=Pt;break e}}else if(Fe.elementType===ni||typeof ni=="object"&&ni!==null&&ni.$$typeof===R&&AE(ni)===Fe.type){_(qe,Fe.sibling),Pt=B(Fe,tt.props),zp(Pt,tt),Pt.return=qe,qe=Pt;break e}_(qe,Fe);break}else m(qe,Fe);Fe=Fe.sibling}tt.type===g?(Pt=gh(tt.props.children,qe.mode,Pt,tt.key),Pt.return=qe,qe=Pt):(Pt=xs(tt.type,tt.key,tt.props,null,qe.mode,Pt),zp(Pt,tt),Pt.return=qe,qe=Pt)}return ee(qe);case p:e:{for(ni=tt.key;Fe!==null;){if(Fe.key===ni)if(Fe.tag===4&&Fe.stateNode.containerInfo===tt.containerInfo&&Fe.stateNode.implementation===tt.implementation){_(qe,Fe.sibling),Pt=B(Fe,tt.children||[]),Pt.return=qe,qe=Pt;break e}else{_(qe,Fe);break}else m(qe,Fe);Fe=Fe.sibling}Pt=gy(tt,qe.mode,Pt),Pt.return=qe,qe=Pt}return ee(qe);case R:return ni=tt._init,tt=ni(tt._payload),ar(qe,Fe,tt,Pt)}if(J(tt))return Li(qe,Fe,tt,Pt);if(H(tt)){if(ni=H(tt),typeof ni!="function")throw Error(n(150));return tt=ni.call(tt),Ci(qe,Fe,tt,Pt)}if(typeof tt.then=="function")return ar(qe,Fe,ev(tt),Pt);if(tt.$$typeof===w)return ar(qe,Fe,Gg(qe,tt),Pt);Uy(qe,tt)}return typeof tt=="string"&&tt!==""||typeof tt=="number"||typeof tt=="bigint"?(tt=""+tt,Fe!==null&&Fe.tag===6?(_(qe,Fe.sibling),Pt=B(Fe,tt),Pt.return=qe,qe=Pt):(_(qe,Fe),Pt=zg(tt,qe.mode,Pt),Pt.return=qe,qe=Pt),ee(qe)):_(qe,Fe)}return function(qe,Fe,tt,Pt){try{$g=0;var ni=ar(qe,Fe,tt,Pt);return Nd=null,ni}catch(ui){if(ui===Xg||ui===Ul)throw ui;var ln=to(29,ui,null,qe.mode);return ln.lanes=Pt,ln.return=qe,ln}finally{}}}var zd=wE(!0),ME=wE(!1),Xn=$(null),zl=null;function Mh(f){var m=f.alternate;fe(Ir,Ir.current&1),fe(Xn,f),zl===null&&(m===null||Ip.current!==null||m.memoizedState!==null)&&(zl=f)}function EE(f){if(f.tag===22){if(fe(Ir,Ir.current),fe(Xn,f),zl===null){var m=f.alternate;m!==null&&m.memoizedState!==null&&(zl=f)}}else Eh()}function Eh(){fe(Ir,Ir.current),fe(Xn,Xn.current)}function hc(f){se(Xn),zl===f&&(zl=null),se(Ir)}var Ir=$(0);function xu(f){for(var m=f;m!==null;){if(m.tag===13){var _=m.memoizedState;if(_!==null&&(_=_.dehydrated,_===null||_.data==="$?"||HP(_)))return m}else if(m.tag===19&&m.memoizedProps.revealOrder!==void 0){if((m.flags&128)!==0)return m}else if(m.child!==null){m.child.return=m,m=m.child;continue}if(m===f)break;for(;m.sibling===null;){if(m.return===null||m.return===f)return null;m=m.return}m.sibling.return=m.return,m=m.sibling}return null}function Th(f,m,_,M){m=f.memoizedState,_=_(M,m),_=_==null?m:u({},m,_),f.memoizedState=_,f.lanes===0&&(f.updateQueue.baseState=_)}var Pa={enqueueSetState:function(f,m,_){f=f._reactInternals;var M=Tr(),B=uc(M);B.payload=m,_!=null&&(B.callback=_),m=mu(f,B,M),m!==null&&(Ba(m,f,M),Ud(m,f,M))},enqueueReplaceState:function(f,m,_){f=f._reactInternals;var M=Tr(),B=uc(M);B.tag=1,B.payload=m,_!=null&&(B.callback=_),m=mu(f,B,M),m!==null&&(Ba(m,f,M),Ud(m,f,M))},enqueueForceUpdate:function(f,m){f=f._reactInternals;var _=Tr(),M=uc(_);M.tag=2,m!=null&&(M.callback=m),m=mu(f,M,_),m!==null&&(Ba(m,f,_),Ud(m,f,_))}};function TE(f,m,_,M,B,N,ee){return f=f.stateNode,typeof f.shouldComponentUpdate=="function"?f.shouldComponentUpdate(M,N,ee):m.prototype&&m.prototype.isPureReactComponent?!Il(_,M)||!Il(B,N):!0}function CE(f,m,_,M){f=m.state,typeof m.componentWillReceiveProps=="function"&&m.componentWillReceiveProps(_,M),typeof m.UNSAFE_componentWillReceiveProps=="function"&&m.UNSAFE_componentWillReceiveProps(_,M),m.state!==f&&Pa.enqueueReplaceState(m,m.state,null)}function dc(f,m){var _=m;if("ref"in m){_={};for(var M in m)M!=="ref"&&(_[M]=m[M])}if(f=f.defaultProps){_===m&&(_=u({},_));for(var B in f)_[B]===void 0&&(_[B]=f[B])}return _}var Fd=typeof reportError=="function"?reportError:function(f){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var m=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof f=="object"&&f!==null&&typeof f.message=="string"?String(f.message):String(f),error:f});if(!window.dispatchEvent(m))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",f);return}console.error(f)};function tv(f){Fd(f)}function Ny(f){console.error(f)}function DE(f){Fd(f)}function zy(f,m){try{var _=f.onUncaughtError;_(m.value,{componentStack:m.stack})}catch(M){setTimeout(function(){throw M})}}function hl(f,m,_){try{var M=f.onCaughtError;M(_.value,{componentStack:_.stack,errorBoundary:m.tag===1?m.stateNode:null})}catch(B){setTimeout(function(){throw B})}}function Fy(f,m,_){return _=uc(_),_.tag=3,_.payload={element:null},_.callback=function(){zy(f,m)},_}function RE(f){return f=uc(f),f.tag=3,f}function Vy(f,m,_,M){var B=_.type.getDerivedStateFromError;if(typeof B=="function"){var N=M.value;f.payload=function(){return B(N)},f.callback=function(){hl(m,_,M)}}var ee=_.stateNode;ee!==null&&typeof ee.componentDidCatch=="function"&&(f.callback=function(){hl(m,_,M),typeof B!="function"&&(Lo===null?Lo=new Set([this]):Lo.add(this));var ce=M.stack;this.componentDidCatch(M.value,{componentStack:ce!==null?ce:""})})}function TP(f,m,_,M,B){if(_.flags|=32768,M!==null&&typeof M=="object"&&typeof M.then=="function"){if(m=_.alternate,m!==null&&ol(m,_,B,!0),_=Xn.current,_!==null){switch(_.tag){case 13:return zl===null?v():_.alternate===null&&ur===0&&(ur=3),_.flags&=-257,_.flags|=65536,_.lanes=B,M===qg?_.flags|=16384:(m=_.updateQueue,m===null?_.updateQueue=new Set([M]):m.add(M),pt(f,M,B)),!1;case 22:return _.flags|=65536,M===qg?_.flags|=16384:(m=_.updateQueue,m===null?(m={transitions:null,markerInstances:null,retryQueue:new Set([M])},_.updateQueue=m):(_=m.retryQueue,_===null?m.retryQueue=new Set([M]):_.add(M)),pt(f,M,B)),!1}throw Error(n(435,_.tag))}return pt(f,M,B),v(),!1}if(wn)return m=Xn.current,m!==null?((m.flags&65536)===0&&(m.flags|=256),m.flags|=65536,m.lanes=B,M!==yy&&(f=Error(n(422),{cause:M}),Ld(Ns(f,_)))):(M!==yy&&(m=Error(n(423),{cause:M}),Ld(Ns(m,_))),f=f.current.alternate,f.flags|=65536,B&=-B,f.lanes|=B,M=Ns(M,_),B=Fy(f.stateNode,M,B),Pp(f,B),ur!==4&&(ur=2)),!1;var N=Error(n(520),{cause:M});if(N=Ns(N,_),In===null?In=[N]:In.push(N),ur!==4&&(ur=2),m===null)return!0;M=Ns(M,_),_=m;do{switch(_.tag){case 3:return _.flags|=65536,f=B&-B,_.lanes|=f,f=Fy(_.stateNode,M,f),Pp(_,f),!1;case 1:if(m=_.type,N=_.stateNode,(_.flags&128)===0&&(typeof m.getDerivedStateFromError=="function"||N!==null&&typeof N.componentDidCatch=="function"&&(Lo===null||!Lo.has(N))))return _.flags|=65536,B&=-B,_.lanes|=B,B=RE(B),Vy(B,f,_,M),Pp(_,B),!1}_=_.return}while(_!==null);return!1}var PE=Error(n(461)),bs=!1;function Lr(f,m,_,M){m.child=f===null?ME(m,null,_,M):zd(m,f.child,_,M)}function no(f,m,_,M,B){_=_.render;var N=m.ref;if("ref"in M){var ee={};for(var ce in M)ce!=="ref"&&(ee[ce]=M[ce])}else ee=M;return cc(m),M=vu(f,m,_,ee,N,B),ce=ES(),f!==null&&!bs?(Ty(f,m,B),Ss(f,m,B)):(wn&&ce&&mS(m),m.flags|=1,Lr(f,m,M,B),m.child)}function ro(f,m,_,M,B){if(f===null){var N=_.type;return typeof N=="function"&&!Ng(N)&&N.defaultProps===void 0&&_.compare===null?(m.tag=15,m.type=N,GS(f,m,N,M,B)):(f=xs(_.type,null,M,m,m.mode,B),f.ref=m.ref,f.return=m,m.child=f)}if(N=f.child,!iv(f,B)){var ee=N.memoizedProps;if(_=_.compare,_=_!==null?_:Il,_(ee,M)&&f.ref===m.ref)return Ss(f,m,B)}return m.flags|=1,f=Or(N,M),f.ref=m.ref,f.return=m,m.child=f}function GS(f,m,_,M,B){if(f!==null){var N=f.memoizedProps;if(Il(N,M)&&f.ref===m.ref)if(bs=!1,m.pendingProps=M=N,iv(f,B))(f.flags&131072)!==0&&(bs=!0);else return m.lanes=f.lanes,Ss(f,m,B)}return Fp(f,m,_,M,B)}function Vd(f,m,_){var M=m.pendingProps,B=M.children,N=f!==null?f.memoizedState:null;if(M.mode==="hidden"){if((m.flags&128)!==0){if(M=N!==null?N.baseLanes|_:_,f!==null){for(B=m.child=f.child,N=0;B!==null;)N=N|B.lanes|B.childLanes,B=B.sibling;m.childLanes=N&~M}else m.childLanes=0,m.child=null;return Hd(f,m,M,_)}if((_&536870912)!==0)m.memoizedState={baseLanes:0,cachePool:null},f!==null&&Wg(m,N!==null?N.cachePool:null),N!==null?qM(m,N):MS(),EE(m);else return m.lanes=m.childLanes=536870912,Hd(f,m,N!==null?N.baseLanes|_:_,_)}else N!==null?(Wg(m,N.cachePool),qM(m,N),Eh(),m.memoizedState=null):(f!==null&&Wg(m,null),MS(),Eh());return Lr(f,m,B,_),m.child}function Hd(f,m,_,M){var B=Sh();return B=B===null?null:{parent:Wr._currentValue,pool:B},m.memoizedState={baseLanes:_,cachePool:B},f!==null&&Wg(m,null),MS(),EE(m),f!==null&&ol(f,m,M,!0),null}function Gd(f,m){var _=m.ref;if(_===null)f!==null&&f.ref!==null&&(m.flags|=4194816);else{if(typeof _!="function"&&typeof _!="object")throw Error(n(284));(f===null||f.ref!==_)&&(m.flags|=4194816)}}function Fp(f,m,_,M,B){return cc(m),_=vu(f,m,_,M,void 0,B),M=ES(),f!==null&&!bs?(Ty(f,m,B),Ss(f,m,B)):(wn&&M&&mS(m),m.flags|=1,Lr(f,m,_,B),m.child)}function Co(f,m,_,M,B,N){return cc(m),m.updateQueue=null,_=KM(m,M,_,B),QM(f),M=ES(),f!==null&&!bs?(Ty(f,m,N),Ss(f,m,N)):(wn&&M&&mS(m),m.flags|=1,Lr(f,m,_,N),m.child)}function Do(f,m,_,M,B){if(cc(m),m.stateNode===null){var N=mh,ee=_.contextType;typeof ee=="object"&&ee!==null&&(N=wr(ee)),N=new _(M,N),m.memoizedState=N.state!==null&&N.state!==void 0?N.state:null,N.updater=Pa,m.stateNode=N,N._reactInternals=m,N=m.stateNode,N.props=M,N.state=m.memoizedState,N.refs={},AS(m),ee=_.contextType,N.context=typeof ee=="object"&&ee!==null?wr(ee):mh,N.state=m.memoizedState,ee=_.getDerivedStateFromProps,typeof ee=="function"&&(Th(m,_,ee,M),N.state=m.memoizedState),typeof _.getDerivedStateFromProps=="function"||typeof N.getSnapshotBeforeUpdate=="function"||typeof N.UNSAFE_componentWillMount!="function"&&typeof N.componentWillMount!="function"||(ee=N.state,typeof N.componentWillMount=="function"&&N.componentWillMount(),typeof N.UNSAFE_componentWillMount=="function"&&N.UNSAFE_componentWillMount(),ee!==N.state&&Pa.enqueueReplaceState(N,N.state,null),Op(m,M,N,B),Yg(),N.state=m.memoizedState),typeof N.componentDidMount=="function"&&(m.flags|=4194308),M=!0}else if(f===null){N=m.stateNode;var ce=m.memoizedProps,Ee=dc(_,ce);N.props=Ee;var rt=N.context,Tt=_.contextType;ee=mh,typeof Tt=="object"&&Tt!==null&&(ee=wr(Tt));var Ot=_.getDerivedStateFromProps;Tt=typeof Ot=="function"||typeof N.getSnapshotBeforeUpdate=="function",ce=m.pendingProps!==ce,Tt||typeof N.UNSAFE_componentWillReceiveProps!="function"&&typeof N.componentWillReceiveProps!="function"||(ce||rt!==ee)&&CE(m,N,M,ee),pu=!1;var ht=m.memoizedState;N.state=ht,Op(m,M,N,B),Yg(),rt=m.memoizedState,ce||ht!==rt||pu?(typeof Ot=="function"&&(Th(m,_,Ot,M),rt=m.memoizedState),(Ee=pu||TE(m,_,Ee,M,ht,rt,ee))?(Tt||typeof N.UNSAFE_componentWillMount!="function"&&typeof N.componentWillMount!="function"||(typeof N.componentWillMount=="function"&&N.componentWillMount(),typeof N.UNSAFE_componentWillMount=="function"&&N.UNSAFE_componentWillMount()),typeof N.componentDidMount=="function"&&(m.flags|=4194308)):(typeof N.componentDidMount=="function"&&(m.flags|=4194308),m.memoizedProps=M,m.memoizedState=rt),N.props=M,N.state=rt,N.context=ee,M=Ee):(typeof N.componentDidMount=="function"&&(m.flags|=4194308),M=!1)}else{N=m.stateNode,Bi(f,m),ee=m.memoizedProps,Tt=dc(_,ee),N.props=Tt,Ot=m.pendingProps,ht=N.context,rt=_.contextType,Ee=mh,typeof rt=="object"&&rt!==null&&(Ee=wr(rt)),ce=_.getDerivedStateFromProps,(rt=typeof ce=="function"||typeof N.getSnapshotBeforeUpdate=="function")||typeof N.UNSAFE_componentWillReceiveProps!="function"&&typeof N.componentWillReceiveProps!="function"||(ee!==Ot||ht!==Ee)&&CE(m,N,M,Ee),pu=!1,ht=m.memoizedState,N.state=ht,Op(m,M,N,B),Yg();var dt=m.memoizedState;ee!==Ot||ht!==dt||pu||f!==null&&f.dependencies!==null&&Hg(f.dependencies)?(typeof ce=="function"&&(Th(m,_,ce,M),dt=m.memoizedState),(Tt=pu||TE(m,_,Tt,M,ht,dt,Ee)||f!==null&&f.dependencies!==null&&Hg(f.dependencies))?(rt||typeof N.UNSAFE_componentWillUpdate!="function"&&typeof N.componentWillUpdate!="function"||(typeof N.componentWillUpdate=="function"&&N.componentWillUpdate(M,dt,Ee),typeof N.UNSAFE_componentWillUpdate=="function"&&N.UNSAFE_componentWillUpdate(M,dt,Ee)),typeof N.componentDidUpdate=="function"&&(m.flags|=4),typeof N.getSnapshotBeforeUpdate=="function"&&(m.flags|=1024)):(typeof N.componentDidUpdate!="function"||ee===f.memoizedProps&&ht===f.memoizedState||(m.flags|=4),typeof N.getSnapshotBeforeUpdate!="function"||ee===f.memoizedProps&&ht===f.memoizedState||(m.flags|=1024),m.memoizedProps=M,m.memoizedState=dt),N.props=M,N.state=dt,N.context=Ee,M=Tt):(typeof N.componentDidUpdate!="function"||ee===f.memoizedProps&&ht===f.memoizedState||(m.flags|=4),typeof N.getSnapshotBeforeUpdate!="function"||ee===f.memoizedProps&&ht===f.memoizedState||(m.flags|=1024),M=!1)}return N=M,Gd(f,m),M=(m.flags&128)!==0,N||M?(N=m.stateNode,_=M&&typeof _.getDerivedStateFromError!="function"?null:N.render(),m.flags|=1,f!==null&&M?(m.child=zd(m,f.child,null,B),m.child=zd(m,null,_,B)):Lr(f,m,_,B),m.memoizedState=N.state,f=m.child):f=Ss(f,m,B),f}function Ch(f,m,_,M){return Ep(),m.flags|=256,Lr(f,m,_,M),m.child}var Fl={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Vl(f){return{baseLanes:f,cachePool:_y()}}function ns(f,m,_){return f=f!==null?f.childLanes&~_:0,m&&(f|=gl),f}function Vp(f,m,_){var M=m.pendingProps,B=!1,N=(m.flags&128)!==0,ee;if((ee=N)||(ee=f!==null&&f.memoizedState===null?!1:(Ir.current&2)!==0),ee&&(B=!0,m.flags&=-129),ee=(m.flags&32)!==0,m.flags&=-33,f===null){if(wn){if(B?Mh(m):Eh(),wn){var ce=br,Ee;if(Ee=ce){e:{for(Ee=ce,ce=Mo;Ee.nodeType!==8;){if(!ce){ce=null;break e}if(Ee=Mu(Ee.nextSibling),Ee===null){ce=null;break e}}ce=Ee}ce!==null?(m.memoizedState={dehydrated:ce,treeContext:vh!==null?{id:oc,overflow:lc}:null,retryLane:536870912,hydrationErrors:null},Ee=to(18,null,null,0),Ee.stateNode=ce,Ee.return=m,m.child=Ee,Ca=m,br=null,Ee=!0):Ee=!1}Ee||yh(m)}if(ce=m.memoizedState,ce!==null&&(ce=ce.dehydrated,ce!==null))return HP(ce)?m.lanes=32:m.lanes=536870912,null;hc(m)}return ce=M.children,M=M.fallback,B?(Eh(),B=m.mode,ce=kd({mode:"hidden",children:ce},B),M=gh(M,B,_,null),ce.return=m,M.return=m,ce.sibling=M,m.child=ce,B=m.child,B.memoizedState=Vl(_),B.childLanes=ns(f,ee,_),m.memoizedState=Fl,M):(Mh(m),fc(m,ce))}if(Ee=f.memoizedState,Ee!==null&&(ce=Ee.dehydrated,ce!==null)){if(N)m.flags&256?(Mh(m),m.flags&=-257,m=Vs(f,m,_)):m.memoizedState!==null?(Eh(),m.child=f.child,m.flags|=128,m=null):(Eh(),B=M.fallback,ce=m.mode,M=kd({mode:"visible",children:M.children},ce),B=gh(B,ce,_,null),B.flags|=2,M.return=m,B.return=m,M.sibling=B,m.child=M,zd(m,f.child,null,_),M=m.child,M.memoizedState=Vl(_),M.childLanes=ns(f,ee,_),m.memoizedState=Fl,m=B);else if(Mh(m),HP(ce)){if(ee=ce.nextSibling&&ce.nextSibling.dataset,ee)var rt=ee.dgst;ee=rt,M=Error(n(419)),M.stack="",M.digest=ee,Ld({value:M,source:null,stack:null}),m=Vs(f,m,_)}else if(bs||ol(f,m,_,!1),ee=(_&f.childLanes)!==0,bs||ee){if(ee=Fi,ee!==null&&(M=_&-_,M=(M&42)!==0?1:Vt(M),M=(M&(ee.suspendedLanes|_))!==0?0:M,M!==0&&M!==Ee.retryLane))throw Ee.retryLane=M,uu(f,M),Ba(ee,f,M),PE;ce.data==="$?"||v(),m=Vs(f,m,_)}else ce.data==="$?"?(m.flags|=192,m.child=f.child,m=null):(f=Ee.treeContext,br=Mu(ce.nextSibling),Ca=m,wn=!0,al=null,Mo=!1,f!==null&&(zs[wo++]=oc,zs[wo++]=lc,zs[wo++]=vh,oc=f.id,lc=f.overflow,vh=m),m=fc(m,M.children),m.flags|=4096);return m}return B?(Eh(),B=M.fallback,ce=m.mode,Ee=f.child,rt=Ee.sibling,M=Or(Ee,{mode:"hidden",children:M.children}),M.subtreeFlags=Ee.subtreeFlags&65011712,rt!==null?B=Or(rt,B):(B=gh(B,ce,_,null),B.flags|=2),B.return=m,M.return=m,M.sibling=B,m.child=M,M=B,B=m.child,ce=f.child.memoizedState,ce===null?ce=Vl(_):(Ee=ce.cachePool,Ee!==null?(rt=Wr._currentValue,Ee=Ee.parent!==rt?{parent:rt,pool:rt}:Ee):Ee=_y(),ce={baseLanes:ce.baseLanes|_,cachePool:Ee}),B.memoizedState=ce,B.childLanes=ns(f,ee,_),m.memoizedState=Fl,M):(Mh(m),_=f.child,f=_.sibling,_=Or(_,{mode:"visible",children:M.children}),_.return=m,_.sibling=null,f!==null&&(ee=m.deletions,ee===null?(m.deletions=[f],m.flags|=16):ee.push(f)),m.child=_,m.memoizedState=null,_)}function fc(f,m){return m=kd({mode:"visible",children:m},f.mode),m.return=f,f.child=m}function kd(f,m){return f=to(22,f,null,m),f.lanes=0,f.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},f}function Vs(f,m,_){return zd(m,f.child,null,_),f=fc(m,m.pendingProps.children),f.flags|=2,m.memoizedState=null,f}function Hs(f,m,_){f.lanes|=m;var M=f.alternate;M!==null&&(M.lanes|=m),xS(f.return,m,_)}function pn(f,m,_,M,B){var N=f.memoizedState;N===null?f.memoizedState={isBackwards:m,rendering:null,renderingStartTime:0,last:M,tail:_,tailMode:B}:(N.isBackwards=m,N.rendering=null,N.renderingStartTime=0,N.last=M,N.tail=_,N.tailMode=B)}function dl(f,m,_){var M=m.pendingProps,B=M.revealOrder,N=M.tail;if(Lr(f,m,M.children,_),M=Ir.current,(M&2)!==0)M=M&1|2,m.flags|=128;else{if(f!==null&&(f.flags&128)!==0)e:for(f=m.child;f!==null;){if(f.tag===13)f.memoizedState!==null&&Hs(f,_,m);else if(f.tag===19)Hs(f,_,m);else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===m)break e;for(;f.sibling===null;){if(f.return===null||f.return===m)break e;f=f.return}f.sibling.return=f.return,f=f.sibling}M&=1}switch(fe(Ir,M),B){case"forwards":for(_=m.child,B=null;_!==null;)f=_.alternate,f!==null&&xu(f)===null&&(B=_),_=_.sibling;_=B,_===null?(B=m.child,m.child=null):(B=_.sibling,_.sibling=null),pn(m,!1,B,_,N);break;case"backwards":for(_=null,B=m.child,m.child=null;B!==null;){if(f=B.alternate,f!==null&&xu(f)===null){m.child=B;break}f=B.sibling,B.sibling=_,_=B,B=f}pn(m,!0,_,null,N);break;case"together":pn(m,!1,null,null,void 0);break;default:m.memoizedState=null}return m.child}function Ss(f,m,_){if(f!==null&&(m.dependencies=f.dependencies),jl|=m.lanes,(_&m.childLanes)===0)if(f!==null){if(ol(f,m,_,!1),(_&m.childLanes)===0)return null}else return null;if(f!==null&&m.child!==f.child)throw Error(n(153));if(m.child!==null){for(f=m.child,_=Or(f,f.pendingProps),m.child=_,_.return=m;f.sibling!==null;)f=f.sibling,_=_.sibling=Or(f,f.pendingProps),_.return=m;_.sibling=null}return m.child}function iv(f,m){return(f.lanes&m)!==0?!0:(f=f.dependencies,!!(f!==null&&Hg(f)))}function fl(f,m,_){switch(m.tag){case 3:be(m,m.stateNode.containerInfo),bh(m,Wr,f.memoizedState.cache),Ep();break;case 27:case 5:Me(m);break;case 4:be(m,m.stateNode.containerInfo);break;case 10:bh(m,m.type,m.memoizedProps.value);break;case 13:var M=m.memoizedState;if(M!==null)return M.dehydrated!==null?(Mh(m),m.flags|=128,null):(_&m.child.childLanes)!==0?Vp(f,m,_):(Mh(m),f=Ss(f,m,_),f!==null?f.sibling:null);Mh(m);break;case 19:var B=(f.flags&128)!==0;if(M=(_&m.childLanes)!==0,M||(ol(f,m,_,!1),M=(_&m.childLanes)!==0),B){if(M)return dl(f,m,_);m.flags|=128}if(B=m.memoizedState,B!==null&&(B.rendering=null,B.tail=null,B.lastEffect=null),fe(Ir,Ir.current),M)break;return null;case 22:case 23:return m.lanes=0,Vd(f,m,_);case 24:bh(m,Wr,f.memoizedState.cache)}return Ss(f,m,_)}function jd(f,m,_){if(f!==null)if(f.memoizedProps!==m.pendingProps)bs=!0;else{if(!iv(f,_)&&(m.flags&128)===0)return bs=!1,fl(f,m,_);bs=(f.flags&131072)!==0}else bs=!1,wn&&(m.flags&1048576)!==0&&vy(m,Mp,m.index);switch(m.lanes=0,m.tag){case 16:e:{f=m.pendingProps;var M=m.elementType,B=M._init;if(M=B(M._payload),m.type=M,typeof M=="function")Ng(M)?(f=dc(M,f),m.tag=1,m=Do(null,m,M,f,_)):(m.tag=0,m=Fp(null,m,M,f,_));else{if(M!=null){if(B=M.$$typeof,B===E){m.tag=11,m=no(null,m,M,f,_);break e}else if(B===I){m.tag=14,m=ro(null,m,M,f,_);break e}}throw m=j(M)||M,Error(n(306,m,""))}}return m;case 0:return Fp(f,m,m.type,m.pendingProps,_);case 1:return M=m.type,B=dc(M,m.pendingProps),Do(f,m,M,B,_);case 3:e:{if(be(m,m.stateNode.containerInfo),f===null)throw Error(n(387));M=m.pendingProps;var N=m.memoizedState;B=N.element,Bi(f,m),Op(m,M,null,_);var ee=m.memoizedState;if(M=ee.cache,bh(m,Wr,M),M!==N.cache&&Vg(m,[Wr],_,!0),Yg(),M=ee.element,N.isDehydrated)if(N={element:M,isDehydrated:!1,cache:ee.cache},m.updateQueue.baseState=N,m.memoizedState=N,m.flags&256){m=Ch(f,m,M,_);break e}else if(M!==B){B=Ns(Error(n(424)),m),Ld(B),m=Ch(f,m,M,_);break e}else{switch(f=m.stateNode.containerInfo,f.nodeType){case 9:f=f.body;break;default:f=f.nodeName==="HTML"?f.ownerDocument.body:f}for(br=Mu(f.firstChild),Ca=m,wn=!0,al=null,Mo=!0,_=ME(m,null,M,_),m.child=_;_;)_.flags=_.flags&-3|4096,_=_.sibling}else{if(Ep(),M===B){m=Ss(f,m,_);break e}Lr(f,m,M,_)}m=m.child}return m;case 26:return Gd(f,m),f===null?(_=BV(m.type,null,m.pendingProps,null))?m.memoizedState=_:wn||(_=m.type,f=m.pendingProps,M=NE(le.current).createElement(_),M[jn]=m,M[xr]=f,Ia(M,_,f),fi(M),m.stateNode=M):m.memoizedState=BV(m.type,f.memoizedProps,m.pendingProps,f.memoizedState),null;case 27:return Me(m),f===null&&wn&&(M=m.stateNode=RV(m.type,m.pendingProps,le.current),Ca=m,Mo=!0,B=br,Kp(m.type)?(GP=B,br=Mu(M.firstChild)):br=B),Lr(f,m,m.pendingProps.children,_),Gd(f,m),f===null&&(m.flags|=4194304),m.child;case 5:return f===null&&wn&&((B=M=br)&&(M=une(M,m.type,m.pendingProps,Mo),M!==null?(m.stateNode=M,Ca=m,br=Mu(M.firstChild),Mo=!1,B=!0):B=!1),B||yh(m)),Me(m),B=m.type,N=m.pendingProps,ee=f!==null?f.memoizedProps:null,M=N.children,zP(B,N)?M=null:ee!==null&&zP(B,ee)&&(m.flags|=32),m.memoizedState!==null&&(B=vu(f,m,SP,null,null,_),$S._currentValue=B),Gd(f,m),Lr(f,m,M,_),m.child;case 6:return f===null&&wn&&((f=_=br)&&(_=hne(_,m.pendingProps,Mo),_!==null?(m.stateNode=_,Ca=m,br=null,f=!0):f=!1),f||yh(m)),null;case 13:return Vp(f,m,_);case 4:return be(m,m.stateNode.containerInfo),M=m.pendingProps,f===null?m.child=zd(m,null,M,_):Lr(f,m,M,_),m.child;case 11:return no(f,m,m.type,m.pendingProps,_);case 7:return Lr(f,m,m.pendingProps,_),m.child;case 8:return Lr(f,m,m.pendingProps.children,_),m.child;case 12:return Lr(f,m,m.pendingProps.children,_),m.child;case 10:return M=m.pendingProps,bh(m,m.type,M.value),Lr(f,m,M.children,_),m.child;case 9:return B=m.type._context,M=m.pendingProps.children,cc(m),B=wr(B),M=M(B),m.flags|=1,Lr(f,m,M,_),m.child;case 14:return ro(f,m,m.type,m.pendingProps,_);case 15:return GS(f,m,m.type,m.pendingProps,_);case 19:return dl(f,m,_);case 31:return M=m.pendingProps,_=m.mode,M={mode:M.mode,children:M.children},f===null?(_=kd(M,_),_.ref=m.ref,m.child=_,_.return=m,m=_):(_=Or(f.child,M),_.ref=m.ref,m.child=_,_.return=m,m=_),m;case 22:return Vd(f,m,_);case 24:return cc(m),M=wr(Wr),f===null?(B=Sh(),B===null&&(B=Fi,N=by(),B.pooledCache=N,N.refCount++,N!==null&&(B.pooledCacheLanes|=_),B=N),m.memoizedState={parent:M,cache:B},AS(m),bh(m,Wr,B)):((f.lanes&_)!==0&&(Bi(f,m),Op(m,null,null,_),Yg()),B=f.memoizedState,N=m.memoizedState,B.parent!==M?(B={parent:M,cache:M},m.memoizedState=B,m.lanes===0&&(m.memoizedState=m.updateQueue.baseState=B),bh(m,Wr,M)):(M=N.cache,bh(m,Wr,M),M!==B.cache&&Vg(m,[Wr],_,!0))),Lr(f,m,m.pendingProps.children,_),m.child;case 29:throw m.pendingProps}throw Error(n(156,m.tag))}function Hl(f){f.flags|=4}function nv(f,m){if(m.type!=="stylesheet"||(m.state.loading&4)!==0)f.flags&=-16777217;else if(f.flags|=16777216,!zV(m)){if(m=Xn.current,m!==null&&((pi&4194048)===pi?zl!==null:(pi&62914560)!==pi&&(pi&536870912)===0||m!==zl))throw cl=qg,SS;f.flags|=8192}}function bu(f,m){m!==null&&(f.flags|=4),f.flags&16384&&(m=f.tag!==22?Ce():536870912,f.lanes|=m,xn|=m)}function Wd(f,m){if(!wn)switch(f.tailMode){case"hidden":m=f.tail;for(var _=null;m!==null;)m.alternate!==null&&(_=m),m=m.sibling;_===null?f.tail=null:_.sibling=null;break;case"collapsed":_=f.tail;for(var M=null;_!==null;)_.alternate!==null&&(M=_),_=_.sibling;M===null?m||f.tail===null?f.tail=null:f.tail.sibling=null:M.sibling=null}}function ir(f){var m=f.alternate!==null&&f.alternate.child===f.child,_=0,M=0;if(m)for(var B=f.child;B!==null;)_|=B.lanes|B.childLanes,M|=B.subtreeFlags&65011712,M|=B.flags&65011712,B.return=f,B=B.sibling;else for(B=f.child;B!==null;)_|=B.lanes|B.childLanes,M|=B.subtreeFlags,M|=B.flags,B.return=f,B=B.sibling;return f.subtreeFlags|=M,f.childLanes=_,m}function kS(f,m,_){var M=m.pendingProps;switch(gS(m),m.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ir(m),null;case 1:return ir(m),null;case 3:return _=m.stateNode,M=null,f!==null&&(M=f.memoizedState.cache),m.memoizedState.cache!==M&&(m.flags|=2048),fu(Wr),we(),_.pendingContext&&(_.context=_.pendingContext,_.pendingContext=null),(f===null||f.child===null)&&(Ll(m)?Hl(m):f===null||f.memoizedState.isDehydrated&&(m.flags&256)===0||(m.flags|=1024,On())),ir(m),null;case 26:return _=m.memoizedState,f===null?(Hl(m),_!==null?(ir(m),nv(m,_)):(ir(m),m.flags&=-16777217)):_?_!==f.memoizedState?(Hl(m),ir(m),nv(m,_)):(ir(m),m.flags&=-16777217):(f.memoizedProps!==M&&Hl(m),ir(m),m.flags&=-16777217),null;case 27:Ne(m),_=le.current;var B=m.type;if(f!==null&&m.stateNode!=null)f.memoizedProps!==M&&Hl(m);else{if(!M){if(m.stateNode===null)throw Error(n(166));return ir(m),null}f=te.current,Ll(m)?kM(m):(f=RV(B,M,_),m.stateNode=f,Hl(m))}return ir(m),null;case 5:if(Ne(m),_=m.type,f!==null&&m.stateNode!=null)f.memoizedProps!==M&&Hl(m);else{if(!M){if(m.stateNode===null)throw Error(n(166));return ir(m),null}if(f=te.current,Ll(m))kM(m);else{switch(B=NE(le.current),f){case 1:f=B.createElementNS("http://www.w3.org/2000/svg",_);break;case 2:f=B.createElementNS("http://www.w3.org/1998/Math/MathML",_);break;default:switch(_){case"svg":f=B.createElementNS("http://www.w3.org/2000/svg",_);break;case"math":f=B.createElementNS("http://www.w3.org/1998/Math/MathML",_);break;case"script":f=B.createElement("div"),f.innerHTML="<script><\/script>",f=f.removeChild(f.firstChild);break;case"select":f=typeof M.is=="string"?B.createElement("select",{is:M.is}):B.createElement("select"),M.multiple?f.multiple=!0:M.size&&(f.size=M.size);break;default:f=typeof M.is=="string"?B.createElement(_,{is:M.is}):B.createElement(_)}}f[jn]=m,f[xr]=M;e:for(B=m.child;B!==null;){if(B.tag===5||B.tag===6)f.appendChild(B.stateNode);else if(B.tag!==4&&B.tag!==27&&B.child!==null){B.child.return=B,B=B.child;continue}if(B===m)break e;for(;B.sibling===null;){if(B.return===null||B.return===m)break e;B=B.return}B.sibling.return=B.return,B=B.sibling}m.stateNode=f;e:switch(Ia(f,_,M),_){case"button":case"input":case"select":case"textarea":f=!!M.autoFocus;break e;case"img":f=!0;break e;default:f=!1}f&&Hl(m)}}return ir(m),m.flags&=-16777217,null;case 6:if(f&&m.stateNode!=null)f.memoizedProps!==M&&Hl(m);else{if(typeof M!="string"&&m.stateNode===null)throw Error(n(166));if(f=le.current,Ll(m)){if(f=m.stateNode,_=m.memoizedProps,M=null,B=Ca,B!==null)switch(B.tag){case 27:case 5:M=B.memoizedProps}f[jn]=m,f=!!(f.nodeValue===_||M!==null&&M.suppressHydrationWarning===!0||AV(f.nodeValue,_)),f||yh(m)}else f=NE(f).createTextNode(M),f[jn]=m,m.stateNode=f}return ir(m),null;case 13:if(M=m.memoizedState,f===null||f.memoizedState!==null&&f.memoizedState.dehydrated!==null){if(B=Ll(m),M!==null&&M.dehydrated!==null){if(f===null){if(!B)throw Error(n(318));if(B=m.memoizedState,B=B!==null?B.dehydrated:null,!B)throw Error(n(317));B[jn]=m}else Ep(),(m.flags&128)===0&&(m.memoizedState=null),m.flags|=4;ir(m),B=!1}else B=On(),f!==null&&f.memoizedState!==null&&(f.memoizedState.hydrationErrors=B),B=!0;if(!B)return m.flags&256?(hc(m),m):(hc(m),null)}if(hc(m),(m.flags&128)!==0)return m.lanes=_,m;if(_=M!==null,f=f!==null&&f.memoizedState!==null,_){M=m.child,B=null,M.alternate!==null&&M.alternate.memoizedState!==null&&M.alternate.memoizedState.cachePool!==null&&(B=M.alternate.memoizedState.cachePool.pool);var N=null;M.memoizedState!==null&&M.memoizedState.cachePool!==null&&(N=M.memoizedState.cachePool.pool),N!==B&&(M.flags|=2048)}return _!==f&&_&&(m.child.flags|=8192),bu(m,m.updateQueue),ir(m),null;case 4:return we(),f===null&&BP(m.stateNode.containerInfo),ir(m),null;case 10:return fu(m.type),ir(m),null;case 19:if(se(Ir),B=m.memoizedState,B===null)return ir(m),null;if(M=(m.flags&128)!==0,N=B.rendering,N===null)if(M)Wd(B,!1);else{if(ur!==0||f!==null&&(f.flags&128)!==0)for(f=m.child;f!==null;){if(N=xu(f),N!==null){for(m.flags|=128,Wd(B,!1),f=N.updateQueue,m.updateQueue=f,bu(m,f),m.subtreeFlags=0,f=_,_=m.child;_!==null;)pS(_,f),_=_.sibling;return fe(Ir,Ir.current&1|2),m.child}f=f.sibling}B.tail!==null&&je()>sa&&(m.flags|=128,M=!0,Wd(B,!1),m.lanes=4194304)}else{if(!M)if(f=xu(N),f!==null){if(m.flags|=128,M=!0,f=f.updateQueue,m.updateQueue=f,bu(m,f),Wd(B,!0),B.tail===null&&B.tailMode==="hidden"&&!N.alternate&&!wn)return ir(m),null}else 2*je()-B.renderingStartTime>sa&&_!==536870912&&(m.flags|=128,M=!0,Wd(B,!1),m.lanes=4194304);B.isBackwards?(N.sibling=m.child,m.child=N):(f=B.last,f!==null?f.sibling=N:m.child=N,B.last=N)}return B.tail!==null?(m=B.tail,B.rendering=m,B.tail=m.sibling,B.renderingStartTime=je(),m.sibling=null,f=Ir.current,fe(Ir,M?f&1|2:f&1),m):(ir(m),null);case 22:case 23:return hc(m),Qg(),M=m.memoizedState!==null,f!==null?f.memoizedState!==null!==M&&(m.flags|=8192):M&&(m.flags|=8192),M?(_&536870912)!==0&&(m.flags&128)===0&&(ir(m),m.subtreeFlags&6&&(m.flags|=8192)):ir(m),_=m.updateQueue,_!==null&&bu(m,_.retryQueue),_=null,f!==null&&f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(_=f.memoizedState.cachePool.pool),M=null,m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(M=m.memoizedState.cachePool.pool),M!==_&&(m.flags|=2048),f!==null&&se(ll),null;case 24:return _=null,f!==null&&(_=f.memoizedState.cache),m.memoizedState.cache!==_&&(m.flags|=2048),fu(Wr),ir(m),null;case 25:return null;case 30:return null}throw Error(n(156,m.tag))}function Hp(f,m){switch(gS(m),m.tag){case 1:return f=m.flags,f&65536?(m.flags=f&-65537|128,m):null;case 3:return fu(Wr),we(),f=m.flags,(f&65536)!==0&&(f&128)===0?(m.flags=f&-65537|128,m):null;case 26:case 27:case 5:return Ne(m),null;case 13:if(hc(m),f=m.memoizedState,f!==null&&f.dehydrated!==null){if(m.alternate===null)throw Error(n(340));Ep()}return f=m.flags,f&65536?(m.flags=f&-65537|128,m):null;case 19:return se(Ir),null;case 4:return we(),null;case 10:return fu(m.type),null;case 22:case 23:return hc(m),Qg(),f!==null&&se(ll),f=m.flags,f&65536?(m.flags=f&-65537|128,m):null;case 24:return fu(Wr),null;case 25:return null;default:return null}}function Gp(f,m){switch(gS(m),m.tag){case 3:fu(Wr),we();break;case 26:case 27:case 5:Ne(m);break;case 4:we();break;case 13:hc(m);break;case 19:se(Ir);break;case 10:fu(m.type);break;case 22:case 23:hc(m),Qg(),f!==null&&se(ll);break;case 24:fu(Wr)}}function Xd(f,m){try{var _=m.updateQueue,M=_!==null?_.lastEffect:null;if(M!==null){var B=M.next;_=B;do{if((_.tag&f)===f){M=void 0;var N=_.create,ee=_.inst;M=N(),ee.destroy=M}_=_.next}while(_!==B)}}catch(ce){ze(m,m.return,ce)}}function Ro(f,m,_){try{var M=m.updateQueue,B=M!==null?M.lastEffect:null;if(B!==null){var N=B.next;M=N;do{if((M.tag&f)===f){var ee=M.inst,ce=ee.destroy;if(ce!==void 0){ee.destroy=void 0,B=m;var Ee=_,rt=ce;try{rt()}catch(Tt){ze(B,Ee,Tt)}}}M=M.next}while(M!==N)}}catch(Tt){ze(m,m.return,Tt)}}function qd(f){var m=f.updateQueue;if(m!==null){var _=f.stateNode;try{XM(m,_)}catch(M){ze(f,f.return,M)}}}function Su(f,m,_){_.props=dc(f.type,f.memoizedProps),_.state=f.memoizedState;try{_.componentWillUnmount()}catch(M){ze(f,m,M)}}function Yd(f,m){try{var _=f.ref;if(_!==null){switch(f.tag){case 26:case 27:case 5:var M=f.stateNode;break;case 30:M=f.stateNode;break;default:M=f.stateNode}typeof _=="function"?f.refCleanup=_(M):_.current=M}}catch(B){ze(f,m,B)}}function pc(f,m){var _=f.ref,M=f.refCleanup;if(_!==null)if(typeof M=="function")try{M()}catch(B){ze(f,m,B)}finally{f.refCleanup=null,f=f.alternate,f!=null&&(f.refCleanup=null)}else if(typeof _=="function")try{_(null)}catch(B){ze(f,m,B)}else _.current=null}function kp(f){var m=f.type,_=f.memoizedProps,M=f.stateNode;try{e:switch(m){case"button":case"input":case"select":case"textarea":_.autoFocus&&M.focus();break e;case"img":_.src?M.src=_.src:_.srcSet&&(M.srcset=_.srcSet)}}catch(B){ze(f,f.return,B)}}function rv(f,m,_){try{var M=f.stateNode;sne(M,f.type,_,m),M[xr]=m}catch(B){ze(f,f.return,B)}}function sv(f){return f.tag===5||f.tag===3||f.tag===26||f.tag===27&&Kp(f.type)||f.tag===4}function Dh(f){e:for(;;){for(;f.sibling===null;){if(f.return===null||sv(f.return))return null;f=f.return}for(f.sibling.return=f.return,f=f.sibling;f.tag!==5&&f.tag!==6&&f.tag!==18;){if(f.tag===27&&Kp(f.type)||f.flags&2||f.child===null||f.tag===4)continue e;f.child.return=f,f=f.child}if(!(f.flags&2))return f.stateNode}}function Rh(f,m,_){var M=f.tag;if(M===5||M===6)f=f.stateNode,m?(_.nodeType===9?_.body:_.nodeName==="HTML"?_.ownerDocument.body:_).insertBefore(f,m):(m=_.nodeType===9?_.body:_.nodeName==="HTML"?_.ownerDocument.body:_,m.appendChild(f),_=_._reactRootContainer,_!=null||m.onclick!==null||(m.onclick=UE));else if(M!==4&&(M===27&&Kp(f.type)&&(_=f.stateNode,m=null),f=f.child,f!==null))for(Rh(f,m,_),f=f.sibling;f!==null;)Rh(f,m,_),f=f.sibling}function Ph(f,m,_){var M=f.tag;if(M===5||M===6)f=f.stateNode,m?_.insertBefore(f,m):_.appendChild(f);else if(M!==4&&(M===27&&Kp(f.type)&&(_=f.stateNode),f=f.child,f!==null))for(Ph(f,m,_),f=f.sibling;f!==null;)Ph(f,m,_),f=f.sibling}function Oh(f){var m=f.stateNode,_=f.memoizedProps;try{for(var M=f.type,B=m.attributes;B.length;)m.removeAttributeNode(B[0]);Ia(m,M,_),m[jn]=f,m[xr]=_}catch(N){ze(f,f.return,N)}}var mc=!1,nr=!1,jp=!1,Po=typeof WeakSet=="function"?WeakSet:Set,qn=null;function rs(f,m){if(f=f.containerInfo,UP=kE,f=oS(f),Bg(f)){if("selectionStart"in f)var _={start:f.selectionStart,end:f.selectionEnd};else e:{_=(_=f.ownerDocument)&&_.defaultView||window;var M=_.getSelection&&_.getSelection();if(M&&M.rangeCount!==0){_=M.anchorNode;var B=M.anchorOffset,N=M.focusNode;M=M.focusOffset;try{_.nodeType,N.nodeType}catch{_=null;break e}var ee=0,ce=-1,Ee=-1,rt=0,Tt=0,Ot=f,ht=null;t:for(;;){for(var dt;Ot!==_||B!==0&&Ot.nodeType!==3||(ce=ee+B),Ot!==N||M!==0&&Ot.nodeType!==3||(Ee=ee+M),Ot.nodeType===3&&(ee+=Ot.nodeValue.length),(dt=Ot.firstChild)!==null;)ht=Ot,Ot=dt;for(;;){if(Ot===f)break t;if(ht===_&&++rt===B&&(ce=ee),ht===N&&++Tt===M&&(Ee=ee),(dt=Ot.nextSibling)!==null)break;Ot=ht,ht=Ot.parentNode}Ot=dt}_=ce===-1||Ee===-1?null:{start:ce,end:Ee}}else _=null}_=_||{start:0,end:0}}else _=null;for(NP={focusedElem:f,selectionRange:_},kE=!1,qn=m;qn!==null;)if(m=qn,f=m.child,(m.subtreeFlags&1024)!==0&&f!==null)f.return=m,qn=f;else for(;qn!==null;){switch(m=qn,N=m.alternate,f=m.flags,m.tag){case 0:break;case 11:case 15:break;case 1:if((f&1024)!==0&&N!==null){f=void 0,_=m,B=N.memoizedProps,N=N.memoizedState,M=_.stateNode;try{var Li=dc(_.type,B,_.elementType===_.type);f=M.getSnapshotBeforeUpdate(Li,N),M.__reactInternalSnapshotBeforeUpdate=f}catch(Ci){ze(_,_.return,Ci)}}break;case 3:if((f&1024)!==0){if(f=m.stateNode.containerInfo,_=f.nodeType,_===9)VP(f);else if(_===1)switch(f.nodeName){case"HEAD":case"HTML":case"BODY":VP(f);break;default:f.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((f&1024)!==0)throw Error(n(163))}if(f=m.sibling,f!==null){f.return=m.return,qn=f;break}qn=m.return}}function _u(f,m,_){var M=_.flags;switch(_.tag){case 0:case 11:case 15:Oa(f,_),M&4&&Xd(5,_);break;case 1:if(Oa(f,_),M&4)if(f=_.stateNode,m===null)try{f.componentDidMount()}catch(ee){ze(_,_.return,ee)}else{var B=dc(_.type,m.memoizedProps);m=m.memoizedState;try{f.componentDidUpdate(B,m,f.__reactInternalSnapshotBeforeUpdate)}catch(ee){ze(_,_.return,ee)}}M&64&&qd(_),M&512&&Yd(_,_.return);break;case 3:if(Oa(f,_),M&64&&(f=_.updateQueue,f!==null)){if(m=null,_.child!==null)switch(_.child.tag){case 27:case 5:m=_.child.stateNode;break;case 1:m=_.child.stateNode}try{XM(f,m)}catch(ee){ze(_,_.return,ee)}}break;case 27:m===null&&M&4&&Oh(_);case 26:case 5:Oa(f,_),m===null&&M&4&&kp(_),M&512&&Yd(_,_.return);break;case 12:Oa(f,_);break;case 13:Oa(f,_),M&4&&Bh(f,_),M&64&&(f=_.memoizedState,f!==null&&(f=f.dehydrated,f!==null&&(_=hr.bind(null,_),dne(f,_))));break;case 22:if(M=_.memoizedState!==null||mc,!M){m=m!==null&&m.memoizedState!==null||nr,B=mc;var N=nr;mc=M,(nr=m)&&!N?gc(f,_,(_.subtreeFlags&8772)!==0):Oa(f,_),mc=B,nr=N}break;case 30:break;default:Oa(f,_)}}function Ji(f){var m=f.alternate;m!==null&&(f.alternate=null,Ji(m)),f.child=null,f.deletions=null,f.sibling=null,f.tag===5&&(m=f.stateNode,m!==null&&ot(m)),f.stateNode=null,f.return=null,f.dependencies=null,f.memoizedProps=null,f.memoizedState=null,f.pendingProps=null,f.stateNode=null,f.updateQueue=null}var bi=null,yn=!1;function pl(f,m,_){for(_=_.child;_!==null;)Qd(f,m,_),_=_.sibling}function Qd(f,m,_){if(Re&&typeof Re.onCommitFiberUnmount=="function")try{Re.onCommitFiberUnmount(K,_)}catch{}switch(_.tag){case 26:nr||pc(_,m),pl(f,m,_),_.memoizedState?_.memoizedState.count--:_.stateNode&&(_=_.stateNode,_.parentNode.removeChild(_));break;case 27:nr||pc(_,m);var M=bi,B=yn;Kp(_.type)&&(bi=_.stateNode,yn=!1),pl(f,m,_),QS(_.stateNode),bi=M,yn=B;break;case 5:nr||pc(_,m);case 6:if(M=bi,B=yn,bi=null,pl(f,m,_),bi=M,yn=B,bi!==null)if(yn)try{(bi.nodeType===9?bi.body:bi.nodeName==="HTML"?bi.ownerDocument.body:bi).removeChild(_.stateNode)}catch(N){ze(_,m,N)}else try{bi.removeChild(_.stateNode)}catch(N){ze(_,m,N)}break;case 18:bi!==null&&(yn?(f=bi,CV(f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f,_.stateNode),n_(f)):CV(bi,_.stateNode));break;case 4:M=bi,B=yn,bi=_.stateNode.containerInfo,yn=!0,pl(f,m,_),bi=M,yn=B;break;case 0:case 11:case 14:case 15:nr||Ro(2,_,m),nr||Ro(4,_,m),pl(f,m,_);break;case 1:nr||(pc(_,m),M=_.stateNode,typeof M.componentWillUnmount=="function"&&Su(_,m,M)),pl(f,m,_);break;case 21:pl(f,m,_);break;case 22:nr=(M=nr)||_.memoizedState!==null,pl(f,m,_),nr=M;break;default:pl(f,m,_)}}function Bh(f,m){if(m.memoizedState===null&&(f=m.alternate,f!==null&&(f=f.memoizedState,f!==null&&(f=f.dehydrated,f!==null))))try{n_(f)}catch(_){ze(m,m.return,_)}}function Hy(f){switch(f.tag){case 13:case 19:var m=f.stateNode;return m===null&&(m=f.stateNode=new Po),m;case 22:return f=f.stateNode,m=f._retryCache,m===null&&(m=f._retryCache=new Po),m;default:throw Error(n(435,f.tag))}}function Kd(f,m){var _=Hy(f);m.forEach(function(M){var B=Ii.bind(null,f,M);_.has(M)||(_.add(M),M.then(B,B))})}function _s(f,m){var _=m.deletions;if(_!==null)for(var M=0;M<_.length;M++){var B=_[M],N=f,ee=m,ce=ee;e:for(;ce!==null;){switch(ce.tag){case 27:if(Kp(ce.type)){bi=ce.stateNode,yn=!1;break e}break;case 5:bi=ce.stateNode,yn=!1;break e;case 3:case 4:bi=ce.stateNode.containerInfo,yn=!0;break e}ce=ce.return}if(bi===null)throw Error(n(160));Qd(N,ee,B),bi=null,yn=!1,N=B.alternate,N!==null&&(N.return=null),B.return=null}if(m.subtreeFlags&13878)for(m=m.child;m!==null;)Gy(m,f),m=m.sibling}var Gl=null;function Gy(f,m){var _=f.alternate,M=f.flags;switch(f.tag){case 0:case 11:case 14:case 15:_s(m,f),Mr(f),M&4&&(Ro(3,f,f.return),Xd(3,f),Ro(5,f,f.return));break;case 1:_s(m,f),Mr(f),M&512&&(nr||_===null||pc(_,_.return)),M&64&&mc&&(f=f.updateQueue,f!==null&&(M=f.callbacks,M!==null&&(_=f.shared.hiddenCallbacks,f.shared.hiddenCallbacks=_===null?M:_.concat(M))));break;case 26:var B=Gl;if(_s(m,f),Mr(f),M&512&&(nr||_===null||pc(_,_.return)),M&4){var N=_!==null?_.memoizedState:null;if(M=f.memoizedState,_===null)if(M===null)if(f.stateNode===null){e:{M=f.type,_=f.memoizedProps,B=B.ownerDocument||B;t:switch(M){case"title":N=B.getElementsByTagName("title")[0],(!N||N[Ye]||N[jn]||N.namespaceURI==="http://www.w3.org/2000/svg"||N.hasAttribute("itemprop"))&&(N=B.createElement(M),B.head.insertBefore(N,B.querySelector("head > title"))),Ia(N,M,_),N[jn]=f,fi(N),M=N;break e;case"link":var ee=UV("link","href",B).get(M+(_.href||""));if(ee){for(var ce=0;ce<ee.length;ce++)if(N=ee[ce],N.getAttribute("href")===(_.href==null||_.href===""?null:_.href)&&N.getAttribute("rel")===(_.rel==null?null:_.rel)&&N.getAttribute("title")===(_.title==null?null:_.title)&&N.getAttribute("crossorigin")===(_.crossOrigin==null?null:_.crossOrigin)){ee.splice(ce,1);break t}}N=B.createElement(M),Ia(N,M,_),B.head.appendChild(N);break;case"meta":if(ee=UV("meta","content",B).get(M+(_.content||""))){for(ce=0;ce<ee.length;ce++)if(N=ee[ce],N.getAttribute("content")===(_.content==null?null:""+_.content)&&N.getAttribute("name")===(_.name==null?null:_.name)&&N.getAttribute("property")===(_.property==null?null:_.property)&&N.getAttribute("http-equiv")===(_.httpEquiv==null?null:_.httpEquiv)&&N.getAttribute("charset")===(_.charSet==null?null:_.charSet)){ee.splice(ce,1);break t}}N=B.createElement(M),Ia(N,M,_),B.head.appendChild(N);break;default:throw Error(n(468,M))}N[jn]=f,fi(N),M=N}f.stateNode=M}else NV(B,f.type,f.stateNode);else f.stateNode=LV(B,M,f.memoizedProps);else N!==M?(N===null?_.stateNode!==null&&(_=_.stateNode,_.parentNode.removeChild(_)):N.count--,M===null?NV(B,f.type,f.stateNode):LV(B,M,f.memoizedProps)):M===null&&f.stateNode!==null&&rv(f,f.memoizedProps,_.memoizedProps)}break;case 27:_s(m,f),Mr(f),M&512&&(nr||_===null||pc(_,_.return)),_!==null&&M&4&&rv(f,f.memoizedProps,_.memoizedProps);break;case 5:if(_s(m,f),Mr(f),M&512&&(nr||_===null||pc(_,_.return)),f.flags&32){B=f.stateNode;try{Ma(B,"")}catch(dt){ze(f,f.return,dt)}}M&4&&f.stateNode!=null&&(B=f.memoizedProps,rv(f,B,_!==null?_.memoizedProps:B)),M&1024&&(jp=!0);break;case 6:if(_s(m,f),Mr(f),M&4){if(f.stateNode===null)throw Error(n(162));M=f.memoizedProps,_=f.stateNode;try{_.nodeValue=M}catch(dt){ze(f,f.return,dt)}}break;case 3:if(VE=null,B=Gl,Gl=zE(m.containerInfo),_s(m,f),Gl=B,Mr(f),M&4&&_!==null&&_.memoizedState.isDehydrated)try{n_(m.containerInfo)}catch(dt){ze(f,f.return,dt)}jp&&(jp=!1,Ih(f));break;case 4:M=Gl,Gl=zE(f.stateNode.containerInfo),_s(m,f),Mr(f),Gl=M;break;case 12:_s(m,f),Mr(f);break;case 13:_s(m,f),Mr(f),f.child.flags&8192&&f.memoizedState!==null!=(_!==null&&_.memoizedState!==null)&&(Hn=je()),M&4&&(M=f.updateQueue,M!==null&&(f.updateQueue=null,Kd(f,M)));break;case 22:B=f.memoizedState!==null;var Ee=_!==null&&_.memoizedState!==null,rt=mc,Tt=nr;if(mc=rt||B,nr=Tt||Ee,_s(m,f),nr=Tt,mc=rt,Mr(f),M&8192)e:for(m=f.stateNode,m._visibility=B?m._visibility&-2:m._visibility|1,B&&(_===null||Ee||mc||nr||Oo(f)),_=null,m=f;;){if(m.tag===5||m.tag===26){if(_===null){Ee=_=m;try{if(N=Ee.stateNode,B)ee=N.style,typeof ee.setProperty=="function"?ee.setProperty("display","none","important"):ee.display="none";else{ce=Ee.stateNode;var Ot=Ee.memoizedProps.style,ht=Ot!=null&&Ot.hasOwnProperty("display")?Ot.display:null;ce.style.display=ht==null||typeof ht=="boolean"?"":(""+ht).trim()}}catch(dt){ze(Ee,Ee.return,dt)}}}else if(m.tag===6){if(_===null){Ee=m;try{Ee.stateNode.nodeValue=B?"":Ee.memoizedProps}catch(dt){ze(Ee,Ee.return,dt)}}}else if((m.tag!==22&&m.tag!==23||m.memoizedState===null||m===f)&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===f)break e;for(;m.sibling===null;){if(m.return===null||m.return===f)break e;_===m&&(_=null),m=m.return}_===m&&(_=null),m.sibling.return=m.return,m=m.sibling}M&4&&(M=f.updateQueue,M!==null&&(_=M.retryQueue,_!==null&&(M.retryQueue=null,Kd(f,_))));break;case 19:_s(m,f),Mr(f),M&4&&(M=f.updateQueue,M!==null&&(f.updateQueue=null,Kd(f,M)));break;case 30:break;case 21:break;default:_s(m,f),Mr(f)}}function Mr(f){var m=f.flags;if(m&2){try{for(var _,M=f.return;M!==null;){if(sv(M)){_=M;break}M=M.return}if(_==null)throw Error(n(160));switch(_.tag){case 27:var B=_.stateNode,N=Dh(f);Ph(f,N,B);break;case 5:var ee=_.stateNode;_.flags&32&&(Ma(ee,""),_.flags&=-33);var ce=Dh(f);Ph(f,ce,ee);break;case 3:case 4:var Ee=_.stateNode.containerInfo,rt=Dh(f);Rh(f,rt,Ee);break;default:throw Error(n(161))}}catch(Tt){ze(f,f.return,Tt)}f.flags&=-3}m&4096&&(f.flags&=-4097)}function Ih(f){if(f.subtreeFlags&1024)for(f=f.child;f!==null;){var m=f;Ih(m),m.tag===5&&m.flags&1024&&m.stateNode.reset(),f=f.sibling}}function Oa(f,m){if(m.subtreeFlags&8772)for(m=m.child;m!==null;)_u(f,m.alternate,m),m=m.sibling}function Oo(f){for(f=f.child;f!==null;){var m=f;switch(m.tag){case 0:case 11:case 14:case 15:Ro(4,m,m.return),Oo(m);break;case 1:pc(m,m.return);var _=m.stateNode;typeof _.componentWillUnmount=="function"&&Su(m,m.return,_),Oo(m);break;case 27:QS(m.stateNode);case 26:case 5:pc(m,m.return),Oo(m);break;case 22:m.memoizedState===null&&Oo(m);break;case 30:Oo(m);break;default:Oo(m)}f=f.sibling}}function gc(f,m,_){for(_=_&&(m.subtreeFlags&8772)!==0,m=m.child;m!==null;){var M=m.alternate,B=f,N=m,ee=N.flags;switch(N.tag){case 0:case 11:case 15:gc(B,N,_),Xd(4,N);break;case 1:if(gc(B,N,_),M=N,B=M.stateNode,typeof B.componentDidMount=="function")try{B.componentDidMount()}catch(rt){ze(M,M.return,rt)}if(M=N,B=M.updateQueue,B!==null){var ce=M.stateNode;try{var Ee=B.shared.hiddenCallbacks;if(Ee!==null)for(B.shared.hiddenCallbacks=null,B=0;B<Ee.length;B++)Bp(Ee[B],ce)}catch(rt){ze(M,M.return,rt)}}_&&ee&64&&qd(N),Yd(N,N.return);break;case 27:Oh(N);case 26:case 5:gc(B,N,_),_&&M===null&&ee&4&&kp(N),Yd(N,N.return);break;case 12:gc(B,N,_);break;case 13:gc(B,N,_),_&&ee&4&&Bh(B,N);break;case 22:N.memoizedState===null&&gc(B,N,_),Yd(N,N.return);break;case 30:break;default:gc(B,N,_)}m=m.sibling}}function ky(f,m){var _=null;f!==null&&f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(_=f.memoizedState.cachePool.pool),f=null,m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(f=m.memoizedState.cachePool.pool),f!==_&&(f!=null&&f.refCount++,_!=null&&Tp(_))}function jy(f,m){f=null,m.alternate!==null&&(f=m.alternate.memoizedState.cache),m=m.memoizedState.cache,m!==f&&(m.refCount++,f!=null&&Tp(f))}function Yn(f,m,_,M){if(m.subtreeFlags&10256)for(m=m.child;m!==null;)Wy(f,m,_,M),m=m.sibling}function Wy(f,m,_,M){var B=m.flags;switch(m.tag){case 0:case 11:case 15:Yn(f,m,_,M),B&2048&&Xd(9,m);break;case 1:Yn(f,m,_,M);break;case 3:Yn(f,m,_,M),B&2048&&(f=null,m.alternate!==null&&(f=m.alternate.memoizedState.cache),m=m.memoizedState.cache,m!==f&&(m.refCount++,f!=null&&Tp(f)));break;case 12:if(B&2048){Yn(f,m,_,M),f=m.stateNode;try{var N=m.memoizedProps,ee=N.id,ce=N.onPostCommit;typeof ce=="function"&&ce(ee,m.alternate===null?"mount":"update",f.passiveEffectDuration,-0)}catch(Ee){ze(m,m.return,Ee)}}else Yn(f,m,_,M);break;case 13:Yn(f,m,_,M);break;case 23:break;case 22:N=m.stateNode,ee=m.alternate,m.memoizedState!==null?N._visibility&2?Yn(f,m,_,M):kl(f,m):N._visibility&2?Yn(f,m,_,M):(N._visibility|=2,Au(f,m,_,M,(m.subtreeFlags&10256)!==0)),B&2048&&ky(ee,m);break;case 24:Yn(f,m,_,M),B&2048&&jy(m.alternate,m);break;default:Yn(f,m,_,M)}}function Au(f,m,_,M,B){for(B=B&&(m.subtreeFlags&10256)!==0,m=m.child;m!==null;){var N=f,ee=m,ce=_,Ee=M,rt=ee.flags;switch(ee.tag){case 0:case 11:case 15:Au(N,ee,ce,Ee,B),Xd(8,ee);break;case 23:break;case 22:var Tt=ee.stateNode;ee.memoizedState!==null?Tt._visibility&2?Au(N,ee,ce,Ee,B):kl(N,ee):(Tt._visibility|=2,Au(N,ee,ce,Ee,B)),B&&rt&2048&&ky(ee.alternate,ee);break;case 24:Au(N,ee,ce,Ee,B),B&&rt&2048&&jy(ee.alternate,ee);break;default:Au(N,ee,ce,Ee,B)}m=m.sibling}}function kl(f,m){if(m.subtreeFlags&10256)for(m=m.child;m!==null;){var _=f,M=m,B=M.flags;switch(M.tag){case 22:kl(_,M),B&2048&&ky(M.alternate,M);break;case 24:kl(_,M),B&2048&&jy(M.alternate,M);break;default:kl(_,M)}m=m.sibling}}var Bo=8192;function Wp(f){if(f.subtreeFlags&Bo)for(f=f.child;f!==null;)OE(f),f=f.sibling}function OE(f){switch(f.tag){case 26:Wp(f),f.flags&Bo&&f.memoizedState!==null&&Mne(Gl,f.memoizedState,f.memoizedProps);break;case 5:Wp(f);break;case 3:case 4:var m=Gl;Gl=zE(f.stateNode.containerInfo),Wp(f),Gl=m;break;case 22:f.memoizedState===null&&(m=f.alternate,m!==null&&m.memoizedState!==null?(m=Bo,Bo=16777216,Wp(f),Bo=m):Wp(f));break;default:Wp(f)}}function BE(f){var m=f.alternate;if(m!==null&&(f=m.child,f!==null)){m.child=null;do m=f.sibling,f.sibling=null,f=m;while(f!==null)}}function rr(f){var m=f.deletions;if((f.flags&16)!==0){if(m!==null)for(var _=0;_<m.length;_++){var M=m[_];qn=M,yc(M,f)}BE(f)}if(f.subtreeFlags&10256)for(f=f.child;f!==null;)jS(f),f=f.sibling}function jS(f){switch(f.tag){case 0:case 11:case 15:rr(f),f.flags&2048&&Ro(9,f,f.return);break;case 3:rr(f);break;case 12:rr(f);break;case 22:var m=f.stateNode;f.memoizedState!==null&&m._visibility&2&&(f.return===null||f.return.tag!==13)?(m._visibility&=-3,vc(f)):rr(f);break;default:rr(f)}}function vc(f){var m=f.deletions;if((f.flags&16)!==0){if(m!==null)for(var _=0;_<m.length;_++){var M=m[_];qn=M,yc(M,f)}BE(f)}for(f=f.child;f!==null;){switch(m=f,m.tag){case 0:case 11:case 15:Ro(8,m,m.return),vc(m);break;case 22:_=m.stateNode,_._visibility&2&&(_._visibility&=-3,vc(m));break;default:vc(m)}f=f.sibling}}function yc(f,m){for(;qn!==null;){var _=qn;switch(_.tag){case 0:case 11:case 15:Ro(8,_,m);break;case 23:case 22:if(_.memoizedState!==null&&_.memoizedState.cachePool!==null){var M=_.memoizedState.cachePool.pool;M!=null&&M.refCount++}break;case 24:Tp(_.memoizedState.cache)}if(M=_.child,M!==null)M.return=_,qn=M;else e:for(_=f;qn!==null;){M=qn;var B=M.sibling,N=M.return;if(Ji(M),M===_){qn=null;break e}if(B!==null){B.return=N,qn=B;break e}qn=N}}}var Er={getCacheForType:function(f){var m=wr(Wr),_=m.data.get(f);return _===void 0&&(_=f(),m.data.set(f,_)),_}},WS=typeof WeakMap=="function"?WeakMap:Map,Bn=0,Fi=null,sn=null,pi=0,Qi=0,Sr=null,Io=!1,Xp=!1,qp=!1,ml=0,ur=0,jl=0,xc=0,Jd=0,gl=0,xn=0,In=null,Ai=null,on=!1,Hn=0,sa=1/0,vl=null,Lo=null,ss=0,aa=null,Qn=null,Uo=0,wu=0,av=null,No=null,bc=0,Zd=null;function Tr(){if((Bn&2)!==0&&pi!==0)return pi&-pi;if(F.T!==null){var f=ji;return f!==0?f:DP()}return Jt()}function Xy(){gl===0&&(gl=(pi&536870912)===0||wn?ie():536870912);var f=Xn.current;return f!==null&&(f.flags|=32),gl}function Ba(f,m,_){(f===Fi&&(Qi===2||Qi===9)||f.cancelPendingCommit!==null)&&(Uh(f,0),Wl(f,pi,gl,!1)),at(f,_),((Bn&2)===0||f!==Fi)&&(f===Fi&&((Bn&2)===0&&(xc|=_),ur===4&&Wl(f,pi,gl,!1)),Fh(f))}function Yp(f,m,_){if((Bn&6)!==0)throw Error(n(327));var M=!_&&(m&124)===0&&(m&f.expiredLanes)===0||Ve(f,m),B=M?L(f,m):S(f,m,!0),N=M;do{if(B===0){Xp&&!M&&Wl(f,m,0,!1);break}else{if(_=f.current.alternate,N&&!Lh(_)){B=S(f,m,!1),N=!1;continue}if(B===2){if(N=m,f.errorRecoveryDisabledLanes&N)var ee=0;else ee=f.pendingLanes&-536870913,ee=ee!==0?ee:ee&536870912?536870912:0;if(ee!==0){m=ee;e:{var ce=f;B=In;var Ee=ce.current.memoizedState.isDehydrated;if(Ee&&(Uh(ce,ee).flags|=256),ee=S(ce,ee,!1),ee!==2){if(qp&&!Ee){ce.errorRecoveryDisabledLanes|=N,xc|=N,B=4;break e}N=Ai,Ai=B,N!==null&&(Ai===null?Ai=N:Ai.push.apply(Ai,N))}B=ee}if(N=!1,B!==2)continue}}if(B===1){Uh(f,0),Wl(f,m,0,!0);break}e:{switch(M=f,N=B,N){case 0:case 1:throw Error(n(345));case 4:if((m&4194048)!==m)break;case 6:Wl(M,m,gl,!Io);break e;case 2:Ai=null;break;case 3:case 5:break;default:throw Error(n(329))}if((m&62914560)===m&&(B=Hn+300-je(),10<B)){if(Wl(M,m,gl,!Io),ye(M,0,!0)!==0)break e;M.timeoutHandle=EV(ov.bind(null,M,_,Ai,vl,on,m,gl,xc,xn,Io,N,2,-0,0),B);break e}ov(M,_,Ai,vl,on,m,gl,xc,xn,Io,N,0,-0,0)}}break}while(!0);Fh(f)}function ov(f,m,_,M,B,N,ee,ce,Ee,rt,Tt,Ot,ht,dt){if(f.timeoutHandle=-1,Ot=m.subtreeFlags,(Ot&8192||(Ot&16785408)===16785408)&&(ZS={stylesheets:null,count:0,unsuspend:wne},OE(m),Ot=Ene(),Ot!==null)){f.cancelPendingCommit=Ot(Ut.bind(null,f,m,N,_,M,B,ee,ce,Ee,Tt,1,ht,dt)),Wl(f,N,ee,!rt);return}Ut(f,m,N,_,M,B,ee,ce,Ee)}function Lh(f){for(var m=f;;){var _=m.tag;if((_===0||_===11||_===15)&&m.flags&16384&&(_=m.updateQueue,_!==null&&(_=_.stores,_!==null)))for(var M=0;M<_.length;M++){var B=_[M],N=B.getSnapshot;B=B.value;try{if(!Za(N(),B))return!1}catch{return!1}}if(_=m.child,m.subtreeFlags&16384&&_!==null)_.return=m,m=_;else{if(m===f)break;for(;m.sibling===null;){if(m.return===null||m.return===f)return!0;m=m.return}m.sibling.return=m.return,m=m.sibling}}return!0}function Wl(f,m,_,M){m&=~Jd,m&=~xc,f.suspendedLanes|=m,f.pingedLanes&=~m,M&&(f.warmLanes|=m),M=f.expirationTimes;for(var B=m;0<B;){var N=31-st(B),ee=1<<N;M[N]=-1,B&=~ee}_!==0&&lt(f,_,m)}function Sc(){return(Bn&6)===0?(XS(0),!1):!0}function $d(){if(sn!==null){if(Qi===0)var f=sn.return;else f=sn,du=xh=null,TS(f),Nd=null,$g=0,f=sn;for(;f!==null;)Gp(f.alternate,f),f=f.return;sn=null}}function Uh(f,m){var _=f.timeoutHandle;_!==-1&&(f.timeoutHandle=-1,one(_)),_=f.cancelPendingCommit,_!==null&&(f.cancelPendingCommit=null,_()),$d(),Fi=f,sn=_=Or(f.current,null),pi=m,Qi=0,Sr=null,Io=!1,Xp=Ve(f,m),qp=!1,xn=gl=Jd=xc=jl=ur=0,Ai=In=null,on=!1,(m&8)!==0&&(m|=m&32);var M=f.entangledLanes;if(M!==0)for(f=f.entanglements,M&=m;0<M;){var B=31-st(M),N=1<<B;m|=f[B],M&=~N}return ml=m,Ug(),_}function qy(f,m){Wi=null,F.H=Zg,m===Xg||m===Ul?(m=_S(),Qi=3):m===SS?(m=_S(),Qi=4):Qi=m===PE?8:m!==null&&typeof m=="object"&&typeof m.then=="function"?6:1,Sr=m,sn===null&&(ur=1,zy(f,Ns(m,f.current)))}function Qp(){var f=F.H;return F.H=Zg,f===null?Zg:f}function Yy(){var f=F.A;return F.A=Er,f}function v(){ur=4,Io||(pi&4194048)!==pi&&Xn.current!==null||(Xp=!0),(jl&134217727)===0&&(xc&134217727)===0||Fi===null||Wl(Fi,pi,gl,!1)}function S(f,m,_){var M=Bn;Bn|=2;var B=Qp(),N=Yy();(Fi!==f||pi!==m)&&(vl=null,Uh(f,m)),m=!1;var ee=ur;e:do try{if(Qi!==0&&sn!==null){var ce=sn,Ee=Sr;switch(Qi){case 8:$d(),ee=6;break e;case 3:case 2:case 9:case 6:Xn.current===null&&(m=!0);var rt=Qi;if(Qi=0,Sr=null,Te(f,ce,Ee,rt),_&&Xp){ee=0;break e}break;default:rt=Qi,Qi=0,Sr=null,Te(f,ce,Ee,rt)}}C(),ee=ur;break}catch(Tt){qy(f,Tt)}while(!0);return m&&f.shellSuspendCounter++,du=xh=null,Bn=M,F.H=B,F.A=N,sn===null&&(Fi=null,pi=0,Ug()),ee}function C(){for(;sn!==null;)q(sn)}function L(f,m){var _=Bn;Bn|=2;var M=Qp(),B=Yy();Fi!==f||pi!==m?(vl=null,sa=je()+500,Uh(f,m)):Xp=Ve(f,m);e:do try{if(Qi!==0&&sn!==null){m=sn;var N=Sr;t:switch(Qi){case 1:Qi=0,Sr=null,Te(f,m,N,1);break;case 2:case 9:if(Ay(N)){Qi=0,Sr=null,he(m);break}m=function(){Qi!==2&&Qi!==9||Fi!==f||(Qi=7),Fh(f)},N.then(m,m);break e;case 3:Qi=7;break e;case 4:Qi=5;break e;case 7:Ay(N)?(Qi=0,Sr=null,he(m)):(Qi=0,Sr=null,Te(f,m,N,7));break;case 5:var ee=null;switch(sn.tag){case 26:ee=sn.memoizedState;case 5:case 27:var ce=sn;if(!ee||zV(ee)){Qi=0,Sr=null;var Ee=ce.sibling;if(Ee!==null)sn=Ee;else{var rt=ce.return;rt!==null?(sn=rt,Je(rt)):sn=null}break t}}Qi=0,Sr=null,Te(f,m,N,5);break;case 6:Qi=0,Sr=null,Te(f,m,N,6);break;case 8:$d(),ur=6;break e;default:throw Error(n(462))}}z();break}catch(Tt){qy(f,Tt)}while(!0);return du=xh=null,F.H=M,F.A=B,Bn=_,sn!==null?0:(Fi=null,pi=0,Ug(),ur)}function z(){for(;sn!==null&&!He();)q(sn)}function q(f){var m=jd(f.alternate,f,ml);f.memoizedProps=f.pendingProps,m===null?Je(f):sn=m}function he(f){var m=f,_=m.alternate;switch(m.tag){case 15:case 0:m=Co(_,m,m.pendingProps,m.type,void 0,pi);break;case 11:m=Co(_,m,m.pendingProps,m.type.render,m.ref,pi);break;case 5:TS(m);default:Gp(_,m),m=sn=pS(m,ml),m=jd(_,m,ml)}f.memoizedProps=f.pendingProps,m===null?Je(f):sn=m}function Te(f,m,_,M){du=xh=null,TS(m),Nd=null,$g=0;var B=m.return;try{if(TP(f,B,m,_,pi)){ur=1,zy(f,Ns(_,f.current)),sn=null;return}}catch(N){if(B!==null)throw sn=B,N;ur=1,zy(f,Ns(_,f.current)),sn=null;return}m.flags&32768?(wn||M===1?f=!0:Xp||(pi&536870912)!==0?f=!1:(Io=f=!0,(M===2||M===9||M===3||M===6)&&(M=Xn.current,M!==null&&M.tag===13&&(M.flags|=16384))),Et(m,f)):Je(m)}function Je(f){var m=f;do{if((m.flags&32768)!==0){Et(m,Io);return}f=m.return;var _=kS(m.alternate,m,ml);if(_!==null){sn=_;return}if(m=m.sibling,m!==null){sn=m;return}sn=m=f}while(m!==null);ur===0&&(ur=5)}function Et(f,m){do{var _=Hp(f.alternate,f);if(_!==null){_.flags&=32767,sn=_;return}if(_=f.return,_!==null&&(_.flags|=32768,_.subtreeFlags=0,_.deletions=null),!m&&(f=f.sibling,f!==null)){sn=f;return}sn=f=_}while(f!==null);ur=6,sn=null}function Ut(f,m,_,M,B,N,ee,ce,Ee){f.cancelPendingCommit=null;do Nh();while(ss!==0);if((Bn&6)!==0)throw Error(n(327));if(m!==null){if(m===f.current)throw Error(n(177));if(N=m.lanes|m.childLanes,N|=py,ut(f,_,N,ee,ce,Ee),f===Fi&&(sn=Fi=null,pi=0),Qn=m,aa=f,Uo=_,wu=N,av=B,No=M,(m.subtreeFlags&10256)!==0||(m.flags&10256)!==0?(f.callbackNode=null,f.callbackPriority=0,Mn(gt,function(){return zh(),null})):(f.callbackNode=null,f.callbackPriority=0),M=(m.flags&13878)!==0,(m.subtreeFlags&13878)!==0||M){M=F.T,F.T=null,B=X.p,X.p=2,ee=Bn,Bn|=4;try{rs(f,m,_)}finally{Bn=ee,X.p=B,F.T=M}}ss=1,Wt(),Yt(),Vi()}}function Wt(){if(ss===1){ss=0;var f=aa,m=Qn,_=(m.flags&13878)!==0;if((m.subtreeFlags&13878)!==0||_){_=F.T,F.T=null;var M=X.p;X.p=2;var B=Bn;Bn|=4;try{Gy(m,f);var N=NP,ee=oS(f.containerInfo),ce=N.focusedElem,Ee=N.selectionRange;if(ee!==ce&&ce&&ce.ownerDocument&&aS(ce.ownerDocument.documentElement,ce)){if(Ee!==null&&Bg(ce)){var rt=Ee.start,Tt=Ee.end;if(Tt===void 0&&(Tt=rt),"selectionStart"in ce)ce.selectionStart=rt,ce.selectionEnd=Math.min(Tt,ce.value.length);else{var Ot=ce.ownerDocument||document,ht=Ot&&Ot.defaultView||window;if(ht.getSelection){var dt=ht.getSelection(),Li=ce.textContent.length,Ci=Math.min(Ee.start,Li),ar=Ee.end===void 0?Ci:Math.min(Ee.end,Li);!dt.extend&&Ci>ar&&(ee=ar,ar=Ci,Ci=ee);var qe=sS(ce,Ci),Fe=sS(ce,ar);if(qe&&Fe&&(dt.rangeCount!==1||dt.anchorNode!==qe.node||dt.anchorOffset!==qe.offset||dt.focusNode!==Fe.node||dt.focusOffset!==Fe.offset)){var tt=Ot.createRange();tt.setStart(qe.node,qe.offset),dt.removeAllRanges(),Ci>ar?(dt.addRange(tt),dt.extend(Fe.node,Fe.offset)):(tt.setEnd(Fe.node,Fe.offset),dt.addRange(tt))}}}}for(Ot=[],dt=ce;dt=dt.parentNode;)dt.nodeType===1&&Ot.push({element:dt,left:dt.scrollLeft,top:dt.scrollTop});for(typeof ce.focus=="function"&&ce.focus(),ce=0;ce<Ot.length;ce++){var Pt=Ot[ce];Pt.element.scrollLeft=Pt.left,Pt.element.scrollTop=Pt.top}}kE=!!UP,NP=UP=null}finally{Bn=B,X.p=M,F.T=_}}f.current=m,ss=2}}function Yt(){if(ss===2){ss=0;var f=aa,m=Qn,_=(m.flags&8772)!==0;if((m.subtreeFlags&8772)!==0||_){_=F.T,F.T=null;var M=X.p;X.p=2;var B=Bn;Bn|=4;try{_u(f,m.alternate,m)}finally{Bn=B,X.p=M,F.T=_}}ss=3}}function Vi(){if(ss===4||ss===3){ss=0,Ke();var f=aa,m=Qn,_=Uo,M=No;(m.subtreeFlags&10256)!==0||(m.flags&10256)!==0?ss=5:(ss=0,Qn=aa=null,zo(f,f.pendingLanes));var B=f.pendingLanes;if(B===0&&(Lo=null),_i(_),m=m.stateNode,Re&&typeof Re.onCommitFiberRoot=="function")try{Re.onCommitFiberRoot(K,m,void 0,(m.current.flags&128)===128)}catch{}if(M!==null){m=F.T,B=X.p,X.p=2,F.T=null;try{for(var N=f.onRecoverableError,ee=0;ee<M.length;ee++){var ce=M[ee];N(ce.value,{componentStack:ce.stack})}}finally{F.T=m,X.p=B}}(Uo&3)!==0&&Nh(),Fh(f),B=f.pendingLanes,(_&4194090)!==0&&(B&42)!==0?f===Zd?bc++:(bc=0,Zd=f):bc=0,XS(0)}}function zo(f,m){(f.pooledCacheLanes&=m)===0&&(m=f.pooledCache,m!=null&&(f.pooledCache=null,Tp(m)))}function Nh(f){return Wt(),Yt(),Vi(),zh()}function zh(){if(ss!==5)return!1;var f=aa,m=wu;wu=0;var _=_i(Uo),M=F.T,B=X.p;try{X.p=32>_?32:_,F.T=null,_=av,av=null;var N=aa,ee=Uo;if(ss=0,Qn=aa=null,Uo=0,(Bn&6)!==0)throw Error(n(331));var ce=Bn;if(Bn|=4,jS(N.current),Wy(N,N.current,ee,_),Bn=ce,XS(0,!1),Re&&typeof Re.onPostCommitFiberRoot=="function")try{Re.onPostCommitFiberRoot(K,N)}catch{}return!0}finally{X.p=B,F.T=M,zo(f,m)}}function ct(f,m,_){m=Ns(_,m),m=Fy(f.stateNode,m,2),f=mu(f,m,2),f!==null&&(at(f,2),Fh(f))}function ze(f,m,_){if(f.tag===3)ct(f,f,_);else for(;m!==null;){if(m.tag===3){ct(m,f,_);break}else if(m.tag===1){var M=m.stateNode;if(typeof m.type.getDerivedStateFromError=="function"||typeof M.componentDidCatch=="function"&&(Lo===null||!Lo.has(M))){f=Ns(_,f),_=RE(2),M=mu(m,_,2),M!==null&&(Vy(_,M,m,f),at(M,2),Fh(M));break}}m=m.return}}function pt(f,m,_){var M=f.pingCache;if(M===null){M=f.pingCache=new WS;var B=new Set;M.set(m,B)}else B=M.get(m),B===void 0&&(B=new Set,M.set(m,B));B.has(_)||(qp=!0,B.add(_),f=Lt.bind(null,f,m,_),m.then(f,f))}function Lt(f,m,_){var M=f.pingCache;M!==null&&M.delete(m),f.pingedLanes|=f.suspendedLanes&_,f.warmLanes&=~_,Fi===f&&(pi&_)===_&&(ur===4||ur===3&&(pi&62914560)===pi&&300>je()-Hn?(Bn&2)===0&&Uh(f,0):Jd|=_,xn===pi&&(xn=0)),Fh(f)}function ci(f,m){m===0&&(m=Ce()),f=uu(f,m),f!==null&&(at(f,m),Fh(f))}function hr(f){var m=f.memoizedState,_=0;m!==null&&(_=m.retryLane),ci(f,_)}function Ii(f,m){var _=0;switch(f.tag){case 13:var M=f.stateNode,B=f.memoizedState;B!==null&&(_=B.retryLane);break;case 19:M=f.stateNode;break;case 22:M=f.stateNode._retryCache;break;default:throw Error(n(314))}M!==null&&M.delete(m),ci(f,_)}function Mn(f,m){return We(f,m)}var Ur=null,an=null,_c=!1,Qy=!1,CP=!1,lv=0;function Fh(f){f!==an&&f.next===null&&(an===null?Ur=an=f:an=an.next=f),Qy=!0,_c||(_c=!0,Zie())}function XS(f,m){if(!CP&&Qy){CP=!0;do for(var _=!1,M=Ur;M!==null;){if(f!==0){var B=M.pendingLanes;if(B===0)var N=0;else{var ee=M.suspendedLanes,ce=M.pingedLanes;N=(1<<31-st(42|f)+1)-1,N&=B&~(ee&~ce),N=N&201326741?N&201326741|1:N?N|2:0}N!==0&&(_=!0,gV(M,N))}else N=pi,N=ye(M,M===Fi?N:0,M.cancelPendingCommit!==null||M.timeoutHandle!==-1),(N&3)===0||Ve(M,N)||(_=!0,gV(M,N));M=M.next}while(_);CP=!1}}function Jie(){fV()}function fV(){Qy=_c=!1;var f=0;lv!==0&&(ane()&&(f=lv),lv=0);for(var m=je(),_=null,M=Ur;M!==null;){var B=M.next,N=pV(M,m);N===0?(M.next=null,_===null?Ur=B:_.next=B,B===null&&(an=_)):(_=M,(f!==0||(N&3)!==0)&&(Qy=!0)),M=B}XS(f)}function pV(f,m){for(var _=f.suspendedLanes,M=f.pingedLanes,B=f.expirationTimes,N=f.pendingLanes&-62914561;0<N;){var ee=31-st(N),ce=1<<ee,Ee=B[ee];Ee===-1?((ce&_)===0||(ce&M)!==0)&&(B[ee]=At(ce,m)):Ee<=m&&(f.expiredLanes|=ce),N&=~ce}if(m=Fi,_=pi,_=ye(f,f===m?_:0,f.cancelPendingCommit!==null||f.timeoutHandle!==-1),M=f.callbackNode,_===0||f===m&&(Qi===2||Qi===9)||f.cancelPendingCommit!==null)return M!==null&&M!==null&&ae(M),f.callbackNode=null,f.callbackPriority=0;if((_&3)===0||Ve(f,_)){if(m=_&-_,m===f.callbackPriority)return m;switch(M!==null&&ae(M),_i(_)){case 2:case 8:_=$e;break;case 32:_=gt;break;case 268435456:_=k;break;default:_=gt}return M=mV.bind(null,f),_=We(_,M),f.callbackPriority=m,f.callbackNode=_,m}return M!==null&&M!==null&&ae(M),f.callbackPriority=2,f.callbackNode=null,2}function mV(f,m){if(ss!==0&&ss!==5)return f.callbackNode=null,f.callbackPriority=0,null;var _=f.callbackNode;if(Nh()&&f.callbackNode!==_)return null;var M=pi;return M=ye(f,f===Fi?M:0,f.cancelPendingCommit!==null||f.timeoutHandle!==-1),M===0?null:(Yp(f,M,m),pV(f,je()),f.callbackNode!=null&&f.callbackNode===_?mV.bind(null,f):null)}function gV(f,m){if(Nh())return null;Yp(f,m,!0)}function Zie(){lne(function(){(Bn&6)!==0?We(Qe,Jie):fV()})}function DP(){return lv===0&&(lv=ie()),lv}function vV(f){return f==null||typeof f=="symbol"||typeof f=="boolean"?null:typeof f=="function"?f:bg(""+f)}function yV(f,m){var _=m.ownerDocument.createElement("input");return _.name=m.name,_.value=m.value,f.id&&_.setAttribute("form",f.id),m.parentNode.insertBefore(_,m),f=new FormData(f),_.parentNode.removeChild(_),f}function $ie(f,m,_,M,B){if(m==="submit"&&_&&_.stateNode===B){var N=vV((B[xr]||null).action),ee=M.submitter;ee&&(m=(m=ee[xr]||null)?vV(m.formAction):ee.getAttribute("formAction"),m!==null&&(N=m,ee=null));var ce=new pp("action","action",null,M,B);f.push({event:ce,listeners:[{instance:null,listener:function(){if(M.defaultPrevented){if(lv!==0){var Ee=ee?yV(B,ee):new FormData(B);FS(_,{pending:!0,data:Ee,method:B.method,action:N},null,Ee)}}else typeof N=="function"&&(ce.preventDefault(),Ee=ee?yV(B,ee):new FormData(B),FS(_,{pending:!0,data:Ee,method:B.method,action:N},N,Ee))},currentTarget:B}]})}}for(var RP=0;RP<Lg.length;RP++){var PP=Lg[RP],ene=PP.toLowerCase(),tne=PP[0].toUpperCase()+PP.slice(1);ys(ene,"on"+tne)}ys(Ta,"onAnimationEnd"),ys(uS,"onAnimationIteration"),ys(eo,"onAnimationStart"),ys("dblclick","onDoubleClick"),ys("focusin","onFocus"),ys("focusout","onBlur"),ys(GM,"onTransitionRun"),ys(lu,"onTransitionStart"),ys(_p,"onTransitionCancel"),ys(cu,"onTransitionEnd"),oe("onMouseEnter",["mouseout","mouseover"]),oe("onMouseLeave",["mouseout","mouseover"]),oe("onPointerEnter",["pointerout","pointerover"]),oe("onPointerLeave",["pointerout","pointerover"]),li("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),li("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),li("onBeforeInput",["compositionend","keypress","textInput","paste"]),li("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),li("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),li("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var qS="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ine=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(qS));function xV(f,m){m=(m&4)!==0;for(var _=0;_<f.length;_++){var M=f[_],B=M.event;M=M.listeners;e:{var N=void 0;if(m)for(var ee=M.length-1;0<=ee;ee--){var ce=M[ee],Ee=ce.instance,rt=ce.currentTarget;if(ce=ce.listener,Ee!==N&&B.isPropagationStopped())break e;N=ce,B.currentTarget=rt;try{N(B)}catch(Tt){Fd(Tt)}B.currentTarget=null,N=Ee}else for(ee=0;ee<M.length;ee++){if(ce=M[ee],Ee=ce.instance,rt=ce.currentTarget,ce=ce.listener,Ee!==N&&B.isPropagationStopped())break e;N=ce,B.currentTarget=rt;try{N(B)}catch(Tt){Fd(Tt)}B.currentTarget=null,N=Ee}}}}function un(f,m){var _=m[kr];_===void 0&&(_=m[kr]=new Set);var M=f+"__bubble";_.has(M)||(bV(m,f,2,!1),_.add(M))}function OP(f,m,_){var M=0;m&&(M|=4),bV(_,f,M,m)}var IE="_reactListening"+Math.random().toString(36).slice(2);function BP(f){if(!f[IE]){f[IE]=!0,Ri.forEach(function(_){_!=="selectionchange"&&(ine.has(_)||OP(_,!1,f),OP(_,!0,f))});var m=f.nodeType===9?f:f.ownerDocument;m===null||m[IE]||(m[IE]=!0,OP("selectionchange",!1,m))}}function bV(f,m,_,M){switch(jV(m)){case 2:var B=Dne;break;case 8:B=Rne;break;default:B=qP}_=B.bind(null,m,_,f),B=void 0,!_g||m!=="touchstart"&&m!=="touchmove"&&m!=="wheel"||(B=!0),M?B!==void 0?f.addEventListener(m,_,{capture:!0,passive:B}):f.addEventListener(m,_,!0):B!==void 0?f.addEventListener(m,_,{passive:B}):f.addEventListener(m,_,!1)}function IP(f,m,_,M,B){var N=M;if((m&1)===0&&(m&2)===0&&M!==null)e:for(;;){if(M===null)return;var ee=M.tag;if(ee===3||ee===4){var ce=M.stateNode.containerInfo;if(ce===B)break;if(ee===4)for(ee=M.return;ee!==null;){var Ee=ee.tag;if((Ee===3||Ee===4)&&ee.stateNode.containerInfo===B)return;ee=ee.return}for(;ce!==null;){if(ee=kt(ce),ee===null)return;if(Ee=ee.tag,Ee===5||Ee===6||Ee===26||Ee===27){M=N=ee;continue e}ce=ce.parentNode}}M=M.return}qb(function(){var rt=N,Tt=ty(_),Ot=[];e:{var ht=fy.get(f);if(ht!==void 0){var dt=pp,Li=f;switch(f){case"keypress":if(oh(_)===0)break e;case"keydown":case"keyup":dt=Zb;break;case"focusin":Li="focus",dt=ny;break;case"focusout":Li="blur",dt=ny;break;case"beforeblur":case"afterblur":dt=ny;break;case"click":if(_.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":dt=Kb;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":dt=gP;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":dt=eS;break;case Ta:case uS:case eo:dt=TM;break;case cu:dt=ru;break;case"scroll":case"scrollend":dt=wM;break;case"wheel":dt=vP;break;case"copy":case"cut":case"paste":dt=DM;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":dt=sy;break;case"toggle":case"beforetoggle":dt=ch}var Ci=(m&4)!==0,ar=!Ci&&(f==="scroll"||f==="scrollend"),qe=Ci?ht!==null?ht+"Capture":null:ht;Ci=[];for(var Fe=rt,tt;Fe!==null;){var Pt=Fe;if(tt=Pt.stateNode,Pt=Pt.tag,Pt!==5&&Pt!==26&&Pt!==27||tt===null||qe===null||(Pt=hp(Fe,qe),Pt!=null&&Ci.push(YS(Fe,Pt,tt))),ar)break;Fe=Fe.return}0<Ci.length&&(ht=new dt(ht,Li,null,_,Tt),Ot.push({event:ht,listeners:Ci}))}}if((m&7)===0){e:{if(ht=f==="mouseover"||f==="pointerover",dt=f==="mouseout"||f==="pointerout",ht&&_!==ey&&(Li=_.relatedTarget||_.fromElement)&&(kt(Li)||Li[Gr]))break e;if((dt||ht)&&(ht=Tt.window===Tt?Tt:(ht=Tt.ownerDocument)?ht.defaultView||ht.parentWindow:window,dt?(Li=_.relatedTarget||_.toElement,dt=rt,Li=Li?kt(Li):null,Li!==null&&(ar=s(Li),Ci=Li.tag,Li!==ar||Ci!==5&&Ci!==27&&Ci!==6)&&(Li=null)):(dt=null,Li=rt),dt!==Li)){if(Ci=Kb,Pt="onMouseLeave",qe="onMouseEnter",Fe="mouse",(f==="pointerout"||f==="pointerover")&&(Ci=sy,Pt="onPointerLeave",qe="onPointerEnter",Fe="pointer"),ar=dt==null?ht:oi(dt),tt=Li==null?ht:oi(Li),ht=new Ci(Pt,Fe+"leave",dt,_,Tt),ht.target=ar,ht.relatedTarget=tt,Pt=null,kt(Tt)===rt&&(Ci=new Ci(qe,Fe+"enter",Li,_,Tt),Ci.target=tt,Ci.relatedTarget=ar,Pt=Ci),ar=Pt,dt&&Li)t:{for(Ci=dt,qe=Li,Fe=0,tt=Ci;tt;tt=Ky(tt))Fe++;for(tt=0,Pt=qe;Pt;Pt=Ky(Pt))tt++;for(;0<Fe-tt;)Ci=Ky(Ci),Fe--;for(;0<tt-Fe;)qe=Ky(qe),tt--;for(;Fe--;){if(Ci===qe||qe!==null&&Ci===qe.alternate)break t;Ci=Ky(Ci),qe=Ky(qe)}Ci=null}else Ci=null;dt!==null&&SV(Ot,ht,dt,Ci,!1),Li!==null&&ar!==null&&SV(Ot,ar,Li,Ci,!0)}}e:{if(ht=rt?oi(rt):window,dt=ht.nodeName&&ht.nodeName.toLowerCase(),dt==="select"||dt==="input"&&ht.type==="file")var ni=oy;else if(rS(ht))if(ly)ni=dh;else{ni=FM;var ln=yP}else dt=ht.nodeName,!dt||dt.toLowerCase()!=="input"||ht.type!=="checkbox"&&ht.type!=="radio"?rt&&$0(rt.elementType)&&(ni=oy):ni=Og;if(ni&&(ni=ni(f,rt))){Ja(Ot,ni,_,Tt);break e}ln&&ln(f,ht,rt),f==="focusout"&&rt&&ht.type==="number"&&rt.memoizedProps.value!=null&&Bs(ht,"number",ht.value)}switch(ln=rt?oi(rt):window,f){case"focusin":(rS(ln)||ln.contentEditable==="true")&&(au=ln,uy=rt,Ig=null);break;case"focusout":Ig=uy=au=null;break;case"mousedown":hy=!0;break;case"contextmenu":case"mouseup":case"dragend":hy=!1,cS(Ot,_,Tt);break;case"selectionchange":if(lS)break;case"keydown":case"keyup":cS(Ot,_,Tt)}var ui;if(Eg)e:{switch(f){case"compositionstart":var Oi="onCompositionStart";break e;case"compositionend":Oi="onCompositionEnd";break e;case"compositionupdate":Oi="onCompositionUpdate";break e}Oi=void 0}else hh?Dg(f,_)&&(Oi="onCompositionEnd"):f==="keydown"&&_.keyCode===229&&(Oi="onCompositionStart");Oi&&(Cg&&_.locale!=="ko"&&(hh||Oi!=="onCompositionStart"?Oi==="onCompositionEnd"&&hh&&(ui=Qb()):(iu=Tt,Yb="value"in iu?iu.value:iu.textContent,hh=!0)),ln=LE(rt,Oi),0<ln.length&&(Oi=new ry(Oi,f,null,_,Tt),Ot.push({event:Oi,listeners:ln}),ui?Oi.data=ui:(ui=iS(_),ui!==null&&(Oi.data=ui)))),(ui=Tg?Rg(f,_):nS(f,_))&&(Oi=LE(rt,"onBeforeInput"),0<Oi.length&&(ln=new ry("onBeforeInput","beforeinput",null,_,Tt),Ot.push({event:ln,listeners:Oi}),ln.data=ui)),$ie(Ot,f,rt,_,Tt)}xV(Ot,m)})}function YS(f,m,_){return{instance:f,listener:m,currentTarget:_}}function LE(f,m){for(var _=m+"Capture",M=[];f!==null;){var B=f,N=B.stateNode;if(B=B.tag,B!==5&&B!==26&&B!==27||N===null||(B=hp(f,_),B!=null&&M.unshift(YS(f,B,N)),B=hp(f,m),B!=null&&M.push(YS(f,B,N))),f.tag===3)return M;f=f.return}return[]}function Ky(f){if(f===null)return null;do f=f.return;while(f&&f.tag!==5&&f.tag!==27);return f||null}function SV(f,m,_,M,B){for(var N=m._reactName,ee=[];_!==null&&_!==M;){var ce=_,Ee=ce.alternate,rt=ce.stateNode;if(ce=ce.tag,Ee!==null&&Ee===M)break;ce!==5&&ce!==26&&ce!==27||rt===null||(Ee=rt,B?(rt=hp(_,N),rt!=null&&ee.unshift(YS(_,rt,Ee))):B||(rt=hp(_,N),rt!=null&&ee.push(YS(_,rt,Ee)))),_=_.return}ee.length!==0&&f.push({event:m,listeners:ee})}var nne=/\r\n?/g,rne=/\u0000|\uFFFD/g;function _V(f){return(typeof f=="string"?f:""+f).replace(nne,`
`).replace(rne,"")}function AV(f,m){return m=_V(m),_V(f)===m}function UE(){}function sr(f,m,_,M,B,N){switch(_){case"children":typeof M=="string"?m==="body"||m==="textarea"&&M===""||Ma(f,M):(typeof M=="number"||typeof M=="bigint")&&m!=="body"&&Ma(f,""+M);break;case"className":wt(f,"class",M);break;case"tabIndex":wt(f,"tabindex",M);break;case"dir":case"role":case"viewBox":case"width":case"height":wt(f,_,M);break;case"style":xg(f,M,N);break;case"data":if(m!=="object"){wt(f,"data",M);break}case"src":case"href":if(M===""&&(m!=="a"||_!=="href")){f.removeAttribute(_);break}if(M==null||typeof M=="function"||typeof M=="symbol"||typeof M=="boolean"){f.removeAttribute(_);break}M=bg(""+M),f.setAttribute(_,M);break;case"action":case"formAction":if(typeof M=="function"){f.setAttribute(_,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof N=="function"&&(_==="formAction"?(m!=="input"&&sr(f,m,"name",B.name,B,null),sr(f,m,"formEncType",B.formEncType,B,null),sr(f,m,"formMethod",B.formMethod,B,null),sr(f,m,"formTarget",B.formTarget,B,null)):(sr(f,m,"encType",B.encType,B,null),sr(f,m,"method",B.method,B,null),sr(f,m,"target",B.target,B,null)));if(M==null||typeof M=="symbol"||typeof M=="boolean"){f.removeAttribute(_);break}M=bg(""+M),f.setAttribute(_,M);break;case"onClick":M!=null&&(f.onclick=UE);break;case"onScroll":M!=null&&un("scroll",f);break;case"onScrollEnd":M!=null&&un("scrollend",f);break;case"dangerouslySetInnerHTML":if(M!=null){if(typeof M!="object"||!("__html"in M))throw Error(n(61));if(_=M.__html,_!=null){if(B.children!=null)throw Error(n(60));f.innerHTML=_}}break;case"multiple":f.multiple=M&&typeof M!="function"&&typeof M!="symbol";break;case"muted":f.muted=M&&typeof M!="function"&&typeof M!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(M==null||typeof M=="function"||typeof M=="boolean"||typeof M=="symbol"){f.removeAttribute("xlink:href");break}_=bg(""+M),f.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",_);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":M!=null&&typeof M!="function"&&typeof M!="symbol"?f.setAttribute(_,""+M):f.removeAttribute(_);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":M&&typeof M!="function"&&typeof M!="symbol"?f.setAttribute(_,""):f.removeAttribute(_);break;case"capture":case"download":M===!0?f.setAttribute(_,""):M!==!1&&M!=null&&typeof M!="function"&&typeof M!="symbol"?f.setAttribute(_,M):f.removeAttribute(_);break;case"cols":case"rows":case"size":case"span":M!=null&&typeof M!="function"&&typeof M!="symbol"&&!isNaN(M)&&1<=M?f.setAttribute(_,M):f.removeAttribute(_);break;case"rowSpan":case"start":M==null||typeof M=="function"||typeof M=="symbol"||isNaN(M)?f.removeAttribute(_):f.setAttribute(_,M);break;case"popover":un("beforetoggle",f),un("toggle",f),Rt(f,"popover",M);break;case"xlinkActuate":Nt(f,"http://www.w3.org/1999/xlink","xlink:actuate",M);break;case"xlinkArcrole":Nt(f,"http://www.w3.org/1999/xlink","xlink:arcrole",M);break;case"xlinkRole":Nt(f,"http://www.w3.org/1999/xlink","xlink:role",M);break;case"xlinkShow":Nt(f,"http://www.w3.org/1999/xlink","xlink:show",M);break;case"xlinkTitle":Nt(f,"http://www.w3.org/1999/xlink","xlink:title",M);break;case"xlinkType":Nt(f,"http://www.w3.org/1999/xlink","xlink:type",M);break;case"xmlBase":Nt(f,"http://www.w3.org/XML/1998/namespace","xml:base",M);break;case"xmlLang":Nt(f,"http://www.w3.org/XML/1998/namespace","xml:lang",M);break;case"xmlSpace":Nt(f,"http://www.w3.org/XML/1998/namespace","xml:space",M);break;case"is":Rt(f,"is",M);break;case"innerText":case"textContent":break;default:(!(2<_.length)||_[0]!=="o"&&_[0]!=="O"||_[1]!=="n"&&_[1]!=="N")&&(_=Wb.get(_)||_,Rt(f,_,M))}}function LP(f,m,_,M,B,N){switch(_){case"style":xg(f,M,N);break;case"dangerouslySetInnerHTML":if(M!=null){if(typeof M!="object"||!("__html"in M))throw Error(n(61));if(_=M.__html,_!=null){if(B.children!=null)throw Error(n(60));f.innerHTML=_}}break;case"children":typeof M=="string"?Ma(f,M):(typeof M=="number"||typeof M=="bigint")&&Ma(f,""+M);break;case"onScroll":M!=null&&un("scroll",f);break;case"onScrollEnd":M!=null&&un("scrollend",f);break;case"onClick":M!=null&&(f.onclick=UE);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Pi.hasOwnProperty(_))e:{if(_[0]==="o"&&_[1]==="n"&&(B=_.endsWith("Capture"),m=_.slice(2,B?_.length-7:void 0),N=f[xr]||null,N=N!=null?N[_]:null,typeof N=="function"&&f.removeEventListener(m,N,B),typeof M=="function")){typeof N!="function"&&N!==null&&(_ in f?f[_]=null:f.hasAttribute(_)&&f.removeAttribute(_)),f.addEventListener(m,M,B);break e}_ in f?f[_]=M:M===!0?f.setAttribute(_,""):Rt(f,_,M)}}}function Ia(f,m,_){switch(m){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":un("error",f),un("load",f);var M=!1,B=!1,N;for(N in _)if(_.hasOwnProperty(N)){var ee=_[N];if(ee!=null)switch(N){case"src":M=!0;break;case"srcSet":B=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,m));default:sr(f,m,N,ee,_,null)}}B&&sr(f,m,"srcSet",_.srcSet,_,null),M&&sr(f,m,"src",_.src,_,null);return;case"input":un("invalid",f);var ce=N=ee=B=null,Ee=null,rt=null;for(M in _)if(_.hasOwnProperty(M)){var Tt=_[M];if(Tt!=null)switch(M){case"name":B=Tt;break;case"type":ee=Tt;break;case"checked":Ee=Tt;break;case"defaultChecked":rt=Tt;break;case"value":N=Tt;break;case"defaultValue":ce=Tt;break;case"children":case"dangerouslySetInnerHTML":if(Tt!=null)throw Error(n(137,m));break;default:sr(f,m,M,Tt,_,null)}}Vn(f,N,ce,Ee,rt,ee,B,!1),Wn(f);return;case"select":un("invalid",f),M=ee=N=null;for(B in _)if(_.hasOwnProperty(B)&&(ce=_[B],ce!=null))switch(B){case"value":N=ce;break;case"defaultValue":ee=ce;break;case"multiple":M=ce;default:sr(f,m,B,ce,_,null)}m=N,_=ee,f.multiple=!!M,m!=null?jr(f,!!M,m,!1):_!=null&&jr(f,!!M,_,!0);return;case"textarea":un("invalid",f),N=B=M=null;for(ee in _)if(_.hasOwnProperty(ee)&&(ce=_[ee],ce!=null))switch(ee){case"value":M=ce;break;case"defaultValue":B=ce;break;case"children":N=ce;break;case"dangerouslySetInnerHTML":if(ce!=null)throw Error(n(91));break;default:sr(f,m,ee,ce,_,null)}vs(f,M,B,N),Wn(f);return;case"option":for(Ee in _)if(_.hasOwnProperty(Ee)&&(M=_[Ee],M!=null))switch(Ee){case"selected":f.selected=M&&typeof M!="function"&&typeof M!="symbol";break;default:sr(f,m,Ee,M,_,null)}return;case"dialog":un("beforetoggle",f),un("toggle",f),un("cancel",f),un("close",f);break;case"iframe":case"object":un("load",f);break;case"video":case"audio":for(M=0;M<qS.length;M++)un(qS[M],f);break;case"image":un("error",f),un("load",f);break;case"details":un("toggle",f);break;case"embed":case"source":case"link":un("error",f),un("load",f);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(rt in _)if(_.hasOwnProperty(rt)&&(M=_[rt],M!=null))switch(rt){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,m));default:sr(f,m,rt,M,_,null)}return;default:if($0(m)){for(Tt in _)_.hasOwnProperty(Tt)&&(M=_[Tt],M!==void 0&&LP(f,m,Tt,M,_,void 0));return}}for(ce in _)_.hasOwnProperty(ce)&&(M=_[ce],M!=null&&sr(f,m,ce,M,_,null))}function sne(f,m,_,M){switch(m){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var B=null,N=null,ee=null,ce=null,Ee=null,rt=null,Tt=null;for(dt in _){var Ot=_[dt];if(_.hasOwnProperty(dt)&&Ot!=null)switch(dt){case"checked":break;case"value":break;case"defaultValue":Ee=Ot;default:M.hasOwnProperty(dt)||sr(f,m,dt,null,M,Ot)}}for(var ht in M){var dt=M[ht];if(Ot=_[ht],M.hasOwnProperty(ht)&&(dt!=null||Ot!=null))switch(ht){case"type":N=dt;break;case"name":B=dt;break;case"checked":rt=dt;break;case"defaultChecked":Tt=dt;break;case"value":ee=dt;break;case"defaultValue":ce=dt;break;case"children":case"dangerouslySetInnerHTML":if(dt!=null)throw Error(n(137,m));break;default:dt!==Ot&&sr(f,m,ht,dt,M,Ot)}}rc(f,ee,ce,Ee,rt,Tt,N,B);return;case"select":dt=ee=ce=ht=null;for(N in _)if(Ee=_[N],_.hasOwnProperty(N)&&Ee!=null)switch(N){case"value":break;case"multiple":dt=Ee;default:M.hasOwnProperty(N)||sr(f,m,N,null,M,Ee)}for(B in M)if(N=M[B],Ee=_[B],M.hasOwnProperty(B)&&(N!=null||Ee!=null))switch(B){case"value":ht=N;break;case"defaultValue":ce=N;break;case"multiple":ee=N;default:N!==Ee&&sr(f,m,B,N,M,Ee)}m=ce,_=ee,M=dt,ht!=null?jr(f,!!_,ht,!1):!!M!=!!_&&(m!=null?jr(f,!!_,m,!0):jr(f,!!_,_?[]:"",!1));return;case"textarea":dt=ht=null;for(ce in _)if(B=_[ce],_.hasOwnProperty(ce)&&B!=null&&!M.hasOwnProperty(ce))switch(ce){case"value":break;case"children":break;default:sr(f,m,ce,null,M,B)}for(ee in M)if(B=M[ee],N=_[ee],M.hasOwnProperty(ee)&&(B!=null||N!=null))switch(ee){case"value":ht=B;break;case"defaultValue":dt=B;break;case"children":break;case"dangerouslySetInnerHTML":if(B!=null)throw Error(n(91));break;default:B!==N&&sr(f,m,ee,B,M,N)}gs(f,ht,dt);return;case"option":for(var Li in _)if(ht=_[Li],_.hasOwnProperty(Li)&&ht!=null&&!M.hasOwnProperty(Li))switch(Li){case"selected":f.selected=!1;break;default:sr(f,m,Li,null,M,ht)}for(Ee in M)if(ht=M[Ee],dt=_[Ee],M.hasOwnProperty(Ee)&&ht!==dt&&(ht!=null||dt!=null))switch(Ee){case"selected":f.selected=ht&&typeof ht!="function"&&typeof ht!="symbol";break;default:sr(f,m,Ee,ht,M,dt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ci in _)ht=_[Ci],_.hasOwnProperty(Ci)&&ht!=null&&!M.hasOwnProperty(Ci)&&sr(f,m,Ci,null,M,ht);for(rt in M)if(ht=M[rt],dt=_[rt],M.hasOwnProperty(rt)&&ht!==dt&&(ht!=null||dt!=null))switch(rt){case"children":case"dangerouslySetInnerHTML":if(ht!=null)throw Error(n(137,m));break;default:sr(f,m,rt,ht,M,dt)}return;default:if($0(m)){for(var ar in _)ht=_[ar],_.hasOwnProperty(ar)&&ht!==void 0&&!M.hasOwnProperty(ar)&&LP(f,m,ar,void 0,M,ht);for(Tt in M)ht=M[Tt],dt=_[Tt],!M.hasOwnProperty(Tt)||ht===dt||ht===void 0&&dt===void 0||LP(f,m,Tt,ht,M,dt);return}}for(var qe in _)ht=_[qe],_.hasOwnProperty(qe)&&ht!=null&&!M.hasOwnProperty(qe)&&sr(f,m,qe,null,M,ht);for(Ot in M)ht=M[Ot],dt=_[Ot],!M.hasOwnProperty(Ot)||ht===dt||ht==null&&dt==null||sr(f,m,Ot,ht,M,dt)}var UP=null,NP=null;function NE(f){return f.nodeType===9?f:f.ownerDocument}function wV(f){switch(f){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function MV(f,m){if(f===0)switch(m){case"svg":return 1;case"math":return 2;default:return 0}return f===1&&m==="foreignObject"?0:f}function zP(f,m){return f==="textarea"||f==="noscript"||typeof m.children=="string"||typeof m.children=="number"||typeof m.children=="bigint"||typeof m.dangerouslySetInnerHTML=="object"&&m.dangerouslySetInnerHTML!==null&&m.dangerouslySetInnerHTML.__html!=null}var FP=null;function ane(){var f=window.event;return f&&f.type==="popstate"?f===FP?!1:(FP=f,!0):(FP=null,!1)}var EV=typeof setTimeout=="function"?setTimeout:void 0,one=typeof clearTimeout=="function"?clearTimeout:void 0,TV=typeof Promise=="function"?Promise:void 0,lne=typeof queueMicrotask=="function"?queueMicrotask:typeof TV<"u"?function(f){return TV.resolve(null).then(f).catch(cne)}:EV;function cne(f){setTimeout(function(){throw f})}function Kp(f){return f==="head"}function CV(f,m){var _=m,M=0,B=0;do{var N=_.nextSibling;if(f.removeChild(_),N&&N.nodeType===8)if(_=N.data,_==="/$"){if(0<M&&8>M){_=M;var ee=f.ownerDocument;if(_&1&&QS(ee.documentElement),_&2&&QS(ee.body),_&4)for(_=ee.head,QS(_),ee=_.firstChild;ee;){var ce=ee.nextSibling,Ee=ee.nodeName;ee[Ye]||Ee==="SCRIPT"||Ee==="STYLE"||Ee==="LINK"&&ee.rel.toLowerCase()==="stylesheet"||_.removeChild(ee),ee=ce}}if(B===0){f.removeChild(N),n_(m);return}B--}else _==="$"||_==="$?"||_==="$!"?B++:M=_.charCodeAt(0)-48;else M=0;_=N}while(_);n_(m)}function VP(f){var m=f.firstChild;for(m&&m.nodeType===10&&(m=m.nextSibling);m;){var _=m;switch(m=m.nextSibling,_.nodeName){case"HTML":case"HEAD":case"BODY":VP(_),ot(_);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(_.rel.toLowerCase()==="stylesheet")continue}f.removeChild(_)}}function une(f,m,_,M){for(;f.nodeType===1;){var B=_;if(f.nodeName.toLowerCase()!==m.toLowerCase()){if(!M&&(f.nodeName!=="INPUT"||f.type!=="hidden"))break}else if(M){if(!f[Ye])switch(m){case"meta":if(!f.hasAttribute("itemprop"))break;return f;case"link":if(N=f.getAttribute("rel"),N==="stylesheet"&&f.hasAttribute("data-precedence"))break;if(N!==B.rel||f.getAttribute("href")!==(B.href==null||B.href===""?null:B.href)||f.getAttribute("crossorigin")!==(B.crossOrigin==null?null:B.crossOrigin)||f.getAttribute("title")!==(B.title==null?null:B.title))break;return f;case"style":if(f.hasAttribute("data-precedence"))break;return f;case"script":if(N=f.getAttribute("src"),(N!==(B.src==null?null:B.src)||f.getAttribute("type")!==(B.type==null?null:B.type)||f.getAttribute("crossorigin")!==(B.crossOrigin==null?null:B.crossOrigin))&&N&&f.hasAttribute("async")&&!f.hasAttribute("itemprop"))break;return f;default:return f}}else if(m==="input"&&f.type==="hidden"){var N=B.name==null?null:""+B.name;if(B.type==="hidden"&&f.getAttribute("name")===N)return f}else return f;if(f=Mu(f.nextSibling),f===null)break}return null}function hne(f,m,_){if(m==="")return null;for(;f.nodeType!==3;)if((f.nodeType!==1||f.nodeName!=="INPUT"||f.type!=="hidden")&&!_||(f=Mu(f.nextSibling),f===null))return null;return f}function HP(f){return f.data==="$!"||f.data==="$?"&&f.ownerDocument.readyState==="complete"}function dne(f,m){var _=f.ownerDocument;if(f.data!=="$?"||_.readyState==="complete")m();else{var M=function(){m(),_.removeEventListener("DOMContentLoaded",M)};_.addEventListener("DOMContentLoaded",M),f._reactRetry=M}}function Mu(f){for(;f!=null;f=f.nextSibling){var m=f.nodeType;if(m===1||m===3)break;if(m===8){if(m=f.data,m==="$"||m==="$!"||m==="$?"||m==="F!"||m==="F")break;if(m==="/$")return null}}return f}var GP=null;function DV(f){f=f.previousSibling;for(var m=0;f;){if(f.nodeType===8){var _=f.data;if(_==="$"||_==="$!"||_==="$?"){if(m===0)return f;m--}else _==="/$"&&m++}f=f.previousSibling}return null}function RV(f,m,_){switch(m=NE(_),f){case"html":if(f=m.documentElement,!f)throw Error(n(452));return f;case"head":if(f=m.head,!f)throw Error(n(453));return f;case"body":if(f=m.body,!f)throw Error(n(454));return f;default:throw Error(n(451))}}function QS(f){for(var m=f.attributes;m.length;)f.removeAttributeNode(m[0]);ot(f)}var Ac=new Map,PV=new Set;function zE(f){return typeof f.getRootNode=="function"?f.getRootNode():f.nodeType===9?f:f.ownerDocument}var ef=X.d;X.d={f:fne,r:pne,D:mne,C:gne,L:vne,m:yne,X:bne,S:xne,M:Sne};function fne(){var f=ef.f(),m=Sc();return f||m}function pne(f){var m=si(f);m!==null&&m.tag===5&&m.type==="form"?vE(m):ef.r(f)}var Jy=typeof document>"u"?null:document;function OV(f,m,_){var M=Jy;if(M&&typeof m=="string"&&m){var B=Dn(m);B='link[rel="'+f+'"][href="'+B+'"]',typeof _=="string"&&(B+='[crossorigin="'+_+'"]'),PV.has(B)||(PV.add(B),f={rel:f,crossOrigin:_,href:m},M.querySelector(B)===null&&(m=M.createElement("link"),Ia(m,"link",f),fi(m),M.head.appendChild(m)))}}function mne(f){ef.D(f),OV("dns-prefetch",f,null)}function gne(f,m){ef.C(f,m),OV("preconnect",f,m)}function vne(f,m,_){ef.L(f,m,_);var M=Jy;if(M&&f&&m){var B='link[rel="preload"][as="'+Dn(m)+'"]';m==="image"&&_&&_.imageSrcSet?(B+='[imagesrcset="'+Dn(_.imageSrcSet)+'"]',typeof _.imageSizes=="string"&&(B+='[imagesizes="'+Dn(_.imageSizes)+'"]')):B+='[href="'+Dn(f)+'"]';var N=B;switch(m){case"style":N=Zy(f);break;case"script":N=$y(f)}Ac.has(N)||(f=u({rel:"preload",href:m==="image"&&_&&_.imageSrcSet?void 0:f,as:m},_),Ac.set(N,f),M.querySelector(B)!==null||m==="style"&&M.querySelector(KS(N))||m==="script"&&M.querySelector(JS(N))||(m=M.createElement("link"),Ia(m,"link",f),fi(m),M.head.appendChild(m)))}}function yne(f,m){ef.m(f,m);var _=Jy;if(_&&f){var M=m&&typeof m.as=="string"?m.as:"script",B='link[rel="modulepreload"][as="'+Dn(M)+'"][href="'+Dn(f)+'"]',N=B;switch(M){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":N=$y(f)}if(!Ac.has(N)&&(f=u({rel:"modulepreload",href:f},m),Ac.set(N,f),_.querySelector(B)===null)){switch(M){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(_.querySelector(JS(N)))return}M=_.createElement("link"),Ia(M,"link",f),fi(M),_.head.appendChild(M)}}}function xne(f,m,_){ef.S(f,m,_);var M=Jy;if(M&&f){var B=Zt(M).hoistableStyles,N=Zy(f);m=m||"default";var ee=B.get(N);if(!ee){var ce={loading:0,preload:null};if(ee=M.querySelector(KS(N)))ce.loading=5;else{f=u({rel:"stylesheet",href:f,"data-precedence":m},_),(_=Ac.get(N))&&kP(f,_);var Ee=ee=M.createElement("link");fi(Ee),Ia(Ee,"link",f),Ee._p=new Promise(function(rt,Tt){Ee.onload=rt,Ee.onerror=Tt}),Ee.addEventListener("load",function(){ce.loading|=1}),Ee.addEventListener("error",function(){ce.loading|=2}),ce.loading|=4,FE(ee,m,M)}ee={type:"stylesheet",instance:ee,count:1,state:ce},B.set(N,ee)}}}function bne(f,m){ef.X(f,m);var _=Jy;if(_&&f){var M=Zt(_).hoistableScripts,B=$y(f),N=M.get(B);N||(N=_.querySelector(JS(B)),N||(f=u({src:f,async:!0},m),(m=Ac.get(B))&&jP(f,m),N=_.createElement("script"),fi(N),Ia(N,"link",f),_.head.appendChild(N)),N={type:"script",instance:N,count:1,state:null},M.set(B,N))}}function Sne(f,m){ef.M(f,m);var _=Jy;if(_&&f){var M=Zt(_).hoistableScripts,B=$y(f),N=M.get(B);N||(N=_.querySelector(JS(B)),N||(f=u({src:f,async:!0,type:"module"},m),(m=Ac.get(B))&&jP(f,m),N=_.createElement("script"),fi(N),Ia(N,"link",f),_.head.appendChild(N)),N={type:"script",instance:N,count:1,state:null},M.set(B,N))}}function BV(f,m,_,M){var B=(B=le.current)?zE(B):null;if(!B)throw Error(n(446));switch(f){case"meta":case"title":return null;case"style":return typeof _.precedence=="string"&&typeof _.href=="string"?(m=Zy(_.href),_=Zt(B).hoistableStyles,M=_.get(m),M||(M={type:"style",instance:null,count:0,state:null},_.set(m,M)),M):{type:"void",instance:null,count:0,state:null};case"link":if(_.rel==="stylesheet"&&typeof _.href=="string"&&typeof _.precedence=="string"){f=Zy(_.href);var N=Zt(B).hoistableStyles,ee=N.get(f);if(ee||(B=B.ownerDocument||B,ee={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},N.set(f,ee),(N=B.querySelector(KS(f)))&&!N._p&&(ee.instance=N,ee.state.loading=5),Ac.has(f)||(_={rel:"preload",as:"style",href:_.href,crossOrigin:_.crossOrigin,integrity:_.integrity,media:_.media,hrefLang:_.hrefLang,referrerPolicy:_.referrerPolicy},Ac.set(f,_),N||_ne(B,f,_,ee.state))),m&&M===null)throw Error(n(528,""));return ee}if(m&&M!==null)throw Error(n(529,""));return null;case"script":return m=_.async,_=_.src,typeof _=="string"&&m&&typeof m!="function"&&typeof m!="symbol"?(m=$y(_),_=Zt(B).hoistableScripts,M=_.get(m),M||(M={type:"script",instance:null,count:0,state:null},_.set(m,M)),M):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,f))}}function Zy(f){return'href="'+Dn(f)+'"'}function KS(f){return'link[rel="stylesheet"]['+f+"]"}function IV(f){return u({},f,{"data-precedence":f.precedence,precedence:null})}function _ne(f,m,_,M){f.querySelector('link[rel="preload"][as="style"]['+m+"]")?M.loading=1:(m=f.createElement("link"),M.preload=m,m.addEventListener("load",function(){return M.loading|=1}),m.addEventListener("error",function(){return M.loading|=2}),Ia(m,"link",_),fi(m),f.head.appendChild(m))}function $y(f){return'[src="'+Dn(f)+'"]'}function JS(f){return"script[async]"+f}function LV(f,m,_){if(m.count++,m.instance===null)switch(m.type){case"style":var M=f.querySelector('style[data-href~="'+Dn(_.href)+'"]');if(M)return m.instance=M,fi(M),M;var B=u({},_,{"data-href":_.href,"data-precedence":_.precedence,href:null,precedence:null});return M=(f.ownerDocument||f).createElement("style"),fi(M),Ia(M,"style",B),FE(M,_.precedence,f),m.instance=M;case"stylesheet":B=Zy(_.href);var N=f.querySelector(KS(B));if(N)return m.state.loading|=4,m.instance=N,fi(N),N;M=IV(_),(B=Ac.get(B))&&kP(M,B),N=(f.ownerDocument||f).createElement("link"),fi(N);var ee=N;return ee._p=new Promise(function(ce,Ee){ee.onload=ce,ee.onerror=Ee}),Ia(N,"link",M),m.state.loading|=4,FE(N,_.precedence,f),m.instance=N;case"script":return N=$y(_.src),(B=f.querySelector(JS(N)))?(m.instance=B,fi(B),B):(M=_,(B=Ac.get(N))&&(M=u({},_),jP(M,B)),f=f.ownerDocument||f,B=f.createElement("script"),fi(B),Ia(B,"link",M),f.head.appendChild(B),m.instance=B);case"void":return null;default:throw Error(n(443,m.type))}else m.type==="stylesheet"&&(m.state.loading&4)===0&&(M=m.instance,m.state.loading|=4,FE(M,_.precedence,f));return m.instance}function FE(f,m,_){for(var M=_.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),B=M.length?M[M.length-1]:null,N=B,ee=0;ee<M.length;ee++){var ce=M[ee];if(ce.dataset.precedence===m)N=ce;else if(N!==B)break}N?N.parentNode.insertBefore(f,N.nextSibling):(m=_.nodeType===9?_.head:_,m.insertBefore(f,m.firstChild))}function kP(f,m){f.crossOrigin==null&&(f.crossOrigin=m.crossOrigin),f.referrerPolicy==null&&(f.referrerPolicy=m.referrerPolicy),f.title==null&&(f.title=m.title)}function jP(f,m){f.crossOrigin==null&&(f.crossOrigin=m.crossOrigin),f.referrerPolicy==null&&(f.referrerPolicy=m.referrerPolicy),f.integrity==null&&(f.integrity=m.integrity)}var VE=null;function UV(f,m,_){if(VE===null){var M=new Map,B=VE=new Map;B.set(_,M)}else B=VE,M=B.get(_),M||(M=new Map,B.set(_,M));if(M.has(f))return M;for(M.set(f,null),_=_.getElementsByTagName(f),B=0;B<_.length;B++){var N=_[B];if(!(N[Ye]||N[jn]||f==="link"&&N.getAttribute("rel")==="stylesheet")&&N.namespaceURI!=="http://www.w3.org/2000/svg"){var ee=N.getAttribute(m)||"";ee=f+ee;var ce=M.get(ee);ce?ce.push(N):M.set(ee,[N])}}return M}function NV(f,m,_){f=f.ownerDocument||f,f.head.insertBefore(_,m==="title"?f.querySelector("head > title"):null)}function Ane(f,m,_){if(_===1||m.itemProp!=null)return!1;switch(f){case"meta":case"title":return!0;case"style":if(typeof m.precedence!="string"||typeof m.href!="string"||m.href==="")break;return!0;case"link":if(typeof m.rel!="string"||typeof m.href!="string"||m.href===""||m.onLoad||m.onError)break;switch(m.rel){case"stylesheet":return f=m.disabled,typeof m.precedence=="string"&&f==null;default:return!0}case"script":if(m.async&&typeof m.async!="function"&&typeof m.async!="symbol"&&!m.onLoad&&!m.onError&&m.src&&typeof m.src=="string")return!0}return!1}function zV(f){return!(f.type==="stylesheet"&&(f.state.loading&3)===0)}var ZS=null;function wne(){}function Mne(f,m,_){if(ZS===null)throw Error(n(475));var M=ZS;if(m.type==="stylesheet"&&(typeof _.media!="string"||matchMedia(_.media).matches!==!1)&&(m.state.loading&4)===0){if(m.instance===null){var B=Zy(_.href),N=f.querySelector(KS(B));if(N){f=N._p,f!==null&&typeof f=="object"&&typeof f.then=="function"&&(M.count++,M=HE.bind(M),f.then(M,M)),m.state.loading|=4,m.instance=N,fi(N);return}N=f.ownerDocument||f,_=IV(_),(B=Ac.get(B))&&kP(_,B),N=N.createElement("link"),fi(N);var ee=N;ee._p=new Promise(function(ce,Ee){ee.onload=ce,ee.onerror=Ee}),Ia(N,"link",_),m.instance=N}M.stylesheets===null&&(M.stylesheets=new Map),M.stylesheets.set(m,f),(f=m.state.preload)&&(m.state.loading&3)===0&&(M.count++,m=HE.bind(M),f.addEventListener("load",m),f.addEventListener("error",m))}}function Ene(){if(ZS===null)throw Error(n(475));var f=ZS;return f.stylesheets&&f.count===0&&WP(f,f.stylesheets),0<f.count?function(m){var _=setTimeout(function(){if(f.stylesheets&&WP(f,f.stylesheets),f.unsuspend){var M=f.unsuspend;f.unsuspend=null,M()}},6e4);return f.unsuspend=m,function(){f.unsuspend=null,clearTimeout(_)}}:null}function HE(){if(this.count--,this.count===0){if(this.stylesheets)WP(this,this.stylesheets);else if(this.unsuspend){var f=this.unsuspend;this.unsuspend=null,f()}}}var GE=null;function WP(f,m){f.stylesheets=null,f.unsuspend!==null&&(f.count++,GE=new Map,m.forEach(Tne,f),GE=null,HE.call(f))}function Tne(f,m){if(!(m.state.loading&4)){var _=GE.get(f);if(_)var M=_.get(null);else{_=new Map,GE.set(f,_);for(var B=f.querySelectorAll("link[data-precedence],style[data-precedence]"),N=0;N<B.length;N++){var ee=B[N];(ee.nodeName==="LINK"||ee.getAttribute("media")!=="not all")&&(_.set(ee.dataset.precedence,ee),M=ee)}M&&_.set(null,M)}B=m.instance,ee=B.getAttribute("data-precedence"),N=_.get(ee)||M,N===M&&_.set(null,B),_.set(ee,B),this.count++,M=HE.bind(this),B.addEventListener("load",M),B.addEventListener("error",M),N?N.parentNode.insertBefore(B,N.nextSibling):(f=f.nodeType===9?f.head:f,f.insertBefore(B,f.firstChild)),m.state.loading|=4}}var $S={$$typeof:w,Provider:null,Consumer:null,_currentValue:W,_currentValue2:W,_threadCount:0};function Cne(f,m,_,M,B,N,ee,ce){this.tag=1,this.containerInfo=f,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=De(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=De(0),this.hiddenUpdates=De(null),this.identifierPrefix=M,this.onUncaughtError=B,this.onCaughtError=N,this.onRecoverableError=ee,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ce,this.incompleteTransitions=new Map}function FV(f,m,_,M,B,N,ee,ce,Ee,rt,Tt,Ot){return f=new Cne(f,m,_,ee,ce,Ee,rt,Ot),m=1,N===!0&&(m|=24),N=to(3,null,null,m),f.current=N,N.stateNode=f,m=by(),m.refCount++,f.pooledCache=m,m.refCount++,N.memoizedState={element:M,isDehydrated:_,cache:m},AS(N),f}function VV(f){return f?(f=mh,f):mh}function HV(f,m,_,M,B,N){B=VV(B),M.context===null?M.context=B:M.pendingContext=B,M=uc(m),M.payload={element:_},N=N===void 0?null:N,N!==null&&(M.callback=N),_=mu(f,M,m),_!==null&&(Ba(_,f,m),Ud(_,f,m))}function GV(f,m){if(f=f.memoizedState,f!==null&&f.dehydrated!==null){var _=f.retryLane;f.retryLane=_!==0&&_<m?_:m}}function XP(f,m){GV(f,m),(f=f.alternate)&&GV(f,m)}function kV(f){if(f.tag===13){var m=uu(f,67108864);m!==null&&Ba(m,f,67108864),XP(f,67108864)}}var kE=!0;function Dne(f,m,_,M){var B=F.T;F.T=null;var N=X.p;try{X.p=2,qP(f,m,_,M)}finally{X.p=N,F.T=B}}function Rne(f,m,_,M){var B=F.T;F.T=null;var N=X.p;try{X.p=8,qP(f,m,_,M)}finally{X.p=N,F.T=B}}function qP(f,m,_,M){if(kE){var B=YP(M);if(B===null)IP(f,m,M,jE,_),WV(f,M);else if(One(B,f,m,_,M))M.stopPropagation();else if(WV(f,M),m&4&&-1<Pne.indexOf(f)){for(;B!==null;){var N=si(B);if(N!==null)switch(N.tag){case 3:if(N=N.stateNode,N.current.memoizedState.isDehydrated){var ee=_t(N.pendingLanes);if(ee!==0){var ce=N;for(ce.pendingLanes|=2,ce.entangledLanes|=2;ee;){var Ee=1<<31-st(ee);ce.entanglements[1]|=Ee,ee&=~Ee}Fh(N),(Bn&6)===0&&(sa=je()+500,XS(0))}}break;case 13:ce=uu(N,2),ce!==null&&Ba(ce,N,2),Sc(),XP(N,2)}if(N=YP(M),N===null&&IP(f,m,M,jE,_),N===B)break;B=N}B!==null&&M.stopPropagation()}else IP(f,m,M,null,_)}}function YP(f){return f=ty(f),QP(f)}var jE=null;function QP(f){if(jE=null,f=kt(f),f!==null){var m=s(f);if(m===null)f=null;else{var _=m.tag;if(_===13){if(f=a(m),f!==null)return f;f=null}else if(_===3){if(m.stateNode.current.memoizedState.isDehydrated)return m.tag===3?m.stateNode.containerInfo:null;f=null}else m!==f&&(f=null)}}return jE=f,null}function jV(f){switch(f){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Oe()){case Qe:return 2;case $e:return 8;case gt:case pe:return 32;case k:return 268435456;default:return 32}default:return 32}}var KP=!1,Jp=null,Zp=null,$p=null,e_=new Map,t_=new Map,em=[],Pne="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function WV(f,m){switch(f){case"focusin":case"focusout":Jp=null;break;case"dragenter":case"dragleave":Zp=null;break;case"mouseover":case"mouseout":$p=null;break;case"pointerover":case"pointerout":e_.delete(m.pointerId);break;case"gotpointercapture":case"lostpointercapture":t_.delete(m.pointerId)}}function i_(f,m,_,M,B,N){return f===null||f.nativeEvent!==N?(f={blockedOn:m,domEventName:_,eventSystemFlags:M,nativeEvent:N,targetContainers:[B]},m!==null&&(m=si(m),m!==null&&kV(m)),f):(f.eventSystemFlags|=M,m=f.targetContainers,B!==null&&m.indexOf(B)===-1&&m.push(B),f)}function One(f,m,_,M,B){switch(m){case"focusin":return Jp=i_(Jp,f,m,_,M,B),!0;case"dragenter":return Zp=i_(Zp,f,m,_,M,B),!0;case"mouseover":return $p=i_($p,f,m,_,M,B),!0;case"pointerover":var N=B.pointerId;return e_.set(N,i_(e_.get(N)||null,f,m,_,M,B)),!0;case"gotpointercapture":return N=B.pointerId,t_.set(N,i_(t_.get(N)||null,f,m,_,M,B)),!0}return!1}function XV(f){var m=kt(f.target);if(m!==null){var _=s(m);if(_!==null){if(m=_.tag,m===13){if(m=a(_),m!==null){f.blockedOn=m,An(f.priority,function(){if(_.tag===13){var M=Tr();M=Vt(M);var B=uu(_,M);B!==null&&Ba(B,_,M),XP(_,M)}});return}}else if(m===3&&_.stateNode.current.memoizedState.isDehydrated){f.blockedOn=_.tag===3?_.stateNode.containerInfo:null;return}}}f.blockedOn=null}function WE(f){if(f.blockedOn!==null)return!1;for(var m=f.targetContainers;0<m.length;){var _=YP(f.nativeEvent);if(_===null){_=f.nativeEvent;var M=new _.constructor(_.type,_);ey=M,_.target.dispatchEvent(M),ey=null}else return m=si(_),m!==null&&kV(m),f.blockedOn=_,!1;m.shift()}return!0}function qV(f,m,_){WE(f)&&_.delete(m)}function Bne(){KP=!1,Jp!==null&&WE(Jp)&&(Jp=null),Zp!==null&&WE(Zp)&&(Zp=null),$p!==null&&WE($p)&&($p=null),e_.forEach(qV),t_.forEach(qV)}function XE(f,m){f.blockedOn===m&&(f.blockedOn=null,KP||(KP=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,Bne)))}var qE=null;function YV(f){qE!==f&&(qE=f,e.unstable_scheduleCallback(e.unstable_NormalPriority,function(){qE===f&&(qE=null);for(var m=0;m<f.length;m+=3){var _=f[m],M=f[m+1],B=f[m+2];if(typeof M!="function"){if(QP(M||_)===null)continue;break}var N=si(_);N!==null&&(f.splice(m,3),m-=3,FS(N,{pending:!0,data:B,method:_.method,action:M},M,B))}}))}function n_(f){function m(Ee){return XE(Ee,f)}Jp!==null&&XE(Jp,f),Zp!==null&&XE(Zp,f),$p!==null&&XE($p,f),e_.forEach(m),t_.forEach(m);for(var _=0;_<em.length;_++){var M=em[_];M.blockedOn===f&&(M.blockedOn=null)}for(;0<em.length&&(_=em[0],_.blockedOn===null);)XV(_),_.blockedOn===null&&em.shift();if(_=(f.ownerDocument||f).$$reactFormReplay,_!=null)for(M=0;M<_.length;M+=3){var B=_[M],N=_[M+1],ee=B[xr]||null;if(typeof N=="function")ee||YV(_);else if(ee){var ce=null;if(N&&N.hasAttribute("formAction")){if(B=N,ee=N[xr]||null)ce=ee.formAction;else if(QP(B)!==null)continue}else ce=ee.action;typeof ce=="function"?_[M+1]=ce:(_.splice(M,3),M-=3),YV(_)}}}function JP(f){this._internalRoot=f}YE.prototype.render=JP.prototype.render=function(f){var m=this._internalRoot;if(m===null)throw Error(n(409));var _=m.current,M=Tr();HV(_,M,f,m,null,null)},YE.prototype.unmount=JP.prototype.unmount=function(){var f=this._internalRoot;if(f!==null){this._internalRoot=null;var m=f.containerInfo;HV(f.current,2,null,f,null,null),Sc(),m[Gr]=null}};function YE(f){this._internalRoot=f}YE.prototype.unstable_scheduleHydration=function(f){if(f){var m=Jt();f={blockedOn:null,target:f,priority:m};for(var _=0;_<em.length&&m!==0&&m<em[_].priority;_++);em.splice(_,0,f),_===0&&XV(f)}};var QV=t.version;if(QV!=="19.1.0")throw Error(n(527,QV,"19.1.0"));X.findDOMNode=function(f){var m=f._reactInternals;if(m===void 0)throw typeof f.render=="function"?Error(n(188)):(f=Object.keys(f).join(","),Error(n(268,f)));return f=l(m),f=f!==null?c(f):null,f=f===null?null:f.stateNode,f};var Ine={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:F,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var QE=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!QE.isDisabled&&QE.supportsFiber)try{K=QE.inject(Ine),Re=QE}catch{}}return s_.createRoot=function(f,m){if(!r(f))throw Error(n(299));var _=!1,M="",B=tv,N=Ny,ee=DE,ce=null;return m!=null&&(m.unstable_strictMode===!0&&(_=!0),m.identifierPrefix!==void 0&&(M=m.identifierPrefix),m.onUncaughtError!==void 0&&(B=m.onUncaughtError),m.onCaughtError!==void 0&&(N=m.onCaughtError),m.onRecoverableError!==void 0&&(ee=m.onRecoverableError),m.unstable_transitionCallbacks!==void 0&&(ce=m.unstable_transitionCallbacks)),m=FV(f,1,!1,null,null,_,M,B,N,ee,ce,null),f[Gr]=m.current,BP(f),new JP(m)},s_.hydrateRoot=function(f,m,_){if(!r(f))throw Error(n(299));var M=!1,B="",N=tv,ee=Ny,ce=DE,Ee=null,rt=null;return _!=null&&(_.unstable_strictMode===!0&&(M=!0),_.identifierPrefix!==void 0&&(B=_.identifierPrefix),_.onUncaughtError!==void 0&&(N=_.onUncaughtError),_.onCaughtError!==void 0&&(ee=_.onCaughtError),_.onRecoverableError!==void 0&&(ce=_.onRecoverableError),_.unstable_transitionCallbacks!==void 0&&(Ee=_.unstable_transitionCallbacks),_.formState!==void 0&&(rt=_.formState)),m=FV(f,1,!0,m,_??null,M,B,N,ee,ce,Ee,rt),m.context=VV(null),_=m.current,M=Tr(),M=Vt(M),B=uc(M),B.callback=null,mu(_,B,M),_=M,m.current.lanes=_,at(m,_),Fh(m),f[Gr]=m.current,BP(f),new YE(m)},s_.version="19.1.0",s_}var sH;function Wne(){if(sH)return eO.exports;sH=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),eO.exports=jne(),eO.exports}var gq=Wne();const Xne=Uw(gq);var a_={},aH;function qne(){if(aH)return a_;aH=1,Object.defineProperty(a_,"__esModule",{value:!0}),a_.parse=a,a_.serialize=c;const e=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,t=/^[\u0021-\u003A\u003C-\u007E]*$/,i=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,n=/^[\u0020-\u003A\u003D-\u007E]*$/,r=Object.prototype.toString,s=(()=>{const d=function(){};return d.prototype=Object.create(null),d})();function a(d,p){const g=new s,x=d.length;if(x<2)return g;const y=(p==null?void 0:p.decode)||u;let b=0;do{const A=d.indexOf("=",b);if(A===-1)break;const w=d.indexOf(";",b),E=w===-1?x:w;if(A>E){b=d.lastIndexOf(";",A-1)+1;continue}const D=o(d,b,A),T=l(d,A,D),I=d.slice(D,T);if(g[I]===void 0){let R=o(d,A+1,E),O=l(d,E,R);const P=y(d.slice(R,O));g[I]=P}b=E+1}while(b<x);return g}function o(d,p,g){do{const x=d.charCodeAt(p);if(x!==32&&x!==9)return p}while(++p<g);return g}function l(d,p,g){for(;p>g;){const x=d.charCodeAt(--p);if(x!==32&&x!==9)return p+1}return g}function c(d,p,g){const x=(g==null?void 0:g.encode)||encodeURIComponent;if(!e.test(d))throw new TypeError(`argument name is invalid: ${d}`);const y=x(p);if(!t.test(y))throw new TypeError(`argument val is invalid: ${p}`);let b=d+"="+y;if(!g)return b;if(g.maxAge!==void 0){if(!Number.isInteger(g.maxAge))throw new TypeError(`option maxAge is invalid: ${g.maxAge}`);b+="; Max-Age="+g.maxAge}if(g.domain){if(!i.test(g.domain))throw new TypeError(`option domain is invalid: ${g.domain}`);b+="; Domain="+g.domain}if(g.path){if(!n.test(g.path))throw new TypeError(`option path is invalid: ${g.path}`);b+="; Path="+g.path}if(g.expires){if(!h(g.expires)||!Number.isFinite(g.expires.valueOf()))throw new TypeError(`option expires is invalid: ${g.expires}`);b+="; Expires="+g.expires.toUTCString()}if(g.httpOnly&&(b+="; HttpOnly"),g.secure&&(b+="; Secure"),g.partitioned&&(b+="; Partitioned"),g.priority)switch(typeof g.priority=="string"?g.priority.toLowerCase():void 0){case"low":b+="; Priority=Low";break;case"medium":b+="; Priority=Medium";break;case"high":b+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${g.priority}`)}if(g.sameSite)switch(typeof g.sameSite=="string"?g.sameSite.toLowerCase():g.sameSite){case!0:case"strict":b+="; SameSite=Strict";break;case"lax":b+="; SameSite=Lax";break;case"none":b+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${g.sameSite}`)}return b}function u(d){if(d.indexOf("%")===-1)return d;try{return decodeURIComponent(d)}catch{return d}}function h(d){return r.call(d)==="[object Date]"}return a_}qne();var oH="popstate";function Yne(e={}){function t(n,r){let{pathname:s,search:a,hash:o}=n.location;return WL("",{pathname:s,search:a,hash:o},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function i(n,r){return typeof r=="string"?r:qA(r)}return Kne(t,i,null,e)}function Ks(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function xd(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function Qne(){return Math.random().toString(36).substring(2,10)}function lH(e,t){return{usr:e.state,key:e.key,idx:t}}function WL(e,t,i=null,n){return{pathname:typeof e=="string"?e:e.pathname,search:"",hash:"",...typeof t=="string"?Nw(t):t,state:i,key:t&&t.key||n||Qne()}}function qA({pathname:e="/",search:t="",hash:i=""}){return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),i&&i!=="#"&&(e+=i.charAt(0)==="#"?i:"#"+i),e}function Nw(e){let t={};if(e){let i=e.indexOf("#");i>=0&&(t.hash=e.substring(i),e=e.substring(0,i));let n=e.indexOf("?");n>=0&&(t.search=e.substring(n),e=e.substring(0,n)),e&&(t.pathname=e)}return t}function Kne(e,t,i,n={}){let{window:r=document.defaultView,v5Compat:s=!1}=n,a=r.history,o="POP",l=null,c=u();c==null&&(c=0,a.replaceState({...a.state,idx:c},""));function u(){return(a.state||{idx:null}).idx}function h(){o="POP";let y=u(),b=y==null?null:y-c;c=y,l&&l({action:o,location:x.location,delta:b})}function d(y,b){o="PUSH";let A=WL(x.location,y,b);c=u()+1;let w=lH(A,c),E=x.createHref(A);try{a.pushState(w,"",E)}catch(D){if(D instanceof DOMException&&D.name==="DataCloneError")throw D;r.location.assign(E)}s&&l&&l({action:o,location:x.location,delta:1})}function p(y,b){o="REPLACE";let A=WL(x.location,y,b);c=u();let w=lH(A,c),E=x.createHref(A);a.replaceState(w,"",E),s&&l&&l({action:o,location:x.location,delta:0})}function g(y){return Jne(y)}let x={get action(){return o},get location(){return e(r,a)},listen(y){if(l)throw new Error("A history only accepts one active listener");return r.addEventListener(oH,h),l=y,()=>{r.removeEventListener(oH,h),l=null}},createHref(y){return t(r,y)},createURL:g,encodeLocation(y){let b=g(y);return{pathname:b.pathname,search:b.search,hash:b.hash}},push:d,replace:p,go(y){return a.go(y)}};return x}function Jne(e,t=!1){let i="http://localhost";typeof window<"u"&&(i=window.location.origin!=="null"?window.location.origin:window.location.href),Ks(i,"No window.location.(origin|href) available to create URL");let n=typeof e=="string"?e:qA(e);return n=n.replace(/ $/,"%20"),!t&&n.startsWith("//")&&(n=i+n),new URL(n,i)}function vq(e,t,i="/"){return Zne(e,t,i,!1)}function Zne(e,t,i,n){let r=typeof t=="string"?Nw(t):t,s=Kf(r.pathname||"/",i);if(s==null)return null;let a=yq(e);$ne(a);let o=null;for(let l=0;o==null&&l<a.length;++l){let c=ure(s);o=lre(a[l],c,n)}return o}function yq(e,t=[],i=[],n=""){let r=(s,a,o)=>{let l={relativePath:o===void 0?s.path||"":o,caseSensitive:s.caseSensitive===!0,childrenIndex:a,route:s};l.relativePath.startsWith("/")&&(Ks(l.relativePath.startsWith(n),`Absolute route path "${l.relativePath}" nested under path "${n}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),l.relativePath=l.relativePath.slice(n.length));let c=jf([n,l.relativePath]),u=i.concat(l);s.children&&s.children.length>0&&(Ks(s.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${c}".`),yq(s.children,t,u,c)),!(s.path==null&&!s.index)&&t.push({path:c,score:are(c,s.index),routesMeta:u})};return e.forEach((s,a)=>{var o;if(s.path===""||!((o=s.path)!=null&&o.includes("?")))r(s,a);else for(let l of xq(s.path))r(s,a,l)}),t}function xq(e){let t=e.split("/");if(t.length===0)return[];let[i,...n]=t,r=i.endsWith("?"),s=i.replace(/\?$/,"");if(n.length===0)return r?[s,""]:[s];let a=xq(n.join("/")),o=[];return o.push(...a.map(l=>l===""?s:[s,l].join("/"))),r&&o.push(...a),o.map(l=>e.startsWith("/")&&l===""?"/":l)}function $ne(e){e.sort((t,i)=>t.score!==i.score?i.score-t.score:ore(t.routesMeta.map(n=>n.childrenIndex),i.routesMeta.map(n=>n.childrenIndex)))}var ere=/^:[\w-]+$/,tre=3,ire=2,nre=1,rre=10,sre=-2,cH=e=>e==="*";function are(e,t){let i=e.split("/"),n=i.length;return i.some(cH)&&(n+=sre),t&&(n+=ire),i.filter(r=>!cH(r)).reduce((r,s)=>r+(ere.test(s)?tre:s===""?nre:rre),n)}function ore(e,t){return e.length===t.length&&e.slice(0,-1).every((n,r)=>n===t[r])?e[e.length-1]-t[t.length-1]:0}function lre(e,t,i=!1){let{routesMeta:n}=e,r={},s="/",a=[];for(let o=0;o<n.length;++o){let l=n[o],c=o===n.length-1,u=s==="/"?t:t.slice(s.length)||"/",h=ZC({path:l.relativePath,caseSensitive:l.caseSensitive,end:c},u),d=l.route;if(!h&&c&&i&&!n[n.length-1].route.index&&(h=ZC({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},u)),!h)return null;Object.assign(r,h.params),a.push({params:r,pathname:jf([s,h.pathname]),pathnameBase:pre(jf([s,h.pathnameBase])),route:d}),h.pathnameBase!=="/"&&(s=jf([s,h.pathnameBase]))}return a}function ZC(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[i,n]=cre(e.path,e.caseSensitive,e.end),r=t.match(i);if(!r)return null;let s=r[0],a=s.replace(/(.)\/+$/,"$1"),o=r.slice(1);return{params:n.reduce((c,{paramName:u,isOptional:h},d)=>{if(u==="*"){let g=o[d]||"";a=s.slice(0,s.length-g.length).replace(/(.)\/+$/,"$1")}const p=o[d];return h&&!p?c[u]=void 0:c[u]=(p||"").replace(/%2F/g,"/"),c},{}),pathname:s,pathnameBase:a,pattern:e}}function cre(e,t=!1,i=!0){xd(e==="*"||!e.endsWith("*")||e.endsWith("/*"),`Route path "${e}" will be treated as if it were "${e.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${e.replace(/\*$/,"/*")}".`);let n=[],r="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,o,l)=>(n.push({paramName:o,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(n.push({paramName:"*"}),r+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):i?r+="\\/*$":e!==""&&e!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,t?void 0:"i"),n]}function ure(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return xd(!1,`The URL path "${e}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${t}).`),e}}function Kf(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let i=t.endsWith("/")?t.length-1:t.length,n=e.charAt(i);return n&&n!=="/"?null:e.slice(i)||"/"}function hre(e,t="/"){let{pathname:i,search:n="",hash:r=""}=typeof e=="string"?Nw(e):e;return{pathname:i?i.startsWith("/")?i:dre(i,t):t,search:mre(n),hash:gre(r)}}function dre(e,t){let i=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(r=>{r===".."?i.length>1&&i.pop():r!=="."&&i.push(r)}),i.length>1?i.join("/"):"/"}function rO(e,t,i,n){return`Cannot include a '${e}' character in a manually specified \`to.${t}\` field [${JSON.stringify(n)}].  Please separate it out to the \`to.${i}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function fre(e){return e.filter((t,i)=>i===0||t.route.path&&t.route.path.length>0)}function bq(e){let t=fre(e);return t.map((i,n)=>n===t.length-1?i.pathname:i.pathnameBase)}function Sq(e,t,i,n=!1){let r;typeof e=="string"?r=Nw(e):(r={...e},Ks(!r.pathname||!r.pathname.includes("?"),rO("?","pathname","search",r)),Ks(!r.pathname||!r.pathname.includes("#"),rO("#","pathname","hash",r)),Ks(!r.search||!r.search.includes("#"),rO("#","search","hash",r)));let s=e===""||r.pathname==="",a=s?"/":r.pathname,o;if(a==null)o=i;else{let h=t.length-1;if(!n&&a.startsWith("..")){let d=a.split("/");for(;d[0]==="..";)d.shift(),h-=1;r.pathname=d.join("/")}o=h>=0?t[h]:"/"}let l=hre(r,o),c=a&&a!=="/"&&a.endsWith("/"),u=(s||a===".")&&i.endsWith("/");return!l.pathname.endsWith("/")&&(c||u)&&(l.pathname+="/"),l}var jf=e=>e.join("/").replace(/\/\/+/g,"/"),pre=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),mre=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,gre=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function vre(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}var _q=["POST","PUT","PATCH","DELETE"];new Set(_q);var yre=["GET",..._q];new Set(yre);var pb=ge.createContext(null);pb.displayName="DataRouter";var tR=ge.createContext(null);tR.displayName="DataRouterState";var Aq=ge.createContext({isTransitioning:!1});Aq.displayName="ViewTransition";var xre=ge.createContext(new Map);xre.displayName="Fetchers";var bre=ge.createContext(null);bre.displayName="Await";var Td=ge.createContext(null);Td.displayName="Navigation";var iR=ge.createContext(null);iR.displayName="Location";var lp=ge.createContext({outlet:null,matches:[],isDataRoute:!1});lp.displayName="Route";var Hz=ge.createContext(null);Hz.displayName="RouteError";function Sre(e,{relative:t}={}){Ks(zw(),"useHref() may be used only in the context of a <Router> component.");let{basename:i,navigator:n}=ge.useContext(Td),{hash:r,pathname:s,search:a}=Fw(e,{relative:t}),o=s;return i!=="/"&&(o=s==="/"?i:jf([i,s])),n.createHref({pathname:o,search:a,hash:r})}function zw(){return ge.useContext(iR)!=null}function G0(){return Ks(zw(),"useLocation() may be used only in the context of a <Router> component."),ge.useContext(iR).location}var wq="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Mq(e){ge.useContext(Td).static||ge.useLayoutEffect(e)}function _re(){let{isDataRoute:e}=ge.useContext(lp);return e?Lre():Are()}function Are(){Ks(zw(),"useNavigate() may be used only in the context of a <Router> component.");let e=ge.useContext(pb),{basename:t,navigator:i}=ge.useContext(Td),{matches:n}=ge.useContext(lp),{pathname:r}=G0(),s=JSON.stringify(bq(n)),a=ge.useRef(!1);return Mq(()=>{a.current=!0}),ge.useCallback((l,c={})=>{if(xd(a.current,wq),!a.current)return;if(typeof l=="number"){i.go(l);return}let u=Sq(l,JSON.parse(s),r,c.relative==="path");e==null&&t!=="/"&&(u.pathname=u.pathname==="/"?t:jf([t,u.pathname])),(c.replace?i.replace:i.push)(u,c.state,c)},[t,i,s,r,e])}ge.createContext(null);function Fw(e,{relative:t}={}){let{matches:i}=ge.useContext(lp),{pathname:n}=G0(),r=JSON.stringify(bq(i));return ge.useMemo(()=>Sq(e,JSON.parse(r),n,t==="path"),[e,r,n,t])}function wre(e,t,i,n){Ks(zw(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:r}=ge.useContext(Td),{matches:s}=ge.useContext(lp),a=s[s.length-1],o=a?a.params:{},l=a?a.pathname:"/",c=a?a.pathnameBase:"/",u=a&&a.route;{let b=u&&u.path||"";Eq(l,!u||b.endsWith("*")||b.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${l}" (under <Route path="${b}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${b}"> to <Route path="${b==="/"?"*":`${b}/*`}">.`)}let h=G0(),d;d=h;let p=d.pathname||"/",g=p;if(c!=="/"){let b=c.replace(/^\//,"").split("/");g="/"+p.replace(/^\//,"").split("/").slice(b.length).join("/")}let x=vq(e,{pathname:g});return xd(u||x!=null,`No routes matched location "${d.pathname}${d.search}${d.hash}" `),xd(x==null||x[x.length-1].route.element!==void 0||x[x.length-1].route.Component!==void 0||x[x.length-1].route.lazy!==void 0,`Matched leaf route at location "${d.pathname}${d.search}${d.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`),Dre(x&&x.map(b=>Object.assign({},b,{params:Object.assign({},o,b.params),pathname:jf([c,r.encodeLocation?r.encodeLocation(b.pathname).pathname:b.pathname]),pathnameBase:b.pathnameBase==="/"?c:jf([c,r.encodeLocation?r.encodeLocation(b.pathnameBase).pathname:b.pathnameBase])})),s,i,n)}function Mre(){let e=Ire(),t=vre(e)?`${e.status} ${e.statusText}`:e instanceof Error?e.message:JSON.stringify(e),i=e instanceof Error?e.stack:null,n="rgba(200,200,200, 0.5)",r={padding:"0.5rem",backgroundColor:n},s={padding:"2px 4px",backgroundColor:n},a=null;return console.error("Error handled by React Router default ErrorBoundary:",e),a=ge.createElement(ge.Fragment,null,ge.createElement("p",null," Hey developer "),ge.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",ge.createElement("code",{style:s},"ErrorBoundary")," or"," ",ge.createElement("code",{style:s},"errorElement")," prop on your route.")),ge.createElement(ge.Fragment,null,ge.createElement("h2",null,"Unexpected Application Error!"),ge.createElement("h3",{style:{fontStyle:"italic"}},t),i?ge.createElement("pre",{style:r},i):null,a)}var Ere=ge.createElement(Mre,null),Tre=class extends ge.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?ge.createElement(lp.Provider,{value:this.props.routeContext},ge.createElement(Hz.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function Cre({routeContext:e,match:t,children:i}){let n=ge.useContext(pb);return n&&n.static&&n.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=t.route.id),ge.createElement(lp.Provider,{value:e},i)}function Dre(e,t=[],i=null,n=null){if(e==null){if(!i)return null;if(i.errors)e=i.matches;else if(t.length===0&&!i.initialized&&i.matches.length>0)e=i.matches;else return null}let r=e,s=i==null?void 0:i.errors;if(s!=null){let l=r.findIndex(c=>c.route.id&&(s==null?void 0:s[c.route.id])!==void 0);Ks(l>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(s).join(",")}`),r=r.slice(0,Math.min(r.length,l+1))}let a=!1,o=-1;if(i)for(let l=0;l<r.length;l++){let c=r[l];if((c.route.HydrateFallback||c.route.hydrateFallbackElement)&&(o=l),c.route.id){let{loaderData:u,errors:h}=i,d=c.route.loader&&!u.hasOwnProperty(c.route.id)&&(!h||h[c.route.id]===void 0);if(c.route.lazy||d){a=!0,o>=0?r=r.slice(0,o+1):r=[r[0]];break}}}return r.reduceRight((l,c,u)=>{let h,d=!1,p=null,g=null;i&&(h=s&&c.route.id?s[c.route.id]:void 0,p=c.route.errorElement||Ere,a&&(o<0&&u===0?(Eq("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),d=!0,g=null):o===u&&(d=!0,g=c.route.hydrateFallbackElement||null)));let x=t.concat(r.slice(0,u+1)),y=()=>{let b;return h?b=p:d?b=g:c.route.Component?b=ge.createElement(c.route.Component,null):c.route.element?b=c.route.element:b=l,ge.createElement(Cre,{match:c,routeContext:{outlet:l,matches:x,isDataRoute:i!=null},children:b})};return i&&(c.route.ErrorBoundary||c.route.errorElement||u===0)?ge.createElement(Tre,{location:i.location,revalidation:i.revalidation,component:p,error:h,children:y(),routeContext:{outlet:null,matches:x,isDataRoute:!0}}):y()},null)}function Gz(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Rre(e){let t=ge.useContext(pb);return Ks(t,Gz(e)),t}function Pre(e){let t=ge.useContext(tR);return Ks(t,Gz(e)),t}function Ore(e){let t=ge.useContext(lp);return Ks(t,Gz(e)),t}function kz(e){let t=Ore(e),i=t.matches[t.matches.length-1];return Ks(i.route.id,`${e} can only be used on routes that contain a unique "id"`),i.route.id}function Bre(){return kz("useRouteId")}function Ire(){var n;let e=ge.useContext(Hz),t=Pre("useRouteError"),i=kz("useRouteError");return e!==void 0?e:(n=t.errors)==null?void 0:n[i]}function Lre(){let{router:e}=Rre("useNavigate"),t=kz("useNavigate"),i=ge.useRef(!1);return Mq(()=>{i.current=!0}),ge.useCallback(async(r,s={})=>{xd(i.current,wq),i.current&&(typeof r=="number"?e.navigate(r):await e.navigate(r,{fromRouteId:t,...s}))},[e,t])}var uH={};function Eq(e,t,i){!t&&!uH[e]&&(uH[e]=!0,xd(!1,i))}ge.memo(Ure);function Ure({routes:e,future:t,state:i}){return wre(e,void 0,i,t)}function Nre({basename:e="/",children:t=null,location:i,navigationType:n="POP",navigator:r,static:s=!1}){Ks(!zw(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let a=e.replace(/^\/*/,"/"),o=ge.useMemo(()=>({basename:a,navigator:r,static:s,future:{}}),[a,r,s]);typeof i=="string"&&(i=Nw(i));let{pathname:l="/",search:c="",hash:u="",state:h=null,key:d="default"}=i,p=ge.useMemo(()=>{let g=Kf(l,a);return g==null?null:{location:{pathname:g,search:c,hash:u,state:h,key:d},navigationType:n}},[a,l,c,u,h,d,n]);return xd(p!=null,`<Router basename="${a}"> is not able to match the URL "${l}${c}${u}" because it does not start with the basename, so the <Router> won't render anything.`),p==null?null:ge.createElement(Td.Provider,{value:o},ge.createElement(iR.Provider,{children:t,value:p}))}var SC="get",_C="application/x-www-form-urlencoded";function nR(e){return e!=null&&typeof e.tagName=="string"}function zre(e){return nR(e)&&e.tagName.toLowerCase()==="button"}function Fre(e){return nR(e)&&e.tagName.toLowerCase()==="form"}function Vre(e){return nR(e)&&e.tagName.toLowerCase()==="input"}function Hre(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function Gre(e,t){return e.button===0&&(!t||t==="_self")&&!Hre(e)}var JE=null;function kre(){if(JE===null)try{new FormData(document.createElement("form"),0),JE=!1}catch{JE=!0}return JE}var jre=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function sO(e){return e!=null&&!jre.has(e)?(xd(!1,`"${e}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${_C}"`),null):e}function Wre(e,t){let i,n,r,s,a;if(Fre(e)){let o=e.getAttribute("action");n=o?Kf(o,t):null,i=e.getAttribute("method")||SC,r=sO(e.getAttribute("enctype"))||_C,s=new FormData(e)}else if(zre(e)||Vre(e)&&(e.type==="submit"||e.type==="image")){let o=e.form;if(o==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let l=e.getAttribute("formaction")||o.getAttribute("action");if(n=l?Kf(l,t):null,i=e.getAttribute("formmethod")||o.getAttribute("method")||SC,r=sO(e.getAttribute("formenctype"))||sO(o.getAttribute("enctype"))||_C,s=new FormData(o,e),!kre()){let{name:c,type:u,value:h}=e;if(u==="image"){let d=c?`${c}.`:"";s.append(`${d}x`,"0"),s.append(`${d}y`,"0")}else c&&s.append(c,h)}}else{if(nR(e))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');i=SC,n=null,r=_C,a=e}return s&&r==="text/plain"&&(a=s,s=void 0),{action:n,method:i.toLowerCase(),encType:r,formData:s,body:a}}function jz(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}async function Xre(e,t){if(e.id in t)return t[e.id];try{let i=await import(e.module);return t[e.id]=i,i}catch(i){return console.error(`Error loading route module \`${e.module}\`, reloading page...`),console.error(i),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function qre(e){return e==null?!1:e.href==null?e.rel==="preload"&&typeof e.imageSrcSet=="string"&&typeof e.imageSizes=="string":typeof e.rel=="string"&&typeof e.href=="string"}async function Yre(e,t,i){let n=await Promise.all(e.map(async r=>{let s=t.routes[r.route.id];if(s){let a=await Xre(s,i);return a.links?a.links():[]}return[]}));return Zre(n.flat(1).filter(qre).filter(r=>r.rel==="stylesheet"||r.rel==="preload").map(r=>r.rel==="stylesheet"?{...r,rel:"prefetch",as:"style"}:{...r,rel:"prefetch"}))}function hH(e,t,i,n,r,s){let a=(l,c)=>i[c]?l.route.id!==i[c].route.id:!0,o=(l,c)=>{var u;return i[c].pathname!==l.pathname||((u=i[c].route.path)==null?void 0:u.endsWith("*"))&&i[c].params["*"]!==l.params["*"]};return s==="assets"?t.filter((l,c)=>a(l,c)||o(l,c)):s==="data"?t.filter((l,c)=>{var h;let u=n.routes[l.route.id];if(!u||!u.hasLoader)return!1;if(a(l,c)||o(l,c))return!0;if(l.route.shouldRevalidate){let d=l.route.shouldRevalidate({currentUrl:new URL(r.pathname+r.search+r.hash,window.origin),currentParams:((h=i[0])==null?void 0:h.params)||{},nextUrl:new URL(e,window.origin),nextParams:l.params,defaultShouldRevalidate:!0});if(typeof d=="boolean")return d}return!0}):[]}function Qre(e,t,{includeHydrateFallback:i}={}){return Kre(e.map(n=>{let r=t.routes[n.route.id];if(!r)return[];let s=[r.module];return r.clientActionModule&&(s=s.concat(r.clientActionModule)),r.clientLoaderModule&&(s=s.concat(r.clientLoaderModule)),i&&r.hydrateFallbackModule&&(s=s.concat(r.hydrateFallbackModule)),r.imports&&(s=s.concat(r.imports)),s}).flat(1))}function Kre(e){return[...new Set(e)]}function Jre(e){let t={},i=Object.keys(e).sort();for(let n of i)t[n]=e[n];return t}function Zre(e,t){let i=new Set;return new Set(t),e.reduce((n,r)=>{let s=JSON.stringify(Jre(r));return i.has(s)||(i.add(s),n.push({key:s,link:r})),n},[])}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var $re=new Set([100,101,204,205]);function ese(e,t){let i=typeof e=="string"?new URL(e,typeof window>"u"?"server://singlefetch/":window.location.origin):e;return i.pathname==="/"?i.pathname="_root.data":t&&Kf(i.pathname,t)==="/"?i.pathname=`${t.replace(/\/$/,"")}/_root.data`:i.pathname=`${i.pathname.replace(/\/$/,"")}.data`,i}function Tq(){let e=ge.useContext(pb);return jz(e,"You must render this element inside a <DataRouterContext.Provider> element"),e}function tse(){let e=ge.useContext(tR);return jz(e,"You must render this element inside a <DataRouterStateContext.Provider> element"),e}var Wz=ge.createContext(void 0);Wz.displayName="FrameworkContext";function Cq(){let e=ge.useContext(Wz);return jz(e,"You must render this element inside a <HydratedRouter> element"),e}function ise(e,t){let i=ge.useContext(Wz),[n,r]=ge.useState(!1),[s,a]=ge.useState(!1),{onFocus:o,onBlur:l,onMouseEnter:c,onMouseLeave:u,onTouchStart:h}=t,d=ge.useRef(null);ge.useEffect(()=>{if(e==="render"&&a(!0),e==="viewport"){let x=b=>{b.forEach(A=>{a(A.isIntersecting)})},y=new IntersectionObserver(x,{threshold:.5});return d.current&&y.observe(d.current),()=>{y.disconnect()}}},[e]),ge.useEffect(()=>{if(n){let x=setTimeout(()=>{a(!0)},100);return()=>{clearTimeout(x)}}},[n]);let p=()=>{r(!0)},g=()=>{r(!1),a(!1)};return i?e!=="intent"?[s,d,{}]:[s,d,{onFocus:o_(o,p),onBlur:o_(l,g),onMouseEnter:o_(c,p),onMouseLeave:o_(u,g),onTouchStart:o_(h,p)}]:[!1,d,{}]}function o_(e,t){return i=>{e&&e(i),i.defaultPrevented||t(i)}}function nse({page:e,...t}){let{router:i}=Tq(),n=ge.useMemo(()=>vq(i.routes,e,i.basename),[i.routes,e,i.basename]);return n?ge.createElement(sse,{page:e,matches:n,...t}):null}function rse(e){let{manifest:t,routeModules:i}=Cq(),[n,r]=ge.useState([]);return ge.useEffect(()=>{let s=!1;return Yre(e,t,i).then(a=>{s||r(a)}),()=>{s=!0}},[e,t,i]),n}function sse({page:e,matches:t,...i}){let n=G0(),{manifest:r,routeModules:s}=Cq(),{basename:a}=Tq(),{loaderData:o,matches:l}=tse(),c=ge.useMemo(()=>hH(e,t,l,r,n,"data"),[e,t,l,r,n]),u=ge.useMemo(()=>hH(e,t,l,r,n,"assets"),[e,t,l,r,n]),h=ge.useMemo(()=>{if(e===n.pathname+n.search+n.hash)return[];let g=new Set,x=!1;if(t.forEach(b=>{var w;let A=r.routes[b.route.id];!A||!A.hasLoader||(!c.some(E=>E.route.id===b.route.id)&&b.route.id in o&&((w=s[b.route.id])!=null&&w.shouldRevalidate)||A.hasClientLoader?x=!0:g.add(b.route.id))}),g.size===0)return[];let y=ese(e,a);return x&&g.size>0&&y.searchParams.set("_routes",t.filter(b=>g.has(b.route.id)).map(b=>b.route.id).join(",")),[y.pathname+y.search]},[a,o,n,r,c,t,e,s]),d=ge.useMemo(()=>Qre(u,r),[u,r]),p=rse(u);return ge.createElement(ge.Fragment,null,h.map(g=>ge.createElement("link",{key:g,rel:"prefetch",as:"fetch",href:g,...i})),d.map(g=>ge.createElement("link",{key:g,rel:"modulepreload",href:g,...i})),p.map(({key:g,link:x})=>ge.createElement("link",{key:g,...x})))}function ase(...e){return t=>{e.forEach(i=>{typeof i=="function"?i(t):i!=null&&(i.current=t)})}}var Dq=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{Dq&&(window.__reactRouterVersion="7.6.2")}catch{}function ose({basename:e,children:t,window:i}){let n=ge.useRef();n.current==null&&(n.current=Yne({window:i,v5Compat:!0}));let r=n.current,[s,a]=ge.useState({action:r.action,location:r.location}),o=ge.useCallback(l=>{ge.startTransition(()=>a(l))},[a]);return ge.useLayoutEffect(()=>r.listen(o),[r,o]),ge.createElement(Nre,{basename:e,children:t,location:s.location,navigationType:s.action,navigator:r})}var Rq=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Xz=ge.forwardRef(function({onClick:t,discover:i="render",prefetch:n="none",relative:r,reloadDocument:s,replace:a,state:o,target:l,to:c,preventScrollReset:u,viewTransition:h,...d},p){let{basename:g}=ge.useContext(Td),x=typeof c=="string"&&Rq.test(c),y,b=!1;if(typeof c=="string"&&x&&(y=c,Dq))try{let O=new URL(window.location.href),P=c.startsWith("//")?new URL(O.protocol+c):new URL(c),U=Kf(P.pathname,g);P.origin===O.origin&&U!=null?c=U+P.search+P.hash:b=!0}catch{xd(!1,`<Link to="${c}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let A=Sre(c,{relative:r}),[w,E,D]=ise(n,d),T=hse(c,{replace:a,state:o,target:l,preventScrollReset:u,relative:r,viewTransition:h});function I(O){t&&t(O),O.defaultPrevented||T(O)}let R=ge.createElement("a",{...d,...D,href:y||A,onClick:b||s?t:I,ref:ase(p,E),target:l,"data-discover":!x&&i==="render"?"true":void 0});return w&&!x?ge.createElement(ge.Fragment,null,R,ge.createElement(nse,{page:A})):R});Xz.displayName="Link";var lse=ge.forwardRef(function({"aria-current":t="page",caseSensitive:i=!1,className:n="",end:r=!1,style:s,to:a,viewTransition:o,children:l,...c},u){let h=Fw(a,{relative:c.relative}),d=G0(),p=ge.useContext(tR),{navigator:g,basename:x}=ge.useContext(Td),y=p!=null&&gse(h)&&o===!0,b=g.encodeLocation?g.encodeLocation(h).pathname:h.pathname,A=d.pathname,w=p&&p.navigation&&p.navigation.location?p.navigation.location.pathname:null;i||(A=A.toLowerCase(),w=w?w.toLowerCase():null,b=b.toLowerCase()),w&&x&&(w=Kf(w,x)||w);const E=b!=="/"&&b.endsWith("/")?b.length-1:b.length;let D=A===b||!r&&A.startsWith(b)&&A.charAt(E)==="/",T=w!=null&&(w===b||!r&&w.startsWith(b)&&w.charAt(b.length)==="/"),I={isActive:D,isPending:T,isTransitioning:y},R=D?t:void 0,O;typeof n=="function"?O=n(I):O=[n,D?"active":null,T?"pending":null,y?"transitioning":null].filter(Boolean).join(" ");let P=typeof s=="function"?s(I):s;return ge.createElement(Xz,{...c,"aria-current":R,className:O,ref:u,style:P,to:a,viewTransition:o},typeof l=="function"?l(I):l)});lse.displayName="NavLink";var cse=ge.forwardRef(({discover:e="render",fetcherKey:t,navigate:i,reloadDocument:n,replace:r,state:s,method:a=SC,action:o,onSubmit:l,relative:c,preventScrollReset:u,viewTransition:h,...d},p)=>{let g=pse(),x=mse(o,{relative:c}),y=a.toLowerCase()==="get"?"get":"post",b=typeof o=="string"&&Rq.test(o),A=w=>{if(l&&l(w),w.defaultPrevented)return;w.preventDefault();let E=w.nativeEvent.submitter,D=(E==null?void 0:E.getAttribute("formmethod"))||a;g(E||w.currentTarget,{fetcherKey:t,method:D,navigate:i,replace:r,state:s,relative:c,preventScrollReset:u,viewTransition:h})};return ge.createElement("form",{ref:p,method:y,action:x,onSubmit:n?l:A,...d,"data-discover":!b&&e==="render"?"true":void 0})});cse.displayName="Form";function use(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Pq(e){let t=ge.useContext(pb);return Ks(t,use(e)),t}function hse(e,{target:t,replace:i,state:n,preventScrollReset:r,relative:s,viewTransition:a}={}){let o=_re(),l=G0(),c=Fw(e,{relative:s});return ge.useCallback(u=>{if(Gre(u,t)){u.preventDefault();let h=i!==void 0?i:qA(l)===qA(c);o(e,{replace:h,state:n,preventScrollReset:r,relative:s,viewTransition:a})}},[l,o,c,i,n,t,e,r,s,a])}var dse=0,fse=()=>`__${String(++dse)}__`;function pse(){let{router:e}=Pq("useSubmit"),{basename:t}=ge.useContext(Td),i=Bre();return ge.useCallback(async(n,r={})=>{let{action:s,method:a,encType:o,formData:l,body:c}=Wre(n,t);if(r.navigate===!1){let u=r.fetcherKey||fse();await e.fetch(u,i,r.action||s,{preventScrollReset:r.preventScrollReset,formData:l,body:c,formMethod:r.method||a,formEncType:r.encType||o,flushSync:r.flushSync})}else await e.navigate(r.action||s,{preventScrollReset:r.preventScrollReset,formData:l,body:c,formMethod:r.method||a,formEncType:r.encType||o,replace:r.replace,state:r.state,fromRouteId:i,flushSync:r.flushSync,viewTransition:r.viewTransition})},[e,t,i])}function mse(e,{relative:t}={}){let{basename:i}=ge.useContext(Td),n=ge.useContext(lp);Ks(n,"useFormAction must be used inside a RouteContext");let[r]=n.matches.slice(-1),s={...Fw(e||".",{relative:t})},a=G0();if(e==null){s.search=a.search;let o=new URLSearchParams(s.search),l=o.getAll("index");if(l.some(u=>u==="")){o.delete("index"),l.filter(h=>h).forEach(h=>o.append("index",h));let u=o.toString();s.search=u?`?${u}`:""}}return(!e||e===".")&&r.route.index&&(s.search=s.search?s.search.replace(/^\?/,"?index&"):"?index"),i!=="/"&&(s.pathname=s.pathname==="/"?i:jf([i,s.pathname])),qA(s)}function gse(e,t={}){let i=ge.useContext(Aq);Ks(i!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:n}=Pq("useViewTransitionState"),r=Fw(e,{relative:t.relative});if(!i.isTransitioning)return!1;let s=Kf(i.currentLocation.pathname,n)||i.currentLocation.pathname,a=Kf(i.nextLocation.pathname,n)||i.nextLocation.pathname;return ZC(r.pathname,a)!=null||ZC(r.pathname,s)!=null}[...$re];/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const mb="177",Lv={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Uv={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},Oq=0,XL=1,Bq=2,vse=3,Iq=0,rR=1,gA=2,Hu=3,bd=0,el=1,Hc=2,Wf=0,f0=1,qL=2,YL=3,QL=4,Lq=5,Cm=100,Uq=101,Nq=102,zq=103,Fq=104,Vq=200,Hq=201,Gq=202,kq=203,$C=204,eD=205,jq=206,Wq=207,Xq=208,qq=209,Yq=210,Qq=211,Kq=212,Jq=213,Zq=214,tD=0,iD=1,nD=2,E0=3,rD=4,sD=5,aD=6,oD=7,Vw=0,$q=1,eY=2,ud=0,tY=1,iY=2,nY=3,qz=4,rY=5,sY=6,aY=7,KL="attached",oY="detached",sR=300,Jf=301,Jm=302,YA=303,QA=304,gb=306,Zm=1e3,Zl=1001,z1=1002,xa=1003,aR=1004,yse=1004,Jv=1005,xse=1005,hs=1006,b1=1007,bse=1007,kc=1008,Sse=1008,Kc=1009,Yz=1010,Qz=1011,F1=1012,oR=1013,Zf=1014,Tl=1015,vb=1016,lR=1017,cR=1018,V1=1020,Kz=35902,Jz=1021,Zz=1022,go=1023,H1=1026,G1=1027,uR=1028,Hw=1029,$z=1030,hR=1031,_se=1032,dR=1033,vA=33776,yA=33777,xA=33778,bA=33779,lD=35840,cD=35841,uD=35842,hD=35843,dD=36196,fD=37492,pD=37496,mD=37808,gD=37809,vD=37810,yD=37811,xD=37812,bD=37813,SD=37814,_D=37815,AD=37816,wD=37817,MD=37818,ED=37819,TD=37820,CD=37821,SA=36492,DD=36494,RD=36495,eF=36283,PD=36284,OD=36285,BD=36286,lY=2200,cY=2201,uY=2202,k1=2300,j1=2301,AC=2302,Zv=2400,$v=2401,KA=2402,fR=2500,tF=2501,hY=0,iF=1,ID=2,dY=3200,fY=3201,Ase=3202,wse=3203,lg=0,pY=1,Of="",fo="srgb",$m="srgb-linear",JA="linear",Jn="srgb",Mse=0,Nv=7680,Ese=7681,Tse=7682,Cse=7683,Dse=34055,Rse=34056,Pse=5386,Ose=512,Bse=513,Ise=514,Lse=515,Use=516,Nse=517,zse=518,JL=519,mY=512,gY=513,vY=514,nF=515,yY=516,xY=517,bY=518,SY=519,ZA=35044,p0=35048,Fse=35040,Vse=35045,Hse=35049,Gse=35041,kse=35046,jse=35050,Wse=35042,Xse="100",ZL="300 es",jc=2e3,$A=2001,qse={COMPUTE:"compute",RENDER:"render"},Yse={PERSPECTIVE:"perspective",LINEAR:"linear",FLAT:"flat"},Qse={NORMAL:"normal",CENTROID:"centroid",SAMPLE:"sample",FLAT_FIRST:"flat first",FLAT_EITHER:"flat either"};let Cd=class{addEventListener(t,i){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[t]===void 0&&(n[t]=[]),n[t].indexOf(i)===-1&&n[t].push(i)}hasEventListener(t,i){const n=this._listeners;return n===void 0?!1:n[t]!==void 0&&n[t].indexOf(i)!==-1}removeEventListener(t,i){const n=this._listeners;if(n===void 0)return;const r=n[t];if(r!==void 0){const s=r.indexOf(i);s!==-1&&r.splice(s,1)}}dispatchEvent(t){const i=this._listeners;if(i===void 0)return;const n=i[t.type];if(n!==void 0){t.target=this;const r=n.slice(0);for(let s=0,a=r.length;s<a;s++)r[s].call(this,t);t.target=null}}};const ao=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let dH=1234567;const m0=Math.PI/180,W1=180/Math.PI;function tc(){const e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(ao[e&255]+ao[e>>8&255]+ao[e>>16&255]+ao[e>>24&255]+"-"+ao[t&255]+ao[t>>8&255]+"-"+ao[t>>16&15|64]+ao[t>>24&255]+"-"+ao[i&63|128]+ao[i>>8&255]+"-"+ao[i>>16&255]+ao[i>>24&255]+ao[n&255]+ao[n>>8&255]+ao[n>>16&255]+ao[n>>24&255]).toLowerCase()}function qi(e,t,i){return Math.max(t,Math.min(i,e))}function rF(e,t){return(e%t+t)%t}function Kse(e,t,i,n,r){return n+(e-t)*(r-n)/(i-t)}function Jse(e,t,i){return e!==t?(i-e)/(t-e):0}function _A(e,t,i){return(1-i)*e+i*t}function Zse(e,t,i,n){return _A(e,t,1-Math.exp(-i*n))}function $se(e,t=1){return t-Math.abs(rF(e,t*2)-t)}function eae(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*(3-2*e))}function tae(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*e*(e*(e*6-15)+10))}function iae(e,t){return e+Math.floor(Math.random()*(t-e+1))}function nae(e,t){return e+Math.random()*(t-e)}function rae(e){return e*(.5-Math.random())}function sae(e){e!==void 0&&(dH=e);let t=dH+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function aae(e){return e*m0}function oae(e){return e*W1}function lae(e){return(e&e-1)===0&&e!==0}function cae(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function uae(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function hae(e,t,i,n,r){const s=Math.cos,a=Math.sin,o=s(i/2),l=a(i/2),c=s((t+n)/2),u=a((t+n)/2),h=s((t-n)/2),d=a((t-n)/2),p=s((n-t)/2),g=a((n-t)/2);switch(r){case"XYX":e.set(o*u,l*h,l*d,o*c);break;case"YZY":e.set(l*d,o*u,l*h,o*c);break;case"ZXZ":e.set(l*h,l*d,o*u,o*c);break;case"XZX":e.set(o*u,l*g,l*p,o*c);break;case"YXY":e.set(l*p,o*u,l*g,o*c);break;case"ZYZ":e.set(l*g,l*p,o*u,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function Yo(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/4294967295;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/2147483647,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function Zi(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(e*4294967295);case Uint16Array:return Math.round(e*65535);case Uint8Array:return Math.round(e*255);case Int32Array:return Math.round(e*2147483647);case Int16Array:return Math.round(e*32767);case Int8Array:return Math.round(e*127);default:throw new Error("Invalid component type.")}}const sF={DEG2RAD:m0,RAD2DEG:W1,generateUUID:tc,clamp:qi,euclideanModulo:rF,mapLinear:Kse,inverseLerp:Jse,lerp:_A,damp:Zse,pingpong:$se,smoothstep:eae,smootherstep:tae,randInt:iae,randFloat:nae,randFloatSpread:rae,seededRandom:sae,degToRad:aae,radToDeg:oae,isPowerOfTwo:lae,ceilPowerOfTwo:cae,floorPowerOfTwo:uae,setQuaternionFromProperEuler:hae,normalize:Zi,denormalize:Yo};class Mt{constructor(t=0,i=0){Mt.prototype.isVector2=!0,this.x=t,this.y=i}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,i){return this.x=t,this.y=i,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this}addScaledVector(t,i){return this.x+=t.x*i,this.y+=t.y*i,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const i=this.x,n=this.y,r=t.elements;return this.x=r[0]*i+r[3]*n+r[6],this.y=r[1]*i+r[4]*n+r[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,i){return this.x=qi(this.x,t.x,i.x),this.y=qi(this.y,t.y,i.y),this}clampScalar(t,i){return this.x=qi(this.x,t,i),this.y=qi(this.y,t,i),this}clampLength(t,i){const n=this.length();return this.divideScalar(n||1).multiplyScalar(qi(n,t,i))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const i=Math.sqrt(this.lengthSq()*t.lengthSq());if(i===0)return Math.PI/2;const n=this.dot(t)/i;return Math.acos(qi(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const i=this.x-t.x,n=this.y-t.y;return i*i+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this}lerpVectors(t,i,n){return this.x=t.x+(i.x-t.x)*n,this.y=t.y+(i.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this}toArray(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t}fromBufferAttribute(t,i){return this.x=t.getX(i),this.y=t.getY(i),this}rotateAround(t,i){const n=Math.cos(i),r=Math.sin(i),s=this.x-t.x,a=this.y-t.y;return this.x=s*n-a*r+t.x,this.y=s*r+a*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class ba{constructor(t=0,i=0,n=0,r=1){this.isQuaternion=!0,this._x=t,this._y=i,this._z=n,this._w=r}static slerpFlat(t,i,n,r,s,a,o){let l=n[r+0],c=n[r+1],u=n[r+2],h=n[r+3];const d=s[a+0],p=s[a+1],g=s[a+2],x=s[a+3];if(o===0){t[i+0]=l,t[i+1]=c,t[i+2]=u,t[i+3]=h;return}if(o===1){t[i+0]=d,t[i+1]=p,t[i+2]=g,t[i+3]=x;return}if(h!==x||l!==d||c!==p||u!==g){let y=1-o;const b=l*d+c*p+u*g+h*x,A=b>=0?1:-1,w=1-b*b;if(w>Number.EPSILON){const D=Math.sqrt(w),T=Math.atan2(D,b*A);y=Math.sin(y*T)/D,o=Math.sin(o*T)/D}const E=o*A;if(l=l*y+d*E,c=c*y+p*E,u=u*y+g*E,h=h*y+x*E,y===1-o){const D=1/Math.sqrt(l*l+c*c+u*u+h*h);l*=D,c*=D,u*=D,h*=D}}t[i]=l,t[i+1]=c,t[i+2]=u,t[i+3]=h}static multiplyQuaternionsFlat(t,i,n,r,s,a){const o=n[r],l=n[r+1],c=n[r+2],u=n[r+3],h=s[a],d=s[a+1],p=s[a+2],g=s[a+3];return t[i]=o*g+u*h+l*p-c*d,t[i+1]=l*g+u*d+c*h-o*p,t[i+2]=c*g+u*p+o*d-l*h,t[i+3]=u*g-o*h-l*d-c*p,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,i,n,r){return this._x=t,this._y=i,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,i=!0){const n=t._x,r=t._y,s=t._z,a=t._order,o=Math.cos,l=Math.sin,c=o(n/2),u=o(r/2),h=o(s/2),d=l(n/2),p=l(r/2),g=l(s/2);switch(a){case"XYZ":this._x=d*u*h+c*p*g,this._y=c*p*h-d*u*g,this._z=c*u*g+d*p*h,this._w=c*u*h-d*p*g;break;case"YXZ":this._x=d*u*h+c*p*g,this._y=c*p*h-d*u*g,this._z=c*u*g-d*p*h,this._w=c*u*h+d*p*g;break;case"ZXY":this._x=d*u*h-c*p*g,this._y=c*p*h+d*u*g,this._z=c*u*g+d*p*h,this._w=c*u*h-d*p*g;break;case"ZYX":this._x=d*u*h-c*p*g,this._y=c*p*h+d*u*g,this._z=c*u*g-d*p*h,this._w=c*u*h+d*p*g;break;case"YZX":this._x=d*u*h+c*p*g,this._y=c*p*h+d*u*g,this._z=c*u*g-d*p*h,this._w=c*u*h-d*p*g;break;case"XZY":this._x=d*u*h-c*p*g,this._y=c*p*h-d*u*g,this._z=c*u*g+d*p*h,this._w=c*u*h+d*p*g;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return i===!0&&this._onChangeCallback(),this}setFromAxisAngle(t,i){const n=i/2,r=Math.sin(n);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const i=t.elements,n=i[0],r=i[4],s=i[8],a=i[1],o=i[5],l=i[9],c=i[2],u=i[6],h=i[10],d=n+o+h;if(d>0){const p=.5/Math.sqrt(d+1);this._w=.25/p,this._x=(u-l)*p,this._y=(s-c)*p,this._z=(a-r)*p}else if(n>o&&n>h){const p=2*Math.sqrt(1+n-o-h);this._w=(u-l)/p,this._x=.25*p,this._y=(r+a)/p,this._z=(s+c)/p}else if(o>h){const p=2*Math.sqrt(1+o-n-h);this._w=(s-c)/p,this._x=(r+a)/p,this._y=.25*p,this._z=(l+u)/p}else{const p=2*Math.sqrt(1+h-n-o);this._w=(a-r)/p,this._x=(s+c)/p,this._y=(l+u)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(t,i){let n=t.dot(i)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*i.z-t.z*i.y,this._y=t.z*i.x-t.x*i.z,this._z=t.x*i.y-t.y*i.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(qi(this.dot(t),-1,1)))}rotateTowards(t,i){const n=this.angleTo(t);if(n===0)return this;const r=Math.min(1,i/n);return this.slerp(t,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,i){const n=t._x,r=t._y,s=t._z,a=t._w,o=i._x,l=i._y,c=i._z,u=i._w;return this._x=n*u+a*o+r*c-s*l,this._y=r*u+a*l+s*o-n*c,this._z=s*u+a*c+n*l-r*o,this._w=a*u-n*o-r*l-s*c,this._onChangeCallback(),this}slerp(t,i){if(i===0)return this;if(i===1)return this.copy(t);const n=this._x,r=this._y,s=this._z,a=this._w;let o=a*t._w+n*t._x+r*t._y+s*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=a,this._x=n,this._y=r,this._z=s,this;const l=1-o*o;if(l<=Number.EPSILON){const p=1-i;return this._w=p*a+i*this._w,this._x=p*n+i*this._x,this._y=p*r+i*this._y,this._z=p*s+i*this._z,this.normalize(),this}const c=Math.sqrt(l),u=Math.atan2(c,o),h=Math.sin((1-i)*u)/c,d=Math.sin(i*u)/c;return this._w=a*h+this._w*d,this._x=n*h+this._x*d,this._y=r*h+this._y*d,this._z=s*h+this._z*d,this._onChangeCallback(),this}slerpQuaternions(t,i,n){return this.copy(t).slerp(i,n)}random(){const t=2*Math.PI*Math.random(),i=2*Math.PI*Math.random(),n=Math.random(),r=Math.sqrt(1-n),s=Math.sqrt(n);return this.set(r*Math.sin(t),r*Math.cos(t),s*Math.sin(i),s*Math.cos(i))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,i=0){return this._x=t[i],this._y=t[i+1],this._z=t[i+2],this._w=t[i+3],this._onChangeCallback(),this}toArray(t=[],i=0){return t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._w,t}fromBufferAttribute(t,i){return this._x=t.getX(i),this._y=t.getY(i),this._z=t.getZ(i),this._w=t.getW(i),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class me{constructor(t=0,i=0,n=0){me.prototype.isVector3=!0,this.x=t,this.y=i,this.z=n}set(t,i,n){return n===void 0&&(n=this.z),this.x=t,this.y=i,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this}addScaledVector(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this}applyEuler(t){return this.applyQuaternion(fH.setFromEuler(t))}applyAxisAngle(t,i){return this.applyQuaternion(fH.setFromAxisAngle(t,i))}applyMatrix3(t){const i=this.x,n=this.y,r=this.z,s=t.elements;return this.x=s[0]*i+s[3]*n+s[6]*r,this.y=s[1]*i+s[4]*n+s[7]*r,this.z=s[2]*i+s[5]*n+s[8]*r,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const i=this.x,n=this.y,r=this.z,s=t.elements,a=1/(s[3]*i+s[7]*n+s[11]*r+s[15]);return this.x=(s[0]*i+s[4]*n+s[8]*r+s[12])*a,this.y=(s[1]*i+s[5]*n+s[9]*r+s[13])*a,this.z=(s[2]*i+s[6]*n+s[10]*r+s[14])*a,this}applyQuaternion(t){const i=this.x,n=this.y,r=this.z,s=t.x,a=t.y,o=t.z,l=t.w,c=2*(a*r-o*n),u=2*(o*i-s*r),h=2*(s*n-a*i);return this.x=i+l*c+a*h-o*u,this.y=n+l*u+o*c-s*h,this.z=r+l*h+s*u-a*c,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const i=this.x,n=this.y,r=this.z,s=t.elements;return this.x=s[0]*i+s[4]*n+s[8]*r,this.y=s[1]*i+s[5]*n+s[9]*r,this.z=s[2]*i+s[6]*n+s[10]*r,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,i){return this.x=qi(this.x,t.x,i.x),this.y=qi(this.y,t.y,i.y),this.z=qi(this.z,t.z,i.z),this}clampScalar(t,i){return this.x=qi(this.x,t,i),this.y=qi(this.y,t,i),this.z=qi(this.z,t,i),this}clampLength(t,i){const n=this.length();return this.divideScalar(n||1).multiplyScalar(qi(n,t,i))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this}lerpVectors(t,i,n){return this.x=t.x+(i.x-t.x)*n,this.y=t.y+(i.y-t.y)*n,this.z=t.z+(i.z-t.z)*n,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,i){const n=t.x,r=t.y,s=t.z,a=i.x,o=i.y,l=i.z;return this.x=r*l-s*o,this.y=s*a-n*l,this.z=n*o-r*a,this}projectOnVector(t){const i=t.lengthSq();if(i===0)return this.set(0,0,0);const n=t.dot(this)/i;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return aO.copy(this).projectOnVector(t),this.sub(aO)}reflect(t){return this.sub(aO.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const i=Math.sqrt(this.lengthSq()*t.lengthSq());if(i===0)return Math.PI/2;const n=this.dot(t)/i;return Math.acos(qi(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const i=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return i*i+n*n+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,i,n){const r=Math.sin(i)*t;return this.x=r*Math.sin(n),this.y=Math.cos(i)*t,this.z=r*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,i,n){return this.x=t*Math.sin(i),this.y=n,this.z=t*Math.cos(i),this}setFromMatrixPosition(t){const i=t.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(t){const i=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=i,this.y=n,this.z=r,this}setFromMatrixColumn(t,i){return this.fromArray(t.elements,i*4)}setFromMatrix3Column(t,i){return this.fromArray(t.elements,i*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this}toArray(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t}fromBufferAttribute(t,i){return this.x=t.getX(i),this.y=t.getY(i),this.z=t.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,i=Math.random()*2-1,n=Math.sqrt(1-i*i);return this.x=n*Math.cos(t),this.y=i,this.z=n*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const aO=new me,fH=new ba;class Ki{constructor(t,i,n,r,s,a,o,l,c){Ki.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,i,n,r,s,a,o,l,c)}set(t,i,n,r,s,a,o,l,c){const u=this.elements;return u[0]=t,u[1]=r,u[2]=o,u[3]=i,u[4]=s,u[5]=l,u[6]=n,u[7]=a,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const i=this.elements,n=t.elements;return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],this}extractBasis(t,i,n){return t.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const i=t.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,i){const n=t.elements,r=i.elements,s=this.elements,a=n[0],o=n[3],l=n[6],c=n[1],u=n[4],h=n[7],d=n[2],p=n[5],g=n[8],x=r[0],y=r[3],b=r[6],A=r[1],w=r[4],E=r[7],D=r[2],T=r[5],I=r[8];return s[0]=a*x+o*A+l*D,s[3]=a*y+o*w+l*T,s[6]=a*b+o*E+l*I,s[1]=c*x+u*A+h*D,s[4]=c*y+u*w+h*T,s[7]=c*b+u*E+h*I,s[2]=d*x+p*A+g*D,s[5]=d*y+p*w+g*T,s[8]=d*b+p*E+g*I,this}multiplyScalar(t){const i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=t,i[4]*=t,i[7]*=t,i[2]*=t,i[5]*=t,i[8]*=t,this}determinant(){const t=this.elements,i=t[0],n=t[1],r=t[2],s=t[3],a=t[4],o=t[5],l=t[6],c=t[7],u=t[8];return i*a*u-i*o*c-n*s*u+n*o*l+r*s*c-r*a*l}invert(){const t=this.elements,i=t[0],n=t[1],r=t[2],s=t[3],a=t[4],o=t[5],l=t[6],c=t[7],u=t[8],h=u*a-o*c,d=o*l-u*s,p=c*s-a*l,g=i*h+n*d+r*p;if(g===0)return this.set(0,0,0,0,0,0,0,0,0);const x=1/g;return t[0]=h*x,t[1]=(r*c-u*n)*x,t[2]=(o*n-r*a)*x,t[3]=d*x,t[4]=(u*i-r*l)*x,t[5]=(r*s-o*i)*x,t[6]=p*x,t[7]=(n*l-c*i)*x,t[8]=(a*i-n*s)*x,this}transpose(){let t;const i=this.elements;return t=i[1],i[1]=i[3],i[3]=t,t=i[2],i[2]=i[6],i[6]=t,t=i[5],i[5]=i[7],i[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const i=this.elements;return t[0]=i[0],t[1]=i[3],t[2]=i[6],t[3]=i[1],t[4]=i[4],t[5]=i[7],t[6]=i[2],t[7]=i[5],t[8]=i[8],this}setUvTransform(t,i,n,r,s,a,o){const l=Math.cos(s),c=Math.sin(s);return this.set(n*l,n*c,-n*(l*a+c*o)+a+t,-r*c,r*l,-r*(-c*a+l*o)+o+i,0,0,1),this}scale(t,i){return this.premultiply(oO.makeScale(t,i)),this}rotate(t){return this.premultiply(oO.makeRotation(-t)),this}translate(t,i){return this.premultiply(oO.makeTranslation(t,i)),this}makeTranslation(t,i){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,i,0,0,1),this}makeRotation(t){const i=Math.cos(t),n=Math.sin(t);return this.set(i,-n,0,n,i,0,0,0,1),this}makeScale(t,i){return this.set(t,0,0,0,i,0,0,0,1),this}equals(t){const i=this.elements,n=t.elements;for(let r=0;r<9;r++)if(i[r]!==n[r])return!1;return!0}fromArray(t,i=0){for(let n=0;n<9;n++)this.elements[n]=t[n+i];return this}toArray(t=[],i=0){const n=this.elements;return t[i]=n[0],t[i+1]=n[1],t[i+2]=n[2],t[i+3]=n[3],t[i+4]=n[4],t[i+5]=n[5],t[i+6]=n[6],t[i+7]=n[7],t[i+8]=n[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const oO=new Ki;function _Y(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}const dae={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function s1(e,t){return new dae[e](t)}function ew(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function AY(){const e=ew("canvas");return e.style.display="block",e}const pH={};function S1(e){e in pH||(pH[e]=!0,console.warn(e))}function fae(e,t,i){return new Promise(function(n,r){function s(){switch(e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0)){case e.WAIT_FAILED:r();break;case e.TIMEOUT_EXPIRED:setTimeout(s,i);break;default:n()}}setTimeout(s,i)})}function pae(e){const t=e.elements;t[2]=.5*t[2]+.5*t[3],t[6]=.5*t[6]+.5*t[7],t[10]=.5*t[10]+.5*t[11],t[14]=.5*t[14]+.5*t[15]}function mae(e){const t=e.elements;t[11]===-1?(t[10]=-t[10]-1,t[14]=-t[14]):(t[10]=-t[10],t[14]=-t[14]+1)}const mH=new Ki().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),gH=new Ki().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function gae(){const e={enabled:!0,workingColorSpace:$m,spaces:{},convert:function(r,s,a){return this.enabled===!1||s===a||!s||!a||(this.spaces[s].transfer===Jn&&(r.r=Xf(r.r),r.g=Xf(r.g),r.b=Xf(r.b)),this.spaces[s].primaries!==this.spaces[a].primaries&&(r.applyMatrix3(this.spaces[s].toXYZ),r.applyMatrix3(this.spaces[a].fromXYZ)),this.spaces[a].transfer===Jn&&(r.r=_1(r.r),r.g=_1(r.g),r.b=_1(r.b))),r},workingToColorSpace:function(r,s){return this.convert(r,this.workingColorSpace,s)},colorSpaceToWorking:function(r,s){return this.convert(r,s,this.workingColorSpace)},getPrimaries:function(r){return this.spaces[r].primaries},getTransfer:function(r){return r===Of?JA:this.spaces[r].transfer},getLuminanceCoefficients:function(r,s=this.workingColorSpace){return r.fromArray(this.spaces[s].luminanceCoefficients)},define:function(r){Object.assign(this.spaces,r)},_getMatrix:function(r,s,a){return r.copy(this.spaces[s].toXYZ).multiply(this.spaces[a].fromXYZ)},_getDrawingBufferColorSpace:function(r){return this.spaces[r].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(r=this.workingColorSpace){return this.spaces[r].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(r,s){return S1("THREE.ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),e.workingToColorSpace(r,s)},toWorkingColorSpace:function(r,s){return S1("THREE.ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),e.colorSpaceToWorking(r,s)}},t=[.64,.33,.3,.6,.15,.06],i=[.2126,.7152,.0722],n=[.3127,.329];return e.define({[$m]:{primaries:t,whitePoint:n,transfer:JA,toXYZ:mH,fromXYZ:gH,luminanceCoefficients:i,workingColorSpaceConfig:{unpackColorSpace:fo},outputColorSpaceConfig:{drawingBufferColorSpace:fo}},[fo]:{primaries:t,whitePoint:n,transfer:Jn,toXYZ:mH,fromXYZ:gH,luminanceCoefficients:i,outputColorSpaceConfig:{drawingBufferColorSpace:fo}}}),e}const _n=gae();function Xf(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function _1(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}let ex;class wY{static getDataURL(t,i="image/png"){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let n;if(t instanceof HTMLCanvasElement)n=t;else{ex===void 0&&(ex=ew("canvas")),ex.width=t.width,ex.height=t.height;const r=ex.getContext("2d");t instanceof ImageData?r.putImageData(t,0,0):r.drawImage(t,0,0,t.width,t.height),n=ex}return n.toDataURL(i)}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const i=ew("canvas");i.width=t.width,i.height=t.height;const n=i.getContext("2d");n.drawImage(t,0,0,t.width,t.height);const r=n.getImageData(0,0,t.width,t.height),s=r.data;for(let a=0;a<s.length;a++)s[a]=Xf(s[a]/255)*255;return n.putImageData(r,0,0),i}else if(t.data){const i=t.data.slice(0);for(let n=0;n<i.length;n++)i instanceof Uint8Array||i instanceof Uint8ClampedArray?i[n]=Math.floor(Xf(i[n]/255)*255):i[n]=Xf(i[n]);return{data:i,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let vae=0;class Lm{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:vae++}),this.uuid=tc(),this.data=t,this.dataReady=!0,this.version=0}getSize(t){const i=this.data;return i instanceof HTMLVideoElement?t.set(i.videoWidth,i.videoHeight):i!==null?t.set(i.width,i.height,i.depth||0):t.set(0,0,0),t}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const i=t===void 0||typeof t=="string";if(!i&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(r!==null){let s;if(Array.isArray(r)){s=[];for(let a=0,o=r.length;a<o;a++)r[a].isDataTexture?s.push(lO(r[a].image)):s.push(lO(r[a]))}else s=lO(r);n.url=s}return i||(t.images[this.uuid]=n),n}}function lO(e){return typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap?wY.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let yae=0;const cO=new me;class vr extends Cd{constructor(t=vr.DEFAULT_IMAGE,i=vr.DEFAULT_MAPPING,n=Zl,r=Zl,s=hs,a=kc,o=go,l=Kc,c=vr.DEFAULT_ANISOTROPY,u=Of){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:yae++}),this.uuid=tc(),this.name="",this.source=new Lm(t),this.mipmaps=[],this.mapping=i,this.channel=0,this.wrapS=n,this.wrapT=r,this.magFilter=s,this.minFilter=a,this.anisotropy=c,this.format=o,this.internalFormat=null,this.type=l,this.offset=new Mt(0,0),this.repeat=new Mt(1,1),this.center=new Mt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ki,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(t&&t.depth&&t.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(cO).x}get height(){return this.source.getSize(cO).y}get depth(){return this.source.getSize(cO).z}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(t,i){this.updateRanges.push({start:t,count:i})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.renderTarget=t.renderTarget,this.isRenderTargetTexture=t.isRenderTargetTexture,this.isArrayTexture=t.isArrayTexture,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}setValues(t){for(const i in t){const n=t[i];if(n===void 0){console.warn(`THREE.Texture.setValues(): parameter '${i}' has value of undefined.`);continue}const r=this[i];if(r===void 0){console.warn(`THREE.Texture.setValues(): property '${i}' does not exist.`);continue}r&&n&&r.isVector2&&n.isVector2||r&&n&&r.isVector3&&n.isVector3||r&&n&&r.isMatrix3&&n.isMatrix3?r.copy(n):this[i]=n}}toJSON(t){const i=t===void 0||typeof t=="string";if(!i&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const n={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),i||(t.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==sR)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case Zm:t.x=t.x-Math.floor(t.x);break;case Zl:t.x=t.x<0?0:1;break;case z1:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case Zm:t.y=t.y-Math.floor(t.y);break;case Zl:t.y=t.y<0?0:1;break;case z1:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){t===!0&&this.pmremVersion++}}vr.DEFAULT_IMAGE=null;vr.DEFAULT_MAPPING=sR;vr.DEFAULT_ANISOTROPY=1;class Rn{constructor(t=0,i=0,n=0,r=1){Rn.prototype.isVector4=!0,this.x=t,this.y=i,this.z=n,this.w=r}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,i,n,r){return this.x=t,this.y=i,this.z=n,this.w=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this.w=t.w+i.w,this}addScaledVector(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this.w+=t.w*i,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this.w=t.w-i.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const i=this.x,n=this.y,r=this.z,s=this.w,a=t.elements;return this.x=a[0]*i+a[4]*n+a[8]*r+a[12]*s,this.y=a[1]*i+a[5]*n+a[9]*r+a[13]*s,this.z=a[2]*i+a[6]*n+a[10]*r+a[14]*s,this.w=a[3]*i+a[7]*n+a[11]*r+a[15]*s,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const i=Math.sqrt(1-t.w*t.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/i,this.y=t.y/i,this.z=t.z/i),this}setAxisAngleFromRotationMatrix(t){let i,n,r,s;const l=t.elements,c=l[0],u=l[4],h=l[8],d=l[1],p=l[5],g=l[9],x=l[2],y=l[6],b=l[10];if(Math.abs(u-d)<.01&&Math.abs(h-x)<.01&&Math.abs(g-y)<.01){if(Math.abs(u+d)<.1&&Math.abs(h+x)<.1&&Math.abs(g+y)<.1&&Math.abs(c+p+b-3)<.1)return this.set(1,0,0,0),this;i=Math.PI;const w=(c+1)/2,E=(p+1)/2,D=(b+1)/2,T=(u+d)/4,I=(h+x)/4,R=(g+y)/4;return w>E&&w>D?w<.01?(n=0,r=.707106781,s=.707106781):(n=Math.sqrt(w),r=T/n,s=I/n):E>D?E<.01?(n=.707106781,r=0,s=.707106781):(r=Math.sqrt(E),n=T/r,s=R/r):D<.01?(n=.707106781,r=.707106781,s=0):(s=Math.sqrt(D),n=I/s,r=R/s),this.set(n,r,s,i),this}let A=Math.sqrt((y-g)*(y-g)+(h-x)*(h-x)+(d-u)*(d-u));return Math.abs(A)<.001&&(A=1),this.x=(y-g)/A,this.y=(h-x)/A,this.z=(d-u)/A,this.w=Math.acos((c+p+b-1)/2),this}setFromMatrixPosition(t){const i=t.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this.w=i[15],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,i){return this.x=qi(this.x,t.x,i.x),this.y=qi(this.y,t.y,i.y),this.z=qi(this.z,t.z,i.z),this.w=qi(this.w,t.w,i.w),this}clampScalar(t,i){return this.x=qi(this.x,t,i),this.y=qi(this.y,t,i),this.z=qi(this.z,t,i),this.w=qi(this.w,t,i),this}clampLength(t,i){const n=this.length();return this.divideScalar(n||1).multiplyScalar(qi(n,t,i))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this.w+=(t.w-this.w)*i,this}lerpVectors(t,i,n){return this.x=t.x+(i.x-t.x)*n,this.y=t.y+(i.y-t.y)*n,this.z=t.z+(i.z-t.z)*n,this.w=t.w+(i.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this.w=t[i+3],this}toArray(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,t}fromBufferAttribute(t,i){return this.x=t.getX(i),this.y=t.getY(i),this.z=t.getZ(i),this.w=t.getW(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class aF extends Cd{constructor(t=1,i=1,n={}){super(),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:hs,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},n),this.isRenderTarget=!0,this.width=t,this.height=i,this.depth=n.depth,this.scissor=new Rn(0,0,t,i),this.scissorTest=!1,this.viewport=new Rn(0,0,t,i);const r={width:t,height:i,depth:n.depth},s=new vr(r);this.textures=[];const a=n.count;for(let o=0;o<a;o++)this.textures[o]=s.clone(),this.textures[o].isRenderTargetTexture=!0,this.textures[o].renderTarget=this;this._setTextureOptions(n),this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=n.depthTexture,this.samples=n.samples,this.multiview=n.multiview}_setTextureOptions(t={}){const i={minFilter:hs,generateMipmaps:!1,flipY:!1,internalFormat:null};t.mapping!==void 0&&(i.mapping=t.mapping),t.wrapS!==void 0&&(i.wrapS=t.wrapS),t.wrapT!==void 0&&(i.wrapT=t.wrapT),t.wrapR!==void 0&&(i.wrapR=t.wrapR),t.magFilter!==void 0&&(i.magFilter=t.magFilter),t.minFilter!==void 0&&(i.minFilter=t.minFilter),t.format!==void 0&&(i.format=t.format),t.type!==void 0&&(i.type=t.type),t.anisotropy!==void 0&&(i.anisotropy=t.anisotropy),t.colorSpace!==void 0&&(i.colorSpace=t.colorSpace),t.flipY!==void 0&&(i.flipY=t.flipY),t.generateMipmaps!==void 0&&(i.generateMipmaps=t.generateMipmaps),t.internalFormat!==void 0&&(i.internalFormat=t.internalFormat);for(let n=0;n<this.textures.length;n++)this.textures[n].setValues(i)}get texture(){return this.textures[0]}set texture(t){this.textures[0]=t}set depthTexture(t){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),t!==null&&(t.renderTarget=this),this._depthTexture=t}get depthTexture(){return this._depthTexture}setSize(t,i,n=1){if(this.width!==t||this.height!==i||this.depth!==n){this.width=t,this.height=i,this.depth=n;for(let r=0,s=this.textures.length;r<s;r++)this.textures[r].image.width=t,this.textures[r].image.height=i,this.textures[r].image.depth=n,this.textures[r].isArrayTexture=this.textures[r].image.depth>1;this.dispose()}this.viewport.set(0,0,t,i),this.scissor.set(0,0,t,i)}clone(){return new this.constructor().copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.textures.length=0;for(let i=0,n=t.textures.length;i<n;i++){this.textures[i]=t.textures[i].clone(),this.textures[i].isRenderTargetTexture=!0,this.textures[i].renderTarget=this;const r=Object.assign({},t.textures[i].image);this.textures[i].source=new Lm(r)}return this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.resolveDepthBuffer=t.resolveDepthBuffer,this.resolveStencilBuffer=t.resolveStencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Sd extends aF{constructor(t=1,i=1,n={}){super(t,i,n),this.isWebGLRenderTarget=!0}}class pR extends vr{constructor(t=null,i=1,n=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:i,height:n,depth:r},this.magFilter=xa,this.minFilter=xa,this.wrapR=Zl,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(t){this.layerUpdates.add(t)}clearLayerUpdates(){this.layerUpdates.clear()}}class xae extends Sd{constructor(t=1,i=1,n=1,r={}){super(t,i,r),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new pR(null,t,i,n),this._setTextureOptions(r),this.texture.isRenderTargetTexture=!0}}class mR extends vr{constructor(t=null,i=1,n=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:i,height:n,depth:r},this.magFilter=xa,this.minFilter=xa,this.wrapR=Zl,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class bae extends Sd{constructor(t=1,i=1,n=1,r={}){super(t,i,r),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new mR(null,t,i,n),this._setTextureOptions(r),this.texture.isRenderTargetTexture=!0}}class Ya{constructor(t=new me(1/0,1/0,1/0),i=new me(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=i}set(t,i){return this.min.copy(t),this.max.copy(i),this}setFromArray(t){this.makeEmpty();for(let i=0,n=t.length;i<n;i+=3)this.expandByPoint(Eu.fromArray(t,i));return this}setFromBufferAttribute(t){this.makeEmpty();for(let i=0,n=t.count;i<n;i++)this.expandByPoint(Eu.fromBufferAttribute(t,i));return this}setFromPoints(t){this.makeEmpty();for(let i=0,n=t.length;i<n;i++)this.expandByPoint(t[i]);return this}setFromCenterAndSize(t,i){const n=Eu.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t,i=!1){return this.makeEmpty(),this.expandByObject(t,i)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,i=!1){t.updateWorldMatrix(!1,!1);const n=t.geometry;if(n!==void 0){const s=n.getAttribute("position");if(i===!0&&s!==void 0&&t.isInstancedMesh!==!0)for(let a=0,o=s.count;a<o;a++)t.isMesh===!0?t.getVertexPosition(a,Eu):Eu.fromBufferAttribute(s,a),Eu.applyMatrix4(t.matrixWorld),this.expandByPoint(Eu);else t.boundingBox!==void 0?(t.boundingBox===null&&t.computeBoundingBox(),ZE.copy(t.boundingBox)):(n.boundingBox===null&&n.computeBoundingBox(),ZE.copy(n.boundingBox)),ZE.applyMatrix4(t.matrixWorld),this.union(ZE)}const r=t.children;for(let s=0,a=r.length;s<a;s++)this.expandByObject(r[s],i);return this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,i){return i.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y&&t.max.z>=this.min.z&&t.min.z<=this.max.z}intersectsSphere(t){return this.clampPoint(t.center,Eu),Eu.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let i,n;return t.normal.x>0?(i=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(i=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(i+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(i+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(i+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(i+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),i<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(l_),$E.subVectors(this.max,l_),tx.subVectors(t.a,l_),ix.subVectors(t.b,l_),nx.subVectors(t.c,l_),im.subVectors(ix,tx),nm.subVectors(nx,ix),cv.subVectors(tx,nx);let i=[0,-im.z,im.y,0,-nm.z,nm.y,0,-cv.z,cv.y,im.z,0,-im.x,nm.z,0,-nm.x,cv.z,0,-cv.x,-im.y,im.x,0,-nm.y,nm.x,0,-cv.y,cv.x,0];return!uO(i,tx,ix,nx,$E)||(i=[1,0,0,0,1,0,0,0,1],!uO(i,tx,ix,nx,$E))?!1:(e2.crossVectors(im,nm),i=[e2.x,e2.y,e2.z],uO(i,tx,ix,nx,$E))}clampPoint(t,i){return i.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,Eu).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=this.getSize(Eu).length()*.5),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(tf[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),tf[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),tf[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),tf[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),tf[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),tf[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),tf[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),tf[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(tf),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(t){return this.min.fromArray(t.min),this.max.fromArray(t.max),this}}const tf=[new me,new me,new me,new me,new me,new me,new me,new me],Eu=new me,ZE=new Ya,tx=new me,ix=new me,nx=new me,im=new me,nm=new me,cv=new me,l_=new me,$E=new me,e2=new me,uv=new me;function uO(e,t,i,n,r){for(let s=0,a=e.length-3;s<=a;s+=3){uv.fromArray(e,s);const o=r.x*Math.abs(uv.x)+r.y*Math.abs(uv.y)+r.z*Math.abs(uv.z),l=t.dot(uv),c=i.dot(uv),u=n.dot(uv);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>o)return!1}return!0}const Sae=new Ya,c_=new me,hO=new me;class Sa{constructor(t=new me,i=-1){this.isSphere=!0,this.center=t,this.radius=i}set(t,i){return this.center.copy(t),this.radius=i,this}setFromPoints(t,i){const n=this.center;i!==void 0?n.copy(i):Sae.setFromPoints(t).getCenter(n);let r=0;for(let s=0,a=t.length;s<a;s++)r=Math.max(r,n.distanceToSquared(t[s]));return this.radius=Math.sqrt(r),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const i=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=i*i}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,i){const n=this.center.distanceToSquared(t);return i.copy(t),n>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;c_.subVectors(t,this.center);const i=c_.lengthSq();if(i>this.radius*this.radius){const n=Math.sqrt(i),r=(n-this.radius)*.5;this.center.addScaledVector(c_,r/n),this.radius+=r}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):(hO.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(c_.copy(t.center).add(hO)),this.expandByPoint(c_.copy(t.center).sub(hO))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(t){return this.radius=t.radius,this.center.fromArray(t.center),this}}const nf=new me,dO=new me,t2=new me,rm=new me,fO=new me,i2=new me,pO=new me;class k0{constructor(t=new me,i=new me(0,0,-1)){this.origin=t,this.direction=i}set(t,i){return this.origin.copy(t),this.direction.copy(i),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,i){return i.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,nf)),this}closestPointToPoint(t,i){i.subVectors(t,this.origin);const n=i.dot(this.direction);return n<0?i.copy(this.origin):i.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const i=nf.subVectors(t,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(t):(nf.copy(this.origin).addScaledVector(this.direction,i),nf.distanceToSquared(t))}distanceSqToSegment(t,i,n,r){dO.copy(t).add(i).multiplyScalar(.5),t2.copy(i).sub(t).normalize(),rm.copy(this.origin).sub(dO);const s=t.distanceTo(i)*.5,a=-this.direction.dot(t2),o=rm.dot(this.direction),l=-rm.dot(t2),c=rm.lengthSq(),u=Math.abs(1-a*a);let h,d,p,g;if(u>0)if(h=a*l-o,d=a*o-l,g=s*u,h>=0)if(d>=-g)if(d<=g){const x=1/u;h*=x,d*=x,p=h*(h+a*d+2*o)+d*(a*h+d+2*l)+c}else d=s,h=Math.max(0,-(a*d+o)),p=-h*h+d*(d+2*l)+c;else d=-s,h=Math.max(0,-(a*d+o)),p=-h*h+d*(d+2*l)+c;else d<=-g?(h=Math.max(0,-(-a*s+o)),d=h>0?-s:Math.min(Math.max(-s,-l),s),p=-h*h+d*(d+2*l)+c):d<=g?(h=0,d=Math.min(Math.max(-s,-l),s),p=d*(d+2*l)+c):(h=Math.max(0,-(a*s+o)),d=h>0?s:Math.min(Math.max(-s,-l),s),p=-h*h+d*(d+2*l)+c);else d=a>0?-s:s,h=Math.max(0,-(a*d+o)),p=-h*h+d*(d+2*l)+c;return n&&n.copy(this.origin).addScaledVector(this.direction,h),r&&r.copy(dO).addScaledVector(t2,d),p}intersectSphere(t,i){nf.subVectors(t.center,this.origin);const n=nf.dot(this.direction),r=nf.dot(nf)-n*n,s=t.radius*t.radius;if(r>s)return null;const a=Math.sqrt(s-r),o=n-a,l=n+a;return l<0?null:o<0?this.at(l,i):this.at(o,i)}intersectsSphere(t){return t.radius<0?!1:this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const i=t.normal.dot(this.direction);if(i===0)return t.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(t.normal)+t.constant)/i;return n>=0?n:null}intersectPlane(t,i){const n=this.distanceToPlane(t);return n===null?null:this.at(n,i)}intersectsPlane(t){const i=t.distanceToPoint(this.origin);return i===0||t.normal.dot(this.direction)*i<0}intersectBox(t,i){let n,r,s,a,o,l;const c=1/this.direction.x,u=1/this.direction.y,h=1/this.direction.z,d=this.origin;return c>=0?(n=(t.min.x-d.x)*c,r=(t.max.x-d.x)*c):(n=(t.max.x-d.x)*c,r=(t.min.x-d.x)*c),u>=0?(s=(t.min.y-d.y)*u,a=(t.max.y-d.y)*u):(s=(t.max.y-d.y)*u,a=(t.min.y-d.y)*u),n>a||s>r||((s>n||isNaN(n))&&(n=s),(a<r||isNaN(r))&&(r=a),h>=0?(o=(t.min.z-d.z)*h,l=(t.max.z-d.z)*h):(o=(t.max.z-d.z)*h,l=(t.min.z-d.z)*h),n>l||o>r)||((o>n||n!==n)&&(n=o),(l<r||r!==r)&&(r=l),r<0)?null:this.at(n>=0?n:r,i)}intersectsBox(t){return this.intersectBox(t,nf)!==null}intersectTriangle(t,i,n,r,s){fO.subVectors(i,t),i2.subVectors(n,t),pO.crossVectors(fO,i2);let a=this.direction.dot(pO),o;if(a>0){if(r)return null;o=1}else if(a<0)o=-1,a=-a;else return null;rm.subVectors(this.origin,t);const l=o*this.direction.dot(i2.crossVectors(rm,i2));if(l<0)return null;const c=o*this.direction.dot(fO.cross(rm));if(c<0||l+c>a)return null;const u=-o*rm.dot(pO);return u<0?null:this.at(u/a,s)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class di{constructor(t,i,n,r,s,a,o,l,c,u,h,d,p,g,x,y){di.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t!==void 0&&this.set(t,i,n,r,s,a,o,l,c,u,h,d,p,g,x,y)}set(t,i,n,r,s,a,o,l,c,u,h,d,p,g,x,y){const b=this.elements;return b[0]=t,b[4]=i,b[8]=n,b[12]=r,b[1]=s,b[5]=a,b[9]=o,b[13]=l,b[2]=c,b[6]=u,b[10]=h,b[14]=d,b[3]=p,b[7]=g,b[11]=x,b[15]=y,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new di().fromArray(this.elements)}copy(t){const i=this.elements,n=t.elements;return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],this}copyPosition(t){const i=this.elements,n=t.elements;return i[12]=n[12],i[13]=n[13],i[14]=n[14],this}setFromMatrix3(t){const i=t.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(t,i,n){return t.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,i,n){return this.set(t.x,i.x,n.x,0,t.y,i.y,n.y,0,t.z,i.z,n.z,0,0,0,0,1),this}extractRotation(t){const i=this.elements,n=t.elements,r=1/rx.setFromMatrixColumn(t,0).length(),s=1/rx.setFromMatrixColumn(t,1).length(),a=1/rx.setFromMatrixColumn(t,2).length();return i[0]=n[0]*r,i[1]=n[1]*r,i[2]=n[2]*r,i[3]=0,i[4]=n[4]*s,i[5]=n[5]*s,i[6]=n[6]*s,i[7]=0,i[8]=n[8]*a,i[9]=n[9]*a,i[10]=n[10]*a,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(t){const i=this.elements,n=t.x,r=t.y,s=t.z,a=Math.cos(n),o=Math.sin(n),l=Math.cos(r),c=Math.sin(r),u=Math.cos(s),h=Math.sin(s);if(t.order==="XYZ"){const d=a*u,p=a*h,g=o*u,x=o*h;i[0]=l*u,i[4]=-l*h,i[8]=c,i[1]=p+g*c,i[5]=d-x*c,i[9]=-o*l,i[2]=x-d*c,i[6]=g+p*c,i[10]=a*l}else if(t.order==="YXZ"){const d=l*u,p=l*h,g=c*u,x=c*h;i[0]=d+x*o,i[4]=g*o-p,i[8]=a*c,i[1]=a*h,i[5]=a*u,i[9]=-o,i[2]=p*o-g,i[6]=x+d*o,i[10]=a*l}else if(t.order==="ZXY"){const d=l*u,p=l*h,g=c*u,x=c*h;i[0]=d-x*o,i[4]=-a*h,i[8]=g+p*o,i[1]=p+g*o,i[5]=a*u,i[9]=x-d*o,i[2]=-a*c,i[6]=o,i[10]=a*l}else if(t.order==="ZYX"){const d=a*u,p=a*h,g=o*u,x=o*h;i[0]=l*u,i[4]=g*c-p,i[8]=d*c+x,i[1]=l*h,i[5]=x*c+d,i[9]=p*c-g,i[2]=-c,i[6]=o*l,i[10]=a*l}else if(t.order==="YZX"){const d=a*l,p=a*c,g=o*l,x=o*c;i[0]=l*u,i[4]=x-d*h,i[8]=g*h+p,i[1]=h,i[5]=a*u,i[9]=-o*u,i[2]=-c*u,i[6]=p*h+g,i[10]=d-x*h}else if(t.order==="XZY"){const d=a*l,p=a*c,g=o*l,x=o*c;i[0]=l*u,i[4]=-h,i[8]=c*u,i[1]=d*h+x,i[5]=a*u,i[9]=p*h-g,i[2]=g*h-p,i[6]=o*u,i[10]=x*h+d}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(t){return this.compose(_ae,t,Aae)}lookAt(t,i,n){const r=this.elements;return Xl.subVectors(t,i),Xl.lengthSq()===0&&(Xl.z=1),Xl.normalize(),sm.crossVectors(n,Xl),sm.lengthSq()===0&&(Math.abs(n.z)===1?Xl.x+=1e-4:Xl.z+=1e-4,Xl.normalize(),sm.crossVectors(n,Xl)),sm.normalize(),n2.crossVectors(Xl,sm),r[0]=sm.x,r[4]=n2.x,r[8]=Xl.x,r[1]=sm.y,r[5]=n2.y,r[9]=Xl.y,r[2]=sm.z,r[6]=n2.z,r[10]=Xl.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,i){const n=t.elements,r=i.elements,s=this.elements,a=n[0],o=n[4],l=n[8],c=n[12],u=n[1],h=n[5],d=n[9],p=n[13],g=n[2],x=n[6],y=n[10],b=n[14],A=n[3],w=n[7],E=n[11],D=n[15],T=r[0],I=r[4],R=r[8],O=r[12],P=r[1],U=r[5],H=r[9],V=r[13],j=r[2],J=r[6],F=r[10],X=r[14],W=r[3],ne=r[7],Y=r[11],$=r[15];return s[0]=a*T+o*P+l*j+c*W,s[4]=a*I+o*U+l*J+c*ne,s[8]=a*R+o*H+l*F+c*Y,s[12]=a*O+o*V+l*X+c*$,s[1]=u*T+h*P+d*j+p*W,s[5]=u*I+h*U+d*J+p*ne,s[9]=u*R+h*H+d*F+p*Y,s[13]=u*O+h*V+d*X+p*$,s[2]=g*T+x*P+y*j+b*W,s[6]=g*I+x*U+y*J+b*ne,s[10]=g*R+x*H+y*F+b*Y,s[14]=g*O+x*V+y*X+b*$,s[3]=A*T+w*P+E*j+D*W,s[7]=A*I+w*U+E*J+D*ne,s[11]=A*R+w*H+E*F+D*Y,s[15]=A*O+w*V+E*X+D*$,this}multiplyScalar(t){const i=this.elements;return i[0]*=t,i[4]*=t,i[8]*=t,i[12]*=t,i[1]*=t,i[5]*=t,i[9]*=t,i[13]*=t,i[2]*=t,i[6]*=t,i[10]*=t,i[14]*=t,i[3]*=t,i[7]*=t,i[11]*=t,i[15]*=t,this}determinant(){const t=this.elements,i=t[0],n=t[4],r=t[8],s=t[12],a=t[1],o=t[5],l=t[9],c=t[13],u=t[2],h=t[6],d=t[10],p=t[14],g=t[3],x=t[7],y=t[11],b=t[15];return g*(+s*l*h-r*c*h-s*o*d+n*c*d+r*o*p-n*l*p)+x*(+i*l*p-i*c*d+s*a*d-r*a*p+r*c*u-s*l*u)+y*(+i*c*h-i*o*p-s*a*h+n*a*p+s*o*u-n*c*u)+b*(-r*o*u-i*l*h+i*o*d+r*a*h-n*a*d+n*l*u)}transpose(){const t=this.elements;let i;return i=t[1],t[1]=t[4],t[4]=i,i=t[2],t[2]=t[8],t[8]=i,i=t[6],t[6]=t[9],t[9]=i,i=t[3],t[3]=t[12],t[12]=i,i=t[7],t[7]=t[13],t[13]=i,i=t[11],t[11]=t[14],t[14]=i,this}setPosition(t,i,n){const r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=i,r[14]=n),this}invert(){const t=this.elements,i=t[0],n=t[1],r=t[2],s=t[3],a=t[4],o=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],g=t[12],x=t[13],y=t[14],b=t[15],A=h*y*c-x*d*c+x*l*p-o*y*p-h*l*b+o*d*b,w=g*d*c-u*y*c-g*l*p+a*y*p+u*l*b-a*d*b,E=u*x*c-g*h*c+g*o*p-a*x*p-u*o*b+a*h*b,D=g*h*l-u*x*l-g*o*d+a*x*d+u*o*y-a*h*y,T=i*A+n*w+r*E+s*D;if(T===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const I=1/T;return t[0]=A*I,t[1]=(x*d*s-h*y*s-x*r*p+n*y*p+h*r*b-n*d*b)*I,t[2]=(o*y*s-x*l*s+x*r*c-n*y*c-o*r*b+n*l*b)*I,t[3]=(h*l*s-o*d*s-h*r*c+n*d*c+o*r*p-n*l*p)*I,t[4]=w*I,t[5]=(u*y*s-g*d*s+g*r*p-i*y*p-u*r*b+i*d*b)*I,t[6]=(g*l*s-a*y*s-g*r*c+i*y*c+a*r*b-i*l*b)*I,t[7]=(a*d*s-u*l*s+u*r*c-i*d*c-a*r*p+i*l*p)*I,t[8]=E*I,t[9]=(g*h*s-u*x*s-g*n*p+i*x*p+u*n*b-i*h*b)*I,t[10]=(a*x*s-g*o*s+g*n*c-i*x*c-a*n*b+i*o*b)*I,t[11]=(u*o*s-a*h*s-u*n*c+i*h*c+a*n*p-i*o*p)*I,t[12]=D*I,t[13]=(u*x*r-g*h*r+g*n*d-i*x*d-u*n*y+i*h*y)*I,t[14]=(g*o*r-a*x*r-g*n*l+i*x*l+a*n*y-i*o*y)*I,t[15]=(a*h*r-u*o*r+u*n*l-i*h*l-a*n*d+i*o*d)*I,this}scale(t){const i=this.elements,n=t.x,r=t.y,s=t.z;return i[0]*=n,i[4]*=r,i[8]*=s,i[1]*=n,i[5]*=r,i[9]*=s,i[2]*=n,i[6]*=r,i[10]*=s,i[3]*=n,i[7]*=r,i[11]*=s,this}getMaxScaleOnAxis(){const t=this.elements,i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(i,n,r))}makeTranslation(t,i,n){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,i,0,0,1,n,0,0,0,1),this}makeRotationX(t){const i=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,i,-n,0,0,n,i,0,0,0,0,1),this}makeRotationY(t){const i=Math.cos(t),n=Math.sin(t);return this.set(i,0,n,0,0,1,0,0,-n,0,i,0,0,0,0,1),this}makeRotationZ(t){const i=Math.cos(t),n=Math.sin(t);return this.set(i,-n,0,0,n,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,i){const n=Math.cos(i),r=Math.sin(i),s=1-n,a=t.x,o=t.y,l=t.z,c=s*a,u=s*o;return this.set(c*a+n,c*o-r*l,c*l+r*o,0,c*o+r*l,u*o+n,u*l-r*a,0,c*l-r*o,u*l+r*a,s*l*l+n,0,0,0,0,1),this}makeScale(t,i,n){return this.set(t,0,0,0,0,i,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,i,n,r,s,a){return this.set(1,n,s,0,t,1,a,0,i,r,1,0,0,0,0,1),this}compose(t,i,n){const r=this.elements,s=i._x,a=i._y,o=i._z,l=i._w,c=s+s,u=a+a,h=o+o,d=s*c,p=s*u,g=s*h,x=a*u,y=a*h,b=o*h,A=l*c,w=l*u,E=l*h,D=n.x,T=n.y,I=n.z;return r[0]=(1-(x+b))*D,r[1]=(p+E)*D,r[2]=(g-w)*D,r[3]=0,r[4]=(p-E)*T,r[5]=(1-(d+b))*T,r[6]=(y+A)*T,r[7]=0,r[8]=(g+w)*I,r[9]=(y-A)*I,r[10]=(1-(d+x))*I,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this}decompose(t,i,n){const r=this.elements;let s=rx.set(r[0],r[1],r[2]).length();const a=rx.set(r[4],r[5],r[6]).length(),o=rx.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),t.x=r[12],t.y=r[13],t.z=r[14],Tu.copy(this);const c=1/s,u=1/a,h=1/o;return Tu.elements[0]*=c,Tu.elements[1]*=c,Tu.elements[2]*=c,Tu.elements[4]*=u,Tu.elements[5]*=u,Tu.elements[6]*=u,Tu.elements[8]*=h,Tu.elements[9]*=h,Tu.elements[10]*=h,i.setFromRotationMatrix(Tu),n.x=s,n.y=a,n.z=o,this}makePerspective(t,i,n,r,s,a,o=jc){const l=this.elements,c=2*s/(i-t),u=2*s/(n-r),h=(i+t)/(i-t),d=(n+r)/(n-r);let p,g;if(o===jc)p=-(a+s)/(a-s),g=-2*a*s/(a-s);else if(o===$A)p=-a/(a-s),g=-a*s/(a-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return l[0]=c,l[4]=0,l[8]=h,l[12]=0,l[1]=0,l[5]=u,l[9]=d,l[13]=0,l[2]=0,l[6]=0,l[10]=p,l[14]=g,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(t,i,n,r,s,a,o=jc){const l=this.elements,c=1/(i-t),u=1/(n-r),h=1/(a-s),d=(i+t)*c,p=(n+r)*u;let g,x;if(o===jc)g=(a+s)*h,x=-2*h;else if(o===$A)g=s*h,x=-1*h;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-d,l[1]=0,l[5]=2*u,l[9]=0,l[13]=-p,l[2]=0,l[6]=0,l[10]=x,l[14]=-g,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(t){const i=this.elements,n=t.elements;for(let r=0;r<16;r++)if(i[r]!==n[r])return!1;return!0}fromArray(t,i=0){for(let n=0;n<16;n++)this.elements[n]=t[n+i];return this}toArray(t=[],i=0){const n=this.elements;return t[i]=n[0],t[i+1]=n[1],t[i+2]=n[2],t[i+3]=n[3],t[i+4]=n[4],t[i+5]=n[5],t[i+6]=n[6],t[i+7]=n[7],t[i+8]=n[8],t[i+9]=n[9],t[i+10]=n[10],t[i+11]=n[11],t[i+12]=n[12],t[i+13]=n[13],t[i+14]=n[14],t[i+15]=n[15],t}}const rx=new me,Tu=new di,_ae=new me(0,0,0),Aae=new me(1,1,1),sm=new me,n2=new me,Xl=new me,vH=new di,yH=new ba;class tl{constructor(t=0,i=0,n=0,r=tl.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=i,this._z=n,this._order=r}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,i,n,r=this._order){return this._x=t,this._y=i,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,i=this._order,n=!0){const r=t.elements,s=r[0],a=r[4],o=r[8],l=r[1],c=r[5],u=r[9],h=r[2],d=r[6],p=r[10];switch(i){case"XYZ":this._y=Math.asin(qi(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-u,p),this._z=Math.atan2(-a,s)):(this._x=Math.atan2(d,c),this._z=0);break;case"YXZ":this._x=Math.asin(-qi(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(o,p),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,s),this._z=0);break;case"ZXY":this._x=Math.asin(qi(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-a,c)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-qi(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(d,p),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-a,c));break;case"YZX":this._z=Math.asin(qi(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,s)):(this._x=0,this._y=Math.atan2(o,p));break;case"XZY":this._z=Math.asin(-qi(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(d,c),this._y=Math.atan2(o,s)):(this._x=Math.atan2(-u,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,n===!0&&this._onChangeCallback(),this}setFromQuaternion(t,i,n){return vH.makeRotationFromQuaternion(t),this.setFromRotationMatrix(vH,i,n)}setFromVector3(t,i=this._order){return this.set(t.x,t.y,t.z,i)}reorder(t){return yH.setFromEuler(this),this.setFromQuaternion(yH,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],i=0){return t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}tl.DEFAULT_ORDER="XYZ";class X1{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}}let wae=0;const xH=new me,sx=new ba,rf=new di,r2=new me,u_=new me,Mae=new me,Eae=new ba,bH=new me(1,0,0),SH=new me(0,1,0),_H=new me(0,0,1),AH={type:"added"},Tae={type:"removed"},ax={type:"childadded",child:null},mO={type:"childremoved",child:null};class gn extends Cd{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:wae++}),this.uuid=tc(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=gn.DEFAULT_UP.clone();const t=new me,i=new tl,n=new ba,r=new me(1,1,1);function s(){n.setFromEuler(i,!1)}function a(){i.setFromQuaternion(n,void 0,!1)}i._onChange(s),n._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new di},normalMatrix:{value:new Ki}}),this.matrix=new di,this.matrixWorld=new di,this.matrixAutoUpdate=gn.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=gn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new X1,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,i){this.quaternion.setFromAxisAngle(t,i)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,i){return sx.setFromAxisAngle(t,i),this.quaternion.multiply(sx),this}rotateOnWorldAxis(t,i){return sx.setFromAxisAngle(t,i),this.quaternion.premultiply(sx),this}rotateX(t){return this.rotateOnAxis(bH,t)}rotateY(t){return this.rotateOnAxis(SH,t)}rotateZ(t){return this.rotateOnAxis(_H,t)}translateOnAxis(t,i){return xH.copy(t).applyQuaternion(this.quaternion),this.position.add(xH.multiplyScalar(i)),this}translateX(t){return this.translateOnAxis(bH,t)}translateY(t){return this.translateOnAxis(SH,t)}translateZ(t){return this.translateOnAxis(_H,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(rf.copy(this.matrixWorld).invert())}lookAt(t,i,n){t.isVector3?r2.copy(t):r2.set(t,i,n);const r=this.parent;this.updateWorldMatrix(!0,!1),u_.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?rf.lookAt(u_,r2,this.up):rf.lookAt(r2,u_,this.up),this.quaternion.setFromRotationMatrix(rf),r&&(rf.extractRotation(r.matrixWorld),sx.setFromRotationMatrix(rf),this.quaternion.premultiply(sx.invert()))}add(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(AH),ax.child=t,this.dispatchEvent(ax),ax.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const i=this.children.indexOf(t);return i!==-1&&(t.parent=null,this.children.splice(i,1),t.dispatchEvent(Tae),mO.child=t,this.dispatchEvent(mO),mO.child=null),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),rf.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),rf.multiply(t.parent.matrixWorld)),t.applyMatrix4(rf),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(AH),ax.child=t,this.dispatchEvent(ax),ax.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,i){if(this[t]===i)return this;for(let n=0,r=this.children.length;n<r;n++){const a=this.children[n].getObjectByProperty(t,i);if(a!==void 0)return a}}getObjectsByProperty(t,i,n=[]){this[t]===i&&n.push(this);const r=this.children;for(let s=0,a=r.length;s<a;s++)r[s].getObjectsByProperty(t,i,n);return n}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(u_,t,Mae),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(u_,Eae,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return t.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(t){t(this);const i=this.children;for(let n=0,r=i.length;n<r;n++)i[n].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const i=this.children;for(let n=0,r=i.length;n<r;n++)i[n].traverseVisible(t)}traverseAncestors(t){const i=this.parent;i!==null&&(t(i),i.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);const i=this.children;for(let n=0,r=i.length;n<r;n++)i[n].updateMatrixWorld(t)}updateWorldMatrix(t,i){const n=this.parent;if(t===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),i===!0){const r=this.children;for(let s=0,a=r.length;s<a;s++)r[s].updateWorldMatrix(!1,!0)}}toJSON(t){const i=t===void 0||typeof t=="string",n={};i&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.geometryInfo=this._geometryInfo.map(o=>({...o,boundingBox:o.boundingBox?o.boundingBox.toJSON():void 0,boundingSphere:o.boundingSphere?o.boundingSphere.toJSON():void 0})),r.instanceInfo=this._instanceInfo.map(o=>({...o})),r.availableInstanceIds=this._availableInstanceIds.slice(),r.availableGeometryIds=this._availableGeometryIds.slice(),r.nextIndexStart=this._nextIndexStart,r.nextVertexStart=this._nextVertexStart,r.geometryCount=this._geometryCount,r.maxInstanceCount=this._maxInstanceCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.matricesTexture=this._matricesTexture.toJSON(t),r.indirectTexture=this._indirectTexture.toJSON(t),this._colorsTexture!==null&&(r.colorsTexture=this._colorsTexture.toJSON(t)),this.boundingSphere!==null&&(r.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(r.boundingBox=this.boundingBox.toJSON()));function s(o,l){return o[l.uuid]===void 0&&(o[l.uuid]=l.toJSON(t)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=s(t.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const l=o.shapes;if(Array.isArray(l))for(let c=0,u=l.length;c<u;c++){const h=l[c];s(t.shapes,h)}else s(t.shapes,l)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(t.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let l=0,c=this.material.length;l<c;l++)o.push(s(t.materials,this.material[l]));r.material=o}else r.material=s(t.materials,this.material);if(this.children.length>0){r.children=[];for(let o=0;o<this.children.length;o++)r.children.push(this.children[o].toJSON(t).object)}if(this.animations.length>0){r.animations=[];for(let o=0;o<this.animations.length;o++){const l=this.animations[o];r.animations.push(s(t.animations,l))}}if(i){const o=a(t.geometries),l=a(t.materials),c=a(t.textures),u=a(t.images),h=a(t.shapes),d=a(t.skeletons),p=a(t.animations),g=a(t.nodes);o.length>0&&(n.geometries=o),l.length>0&&(n.materials=l),c.length>0&&(n.textures=c),u.length>0&&(n.images=u),h.length>0&&(n.shapes=h),d.length>0&&(n.skeletons=d),p.length>0&&(n.animations=p),g.length>0&&(n.nodes=g)}return n.object=r,n;function a(o){const l=[];for(const c in o){const u=o[c];delete u.metadata,l.push(u)}return l}}clone(t){return new this.constructor().copy(this,t)}copy(t,i=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),i===!0)for(let n=0;n<t.children.length;n++){const r=t.children[n];this.add(r.clone())}return this}}gn.DEFAULT_UP=new me(0,1,0);gn.DEFAULT_MATRIX_AUTO_UPDATE=!0;gn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Cu=new me,sf=new me,gO=new me,af=new me,ox=new me,lx=new me,wH=new me,vO=new me,yO=new me,xO=new me,bO=new Rn,SO=new Rn,_O=new Rn;class wl{constructor(t=new me,i=new me,n=new me){this.a=t,this.b=i,this.c=n}static getNormal(t,i,n,r){r.subVectors(n,i),Cu.subVectors(t,i),r.cross(Cu);const s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(t,i,n,r,s){Cu.subVectors(r,i),sf.subVectors(n,i),gO.subVectors(t,i);const a=Cu.dot(Cu),o=Cu.dot(sf),l=Cu.dot(gO),c=sf.dot(sf),u=sf.dot(gO),h=a*c-o*o;if(h===0)return s.set(0,0,0),null;const d=1/h,p=(c*l-o*u)*d,g=(a*u-o*l)*d;return s.set(1-p-g,g,p)}static containsPoint(t,i,n,r){return this.getBarycoord(t,i,n,r,af)===null?!1:af.x>=0&&af.y>=0&&af.x+af.y<=1}static getInterpolation(t,i,n,r,s,a,o,l){return this.getBarycoord(t,i,n,r,af)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(s,af.x),l.addScaledVector(a,af.y),l.addScaledVector(o,af.z),l)}static getInterpolatedAttribute(t,i,n,r,s,a){return bO.setScalar(0),SO.setScalar(0),_O.setScalar(0),bO.fromBufferAttribute(t,i),SO.fromBufferAttribute(t,n),_O.fromBufferAttribute(t,r),a.setScalar(0),a.addScaledVector(bO,s.x),a.addScaledVector(SO,s.y),a.addScaledVector(_O,s.z),a}static isFrontFacing(t,i,n,r){return Cu.subVectors(n,i),sf.subVectors(t,i),Cu.cross(sf).dot(r)<0}set(t,i,n){return this.a.copy(t),this.b.copy(i),this.c.copy(n),this}setFromPointsAndIndices(t,i,n,r){return this.a.copy(t[i]),this.b.copy(t[n]),this.c.copy(t[r]),this}setFromAttributeAndIndices(t,i,n,r){return this.a.fromBufferAttribute(t,i),this.b.fromBufferAttribute(t,n),this.c.fromBufferAttribute(t,r),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Cu.subVectors(this.c,this.b),sf.subVectors(this.a,this.b),Cu.cross(sf).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return wl.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,i){return wl.getBarycoord(t,this.a,this.b,this.c,i)}getInterpolation(t,i,n,r,s){return wl.getInterpolation(t,this.a,this.b,this.c,i,n,r,s)}containsPoint(t){return wl.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return wl.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,i){const n=this.a,r=this.b,s=this.c;let a,o;ox.subVectors(r,n),lx.subVectors(s,n),vO.subVectors(t,n);const l=ox.dot(vO),c=lx.dot(vO);if(l<=0&&c<=0)return i.copy(n);yO.subVectors(t,r);const u=ox.dot(yO),h=lx.dot(yO);if(u>=0&&h<=u)return i.copy(r);const d=l*h-u*c;if(d<=0&&l>=0&&u<=0)return a=l/(l-u),i.copy(n).addScaledVector(ox,a);xO.subVectors(t,s);const p=ox.dot(xO),g=lx.dot(xO);if(g>=0&&p<=g)return i.copy(s);const x=p*c-l*g;if(x<=0&&c>=0&&g<=0)return o=c/(c-g),i.copy(n).addScaledVector(lx,o);const y=u*g-p*h;if(y<=0&&h-u>=0&&p-g>=0)return wH.subVectors(s,r),o=(h-u)/(h-u+(p-g)),i.copy(r).addScaledVector(wH,o);const b=1/(y+x+d);return a=x*b,o=d*b,i.copy(n).addScaledVector(ox,a).addScaledVector(lx,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const MY={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},am={h:0,s:0,l:0},s2={h:0,s:0,l:0};function AO(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+(t-e)*6*i:i<1/2?t:i<2/3?e+(t-e)*6*(2/3-i):e}class jt{constructor(t,i,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,i,n)}set(t,i,n){if(i===void 0&&n===void 0){const r=t;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(t,i,n);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,i=fo){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,_n.colorSpaceToWorking(this,i),this}setRGB(t,i,n,r=_n.workingColorSpace){return this.r=t,this.g=i,this.b=n,_n.colorSpaceToWorking(this,r),this}setHSL(t,i,n,r=_n.workingColorSpace){if(t=rF(t,1),i=qi(i,0,1),n=qi(n,0,1),i===0)this.r=this.g=this.b=n;else{const s=n<=.5?n*(1+i):n+i-n*i,a=2*n-s;this.r=AO(a,s,t+1/3),this.g=AO(a,s,t),this.b=AO(a,s,t-1/3)}return _n.colorSpaceToWorking(this,r),this}setStyle(t,i=fo){function n(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(t)){let s;const a=r[1],o=r[2];switch(a){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,i);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,i);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,i);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(t)){const s=r[1],a=s.length;if(a===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,i);if(a===6)return this.setHex(parseInt(s,16),i);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,i);return this}setColorName(t,i=fo){const n=MY[t.toLowerCase()];return n!==void 0?this.setHex(n,i):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Xf(t.r),this.g=Xf(t.g),this.b=Xf(t.b),this}copyLinearToSRGB(t){return this.r=_1(t.r),this.g=_1(t.g),this.b=_1(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=fo){return _n.workingToColorSpace(oo.copy(this),t),Math.round(qi(oo.r*255,0,255))*65536+Math.round(qi(oo.g*255,0,255))*256+Math.round(qi(oo.b*255,0,255))}getHexString(t=fo){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,i=_n.workingColorSpace){_n.workingToColorSpace(oo.copy(this),i);const n=oo.r,r=oo.g,s=oo.b,a=Math.max(n,r,s),o=Math.min(n,r,s);let l,c;const u=(o+a)/2;if(o===a)l=0,c=0;else{const h=a-o;switch(c=u<=.5?h/(a+o):h/(2-a-o),a){case n:l=(r-s)/h+(r<s?6:0);break;case r:l=(s-n)/h+2;break;case s:l=(n-r)/h+4;break}l/=6}return t.h=l,t.s=c,t.l=u,t}getRGB(t,i=_n.workingColorSpace){return _n.workingToColorSpace(oo.copy(this),i),t.r=oo.r,t.g=oo.g,t.b=oo.b,t}getStyle(t=fo){_n.workingToColorSpace(oo.copy(this),t);const i=oo.r,n=oo.g,r=oo.b;return t!==fo?`color(${t} ${i.toFixed(3)} ${n.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(i*255)},${Math.round(n*255)},${Math.round(r*255)})`}offsetHSL(t,i,n){return this.getHSL(am),this.setHSL(am.h+t,am.s+i,am.l+n)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,i){return this.r=t.r+i.r,this.g=t.g+i.g,this.b=t.b+i.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,i){return this.r+=(t.r-this.r)*i,this.g+=(t.g-this.g)*i,this.b+=(t.b-this.b)*i,this}lerpColors(t,i,n){return this.r=t.r+(i.r-t.r)*n,this.g=t.g+(i.g-t.g)*n,this.b=t.b+(i.b-t.b)*n,this}lerpHSL(t,i){this.getHSL(am),t.getHSL(s2);const n=_A(am.h,s2.h,i),r=_A(am.s,s2.s,i),s=_A(am.l,s2.l,i);return this.setHSL(n,r,s),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const i=this.r,n=this.g,r=this.b,s=t.elements;return this.r=s[0]*i+s[3]*n+s[6]*r,this.g=s[1]*i+s[4]*n+s[7]*r,this.b=s[2]*i+s[5]*n+s[8]*r,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,i=0){return this.r=t[i],this.g=t[i+1],this.b=t[i+2],this}toArray(t=[],i=0){return t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,t}fromBufferAttribute(t,i){return this.r=t.getX(i),this.g=t.getY(i),this.b=t.getZ(i),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const oo=new jt;jt.NAMES=MY;let Cae=0;class Js extends Cd{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Cae++}),this.uuid=tc(),this.name="",this.type="Material",this.blending=f0,this.side=bd,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=$C,this.blendDst=eD,this.blendEquation=Cm,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new jt(0,0,0),this.blendAlpha=0,this.depthFunc=E0,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=JL,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Nv,this.stencilZFail=Nv,this.stencilZPass=Nv,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(const i in t){const n=t[i];if(n===void 0){console.warn(`THREE.Material: parameter '${i}' has value of undefined.`);continue}const r=this[i];if(r===void 0){console.warn(`THREE.Material: '${i}' is not a property of THREE.${this.type}.`);continue}r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[i]=n}}toJSON(t){const i=t===void 0||typeof t=="string";i&&(t={textures:{},images:{}});const n={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(n.dispersion=this.dispersion),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapRotation!==void 0&&(n.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==f0&&(n.blending=this.blending),this.side!==bd&&(n.side=this.side),this.vertexColors===!0&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=!0),this.blendSrc!==$C&&(n.blendSrc=this.blendSrc),this.blendDst!==eD&&(n.blendDst=this.blendDst),this.blendEquation!==Cm&&(n.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(n.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(n.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==E0&&(n.depthFunc=this.depthFunc),this.depthTest===!1&&(n.depthTest=this.depthTest),this.depthWrite===!1&&(n.depthWrite=this.depthWrite),this.colorWrite===!1&&(n.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==JL&&(n.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(n.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Nv&&(n.stencilFail=this.stencilFail),this.stencilZFail!==Nv&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==Nv&&(n.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(n.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=!0),this.alphaToCoverage===!0&&(n.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=!0),this.forceSinglePass===!0&&(n.forceSinglePass=!0),this.wireframe===!0&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function r(s){const a=[];for(const o in s){const l=s[o];delete l.metadata,a.push(l)}return a}if(i){const s=r(t.textures),a=r(t.images);s.length>0&&(n.textures=s),a.length>0&&(n.images=a)}return n}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const i=t.clippingPlanes;let n=null;if(i!==null){const r=i.length;n=new Array(r);for(let s=0;s!==r;++s)n[s]=i[s].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}}class $l extends Js{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new jt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new tl,this.combine=Vw,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const Bf=Dae();function Dae(){const e=new ArrayBuffer(4),t=new Float32Array(e),i=new Uint32Array(e),n=new Uint32Array(512),r=new Uint32Array(512);for(let l=0;l<256;++l){const c=l-127;c<-27?(n[l]=0,n[l|256]=32768,r[l]=24,r[l|256]=24):c<-14?(n[l]=1024>>-c-14,n[l|256]=1024>>-c-14|32768,r[l]=-c-1,r[l|256]=-c-1):c<=15?(n[l]=c+15<<10,n[l|256]=c+15<<10|32768,r[l]=13,r[l|256]=13):c<128?(n[l]=31744,n[l|256]=64512,r[l]=24,r[l|256]=24):(n[l]=31744,n[l|256]=64512,r[l]=13,r[l|256]=13)}const s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let c=l<<13,u=0;for(;(c&8388608)===0;)c<<=1,u-=8388608;c&=-8388609,u+=947912704,s[l]=c|u}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)a[l]=l<<23;a[31]=1199570944,a[32]=2147483648;for(let l=33;l<63;++l)a[l]=2147483648+(l-32<<23);a[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(o[l]=1024);return{floatView:t,uint32View:i,baseTable:n,shiftTable:r,mantissaTable:s,exponentTable:a,offsetTable:o}}function bl(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=qi(e,-65504,65504),Bf.floatView[0]=e;const t=Bf.uint32View[0],i=t>>23&511;return Bf.baseTable[i]+((t&8388607)>>Bf.shiftTable[i])}function tA(e){const t=e>>10;return Bf.uint32View[0]=Bf.mantissaTable[Bf.offsetTable[t]+(e&1023)]+Bf.exponentTable[t],Bf.floatView[0]}class Rae{static toHalfFloat(t){return bl(t)}static fromHalfFloat(t){return tA(t)}}const As=new me,a2=new Mt;let Pae=0;class Pn{constructor(t,i,n=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:Pae++}),this.name="",this.array=t,this.itemSize=i,this.count=t!==void 0?t.length/i:0,this.normalized=n,this.usage=ZA,this.updateRanges=[],this.gpuType=Tl,this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,i){this.updateRanges.push({start:t,count:i})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,i,n){t*=this.itemSize,n*=i.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[t+r]=i.array[n+r];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let i=0,n=this.count;i<n;i++)a2.fromBufferAttribute(this,i),a2.applyMatrix3(t),this.setXY(i,a2.x,a2.y);else if(this.itemSize===3)for(let i=0,n=this.count;i<n;i++)As.fromBufferAttribute(this,i),As.applyMatrix3(t),this.setXYZ(i,As.x,As.y,As.z);return this}applyMatrix4(t){for(let i=0,n=this.count;i<n;i++)As.fromBufferAttribute(this,i),As.applyMatrix4(t),this.setXYZ(i,As.x,As.y,As.z);return this}applyNormalMatrix(t){for(let i=0,n=this.count;i<n;i++)As.fromBufferAttribute(this,i),As.applyNormalMatrix(t),this.setXYZ(i,As.x,As.y,As.z);return this}transformDirection(t){for(let i=0,n=this.count;i<n;i++)As.fromBufferAttribute(this,i),As.transformDirection(t),this.setXYZ(i,As.x,As.y,As.z);return this}set(t,i=0){return this.array.set(t,i),this}getComponent(t,i){let n=this.array[t*this.itemSize+i];return this.normalized&&(n=Yo(n,this.array)),n}setComponent(t,i,n){return this.normalized&&(n=Zi(n,this.array)),this.array[t*this.itemSize+i]=n,this}getX(t){let i=this.array[t*this.itemSize];return this.normalized&&(i=Yo(i,this.array)),i}setX(t,i){return this.normalized&&(i=Zi(i,this.array)),this.array[t*this.itemSize]=i,this}getY(t){let i=this.array[t*this.itemSize+1];return this.normalized&&(i=Yo(i,this.array)),i}setY(t,i){return this.normalized&&(i=Zi(i,this.array)),this.array[t*this.itemSize+1]=i,this}getZ(t){let i=this.array[t*this.itemSize+2];return this.normalized&&(i=Yo(i,this.array)),i}setZ(t,i){return this.normalized&&(i=Zi(i,this.array)),this.array[t*this.itemSize+2]=i,this}getW(t){let i=this.array[t*this.itemSize+3];return this.normalized&&(i=Yo(i,this.array)),i}setW(t,i){return this.normalized&&(i=Zi(i,this.array)),this.array[t*this.itemSize+3]=i,this}setXY(t,i,n){return t*=this.itemSize,this.normalized&&(i=Zi(i,this.array),n=Zi(n,this.array)),this.array[t+0]=i,this.array[t+1]=n,this}setXYZ(t,i,n,r){return t*=this.itemSize,this.normalized&&(i=Zi(i,this.array),n=Zi(n,this.array),r=Zi(r,this.array)),this.array[t+0]=i,this.array[t+1]=n,this.array[t+2]=r,this}setXYZW(t,i,n,r,s){return t*=this.itemSize,this.normalized&&(i=Zi(i,this.array),n=Zi(n,this.array),r=Zi(r,this.array),s=Zi(s,this.array)),this.array[t+0]=i,this.array[t+1]=n,this.array[t+2]=r,this.array[t+3]=s,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==ZA&&(t.usage=this.usage),t}}class Oae extends Pn{constructor(t,i,n){super(new Int8Array(t),i,n)}}class Bae extends Pn{constructor(t,i,n){super(new Uint8Array(t),i,n)}}class Iae extends Pn{constructor(t,i,n){super(new Uint8ClampedArray(t),i,n)}}class Lae extends Pn{constructor(t,i,n){super(new Int16Array(t),i,n)}}class oF extends Pn{constructor(t,i,n){super(new Uint16Array(t),i,n)}}class Uae extends Pn{constructor(t,i,n){super(new Int32Array(t),i,n)}}class lF extends Pn{constructor(t,i,n){super(new Uint32Array(t),i,n)}}class Nae extends Pn{constructor(t,i,n){super(new Uint16Array(t),i,n),this.isFloat16BufferAttribute=!0}getX(t){let i=tA(this.array[t*this.itemSize]);return this.normalized&&(i=Yo(i,this.array)),i}setX(t,i){return this.normalized&&(i=Zi(i,this.array)),this.array[t*this.itemSize]=bl(i),this}getY(t){let i=tA(this.array[t*this.itemSize+1]);return this.normalized&&(i=Yo(i,this.array)),i}setY(t,i){return this.normalized&&(i=Zi(i,this.array)),this.array[t*this.itemSize+1]=bl(i),this}getZ(t){let i=tA(this.array[t*this.itemSize+2]);return this.normalized&&(i=Yo(i,this.array)),i}setZ(t,i){return this.normalized&&(i=Zi(i,this.array)),this.array[t*this.itemSize+2]=bl(i),this}getW(t){let i=tA(this.array[t*this.itemSize+3]);return this.normalized&&(i=Yo(i,this.array)),i}setW(t,i){return this.normalized&&(i=Zi(i,this.array)),this.array[t*this.itemSize+3]=bl(i),this}setXY(t,i,n){return t*=this.itemSize,this.normalized&&(i=Zi(i,this.array),n=Zi(n,this.array)),this.array[t+0]=bl(i),this.array[t+1]=bl(n),this}setXYZ(t,i,n,r){return t*=this.itemSize,this.normalized&&(i=Zi(i,this.array),n=Zi(n,this.array),r=Zi(r,this.array)),this.array[t+0]=bl(i),this.array[t+1]=bl(n),this.array[t+2]=bl(r),this}setXYZW(t,i,n,r,s){return t*=this.itemSize,this.normalized&&(i=Zi(i,this.array),n=Zi(n,this.array),r=Zi(r,this.array),s=Zi(s,this.array)),this.array[t+0]=bl(i),this.array[t+1]=bl(n),this.array[t+2]=bl(r),this.array[t+3]=bl(s),this}}class ei extends Pn{constructor(t,i,n){super(new Float32Array(t),i,n)}}let zae=0;const wc=new di,wO=new gn,cx=new me,ql=new Ya,h_=new Ya,la=new me;class ki extends Cd{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:zae++}),this.uuid=tc(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(_Y(t)?lF:oF)(t,1):this.index=t,this}setIndirect(t){return this.indirect=t,this}getIndirect(){return this.indirect}getAttribute(t){return this.attributes[t]}setAttribute(t,i){return this.attributes[t]=i,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,i,n=0){this.groups.push({start:t,count:i,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(t,i){this.drawRange.start=t,this.drawRange.count=i}applyMatrix4(t){const i=this.attributes.position;i!==void 0&&(i.applyMatrix4(t),i.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const s=new Ki().getNormalMatrix(t);n.applyNormalMatrix(s),n.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(t),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return wc.makeRotationFromQuaternion(t),this.applyMatrix4(wc),this}rotateX(t){return wc.makeRotationX(t),this.applyMatrix4(wc),this}rotateY(t){return wc.makeRotationY(t),this.applyMatrix4(wc),this}rotateZ(t){return wc.makeRotationZ(t),this.applyMatrix4(wc),this}translate(t,i,n){return wc.makeTranslation(t,i,n),this.applyMatrix4(wc),this}scale(t,i,n){return wc.makeScale(t,i,n),this.applyMatrix4(wc),this}lookAt(t){return wO.lookAt(t),wO.updateMatrix(),this.applyMatrix4(wO.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(cx).negate(),this.translate(cx.x,cx.y,cx.z),this}setFromPoints(t){const i=this.getAttribute("position");if(i===void 0){const n=[];for(let r=0,s=t.length;r<s;r++){const a=t[r];n.push(a.x,a.y,a.z||0)}this.setAttribute("position",new ei(n,3))}else{const n=Math.min(t.length,i.count);for(let r=0;r<n;r++){const s=t[r];i.setXYZ(r,s.x,s.y,s.z||0)}t.length>i.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),i.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ya);const t=this.attributes.position,i=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new me(-1/0,-1/0,-1/0),new me(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),i)for(let n=0,r=i.length;n<r;n++){const s=i[n];ql.setFromBufferAttribute(s),this.morphTargetsRelative?(la.addVectors(this.boundingBox.min,ql.min),this.boundingBox.expandByPoint(la),la.addVectors(this.boundingBox.max,ql.max),this.boundingBox.expandByPoint(la)):(this.boundingBox.expandByPoint(ql.min),this.boundingBox.expandByPoint(ql.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Sa);const t=this.attributes.position,i=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new me,1/0);return}if(t){const n=this.boundingSphere.center;if(ql.setFromBufferAttribute(t),i)for(let s=0,a=i.length;s<a;s++){const o=i[s];h_.setFromBufferAttribute(o),this.morphTargetsRelative?(la.addVectors(ql.min,h_.min),ql.expandByPoint(la),la.addVectors(ql.max,h_.max),ql.expandByPoint(la)):(ql.expandByPoint(h_.min),ql.expandByPoint(h_.max))}ql.getCenter(n);let r=0;for(let s=0,a=t.count;s<a;s++)la.fromBufferAttribute(t,s),r=Math.max(r,n.distanceToSquared(la));if(i)for(let s=0,a=i.length;s<a;s++){const o=i[s],l=this.morphTargetsRelative;for(let c=0,u=o.count;c<u;c++)la.fromBufferAttribute(o,c),l&&(cx.fromBufferAttribute(t,c),la.add(cx)),r=Math.max(r,n.distanceToSquared(la))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,i=this.attributes;if(t===null||i.position===void 0||i.normal===void 0||i.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=i.position,r=i.normal,s=i.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Pn(new Float32Array(4*n.count),4));const a=this.getAttribute("tangent"),o=[],l=[];for(let R=0;R<n.count;R++)o[R]=new me,l[R]=new me;const c=new me,u=new me,h=new me,d=new Mt,p=new Mt,g=new Mt,x=new me,y=new me;function b(R,O,P){c.fromBufferAttribute(n,R),u.fromBufferAttribute(n,O),h.fromBufferAttribute(n,P),d.fromBufferAttribute(s,R),p.fromBufferAttribute(s,O),g.fromBufferAttribute(s,P),u.sub(c),h.sub(c),p.sub(d),g.sub(d);const U=1/(p.x*g.y-g.x*p.y);isFinite(U)&&(x.copy(u).multiplyScalar(g.y).addScaledVector(h,-p.y).multiplyScalar(U),y.copy(h).multiplyScalar(p.x).addScaledVector(u,-g.x).multiplyScalar(U),o[R].add(x),o[O].add(x),o[P].add(x),l[R].add(y),l[O].add(y),l[P].add(y))}let A=this.groups;A.length===0&&(A=[{start:0,count:t.count}]);for(let R=0,O=A.length;R<O;++R){const P=A[R],U=P.start,H=P.count;for(let V=U,j=U+H;V<j;V+=3)b(t.getX(V+0),t.getX(V+1),t.getX(V+2))}const w=new me,E=new me,D=new me,T=new me;function I(R){D.fromBufferAttribute(r,R),T.copy(D);const O=o[R];w.copy(O),w.sub(D.multiplyScalar(D.dot(O))).normalize(),E.crossVectors(T,O);const U=E.dot(l[R])<0?-1:1;a.setXYZW(R,w.x,w.y,w.z,U)}for(let R=0,O=A.length;R<O;++R){const P=A[R],U=P.start,H=P.count;for(let V=U,j=U+H;V<j;V+=3)I(t.getX(V+0)),I(t.getX(V+1)),I(t.getX(V+2))}}computeVertexNormals(){const t=this.index,i=this.getAttribute("position");if(i!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new Pn(new Float32Array(i.count*3),3),this.setAttribute("normal",n);else for(let d=0,p=n.count;d<p;d++)n.setXYZ(d,0,0,0);const r=new me,s=new me,a=new me,o=new me,l=new me,c=new me,u=new me,h=new me;if(t)for(let d=0,p=t.count;d<p;d+=3){const g=t.getX(d+0),x=t.getX(d+1),y=t.getX(d+2);r.fromBufferAttribute(i,g),s.fromBufferAttribute(i,x),a.fromBufferAttribute(i,y),u.subVectors(a,s),h.subVectors(r,s),u.cross(h),o.fromBufferAttribute(n,g),l.fromBufferAttribute(n,x),c.fromBufferAttribute(n,y),o.add(u),l.add(u),c.add(u),n.setXYZ(g,o.x,o.y,o.z),n.setXYZ(x,l.x,l.y,l.z),n.setXYZ(y,c.x,c.y,c.z)}else for(let d=0,p=i.count;d<p;d+=3)r.fromBufferAttribute(i,d+0),s.fromBufferAttribute(i,d+1),a.fromBufferAttribute(i,d+2),u.subVectors(a,s),h.subVectors(r,s),u.cross(h),n.setXYZ(d+0,u.x,u.y,u.z),n.setXYZ(d+1,u.x,u.y,u.z),n.setXYZ(d+2,u.x,u.y,u.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let i=0,n=t.count;i<n;i++)la.fromBufferAttribute(t,i),la.normalize(),t.setXYZ(i,la.x,la.y,la.z)}toNonIndexed(){function t(o,l){const c=o.array,u=o.itemSize,h=o.normalized,d=new c.constructor(l.length*u);let p=0,g=0;for(let x=0,y=l.length;x<y;x++){o.isInterleavedBufferAttribute?p=l[x]*o.data.stride+o.offset:p=l[x]*u;for(let b=0;b<u;b++)d[g++]=c[p++]}return new Pn(d,u,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const i=new ki,n=this.index.array,r=this.attributes;for(const o in r){const l=r[o],c=t(l,n);i.setAttribute(o,c)}const s=this.morphAttributes;for(const o in s){const l=[],c=s[o];for(let u=0,h=c.length;u<h;u++){const d=c[u],p=t(d,n);l.push(p)}i.morphAttributes[o]=l}i.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,l=a.length;o<l;o++){const c=a[o];i.addGroup(c.start,c.count,c.materialIndex)}return i}toJSON(){const t={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(t[c]=l[c]);return t}t.data={attributes:{}};const i=this.index;i!==null&&(t.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});const n=this.attributes;for(const l in n){const c=n[l];t.data.attributes[l]=c.toJSON(t.data)}const r={};let s=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],u=[];for(let h=0,d=c.length;h<d;h++){const p=c[h];u.push(p.toJSON(t.data))}u.length>0&&(r[l]=u,s=!0)}s&&(t.data.morphAttributes=r,t.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(t.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return o!==null&&(t.data.boundingSphere=o.toJSON()),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const i={};this.name=t.name;const n=t.index;n!==null&&this.setIndex(n.clone());const r=t.attributes;for(const c in r){const u=r[c];this.setAttribute(c,u.clone(i))}const s=t.morphAttributes;for(const c in s){const u=[],h=s[c];for(let d=0,p=h.length;d<p;d++)u.push(h[d].clone(i));this.morphAttributes[c]=u}this.morphTargetsRelative=t.morphTargetsRelative;const a=t.groups;for(let c=0,u=a.length;c<u;c++){const h=a[c];this.addGroup(h.start,h.count,h.materialIndex)}const o=t.boundingBox;o!==null&&(this.boundingBox=o.clone());const l=t.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const MH=new di,hv=new k0,o2=new Sa,EH=new me,l2=new me,c2=new me,u2=new me,MO=new me,h2=new me,TH=new me,d2=new me;class ts extends gn{constructor(t=new ki,i=new $l){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=i,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(t,i){return super.copy(t,i),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const i=this.geometry.morphAttributes,n=Object.keys(i);if(n.length>0){const r=i[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=r.length;s<a;s++){const o=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}getVertexPosition(t,i){const n=this.geometry,r=n.attributes.position,s=n.morphAttributes.position,a=n.morphTargetsRelative;i.fromBufferAttribute(r,t);const o=this.morphTargetInfluences;if(s&&o){h2.set(0,0,0);for(let l=0,c=s.length;l<c;l++){const u=o[l],h=s[l];u!==0&&(MO.fromBufferAttribute(h,t),a?h2.addScaledVector(MO,u):h2.addScaledVector(MO.sub(i),u))}i.add(h2)}return i}raycast(t,i){const n=this.geometry,r=this.material,s=this.matrixWorld;r!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),o2.copy(n.boundingSphere),o2.applyMatrix4(s),hv.copy(t.ray).recast(t.near),!(o2.containsPoint(hv.origin)===!1&&(hv.intersectSphere(o2,EH)===null||hv.origin.distanceToSquared(EH)>(t.far-t.near)**2))&&(MH.copy(s).invert(),hv.copy(t.ray).applyMatrix4(MH),!(n.boundingBox!==null&&hv.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(t,i,hv)))}_computeIntersections(t,i,n){let r;const s=this.geometry,a=this.material,o=s.index,l=s.attributes.position,c=s.attributes.uv,u=s.attributes.uv1,h=s.attributes.normal,d=s.groups,p=s.drawRange;if(o!==null)if(Array.isArray(a))for(let g=0,x=d.length;g<x;g++){const y=d[g],b=a[y.materialIndex],A=Math.max(y.start,p.start),w=Math.min(o.count,Math.min(y.start+y.count,p.start+p.count));for(let E=A,D=w;E<D;E+=3){const T=o.getX(E),I=o.getX(E+1),R=o.getX(E+2);r=f2(this,b,t,n,c,u,h,T,I,R),r&&(r.faceIndex=Math.floor(E/3),r.face.materialIndex=y.materialIndex,i.push(r))}}else{const g=Math.max(0,p.start),x=Math.min(o.count,p.start+p.count);for(let y=g,b=x;y<b;y+=3){const A=o.getX(y),w=o.getX(y+1),E=o.getX(y+2);r=f2(this,a,t,n,c,u,h,A,w,E),r&&(r.faceIndex=Math.floor(y/3),i.push(r))}}else if(l!==void 0)if(Array.isArray(a))for(let g=0,x=d.length;g<x;g++){const y=d[g],b=a[y.materialIndex],A=Math.max(y.start,p.start),w=Math.min(l.count,Math.min(y.start+y.count,p.start+p.count));for(let E=A,D=w;E<D;E+=3){const T=E,I=E+1,R=E+2;r=f2(this,b,t,n,c,u,h,T,I,R),r&&(r.faceIndex=Math.floor(E/3),r.face.materialIndex=y.materialIndex,i.push(r))}}else{const g=Math.max(0,p.start),x=Math.min(l.count,p.start+p.count);for(let y=g,b=x;y<b;y+=3){const A=y,w=y+1,E=y+2;r=f2(this,a,t,n,c,u,h,A,w,E),r&&(r.faceIndex=Math.floor(y/3),i.push(r))}}}}function Fae(e,t,i,n,r,s,a,o){let l;if(t.side===el?l=n.intersectTriangle(a,s,r,!0,o):l=n.intersectTriangle(r,s,a,t.side===bd,o),l===null)return null;d2.copy(o),d2.applyMatrix4(e.matrixWorld);const c=i.ray.origin.distanceTo(d2);return c<i.near||c>i.far?null:{distance:c,point:d2.clone(),object:e}}function f2(e,t,i,n,r,s,a,o,l,c){e.getVertexPosition(o,l2),e.getVertexPosition(l,c2),e.getVertexPosition(c,u2);const u=Fae(e,t,i,n,l2,c2,u2,TH);if(u){const h=new me;wl.getBarycoord(TH,l2,c2,u2,h),r&&(u.uv=wl.getInterpolatedAttribute(r,o,l,c,h,new Mt)),s&&(u.uv1=wl.getInterpolatedAttribute(s,o,l,c,h,new Mt)),a&&(u.normal=wl.getInterpolatedAttribute(a,o,l,c,h,new me),u.normal.dot(n.direction)>0&&u.normal.multiplyScalar(-1));const d={a:o,b:l,c,normal:new me,materialIndex:0};wl.getNormal(l2,c2,u2,d.normal),u.face=d,u.barycoord=h}return u}class j0 extends ki{constructor(t=1,i=1,n=1,r=1,s=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:i,depth:n,widthSegments:r,heightSegments:s,depthSegments:a};const o=this;r=Math.floor(r),s=Math.floor(s),a=Math.floor(a);const l=[],c=[],u=[],h=[];let d=0,p=0;g("z","y","x",-1,-1,n,i,t,a,s,0),g("z","y","x",1,-1,n,i,-t,a,s,1),g("x","z","y",1,1,t,n,i,r,a,2),g("x","z","y",1,-1,t,n,-i,r,a,3),g("x","y","z",1,-1,t,i,n,r,s,4),g("x","y","z",-1,-1,t,i,-n,r,s,5),this.setIndex(l),this.setAttribute("position",new ei(c,3)),this.setAttribute("normal",new ei(u,3)),this.setAttribute("uv",new ei(h,2));function g(x,y,b,A,w,E,D,T,I,R,O){const P=E/I,U=D/R,H=E/2,V=D/2,j=T/2,J=I+1,F=R+1;let X=0,W=0;const ne=new me;for(let Y=0;Y<F;Y++){const $=Y*U-V;for(let se=0;se<J;se++){const fe=se*P-H;ne[x]=fe*A,ne[y]=$*w,ne[b]=j,c.push(ne.x,ne.y,ne.z),ne[x]=0,ne[y]=0,ne[b]=T>0?1:-1,u.push(ne.x,ne.y,ne.z),h.push(se/I),h.push(1-Y/R),X+=1}}for(let Y=0;Y<R;Y++)for(let $=0;$<I;$++){const se=d+$+J*Y,fe=d+$+J*(Y+1),te=d+($+1)+J*(Y+1),de=d+($+1)+J*Y;l.push(se,fe,de),l.push(fe,te,de),W+=6}o.addGroup(p,W,O),p+=W,d+=X}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new j0(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function q1(e){const t={};for(const i in e){t[i]={};for(const n in e[i]){const r=e[i][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[i][n]=null):t[i][n]=r.clone():Array.isArray(r)?t[i][n]=r.slice():t[i][n]=r}}return t}function jo(e){const t={};for(let i=0;i<e.length;i++){const n=q1(e[i]);for(const r in n)t[r]=n[r]}return t}function Vae(e){const t=[];for(let i=0;i<e.length;i++)t.push(e[i].clone());return t}function EY(e){const t=e.getRenderTarget();return t===null?e.outputColorSpace:t.isXRRenderTarget===!0?t.texture.colorSpace:_n.workingColorSpace}const TY={clone:q1,merge:jo};var Hae=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Gae=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Ju extends Js{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=Hae,this.fragmentShader=Gae,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,t!==void 0&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=q1(t.uniforms),this.uniformsGroups=Vae(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const i=super.toJSON(t);i.glslVersion=this.glslVersion,i.uniforms={};for(const r in this.uniforms){const a=this.uniforms[r].value;a&&a.isTexture?i.uniforms[r]={type:"t",value:a.toJSON(t).uuid}:a&&a.isColor?i.uniforms[r]={type:"c",value:a.getHex()}:a&&a.isVector2?i.uniforms[r]={type:"v2",value:a.toArray()}:a&&a.isVector3?i.uniforms[r]={type:"v3",value:a.toArray()}:a&&a.isVector4?i.uniforms[r]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?i.uniforms[r]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?i.uniforms[r]={type:"m4",value:a.toArray()}:i.uniforms[r]={value:a}}Object.keys(this.defines).length>0&&(i.defines=this.defines),i.vertexShader=this.vertexShader,i.fragmentShader=this.fragmentShader,i.lights=this.lights,i.clipping=this.clipping;const n={};for(const r in this.extensions)this.extensions[r]===!0&&(n[r]=!0);return Object.keys(n).length>0&&(i.extensions=n),i}}class gR extends gn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new di,this.projectionMatrix=new di,this.projectionMatrixInverse=new di,this.coordinateSystem=jc}copy(t,i){return super.copy(t,i),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){return super.getWorldDirection(t).negate()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,i){super.updateWorldMatrix(t,i),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const om=new me,CH=new Mt,DH=new Mt;class Dr extends gR{constructor(t=50,i=1,n=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=i,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,i){return super.copy(t,i),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const i=.5*this.getFilmHeight()/t;this.fov=W1*2*Math.atan(i),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(m0*.5*this.fov);return .5*this.getFilmHeight()/t}getEffectiveFOV(){return W1*2*Math.atan(Math.tan(m0*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(t,i,n){om.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(om.x,om.y).multiplyScalar(-t/om.z),om.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(om.x,om.y).multiplyScalar(-t/om.z)}getViewSize(t,i){return this.getViewBounds(t,CH,DH),i.subVectors(DH,CH)}setViewOffset(t,i,n,r,s,a){this.aspect=t/i,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=i,this.view.offsetX=n,this.view.offsetY=r,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let i=t*Math.tan(m0*.5*this.fov)/this.zoom,n=2*i,r=this.aspect*n,s=-.5*r;const a=this.view;if(this.view!==null&&this.view.enabled){const l=a.fullWidth,c=a.fullHeight;s+=a.offsetX*r/l,i-=a.offsetY*n/c,r*=a.width/l,n*=a.height/c}const o=this.filmOffset;o!==0&&(s+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,i,i-n,t,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const i=super.toJSON(t);return i.object.fov=this.fov,i.object.zoom=this.zoom,i.object.near=this.near,i.object.far=this.far,i.object.focus=this.focus,i.object.aspect=this.aspect,this.view!==null&&(i.object.view=Object.assign({},this.view)),i.object.filmGauge=this.filmGauge,i.object.filmOffset=this.filmOffset,i}}const ux=-90,hx=1;class cF extends gn{constructor(t,i,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new Dr(ux,hx,t,i);r.layers=this.layers,this.add(r);const s=new Dr(ux,hx,t,i);s.layers=this.layers,this.add(s);const a=new Dr(ux,hx,t,i);a.layers=this.layers,this.add(a);const o=new Dr(ux,hx,t,i);o.layers=this.layers,this.add(o);const l=new Dr(ux,hx,t,i);l.layers=this.layers,this.add(l);const c=new Dr(ux,hx,t,i);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const t=this.coordinateSystem,i=this.children.concat(),[n,r,s,a,o,l]=i;for(const c of i)this.remove(c);if(t===jc)n.up.set(0,1,0),n.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(t===$A)n.up.set(0,-1,0),n.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+t);for(const c of i)this.add(c),c.updateMatrixWorld()}update(t,i){this.parent===null&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:r}=this;this.coordinateSystem!==t.coordinateSystem&&(this.coordinateSystem=t.coordinateSystem,this.updateCoordinateSystem());const[s,a,o,l,c,u]=this.children,h=t.getRenderTarget(),d=t.getActiveCubeFace(),p=t.getActiveMipmapLevel(),g=t.xr.enabled;t.xr.enabled=!1;const x=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0,r),t.render(i,s),t.setRenderTarget(n,1,r),t.render(i,a),t.setRenderTarget(n,2,r),t.render(i,o),t.setRenderTarget(n,3,r),t.render(i,l),t.setRenderTarget(n,4,r),t.render(i,c),n.texture.generateMipmaps=x,t.setRenderTarget(n,5,r),t.render(i,u),t.setRenderTarget(h,d,p),t.xr.enabled=g,n.texture.needsPMREMUpdate=!0}}class Gw extends vr{constructor(t=[],i=Jf,n,r,s,a,o,l,c,u){super(t,i,n,r,s,a,o,l,c,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class uF extends Sd{constructor(t=1,i={}){super(t,t,i),this.isWebGLCubeRenderTarget=!0;const n={width:t,height:t,depth:1},r=[n,n,n,n,n,n];this.texture=new Gw(r),this._setTextureOptions(i),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(t,i){this.texture.type=i.type,this.texture.colorSpace=i.colorSpace,this.texture.generateMipmaps=i.generateMipmaps,this.texture.minFilter=i.minFilter,this.texture.magFilter=i.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new j0(5,5,5),s=new Ju({name:"CubemapFromEquirect",uniforms:q1(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:el,blending:Wf});s.uniforms.tEquirect.value=i;const a=new ts(r,s),o=i.minFilter;return i.minFilter===kc&&(i.minFilter=hs),new cF(1,10,this).update(t,a),i.minFilter=o,a.geometry.dispose(),a.material.dispose(),this}clear(t,i=!0,n=!0,r=!0){const s=t.getRenderTarget();for(let a=0;a<6;a++)t.setRenderTarget(this,a),t.clear(i,n,r);t.setRenderTarget(s)}}class Uf extends gn{constructor(){super(),this.isGroup=!0,this.type="Group"}}const kae={type:"move"};class wC{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Uf,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Uf,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new me,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new me),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Uf,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new me,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new me),this._grip}dispatchEvent(t){return this._targetRay!==null&&this._targetRay.dispatchEvent(t),this._grip!==null&&this._grip.dispatchEvent(t),this._hand!==null&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){const i=this._hand;if(i)for(const n of t.hand.values())this._getHandJoint(i,n)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(t,i,n){let r=null,s=null,a=null;const o=this._targetRay,l=this._grip,c=this._hand;if(t&&i.session.visibilityState!=="visible-blurred"){if(c&&t.hand){a=!0;for(const x of t.hand.values()){const y=i.getJointPose(x,n),b=this._getHandJoint(c,x);y!==null&&(b.matrix.fromArray(y.transform.matrix),b.matrix.decompose(b.position,b.rotation,b.scale),b.matrixWorldNeedsUpdate=!0,b.jointRadius=y.radius),b.visible=y!==null}const u=c.joints["index-finger-tip"],h=c.joints["thumb-tip"],d=u.position.distanceTo(h.position),p=.02,g=.005;c.inputState.pinching&&d>p+g?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!c.inputState.pinching&&d<=p-g&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else l!==null&&t.gripSpace&&(s=i.getPose(t.gripSpace,n),s!==null&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));o!==null&&(r=i.getPose(t.targetRaySpace,n),r===null&&s!==null&&(r=s),r!==null&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(kae)))}return o!==null&&(o.visible=r!==null),l!==null&&(l.visible=s!==null),c!==null&&(c.visible=a!==null),this}_getHandJoint(t,i){if(t.joints[i.jointName]===void 0){const n=new Uf;n.matrixAutoUpdate=!1,n.visible=!1,t.joints[i.jointName]=n,t.add(n)}return t.joints[i.jointName]}}class vR{constructor(t,i=25e-5){this.isFogExp2=!0,this.name="",this.color=new jt(t),this.density=i}clone(){return new vR(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class yR{constructor(t,i=1,n=1e3){this.isFog=!0,this.name="",this.color=new jt(t),this.near=i,this.far=n}clone(){return new yR(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class hF extends gn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new tl,this.environmentIntensity=1,this.environmentRotation=new tl,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,i){return super.copy(t,i),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,this.backgroundRotation.copy(t.backgroundRotation),this.environmentIntensity=t.environmentIntensity,this.environmentRotation.copy(t.environmentRotation),t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const i=super.toJSON(t);return this.fog!==null&&(i.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(i.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(i.object.backgroundIntensity=this.backgroundIntensity),i.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(i.object.environmentIntensity=this.environmentIntensity),i.object.environmentRotation=this.environmentRotation.toArray(),i}}class kw{constructor(t,i){this.isInterleavedBuffer=!0,this.array=t,this.stride=i,this.count=t!==void 0?t.length/i:0,this.usage=ZA,this.updateRanges=[],this.version=0,this.uuid=tc()}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,i){this.updateRanges.push({start:t,count:i})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,i,n){t*=this.stride,n*=i.stride;for(let r=0,s=this.stride;r<s;r++)this.array[t+r]=i.array[n+r];return this}set(t,i=0){return this.array.set(t,i),this}clone(t){t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=tc()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const i=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(i,this.stride);return n.setUsage(this.usage),n}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=tc()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Fo=new me;class eg{constructor(t,i,n,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=i,this.offset=n,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let i=0,n=this.data.count;i<n;i++)Fo.fromBufferAttribute(this,i),Fo.applyMatrix4(t),this.setXYZ(i,Fo.x,Fo.y,Fo.z);return this}applyNormalMatrix(t){for(let i=0,n=this.count;i<n;i++)Fo.fromBufferAttribute(this,i),Fo.applyNormalMatrix(t),this.setXYZ(i,Fo.x,Fo.y,Fo.z);return this}transformDirection(t){for(let i=0,n=this.count;i<n;i++)Fo.fromBufferAttribute(this,i),Fo.transformDirection(t),this.setXYZ(i,Fo.x,Fo.y,Fo.z);return this}getComponent(t,i){let n=this.array[t*this.data.stride+this.offset+i];return this.normalized&&(n=Yo(n,this.array)),n}setComponent(t,i,n){return this.normalized&&(n=Zi(n,this.array)),this.data.array[t*this.data.stride+this.offset+i]=n,this}setX(t,i){return this.normalized&&(i=Zi(i,this.array)),this.data.array[t*this.data.stride+this.offset]=i,this}setY(t,i){return this.normalized&&(i=Zi(i,this.array)),this.data.array[t*this.data.stride+this.offset+1]=i,this}setZ(t,i){return this.normalized&&(i=Zi(i,this.array)),this.data.array[t*this.data.stride+this.offset+2]=i,this}setW(t,i){return this.normalized&&(i=Zi(i,this.array)),this.data.array[t*this.data.stride+this.offset+3]=i,this}getX(t){let i=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(i=Yo(i,this.array)),i}getY(t){let i=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(i=Yo(i,this.array)),i}getZ(t){let i=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(i=Yo(i,this.array)),i}getW(t){let i=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(i=Yo(i,this.array)),i}setXY(t,i,n){return t=t*this.data.stride+this.offset,this.normalized&&(i=Zi(i,this.array),n=Zi(n,this.array)),this.data.array[t+0]=i,this.data.array[t+1]=n,this}setXYZ(t,i,n,r){return t=t*this.data.stride+this.offset,this.normalized&&(i=Zi(i,this.array),n=Zi(n,this.array),r=Zi(r,this.array)),this.data.array[t+0]=i,this.data.array[t+1]=n,this.data.array[t+2]=r,this}setXYZW(t,i,n,r,s){return t=t*this.data.stride+this.offset,this.normalized&&(i=Zi(i,this.array),n=Zi(n,this.array),r=Zi(r,this.array),s=Zi(s,this.array)),this.data.array[t+0]=i,this.data.array[t+1]=n,this.data.array[t+2]=r,this.data.array[t+3]=s,this}clone(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let n=0;n<this.count;n++){const r=n*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)i.push(this.data.array[r+s])}return new Pn(new this.array.constructor(i),this.itemSize,this.normalized)}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new eg(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let n=0;n<this.count;n++){const r=n*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)i.push(this.data.array[r+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:i,normalized:this.normalized}}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class dF extends Js{constructor(t){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new jt(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}let dx;const d_=new me,fx=new me,px=new me,mx=new Mt,f_=new Mt,CY=new di,p2=new me,p_=new me,m2=new me,RH=new Mt,EO=new Mt,PH=new Mt;class DY extends gn{constructor(t=new dF){if(super(),this.isSprite=!0,this.type="Sprite",dx===void 0){dx=new ki;const i=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new kw(i,5);dx.setIndex([0,1,2,0,2,3]),dx.setAttribute("position",new eg(n,3,0,!1)),dx.setAttribute("uv",new eg(n,2,3,!1))}this.geometry=dx,this.material=t,this.center=new Mt(.5,.5),this.count=1}raycast(t,i){t.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),fx.setFromMatrixScale(this.matrixWorld),CY.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),px.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&fx.multiplyScalar(-px.z);const n=this.material.rotation;let r,s;n!==0&&(s=Math.cos(n),r=Math.sin(n));const a=this.center;g2(p2.set(-.5,-.5,0),px,a,fx,r,s),g2(p_.set(.5,-.5,0),px,a,fx,r,s),g2(m2.set(.5,.5,0),px,a,fx,r,s),RH.set(0,0),EO.set(1,0),PH.set(1,1);let o=t.ray.intersectTriangle(p2,p_,m2,!1,d_);if(o===null&&(g2(p_.set(-.5,.5,0),px,a,fx,r,s),EO.set(0,1),o=t.ray.intersectTriangle(p2,m2,p_,!1,d_),o===null))return;const l=t.ray.origin.distanceTo(d_);l<t.near||l>t.far||i.push({distance:l,point:d_.clone(),uv:wl.getInterpolation(d_,p2,p_,m2,RH,EO,PH,new Mt),face:null,object:this})}copy(t,i){return super.copy(t,i),t.center!==void 0&&this.center.copy(t.center),this.material=t.material,this}}function g2(e,t,i,n,r,s){mx.subVectors(e,i).addScalar(.5).multiply(n),r!==void 0?(f_.x=s*mx.x-r*mx.y,f_.y=r*mx.x+s*mx.y):f_.copy(mx),e.copy(t),e.x+=f_.x,e.y+=f_.y,e.applyMatrix4(CY)}const v2=new me,OH=new me;class RY extends gn{constructor(){super(),this.isLOD=!0,this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}copy(t){super.copy(t,!1);const i=t.levels;for(let n=0,r=i.length;n<r;n++){const s=i[n];this.addLevel(s.object.clone(),s.distance,s.hysteresis)}return this.autoUpdate=t.autoUpdate,this}addLevel(t,i=0,n=0){i=Math.abs(i);const r=this.levels;let s;for(s=0;s<r.length&&!(i<r[s].distance);s++);return r.splice(s,0,{distance:i,hysteresis:n,object:t}),this.add(t),this}removeLevel(t){const i=this.levels;for(let n=0;n<i.length;n++)if(i[n].distance===t){const r=i.splice(n,1);return this.remove(r[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(t){const i=this.levels;if(i.length>0){let n,r;for(n=1,r=i.length;n<r;n++){let s=i[n].distance;if(i[n].object.visible&&(s-=s*i[n].hysteresis),t<s)break}return i[n-1].object}return null}raycast(t,i){if(this.levels.length>0){v2.setFromMatrixPosition(this.matrixWorld);const r=t.ray.origin.distanceTo(v2);this.getObjectForDistance(r).raycast(t,i)}}update(t){const i=this.levels;if(i.length>1){v2.setFromMatrixPosition(t.matrixWorld),OH.setFromMatrixPosition(this.matrixWorld);const n=v2.distanceTo(OH)/t.zoom;i[0].object.visible=!0;let r,s;for(r=1,s=i.length;r<s;r++){let a=i[r].distance;if(i[r].object.visible&&(a-=a*i[r].hysteresis),n>=a)i[r-1].object.visible=!1,i[r].object.visible=!0;else break}for(this._currentLevel=r-1;r<s;r++)i[r].object.visible=!1}}toJSON(t){const i=super.toJSON(t);this.autoUpdate===!1&&(i.object.autoUpdate=!1),i.object.levels=[];const n=this.levels;for(let r=0,s=n.length;r<s;r++){const a=n[r];i.object.levels.push({object:a.object.uuid,distance:a.distance,hysteresis:a.hysteresis})}return i}}const BH=new me,IH=new Rn,LH=new Rn,jae=new me,UH=new di,y2=new me,TO=new Sa,NH=new di,CO=new k0;class fF extends ts{constructor(t,i){super(t,i),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=KL,this.bindMatrix=new di,this.bindMatrixInverse=new di,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const t=this.geometry;this.boundingBox===null&&(this.boundingBox=new Ya),this.boundingBox.makeEmpty();const i=t.getAttribute("position");for(let n=0;n<i.count;n++)this.getVertexPosition(n,y2),this.boundingBox.expandByPoint(y2)}computeBoundingSphere(){const t=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Sa),this.boundingSphere.makeEmpty();const i=t.getAttribute("position");for(let n=0;n<i.count;n++)this.getVertexPosition(n,y2),this.boundingSphere.expandByPoint(y2)}copy(t,i){return super.copy(t,i),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this}raycast(t,i){const n=this.material,r=this.matrixWorld;n!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),TO.copy(this.boundingSphere),TO.applyMatrix4(r),t.ray.intersectsSphere(TO)!==!1&&(NH.copy(r).invert(),CO.copy(t.ray).applyMatrix4(NH),!(this.boundingBox!==null&&CO.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(t,i,CO)))}getVertexPosition(t,i){return super.getVertexPosition(t,i),this.applyBoneTransform(t,i),i}bind(t,i){this.skeleton=t,i===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),i=this.matrixWorld),this.bindMatrix.copy(i),this.bindMatrixInverse.copy(i).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new Rn,i=this.geometry.attributes.skinWeight;for(let n=0,r=i.count;n<r;n++){t.fromBufferAttribute(i,n);const s=1/t.manhattanLength();s!==1/0?t.multiplyScalar(s):t.set(1,0,0,0),i.setXYZW(n,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode===KL?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===oY?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(t,i){const n=this.skeleton,r=this.geometry;IH.fromBufferAttribute(r.attributes.skinIndex,t),LH.fromBufferAttribute(r.attributes.skinWeight,t),BH.copy(i).applyMatrix4(this.bindMatrix),i.set(0,0,0);for(let s=0;s<4;s++){const a=LH.getComponent(s);if(a!==0){const o=IH.getComponent(s);UH.multiplyMatrices(n.bones[o].matrixWorld,n.boneInverses[o]),i.addScaledVector(jae.copy(BH).applyMatrix4(UH),a)}}return i.applyMatrix4(this.bindMatrixInverse)}}class xR extends gn{constructor(){super(),this.isBone=!0,this.type="Bone"}}class hd extends vr{constructor(t=null,i=1,n=1,r,s,a,o,l,c=xa,u=xa,h,d){super(null,a,o,l,c,u,r,s,h,d),this.isDataTexture=!0,this.image={data:t,width:i,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const zH=new di,Wae=new di;class jw{constructor(t=[],i=[]){this.uuid=tc(),this.bones=t.slice(0),this.boneInverses=i,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const t=this.bones,i=this.boneInverses;if(this.boneMatrices=new Float32Array(t.length*16),i.length===0)this.calculateInverses();else if(t.length!==i.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let n=0,r=this.bones.length;n<r;n++)this.boneInverses.push(new di)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,i=this.bones.length;t<i;t++){const n=new di;this.bones[t]&&n.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(n)}}pose(){for(let t=0,i=this.bones.length;t<i;t++){const n=this.bones[t];n&&n.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,i=this.bones.length;t<i;t++){const n=this.bones[t];n&&(n.parent&&n.parent.isBone?(n.matrix.copy(n.parent.matrixWorld).invert(),n.matrix.multiply(n.matrixWorld)):n.matrix.copy(n.matrixWorld),n.matrix.decompose(n.position,n.quaternion,n.scale))}}update(){const t=this.bones,i=this.boneInverses,n=this.boneMatrices,r=this.boneTexture;for(let s=0,a=t.length;s<a;s++){const o=t[s]?t[s].matrixWorld:Wae;zH.multiplyMatrices(o,i[s]),zH.toArray(n,s*16)}r!==null&&(r.needsUpdate=!0)}clone(){return new jw(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(this.bones.length*4);t=Math.ceil(t/4)*4,t=Math.max(t,4);const i=new Float32Array(t*t*4);i.set(this.boneMatrices);const n=new hd(i,t,t,go,Tl);return n.needsUpdate=!0,this.boneMatrices=i,this.boneTexture=n,this}getBoneByName(t){for(let i=0,n=this.bones.length;i<n;i++){const r=this.bones[i];if(r.name===t)return r}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,i){this.uuid=t.uuid;for(let n=0,r=t.bones.length;n<r;n++){const s=t.bones[n];let a=i[s];a===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",s),a=new xR),this.bones.push(a),this.boneInverses.push(new di().fromArray(t.boneInverses[n]))}return this.init(),this}toJSON(){const t={metadata:{version:4.7,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const i=this.bones,n=this.boneInverses;for(let r=0,s=i.length;r<s;r++){const a=i[r];t.bones.push(a.uuid);const o=n[r];t.boneInverses.push(o.toArray())}return t}}class T0 extends Pn{constructor(t,i,n,r=1){super(t,i,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const gx=new di,FH=new di,x2=[],VH=new Ya,Xae=new di,m_=new ts,g_=new Sa;class pF extends ts{constructor(t,i,n){super(t,i),this.isInstancedMesh=!0,this.instanceMatrix=new T0(new Float32Array(n*16),16),this.instanceColor=null,this.morphTexture=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let r=0;r<n;r++)this.setMatrixAt(r,Xae)}computeBoundingBox(){const t=this.geometry,i=this.count;this.boundingBox===null&&(this.boundingBox=new Ya),t.boundingBox===null&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<i;n++)this.getMatrixAt(n,gx),VH.copy(t.boundingBox).applyMatrix4(gx),this.boundingBox.union(VH)}computeBoundingSphere(){const t=this.geometry,i=this.count;this.boundingSphere===null&&(this.boundingSphere=new Sa),t.boundingSphere===null&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<i;n++)this.getMatrixAt(n,gx),g_.copy(t.boundingSphere).applyMatrix4(gx),this.boundingSphere.union(g_)}copy(t,i){return super.copy(t,i),this.instanceMatrix.copy(t.instanceMatrix),t.morphTexture!==null&&(this.morphTexture=t.morphTexture.clone()),t.instanceColor!==null&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this}getColorAt(t,i){i.fromArray(this.instanceColor.array,t*3)}getMatrixAt(t,i){i.fromArray(this.instanceMatrix.array,t*16)}getMorphAt(t,i){const n=i.morphTargetInfluences,r=this.morphTexture.source.data.data,s=n.length+1,a=t*s+1;for(let o=0;o<n.length;o++)n[o]=r[a+o]}raycast(t,i){const n=this.matrixWorld,r=this.count;if(m_.geometry=this.geometry,m_.material=this.material,m_.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),g_.copy(this.boundingSphere),g_.applyMatrix4(n),t.ray.intersectsSphere(g_)!==!1))for(let s=0;s<r;s++){this.getMatrixAt(s,gx),FH.multiplyMatrices(n,gx),m_.matrixWorld=FH,m_.raycast(t,x2);for(let a=0,o=x2.length;a<o;a++){const l=x2[a];l.instanceId=s,l.object=this,i.push(l)}x2.length=0}}setColorAt(t,i){this.instanceColor===null&&(this.instanceColor=new T0(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),i.toArray(this.instanceColor.array,t*3)}setMatrixAt(t,i){i.toArray(this.instanceMatrix.array,t*16)}setMorphAt(t,i){const n=i.morphTargetInfluences,r=n.length+1;this.morphTexture===null&&(this.morphTexture=new hd(new Float32Array(r*this.count),r,this.count,uR,Tl));const s=this.morphTexture.source.data.data;let a=0;for(let c=0;c<n.length;c++)a+=n[c];const o=this.geometry.morphTargetsRelative?1:1-a,l=r*t;s[l]=o,s.set(n,l+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null)}}const DO=new me,qae=new me,Yae=new Ki;class Ef{constructor(t=new me(1,0,0),i=0){this.isPlane=!0,this.normal=t,this.constant=i}set(t,i){return this.normal.copy(t),this.constant=i,this}setComponents(t,i,n,r){return this.normal.set(t,i,n),this.constant=r,this}setFromNormalAndCoplanarPoint(t,i){return this.normal.copy(t),this.constant=-i.dot(this.normal),this}setFromCoplanarPoints(t,i,n){const r=DO.subVectors(n,i).cross(qae.subVectors(t,i)).normalize();return this.setFromNormalAndCoplanarPoint(r,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,i){return i.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,i){const n=t.delta(DO),r=this.normal.dot(n);if(r===0)return this.distanceToPoint(t.start)===0?i.copy(t.start):null;const s=-(t.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:i.copy(t.start).addScaledVector(n,s)}intersectsLine(t){const i=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return i<0&&n>0||n<0&&i>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,i){const n=i||Yae.getNormalMatrix(t),r=this.coplanarPoint(DO).applyMatrix4(t),s=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(s),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}}const dv=new Sa,b2=new me;class yb{constructor(t=new Ef,i=new Ef,n=new Ef,r=new Ef,s=new Ef,a=new Ef){this.planes=[t,i,n,r,s,a]}set(t,i,n,r,s,a){const o=this.planes;return o[0].copy(t),o[1].copy(i),o[2].copy(n),o[3].copy(r),o[4].copy(s),o[5].copy(a),this}copy(t){const i=this.planes;for(let n=0;n<6;n++)i[n].copy(t.planes[n]);return this}setFromProjectionMatrix(t,i=jc){const n=this.planes,r=t.elements,s=r[0],a=r[1],o=r[2],l=r[3],c=r[4],u=r[5],h=r[6],d=r[7],p=r[8],g=r[9],x=r[10],y=r[11],b=r[12],A=r[13],w=r[14],E=r[15];if(n[0].setComponents(l-s,d-c,y-p,E-b).normalize(),n[1].setComponents(l+s,d+c,y+p,E+b).normalize(),n[2].setComponents(l+a,d+u,y+g,E+A).normalize(),n[3].setComponents(l-a,d-u,y-g,E-A).normalize(),n[4].setComponents(l-o,d-h,y-x,E-w).normalize(),i===jc)n[5].setComponents(l+o,d+h,y+x,E+w).normalize();else if(i===$A)n[5].setComponents(o,h,x,w).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+i);return this}intersectsObject(t){if(t.boundingSphere!==void 0)t.boundingSphere===null&&t.computeBoundingSphere(),dv.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const i=t.geometry;i.boundingSphere===null&&i.computeBoundingSphere(),dv.copy(i.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(dv)}intersectsSprite(t){return dv.center.set(0,0,0),dv.radius=.7071067811865476,dv.applyMatrix4(t.matrixWorld),this.intersectsSphere(dv)}intersectsSphere(t){const i=this.planes,n=t.center,r=-t.radius;for(let s=0;s<6;s++)if(i[s].distanceToPoint(n)<r)return!1;return!0}intersectsBox(t){const i=this.planes;for(let n=0;n<6;n++){const r=i[n];if(b2.x=r.normal.x>0?t.max.x:t.min.x,b2.y=r.normal.y>0?t.max.y:t.min.y,b2.z=r.normal.z>0?t.max.z:t.min.z,r.distanceToPoint(b2)<0)return!1}return!0}containsPoint(t){const i=this.planes;for(let n=0;n<6;n++)if(i[n].distanceToPoint(t)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}const Vh=new di,Hh=new yb;class bR{constructor(){this.coordinateSystem=jc}intersectsObject(t,i){if(!i.isArrayCamera||i.cameras.length===0)return!1;for(let n=0;n<i.cameras.length;n++){const r=i.cameras[n];if(Vh.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),Hh.setFromProjectionMatrix(Vh,this.coordinateSystem),Hh.intersectsObject(t))return!0}return!1}intersectsSprite(t,i){if(!i||!i.cameras||i.cameras.length===0)return!1;for(let n=0;n<i.cameras.length;n++){const r=i.cameras[n];if(Vh.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),Hh.setFromProjectionMatrix(Vh,this.coordinateSystem),Hh.intersectsSprite(t))return!0}return!1}intersectsSphere(t,i){if(!i||!i.cameras||i.cameras.length===0)return!1;for(let n=0;n<i.cameras.length;n++){const r=i.cameras[n];if(Vh.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),Hh.setFromProjectionMatrix(Vh,this.coordinateSystem),Hh.intersectsSphere(t))return!0}return!1}intersectsBox(t,i){if(!i||!i.cameras||i.cameras.length===0)return!1;for(let n=0;n<i.cameras.length;n++){const r=i.cameras[n];if(Vh.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),Hh.setFromProjectionMatrix(Vh,this.coordinateSystem),Hh.intersectsBox(t))return!0}return!1}containsPoint(t,i){if(!i||!i.cameras||i.cameras.length===0)return!1;for(let n=0;n<i.cameras.length;n++){const r=i.cameras[n];if(Vh.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),Hh.setFromProjectionMatrix(Vh,this.coordinateSystem),Hh.containsPoint(t))return!0}return!1}clone(){return new bR}}function RO(e,t){return e-t}function Qae(e,t){return e.z-t.z}function Kae(e,t){return t.z-e.z}class Jae{constructor(){this.index=0,this.pool=[],this.list=[]}push(t,i,n,r){const s=this.pool,a=this.list;this.index>=s.length&&s.push({start:-1,count:-1,z:-1,index:-1});const o=s[this.index];a.push(o),this.index++,o.start=t,o.count=i,o.z=n,o.index=r}reset(){this.list.length=0,this.index=0}}const yl=new di,Zae=new jt(1,1,1),HH=new yb,$ae=new bR,S2=new Ya,fv=new Sa,v_=new me,GH=new me,eoe=new me,PO=new Jae,lo=new ts,_2=[];function toe(e,t,i=0){const n=t.itemSize;if(e.isInterleavedBufferAttribute||e.array.constructor!==t.array.constructor){const r=e.count;for(let s=0;s<r;s++)for(let a=0;a<n;a++)t.setComponent(s+i,a,e.getComponent(s,a))}else t.array.set(e.array,i*n);t.needsUpdate=!0}function pv(e,t){if(e.constructor!==t.constructor){const i=Math.min(e.length,t.length);for(let n=0;n<i;n++)t[n]=e[n]}else{const i=Math.min(e.length,t.length);t.set(new e.constructor(e.buffer,0,i))}}class PY extends ts{constructor(t,i,n=i*2,r){super(new ki,r),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=t,this._maxVertexCount=i,this._maxIndexCount=n,this._multiDrawCounts=new Int32Array(t),this._multiDrawStarts=new Int32Array(t),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}_initMatricesTexture(){let t=Math.sqrt(this._maxInstanceCount*4);t=Math.ceil(t/4)*4,t=Math.max(t,4);const i=new Float32Array(t*t*4),n=new hd(i,t,t,go,Tl);this._matricesTexture=n}_initIndirectTexture(){let t=Math.sqrt(this._maxInstanceCount);t=Math.ceil(t);const i=new Uint32Array(t*t),n=new hd(i,t,t,Hw,Zf);this._indirectTexture=n}_initColorsTexture(){let t=Math.sqrt(this._maxInstanceCount);t=Math.ceil(t);const i=new Float32Array(t*t*4).fill(1),n=new hd(i,t,t,go,Tl);n.colorSpace=_n.workingColorSpace,this._colorsTexture=n}_initializeGeometry(t){const i=this.geometry,n=this._maxVertexCount,r=this._maxIndexCount;if(this._geometryInitialized===!1){for(const s in t.attributes){const a=t.getAttribute(s),{array:o,itemSize:l,normalized:c}=a,u=new o.constructor(n*l),h=new Pn(u,l,c);i.setAttribute(s,h)}if(t.getIndex()!==null){const s=n>65535?new Uint32Array(r):new Uint16Array(r);i.setIndex(new Pn(s,1))}this._geometryInitialized=!0}}_validateGeometry(t){const i=this.geometry;if(!!t.getIndex()!=!!i.getIndex())throw new Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(const n in i.attributes){if(!t.hasAttribute(n))throw new Error(`THREE.BatchedMesh: Added geometry missing "${n}". All geometries must have consistent attributes.`);const r=t.getAttribute(n),s=i.getAttribute(n);if(r.itemSize!==s.itemSize||r.normalized!==s.normalized)throw new Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(t){const i=this._instanceInfo;if(t<0||t>=i.length||i[t].active===!1)throw new Error(`THREE.BatchedMesh: Invalid instanceId ${t}. Instance is either out of range or has been deleted.`)}validateGeometryId(t){const i=this._geometryInfo;if(t<0||t>=i.length||i[t].active===!1)throw new Error(`THREE.BatchedMesh: Invalid geometryId ${t}. Geometry is either out of range or has been deleted.`)}setCustomSort(t){return this.customSort=t,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ya);const t=this.boundingBox,i=this._instanceInfo;t.makeEmpty();for(let n=0,r=i.length;n<r;n++){if(i[n].active===!1)continue;const s=i[n].geometryIndex;this.getMatrixAt(n,yl),this.getBoundingBoxAt(s,S2).applyMatrix4(yl),t.union(S2)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Sa);const t=this.boundingSphere,i=this._instanceInfo;t.makeEmpty();for(let n=0,r=i.length;n<r;n++){if(i[n].active===!1)continue;const s=i[n].geometryIndex;this.getMatrixAt(n,yl),this.getBoundingSphereAt(s,fv).applyMatrix4(yl),t.union(fv)}}addInstance(t){if(this._instanceInfo.length>=this.maxInstanceCount&&this._availableInstanceIds.length===0)throw new Error("THREE.BatchedMesh: Maximum item count reached.");const n={visible:!0,active:!0,geometryIndex:t};let r=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(RO),r=this._availableInstanceIds.shift(),this._instanceInfo[r]=n):(r=this._instanceInfo.length,this._instanceInfo.push(n));const s=this._matricesTexture;yl.identity().toArray(s.image.data,r*16),s.needsUpdate=!0;const a=this._colorsTexture;return a&&(Zae.toArray(a.image.data,r*4),a.needsUpdate=!0),this._visibilityChanged=!0,r}addGeometry(t,i=-1,n=-1){this._initializeGeometry(t),this._validateGeometry(t);const r={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},s=this._geometryInfo;r.vertexStart=this._nextVertexStart,r.reservedVertexCount=i===-1?t.getAttribute("position").count:i;const a=t.getIndex();if(a!==null&&(r.indexStart=this._nextIndexStart,r.reservedIndexCount=n===-1?a.count:n),r.indexStart!==-1&&r.indexStart+r.reservedIndexCount>this._maxIndexCount||r.vertexStart+r.reservedVertexCount>this._maxVertexCount)throw new Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");let l;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(RO),l=this._availableGeometryIds.shift(),s[l]=r):(l=this._geometryCount,this._geometryCount++,s.push(r)),this.setGeometryAt(l,t),this._nextIndexStart=r.indexStart+r.reservedIndexCount,this._nextVertexStart=r.vertexStart+r.reservedVertexCount,l}setGeometryAt(t,i){if(t>=this._geometryCount)throw new Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(i);const n=this.geometry,r=n.getIndex()!==null,s=n.getIndex(),a=i.getIndex(),o=this._geometryInfo[t];if(r&&a.count>o.reservedIndexCount||i.attributes.position.count>o.reservedVertexCount)throw new Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");const l=o.vertexStart,c=o.reservedVertexCount;o.vertexCount=i.getAttribute("position").count;for(const u in n.attributes){const h=i.getAttribute(u),d=n.getAttribute(u);toe(h,d,l);const p=h.itemSize;for(let g=h.count,x=c;g<x;g++){const y=l+g;for(let b=0;b<p;b++)d.setComponent(y,b,0)}d.needsUpdate=!0,d.addUpdateRange(l*p,c*p)}if(r){const u=o.indexStart,h=o.reservedIndexCount;o.indexCount=i.getIndex().count;for(let d=0;d<a.count;d++)s.setX(u+d,l+a.getX(d));for(let d=a.count,p=h;d<p;d++)s.setX(u+d,l);s.needsUpdate=!0,s.addUpdateRange(u,o.reservedIndexCount)}return o.start=r?o.indexStart:o.vertexStart,o.count=r?o.indexCount:o.vertexCount,o.boundingBox=null,i.boundingBox!==null&&(o.boundingBox=i.boundingBox.clone()),o.boundingSphere=null,i.boundingSphere!==null&&(o.boundingSphere=i.boundingSphere.clone()),this._visibilityChanged=!0,t}deleteGeometry(t){const i=this._geometryInfo;if(t>=i.length||i[t].active===!1)return this;const n=this._instanceInfo;for(let r=0,s=n.length;r<s;r++)n[r].active&&n[r].geometryIndex===t&&this.deleteInstance(r);return i[t].active=!1,this._availableGeometryIds.push(t),this._visibilityChanged=!0,this}deleteInstance(t){return this.validateInstanceId(t),this._instanceInfo[t].active=!1,this._availableInstanceIds.push(t),this._visibilityChanged=!0,this}optimize(){let t=0,i=0;const n=this._geometryInfo,r=n.map((a,o)=>o).sort((a,o)=>n[a].vertexStart-n[o].vertexStart),s=this.geometry;for(let a=0,o=n.length;a<o;a++){const l=r[a],c=n[l];if(c.active!==!1){if(s.index!==null){if(c.indexStart!==i){const{indexStart:u,vertexStart:h,reservedIndexCount:d}=c,p=s.index,g=p.array,x=t-h;for(let y=u;y<u+d;y++)g[y]=g[y]+x;p.array.copyWithin(i,u,u+d),p.addUpdateRange(i,d),c.indexStart=i}i+=c.reservedIndexCount}if(c.vertexStart!==t){const{vertexStart:u,reservedVertexCount:h}=c,d=s.attributes;for(const p in d){const g=d[p],{array:x,itemSize:y}=g;x.copyWithin(t*y,u*y,(u+h)*y),g.addUpdateRange(t*y,h*y)}c.vertexStart=t}t+=c.reservedVertexCount,c.start=s.index?c.indexStart:c.vertexStart,this._nextIndexStart=s.index?c.indexStart+c.reservedIndexCount:0,this._nextVertexStart=c.vertexStart+c.reservedVertexCount}}return this}getBoundingBoxAt(t,i){if(t>=this._geometryCount)return null;const n=this.geometry,r=this._geometryInfo[t];if(r.boundingBox===null){const s=new Ya,a=n.index,o=n.attributes.position;for(let l=r.start,c=r.start+r.count;l<c;l++){let u=l;a&&(u=a.getX(u)),s.expandByPoint(v_.fromBufferAttribute(o,u))}r.boundingBox=s}return i.copy(r.boundingBox),i}getBoundingSphereAt(t,i){if(t>=this._geometryCount)return null;const n=this.geometry,r=this._geometryInfo[t];if(r.boundingSphere===null){const s=new Sa;this.getBoundingBoxAt(t,S2),S2.getCenter(s.center);const a=n.index,o=n.attributes.position;let l=0;for(let c=r.start,u=r.start+r.count;c<u;c++){let h=c;a&&(h=a.getX(h)),v_.fromBufferAttribute(o,h),l=Math.max(l,s.center.distanceToSquared(v_))}s.radius=Math.sqrt(l),r.boundingSphere=s}return i.copy(r.boundingSphere),i}setMatrixAt(t,i){this.validateInstanceId(t);const n=this._matricesTexture,r=this._matricesTexture.image.data;return i.toArray(r,t*16),n.needsUpdate=!0,this}getMatrixAt(t,i){return this.validateInstanceId(t),i.fromArray(this._matricesTexture.image.data,t*16)}setColorAt(t,i){return this.validateInstanceId(t),this._colorsTexture===null&&this._initColorsTexture(),i.toArray(this._colorsTexture.image.data,t*4),this._colorsTexture.needsUpdate=!0,this}getColorAt(t,i){return this.validateInstanceId(t),i.fromArray(this._colorsTexture.image.data,t*4)}setVisibleAt(t,i){return this.validateInstanceId(t),this._instanceInfo[t].visible===i?this:(this._instanceInfo[t].visible=i,this._visibilityChanged=!0,this)}getVisibleAt(t){return this.validateInstanceId(t),this._instanceInfo[t].visible}setGeometryIdAt(t,i){return this.validateInstanceId(t),this.validateGeometryId(i),this._instanceInfo[t].geometryIndex=i,this}getGeometryIdAt(t){return this.validateInstanceId(t),this._instanceInfo[t].geometryIndex}getGeometryRangeAt(t,i={}){this.validateGeometryId(t);const n=this._geometryInfo[t];return i.vertexStart=n.vertexStart,i.vertexCount=n.vertexCount,i.reservedVertexCount=n.reservedVertexCount,i.indexStart=n.indexStart,i.indexCount=n.indexCount,i.reservedIndexCount=n.reservedIndexCount,i.start=n.start,i.count=n.count,i}setInstanceCount(t){const i=this._availableInstanceIds,n=this._instanceInfo;for(i.sort(RO);i[i.length-1]===n.length;)n.pop(),i.pop();if(t<n.length)throw new Error(`BatchedMesh: Instance ids outside the range ${t} are being used. Cannot shrink instance count.`);const r=new Int32Array(t),s=new Int32Array(t);pv(this._multiDrawCounts,r),pv(this._multiDrawStarts,s),this._multiDrawCounts=r,this._multiDrawStarts=s,this._maxInstanceCount=t;const a=this._indirectTexture,o=this._matricesTexture,l=this._colorsTexture;a.dispose(),this._initIndirectTexture(),pv(a.image.data,this._indirectTexture.image.data),o.dispose(),this._initMatricesTexture(),pv(o.image.data,this._matricesTexture.image.data),l&&(l.dispose(),this._initColorsTexture(),pv(l.image.data,this._colorsTexture.image.data))}setGeometrySize(t,i){const n=[...this._geometryInfo].filter(o=>o.active);if(Math.max(...n.map(o=>o.vertexStart+o.reservedVertexCount))>t)throw new Error(`BatchedMesh: Geometry vertex values are being used outside the range ${i}. Cannot shrink further.`);if(this.geometry.index&&Math.max(...n.map(l=>l.indexStart+l.reservedIndexCount))>i)throw new Error(`BatchedMesh: Geometry index values are being used outside the range ${i}. Cannot shrink further.`);const s=this.geometry;s.dispose(),this._maxVertexCount=t,this._maxIndexCount=i,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new ki,this._initializeGeometry(s));const a=this.geometry;s.index&&pv(s.index.array,a.index.array);for(const o in s.attributes)pv(s.attributes[o].array,a.attributes[o].array)}raycast(t,i){const n=this._instanceInfo,r=this._geometryInfo,s=this.matrixWorld,a=this.geometry;lo.material=this.material,lo.geometry.index=a.index,lo.geometry.attributes=a.attributes,lo.geometry.boundingBox===null&&(lo.geometry.boundingBox=new Ya),lo.geometry.boundingSphere===null&&(lo.geometry.boundingSphere=new Sa);for(let o=0,l=n.length;o<l;o++){if(!n[o].visible||!n[o].active)continue;const c=n[o].geometryIndex,u=r[c];lo.geometry.setDrawRange(u.start,u.count),this.getMatrixAt(o,lo.matrixWorld).premultiply(s),this.getBoundingBoxAt(c,lo.geometry.boundingBox),this.getBoundingSphereAt(c,lo.geometry.boundingSphere),lo.raycast(t,_2);for(let h=0,d=_2.length;h<d;h++){const p=_2[h];p.object=this,p.batchId=o,i.push(p)}_2.length=0}lo.material=null,lo.geometry.index=null,lo.geometry.attributes={},lo.geometry.setDrawRange(0,1/0)}copy(t){return super.copy(t),this.geometry=t.geometry.clone(),this.perObjectFrustumCulled=t.perObjectFrustumCulled,this.sortObjects=t.sortObjects,this.boundingBox=t.boundingBox!==null?t.boundingBox.clone():null,this.boundingSphere=t.boundingSphere!==null?t.boundingSphere.clone():null,this._geometryInfo=t._geometryInfo.map(i=>({...i,boundingBox:i.boundingBox!==null?i.boundingBox.clone():null,boundingSphere:i.boundingSphere!==null?i.boundingSphere.clone():null})),this._instanceInfo=t._instanceInfo.map(i=>({...i})),this._availableInstanceIds=t._availableInstanceIds.slice(),this._availableGeometryIds=t._availableGeometryIds.slice(),this._nextIndexStart=t._nextIndexStart,this._nextVertexStart=t._nextVertexStart,this._geometryCount=t._geometryCount,this._maxInstanceCount=t._maxInstanceCount,this._maxVertexCount=t._maxVertexCount,this._maxIndexCount=t._maxIndexCount,this._geometryInitialized=t._geometryInitialized,this._multiDrawCounts=t._multiDrawCounts.slice(),this._multiDrawStarts=t._multiDrawStarts.slice(),this._indirectTexture=t._indirectTexture.clone(),this._indirectTexture.image.data=this._indirectTexture.image.data.slice(),this._matricesTexture=t._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),this._colorsTexture!==null&&(this._colorsTexture=t._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,this._colorsTexture!==null&&(this._colorsTexture.dispose(),this._colorsTexture=null)}onBeforeRender(t,i,n,r,s){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const a=r.getIndex(),o=a===null?1:a.array.BYTES_PER_ELEMENT,l=this._instanceInfo,c=this._multiDrawStarts,u=this._multiDrawCounts,h=this._geometryInfo,d=this.perObjectFrustumCulled,p=this._indirectTexture,g=p.image.data,x=n.isArrayCamera?$ae:HH;d&&!n.isArrayCamera&&(yl.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse).multiply(this.matrixWorld),HH.setFromProjectionMatrix(yl,t.coordinateSystem));let y=0;if(this.sortObjects){yl.copy(this.matrixWorld).invert(),v_.setFromMatrixPosition(n.matrixWorld).applyMatrix4(yl),GH.set(0,0,-1).transformDirection(n.matrixWorld).transformDirection(yl);for(let w=0,E=l.length;w<E;w++)if(l[w].visible&&l[w].active){const D=l[w].geometryIndex;this.getMatrixAt(w,yl),this.getBoundingSphereAt(D,fv).applyMatrix4(yl);let T=!1;if(d&&(T=!x.intersectsSphere(fv,n)),!T){const I=h[D],R=eoe.subVectors(fv.center,v_).dot(GH);PO.push(I.start,I.count,R,w)}}const b=PO.list,A=this.customSort;A===null?b.sort(s.transparent?Kae:Qae):A.call(this,b,n);for(let w=0,E=b.length;w<E;w++){const D=b[w];c[y]=D.start*o,u[y]=D.count,g[y]=D.index,y++}PO.reset()}else for(let b=0,A=l.length;b<A;b++)if(l[b].visible&&l[b].active){const w=l[b].geometryIndex;let E=!1;if(d&&(this.getMatrixAt(b,yl),this.getBoundingSphereAt(w,fv).applyMatrix4(yl),E=!x.intersectsSphere(fv,n)),!E){const D=h[w];c[y]=D.start*o,u[y]=D.count,g[y]=b,y++}}p.needsUpdate=!0,this._multiDrawCount=y,this._visibilityChanged=!1}onBeforeShadow(t,i,n,r,s,a){this.onBeforeRender(t,null,r,s,a)}}class So extends Js{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new jt(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const LD=new me,UD=new me,kH=new di,y_=new k0,A2=new Sa,OO=new me,jH=new me;class $f extends gn{constructor(t=new ki,i=new So){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=i,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(t,i){return super.copy(t,i),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.index===null){const i=t.attributes.position,n=[0];for(let r=1,s=i.count;r<s;r++)LD.fromBufferAttribute(i,r-1),UD.fromBufferAttribute(i,r),n[r]=n[r-1],n[r]+=LD.distanceTo(UD);t.setAttribute("lineDistance",new ei(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,i){const n=this.geometry,r=this.matrixWorld,s=t.params.Line.threshold,a=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),A2.copy(n.boundingSphere),A2.applyMatrix4(r),A2.radius+=s,t.ray.intersectsSphere(A2)===!1)return;kH.copy(r).invert(),y_.copy(t.ray).applyMatrix4(kH);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,c=this.isLineSegments?2:1,u=n.index,d=n.attributes.position;if(u!==null){const p=Math.max(0,a.start),g=Math.min(u.count,a.start+a.count);for(let x=p,y=g-1;x<y;x+=c){const b=u.getX(x),A=u.getX(x+1),w=w2(this,t,y_,l,b,A,x);w&&i.push(w)}if(this.isLineLoop){const x=u.getX(g-1),y=u.getX(p),b=w2(this,t,y_,l,x,y,g-1);b&&i.push(b)}}else{const p=Math.max(0,a.start),g=Math.min(d.count,a.start+a.count);for(let x=p,y=g-1;x<y;x+=c){const b=w2(this,t,y_,l,x,x+1,x);b&&i.push(b)}if(this.isLineLoop){const x=w2(this,t,y_,l,g-1,p,g-1);x&&i.push(x)}}}updateMorphTargets(){const i=this.geometry.morphAttributes,n=Object.keys(i);if(n.length>0){const r=i[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=r.length;s<a;s++){const o=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}}function w2(e,t,i,n,r,s,a){const o=e.geometry.attributes.position;if(LD.fromBufferAttribute(o,r),UD.fromBufferAttribute(o,s),i.distanceSqToSegment(LD,UD,OO,jH)>n)return;OO.applyMatrix4(e.matrixWorld);const c=t.ray.origin.distanceTo(OO);if(!(c<t.near||c>t.far))return{distance:c,point:jH.clone().applyMatrix4(e.matrixWorld),index:a,face:null,faceIndex:null,barycoord:null,object:e}}const WH=new me,XH=new me;class ih extends $f{constructor(t,i){super(t,i),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.index===null){const i=t.attributes.position,n=[];for(let r=0,s=i.count;r<s;r+=2)WH.fromBufferAttribute(i,r),XH.fromBufferAttribute(i,r+1),n[r]=r===0?0:n[r-1],n[r+1]=n[r]+WH.distanceTo(XH);t.setAttribute("lineDistance",new ei(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class mF extends $f{constructor(t,i){super(t,i),this.isLineLoop=!0,this.type="LineLoop"}}class Ww extends Js{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new jt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const qH=new di,$L=new k0,M2=new Sa,E2=new me;let gF=class extends gn{constructor(t=new ki,i=new Ww){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=i,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(t,i){return super.copy(t,i),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}raycast(t,i){const n=this.geometry,r=this.matrixWorld,s=t.params.Points.threshold,a=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),M2.copy(n.boundingSphere),M2.applyMatrix4(r),M2.radius+=s,t.ray.intersectsSphere(M2)===!1)return;qH.copy(r).invert(),$L.copy(t.ray).applyMatrix4(qH);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,c=n.index,h=n.attributes.position;if(c!==null){const d=Math.max(0,a.start),p=Math.min(c.count,a.start+a.count);for(let g=d,x=p;g<x;g++){const y=c.getX(g);E2.fromBufferAttribute(h,y),YH(E2,y,l,r,t,i,this)}}else{const d=Math.max(0,a.start),p=Math.min(h.count,a.start+a.count);for(let g=d,x=p;g<x;g++)E2.fromBufferAttribute(h,g),YH(E2,g,l,r,t,i,this)}}updateMorphTargets(){const i=this.geometry.morphAttributes,n=Object.keys(i);if(n.length>0){const r=i[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=r.length;s<a;s++){const o=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}};function YH(e,t,i,n,r,s,a){const o=$L.distanceSqToPoint(e);if(o<i){const l=new me;$L.closestPointToPoint(e,l),l.applyMatrix4(n);const c=r.ray.origin.distanceTo(l);if(c<r.near||c>r.far)return;s.push({distance:c,distanceToRay:Math.sqrt(o),point:l,index:t,face:null,faceIndex:null,barycoord:null,object:a})}}class OY extends vr{constructor(t,i,n,r,s=hs,a=hs,o,l,c){super(t,i,n,r,s,a,o,l,c),this.isVideoTexture=!0,this.generateMipmaps=!1;const u=this;function h(){u.needsUpdate=!0,t.requestVideoFrameCallback(h)}"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback(h)}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;"requestVideoFrameCallback"in t===!1&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class ioe extends OY{constructor(t,i,n,r,s,a,o,l){super({},t,i,n,r,s,a,o,l),this.isVideoFrameTexture=!0}update(){}clone(){return new this.constructor().copy(this)}setFrame(t){this.image=t,this.needsUpdate=!0}}class noe extends vr{constructor(t,i){super({width:t,height:i}),this.isFramebufferTexture=!0,this.magFilter=xa,this.minFilter=xa,this.generateMipmaps=!1,this.needsUpdate=!0}}class SR extends vr{constructor(t,i,n,r,s,a,o,l,c,u,h,d){super(null,a,o,l,c,u,r,s,h,d),this.isCompressedTexture=!0,this.image={width:i,height:n},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}class roe extends SR{constructor(t,i,n,r,s,a){super(t,i,n,s,a),this.isCompressedArrayTexture=!0,this.image.depth=r,this.wrapR=Zl,this.layerUpdates=new Set}addLayerUpdate(t){this.layerUpdates.add(t)}clearLayerUpdates(){this.layerUpdates.clear()}}class soe extends SR{constructor(t,i,n){super(void 0,t[0].width,t[0].height,i,n,Jf),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=t}}class aoe extends vr{constructor(t,i,n,r,s,a,o,l,c){super(t,i,n,r,s,a,o,l,c),this.isCanvasTexture=!0,this.needsUpdate=!0}}class vF extends vr{constructor(t,i,n=Zf,r,s,a,o=xa,l=xa,c,u=H1,h=1){if(u!==H1&&u!==G1)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");const d={width:t,height:i,depth:h};super(d,r,s,a,o,l,u,n,c),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.source=new Lm(Object.assign({},t.image)),this.compareFunction=t.compareFunction,this}toJSON(t){const i=super.toJSON(t);return this.compareFunction!==null&&(i.compareFunction=this.compareFunction),i}}class _R extends ki{constructor(t=1,i=1,n=4,r=8,s=1){super(),this.type="CapsuleGeometry",this.parameters={radius:t,height:i,capSegments:n,radialSegments:r,heightSegments:s},i=Math.max(0,i),n=Math.max(1,Math.floor(n)),r=Math.max(3,Math.floor(r)),s=Math.max(1,Math.floor(s));const a=[],o=[],l=[],c=[],u=i/2,h=Math.PI/2*t,d=i,p=2*h+d,g=n*2+s,x=r+1,y=new me,b=new me;for(let A=0;A<=g;A++){let w=0,E=0,D=0,T=0;if(A<=n){const O=A/n,P=O*Math.PI/2;E=-u-t*Math.cos(P),D=t*Math.sin(P),T=-t*Math.cos(P),w=O*h}else if(A<=n+s){const O=(A-n)/s;E=-u+O*i,D=t,T=0,w=h+O*d}else{const O=(A-n-s)/n,P=O*Math.PI/2;E=u+t*Math.sin(P),D=t*Math.cos(P),T=t*Math.sin(P),w=h+d+O*h}const I=Math.max(0,Math.min(1,w/p));let R=0;A===0?R=.5/r:A===g&&(R=-.5/r);for(let O=0;O<=r;O++){const P=O/r,U=P*Math.PI*2,H=Math.sin(U),V=Math.cos(U);b.x=-D*V,b.y=E,b.z=D*H,o.push(b.x,b.y,b.z),y.set(-D*V,T,D*H),y.normalize(),l.push(y.x,y.y,y.z),c.push(P+R,I)}if(A>0){const O=(A-1)*x;for(let P=0;P<r;P++){const U=O+P,H=O+P+1,V=A*x+P,j=A*x+P+1;a.push(U,H,V),a.push(H,j,V)}}}this.setIndex(a),this.setAttribute("position",new ei(o,3)),this.setAttribute("normal",new ei(l,3)),this.setAttribute("uv",new ei(c,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new _R(t.radius,t.height,t.capSegments,t.radialSegments,t.heightSegments)}}class AR extends ki{constructor(t=1,i=32,n=0,r=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:i,thetaStart:n,thetaLength:r},i=Math.max(3,i);const s=[],a=[],o=[],l=[],c=new me,u=new Mt;a.push(0,0,0),o.push(0,0,1),l.push(.5,.5);for(let h=0,d=3;h<=i;h++,d+=3){const p=n+h/i*r;c.x=t*Math.cos(p),c.y=t*Math.sin(p),a.push(c.x,c.y,c.z),o.push(0,0,1),u.x=(a[d]/t+1)/2,u.y=(a[d+1]/t+1)/2,l.push(u.x,u.y)}for(let h=1;h<=i;h++)s.push(h,h+1,0);this.setIndex(s),this.setAttribute("position",new ei(a,3)),this.setAttribute("normal",new ei(o,3)),this.setAttribute("uv",new ei(l,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new AR(t.radius,t.segments,t.thetaStart,t.thetaLength)}}class Xw extends ki{constructor(t=1,i=1,n=1,r=32,s=1,a=!1,o=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:i,height:n,radialSegments:r,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:l};const c=this;r=Math.floor(r),s=Math.floor(s);const u=[],h=[],d=[],p=[];let g=0;const x=[],y=n/2;let b=0;A(),a===!1&&(t>0&&w(!0),i>0&&w(!1)),this.setIndex(u),this.setAttribute("position",new ei(h,3)),this.setAttribute("normal",new ei(d,3)),this.setAttribute("uv",new ei(p,2));function A(){const E=new me,D=new me;let T=0;const I=(i-t)/n;for(let R=0;R<=s;R++){const O=[],P=R/s,U=P*(i-t)+t;for(let H=0;H<=r;H++){const V=H/r,j=V*l+o,J=Math.sin(j),F=Math.cos(j);D.x=U*J,D.y=-P*n+y,D.z=U*F,h.push(D.x,D.y,D.z),E.set(J,I,F).normalize(),d.push(E.x,E.y,E.z),p.push(V,1-P),O.push(g++)}x.push(O)}for(let R=0;R<r;R++)for(let O=0;O<s;O++){const P=x[O][R],U=x[O+1][R],H=x[O+1][R+1],V=x[O][R+1];(t>0||O!==0)&&(u.push(P,U,V),T+=3),(i>0||O!==s-1)&&(u.push(U,H,V),T+=3)}c.addGroup(b,T,0),b+=T}function w(E){const D=g,T=new Mt,I=new me;let R=0;const O=E===!0?t:i,P=E===!0?1:-1;for(let H=1;H<=r;H++)h.push(0,y*P,0),d.push(0,P,0),p.push(.5,.5),g++;const U=g;for(let H=0;H<=r;H++){const j=H/r*l+o,J=Math.cos(j),F=Math.sin(j);I.x=O*F,I.y=y*P,I.z=O*J,h.push(I.x,I.y,I.z),d.push(0,P,0),T.x=J*.5+.5,T.y=F*.5*P+.5,p.push(T.x,T.y),g++}for(let H=0;H<r;H++){const V=D+H,j=U+H;E===!0?u.push(j,j+1,V):u.push(j+1,j,V),R+=3}c.addGroup(b,R,E===!0?1:2),b+=R}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Xw(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class qw extends Xw{constructor(t=1,i=1,n=32,r=1,s=!1,a=0,o=Math.PI*2){super(0,t,i,n,r,s,a,o),this.type="ConeGeometry",this.parameters={radius:t,height:i,radialSegments:n,heightSegments:r,openEnded:s,thetaStart:a,thetaLength:o}}static fromJSON(t){return new qw(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class cg extends ki{constructor(t=[],i=[],n=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:i,radius:n,detail:r};const s=[],a=[];o(r),c(n),u(),this.setAttribute("position",new ei(s,3)),this.setAttribute("normal",new ei(s.slice(),3)),this.setAttribute("uv",new ei(a,2)),r===0?this.computeVertexNormals():this.normalizeNormals();function o(A){const w=new me,E=new me,D=new me;for(let T=0;T<i.length;T+=3)p(i[T+0],w),p(i[T+1],E),p(i[T+2],D),l(w,E,D,A)}function l(A,w,E,D){const T=D+1,I=[];for(let R=0;R<=T;R++){I[R]=[];const O=A.clone().lerp(E,R/T),P=w.clone().lerp(E,R/T),U=T-R;for(let H=0;H<=U;H++)H===0&&R===T?I[R][H]=O:I[R][H]=O.clone().lerp(P,H/U)}for(let R=0;R<T;R++)for(let O=0;O<2*(T-R)-1;O++){const P=Math.floor(O/2);O%2===0?(d(I[R][P+1]),d(I[R+1][P]),d(I[R][P])):(d(I[R][P+1]),d(I[R+1][P+1]),d(I[R+1][P]))}}function c(A){const w=new me;for(let E=0;E<s.length;E+=3)w.x=s[E+0],w.y=s[E+1],w.z=s[E+2],w.normalize().multiplyScalar(A),s[E+0]=w.x,s[E+1]=w.y,s[E+2]=w.z}function u(){const A=new me;for(let w=0;w<s.length;w+=3){A.x=s[w+0],A.y=s[w+1],A.z=s[w+2];const E=y(A)/2/Math.PI+.5,D=b(A)/Math.PI+.5;a.push(E,1-D)}g(),h()}function h(){for(let A=0;A<a.length;A+=6){const w=a[A+0],E=a[A+2],D=a[A+4],T=Math.max(w,E,D),I=Math.min(w,E,D);T>.9&&I<.1&&(w<.2&&(a[A+0]+=1),E<.2&&(a[A+2]+=1),D<.2&&(a[A+4]+=1))}}function d(A){s.push(A.x,A.y,A.z)}function p(A,w){const E=A*3;w.x=t[E+0],w.y=t[E+1],w.z=t[E+2]}function g(){const A=new me,w=new me,E=new me,D=new me,T=new Mt,I=new Mt,R=new Mt;for(let O=0,P=0;O<s.length;O+=9,P+=6){A.set(s[O+0],s[O+1],s[O+2]),w.set(s[O+3],s[O+4],s[O+5]),E.set(s[O+6],s[O+7],s[O+8]),T.set(a[P+0],a[P+1]),I.set(a[P+2],a[P+3]),R.set(a[P+4],a[P+5]),D.copy(A).add(w).add(E).divideScalar(3);const U=y(D);x(T,P+0,A,U),x(I,P+2,w,U),x(R,P+4,E,U)}}function x(A,w,E,D){D<0&&A.x===1&&(a[w]=A.x-1),E.x===0&&E.z===0&&(a[w]=D/2/Math.PI+.5)}function y(A){return Math.atan2(A.z,-A.x)}function b(A){return Math.atan2(-A.y,Math.sqrt(A.x*A.x+A.z*A.z))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new cg(t.vertices,t.indices,t.radius,t.details)}}class wR extends cg{constructor(t=1,i=0){const n=(1+Math.sqrt(5))/2,r=1/n,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(s,a,t,i),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:i}}static fromJSON(t){return new wR(t.radius,t.detail)}}const T2=new me,C2=new me,BO=new me,D2=new wl;class BY extends ki{constructor(t=null,i=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:t,thresholdAngle:i},t!==null){const r=Math.pow(10,4),s=Math.cos(m0*i),a=t.getIndex(),o=t.getAttribute("position"),l=a?a.count:o.count,c=[0,0,0],u=["a","b","c"],h=new Array(3),d={},p=[];for(let g=0;g<l;g+=3){a?(c[0]=a.getX(g),c[1]=a.getX(g+1),c[2]=a.getX(g+2)):(c[0]=g,c[1]=g+1,c[2]=g+2);const{a:x,b:y,c:b}=D2;if(x.fromBufferAttribute(o,c[0]),y.fromBufferAttribute(o,c[1]),b.fromBufferAttribute(o,c[2]),D2.getNormal(BO),h[0]=`${Math.round(x.x*r)},${Math.round(x.y*r)},${Math.round(x.z*r)}`,h[1]=`${Math.round(y.x*r)},${Math.round(y.y*r)},${Math.round(y.z*r)}`,h[2]=`${Math.round(b.x*r)},${Math.round(b.y*r)},${Math.round(b.z*r)}`,!(h[0]===h[1]||h[1]===h[2]||h[2]===h[0]))for(let A=0;A<3;A++){const w=(A+1)%3,E=h[A],D=h[w],T=D2[u[A]],I=D2[u[w]],R=`${E}_${D}`,O=`${D}_${E}`;O in d&&d[O]?(BO.dot(d[O].normal)<=s&&(p.push(T.x,T.y,T.z),p.push(I.x,I.y,I.z)),d[O]=null):R in d||(d[R]={index0:c[A],index1:c[w],normal:BO.clone()})}}for(const g in d)if(d[g]){const{index0:x,index1:y}=d[g];T2.fromBufferAttribute(o,x),C2.fromBufferAttribute(o,y),p.push(T2.x,T2.y,T2.z),p.push(C2.x,C2.y,C2.z)}this.setAttribute("position",new ei(p,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}class nh{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){console.warn("THREE.Curve: .getPoint() not implemented.")}getPointAt(t,i){const n=this.getUtoTmapping(t);return this.getPoint(n,i)}getPoints(t=5){const i=[];for(let n=0;n<=t;n++)i.push(this.getPoint(n/t));return i}getSpacedPoints(t=5){const i=[];for(let n=0;n<=t;n++)i.push(this.getPointAt(n/t));return i}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const i=[];let n,r=this.getPoint(0),s=0;i.push(0);for(let a=1;a<=t;a++)n=this.getPoint(a/t),s+=n.distanceTo(r),i.push(s),r=n;return this.cacheArcLengths=i,i}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,i=null){const n=this.getLengths();let r=0;const s=n.length;let a;i?a=i:a=t*n[s-1];let o=0,l=s-1,c;for(;o<=l;)if(r=Math.floor(o+(l-o)/2),c=n[r]-a,c<0)o=r+1;else if(c>0)l=r-1;else{l=r;break}if(r=l,n[r]===a)return r/(s-1);const u=n[r],d=n[r+1]-u,p=(a-u)/d;return(r+p)/(s-1)}getTangent(t,i){let r=t-1e-4,s=t+1e-4;r<0&&(r=0),s>1&&(s=1);const a=this.getPoint(r),o=this.getPoint(s),l=i||(a.isVector2?new Mt:new me);return l.copy(o).sub(a).normalize(),l}getTangentAt(t,i){const n=this.getUtoTmapping(t);return this.getTangent(n,i)}computeFrenetFrames(t,i=!1){const n=new me,r=[],s=[],a=[],o=new me,l=new di;for(let p=0;p<=t;p++){const g=p/t;r[p]=this.getTangentAt(g,new me)}s[0]=new me,a[0]=new me;let c=Number.MAX_VALUE;const u=Math.abs(r[0].x),h=Math.abs(r[0].y),d=Math.abs(r[0].z);u<=c&&(c=u,n.set(1,0,0)),h<=c&&(c=h,n.set(0,1,0)),d<=c&&n.set(0,0,1),o.crossVectors(r[0],n).normalize(),s[0].crossVectors(r[0],o),a[0].crossVectors(r[0],s[0]);for(let p=1;p<=t;p++){if(s[p]=s[p-1].clone(),a[p]=a[p-1].clone(),o.crossVectors(r[p-1],r[p]),o.length()>Number.EPSILON){o.normalize();const g=Math.acos(qi(r[p-1].dot(r[p]),-1,1));s[p].applyMatrix4(l.makeRotationAxis(o,g))}a[p].crossVectors(r[p],s[p])}if(i===!0){let p=Math.acos(qi(s[0].dot(s[t]),-1,1));p/=t,r[0].dot(o.crossVectors(s[0],s[t]))>0&&(p=-p);for(let g=1;g<=t;g++)s[g].applyMatrix4(l.makeRotationAxis(r[g],p*g)),a[g].crossVectors(r[g],s[g])}return{tangents:r,normals:s,binormals:a}}clone(){return new this.constructor().copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.7,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class MR extends nh{constructor(t=0,i=0,n=1,r=1,s=0,a=Math.PI*2,o=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=i,this.xRadius=n,this.yRadius=r,this.aStartAngle=s,this.aEndAngle=a,this.aClockwise=o,this.aRotation=l}getPoint(t,i=new Mt){const n=i,r=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const a=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=r;for(;s>r;)s-=r;s<Number.EPSILON&&(a?s=0:s=r),this.aClockwise===!0&&!a&&(s===r?s=-r:s=s-r);const o=this.aStartAngle+t*s;let l=this.aX+this.xRadius*Math.cos(o),c=this.aY+this.yRadius*Math.sin(o);if(this.aRotation!==0){const u=Math.cos(this.aRotation),h=Math.sin(this.aRotation),d=l-this.aX,p=c-this.aY;l=d*u-p*h+this.aX,c=d*h+p*u+this.aY}return n.set(l,c)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}class IY extends MR{constructor(t,i,n,r,s,a){super(t,i,n,n,r,s,a),this.isArcCurve=!0,this.type="ArcCurve"}}function yF(){let e=0,t=0,i=0,n=0;function r(s,a,o,l){e=s,t=o,i=-3*s+3*a-2*o-l,n=2*s-2*a+o+l}return{initCatmullRom:function(s,a,o,l,c){r(a,o,c*(o-s),c*(l-a))},initNonuniformCatmullRom:function(s,a,o,l,c,u,h){let d=(a-s)/c-(o-s)/(c+u)+(o-a)/u,p=(o-a)/u-(l-a)/(u+h)+(l-o)/h;d*=u,p*=u,r(a,o,d,p)},calc:function(s){const a=s*s,o=a*s;return e+t*s+i*a+n*o}}}const R2=new me,IO=new yF,LO=new yF,UO=new yF;class LY extends nh{constructor(t=[],i=!1,n="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=i,this.curveType=n,this.tension=r}getPoint(t,i=new me){const n=i,r=this.points,s=r.length,a=(s-(this.closed?0:1))*t;let o=Math.floor(a),l=a-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/s)+1)*s:l===0&&o===s-1&&(o=s-2,l=1);let c,u;this.closed||o>0?c=r[(o-1)%s]:(R2.subVectors(r[0],r[1]).add(r[0]),c=R2);const h=r[o%s],d=r[(o+1)%s];if(this.closed||o+2<s?u=r[(o+2)%s]:(R2.subVectors(r[s-1],r[s-2]).add(r[s-1]),u=R2),this.curveType==="centripetal"||this.curveType==="chordal"){const p=this.curveType==="chordal"?.5:.25;let g=Math.pow(c.distanceToSquared(h),p),x=Math.pow(h.distanceToSquared(d),p),y=Math.pow(d.distanceToSquared(u),p);x<1e-4&&(x=1),g<1e-4&&(g=x),y<1e-4&&(y=x),IO.initNonuniformCatmullRom(c.x,h.x,d.x,u.x,g,x,y),LO.initNonuniformCatmullRom(c.y,h.y,d.y,u.y,g,x,y),UO.initNonuniformCatmullRom(c.z,h.z,d.z,u.z,g,x,y)}else this.curveType==="catmullrom"&&(IO.initCatmullRom(c.x,h.x,d.x,u.x,this.tension),LO.initCatmullRom(c.y,h.y,d.y,u.y,this.tension),UO.initCatmullRom(c.z,h.z,d.z,u.z,this.tension));return n.set(IO.calc(l),LO.calc(l),UO.calc(l)),n}copy(t){super.copy(t),this.points=[];for(let i=0,n=t.points.length;i<n;i++){const r=t.points[i];this.points.push(r.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let i=0,n=this.points.length;i<n;i++){const r=this.points[i];t.points.push(r.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let i=0,n=t.points.length;i<n;i++){const r=t.points[i];this.points.push(new me().fromArray(r))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function QH(e,t,i,n,r){const s=(n-t)*.5,a=(r-i)*.5,o=e*e,l=e*o;return(2*i-2*n+s+a)*l+(-3*i+3*n-2*s-a)*o+s*e+i}function ooe(e,t){const i=1-e;return i*i*t}function loe(e,t){return 2*(1-e)*e*t}function coe(e,t){return e*e*t}function AA(e,t,i,n){return ooe(e,t)+loe(e,i)+coe(e,n)}function uoe(e,t){const i=1-e;return i*i*i*t}function hoe(e,t){const i=1-e;return 3*i*i*e*t}function doe(e,t){return 3*(1-e)*e*e*t}function foe(e,t){return e*e*e*t}function wA(e,t,i,n,r){return uoe(e,t)+hoe(e,i)+doe(e,n)+foe(e,r)}class xF extends nh{constructor(t=new Mt,i=new Mt,n=new Mt,r=new Mt){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=i,this.v2=n,this.v3=r}getPoint(t,i=new Mt){const n=i,r=this.v0,s=this.v1,a=this.v2,o=this.v3;return n.set(wA(t,r.x,s.x,a.x,o.x),wA(t,r.y,s.y,a.y,o.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class UY extends nh{constructor(t=new me,i=new me,n=new me,r=new me){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=i,this.v2=n,this.v3=r}getPoint(t,i=new me){const n=i,r=this.v0,s=this.v1,a=this.v2,o=this.v3;return n.set(wA(t,r.x,s.x,a.x,o.x),wA(t,r.y,s.y,a.y,o.y),wA(t,r.z,s.z,a.z,o.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class bF extends nh{constructor(t=new Mt,i=new Mt){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=i}getPoint(t,i=new Mt){const n=i;return t===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,i){return this.getPoint(t,i)}getTangent(t,i=new Mt){return i.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,i){return this.getTangent(t,i)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class NY extends nh{constructor(t=new me,i=new me){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=i}getPoint(t,i=new me){const n=i;return t===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,i){return this.getPoint(t,i)}getTangent(t,i=new me){return i.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,i){return this.getTangent(t,i)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class SF extends nh{constructor(t=new Mt,i=new Mt,n=new Mt){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=i,this.v2=n}getPoint(t,i=new Mt){const n=i,r=this.v0,s=this.v1,a=this.v2;return n.set(AA(t,r.x,s.x,a.x),AA(t,r.y,s.y,a.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class _F extends nh{constructor(t=new me,i=new me,n=new me){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=i,this.v2=n}getPoint(t,i=new me){const n=i,r=this.v0,s=this.v1,a=this.v2;return n.set(AA(t,r.x,s.x,a.x),AA(t,r.y,s.y,a.y),AA(t,r.z,s.z,a.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class AF extends nh{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,i=new Mt){const n=i,r=this.points,s=(r.length-1)*t,a=Math.floor(s),o=s-a,l=r[a===0?a:a-1],c=r[a],u=r[a>r.length-2?r.length-1:a+1],h=r[a>r.length-3?r.length-1:a+2];return n.set(QH(o,l.x,c.x,u.x,h.x),QH(o,l.y,c.y,u.y,h.y)),n}copy(t){super.copy(t),this.points=[];for(let i=0,n=t.points.length;i<n;i++){const r=t.points[i];this.points.push(r.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let i=0,n=this.points.length;i<n;i++){const r=this.points[i];t.points.push(r.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let i=0,n=t.points.length;i<n;i++){const r=t.points[i];this.points.push(new Mt().fromArray(r))}return this}}var ND=Object.freeze({__proto__:null,ArcCurve:IY,CatmullRomCurve3:LY,CubicBezierCurve:xF,CubicBezierCurve3:UY,EllipseCurve:MR,LineCurve:bF,LineCurve3:NY,QuadraticBezierCurve:SF,QuadraticBezierCurve3:_F,SplineCurve:AF});class zY extends nh{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),i=this.curves[this.curves.length-1].getPoint(1);if(!t.equals(i)){const n=t.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new ND[n](i,t))}return this}getPoint(t,i){const n=t*this.getLength(),r=this.getCurveLengths();let s=0;for(;s<r.length;){if(r[s]>=n){const a=r[s]-n,o=this.curves[s],l=o.getLength(),c=l===0?0:1-a/l;return o.getPointAt(c,i)}s++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let i=0;for(let n=0,r=this.curves.length;n<r;n++)i+=this.curves[n].getLength(),t.push(i);return this.cacheLengths=t,t}getSpacedPoints(t=40){const i=[];for(let n=0;n<=t;n++)i.push(this.getPoint(n/t));return this.autoClose&&i.push(i[0]),i}getPoints(t=12){const i=[];let n;for(let r=0,s=this.curves;r<s.length;r++){const a=s[r],o=a.isEllipseCurve?t*2:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?t*a.points.length:t,l=a.getPoints(o);for(let c=0;c<l.length;c++){const u=l[c];n&&n.equals(u)||(i.push(u),n=u)}}return this.autoClose&&i.length>1&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i}copy(t){super.copy(t),this.curves=[];for(let i=0,n=t.curves.length;i<n;i++){const r=t.curves[i];this.curves.push(r.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let i=0,n=this.curves.length;i<n;i++){const r=this.curves[i];t.curves.push(r.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let i=0,n=t.curves.length;i<n;i++){const r=t.curves[i];this.curves.push(new ND[r.type]().fromJSON(r))}return this}}class zD extends zY{constructor(t){super(),this.type="Path",this.currentPoint=new Mt,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let i=1,n=t.length;i<n;i++)this.lineTo(t[i].x,t[i].y);return this}moveTo(t,i){return this.currentPoint.set(t,i),this}lineTo(t,i){const n=new bF(this.currentPoint.clone(),new Mt(t,i));return this.curves.push(n),this.currentPoint.set(t,i),this}quadraticCurveTo(t,i,n,r){const s=new SF(this.currentPoint.clone(),new Mt(t,i),new Mt(n,r));return this.curves.push(s),this.currentPoint.set(n,r),this}bezierCurveTo(t,i,n,r,s,a){const o=new xF(this.currentPoint.clone(),new Mt(t,i),new Mt(n,r),new Mt(s,a));return this.curves.push(o),this.currentPoint.set(s,a),this}splineThru(t){const i=[this.currentPoint.clone()].concat(t),n=new AF(i);return this.curves.push(n),this.currentPoint.copy(t[t.length-1]),this}arc(t,i,n,r,s,a){const o=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(t+o,i+l,n,r,s,a),this}absarc(t,i,n,r,s,a){return this.absellipse(t,i,n,n,r,s,a),this}ellipse(t,i,n,r,s,a,o,l){const c=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(t+c,i+u,n,r,s,a,o,l),this}absellipse(t,i,n,r,s,a,o,l){const c=new MR(t,i,n,r,s,a,o,l);if(this.curves.length>0){const h=c.getPoint(0);h.equals(this.currentPoint)||this.lineTo(h.x,h.y)}this.curves.push(c);const u=c.getPoint(1);return this.currentPoint.copy(u),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class g0 extends zD{constructor(t){super(t),this.uuid=tc(),this.type="Shape",this.holes=[]}getPointsHoles(t){const i=[];for(let n=0,r=this.holes.length;n<r;n++)i[n]=this.holes[n].getPoints(t);return i}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let i=0,n=t.holes.length;i<n;i++){const r=t.holes[i];this.holes.push(r.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let i=0,n=this.holes.length;i<n;i++){const r=this.holes[i];t.holes.push(r.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let i=0,n=t.holes.length;i<n;i++){const r=t.holes[i];this.holes.push(new zD().fromJSON(r))}return this}}function poe(e,t,i=2){const n=t&&t.length,r=n?t[0]*i:e.length;let s=FY(e,0,r,i,!0);const a=[];if(!s||s.next===s.prev)return a;let o,l,c;if(n&&(s=xoe(e,t,s,i)),e.length>80*i){o=1/0,l=1/0;let u=-1/0,h=-1/0;for(let d=i;d<r;d+=i){const p=e[d],g=e[d+1];p<o&&(o=p),g<l&&(l=g),p>u&&(u=p),g>h&&(h=g)}c=Math.max(u-o,h-l),c=c!==0?32767/c:0}return tw(s,a,i,o,l,c,0),a}function FY(e,t,i,n,r){let s;if(r===Roe(e,t,i,n)>0)for(let a=t;a<i;a+=n)s=KH(a/n|0,e[a],e[a+1],s);else for(let a=i-n;a>=t;a-=n)s=KH(a/n|0,e[a],e[a+1],s);return s&&Y1(s,s.next)&&(nw(s),s=s.next),s}function C0(e,t){if(!e)return e;t||(t=e);let i=e,n;do if(n=!1,!i.steiner&&(Y1(i,i.next)||Nr(i.prev,i,i.next)===0)){if(nw(i),i=t=i.prev,i===i.next)break;n=!0}else i=i.next;while(n||i!==t);return t}function tw(e,t,i,n,r,s,a){if(!e)return;!a&&s&&woe(e,n,r,s);let o=e;for(;e.prev!==e.next;){const l=e.prev,c=e.next;if(s?goe(e,n,r,s):moe(e)){t.push(l.i,e.i,c.i),nw(e),e=c.next,o=c.next;continue}if(e=c,e===o){a?a===1?(e=voe(C0(e),t),tw(e,t,i,n,r,s,2)):a===2&&yoe(e,t,i,n,r,s):tw(C0(e),t,i,n,r,s,1);break}}}function moe(e){const t=e.prev,i=e,n=e.next;if(Nr(t,i,n)>=0)return!1;const r=t.x,s=i.x,a=n.x,o=t.y,l=i.y,c=n.y,u=Math.min(r,s,a),h=Math.min(o,l,c),d=Math.max(r,s,a),p=Math.max(o,l,c);let g=n.next;for(;g!==t;){if(g.x>=u&&g.x<=d&&g.y>=h&&g.y<=p&&iA(r,o,s,l,a,c,g.x,g.y)&&Nr(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function goe(e,t,i,n){const r=e.prev,s=e,a=e.next;if(Nr(r,s,a)>=0)return!1;const o=r.x,l=s.x,c=a.x,u=r.y,h=s.y,d=a.y,p=Math.min(o,l,c),g=Math.min(u,h,d),x=Math.max(o,l,c),y=Math.max(u,h,d),b=eU(p,g,t,i,n),A=eU(x,y,t,i,n);let w=e.prevZ,E=e.nextZ;for(;w&&w.z>=b&&E&&E.z<=A;){if(w.x>=p&&w.x<=x&&w.y>=g&&w.y<=y&&w!==r&&w!==a&&iA(o,u,l,h,c,d,w.x,w.y)&&Nr(w.prev,w,w.next)>=0||(w=w.prevZ,E.x>=p&&E.x<=x&&E.y>=g&&E.y<=y&&E!==r&&E!==a&&iA(o,u,l,h,c,d,E.x,E.y)&&Nr(E.prev,E,E.next)>=0))return!1;E=E.nextZ}for(;w&&w.z>=b;){if(w.x>=p&&w.x<=x&&w.y>=g&&w.y<=y&&w!==r&&w!==a&&iA(o,u,l,h,c,d,w.x,w.y)&&Nr(w.prev,w,w.next)>=0)return!1;w=w.prevZ}for(;E&&E.z<=A;){if(E.x>=p&&E.x<=x&&E.y>=g&&E.y<=y&&E!==r&&E!==a&&iA(o,u,l,h,c,d,E.x,E.y)&&Nr(E.prev,E,E.next)>=0)return!1;E=E.nextZ}return!0}function voe(e,t){let i=e;do{const n=i.prev,r=i.next.next;!Y1(n,r)&&HY(n,i,i.next,r)&&iw(n,r)&&iw(r,n)&&(t.push(n.i,i.i,r.i),nw(i),nw(i.next),i=e=r),i=i.next}while(i!==e);return C0(i)}function yoe(e,t,i,n,r,s){let a=e;do{let o=a.next.next;for(;o!==a.prev;){if(a.i!==o.i&&Toe(a,o)){let l=GY(a,o);a=C0(a,a.next),l=C0(l,l.next),tw(a,t,i,n,r,s,0),tw(l,t,i,n,r,s,0);return}o=o.next}a=a.next}while(a!==e)}function xoe(e,t,i,n){const r=[];for(let s=0,a=t.length;s<a;s++){const o=t[s]*n,l=s<a-1?t[s+1]*n:e.length,c=FY(e,o,l,n,!1);c===c.next&&(c.steiner=!0),r.push(Eoe(c))}r.sort(boe);for(let s=0;s<r.length;s++)i=Soe(r[s],i);return i}function boe(e,t){let i=e.x-t.x;if(i===0&&(i=e.y-t.y,i===0)){const n=(e.next.y-e.y)/(e.next.x-e.x),r=(t.next.y-t.y)/(t.next.x-t.x);i=n-r}return i}function Soe(e,t){const i=_oe(e,t);if(!i)return t;const n=GY(i,e);return C0(n,n.next),C0(i,i.next)}function _oe(e,t){let i=t;const n=e.x,r=e.y;let s=-1/0,a;if(Y1(e,i))return i;do{if(Y1(e,i.next))return i.next;if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){const h=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(h<=n&&h>s&&(s=h,a=i.x<i.next.x?i:i.next,h===n))return a}i=i.next}while(i!==t);if(!a)return null;const o=a,l=a.x,c=a.y;let u=1/0;i=a;do{if(n>=i.x&&i.x>=l&&n!==i.x&&VY(r<c?n:s,r,l,c,r<c?s:n,r,i.x,i.y)){const h=Math.abs(r-i.y)/(n-i.x);iw(i,e)&&(h<u||h===u&&(i.x>a.x||i.x===a.x&&Aoe(a,i)))&&(a=i,u=h)}i=i.next}while(i!==o);return a}function Aoe(e,t){return Nr(e.prev,e,t.prev)<0&&Nr(t.next,e,e.next)<0}function woe(e,t,i,n){let r=e;do r.z===0&&(r.z=eU(r.x,r.y,t,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,Moe(r)}function Moe(e){let t,i=1;do{let n=e,r;e=null;let s=null;for(t=0;n;){t++;let a=n,o=0;for(let c=0;c<i&&(o++,a=a.nextZ,!!a);c++);let l=i;for(;o>0||l>0&&a;)o!==0&&(l===0||!a||n.z<=a.z)?(r=n,n=n.nextZ,o--):(r=a,a=a.nextZ,l--),s?s.nextZ=r:e=r,r.prevZ=s,s=r;n=a}s.nextZ=null,i*=2}while(t>1);return e}function eU(e,t,i,n,r){return e=(e-i)*r|0,t=(t-n)*r|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function Eoe(e){let t=e,i=e;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==e);return i}function VY(e,t,i,n,r,s,a,o){return(r-a)*(t-o)>=(e-a)*(s-o)&&(e-a)*(n-o)>=(i-a)*(t-o)&&(i-a)*(s-o)>=(r-a)*(n-o)}function iA(e,t,i,n,r,s,a,o){return!(e===a&&t===o)&&VY(e,t,i,n,r,s,a,o)}function Toe(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!Coe(e,t)&&(iw(e,t)&&iw(t,e)&&Doe(e,t)&&(Nr(e.prev,e,t.prev)||Nr(e,t.prev,t))||Y1(e,t)&&Nr(e.prev,e,e.next)>0&&Nr(t.prev,t,t.next)>0)}function Nr(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function Y1(e,t){return e.x===t.x&&e.y===t.y}function HY(e,t,i,n){const r=O2(Nr(e,t,i)),s=O2(Nr(e,t,n)),a=O2(Nr(i,n,e)),o=O2(Nr(i,n,t));return!!(r!==s&&a!==o||r===0&&P2(e,i,t)||s===0&&P2(e,n,t)||a===0&&P2(i,e,n)||o===0&&P2(i,t,n))}function P2(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function O2(e){return e>0?1:e<0?-1:0}function Coe(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&HY(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}function iw(e,t){return Nr(e.prev,e,e.next)<0?Nr(e,t,e.next)>=0&&Nr(e,e.prev,t)>=0:Nr(e,t,e.prev)<0||Nr(e,e.next,t)<0}function Doe(e,t){let i=e,n=!1;const r=(e.x+t.x)/2,s=(e.y+t.y)/2;do i.y>s!=i.next.y>s&&i.next.y!==i.y&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next;while(i!==e);return n}function GY(e,t){const i=tU(e.i,e.x,e.y),n=tU(t.i,t.x,t.y),r=e.next,s=t.prev;return e.next=t,t.prev=e,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}function KH(e,t,i,n){const r=tU(e,t,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function nw(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function tU(e,t,i){return{i:e,x:t,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Roe(e,t,i,n){let r=0;for(let s=t,a=i-n;s<i;s+=n)r+=(e[a]-e[s])*(e[s+1]+e[a+1]),a=s;return r}class Poe{static triangulate(t,i,n=2){return poe(t,i,n)}}class Wu{static area(t){const i=t.length;let n=0;for(let r=i-1,s=0;s<i;r=s++)n+=t[r].x*t[s].y-t[s].x*t[r].y;return n*.5}static isClockWise(t){return Wu.area(t)<0}static triangulateShape(t,i){const n=[],r=[],s=[];JH(t),ZH(n,t);let a=t.length;i.forEach(JH);for(let l=0;l<i.length;l++)r.push(a),a+=i[l].length,ZH(n,i[l]);const o=Poe.triangulate(n,r);for(let l=0;l<o.length;l+=3)s.push(o.slice(l,l+3));return s}}function JH(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function ZH(e,t){for(let i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}class ER extends ki{constructor(t=new g0([new Mt(.5,.5),new Mt(-.5,.5),new Mt(-.5,-.5),new Mt(.5,-.5)]),i={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:i},t=Array.isArray(t)?t:[t];const n=this,r=[],s=[];for(let o=0,l=t.length;o<l;o++){const c=t[o];a(c)}this.setAttribute("position",new ei(r,3)),this.setAttribute("uv",new ei(s,2)),this.computeVertexNormals();function a(o){const l=[],c=i.curveSegments!==void 0?i.curveSegments:12,u=i.steps!==void 0?i.steps:1,h=i.depth!==void 0?i.depth:1;let d=i.bevelEnabled!==void 0?i.bevelEnabled:!0,p=i.bevelThickness!==void 0?i.bevelThickness:.2,g=i.bevelSize!==void 0?i.bevelSize:p-.1,x=i.bevelOffset!==void 0?i.bevelOffset:0,y=i.bevelSegments!==void 0?i.bevelSegments:3;const b=i.extrudePath,A=i.UVGenerator!==void 0?i.UVGenerator:Ooe;let w,E=!1,D,T,I,R;b&&(w=b.getSpacedPoints(u),E=!0,d=!1,D=b.computeFrenetFrames(u,!1),T=new me,I=new me,R=new me),d||(y=0,p=0,g=0,x=0);const O=o.extractPoints(c);let P=O.shape;const U=O.holes;if(!Wu.isClockWise(P)){P=P.reverse();for(let ae=0,He=U.length;ae<He;ae++){const Ke=U[ae];Wu.isClockWise(Ke)&&(U[ae]=Ke.reverse())}}function V(ae){const Ke=10000000000000001e-36;let je=ae[0];for(let Oe=1;Oe<=ae.length;Oe++){const Qe=Oe%ae.length,$e=ae[Qe],gt=$e.x-je.x,pe=$e.y-je.y,k=gt*gt+pe*pe,Q=Math.max(Math.abs($e.x),Math.abs($e.y),Math.abs(je.x),Math.abs(je.y)),xe=Ke*Q*Q;if(k<=xe){ae.splice(Qe,1),Oe--;continue}je=$e}}V(P),U.forEach(V);const j=U.length,J=P;for(let ae=0;ae<j;ae++){const He=U[ae];P=P.concat(He)}function F(ae,He,Ke){return He||console.error("THREE.ExtrudeGeometry: vec does not exist"),ae.clone().addScaledVector(He,Ke)}const X=P.length;function W(ae,He,Ke){let je,Oe,Qe;const $e=ae.x-He.x,gt=ae.y-He.y,pe=Ke.x-ae.x,k=Ke.y-ae.y,Q=$e*$e+gt*gt,xe=$e*k-gt*pe;if(Math.abs(xe)>Number.EPSILON){const K=Math.sqrt(Q),Re=Math.sqrt(pe*pe+k*k),Le=He.x-gt/K,st=He.y+$e/K,Be=Ke.x-k/Re,bt=Ke.y+pe/Re,vt=((Be-Le)*k-(bt-st)*pe)/($e*k-gt*pe);je=Le+$e*vt-ae.x,Oe=st+gt*vt-ae.y;const Xe=je*je+Oe*Oe;if(Xe<=2)return new Mt(je,Oe);Qe=Math.sqrt(Xe/2)}else{let K=!1;$e>Number.EPSILON?pe>Number.EPSILON&&(K=!0):$e<-Number.EPSILON?pe<-Number.EPSILON&&(K=!0):Math.sign(gt)===Math.sign(k)&&(K=!0),K?(je=-gt,Oe=$e,Qe=Math.sqrt(Q)):(je=$e,Oe=gt,Qe=Math.sqrt(Q/2))}return new Mt(je/Qe,Oe/Qe)}const ne=[];for(let ae=0,He=J.length,Ke=He-1,je=ae+1;ae<He;ae++,Ke++,je++)Ke===He&&(Ke=0),je===He&&(je=0),ne[ae]=W(J[ae],J[Ke],J[je]);const Y=[];let $,se=ne.concat();for(let ae=0,He=j;ae<He;ae++){const Ke=U[ae];$=[];for(let je=0,Oe=Ke.length,Qe=Oe-1,$e=je+1;je<Oe;je++,Qe++,$e++)Qe===Oe&&(Qe=0),$e===Oe&&($e=0),$[je]=W(Ke[je],Ke[Qe],Ke[$e]);Y.push($),se=se.concat($)}let fe;if(y===0)fe=Wu.triangulateShape(J,U);else{const ae=[],He=[];for(let Ke=0;Ke<y;Ke++){const je=Ke/y,Oe=p*Math.cos(je*Math.PI/2),Qe=g*Math.sin(je*Math.PI/2)+x;for(let $e=0,gt=J.length;$e<gt;$e++){const pe=F(J[$e],ne[$e],Qe);we(pe.x,pe.y,-Oe),je===0&&ae.push(pe)}for(let $e=0,gt=j;$e<gt;$e++){const pe=U[$e];$=Y[$e];const k=[];for(let Q=0,xe=pe.length;Q<xe;Q++){const K=F(pe[Q],$[Q],Qe);we(K.x,K.y,-Oe),je===0&&k.push(K)}je===0&&He.push(k)}}fe=Wu.triangulateShape(ae,He)}const te=fe.length,de=g+x;for(let ae=0;ae<X;ae++){const He=d?F(P[ae],se[ae],de):P[ae];E?(I.copy(D.normals[0]).multiplyScalar(He.x),T.copy(D.binormals[0]).multiplyScalar(He.y),R.copy(w[0]).add(I).add(T),we(R.x,R.y,R.z)):we(He.x,He.y,0)}for(let ae=1;ae<=u;ae++)for(let He=0;He<X;He++){const Ke=d?F(P[He],se[He],de):P[He];E?(I.copy(D.normals[ae]).multiplyScalar(Ke.x),T.copy(D.binormals[ae]).multiplyScalar(Ke.y),R.copy(w[ae]).add(I).add(T),we(R.x,R.y,R.z)):we(Ke.x,Ke.y,h/u*ae)}for(let ae=y-1;ae>=0;ae--){const He=ae/y,Ke=p*Math.cos(He*Math.PI/2),je=g*Math.sin(He*Math.PI/2)+x;for(let Oe=0,Qe=J.length;Oe<Qe;Oe++){const $e=F(J[Oe],ne[Oe],je);we($e.x,$e.y,h+Ke)}for(let Oe=0,Qe=U.length;Oe<Qe;Oe++){const $e=U[Oe];$=Y[Oe];for(let gt=0,pe=$e.length;gt<pe;gt++){const k=F($e[gt],$[gt],je);E?we(k.x,k.y+w[u-1].y,w[u-1].x+Ke):we(k.x,k.y,h+Ke)}}}le(),_e();function le(){const ae=r.length/3;if(d){let He=0,Ke=X*He;for(let je=0;je<te;je++){const Oe=fe[je];Me(Oe[2]+Ke,Oe[1]+Ke,Oe[0]+Ke)}He=u+y*2,Ke=X*He;for(let je=0;je<te;je++){const Oe=fe[je];Me(Oe[0]+Ke,Oe[1]+Ke,Oe[2]+Ke)}}else{for(let He=0;He<te;He++){const Ke=fe[He];Me(Ke[2],Ke[1],Ke[0])}for(let He=0;He<te;He++){const Ke=fe[He];Me(Ke[0]+X*u,Ke[1]+X*u,Ke[2]+X*u)}}n.addGroup(ae,r.length/3-ae,0)}function _e(){const ae=r.length/3;let He=0;be(J,He),He+=J.length;for(let Ke=0,je=U.length;Ke<je;Ke++){const Oe=U[Ke];be(Oe,He),He+=Oe.length}n.addGroup(ae,r.length/3-ae,1)}function be(ae,He){let Ke=ae.length;for(;--Ke>=0;){const je=Ke;let Oe=Ke-1;Oe<0&&(Oe=ae.length-1);for(let Qe=0,$e=u+y*2;Qe<$e;Qe++){const gt=X*Qe,pe=X*(Qe+1),k=He+je+gt,Q=He+Oe+gt,xe=He+Oe+pe,K=He+je+pe;Ne(k,Q,xe,K)}}}function we(ae,He,Ke){l.push(ae),l.push(He),l.push(Ke)}function Me(ae,He,Ke){Ge(ae),Ge(He),Ge(Ke);const je=r.length/3,Oe=A.generateTopUV(n,r,je-3,je-2,je-1);We(Oe[0]),We(Oe[1]),We(Oe[2])}function Ne(ae,He,Ke,je){Ge(ae),Ge(He),Ge(je),Ge(He),Ge(Ke),Ge(je);const Oe=r.length/3,Qe=A.generateSideWallUV(n,r,Oe-6,Oe-3,Oe-2,Oe-1);We(Qe[0]),We(Qe[1]),We(Qe[3]),We(Qe[1]),We(Qe[2]),We(Qe[3])}function Ge(ae){r.push(l[ae*3+0]),r.push(l[ae*3+1]),r.push(l[ae*3+2])}function We(ae){s.push(ae.x),s.push(ae.y)}}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON(),i=this.parameters.shapes,n=this.parameters.options;return Boe(i,n,t)}static fromJSON(t,i){const n=[];for(let s=0,a=t.shapes.length;s<a;s++){const o=i[t.shapes[s]];n.push(o)}const r=t.options.extrudePath;return r!==void 0&&(t.options.extrudePath=new ND[r.type]().fromJSON(r)),new ER(n,t.options)}}const Ooe={generateTopUV:function(e,t,i,n,r){const s=t[i*3],a=t[i*3+1],o=t[n*3],l=t[n*3+1],c=t[r*3],u=t[r*3+1];return[new Mt(s,a),new Mt(o,l),new Mt(c,u)]},generateSideWallUV:function(e,t,i,n,r,s){const a=t[i*3],o=t[i*3+1],l=t[i*3+2],c=t[n*3],u=t[n*3+1],h=t[n*3+2],d=t[r*3],p=t[r*3+1],g=t[r*3+2],x=t[s*3],y=t[s*3+1],b=t[s*3+2];return Math.abs(o-u)<Math.abs(a-c)?[new Mt(a,1-l),new Mt(c,1-h),new Mt(d,1-g),new Mt(x,1-b)]:[new Mt(o,1-l),new Mt(u,1-h),new Mt(p,1-g),new Mt(y,1-b)]}};function Boe(e,t,i){if(i.shapes=[],Array.isArray(e))for(let n=0,r=e.length;n<r;n++){const s=e[n];i.shapes.push(s.uuid)}else i.shapes.push(e.uuid);return i.options=Object.assign({},t),t.extrudePath!==void 0&&(i.options.extrudePath=t.extrudePath.toJSON()),i}class TR extends cg{constructor(t=1,i=0){const n=(1+Math.sqrt(5))/2,r=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(r,s,t,i),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:i}}static fromJSON(t){return new TR(t.radius,t.detail)}}class CR extends ki{constructor(t=[new Mt(0,-.5),new Mt(.5,0),new Mt(0,.5)],i=12,n=0,r=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:t,segments:i,phiStart:n,phiLength:r},i=Math.floor(i),r=qi(r,0,Math.PI*2);const s=[],a=[],o=[],l=[],c=[],u=1/i,h=new me,d=new Mt,p=new me,g=new me,x=new me;let y=0,b=0;for(let A=0;A<=t.length-1;A++)switch(A){case 0:y=t[A+1].x-t[A].x,b=t[A+1].y-t[A].y,p.x=b*1,p.y=-y,p.z=b*0,x.copy(p),p.normalize(),l.push(p.x,p.y,p.z);break;case t.length-1:l.push(x.x,x.y,x.z);break;default:y=t[A+1].x-t[A].x,b=t[A+1].y-t[A].y,p.x=b*1,p.y=-y,p.z=b*0,g.copy(p),p.x+=x.x,p.y+=x.y,p.z+=x.z,p.normalize(),l.push(p.x,p.y,p.z),x.copy(g)}for(let A=0;A<=i;A++){const w=n+A*u*r,E=Math.sin(w),D=Math.cos(w);for(let T=0;T<=t.length-1;T++){h.x=t[T].x*E,h.y=t[T].y,h.z=t[T].x*D,a.push(h.x,h.y,h.z),d.x=A/i,d.y=T/(t.length-1),o.push(d.x,d.y);const I=l[3*T+0]*E,R=l[3*T+1],O=l[3*T+0]*D;c.push(I,R,O)}}for(let A=0;A<i;A++)for(let w=0;w<t.length-1;w++){const E=w+A*t.length,D=E,T=E+t.length,I=E+t.length+1,R=E+1;s.push(D,T,R),s.push(I,R,T)}this.setIndex(s),this.setAttribute("position",new ei(a,3)),this.setAttribute("uv",new ei(o,2)),this.setAttribute("normal",new ei(c,3))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new CR(t.points,t.segments,t.phiStart,t.phiLength)}}class Yw extends cg{constructor(t=1,i=0){const n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],r=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(n,r,t,i),this.type="OctahedronGeometry",this.parameters={radius:t,detail:i}}static fromJSON(t){return new Yw(t.radius,t.detail)}}class xb extends ki{constructor(t=1,i=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:i,widthSegments:n,heightSegments:r};const s=t/2,a=i/2,o=Math.floor(n),l=Math.floor(r),c=o+1,u=l+1,h=t/o,d=i/l,p=[],g=[],x=[],y=[];for(let b=0;b<u;b++){const A=b*d-a;for(let w=0;w<c;w++){const E=w*h-s;g.push(E,-A,0),x.push(0,0,1),y.push(w/o),y.push(1-b/l)}}for(let b=0;b<l;b++)for(let A=0;A<o;A++){const w=A+c*b,E=A+c*(b+1),D=A+1+c*(b+1),T=A+1+c*b;p.push(w,E,T),p.push(E,D,T)}this.setIndex(p),this.setAttribute("position",new ei(g,3)),this.setAttribute("normal",new ei(x,3)),this.setAttribute("uv",new ei(y,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new xb(t.width,t.height,t.widthSegments,t.heightSegments)}}class DR extends ki{constructor(t=.5,i=1,n=32,r=1,s=0,a=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:i,thetaSegments:n,phiSegments:r,thetaStart:s,thetaLength:a},n=Math.max(3,n),r=Math.max(1,r);const o=[],l=[],c=[],u=[];let h=t;const d=(i-t)/r,p=new me,g=new Mt;for(let x=0;x<=r;x++){for(let y=0;y<=n;y++){const b=s+y/n*a;p.x=h*Math.cos(b),p.y=h*Math.sin(b),l.push(p.x,p.y,p.z),c.push(0,0,1),g.x=(p.x/i+1)/2,g.y=(p.y/i+1)/2,u.push(g.x,g.y)}h+=d}for(let x=0;x<r;x++){const y=x*(n+1);for(let b=0;b<n;b++){const A=b+y,w=A,E=A+n+1,D=A+n+2,T=A+1;o.push(w,E,T),o.push(E,D,T)}}this.setIndex(o),this.setAttribute("position",new ei(l,3)),this.setAttribute("normal",new ei(c,3)),this.setAttribute("uv",new ei(u,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new DR(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)}}class RR extends ki{constructor(t=new g0([new Mt(0,.5),new Mt(-.5,-.5),new Mt(.5,-.5)]),i=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:i};const n=[],r=[],s=[],a=[];let o=0,l=0;if(Array.isArray(t)===!1)c(t);else for(let u=0;u<t.length;u++)c(t[u]),this.addGroup(o,l,u),o+=l,l=0;this.setIndex(n),this.setAttribute("position",new ei(r,3)),this.setAttribute("normal",new ei(s,3)),this.setAttribute("uv",new ei(a,2));function c(u){const h=r.length/3,d=u.extractPoints(i);let p=d.shape;const g=d.holes;Wu.isClockWise(p)===!1&&(p=p.reverse());for(let y=0,b=g.length;y<b;y++){const A=g[y];Wu.isClockWise(A)===!0&&(g[y]=A.reverse())}const x=Wu.triangulateShape(p,g);for(let y=0,b=g.length;y<b;y++){const A=g[y];p=p.concat(A)}for(let y=0,b=p.length;y<b;y++){const A=p[y];r.push(A.x,A.y,0),s.push(0,0,1),a.push(A.x,A.y)}for(let y=0,b=x.length;y<b;y++){const A=x[y],w=A[0]+h,E=A[1]+h,D=A[2]+h;n.push(w,E,D),l+=3}}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON(),i=this.parameters.shapes;return Ioe(i,t)}static fromJSON(t,i){const n=[];for(let r=0,s=t.shapes.length;r<s;r++){const a=i[t.shapes[r]];n.push(a)}return new RR(n,t.curveSegments)}}function Ioe(e,t){if(t.shapes=[],Array.isArray(e))for(let i=0,n=e.length;i<n;i++){const r=e[i];t.shapes.push(r.uuid)}else t.shapes.push(e.uuid);return t}class Qw extends ki{constructor(t=1,i=32,n=16,r=0,s=Math.PI*2,a=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:i,heightSegments:n,phiStart:r,phiLength:s,thetaStart:a,thetaLength:o},i=Math.max(3,Math.floor(i)),n=Math.max(2,Math.floor(n));const l=Math.min(a+o,Math.PI);let c=0;const u=[],h=new me,d=new me,p=[],g=[],x=[],y=[];for(let b=0;b<=n;b++){const A=[],w=b/n;let E=0;b===0&&a===0?E=.5/i:b===n&&l===Math.PI&&(E=-.5/i);for(let D=0;D<=i;D++){const T=D/i;h.x=-t*Math.cos(r+T*s)*Math.sin(a+w*o),h.y=t*Math.cos(a+w*o),h.z=t*Math.sin(r+T*s)*Math.sin(a+w*o),g.push(h.x,h.y,h.z),d.copy(h).normalize(),x.push(d.x,d.y,d.z),y.push(T+E,1-w),A.push(c++)}u.push(A)}for(let b=0;b<n;b++)for(let A=0;A<i;A++){const w=u[b][A+1],E=u[b][A],D=u[b+1][A],T=u[b+1][A+1];(b!==0||a>0)&&p.push(w,E,T),(b!==n-1||l<Math.PI)&&p.push(E,D,T)}this.setIndex(p),this.setAttribute("position",new ei(g,3)),this.setAttribute("normal",new ei(x,3)),this.setAttribute("uv",new ei(y,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Qw(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class PR extends cg{constructor(t=1,i=0){const n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],r=[2,1,0,0,3,2,1,3,0,2,3,1];super(n,r,t,i),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:i}}static fromJSON(t){return new PR(t.radius,t.detail)}}class OR extends ki{constructor(t=1,i=.4,n=12,r=48,s=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:i,radialSegments:n,tubularSegments:r,arc:s},n=Math.floor(n),r=Math.floor(r);const a=[],o=[],l=[],c=[],u=new me,h=new me,d=new me;for(let p=0;p<=n;p++)for(let g=0;g<=r;g++){const x=g/r*s,y=p/n*Math.PI*2;h.x=(t+i*Math.cos(y))*Math.cos(x),h.y=(t+i*Math.cos(y))*Math.sin(x),h.z=i*Math.sin(y),o.push(h.x,h.y,h.z),u.x=t*Math.cos(x),u.y=t*Math.sin(x),d.subVectors(h,u).normalize(),l.push(d.x,d.y,d.z),c.push(g/r),c.push(p/n)}for(let p=1;p<=n;p++)for(let g=1;g<=r;g++){const x=(r+1)*p+g-1,y=(r+1)*(p-1)+g-1,b=(r+1)*(p-1)+g,A=(r+1)*p+g;a.push(x,y,A),a.push(y,b,A)}this.setIndex(a),this.setAttribute("position",new ei(o,3)),this.setAttribute("normal",new ei(l,3)),this.setAttribute("uv",new ei(c,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new OR(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class BR extends ki{constructor(t=1,i=.4,n=64,r=8,s=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:i,tubularSegments:n,radialSegments:r,p:s,q:a},n=Math.floor(n),r=Math.floor(r);const o=[],l=[],c=[],u=[],h=new me,d=new me,p=new me,g=new me,x=new me,y=new me,b=new me;for(let w=0;w<=n;++w){const E=w/n*s*Math.PI*2;A(E,s,a,t,p),A(E+.01,s,a,t,g),y.subVectors(g,p),b.addVectors(g,p),x.crossVectors(y,b),b.crossVectors(x,y),x.normalize(),b.normalize();for(let D=0;D<=r;++D){const T=D/r*Math.PI*2,I=-i*Math.cos(T),R=i*Math.sin(T);h.x=p.x+(I*b.x+R*x.x),h.y=p.y+(I*b.y+R*x.y),h.z=p.z+(I*b.z+R*x.z),l.push(h.x,h.y,h.z),d.subVectors(h,p).normalize(),c.push(d.x,d.y,d.z),u.push(w/n),u.push(D/r)}}for(let w=1;w<=n;w++)for(let E=1;E<=r;E++){const D=(r+1)*(w-1)+(E-1),T=(r+1)*w+(E-1),I=(r+1)*w+E,R=(r+1)*(w-1)+E;o.push(D,T,R),o.push(T,I,R)}this.setIndex(o),this.setAttribute("position",new ei(l,3)),this.setAttribute("normal",new ei(c,3)),this.setAttribute("uv",new ei(u,2));function A(w,E,D,T,I){const R=Math.cos(w),O=Math.sin(w),P=D/E*w,U=Math.cos(P);I.x=T*(2+U)*.5*R,I.y=T*(2+U)*O*.5,I.z=T*Math.sin(P)*.5}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new BR(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}}class IR extends ki{constructor(t=new _F(new me(-1,-1,0),new me(-1,1,0),new me(1,1,0)),i=64,n=1,r=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:i,radius:n,radialSegments:r,closed:s};const a=t.computeFrenetFrames(i,s);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const o=new me,l=new me,c=new Mt;let u=new me;const h=[],d=[],p=[],g=[];x(),this.setIndex(g),this.setAttribute("position",new ei(h,3)),this.setAttribute("normal",new ei(d,3)),this.setAttribute("uv",new ei(p,2));function x(){for(let w=0;w<i;w++)y(w);y(s===!1?i:0),A(),b()}function y(w){u=t.getPointAt(w/i,u);const E=a.normals[w],D=a.binormals[w];for(let T=0;T<=r;T++){const I=T/r*Math.PI*2,R=Math.sin(I),O=-Math.cos(I);l.x=O*E.x+R*D.x,l.y=O*E.y+R*D.y,l.z=O*E.z+R*D.z,l.normalize(),d.push(l.x,l.y,l.z),o.x=u.x+n*l.x,o.y=u.y+n*l.y,o.z=u.z+n*l.z,h.push(o.x,o.y,o.z)}}function b(){for(let w=1;w<=i;w++)for(let E=1;E<=r;E++){const D=(r+1)*(w-1)+(E-1),T=(r+1)*w+(E-1),I=(r+1)*w+E,R=(r+1)*(w-1)+E;g.push(D,T,R),g.push(T,I,R)}}function A(){for(let w=0;w<=i;w++)for(let E=0;E<=r;E++)c.x=w/i,c.y=E/r,p.push(c.x,c.y)}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new IR(new ND[t.path.type]().fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class kY extends ki{constructor(t=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:t},t!==null){const i=[],n=new Set,r=new me,s=new me;if(t.index!==null){const a=t.attributes.position,o=t.index;let l=t.groups;l.length===0&&(l=[{start:0,count:o.count,materialIndex:0}]);for(let c=0,u=l.length;c<u;++c){const h=l[c],d=h.start,p=h.count;for(let g=d,x=d+p;g<x;g+=3)for(let y=0;y<3;y++){const b=o.getX(g+y),A=o.getX(g+(y+1)%3);r.fromBufferAttribute(a,b),s.fromBufferAttribute(a,A),$H(r,s,n)===!0&&(i.push(r.x,r.y,r.z),i.push(s.x,s.y,s.z))}}}else{const a=t.attributes.position;for(let o=0,l=a.count/3;o<l;o++)for(let c=0;c<3;c++){const u=3*o+c,h=3*o+(c+1)%3;r.fromBufferAttribute(a,u),s.fromBufferAttribute(a,h),$H(r,s,n)===!0&&(i.push(r.x,r.y,r.z),i.push(s.x,s.y,s.z))}}this.setAttribute("position",new ei(i,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}function $H(e,t,i){const n=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`,r=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`;return i.has(n)===!0||i.has(r)===!0?!1:(i.add(n),i.add(r),!0)}var eG=Object.freeze({__proto__:null,BoxGeometry:j0,CapsuleGeometry:_R,CircleGeometry:AR,ConeGeometry:qw,CylinderGeometry:Xw,DodecahedronGeometry:wR,EdgesGeometry:BY,ExtrudeGeometry:ER,IcosahedronGeometry:TR,LatheGeometry:CR,OctahedronGeometry:Yw,PlaneGeometry:xb,PolyhedronGeometry:cg,RingGeometry:DR,ShapeGeometry:RR,SphereGeometry:Qw,TetrahedronGeometry:PR,TorusGeometry:OR,TorusKnotGeometry:BR,TubeGeometry:IR,WireframeGeometry:kY});class jY extends Js{constructor(t){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new jt(0),this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.fog=t.fog,this}}class WY extends Ju{constructor(t){super(t),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class Kw extends Js{constructor(t){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new jt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new jt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=lg,this.normalScale=new Mt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new tl,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class eu extends Kw{constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Mt(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return qi(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(i){this.ior=(1+.4*i)/(1-.4*i)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new jt(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new jt(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new jt(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(t)}get anisotropy(){return this._anisotropy}set anisotropy(t){this._anisotropy>0!=t>0&&this.version++,this._anisotropy=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get dispersion(){return this._dispersion}set dispersion(t){this._dispersion>0!=t>0&&this.version++,this._dispersion=t}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=t.anisotropy,this.anisotropyRotation=t.anisotropyRotation,this.anisotropyMap=t.anisotropyMap,this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.dispersion=t.dispersion,this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}class XY extends Js{constructor(t){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new jt(16777215),this.specular=new jt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new jt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=lg,this.normalScale=new Mt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new tl,this.combine=Vw,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class qY extends Js{constructor(t){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new jt(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new jt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=lg,this.normalScale=new Mt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}class YY extends Js{constructor(t){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=lg,this.normalScale=new Mt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}class QY extends Js{constructor(t){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new jt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new jt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=lg,this.normalScale=new Mt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new tl,this.combine=Vw,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class wF extends Js{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=dY,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class MF extends Js{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}class KY extends Js{constructor(t){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new jt(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=lg,this.normalScale=new Mt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this.fog=t.fog,this}}class JY extends So{constructor(t){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}function e0(e,t){return!e||e.constructor===t?e:typeof t.BYTES_PER_ELEMENT=="number"?new t(e):Array.prototype.slice.call(e)}function ZY(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function $Y(e){function t(r,s){return e[r]-e[s]}const i=e.length,n=new Array(i);for(let r=0;r!==i;++r)n[r]=r;return n.sort(t),n}function iU(e,t,i){const n=e.length,r=new e.constructor(n);for(let s=0,a=0;a!==n;++s){const o=i[s]*t;for(let l=0;l!==t;++l)r[a++]=e[o+l]}return r}function EF(e,t,i,n){let r=1,s=e[0];for(;s!==void 0&&s[n]===void 0;)s=e[r++];if(s===void 0)return;let a=s[n];if(a!==void 0)if(Array.isArray(a))do a=s[n],a!==void 0&&(t.push(s.time),i.push(...a)),s=e[r++];while(s!==void 0);else if(a.toArray!==void 0)do a=s[n],a!==void 0&&(t.push(s.time),a.toArray(i,i.length)),s=e[r++];while(s!==void 0);else do a=s[n],a!==void 0&&(t.push(s.time),i.push(a)),s=e[r++];while(s!==void 0)}function Loe(e,t,i,n,r=30){const s=e.clone();s.name=t;const a=[];for(let l=0;l<s.tracks.length;++l){const c=s.tracks[l],u=c.getValueSize(),h=[],d=[];for(let p=0;p<c.times.length;++p){const g=c.times[p]*r;if(!(g<i||g>=n)){h.push(c.times[p]);for(let x=0;x<u;++x)d.push(c.values[p*u+x])}}h.length!==0&&(c.times=e0(h,c.times.constructor),c.values=e0(d,c.values.constructor),a.push(c))}s.tracks=a;let o=1/0;for(let l=0;l<s.tracks.length;++l)o>s.tracks[l].times[0]&&(o=s.tracks[l].times[0]);for(let l=0;l<s.tracks.length;++l)s.tracks[l].shift(-1*o);return s.resetDuration(),s}function Uoe(e,t=0,i=e,n=30){n<=0&&(n=30);const r=i.tracks.length,s=t/n;for(let a=0;a<r;++a){const o=i.tracks[a],l=o.ValueTypeName;if(l==="bool"||l==="string")continue;const c=e.tracks.find(function(b){return b.name===o.name&&b.ValueTypeName===l});if(c===void 0)continue;let u=0;const h=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=h/3);let d=0;const p=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(d=p/3);const g=o.times.length-1;let x;if(s<=o.times[0]){const b=u,A=h-u;x=o.values.slice(b,A)}else if(s>=o.times[g]){const b=g*h+u,A=b+h-u;x=o.values.slice(b,A)}else{const b=o.createInterpolant(),A=u,w=h-u;b.evaluate(s),x=b.resultBuffer.slice(A,w)}l==="quaternion"&&new ba().fromArray(x).normalize().conjugate().toArray(x);const y=c.times.length;for(let b=0;b<y;++b){const A=b*p+d;if(l==="quaternion")ba.multiplyQuaternionsFlat(c.values,A,x,0,c.values,A);else{const w=p-d*2;for(let E=0;E<w;++E)c.values[A+E]-=x[E]}}}return e.blendMode=tF,e}class Noe{static convertArray(t,i){return e0(t,i)}static isTypedArray(t){return ZY(t)}static getKeyframeOrder(t){return $Y(t)}static sortedArray(t,i,n){return iU(t,i,n)}static flattenJSON(t,i,n,r){EF(t,i,n,r)}static subclip(t,i,n,r,s=30){return Loe(t,i,n,r,s)}static makeClipAdditive(t,i=0,n=t,r=30){return Uoe(t,i,n,r)}}class bb{constructor(t,i,n,r){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new i.constructor(n),this.sampleValues=i,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(t){const i=this.parameterPositions;let n=this._cachedIndex,r=i[n],s=i[n-1];e:{t:{let a;i:{n:if(!(t<r)){for(let o=n+2;;){if(r===void 0){if(t<s)break n;return n=i.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===o)break;if(s=r,r=i[++n],t<r)break t}a=i.length;break i}if(!(t>=s)){const o=i[1];t<o&&(n=2,s=o);for(let l=n-2;;){if(s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===l)break;if(r=s,s=i[--n-1],t>=s)break t}a=n,n=0;break i}break e}for(;n<a;){const o=n+a>>>1;t<i[o]?a=o:n=o+1}if(r=i[n],s=i[n-1],s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===void 0)return n=i.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,s,r)}return this.interpolate_(n,s,t,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const i=this.resultBuffer,n=this.sampleValues,r=this.valueSize,s=t*r;for(let a=0;a!==r;++a)i[a]=n[s+a];return i}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class eQ extends bb{constructor(t,i,n,r){super(t,i,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Zv,endingEnd:Zv}}intervalChanged_(t,i,n){const r=this.parameterPositions;let s=t-2,a=t+1,o=r[s],l=r[a];if(o===void 0)switch(this.getSettings_().endingStart){case $v:s=t,o=2*i-n;break;case KA:s=r.length-2,o=i+r[s]-r[s+1];break;default:s=t,o=n}if(l===void 0)switch(this.getSettings_().endingEnd){case $v:a=t,l=2*n-i;break;case KA:a=1,l=n+r[1]-r[0];break;default:a=t-1,l=i}const c=(n-i)*.5,u=this.valueSize;this._weightPrev=c/(i-o),this._weightNext=c/(l-n),this._offsetPrev=s*u,this._offsetNext=a*u}interpolate_(t,i,n,r){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=t*o,c=l-o,u=this._offsetPrev,h=this._offsetNext,d=this._weightPrev,p=this._weightNext,g=(n-i)/(r-i),x=g*g,y=x*g,b=-d*y+2*d*x-d*g,A=(1+d)*y+(-1.5-2*d)*x+(-.5+d)*g+1,w=(-1-p)*y+(1.5+p)*x+.5*g,E=p*y-p*x;for(let D=0;D!==o;++D)s[D]=b*a[u+D]+A*a[c+D]+w*a[l+D]+E*a[h+D];return s}}class TF extends bb{constructor(t,i,n,r){super(t,i,n,r)}interpolate_(t,i,n,r){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=t*o,c=l-o,u=(n-i)/(r-i),h=1-u;for(let d=0;d!==o;++d)s[d]=a[c+d]*h+a[l+d]*u;return s}}class tQ extends bb{constructor(t,i,n,r){super(t,i,n,r)}interpolate_(t){return this.copySampleValue_(t-1)}}class tu{constructor(t,i,n,r){if(t===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(i===void 0||i.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=e0(i,this.TimeBufferType),this.values=e0(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(t){const i=t.constructor;let n;if(i.toJSON!==this.toJSON)n=i.toJSON(t);else{n={name:t.name,times:e0(t.times,Array),values:e0(t.values,Array)};const r=t.getInterpolation();r!==t.DefaultInterpolation&&(n.interpolation=r)}return n.type=t.ValueTypeName,n}InterpolantFactoryMethodDiscrete(t){return new tQ(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new TF(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new eQ(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let i;switch(t){case k1:i=this.InterpolantFactoryMethodDiscrete;break;case j1:i=this.InterpolantFactoryMethodLinear;break;case AC:i=this.InterpolantFactoryMethodSmooth;break}if(i===void 0){const n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(t!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=i,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return k1;case this.InterpolantFactoryMethodLinear:return j1;case this.InterpolantFactoryMethodSmooth:return AC}}getValueSize(){return this.values.length/this.times.length}shift(t){if(t!==0){const i=this.times;for(let n=0,r=i.length;n!==r;++n)i[n]+=t}return this}scale(t){if(t!==1){const i=this.times;for(let n=0,r=i.length;n!==r;++n)i[n]*=t}return this}trim(t,i){const n=this.times,r=n.length;let s=0,a=r-1;for(;s!==r&&n[s]<t;)++s;for(;a!==-1&&n[a]>i;)--a;if(++a,s!==0||a!==r){s>=a&&(a=Math.max(a,1),s=a-1);const o=this.getValueSize();this.times=n.slice(s,a),this.values=this.values.slice(s*o,a*o)}return this}validate(){let t=!0;const i=this.getValueSize();i-Math.floor(i)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const n=this.times,r=this.values,s=n.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let a=null;for(let o=0;o!==s;o++){const l=n[o];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,l),t=!1;break}if(a!==null&&a>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,l,a),t=!1;break}a=l}if(r!==void 0&&ZY(r))for(let o=0,l=r.length;o!==l;++o){const c=r[o];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,c),t=!1;break}}return t}optimize(){const t=this.times.slice(),i=this.values.slice(),n=this.getValueSize(),r=this.getInterpolation()===AC,s=t.length-1;let a=1;for(let o=1;o<s;++o){let l=!1;const c=t[o],u=t[o+1];if(c!==u&&(o!==1||c!==t[0]))if(r)l=!0;else{const h=o*n,d=h-n,p=h+n;for(let g=0;g!==n;++g){const x=i[h+g];if(x!==i[d+g]||x!==i[p+g]){l=!0;break}}}if(l){if(o!==a){t[a]=t[o];const h=o*n,d=a*n;for(let p=0;p!==n;++p)i[d+p]=i[h+p]}++a}}if(s>0){t[a]=t[s];for(let o=s*n,l=a*n,c=0;c!==n;++c)i[l+c]=i[o+c];++a}return a!==t.length?(this.times=t.slice(0,a),this.values=i.slice(0,a*n)):(this.times=t,this.values=i),this}clone(){const t=this.times.slice(),i=this.values.slice(),n=this.constructor,r=new n(this.name,t,i);return r.createInterpolant=this.createInterpolant,r}}tu.prototype.ValueTypeName="";tu.prototype.TimeBufferType=Float32Array;tu.prototype.ValueBufferType=Float32Array;tu.prototype.DefaultInterpolation=j1;class W0 extends tu{constructor(t,i,n){super(t,i,n)}}W0.prototype.ValueTypeName="bool";W0.prototype.ValueBufferType=Array;W0.prototype.DefaultInterpolation=k1;W0.prototype.InterpolantFactoryMethodLinear=void 0;W0.prototype.InterpolantFactoryMethodSmooth=void 0;class CF extends tu{constructor(t,i,n,r){super(t,i,n,r)}}CF.prototype.ValueTypeName="color";class D0 extends tu{constructor(t,i,n,r){super(t,i,n,r)}}D0.prototype.ValueTypeName="number";class iQ extends bb{constructor(t,i,n,r){super(t,i,n,r)}interpolate_(t,i,n,r){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=(n-i)/(r-i);let c=t*o;for(let u=c+o;c!==u;c+=4)ba.slerpFlat(s,0,a,c-o,a,c,l);return s}}class R0 extends tu{constructor(t,i,n,r){super(t,i,n,r)}InterpolantFactoryMethodLinear(t){return new iQ(this.times,this.values,this.getValueSize(),t)}}R0.prototype.ValueTypeName="quaternion";R0.prototype.InterpolantFactoryMethodSmooth=void 0;class X0 extends tu{constructor(t,i,n){super(t,i,n)}}X0.prototype.ValueTypeName="string";X0.prototype.ValueBufferType=Array;X0.prototype.DefaultInterpolation=k1;X0.prototype.InterpolantFactoryMethodLinear=void 0;X0.prototype.InterpolantFactoryMethodSmooth=void 0;class P0 extends tu{constructor(t,i,n,r){super(t,i,n,r)}}P0.prototype.ValueTypeName="vector";class Q1{constructor(t="",i=-1,n=[],r=fR){this.name=t,this.tracks=n,this.duration=i,this.blendMode=r,this.uuid=tc(),this.duration<0&&this.resetDuration()}static parse(t){const i=[],n=t.tracks,r=1/(t.fps||1);for(let a=0,o=n.length;a!==o;++a)i.push(Foe(n[a]).scale(r));const s=new this(t.name,t.duration,i,t.blendMode);return s.uuid=t.uuid,s}static toJSON(t){const i=[],n=t.tracks,r={name:t.name,duration:t.duration,tracks:i,uuid:t.uuid,blendMode:t.blendMode};for(let s=0,a=n.length;s!==a;++s)i.push(tu.toJSON(n[s]));return r}static CreateFromMorphTargetSequence(t,i,n,r){const s=i.length,a=[];for(let o=0;o<s;o++){let l=[],c=[];l.push((o+s-1)%s,o,(o+1)%s),c.push(0,1,0);const u=$Y(l);l=iU(l,1,u),c=iU(c,1,u),!r&&l[0]===0&&(l.push(s),c.push(c[0])),a.push(new D0(".morphTargetInfluences["+i[o].name+"]",l,c).scale(1/n))}return new this(t,-1,a)}static findByName(t,i){let n=t;if(!Array.isArray(t)){const r=t;n=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<n.length;r++)if(n[r].name===i)return n[r];return null}static CreateClipsFromMorphTargetSequences(t,i,n){const r={},s=/^([\w-]*?)([\d]+)$/;for(let o=0,l=t.length;o<l;o++){const c=t[o],u=c.name.match(s);if(u&&u.length>1){const h=u[1];let d=r[h];d||(r[h]=d=[]),d.push(c)}}const a=[];for(const o in r)a.push(this.CreateFromMorphTargetSequence(o,r[o],i,n));return a}static parseAnimation(t,i){if(console.warn("THREE.AnimationClip: parseAnimation() is deprecated and will be removed with r185"),!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(h,d,p,g,x){if(p.length!==0){const y=[],b=[];EF(p,y,b,g),y.length!==0&&x.push(new h(d,y,b))}},r=[],s=t.name||"default",a=t.fps||30,o=t.blendMode;let l=t.length||-1;const c=t.hierarchy||[];for(let h=0;h<c.length;h++){const d=c[h].keys;if(!(!d||d.length===0))if(d[0].morphTargets){const p={};let g;for(g=0;g<d.length;g++)if(d[g].morphTargets)for(let x=0;x<d[g].morphTargets.length;x++)p[d[g].morphTargets[x]]=-1;for(const x in p){const y=[],b=[];for(let A=0;A!==d[g].morphTargets.length;++A){const w=d[g];y.push(w.time),b.push(w.morphTarget===x?1:0)}r.push(new D0(".morphTargetInfluence["+x+"]",y,b))}l=p.length*a}else{const p=".bones["+i[h].name+"]";n(P0,p+".position",d,"pos",r),n(R0,p+".quaternion",d,"rot",r),n(P0,p+".scale",d,"scl",r)}}return r.length===0?null:new this(s,l,r,o)}resetDuration(){const t=this.tracks;let i=0;for(let n=0,r=t.length;n!==r;++n){const s=this.tracks[n];i=Math.max(i,s.times[s.times.length-1])}return this.duration=i,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let i=0;i<this.tracks.length;i++)t=t&&this.tracks[i].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let i=0;i<this.tracks.length;i++)t.push(this.tracks[i].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function zoe(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return D0;case"vector":case"vector2":case"vector3":case"vector4":return P0;case"color":return CF;case"quaternion":return R0;case"bool":case"boolean":return W0;case"string":return X0}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}function Foe(e){if(e.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=zoe(e.type);if(e.times===void 0){const i=[],n=[];EF(e.keys,i,n,"value"),e.times=i,e.values=n}return t.parse!==void 0?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const Nf={enabled:!1,files:{},add:function(e,t){this.enabled!==!1&&(this.files[e]=t)},get:function(e){if(this.enabled!==!1)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class DF{constructor(t,i,n){const r=this;let s=!1,a=0,o=0,l;const c=[];this.onStart=void 0,this.onLoad=t,this.onProgress=i,this.onError=n,this.itemStart=function(u){o++,s===!1&&r.onStart!==void 0&&r.onStart(u,a,o),s=!0},this.itemEnd=function(u){a++,r.onProgress!==void 0&&r.onProgress(u,a,o),a===o&&(s=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(u){r.onError!==void 0&&r.onError(u)},this.resolveURL=function(u){return l?l(u):u},this.setURLModifier=function(u){return l=u,this},this.addHandler=function(u,h){return c.push(u,h),this},this.removeHandler=function(u){const h=c.indexOf(u);return h!==-1&&c.splice(h,2),this},this.getHandler=function(u){for(let h=0,d=c.length;h<d;h+=2){const p=c[h],g=c[h+1];if(p.global&&(p.lastIndex=0),p.test(u))return g}return null}}}const a1=new DF;class _o{constructor(t){this.manager=t!==void 0?t:a1,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,i){const n=this;return new Promise(function(r,s){n.load(t,r,i,s)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}_o.DEFAULT_MATERIAL_NAME="__DEFAULT";const of={};class Voe extends Error{constructor(t,i){super(t),this.response=i}}class ic extends _o{constructor(t){super(t),this.mimeType="",this.responseType=""}load(t,i,n,r){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const s=Nf.get(t);if(s!==void 0)return this.manager.itemStart(t),setTimeout(()=>{i&&i(s),this.manager.itemEnd(t)},0),s;if(of[t]!==void 0){of[t].push({onLoad:i,onProgress:n,onError:r});return}of[t]=[],of[t].push({onLoad:i,onProgress:n,onError:r});const a=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,l=this.responseType;fetch(a).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const u=of[t],h=c.body.getReader(),d=c.headers.get("X-File-Size")||c.headers.get("Content-Length"),p=d?parseInt(d):0,g=p!==0;let x=0;const y=new ReadableStream({start(b){A();function A(){h.read().then(({done:w,value:E})=>{if(w)b.close();else{x+=E.byteLength;const D=new ProgressEvent("progress",{lengthComputable:g,loaded:x,total:p});for(let T=0,I=u.length;T<I;T++){const R=u[T];R.onProgress&&R.onProgress(D)}b.enqueue(E),A()}},w=>{b.error(w)})}}});return new Response(y)}else throw new Voe(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(u=>new DOMParser().parseFromString(u,o));case"json":return c.json();default:if(o==="")return c.text();{const h=/charset="?([^;"\s]*)"?/i.exec(o),d=h&&h[1]?h[1].toLowerCase():void 0,p=new TextDecoder(d);return c.arrayBuffer().then(g=>p.decode(g))}}}).then(c=>{Nf.add(t,c);const u=of[t];delete of[t];for(let h=0,d=u.length;h<d;h++){const p=u[h];p.onLoad&&p.onLoad(c)}}).catch(c=>{const u=of[t];if(u===void 0)throw this.manager.itemError(t),c;delete of[t];for(let h=0,d=u.length;h<d;h++){const p=u[h];p.onError&&p.onError(c)}this.manager.itemError(t)}).finally(()=>{this.manager.itemEnd(t)}),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class Hoe extends _o{constructor(t){super(t)}load(t,i,n,r){const s=this,a=new ic(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,function(o){try{i(s.parse(JSON.parse(o)))}catch(l){r?r(l):console.error(l),s.manager.itemError(t)}},n,r)}parse(t){const i=[];for(let n=0;n<t.length;n++){const r=Q1.parse(t[n]);i.push(r)}return i}}class Goe extends _o{constructor(t){super(t)}load(t,i,n,r){const s=this,a=[],o=new SR,l=new ic(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(s.withCredentials);let c=0;function u(h){l.load(t[h],function(d){const p=s.parse(d,!0);a[h]={width:p.width,height:p.height,format:p.format,mipmaps:p.mipmaps},c+=1,c===6&&(p.mipmapCount===1&&(o.minFilter=hs),o.image=a,o.format=p.format,o.needsUpdate=!0,i&&i(o))},n,r)}if(Array.isArray(t))for(let h=0,d=t.length;h<d;++h)u(h);else l.load(t,function(h){const d=s.parse(h,!0);if(d.isCubemap){const p=d.mipmaps.length/d.mipmapCount;for(let g=0;g<p;g++){a[g]={mipmaps:[]};for(let x=0;x<d.mipmapCount;x++)a[g].mipmaps.push(d.mipmaps[g*d.mipmapCount+x]),a[g].format=d.format,a[g].width=d.width,a[g].height=d.height}o.image=a}else o.image.width=d.width,o.image.height=d.height,o.mipmaps=d.mipmaps;d.mipmapCount===1&&(o.minFilter=hs),o.format=d.format,o.needsUpdate=!0,i&&i(o)},n,r);return o}}class rw extends _o{constructor(t){super(t)}load(t,i,n,r){this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const s=this,a=Nf.get(t);if(a!==void 0)return s.manager.itemStart(t),setTimeout(function(){i&&i(a),s.manager.itemEnd(t)},0),a;const o=ew("img");function l(){u(),Nf.add(t,this),i&&i(this),s.manager.itemEnd(t)}function c(h){u(),r&&r(h),s.manager.itemError(t),s.manager.itemEnd(t)}function u(){o.removeEventListener("load",l,!1),o.removeEventListener("error",c,!1)}return o.addEventListener("load",l,!1),o.addEventListener("error",c,!1),t.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),s.manager.itemStart(t),o.src=t,o}}class koe extends _o{constructor(t){super(t)}load(t,i,n,r){const s=new Gw;s.colorSpace=fo;const a=new rw(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let o=0;function l(c){a.load(t[c],function(u){s.images[c]=u,o++,o===6&&(s.needsUpdate=!0,i&&i(s))},void 0,r)}for(let c=0;c<t.length;++c)l(c);return s}}class joe extends _o{constructor(t){super(t)}load(t,i,n,r){const s=this,a=new hd,o=new ic(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(s.withCredentials),o.load(t,function(l){let c;try{c=s.parse(l)}catch(u){if(r!==void 0)r(u);else{console.error(u);return}}c.image!==void 0?a.image=c.image:c.data!==void 0&&(a.image.width=c.width,a.image.height=c.height,a.image.data=c.data),a.wrapS=c.wrapS!==void 0?c.wrapS:Zl,a.wrapT=c.wrapT!==void 0?c.wrapT:Zl,a.magFilter=c.magFilter!==void 0?c.magFilter:hs,a.minFilter=c.minFilter!==void 0?c.minFilter:hs,a.anisotropy=c.anisotropy!==void 0?c.anisotropy:1,c.colorSpace!==void 0&&(a.colorSpace=c.colorSpace),c.flipY!==void 0&&(a.flipY=c.flipY),c.format!==void 0&&(a.format=c.format),c.type!==void 0&&(a.type=c.type),c.mipmaps!==void 0&&(a.mipmaps=c.mipmaps,a.minFilter=kc),c.mipmapCount===1&&(a.minFilter=hs),c.generateMipmaps!==void 0&&(a.generateMipmaps=c.generateMipmaps),a.needsUpdate=!0,i&&i(a,c)},n,r),a}}class Jw extends _o{constructor(t){super(t)}load(t,i,n,r){const s=new vr,a=new rw(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(t,function(o){s.image=o,s.needsUpdate=!0,i!==void 0&&i(s)},n,r),s}}class ug extends gn{constructor(t,i=1){super(),this.isLight=!0,this.type="Light",this.color=new jt(t),this.intensity=i}dispose(){}copy(t,i){return super.copy(t,i),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const i=super.toJSON(t);return i.object.color=this.color.getHex(),i.object.intensity=this.intensity,this.groundColor!==void 0&&(i.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(i.object.distance=this.distance),this.angle!==void 0&&(i.object.angle=this.angle),this.decay!==void 0&&(i.object.decay=this.decay),this.penumbra!==void 0&&(i.object.penumbra=this.penumbra),this.shadow!==void 0&&(i.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(i.object.target=this.target.uuid),i}}class nQ extends ug{constructor(t,i,n){super(t,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(gn.DEFAULT_UP),this.updateMatrix(),this.groundColor=new jt(i)}copy(t,i){return super.copy(t,i),this.groundColor.copy(t.groundColor),this}}const NO=new di,tG=new me,iG=new me;class RF{constructor(t){this.camera=t,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Mt(512,512),this.mapType=Kc,this.map=null,this.mapPass=null,this.matrix=new di,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new yb,this._frameExtents=new Mt(1,1),this._viewportCount=1,this._viewports=[new Rn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const i=this.camera,n=this.matrix;tG.setFromMatrixPosition(t.matrixWorld),i.position.copy(tG),iG.setFromMatrixPosition(t.target.matrixWorld),i.lookAt(iG),i.updateMatrixWorld(),NO.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(NO),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(NO)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.intensity=t.intensity,this.bias=t.bias,this.radius=t.radius,this.autoUpdate=t.autoUpdate,this.needsUpdate=t.needsUpdate,this.normalBias=t.normalBias,this.blurSamples=t.blurSamples,this.mapSize.copy(t.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const t={};return this.intensity!==1&&(t.intensity=this.intensity),this.bias!==0&&(t.bias=this.bias),this.normalBias!==0&&(t.normalBias=this.normalBias),this.radius!==1&&(t.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class Woe extends RF{constructor(){super(new Dr(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(t){const i=this.camera,n=W1*2*t.angle*this.focus,r=this.mapSize.width/this.mapSize.height*this.aspect,s=t.distance||i.far;(n!==i.fov||r!==i.aspect||s!==i.far)&&(i.fov=n,i.aspect=r,i.far=s,i.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}class PF extends ug{constructor(t,i,n=0,r=Math.PI/3,s=0,a=2){super(t,i),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(gn.DEFAULT_UP),this.updateMatrix(),this.target=new gn,this.distance=n,this.angle=r,this.penumbra=s,this.decay=a,this.map=null,this.shadow=new Woe}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,i){return super.copy(t,i),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}const nG=new di,x_=new me,zO=new me;class Xoe extends RF{constructor(){super(new Dr(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Mt(4,2),this._viewportCount=6,this._viewports=[new Rn(2,1,1,1),new Rn(0,1,1,1),new Rn(3,1,1,1),new Rn(1,1,1,1),new Rn(3,0,1,1),new Rn(1,0,1,1)],this._cubeDirections=[new me(1,0,0),new me(-1,0,0),new me(0,0,1),new me(0,0,-1),new me(0,1,0),new me(0,-1,0)],this._cubeUps=[new me(0,1,0),new me(0,1,0),new me(0,1,0),new me(0,1,0),new me(0,0,1),new me(0,0,-1)]}updateMatrices(t,i=0){const n=this.camera,r=this.matrix,s=t.distance||n.far;s!==n.far&&(n.far=s,n.updateProjectionMatrix()),x_.setFromMatrixPosition(t.matrixWorld),n.position.copy(x_),zO.copy(n.position),zO.add(this._cubeDirections[i]),n.up.copy(this._cubeUps[i]),n.lookAt(zO),n.updateMatrixWorld(),r.makeTranslation(-x_.x,-x_.y,-x_.z),nG.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(nG)}}class OF extends ug{constructor(t,i,n=0,r=2){super(t,i),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new Xoe}get power(){return this.intensity*4*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,i){return super.copy(t,i),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}class Qu extends gR{constructor(t=-1,i=1,n=1,r=-1,s=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=i,this.top=n,this.bottom=r,this.near=s,this.far=a,this.updateProjectionMatrix()}copy(t,i){return super.copy(t,i),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this}setViewOffset(t,i,n,r,s,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=i,this.view.offsetX=n,this.view.offsetY=r,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),i=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let s=n-t,a=n+t,o=r+i,l=r-i;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=c*this.view.offsetX,a=s+c*this.view.width,o-=u*this.view.offsetY,l=o-u*this.view.height}this.projectionMatrix.makeOrthographic(s,a,o,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const i=super.toJSON(t);return i.object.zoom=this.zoom,i.object.left=this.left,i.object.right=this.right,i.object.top=this.top,i.object.bottom=this.bottom,i.object.near=this.near,i.object.far=this.far,this.view!==null&&(i.object.view=Object.assign({},this.view)),i}}class qoe extends RF{constructor(){super(new Qu(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class BF extends ug{constructor(t,i){super(t,i),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(gn.DEFAULT_UP),this.updateMatrix(),this.target=new gn,this.shadow=new qoe}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class rQ extends ug{constructor(t,i){super(t,i),this.isAmbientLight=!0,this.type="AmbientLight"}}class sQ extends ug{constructor(t,i,n=10,r=10){super(t,i),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const i=super.toJSON(t);return i.object.width=this.width,i.object.height=this.height,i}}class aQ{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new me)}set(t){for(let i=0;i<9;i++)this.coefficients[i].copy(t[i]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,i){const n=t.x,r=t.y,s=t.z,a=this.coefficients;return i.copy(a[0]).multiplyScalar(.282095),i.addScaledVector(a[1],.488603*r),i.addScaledVector(a[2],.488603*s),i.addScaledVector(a[3],.488603*n),i.addScaledVector(a[4],1.092548*(n*r)),i.addScaledVector(a[5],1.092548*(r*s)),i.addScaledVector(a[6],.315392*(3*s*s-1)),i.addScaledVector(a[7],1.092548*(n*s)),i.addScaledVector(a[8],.546274*(n*n-r*r)),i}getIrradianceAt(t,i){const n=t.x,r=t.y,s=t.z,a=this.coefficients;return i.copy(a[0]).multiplyScalar(.886227),i.addScaledVector(a[1],2*.511664*r),i.addScaledVector(a[2],2*.511664*s),i.addScaledVector(a[3],2*.511664*n),i.addScaledVector(a[4],2*.429043*n*r),i.addScaledVector(a[5],2*.429043*r*s),i.addScaledVector(a[6],.743125*s*s-.247708),i.addScaledVector(a[7],2*.429043*n*s),i.addScaledVector(a[8],.429043*(n*n-r*r)),i}add(t){for(let i=0;i<9;i++)this.coefficients[i].add(t.coefficients[i]);return this}addScaledSH(t,i){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(t.coefficients[n],i);return this}scale(t){for(let i=0;i<9;i++)this.coefficients[i].multiplyScalar(t);return this}lerp(t,i){for(let n=0;n<9;n++)this.coefficients[n].lerp(t.coefficients[n],i);return this}equals(t){for(let i=0;i<9;i++)if(!this.coefficients[i].equals(t.coefficients[i]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(t,i=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(t,i+r*3);return this}toArray(t=[],i=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(t,i+r*3);return t}static getBasisAt(t,i){const n=t.x,r=t.y,s=t.z;i[0]=.282095,i[1]=.488603*r,i[2]=.488603*s,i[3]=.488603*n,i[4]=1.092548*n*r,i[5]=1.092548*r*s,i[6]=.315392*(3*s*s-1),i[7]=1.092548*n*s,i[8]=.546274*(n*n-r*r)}}class oQ extends ug{constructor(t=new aQ,i=1){super(void 0,i),this.isLightProbe=!0,this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const i=super.toJSON(t);return i.object.sh=this.sh.toArray(),i}}class LR extends _o{constructor(t){super(t),this.textures={}}load(t,i,n,r){const s=this,a=new ic(s.manager);a.setPath(s.path),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(t,function(o){try{i(s.parse(JSON.parse(o)))}catch(l){r?r(l):console.error(l),s.manager.itemError(t)}},n,r)}parse(t){const i=this.textures;function n(s){return i[s]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",s),i[s]}const r=this.createMaterialFromType(t.type);if(t.uuid!==void 0&&(r.uuid=t.uuid),t.name!==void 0&&(r.name=t.name),t.color!==void 0&&r.color!==void 0&&r.color.setHex(t.color),t.roughness!==void 0&&(r.roughness=t.roughness),t.metalness!==void 0&&(r.metalness=t.metalness),t.sheen!==void 0&&(r.sheen=t.sheen),t.sheenColor!==void 0&&(r.sheenColor=new jt().setHex(t.sheenColor)),t.sheenRoughness!==void 0&&(r.sheenRoughness=t.sheenRoughness),t.emissive!==void 0&&r.emissive!==void 0&&r.emissive.setHex(t.emissive),t.specular!==void 0&&r.specular!==void 0&&r.specular.setHex(t.specular),t.specularIntensity!==void 0&&(r.specularIntensity=t.specularIntensity),t.specularColor!==void 0&&r.specularColor!==void 0&&r.specularColor.setHex(t.specularColor),t.shininess!==void 0&&(r.shininess=t.shininess),t.clearcoat!==void 0&&(r.clearcoat=t.clearcoat),t.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=t.clearcoatRoughness),t.dispersion!==void 0&&(r.dispersion=t.dispersion),t.iridescence!==void 0&&(r.iridescence=t.iridescence),t.iridescenceIOR!==void 0&&(r.iridescenceIOR=t.iridescenceIOR),t.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=t.iridescenceThicknessRange),t.transmission!==void 0&&(r.transmission=t.transmission),t.thickness!==void 0&&(r.thickness=t.thickness),t.attenuationDistance!==void 0&&(r.attenuationDistance=t.attenuationDistance),t.attenuationColor!==void 0&&r.attenuationColor!==void 0&&r.attenuationColor.setHex(t.attenuationColor),t.anisotropy!==void 0&&(r.anisotropy=t.anisotropy),t.anisotropyRotation!==void 0&&(r.anisotropyRotation=t.anisotropyRotation),t.fog!==void 0&&(r.fog=t.fog),t.flatShading!==void 0&&(r.flatShading=t.flatShading),t.blending!==void 0&&(r.blending=t.blending),t.combine!==void 0&&(r.combine=t.combine),t.side!==void 0&&(r.side=t.side),t.shadowSide!==void 0&&(r.shadowSide=t.shadowSide),t.opacity!==void 0&&(r.opacity=t.opacity),t.transparent!==void 0&&(r.transparent=t.transparent),t.alphaTest!==void 0&&(r.alphaTest=t.alphaTest),t.alphaHash!==void 0&&(r.alphaHash=t.alphaHash),t.depthFunc!==void 0&&(r.depthFunc=t.depthFunc),t.depthTest!==void 0&&(r.depthTest=t.depthTest),t.depthWrite!==void 0&&(r.depthWrite=t.depthWrite),t.colorWrite!==void 0&&(r.colorWrite=t.colorWrite),t.blendSrc!==void 0&&(r.blendSrc=t.blendSrc),t.blendDst!==void 0&&(r.blendDst=t.blendDst),t.blendEquation!==void 0&&(r.blendEquation=t.blendEquation),t.blendSrcAlpha!==void 0&&(r.blendSrcAlpha=t.blendSrcAlpha),t.blendDstAlpha!==void 0&&(r.blendDstAlpha=t.blendDstAlpha),t.blendEquationAlpha!==void 0&&(r.blendEquationAlpha=t.blendEquationAlpha),t.blendColor!==void 0&&r.blendColor!==void 0&&r.blendColor.setHex(t.blendColor),t.blendAlpha!==void 0&&(r.blendAlpha=t.blendAlpha),t.stencilWriteMask!==void 0&&(r.stencilWriteMask=t.stencilWriteMask),t.stencilFunc!==void 0&&(r.stencilFunc=t.stencilFunc),t.stencilRef!==void 0&&(r.stencilRef=t.stencilRef),t.stencilFuncMask!==void 0&&(r.stencilFuncMask=t.stencilFuncMask),t.stencilFail!==void 0&&(r.stencilFail=t.stencilFail),t.stencilZFail!==void 0&&(r.stencilZFail=t.stencilZFail),t.stencilZPass!==void 0&&(r.stencilZPass=t.stencilZPass),t.stencilWrite!==void 0&&(r.stencilWrite=t.stencilWrite),t.wireframe!==void 0&&(r.wireframe=t.wireframe),t.wireframeLinewidth!==void 0&&(r.wireframeLinewidth=t.wireframeLinewidth),t.wireframeLinecap!==void 0&&(r.wireframeLinecap=t.wireframeLinecap),t.wireframeLinejoin!==void 0&&(r.wireframeLinejoin=t.wireframeLinejoin),t.rotation!==void 0&&(r.rotation=t.rotation),t.linewidth!==void 0&&(r.linewidth=t.linewidth),t.dashSize!==void 0&&(r.dashSize=t.dashSize),t.gapSize!==void 0&&(r.gapSize=t.gapSize),t.scale!==void 0&&(r.scale=t.scale),t.polygonOffset!==void 0&&(r.polygonOffset=t.polygonOffset),t.polygonOffsetFactor!==void 0&&(r.polygonOffsetFactor=t.polygonOffsetFactor),t.polygonOffsetUnits!==void 0&&(r.polygonOffsetUnits=t.polygonOffsetUnits),t.dithering!==void 0&&(r.dithering=t.dithering),t.alphaToCoverage!==void 0&&(r.alphaToCoverage=t.alphaToCoverage),t.premultipliedAlpha!==void 0&&(r.premultipliedAlpha=t.premultipliedAlpha),t.forceSinglePass!==void 0&&(r.forceSinglePass=t.forceSinglePass),t.visible!==void 0&&(r.visible=t.visible),t.toneMapped!==void 0&&(r.toneMapped=t.toneMapped),t.userData!==void 0&&(r.userData=t.userData),t.vertexColors!==void 0&&(typeof t.vertexColors=="number"?r.vertexColors=t.vertexColors>0:r.vertexColors=t.vertexColors),t.uniforms!==void 0)for(const s in t.uniforms){const a=t.uniforms[s];switch(r.uniforms[s]={},a.type){case"t":r.uniforms[s].value=n(a.value);break;case"c":r.uniforms[s].value=new jt().setHex(a.value);break;case"v2":r.uniforms[s].value=new Mt().fromArray(a.value);break;case"v3":r.uniforms[s].value=new me().fromArray(a.value);break;case"v4":r.uniforms[s].value=new Rn().fromArray(a.value);break;case"m3":r.uniforms[s].value=new Ki().fromArray(a.value);break;case"m4":r.uniforms[s].value=new di().fromArray(a.value);break;default:r.uniforms[s].value=a.value}}if(t.defines!==void 0&&(r.defines=t.defines),t.vertexShader!==void 0&&(r.vertexShader=t.vertexShader),t.fragmentShader!==void 0&&(r.fragmentShader=t.fragmentShader),t.glslVersion!==void 0&&(r.glslVersion=t.glslVersion),t.extensions!==void 0)for(const s in t.extensions)r.extensions[s]=t.extensions[s];if(t.lights!==void 0&&(r.lights=t.lights),t.clipping!==void 0&&(r.clipping=t.clipping),t.size!==void 0&&(r.size=t.size),t.sizeAttenuation!==void 0&&(r.sizeAttenuation=t.sizeAttenuation),t.map!==void 0&&(r.map=n(t.map)),t.matcap!==void 0&&(r.matcap=n(t.matcap)),t.alphaMap!==void 0&&(r.alphaMap=n(t.alphaMap)),t.bumpMap!==void 0&&(r.bumpMap=n(t.bumpMap)),t.bumpScale!==void 0&&(r.bumpScale=t.bumpScale),t.normalMap!==void 0&&(r.normalMap=n(t.normalMap)),t.normalMapType!==void 0&&(r.normalMapType=t.normalMapType),t.normalScale!==void 0){let s=t.normalScale;Array.isArray(s)===!1&&(s=[s,s]),r.normalScale=new Mt().fromArray(s)}return t.displacementMap!==void 0&&(r.displacementMap=n(t.displacementMap)),t.displacementScale!==void 0&&(r.displacementScale=t.displacementScale),t.displacementBias!==void 0&&(r.displacementBias=t.displacementBias),t.roughnessMap!==void 0&&(r.roughnessMap=n(t.roughnessMap)),t.metalnessMap!==void 0&&(r.metalnessMap=n(t.metalnessMap)),t.emissiveMap!==void 0&&(r.emissiveMap=n(t.emissiveMap)),t.emissiveIntensity!==void 0&&(r.emissiveIntensity=t.emissiveIntensity),t.specularMap!==void 0&&(r.specularMap=n(t.specularMap)),t.specularIntensityMap!==void 0&&(r.specularIntensityMap=n(t.specularIntensityMap)),t.specularColorMap!==void 0&&(r.specularColorMap=n(t.specularColorMap)),t.envMap!==void 0&&(r.envMap=n(t.envMap)),t.envMapRotation!==void 0&&r.envMapRotation.fromArray(t.envMapRotation),t.envMapIntensity!==void 0&&(r.envMapIntensity=t.envMapIntensity),t.reflectivity!==void 0&&(r.reflectivity=t.reflectivity),t.refractionRatio!==void 0&&(r.refractionRatio=t.refractionRatio),t.lightMap!==void 0&&(r.lightMap=n(t.lightMap)),t.lightMapIntensity!==void 0&&(r.lightMapIntensity=t.lightMapIntensity),t.aoMap!==void 0&&(r.aoMap=n(t.aoMap)),t.aoMapIntensity!==void 0&&(r.aoMapIntensity=t.aoMapIntensity),t.gradientMap!==void 0&&(r.gradientMap=n(t.gradientMap)),t.clearcoatMap!==void 0&&(r.clearcoatMap=n(t.clearcoatMap)),t.clearcoatRoughnessMap!==void 0&&(r.clearcoatRoughnessMap=n(t.clearcoatRoughnessMap)),t.clearcoatNormalMap!==void 0&&(r.clearcoatNormalMap=n(t.clearcoatNormalMap)),t.clearcoatNormalScale!==void 0&&(r.clearcoatNormalScale=new Mt().fromArray(t.clearcoatNormalScale)),t.iridescenceMap!==void 0&&(r.iridescenceMap=n(t.iridescenceMap)),t.iridescenceThicknessMap!==void 0&&(r.iridescenceThicknessMap=n(t.iridescenceThicknessMap)),t.transmissionMap!==void 0&&(r.transmissionMap=n(t.transmissionMap)),t.thicknessMap!==void 0&&(r.thicknessMap=n(t.thicknessMap)),t.anisotropyMap!==void 0&&(r.anisotropyMap=n(t.anisotropyMap)),t.sheenColorMap!==void 0&&(r.sheenColorMap=n(t.sheenColorMap)),t.sheenRoughnessMap!==void 0&&(r.sheenRoughnessMap=n(t.sheenRoughnessMap)),r}setTextures(t){return this.textures=t,this}createMaterialFromType(t){return LR.createMaterialFromType(t)}static createMaterialFromType(t){const i={ShadowMaterial:jY,SpriteMaterial:dF,RawShaderMaterial:WY,ShaderMaterial:Ju,PointsMaterial:Ww,MeshPhysicalMaterial:eu,MeshStandardMaterial:Kw,MeshPhongMaterial:XY,MeshToonMaterial:qY,MeshNormalMaterial:YY,MeshLambertMaterial:QY,MeshDepthMaterial:wF,MeshDistanceMaterial:MF,MeshBasicMaterial:$l,MeshMatcapMaterial:KY,LineDashedMaterial:JY,LineBasicMaterial:So,Material:Js};return new i[t]}}class Wm{static extractUrlBase(t){const i=t.lastIndexOf("/");return i===-1?"./":t.slice(0,i+1)}static resolveURL(t,i){return typeof t!="string"||t===""?"":(/^https?:\/\//i.test(i)&&/^\//.test(t)&&(i=i.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:i+t)}}class lQ extends ki{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}toJSON(){const t=super.toJSON();return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}class cQ extends _o{constructor(t){super(t)}load(t,i,n,r){const s=this,a=new ic(s.manager);a.setPath(s.path),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(t,function(o){try{i(s.parse(JSON.parse(o)))}catch(l){r?r(l):console.error(l),s.manager.itemError(t)}},n,r)}parse(t){const i={},n={};function r(p,g){if(i[g]!==void 0)return i[g];const y=p.interleavedBuffers[g],b=s(p,y.buffer),A=s1(y.type,b),w=new kw(A,y.stride);return w.uuid=y.uuid,i[g]=w,w}function s(p,g){if(n[g]!==void 0)return n[g];const y=p.arrayBuffers[g],b=new Uint32Array(y).buffer;return n[g]=b,b}const a=t.isInstancedBufferGeometry?new lQ:new ki,o=t.data.index;if(o!==void 0){const p=s1(o.type,o.array);a.setIndex(new Pn(p,1))}const l=t.data.attributes;for(const p in l){const g=l[p];let x;if(g.isInterleavedBufferAttribute){const y=r(t.data,g.data);x=new eg(y,g.itemSize,g.offset,g.normalized)}else{const y=s1(g.type,g.array),b=g.isInstancedBufferAttribute?T0:Pn;x=new b(y,g.itemSize,g.normalized)}g.name!==void 0&&(x.name=g.name),g.usage!==void 0&&x.setUsage(g.usage),a.setAttribute(p,x)}const c=t.data.morphAttributes;if(c)for(const p in c){const g=c[p],x=[];for(let y=0,b=g.length;y<b;y++){const A=g[y];let w;if(A.isInterleavedBufferAttribute){const E=r(t.data,A.data);w=new eg(E,A.itemSize,A.offset,A.normalized)}else{const E=s1(A.type,A.array);w=new Pn(E,A.itemSize,A.normalized)}A.name!==void 0&&(w.name=A.name),x.push(w)}a.morphAttributes[p]=x}t.data.morphTargetsRelative&&(a.morphTargetsRelative=!0);const h=t.data.groups||t.data.drawcalls||t.data.offsets;if(h!==void 0)for(let p=0,g=h.length;p!==g;++p){const x=h[p];a.addGroup(x.start,x.count,x.materialIndex)}const d=t.data.boundingSphere;return d!==void 0&&(a.boundingSphere=new Sa().fromJSON(d)),t.name&&(a.name=t.name),t.userData&&(a.userData=t.userData),a}}class Yoe extends _o{constructor(t){super(t)}load(t,i,n,r){const s=this,a=this.path===""?Wm.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||a;const o=new ic(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,function(l){let c=null;try{c=JSON.parse(l)}catch(h){r!==void 0&&r(h),console.error("THREE:ObjectLoader: Can't parse "+t+".",h.message);return}const u=c.metadata;if(u===void 0||u.type===void 0||u.type.toLowerCase()==="geometry"){r!==void 0&&r(new Error("THREE.ObjectLoader: Can't load "+t)),console.error("THREE.ObjectLoader: Can't load "+t);return}s.parse(c,i)},n,r)}async loadAsync(t,i){const n=this,r=this.path===""?Wm.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||r;const s=new ic(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials);const a=await s.loadAsync(t,i),o=JSON.parse(a),l=o.metadata;if(l===void 0||l.type===void 0||l.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+t);return await n.parseAsync(o)}parse(t,i){const n=this.parseAnimations(t.animations),r=this.parseShapes(t.shapes),s=this.parseGeometries(t.geometries,r),a=this.parseImages(t.images,function(){i!==void 0&&i(c)}),o=this.parseTextures(t.textures,a),l=this.parseMaterials(t.materials,o),c=this.parseObject(t.object,s,l,o,n),u=this.parseSkeletons(t.skeletons,c);if(this.bindSkeletons(c,u),this.bindLightTargets(c),i!==void 0){let h=!1;for(const d in a)if(a[d].data instanceof HTMLImageElement){h=!0;break}h===!1&&i(c)}return c}async parseAsync(t){const i=this.parseAnimations(t.animations),n=this.parseShapes(t.shapes),r=this.parseGeometries(t.geometries,n),s=await this.parseImagesAsync(t.images),a=this.parseTextures(t.textures,s),o=this.parseMaterials(t.materials,a),l=this.parseObject(t.object,r,o,a,i),c=this.parseSkeletons(t.skeletons,l);return this.bindSkeletons(l,c),this.bindLightTargets(l),l}parseShapes(t){const i={};if(t!==void 0)for(let n=0,r=t.length;n<r;n++){const s=new g0().fromJSON(t[n]);i[s.uuid]=s}return i}parseSkeletons(t,i){const n={},r={};if(i.traverse(function(s){s.isBone&&(r[s.uuid]=s)}),t!==void 0)for(let s=0,a=t.length;s<a;s++){const o=new jw().fromJSON(t[s],r);n[o.uuid]=o}return n}parseGeometries(t,i){const n={};if(t!==void 0){const r=new cQ;for(let s=0,a=t.length;s<a;s++){let o;const l=t[s];switch(l.type){case"BufferGeometry":case"InstancedBufferGeometry":o=r.parse(l);break;default:l.type in eG?o=eG[l.type].fromJSON(l,i):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${l.type}"`)}o.uuid=l.uuid,l.name!==void 0&&(o.name=l.name),l.userData!==void 0&&(o.userData=l.userData),n[l.uuid]=o}}return n}parseMaterials(t,i){const n={},r={};if(t!==void 0){const s=new LR;s.setTextures(i);for(let a=0,o=t.length;a<o;a++){const l=t[a];n[l.uuid]===void 0&&(n[l.uuid]=s.parse(l)),r[l.uuid]=n[l.uuid]}}return r}parseAnimations(t){const i={};if(t!==void 0)for(let n=0;n<t.length;n++){const r=t[n],s=Q1.parse(r);i[s.uuid]=s}return i}parseImages(t,i){const n=this,r={};let s;function a(l){return n.manager.itemStart(l),s.load(l,function(){n.manager.itemEnd(l)},void 0,function(){n.manager.itemError(l),n.manager.itemEnd(l)})}function o(l){if(typeof l=="string"){const c=l,u=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c)?c:n.resourcePath+c;return a(u)}else return l.data?{data:s1(l.type,l.data),width:l.width,height:l.height}:null}if(t!==void 0&&t.length>0){const l=new DF(i);s=new rw(l),s.setCrossOrigin(this.crossOrigin);for(let c=0,u=t.length;c<u;c++){const h=t[c],d=h.url;if(Array.isArray(d)){const p=[];for(let g=0,x=d.length;g<x;g++){const y=d[g],b=o(y);b!==null&&(b instanceof HTMLImageElement?p.push(b):p.push(new hd(b.data,b.width,b.height)))}r[h.uuid]=new Lm(p)}else{const p=o(h.url);r[h.uuid]=new Lm(p)}}}return r}async parseImagesAsync(t){const i=this,n={};let r;async function s(a){if(typeof a=="string"){const o=a,l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(o)?o:i.resourcePath+o;return await r.loadAsync(l)}else return a.data?{data:s1(a.type,a.data),width:a.width,height:a.height}:null}if(t!==void 0&&t.length>0){r=new rw(this.manager),r.setCrossOrigin(this.crossOrigin);for(let a=0,o=t.length;a<o;a++){const l=t[a],c=l.url;if(Array.isArray(c)){const u=[];for(let h=0,d=c.length;h<d;h++){const p=c[h],g=await s(p);g!==null&&(g instanceof HTMLImageElement?u.push(g):u.push(new hd(g.data,g.width,g.height)))}n[l.uuid]=new Lm(u)}else{const u=await s(l.url);n[l.uuid]=new Lm(u)}}}return n}parseTextures(t,i){function n(s,a){return typeof s=="number"?s:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",s),a[s])}const r={};if(t!==void 0)for(let s=0,a=t.length;s<a;s++){const o=t[s];o.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),i[o.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",o.image);const l=i[o.image],c=l.data;let u;Array.isArray(c)?(u=new Gw,c.length===6&&(u.needsUpdate=!0)):(c&&c.data?u=new hd:u=new vr,c&&(u.needsUpdate=!0)),u.source=l,u.uuid=o.uuid,o.name!==void 0&&(u.name=o.name),o.mapping!==void 0&&(u.mapping=n(o.mapping,Qoe)),o.channel!==void 0&&(u.channel=o.channel),o.offset!==void 0&&u.offset.fromArray(o.offset),o.repeat!==void 0&&u.repeat.fromArray(o.repeat),o.center!==void 0&&u.center.fromArray(o.center),o.rotation!==void 0&&(u.rotation=o.rotation),o.wrap!==void 0&&(u.wrapS=n(o.wrap[0],rG),u.wrapT=n(o.wrap[1],rG)),o.format!==void 0&&(u.format=o.format),o.internalFormat!==void 0&&(u.internalFormat=o.internalFormat),o.type!==void 0&&(u.type=o.type),o.colorSpace!==void 0&&(u.colorSpace=o.colorSpace),o.minFilter!==void 0&&(u.minFilter=n(o.minFilter,sG)),o.magFilter!==void 0&&(u.magFilter=n(o.magFilter,sG)),o.anisotropy!==void 0&&(u.anisotropy=o.anisotropy),o.flipY!==void 0&&(u.flipY=o.flipY),o.generateMipmaps!==void 0&&(u.generateMipmaps=o.generateMipmaps),o.premultiplyAlpha!==void 0&&(u.premultiplyAlpha=o.premultiplyAlpha),o.unpackAlignment!==void 0&&(u.unpackAlignment=o.unpackAlignment),o.compareFunction!==void 0&&(u.compareFunction=o.compareFunction),o.userData!==void 0&&(u.userData=o.userData),r[o.uuid]=u}return r}parseObject(t,i,n,r,s){let a;function o(d){return i[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",d),i[d]}function l(d){if(d!==void 0){if(Array.isArray(d)){const p=[];for(let g=0,x=d.length;g<x;g++){const y=d[g];n[y]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",y),p.push(n[y])}return p}return n[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",d),n[d]}}function c(d){return r[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",d),r[d]}let u,h;switch(t.type){case"Scene":a=new hF,t.background!==void 0&&(Number.isInteger(t.background)?a.background=new jt(t.background):a.background=c(t.background)),t.environment!==void 0&&(a.environment=c(t.environment)),t.fog!==void 0&&(t.fog.type==="Fog"?a.fog=new yR(t.fog.color,t.fog.near,t.fog.far):t.fog.type==="FogExp2"&&(a.fog=new vR(t.fog.color,t.fog.density)),t.fog.name!==""&&(a.fog.name=t.fog.name)),t.backgroundBlurriness!==void 0&&(a.backgroundBlurriness=t.backgroundBlurriness),t.backgroundIntensity!==void 0&&(a.backgroundIntensity=t.backgroundIntensity),t.backgroundRotation!==void 0&&a.backgroundRotation.fromArray(t.backgroundRotation),t.environmentIntensity!==void 0&&(a.environmentIntensity=t.environmentIntensity),t.environmentRotation!==void 0&&a.environmentRotation.fromArray(t.environmentRotation);break;case"PerspectiveCamera":a=new Dr(t.fov,t.aspect,t.near,t.far),t.focus!==void 0&&(a.focus=t.focus),t.zoom!==void 0&&(a.zoom=t.zoom),t.filmGauge!==void 0&&(a.filmGauge=t.filmGauge),t.filmOffset!==void 0&&(a.filmOffset=t.filmOffset),t.view!==void 0&&(a.view=Object.assign({},t.view));break;case"OrthographicCamera":a=new Qu(t.left,t.right,t.top,t.bottom,t.near,t.far),t.zoom!==void 0&&(a.zoom=t.zoom),t.view!==void 0&&(a.view=Object.assign({},t.view));break;case"AmbientLight":a=new rQ(t.color,t.intensity);break;case"DirectionalLight":a=new BF(t.color,t.intensity),a.target=t.target||"";break;case"PointLight":a=new OF(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":a=new sQ(t.color,t.intensity,t.width,t.height);break;case"SpotLight":a=new PF(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay),a.target=t.target||"";break;case"HemisphereLight":a=new nQ(t.color,t.groundColor,t.intensity);break;case"LightProbe":a=new oQ().fromJSON(t);break;case"SkinnedMesh":u=o(t.geometry),h=l(t.material),a=new fF(u,h),t.bindMode!==void 0&&(a.bindMode=t.bindMode),t.bindMatrix!==void 0&&a.bindMatrix.fromArray(t.bindMatrix),t.skeleton!==void 0&&(a.skeleton=t.skeleton);break;case"Mesh":u=o(t.geometry),h=l(t.material),a=new ts(u,h);break;case"InstancedMesh":u=o(t.geometry),h=l(t.material);const d=t.count,p=t.instanceMatrix,g=t.instanceColor;a=new pF(u,h,d),a.instanceMatrix=new T0(new Float32Array(p.array),16),g!==void 0&&(a.instanceColor=new T0(new Float32Array(g.array),g.itemSize));break;case"BatchedMesh":u=o(t.geometry),h=l(t.material),a=new PY(t.maxInstanceCount,t.maxVertexCount,t.maxIndexCount,h),a.geometry=u,a.perObjectFrustumCulled=t.perObjectFrustumCulled,a.sortObjects=t.sortObjects,a._drawRanges=t.drawRanges,a._reservedRanges=t.reservedRanges,a._geometryInfo=t.geometryInfo.map(x=>{let y=null,b=null;return x.boundingBox!==void 0&&(y=new Ya().fromJSON(x.boundingBox)),x.boundingSphere!==void 0&&(b=new Sa().fromJSON(x.boundingSphere)),{...x,boundingBox:y,boundingSphere:b}}),a._instanceInfo=t.instanceInfo,a._availableInstanceIds=t._availableInstanceIds,a._availableGeometryIds=t._availableGeometryIds,a._nextIndexStart=t.nextIndexStart,a._nextVertexStart=t.nextVertexStart,a._geometryCount=t.geometryCount,a._maxInstanceCount=t.maxInstanceCount,a._maxVertexCount=t.maxVertexCount,a._maxIndexCount=t.maxIndexCount,a._geometryInitialized=t.geometryInitialized,a._matricesTexture=c(t.matricesTexture.uuid),a._indirectTexture=c(t.indirectTexture.uuid),t.colorsTexture!==void 0&&(a._colorsTexture=c(t.colorsTexture.uuid)),t.boundingSphere!==void 0&&(a.boundingSphere=new Sa().fromJSON(t.boundingSphere)),t.boundingBox!==void 0&&(a.boundingBox=new Ya().fromJSON(t.boundingBox));break;case"LOD":a=new RY;break;case"Line":a=new $f(o(t.geometry),l(t.material));break;case"LineLoop":a=new mF(o(t.geometry),l(t.material));break;case"LineSegments":a=new ih(o(t.geometry),l(t.material));break;case"PointCloud":case"Points":a=new gF(o(t.geometry),l(t.material));break;case"Sprite":a=new DY(l(t.material));break;case"Group":a=new Uf;break;case"Bone":a=new xR;break;default:a=new gn}if(a.uuid=t.uuid,t.name!==void 0&&(a.name=t.name),t.matrix!==void 0?(a.matrix.fromArray(t.matrix),t.matrixAutoUpdate!==void 0&&(a.matrixAutoUpdate=t.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(t.position!==void 0&&a.position.fromArray(t.position),t.rotation!==void 0&&a.rotation.fromArray(t.rotation),t.quaternion!==void 0&&a.quaternion.fromArray(t.quaternion),t.scale!==void 0&&a.scale.fromArray(t.scale)),t.up!==void 0&&a.up.fromArray(t.up),t.castShadow!==void 0&&(a.castShadow=t.castShadow),t.receiveShadow!==void 0&&(a.receiveShadow=t.receiveShadow),t.shadow&&(t.shadow.intensity!==void 0&&(a.shadow.intensity=t.shadow.intensity),t.shadow.bias!==void 0&&(a.shadow.bias=t.shadow.bias),t.shadow.normalBias!==void 0&&(a.shadow.normalBias=t.shadow.normalBias),t.shadow.radius!==void 0&&(a.shadow.radius=t.shadow.radius),t.shadow.mapSize!==void 0&&a.shadow.mapSize.fromArray(t.shadow.mapSize),t.shadow.camera!==void 0&&(a.shadow.camera=this.parseObject(t.shadow.camera))),t.visible!==void 0&&(a.visible=t.visible),t.frustumCulled!==void 0&&(a.frustumCulled=t.frustumCulled),t.renderOrder!==void 0&&(a.renderOrder=t.renderOrder),t.userData!==void 0&&(a.userData=t.userData),t.layers!==void 0&&(a.layers.mask=t.layers),t.children!==void 0){const d=t.children;for(let p=0;p<d.length;p++)a.add(this.parseObject(d[p],i,n,r,s))}if(t.animations!==void 0){const d=t.animations;for(let p=0;p<d.length;p++){const g=d[p];a.animations.push(s[g])}}if(t.type==="LOD"){t.autoUpdate!==void 0&&(a.autoUpdate=t.autoUpdate);const d=t.levels;for(let p=0;p<d.length;p++){const g=d[p],x=a.getObjectByProperty("uuid",g.object);x!==void 0&&a.addLevel(x,g.distance,g.hysteresis)}}return a}bindSkeletons(t,i){Object.keys(i).length!==0&&t.traverse(function(n){if(n.isSkinnedMesh===!0&&n.skeleton!==void 0){const r=i[n.skeleton];r===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",n.skeleton):n.bind(r,n.bindMatrix)}})}bindLightTargets(t){t.traverse(function(i){if(i.isDirectionalLight||i.isSpotLight){const n=i.target,r=t.getObjectByProperty("uuid",n);r!==void 0?i.target=r:i.target=new gn}})}}const Qoe={UVMapping:sR,CubeReflectionMapping:Jf,CubeRefractionMapping:Jm,EquirectangularReflectionMapping:YA,EquirectangularRefractionMapping:QA,CubeUVReflectionMapping:gb},rG={RepeatWrapping:Zm,ClampToEdgeWrapping:Zl,MirroredRepeatWrapping:z1},sG={NearestFilter:xa,NearestMipmapNearestFilter:aR,NearestMipmapLinearFilter:Jv,LinearFilter:hs,LinearMipmapNearestFilter:b1,LinearMipmapLinearFilter:kc},FO=new WeakMap;class uQ extends _o{constructor(t){super(t),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,i,n,r){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const s=this,a=Nf.get(t);if(a!==void 0){if(s.manager.itemStart(t),a.then){a.then(c=>{if(FO.has(a)===!0)r&&r(FO.get(a)),s.manager.itemError(t),s.manager.itemEnd(t);else return i&&i(c),s.manager.itemEnd(t),c});return}return setTimeout(function(){i&&i(a),s.manager.itemEnd(t)},0),a}const o={};o.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",o.headers=this.requestHeader;const l=fetch(t,o).then(function(c){return c.blob()}).then(function(c){return createImageBitmap(c,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(c){return Nf.add(t,c),i&&i(c),s.manager.itemEnd(t),c}).catch(function(c){r&&r(c),FO.set(l,c),Nf.remove(t),s.manager.itemError(t),s.manager.itemEnd(t)});Nf.add(t,l),s.manager.itemStart(t)}}let B2,IF=class{static getContext(){return B2===void 0&&(B2=new(window.AudioContext||window.webkitAudioContext)),B2}static setContext(t){B2=t}};class Koe extends _o{constructor(t){super(t)}load(t,i,n,r){const s=this,a=new ic(this.manager);a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,function(l){try{const c=l.slice(0);IF.getContext().decodeAudioData(c,function(h){i(h)}).catch(o)}catch(c){o(c)}},n,r);function o(l){r?r(l):console.error(l),s.manager.itemError(t)}}}const aG=new di,oG=new di,mv=new di;class Joe{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Dr,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Dr,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(t){const i=this._cache;if(i.focus!==t.focus||i.fov!==t.fov||i.aspect!==t.aspect*this.aspect||i.near!==t.near||i.far!==t.far||i.zoom!==t.zoom||i.eyeSep!==this.eyeSep){i.focus=t.focus,i.fov=t.fov,i.aspect=t.aspect*this.aspect,i.near=t.near,i.far=t.far,i.zoom=t.zoom,i.eyeSep=this.eyeSep,mv.copy(t.projectionMatrix);const r=i.eyeSep/2,s=r*i.near/i.focus,a=i.near*Math.tan(m0*i.fov*.5)/i.zoom;let o,l;oG.elements[12]=-r,aG.elements[12]=r,o=-a*i.aspect+s,l=a*i.aspect+s,mv.elements[0]=2*i.near/(l-o),mv.elements[8]=(l+o)/(l-o),this.cameraL.projectionMatrix.copy(mv),o=-a*i.aspect-s,l=a*i.aspect-s,mv.elements[0]=2*i.near/(l-o),mv.elements[8]=(l+o)/(l-o),this.cameraR.projectionMatrix.copy(mv)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(oG),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(aG)}}class hQ extends Dr{constructor(t=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=t}}class LF{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=lG(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const i=lG();t=(i-this.oldTime)/1e3,this.oldTime=i,this.elapsedTime+=t}return t}}function lG(){return performance.now()}const gv=new me,VO=new ba,Zoe=new me,vv=new me,yv=new me;class $oe extends gn{constructor(){super(),this.type="AudioListener",this.context=IF.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new LF}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(t){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}updateMatrixWorld(t){super.updateMatrixWorld(t);const i=this.context.listener;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(gv,VO,Zoe),vv.set(0,0,-1).applyQuaternion(VO),yv.set(0,1,0).applyQuaternion(VO),i.positionX){const n=this.context.currentTime+this.timeDelta;i.positionX.linearRampToValueAtTime(gv.x,n),i.positionY.linearRampToValueAtTime(gv.y,n),i.positionZ.linearRampToValueAtTime(gv.z,n),i.forwardX.linearRampToValueAtTime(vv.x,n),i.forwardY.linearRampToValueAtTime(vv.y,n),i.forwardZ.linearRampToValueAtTime(vv.z,n),i.upX.linearRampToValueAtTime(yv.x,n),i.upY.linearRampToValueAtTime(yv.y,n),i.upZ.linearRampToValueAtTime(yv.z,n)}else i.setPosition(gv.x,gv.y,gv.z),i.setOrientation(vv.x,vv.y,vv.z,yv.x,yv.y,yv.z)}}class dQ extends gn{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+t;const i=this.context.createBufferSource();return i.buffer=this.buffer,i.loop=this.loop,i.loopStart=this.loopStart,i.loopEnd=this.loopEnd,i.onended=this.onEnded.bind(this),i.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=i,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(t=0){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(this.context.currentTime+t),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,i=this.filters.length;t<i;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,i=this.filters.length;t<i;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(t){return t||(t=[]),this._connected===!0?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){return this.detune=t,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=t,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1,this._progress=0}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=t,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}copy(t,i){return super.copy(t,i),t.sourceType!=="buffer"?(console.warn("THREE.Audio: Audio source type cannot be copied."),this):(this.autoplay=t.autoplay,this.buffer=t.buffer,this.detune=t.detune,this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this.offset=t.offset,this.duration=t.duration,this.playbackRate=t.playbackRate,this.hasPlaybackControl=t.hasPlaybackControl,this.sourceType=t.sourceType,this.filters=t.filters.slice(),this)}clone(t){return new this.constructor(this.listener).copy(this,t)}}const xv=new me,cG=new ba,ele=new me,bv=new me;class tle extends dQ{constructor(t){super(t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){return super.connect(),this.panner.connect(this.gain),this}disconnect(){return super.disconnect(),this.panner.disconnect(this.gain),this}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(t){return this.panner.refDistance=t,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(t){return this.panner.rolloffFactor=t,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(t){return this.panner.distanceModel=t,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(t){return this.panner.maxDistance=t,this}setDirectionalCone(t,i,n){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=i,this.panner.coneOuterGain=n,this}updateMatrixWorld(t){if(super.updateMatrixWorld(t),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(xv,cG,ele),bv.set(0,0,1).applyQuaternion(cG);const i=this.panner;if(i.positionX){const n=this.context.currentTime+this.listener.timeDelta;i.positionX.linearRampToValueAtTime(xv.x,n),i.positionY.linearRampToValueAtTime(xv.y,n),i.positionZ.linearRampToValueAtTime(xv.z,n),i.orientationX.linearRampToValueAtTime(bv.x,n),i.orientationY.linearRampToValueAtTime(bv.y,n),i.orientationZ.linearRampToValueAtTime(bv.z,n)}else i.setPosition(xv.x,xv.y,xv.z),i.setOrientation(bv.x,bv.y,bv.z)}}class ile{constructor(t,i=2048){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=i,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;const i=this.getFrequencyData();for(let n=0;n<i.length;n++)t+=i[n];return t/i.length}}class fQ{constructor(t,i,n){this.binding=t,this.valueSize=n;let r,s,a;switch(i){case"quaternion":r=this._slerp,s=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(n*6),this._workIndex=5;break;case"string":case"bool":r=this._select,s=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(n*5);break;default:r=this._lerp,s=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(n*5)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=s,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,i){const n=this.buffer,r=this.valueSize,s=t*r+r;let a=this.cumulativeWeight;if(a===0){for(let o=0;o!==r;++o)n[s+o]=n[o];a=i}else{a+=i;const o=i/a;this._mixBufferRegion(n,s,0,o,r)}this.cumulativeWeight=a}accumulateAdditive(t){const i=this.buffer,n=this.valueSize,r=n*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(i,r,0,t,n),this.cumulativeWeightAdditive+=t}apply(t){const i=this.valueSize,n=this.buffer,r=t*i+i,s=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const l=i*this._origIndex;this._mixBufferRegion(n,r,l,1-s,i)}a>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*i,1,i);for(let l=i,c=i+i;l!==c;++l)if(n[l]!==n[l+i]){o.setValue(n,r);break}}saveOriginalState(){const t=this.binding,i=this.buffer,n=this.valueSize,r=n*this._origIndex;t.getValue(i,r);for(let s=n,a=r;s!==a;++s)i[s]=i[r+s%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=this.valueSize*3;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,i=t+this.valueSize;for(let n=t;n<i;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,i=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[i+n]=this.buffer[t+n]}_select(t,i,n,r,s){if(r>=.5)for(let a=0;a!==s;++a)t[i+a]=t[n+a]}_slerp(t,i,n,r){ba.slerpFlat(t,i,t,i,t,n,r)}_slerpAdditive(t,i,n,r,s){const a=this._workIndex*s;ba.multiplyQuaternionsFlat(t,a,t,i,t,n),ba.slerpFlat(t,i,t,i,t,a,r)}_lerp(t,i,n,r,s){const a=1-r;for(let o=0;o!==s;++o){const l=i+o;t[l]=t[l]*a+t[n+o]*r}}_lerpAdditive(t,i,n,r,s){for(let a=0;a!==s;++a){const o=i+a;t[o]=t[o]+t[n+a]*r}}}const UF="\\[\\]\\.:\\/",nle=new RegExp("["+UF+"]","g"),NF="[^"+UF+"]",rle="[^"+UF.replace("\\.","")+"]",sle=/((?:WC+[\/:])*)/.source.replace("WC",NF),ale=/(WCOD+)?/.source.replace("WCOD",rle),ole=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",NF),lle=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",NF),cle=new RegExp("^"+sle+ale+ole+lle+"$"),ule=["material","materials","bones","map"];class hle{constructor(t,i,n){const r=n||Cn.parseTrackName(i);this._targetGroup=t,this._bindings=t.subscribe_(i,r)}getValue(t,i){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];r!==void 0&&r.getValue(t,i)}setValue(t,i){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,s=n.length;r!==s;++r)n[r].setValue(t,i)}bind(){const t=this._bindings;for(let i=this._targetGroup.nCachedObjects_,n=t.length;i!==n;++i)t[i].bind()}unbind(){const t=this._bindings;for(let i=this._targetGroup.nCachedObjects_,n=t.length;i!==n;++i)t[i].unbind()}}class Cn{constructor(t,i,n){this.path=i,this.parsedPath=n||Cn.parseTrackName(i),this.node=Cn.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,i,n){return t&&t.isAnimationObjectGroup?new Cn.Composite(t,i,n):new Cn(t,i,n)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(nle,"")}static parseTrackName(t){const i=cle.exec(t);if(i===null)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const n={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){const s=n.nodeName.substring(r+1);ule.indexOf(s)!==-1&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=s)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n}static findNode(t,i){if(i===void 0||i===""||i==="."||i===-1||i===t.name||i===t.uuid)return t;if(t.skeleton){const n=t.skeleton.getBoneByName(i);if(n!==void 0)return n}if(t.children){const n=function(s){for(let a=0;a<s.length;a++){const o=s[a];if(o.name===i||o.uuid===i)return o;const l=n(o.children);if(l)return l}return null},r=n(t.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,i){t[i]=this.targetObject[this.propertyName]}_getValue_array(t,i){const n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)t[i++]=n[r]}_getValue_arrayElement(t,i){t[i]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,i){this.resolvedProperty.toArray(t,i)}_setValue_direct(t,i){this.targetObject[this.propertyName]=t[i]}_setValue_direct_setNeedsUpdate(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,i){const n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)n[r]=t[i++]}_setValue_array_setNeedsUpdate(t,i){const n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)n[r]=t[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,i){const n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)n[r]=t[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,i){this.resolvedProperty[this.propertyIndex]=t[i]}_setValue_arrayElement_setNeedsUpdate(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,i){this.resolvedProperty.fromArray(t,i)}_setValue_fromArray_setNeedsUpdate(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,i){this.bind(),this.getValue(t,i)}_setValue_unbound(t,i){this.bind(),this.setValue(t,i)}bind(){let t=this.node;const i=this.parsedPath,n=i.objectName,r=i.propertyName;let s=i.propertyIndex;if(t||(t=Cn.findNode(this.rootNode,i.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(n){let c=i.objectIndex;switch(n){case"materials":if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}t=t.material.materials;break;case"bones":if(!t.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}t=t.skeleton.bones;for(let u=0;u<t.length;u++)if(t[u].name===c){c=u;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}t=t.material.map;break;default:if(t[n]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}t=t[n]}if(c!==void 0){if(t[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);return}t=t[c]}}const a=t[r];if(a===void 0){const c=i.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+r+" but it wasn't found.",t);return}let o=this.Versioning.None;this.targetObject=t,t.isMaterial===!0?o=this.Versioning.NeedsUpdate:t.isObject3D===!0&&(o=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(s!==void 0){if(r==="morphTargetInfluences"){if(!t.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!t.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}t.morphTargetDictionary[s]!==void 0&&(s=t.morphTargetDictionary[s])}l=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=s}else a.fromArray!==void 0&&a.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(l=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=r;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Cn.Composite=hle;Cn.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Cn.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Cn.prototype.GetterByBindingType=[Cn.prototype._getValue_direct,Cn.prototype._getValue_array,Cn.prototype._getValue_arrayElement,Cn.prototype._getValue_toArray];Cn.prototype.SetterByBindingTypeAndVersioning=[[Cn.prototype._setValue_direct,Cn.prototype._setValue_direct_setNeedsUpdate,Cn.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Cn.prototype._setValue_array,Cn.prototype._setValue_array_setNeedsUpdate,Cn.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Cn.prototype._setValue_arrayElement,Cn.prototype._setValue_arrayElement_setNeedsUpdate,Cn.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Cn.prototype._setValue_fromArray,Cn.prototype._setValue_fromArray_setNeedsUpdate,Cn.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class dle{constructor(){this.isAnimationObjectGroup=!0,this.uuid=tc(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let n=0,r=arguments.length;n!==r;++n)t[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const i=this;this.stats={objects:{get total(){return i._objects.length},get inUse(){return this.total-i.nCachedObjects_}},get bindingsPerObject(){return i._bindings.length}}}add(){const t=this._objects,i=this._indicesByUUID,n=this._paths,r=this._parsedPaths,s=this._bindings,a=s.length;let o,l=t.length,c=this.nCachedObjects_;for(let u=0,h=arguments.length;u!==h;++u){const d=arguments[u],p=d.uuid;let g=i[p];if(g===void 0){g=l++,i[p]=g,t.push(d);for(let x=0,y=a;x!==y;++x)s[x].push(new Cn(d,n[x],r[x]))}else if(g<c){o=t[g];const x=--c,y=t[x];i[y.uuid]=g,t[g]=y,i[p]=x,t[x]=d;for(let b=0,A=a;b!==A;++b){const w=s[b],E=w[x];let D=w[g];w[g]=E,D===void 0&&(D=new Cn(d,n[b],r[b])),w[x]=D}}else t[g]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c}remove(){const t=this._objects,i=this._indicesByUUID,n=this._bindings,r=n.length;let s=this.nCachedObjects_;for(let a=0,o=arguments.length;a!==o;++a){const l=arguments[a],c=l.uuid,u=i[c];if(u!==void 0&&u>=s){const h=s++,d=t[h];i[d.uuid]=u,t[u]=d,i[c]=h,t[h]=l;for(let p=0,g=r;p!==g;++p){const x=n[p],y=x[h],b=x[u];x[u]=y,x[h]=b}}}this.nCachedObjects_=s}uncache(){const t=this._objects,i=this._indicesByUUID,n=this._bindings,r=n.length;let s=this.nCachedObjects_,a=t.length;for(let o=0,l=arguments.length;o!==l;++o){const c=arguments[o],u=c.uuid,h=i[u];if(h!==void 0)if(delete i[u],h<s){const d=--s,p=t[d],g=--a,x=t[g];i[p.uuid]=h,t[h]=p,i[x.uuid]=d,t[d]=x,t.pop();for(let y=0,b=r;y!==b;++y){const A=n[y],w=A[d],E=A[g];A[h]=w,A[d]=E,A.pop()}}else{const d=--a,p=t[d];d>0&&(i[p.uuid]=h),t[h]=p,t.pop();for(let g=0,x=r;g!==x;++g){const y=n[g];y[h]=y[d],y.pop()}}}this.nCachedObjects_=s}subscribe_(t,i){const n=this._bindingsIndicesByPath;let r=n[t];const s=this._bindings;if(r!==void 0)return s[r];const a=this._paths,o=this._parsedPaths,l=this._objects,c=l.length,u=this.nCachedObjects_,h=new Array(c);r=s.length,n[t]=r,a.push(t),o.push(i),s.push(h);for(let d=u,p=l.length;d!==p;++d){const g=l[d];h[d]=new Cn(g,t,i)}return h}unsubscribe_(t){const i=this._bindingsIndicesByPath,n=i[t];if(n!==void 0){const r=this._paths,s=this._parsedPaths,a=this._bindings,o=a.length-1,l=a[o],c=t[o];i[c]=n,a[n]=l,a.pop(),s[n]=s[o],s.pop(),r[n]=r[o],r.pop()}}}class pQ{constructor(t,i,n=null,r=i.blendMode){this._mixer=t,this._clip=i,this._localRoot=n,this.blendMode=r;const s=i.tracks,a=s.length,o=new Array(a),l={endingStart:Zv,endingEnd:Zv};for(let c=0;c!==a;++c){const u=s[c].createInterpolant(null);o[c]=u,u.settings=l}this._interpolantSettings=l,this._interpolants=o,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=cY,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,i){return this.loop=t,this.repetitions=i,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,i,n=!1){if(t.fadeOut(i),this.fadeIn(i),n===!0){const r=this._clip.duration,s=t._clip.duration,a=s/r,o=r/s;t.warp(1,a,i),this.warp(o,1,i)}return this}crossFadeTo(t,i,n=!1){return t.crossFadeFrom(this,i,n)}stopFading(){const t=this._weightInterpolant;return t!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,i,n){const r=this._mixer,s=r.time,a=this.timeScale;let o=this._timeScaleInterpolant;o===null&&(o=r._lendControlInterpolant(),this._timeScaleInterpolant=o);const l=o.parameterPositions,c=o.sampleValues;return l[0]=s,l[1]=s+n,c[0]=t/a,c[1]=i/a,this}stopWarping(){const t=this._timeScaleInterpolant;return t!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,i,n,r){if(!this.enabled){this._updateWeight(t);return}const s=this._startTime;if(s!==null){const l=(t-s)*n;l<0||n===0?i=0:(this._startTime=null,i=n*l)}i*=this._updateTimeScale(t);const a=this._updateTime(i),o=this._updateWeight(t);if(o>0){const l=this._interpolants,c=this._propertyBindings;switch(this.blendMode){case tF:for(let u=0,h=l.length;u!==h;++u)l[u].evaluate(a),c[u].accumulateAdditive(o);break;case fR:default:for(let u=0,h=l.length;u!==h;++u)l[u].evaluate(a),c[u].accumulate(r,o)}}}_updateWeight(t){let i=0;if(this.enabled){i=this.weight;const n=this._weightInterpolant;if(n!==null){const r=n.evaluate(t)[0];i*=r,t>n.parameterPositions[1]&&(this.stopFading(),r===0&&(this.enabled=!1))}}return this._effectiveWeight=i,i}_updateTimeScale(t){let i=0;if(!this.paused){i=this.timeScale;const n=this._timeScaleInterpolant;if(n!==null){const r=n.evaluate(t)[0];i*=r,t>n.parameterPositions[1]&&(this.stopWarping(),i===0?this.paused=!0:this.timeScale=i)}}return this._effectiveTimeScale=i,i}_updateTime(t){const i=this._clip.duration,n=this.loop;let r=this.time+t,s=this._loopCount;const a=n===uY;if(t===0)return s===-1?r:a&&(s&1)===1?i-r:r;if(n===lY){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=i)r=i;else if(r<0)r=0;else{this.time=r;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(s===-1&&(t>=0?(s=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),r>=i||r<0){const o=Math.floor(r/i);r-=i*o,s+=Math.abs(o);const l=this.repetitions-s;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=t>0?i:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(l===1){const c=t<0;this._setEndings(c,!c,a)}else this._setEndings(!1,!1,a);this._loopCount=s,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=r;if(a&&(s&1)===1)return i-r}return r}_setEndings(t,i,n){const r=this._interpolantSettings;n?(r.endingStart=$v,r.endingEnd=$v):(t?r.endingStart=this.zeroSlopeAtStart?$v:Zv:r.endingStart=KA,i?r.endingEnd=this.zeroSlopeAtEnd?$v:Zv:r.endingEnd=KA)}_scheduleFading(t,i,n){const r=this._mixer,s=r.time;let a=this._weightInterpolant;a===null&&(a=r._lendControlInterpolant(),this._weightInterpolant=a);const o=a.parameterPositions,l=a.sampleValues;return o[0]=s,l[0]=i,o[1]=s+t,l[1]=n,this}}const fle=new Float32Array(1);class ple extends Cd{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,i){const n=t._localRoot||this._root,r=t._clip.tracks,s=r.length,a=t._propertyBindings,o=t._interpolants,l=n.uuid,c=this._bindingsByRootAndName;let u=c[l];u===void 0&&(u={},c[l]=u);for(let h=0;h!==s;++h){const d=r[h],p=d.name;let g=u[p];if(g!==void 0)++g.referenceCount,a[h]=g;else{if(g=a[h],g!==void 0){g._cacheIndex===null&&(++g.referenceCount,this._addInactiveBinding(g,l,p));continue}const x=i&&i._propertyBindings[h].binding.parsedPath;g=new fQ(Cn.create(n,p,x),d.ValueTypeName,d.getValueSize()),++g.referenceCount,this._addInactiveBinding(g,l,p),a[h]=g}o[h].resultBuffer=g.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(t._cacheIndex===null){const n=(t._localRoot||this._root).uuid,r=t._clip.uuid,s=this._actionsByClip[r];this._bindAction(t,s&&s.knownActions[0]),this._addInactiveAction(t,r,n)}const i=t._propertyBindings;for(let n=0,r=i.length;n!==r;++n){const s=i[n];s.useCount++===0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const i=t._propertyBindings;for(let n=0,r=i.length;n!==r;++n){const s=i[n];--s.useCount===0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const i=t._cacheIndex;return i!==null&&i<this._nActiveActions}_addInactiveAction(t,i,n){const r=this._actions,s=this._actionsByClip;let a=s[i];if(a===void 0)a={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,s[i]=a;else{const o=a.knownActions;t._byClipCacheIndex=o.length,o.push(t)}t._cacheIndex=r.length,r.push(t),a.actionByRoot[n]=t}_removeInactiveAction(t){const i=this._actions,n=i[i.length-1],r=t._cacheIndex;n._cacheIndex=r,i[r]=n,i.pop(),t._cacheIndex=null;const s=t._clip.uuid,a=this._actionsByClip,o=a[s],l=o.knownActions,c=l[l.length-1],u=t._byClipCacheIndex;c._byClipCacheIndex=u,l[u]=c,l.pop(),t._byClipCacheIndex=null;const h=o.actionByRoot,d=(t._localRoot||this._root).uuid;delete h[d],l.length===0&&delete a[s],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const i=t._propertyBindings;for(let n=0,r=i.length;n!==r;++n){const s=i[n];--s.referenceCount===0&&this._removeInactiveBinding(s)}}_lendAction(t){const i=this._actions,n=t._cacheIndex,r=this._nActiveActions++,s=i[r];t._cacheIndex=r,i[r]=t,s._cacheIndex=n,i[n]=s}_takeBackAction(t){const i=this._actions,n=t._cacheIndex,r=--this._nActiveActions,s=i[r];t._cacheIndex=r,i[r]=t,s._cacheIndex=n,i[n]=s}_addInactiveBinding(t,i,n){const r=this._bindingsByRootAndName,s=this._bindings;let a=r[i];a===void 0&&(a={},r[i]=a),a[n]=t,t._cacheIndex=s.length,s.push(t)}_removeInactiveBinding(t){const i=this._bindings,n=t.binding,r=n.rootNode.uuid,s=n.path,a=this._bindingsByRootAndName,o=a[r],l=i[i.length-1],c=t._cacheIndex;l._cacheIndex=c,i[c]=l,i.pop(),delete o[s],Object.keys(o).length===0&&delete a[r]}_lendBinding(t){const i=this._bindings,n=t._cacheIndex,r=this._nActiveBindings++,s=i[r];t._cacheIndex=r,i[r]=t,s._cacheIndex=n,i[n]=s}_takeBackBinding(t){const i=this._bindings,n=t._cacheIndex,r=--this._nActiveBindings,s=i[r];t._cacheIndex=r,i[r]=t,s._cacheIndex=n,i[n]=s}_lendControlInterpolant(){const t=this._controlInterpolants,i=this._nActiveControlInterpolants++;let n=t[i];return n===void 0&&(n=new TF(new Float32Array(2),new Float32Array(2),1,fle),n.__cacheIndex=i,t[i]=n),n}_takeBackControlInterpolant(t){const i=this._controlInterpolants,n=t.__cacheIndex,r=--this._nActiveControlInterpolants,s=i[r];t.__cacheIndex=r,i[r]=t,s.__cacheIndex=n,i[n]=s}clipAction(t,i,n){const r=i||this._root,s=r.uuid;let a=typeof t=="string"?Q1.findByName(r,t):t;const o=a!==null?a.uuid:t,l=this._actionsByClip[o];let c=null;if(n===void 0&&(a!==null?n=a.blendMode:n=fR),l!==void 0){const h=l.actionByRoot[s];if(h!==void 0&&h.blendMode===n)return h;c=l.knownActions[0],a===null&&(a=c._clip)}if(a===null)return null;const u=new pQ(this,a,i,n);return this._bindAction(u,c),this._addInactiveAction(u,o,s),u}existingAction(t,i){const n=i||this._root,r=n.uuid,s=typeof t=="string"?Q1.findByName(n,t):t,a=s?s.uuid:t,o=this._actionsByClip[a];return o!==void 0&&o.actionByRoot[r]||null}stopAllAction(){const t=this._actions,i=this._nActiveActions;for(let n=i-1;n>=0;--n)t[n].stop();return this}update(t){t*=this.timeScale;const i=this._actions,n=this._nActiveActions,r=this.time+=t,s=Math.sign(t),a=this._accuIndex^=1;for(let c=0;c!==n;++c)i[c]._update(r,t,s,a);const o=this._bindings,l=this._nActiveBindings;for(let c=0;c!==l;++c)o[c].apply(a);return this}setTime(t){this.time=0;for(let i=0;i<this._actions.length;i++)this._actions[i].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const i=this._actions,n=t.uuid,r=this._actionsByClip,s=r[n];if(s!==void 0){const a=s.knownActions;for(let o=0,l=a.length;o!==l;++o){const c=a[o];this._deactivateAction(c);const u=c._cacheIndex,h=i[i.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,h._cacheIndex=u,i[u]=h,i.pop(),this._removeInactiveBindingsForAction(c)}delete r[n]}}uncacheRoot(t){const i=t.uuid,n=this._actionsByClip;for(const a in n){const o=n[a].actionByRoot,l=o[i];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}const r=this._bindingsByRootAndName,s=r[i];if(s!==void 0)for(const a in s){const o=s[a];o.restoreOriginalState(),this._removeInactiveBinding(o)}}uncacheAction(t,i){const n=this.existingAction(t,i);n!==null&&(this._deactivateAction(n),this._removeInactiveAction(n))}}class mle extends aF{constructor(t=1,i=1,n=1,r={}){super(t,i,r),this.isRenderTarget3D=!0,this.depth=n,this.texture=new mR(null,t,i,n),this._setTextureOptions(r),this.texture.isRenderTargetTexture=!0}}class zF{constructor(t){this.value=t}clone(){return new zF(this.value.clone===void 0?this.value:this.value.clone())}}let gle=0;class vle extends Cd{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:gle++}),this.name="",this.usage=ZA,this.uniforms=[]}add(t){return this.uniforms.push(t),this}remove(t){const i=this.uniforms.indexOf(t);return i!==-1&&this.uniforms.splice(i,1),this}setName(t){return this.name=t,this}setUsage(t){return this.usage=t,this}dispose(){this.dispatchEvent({type:"dispose"})}copy(t){this.name=t.name,this.usage=t.usage;const i=t.uniforms;this.uniforms.length=0;for(let n=0,r=i.length;n<r;n++){const s=Array.isArray(i[n])?i[n]:[i[n]];for(let a=0;a<s.length;a++)this.uniforms.push(s[a].clone())}return this}clone(){return new this.constructor().copy(this)}}class yle extends kw{constructor(t,i,n=1){super(t,i),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const i=super.clone(t);return i.meshPerAttribute=this.meshPerAttribute,i}toJSON(t){const i=super.toJSON(t);return i.isInstancedInterleavedBuffer=!0,i.meshPerAttribute=this.meshPerAttribute,i}}class xle{constructor(t,i,n,r,s){this.isGLBufferAttribute=!0,this.name="",this.buffer=t,this.type=i,this.itemSize=n,this.elementSize=r,this.count=s,this.version=0}set needsUpdate(t){t===!0&&this.version++}setBuffer(t){return this.buffer=t,this}setType(t,i){return this.type=t,this.elementSize=i,this}setItemSize(t){return this.itemSize=t,this}setCount(t){return this.count=t,this}}const uG=new di;class mQ{constructor(t,i,n=0,r=1/0){this.ray=new k0(t,i),this.near=n,this.far=r,this.camera=null,this.layers=new X1,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,i){this.ray.set(t,i)}setFromCamera(t,i){i.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(i.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(i).sub(this.ray.origin).normalize(),this.camera=i):i.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(i.near+i.far)/(i.near-i.far)).unproject(i),this.ray.direction.set(0,0,-1).transformDirection(i.matrixWorld),this.camera=i):console.error("THREE.Raycaster: Unsupported camera type: "+i.type)}setFromXRController(t){return uG.identity().extractRotation(t.matrixWorld),this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(uG),this}intersectObject(t,i=!0,n=[]){return nU(t,this,n,i),n.sort(hG),n}intersectObjects(t,i=!0,n=[]){for(let r=0,s=t.length;r<s;r++)nU(t[r],this,n,i);return n.sort(hG),n}}function hG(e,t){return e.distance-t.distance}function nU(e,t,i,n){let r=!0;if(e.layers.test(t.layers)&&e.raycast(t,i)===!1&&(r=!1),r===!0&&n===!0){const s=e.children;for(let a=0,o=s.length;a<o;a++)nU(s[a],t,i,!0)}}class rU{constructor(t=1,i=0,n=0){this.radius=t,this.phi=i,this.theta=n}set(t,i,n){return this.radius=t,this.phi=i,this.theta=n,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){return this.phi=qi(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,i,n){return this.radius=Math.sqrt(t*t+i*i+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,n),this.phi=Math.acos(qi(i/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class ble{constructor(t=1,i=0,n=0){this.radius=t,this.theta=i,this.y=n}set(t,i,n){return this.radius=t,this.theta=i,this.y=n,this}copy(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,i,n){return this.radius=Math.sqrt(t*t+n*n),this.theta=Math.atan2(t,n),this.y=i,this}clone(){return new this.constructor().copy(this)}}class FF{constructor(t,i,n,r){FF.prototype.isMatrix2=!0,this.elements=[1,0,0,1],t!==void 0&&this.set(t,i,n,r)}identity(){return this.set(1,0,0,1),this}fromArray(t,i=0){for(let n=0;n<4;n++)this.elements[n]=t[n+i];return this}set(t,i,n,r){const s=this.elements;return s[0]=t,s[2]=i,s[1]=n,s[3]=r,this}}const dG=new Mt;class Sle{constructor(t=new Mt(1/0,1/0),i=new Mt(-1/0,-1/0)){this.isBox2=!0,this.min=t,this.max=i}set(t,i){return this.min.copy(t),this.max.copy(i),this}setFromPoints(t){this.makeEmpty();for(let i=0,n=t.length;i<n;i++)this.expandByPoint(t[i]);return this}setFromCenterAndSize(t,i){const n=dG.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,i){return i.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y}clampPoint(t,i){return i.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,dG).distanceTo(t)}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const fG=new me,I2=new me;class _le{constructor(t=new me,i=new me){this.start=t,this.end=i}set(t,i){return this.start.copy(t),this.end.copy(i),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,i){return this.delta(i).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,i){fG.subVectors(t,this.start),I2.subVectors(this.end,this.start);const n=I2.dot(I2);let s=I2.dot(fG)/n;return i&&(s=qi(s,0,1)),s}closestPointToPoint(t,i,n){const r=this.closestPointToPointParameter(t,i);return this.delta(n).multiplyScalar(r).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const pG=new me;class Ale extends gn{constructor(t,i){super(),this.light=t,this.matrixAutoUpdate=!1,this.color=i,this.type="SpotLightHelper";const n=new ki,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let a=0,o=1,l=32;a<l;a++,o++){const c=a/l*Math.PI*2,u=o/l*Math.PI*2;r.push(Math.cos(c),Math.sin(c),1,Math.cos(u),Math.sin(u),1)}n.setAttribute("position",new ei(r,3));const s=new So({fog:!1,toneMapped:!1});this.cone=new ih(n,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const t=this.light.distance?this.light.distance:1e3,i=t*Math.tan(this.light.angle);this.cone.scale.set(i,i,t),pG.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(pG),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const lm=new me,L2=new di,HO=new di;class wle extends ih{constructor(t){const i=gQ(t),n=new ki,r=[],s=[],a=new jt(0,0,1),o=new jt(0,1,0);for(let c=0;c<i.length;c++){const u=i[c];u.parent&&u.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),s.push(a.r,a.g,a.b),s.push(o.r,o.g,o.b))}n.setAttribute("position",new ei(r,3)),n.setAttribute("color",new ei(s,3));const l=new So({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(n,l),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=t,this.bones=i,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const i=this.bones,n=this.geometry,r=n.getAttribute("position");HO.copy(this.root.matrixWorld).invert();for(let s=0,a=0;s<i.length;s++){const o=i[s];o.parent&&o.parent.isBone&&(L2.multiplyMatrices(HO,o.matrixWorld),lm.setFromMatrixPosition(L2),r.setXYZ(a,lm.x,lm.y,lm.z),L2.multiplyMatrices(HO,o.parent.matrixWorld),lm.setFromMatrixPosition(L2),r.setXYZ(a+1,lm.x,lm.y,lm.z),a+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}dispose(){this.geometry.dispose(),this.material.dispose()}}function gQ(e){const t=[];e.isBone===!0&&t.push(e);for(let i=0;i<e.children.length;i++)t.push(...gQ(e.children[i]));return t}class Mle extends ts{constructor(t,i,n){const r=new Qw(i,4,2),s=new $l({wireframe:!0,fog:!1,toneMapped:!1});super(r,s),this.light=t,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const Ele=new me,mG=new jt,gG=new jt;class Tle extends gn{constructor(t,i,n){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="HemisphereLightHelper";const r=new Yw(i);r.rotateY(Math.PI*.5),this.material=new $l({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const s=r.getAttribute("position"),a=new Float32Array(s.count*3);r.setAttribute("color",new Pn(a,3)),this.add(new ts(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const t=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const i=t.geometry.getAttribute("color");mG.copy(this.light.color),gG.copy(this.light.groundColor);for(let n=0,r=i.count;n<r;n++){const s=n<r/2?mG:gG;i.setXYZ(n,s.r,s.g,s.b)}i.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),t.lookAt(Ele.setFromMatrixPosition(this.light.matrixWorld).negate())}}class Cle extends ih{constructor(t=10,i=10,n=4473924,r=8947848){n=new jt(n),r=new jt(r);const s=i/2,a=t/i,o=t/2,l=[],c=[];for(let d=0,p=0,g=-o;d<=i;d++,g+=a){l.push(-o,0,g,o,0,g),l.push(g,0,-o,g,0,o);const x=d===s?n:r;x.toArray(c,p),p+=3,x.toArray(c,p),p+=3,x.toArray(c,p),p+=3,x.toArray(c,p),p+=3}const u=new ki;u.setAttribute("position",new ei(l,3)),u.setAttribute("color",new ei(c,3));const h=new So({vertexColors:!0,toneMapped:!1});super(u,h),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class Dle extends ih{constructor(t=10,i=16,n=8,r=64,s=4473924,a=8947848){s=new jt(s),a=new jt(a);const o=[],l=[];if(i>1)for(let h=0;h<i;h++){const d=h/i*(Math.PI*2),p=Math.sin(d)*t,g=Math.cos(d)*t;o.push(0,0,0),o.push(p,0,g);const x=h&1?s:a;l.push(x.r,x.g,x.b),l.push(x.r,x.g,x.b)}for(let h=0;h<n;h++){const d=h&1?s:a,p=t-t/n*h;for(let g=0;g<r;g++){let x=g/r*(Math.PI*2),y=Math.sin(x)*p,b=Math.cos(x)*p;o.push(y,0,b),l.push(d.r,d.g,d.b),x=(g+1)/r*(Math.PI*2),y=Math.sin(x)*p,b=Math.cos(x)*p,o.push(y,0,b),l.push(d.r,d.g,d.b)}}const c=new ki;c.setAttribute("position",new ei(o,3)),c.setAttribute("color",new ei(l,3));const u=new So({vertexColors:!0,toneMapped:!1});super(c,u),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const vG=new me,U2=new me,yG=new me;class Rle extends gn{constructor(t,i,n){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",i===void 0&&(i=1);let r=new ki;r.setAttribute("position",new ei([-i,i,0,i,i,0,i,-i,0,-i,-i,0,-i,i,0],3));const s=new So({fog:!1,toneMapped:!1});this.lightPlane=new $f(r,s),this.add(this.lightPlane),r=new ki,r.setAttribute("position",new ei([0,0,0,0,0,1],3)),this.targetLine=new $f(r,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),vG.setFromMatrixPosition(this.light.matrixWorld),U2.setFromMatrixPosition(this.light.target.matrixWorld),yG.subVectors(U2,vG),this.lightPlane.lookAt(U2),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(U2),this.targetLine.scale.z=yG.length()}}const N2=new me,Yr=new gR;class Ple extends ih{constructor(t){const i=new ki,n=new So({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],s=[],a={};o("n1","n2"),o("n2","n4"),o("n4","n3"),o("n3","n1"),o("f1","f2"),o("f2","f4"),o("f4","f3"),o("f3","f1"),o("n1","f1"),o("n2","f2"),o("n3","f3"),o("n4","f4"),o("p","n1"),o("p","n2"),o("p","n3"),o("p","n4"),o("u1","u2"),o("u2","u3"),o("u3","u1"),o("c","t"),o("p","c"),o("cn1","cn2"),o("cn3","cn4"),o("cf1","cf2"),o("cf3","cf4");function o(g,x){l(g),l(x)}function l(g){r.push(0,0,0),s.push(0,0,0),a[g]===void 0&&(a[g]=[]),a[g].push(r.length/3-1)}i.setAttribute("position",new ei(r,3)),i.setAttribute("color",new ei(s,3)),super(i,n),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update();const c=new jt(16755200),u=new jt(16711680),h=new jt(43775),d=new jt(16777215),p=new jt(3355443);this.setColors(c,u,h,d,p)}setColors(t,i,n,r,s){const o=this.geometry.getAttribute("color");o.setXYZ(0,t.r,t.g,t.b),o.setXYZ(1,t.r,t.g,t.b),o.setXYZ(2,t.r,t.g,t.b),o.setXYZ(3,t.r,t.g,t.b),o.setXYZ(4,t.r,t.g,t.b),o.setXYZ(5,t.r,t.g,t.b),o.setXYZ(6,t.r,t.g,t.b),o.setXYZ(7,t.r,t.g,t.b),o.setXYZ(8,t.r,t.g,t.b),o.setXYZ(9,t.r,t.g,t.b),o.setXYZ(10,t.r,t.g,t.b),o.setXYZ(11,t.r,t.g,t.b),o.setXYZ(12,t.r,t.g,t.b),o.setXYZ(13,t.r,t.g,t.b),o.setXYZ(14,t.r,t.g,t.b),o.setXYZ(15,t.r,t.g,t.b),o.setXYZ(16,t.r,t.g,t.b),o.setXYZ(17,t.r,t.g,t.b),o.setXYZ(18,t.r,t.g,t.b),o.setXYZ(19,t.r,t.g,t.b),o.setXYZ(20,t.r,t.g,t.b),o.setXYZ(21,t.r,t.g,t.b),o.setXYZ(22,t.r,t.g,t.b),o.setXYZ(23,t.r,t.g,t.b),o.setXYZ(24,i.r,i.g,i.b),o.setXYZ(25,i.r,i.g,i.b),o.setXYZ(26,i.r,i.g,i.b),o.setXYZ(27,i.r,i.g,i.b),o.setXYZ(28,i.r,i.g,i.b),o.setXYZ(29,i.r,i.g,i.b),o.setXYZ(30,i.r,i.g,i.b),o.setXYZ(31,i.r,i.g,i.b),o.setXYZ(32,n.r,n.g,n.b),o.setXYZ(33,n.r,n.g,n.b),o.setXYZ(34,n.r,n.g,n.b),o.setXYZ(35,n.r,n.g,n.b),o.setXYZ(36,n.r,n.g,n.b),o.setXYZ(37,n.r,n.g,n.b),o.setXYZ(38,r.r,r.g,r.b),o.setXYZ(39,r.r,r.g,r.b),o.setXYZ(40,s.r,s.g,s.b),o.setXYZ(41,s.r,s.g,s.b),o.setXYZ(42,s.r,s.g,s.b),o.setXYZ(43,s.r,s.g,s.b),o.setXYZ(44,s.r,s.g,s.b),o.setXYZ(45,s.r,s.g,s.b),o.setXYZ(46,s.r,s.g,s.b),o.setXYZ(47,s.r,s.g,s.b),o.setXYZ(48,s.r,s.g,s.b),o.setXYZ(49,s.r,s.g,s.b),o.needsUpdate=!0}update(){const t=this.geometry,i=this.pointMap,n=1,r=1;Yr.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse);const s=this.camera.coordinateSystem===jc?-1:0;as("c",i,t,Yr,0,0,s),as("t",i,t,Yr,0,0,1),as("n1",i,t,Yr,-1,-1,s),as("n2",i,t,Yr,n,-1,s),as("n3",i,t,Yr,-1,r,s),as("n4",i,t,Yr,n,r,s),as("f1",i,t,Yr,-1,-1,1),as("f2",i,t,Yr,n,-1,1),as("f3",i,t,Yr,-1,r,1),as("f4",i,t,Yr,n,r,1),as("u1",i,t,Yr,n*.7,r*1.1,s),as("u2",i,t,Yr,-1*.7,r*1.1,s),as("u3",i,t,Yr,0,r*2,s),as("cf1",i,t,Yr,-1,0,1),as("cf2",i,t,Yr,n,0,1),as("cf3",i,t,Yr,0,-1,1),as("cf4",i,t,Yr,0,r,1),as("cn1",i,t,Yr,-1,0,s),as("cn2",i,t,Yr,n,0,s),as("cn3",i,t,Yr,0,-1,s),as("cn4",i,t,Yr,0,r,s),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function as(e,t,i,n,r,s,a){N2.set(r,s,a).unproject(n);const o=t[e];if(o!==void 0){const l=i.getAttribute("position");for(let c=0,u=o.length;c<u;c++)l.setXYZ(o[c],N2.x,N2.y,N2.z)}}const z2=new Ya;class Ole extends ih{constructor(t,i=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(8*3),s=new ki;s.setIndex(new Pn(n,1)),s.setAttribute("position",new Pn(r,3)),super(s,new So({color:i,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(){if(this.object!==void 0&&z2.setFromObject(this.object),z2.isEmpty())return;const t=z2.min,i=z2.max,n=this.geometry.attributes.position,r=n.array;r[0]=i.x,r[1]=i.y,r[2]=i.z,r[3]=t.x,r[4]=i.y,r[5]=i.z,r[6]=t.x,r[7]=t.y,r[8]=i.z,r[9]=i.x,r[10]=t.y,r[11]=i.z,r[12]=i.x,r[13]=i.y,r[14]=t.z,r[15]=t.x,r[16]=i.y,r[17]=t.z,r[18]=t.x,r[19]=t.y,r[20]=t.z,r[21]=i.x,r[22]=t.y,r[23]=t.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(t){return this.object=t,this.update(),this}copy(t,i){return super.copy(t,i),this.object=t.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Ble extends ih{constructor(t,i=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],s=new ki;s.setIndex(new Pn(n,1)),s.setAttribute("position",new ei(r,3)),super(s,new So({color:i,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){const i=this.box;i.isEmpty()||(i.getCenter(this.position),i.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}dispose(){this.geometry.dispose(),this.material.dispose()}}class Ile extends $f{constructor(t,i=1,n=16776960){const r=n,s=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],a=new ki;a.setAttribute("position",new ei(s,3)),a.computeBoundingSphere(),super(a,new So({color:r,toneMapped:!1})),this.type="PlaneHelper",this.plane=t,this.size=i;const o=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],l=new ki;l.setAttribute("position",new ei(o,3)),l.computeBoundingSphere(),this.add(new ts(l,new $l({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(t){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(t)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const xG=new me;let F2,GO;class Lle extends gn{constructor(t=new me(0,0,1),i=new me(0,0,0),n=1,r=16776960,s=n*.2,a=s*.2){super(),this.type="ArrowHelper",F2===void 0&&(F2=new ki,F2.setAttribute("position",new ei([0,0,0,0,1,0],3)),GO=new qw(.5,1,5,1),GO.translate(0,-.5,0)),this.position.copy(i),this.line=new $f(F2,new So({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new ts(GO,new $l({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(n,s,a)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{xG.set(t.z,0,-t.x).normalize();const i=Math.acos(t.y);this.quaternion.setFromAxisAngle(xG,i)}}setLength(t,i=t*.2,n=i*.2){this.line.scale.set(1,Math.max(1e-4,t-i),1),this.line.updateMatrix(),this.cone.scale.set(n,i,n),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class Ule extends ih{constructor(t=1){const i=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],n=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],r=new ki;r.setAttribute("position",new ei(i,3)),r.setAttribute("color",new ei(n,3));const s=new So({vertexColors:!0,toneMapped:!1});super(r,s),this.type="AxesHelper"}setColors(t,i,n){const r=new jt,s=this.geometry.attributes.color.array;return r.set(t),r.toArray(s,0),r.toArray(s,3),r.set(i),r.toArray(s,6),r.toArray(s,9),r.set(n),r.toArray(s,12),r.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Nle{constructor(){this.type="ShapePath",this.color=new jt,this.subPaths=[],this.currentPath=null}moveTo(t,i){return this.currentPath=new zD,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,i),this}lineTo(t,i){return this.currentPath.lineTo(t,i),this}quadraticCurveTo(t,i,n,r){return this.currentPath.quadraticCurveTo(t,i,n,r),this}bezierCurveTo(t,i,n,r,s,a){return this.currentPath.bezierCurveTo(t,i,n,r,s,a),this}splineThru(t){return this.currentPath.splineThru(t),this}toShapes(t){function i(b){const A=[];for(let w=0,E=b.length;w<E;w++){const D=b[w],T=new g0;T.curves=D.curves,A.push(T)}return A}function n(b,A){const w=A.length;let E=!1;for(let D=w-1,T=0;T<w;D=T++){let I=A[D],R=A[T],O=R.x-I.x,P=R.y-I.y;if(Math.abs(P)>Number.EPSILON){if(P<0&&(I=A[T],O=-O,R=A[D],P=-P),b.y<I.y||b.y>R.y)continue;if(b.y===I.y){if(b.x===I.x)return!0}else{const U=P*(b.x-I.x)-O*(b.y-I.y);if(U===0)return!0;if(U<0)continue;E=!E}}else{if(b.y!==I.y)continue;if(R.x<=b.x&&b.x<=I.x||I.x<=b.x&&b.x<=R.x)return!0}}return E}const r=Wu.isClockWise,s=this.subPaths;if(s.length===0)return[];let a,o,l;const c=[];if(s.length===1)return o=s[0],l=new g0,l.curves=o.curves,c.push(l),c;let u=!r(s[0].getPoints());u=t?!u:u;const h=[],d=[];let p=[],g=0,x;d[g]=void 0,p[g]=[];for(let b=0,A=s.length;b<A;b++)o=s[b],x=o.getPoints(),a=r(x),a=t?!a:a,a?(!u&&d[g]&&g++,d[g]={s:new g0,p:x},d[g].s.curves=o.curves,u&&g++,p[g]=[]):p[g].push({h:o,p:x[0]});if(!d[0])return i(s);if(d.length>1){let b=!1,A=0;for(let w=0,E=d.length;w<E;w++)h[w]=[];for(let w=0,E=d.length;w<E;w++){const D=p[w];for(let T=0;T<D.length;T++){const I=D[T];let R=!0;for(let O=0;O<d.length;O++)n(I.p,d[O].p)&&(w!==O&&A++,R?(R=!1,h[O].push(I)):b=!0);R&&h[w].push(I)}}A>0&&b===!1&&(p=h)}let y;for(let b=0,A=d.length;b<A;b++){l=d[b].s,c.push(l),y=p[b];for(let w=0,E=y.length;w<E;w++)l.holes.push(y[w].h)}return c}}class zle extends Cd{constructor(t,i=null){super(),this.object=t,this.domElement=i,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(t){if(t===void 0){console.warn("THREE.Controls: connect() now requires an element.");return}this.domElement!==null&&this.disconnect(),this.domElement=t}disconnect(){}dispose(){}update(){}}function Fle(e,t){const i=e.image&&e.image.width?e.image.width/e.image.height:1;return i>t?(e.repeat.x=1,e.repeat.y=i/t,e.offset.x=0,e.offset.y=(1-e.repeat.y)/2):(e.repeat.x=t/i,e.repeat.y=1,e.offset.x=(1-e.repeat.x)/2,e.offset.y=0),e}function Vle(e,t){const i=e.image&&e.image.width?e.image.width/e.image.height:1;return i>t?(e.repeat.x=t/i,e.repeat.y=1,e.offset.x=(1-e.repeat.x)/2,e.offset.y=0):(e.repeat.x=1,e.repeat.y=i/t,e.offset.x=0,e.offset.y=(1-e.repeat.y)/2),e}function Hle(e){return e.repeat.x=1,e.repeat.y=1,e.offset.x=0,e.offset.y=0,e}function sU(e,t,i,n){const r=Gle(n);switch(i){case Jz:return e*t;case uR:return e*t/r.components*r.byteLength;case Hw:return e*t/r.components*r.byteLength;case $z:return e*t*2/r.components*r.byteLength;case hR:return e*t*2/r.components*r.byteLength;case Zz:return e*t*3/r.components*r.byteLength;case go:return e*t*4/r.components*r.byteLength;case dR:return e*t*4/r.components*r.byteLength;case vA:case yA:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case xA:case bA:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case cD:case hD:return Math.max(e,16)*Math.max(t,8)/4;case lD:case uD:return Math.max(e,8)*Math.max(t,8)/2;case dD:case fD:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case pD:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case mD:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case gD:return Math.floor((e+4)/5)*Math.floor((t+3)/4)*16;case vD:return Math.floor((e+4)/5)*Math.floor((t+4)/5)*16;case yD:return Math.floor((e+5)/6)*Math.floor((t+4)/5)*16;case xD:return Math.floor((e+5)/6)*Math.floor((t+5)/6)*16;case bD:return Math.floor((e+7)/8)*Math.floor((t+4)/5)*16;case SD:return Math.floor((e+7)/8)*Math.floor((t+5)/6)*16;case _D:return Math.floor((e+7)/8)*Math.floor((t+7)/8)*16;case AD:return Math.floor((e+9)/10)*Math.floor((t+4)/5)*16;case wD:return Math.floor((e+9)/10)*Math.floor((t+5)/6)*16;case MD:return Math.floor((e+9)/10)*Math.floor((t+7)/8)*16;case ED:return Math.floor((e+9)/10)*Math.floor((t+9)/10)*16;case TD:return Math.floor((e+11)/12)*Math.floor((t+9)/10)*16;case CD:return Math.floor((e+11)/12)*Math.floor((t+11)/12)*16;case SA:case DD:case RD:return Math.ceil(e/4)*Math.ceil(t/4)*16;case eF:case PD:return Math.ceil(e/4)*Math.ceil(t/4)*8;case OD:case BD:return Math.ceil(e/4)*Math.ceil(t/4)*16}throw new Error(`Unable to determine texture byte length for ${i} format.`)}function Gle(e){switch(e){case Kc:case Yz:return{byteLength:1,components:1};case F1:case Qz:case vb:return{byteLength:2,components:1};case lR:case cR:return{byteLength:2,components:4};case Zf:case oR:case Tl:return{byteLength:4,components:1};case Kz:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${e}.`)}class kle{static contain(t,i){return Fle(t,i)}static cover(t,i){return Vle(t,i)}static fill(t){return Hle(t)}static getByteLength(t,i,n,r){return sU(t,i,n,r)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:mb}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=mb);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */function vQ(){let e=null,t=!1,i=null,n=null;function r(s,a){i(s,a),n=e.requestAnimationFrame(r)}return{start:function(){t!==!0&&i!==null&&(n=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(n),t=!1},setAnimationLoop:function(s){i=s},setContext:function(s){e=s}}}function jle(e){const t=new WeakMap;function i(o,l){const c=o.array,u=o.usage,h=c.byteLength,d=e.createBuffer();e.bindBuffer(l,d),e.bufferData(l,c,u),o.onUploadCallback();let p;if(c instanceof Float32Array)p=e.FLOAT;else if(c instanceof Uint16Array)o.isFloat16BufferAttribute?p=e.HALF_FLOAT:p=e.UNSIGNED_SHORT;else if(c instanceof Int16Array)p=e.SHORT;else if(c instanceof Uint32Array)p=e.UNSIGNED_INT;else if(c instanceof Int32Array)p=e.INT;else if(c instanceof Int8Array)p=e.BYTE;else if(c instanceof Uint8Array)p=e.UNSIGNED_BYTE;else if(c instanceof Uint8ClampedArray)p=e.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+c);return{buffer:d,type:p,bytesPerElement:c.BYTES_PER_ELEMENT,version:o.version,size:h}}function n(o,l,c){const u=l.array,h=l.updateRanges;if(e.bindBuffer(c,o),h.length===0)e.bufferSubData(c,0,u);else{h.sort((p,g)=>p.start-g.start);let d=0;for(let p=1;p<h.length;p++){const g=h[d],x=h[p];x.start<=g.start+g.count+1?g.count=Math.max(g.count,x.start+x.count-g.start):(++d,h[d]=x)}h.length=d+1;for(let p=0,g=h.length;p<g;p++){const x=h[p];e.bufferSubData(c,x.start*u.BYTES_PER_ELEMENT,u,x.start,x.count)}l.clearUpdateRanges()}l.onUploadCallback()}function r(o){return o.isInterleavedBufferAttribute&&(o=o.data),t.get(o)}function s(o){o.isInterleavedBufferAttribute&&(o=o.data);const l=t.get(o);l&&(e.deleteBuffer(l.buffer),t.delete(o))}function a(o,l){if(o.isInterleavedBufferAttribute&&(o=o.data),o.isGLBufferAttribute){const u=t.get(o);(!u||u.version<o.version)&&t.set(o,{buffer:o.buffer,type:o.type,bytesPerElement:o.elementSize,version:o.version});return}const c=t.get(o);if(c===void 0)t.set(o,i(o,l));else if(c.version<o.version){if(c.size!==o.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");n(c.buffer,o,l),c.version=o.version}}return{get:r,remove:s,update:a}}var Wle=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,Xle=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,qle=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,Yle=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Qle=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,Kle=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,Jle=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,Zle=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,$le=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,ece=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,tce=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,ice=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,nce=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,rce=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,sce=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,ace=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,oce=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,lce=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,cce=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,uce=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,hce=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,dce=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,fce=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,pce=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,mce=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,gce=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,vce=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,yce=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,xce=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,bce=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,Sce="gl_FragColor = linearToOutputTexel( gl_FragColor );",_ce=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,Ace=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,wce=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,Mce=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,Ece=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Tce=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,Cce=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,Dce=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,Rce=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Pce=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Oce=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,Bce=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,Ice=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,Lce=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,Uce=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,Nce=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,zce=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,Fce=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,Vce=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,Hce=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,Gce=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,kce=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,jce=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,Wce=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,Xce=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,qce=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,Yce=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,Qce=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,Kce=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,Jce=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,Zce=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,$ce=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,eue=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,tue=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,iue=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,nue=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,rue=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,sue=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,aue=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,oue=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,lue=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,cue=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,uue=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,hue=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,due=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,fue=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,pue=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,mue=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,gue=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,vue=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,yue=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,xue=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,bue=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,Sue=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,_ue=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,Aue=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,wue=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,Mue=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,Eue=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,Tue=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,Cue=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,Due=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,Rue=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,Pue=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,Oue=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,Bue=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,Iue=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,Lue=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,Uue=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,Nue=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,zue=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,Fue=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,Vue=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,Hue=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,Gue=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,kue=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const jue=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,Wue=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Xue=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,que=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Yue=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,Que=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Kue=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,Jue=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,Zue=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,$ue=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,ehe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,the=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,ihe=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,nhe=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,rhe=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,she=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,ahe=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,ohe=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,lhe=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,che=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,uhe=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,hhe=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,dhe=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fhe=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,phe=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,mhe=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,ghe=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,vhe=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,yhe=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,xhe=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,bhe=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,She=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,_he=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Ahe=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,nn={alphahash_fragment:Wle,alphahash_pars_fragment:Xle,alphamap_fragment:qle,alphamap_pars_fragment:Yle,alphatest_fragment:Qle,alphatest_pars_fragment:Kle,aomap_fragment:Jle,aomap_pars_fragment:Zle,batching_pars_vertex:$le,batching_vertex:ece,begin_vertex:tce,beginnormal_vertex:ice,bsdfs:nce,iridescence_fragment:rce,bumpmap_pars_fragment:sce,clipping_planes_fragment:ace,clipping_planes_pars_fragment:oce,clipping_planes_pars_vertex:lce,clipping_planes_vertex:cce,color_fragment:uce,color_pars_fragment:hce,color_pars_vertex:dce,color_vertex:fce,common:pce,cube_uv_reflection_fragment:mce,defaultnormal_vertex:gce,displacementmap_pars_vertex:vce,displacementmap_vertex:yce,emissivemap_fragment:xce,emissivemap_pars_fragment:bce,colorspace_fragment:Sce,colorspace_pars_fragment:_ce,envmap_fragment:Ace,envmap_common_pars_fragment:wce,envmap_pars_fragment:Mce,envmap_pars_vertex:Ece,envmap_physical_pars_fragment:Nce,envmap_vertex:Tce,fog_vertex:Cce,fog_pars_vertex:Dce,fog_fragment:Rce,fog_pars_fragment:Pce,gradientmap_pars_fragment:Oce,lightmap_pars_fragment:Bce,lights_lambert_fragment:Ice,lights_lambert_pars_fragment:Lce,lights_pars_begin:Uce,lights_toon_fragment:zce,lights_toon_pars_fragment:Fce,lights_phong_fragment:Vce,lights_phong_pars_fragment:Hce,lights_physical_fragment:Gce,lights_physical_pars_fragment:kce,lights_fragment_begin:jce,lights_fragment_maps:Wce,lights_fragment_end:Xce,logdepthbuf_fragment:qce,logdepthbuf_pars_fragment:Yce,logdepthbuf_pars_vertex:Qce,logdepthbuf_vertex:Kce,map_fragment:Jce,map_pars_fragment:Zce,map_particle_fragment:$ce,map_particle_pars_fragment:eue,metalnessmap_fragment:tue,metalnessmap_pars_fragment:iue,morphinstance_vertex:nue,morphcolor_vertex:rue,morphnormal_vertex:sue,morphtarget_pars_vertex:aue,morphtarget_vertex:oue,normal_fragment_begin:lue,normal_fragment_maps:cue,normal_pars_fragment:uue,normal_pars_vertex:hue,normal_vertex:due,normalmap_pars_fragment:fue,clearcoat_normal_fragment_begin:pue,clearcoat_normal_fragment_maps:mue,clearcoat_pars_fragment:gue,iridescence_pars_fragment:vue,opaque_fragment:yue,packing:xue,premultiplied_alpha_fragment:bue,project_vertex:Sue,dithering_fragment:_ue,dithering_pars_fragment:Aue,roughnessmap_fragment:wue,roughnessmap_pars_fragment:Mue,shadowmap_pars_fragment:Eue,shadowmap_pars_vertex:Tue,shadowmap_vertex:Cue,shadowmask_pars_fragment:Due,skinbase_vertex:Rue,skinning_pars_vertex:Pue,skinning_vertex:Oue,skinnormal_vertex:Bue,specularmap_fragment:Iue,specularmap_pars_fragment:Lue,tonemapping_fragment:Uue,tonemapping_pars_fragment:Nue,transmission_fragment:zue,transmission_pars_fragment:Fue,uv_pars_fragment:Vue,uv_pars_vertex:Hue,uv_vertex:Gue,worldpos_vertex:kue,background_vert:jue,background_frag:Wue,backgroundCube_vert:Xue,backgroundCube_frag:que,cube_vert:Yue,cube_frag:Que,depth_vert:Kue,depth_frag:Jue,distanceRGBA_vert:Zue,distanceRGBA_frag:$ue,equirect_vert:ehe,equirect_frag:the,linedashed_vert:ihe,linedashed_frag:nhe,meshbasic_vert:rhe,meshbasic_frag:she,meshlambert_vert:ahe,meshlambert_frag:ohe,meshmatcap_vert:lhe,meshmatcap_frag:che,meshnormal_vert:uhe,meshnormal_frag:hhe,meshphong_vert:dhe,meshphong_frag:fhe,meshphysical_vert:phe,meshphysical_frag:mhe,meshtoon_vert:ghe,meshtoon_frag:vhe,points_vert:yhe,points_frag:xhe,shadow_vert:bhe,shadow_frag:She,sprite_vert:_he,sprite_frag:Ahe},Xt={common:{diffuse:{value:new jt(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Ki},alphaMap:{value:null},alphaMapTransform:{value:new Ki},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Ki}},envmap:{envMap:{value:null},envMapRotation:{value:new Ki},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Ki}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Ki}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Ki},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Ki},normalScale:{value:new Mt(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Ki},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Ki}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Ki}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Ki}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new jt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new jt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Ki},alphaTest:{value:0},uvTransform:{value:new Ki}},sprite:{diffuse:{value:new jt(16777215)},opacity:{value:1},center:{value:new Mt(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Ki},alphaMap:{value:null},alphaMapTransform:{value:new Ki},alphaTest:{value:0}}},Gu={basic:{uniforms:jo([Xt.common,Xt.specularmap,Xt.envmap,Xt.aomap,Xt.lightmap,Xt.fog]),vertexShader:nn.meshbasic_vert,fragmentShader:nn.meshbasic_frag},lambert:{uniforms:jo([Xt.common,Xt.specularmap,Xt.envmap,Xt.aomap,Xt.lightmap,Xt.emissivemap,Xt.bumpmap,Xt.normalmap,Xt.displacementmap,Xt.fog,Xt.lights,{emissive:{value:new jt(0)}}]),vertexShader:nn.meshlambert_vert,fragmentShader:nn.meshlambert_frag},phong:{uniforms:jo([Xt.common,Xt.specularmap,Xt.envmap,Xt.aomap,Xt.lightmap,Xt.emissivemap,Xt.bumpmap,Xt.normalmap,Xt.displacementmap,Xt.fog,Xt.lights,{emissive:{value:new jt(0)},specular:{value:new jt(1118481)},shininess:{value:30}}]),vertexShader:nn.meshphong_vert,fragmentShader:nn.meshphong_frag},standard:{uniforms:jo([Xt.common,Xt.envmap,Xt.aomap,Xt.lightmap,Xt.emissivemap,Xt.bumpmap,Xt.normalmap,Xt.displacementmap,Xt.roughnessmap,Xt.metalnessmap,Xt.fog,Xt.lights,{emissive:{value:new jt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:nn.meshphysical_vert,fragmentShader:nn.meshphysical_frag},toon:{uniforms:jo([Xt.common,Xt.aomap,Xt.lightmap,Xt.emissivemap,Xt.bumpmap,Xt.normalmap,Xt.displacementmap,Xt.gradientmap,Xt.fog,Xt.lights,{emissive:{value:new jt(0)}}]),vertexShader:nn.meshtoon_vert,fragmentShader:nn.meshtoon_frag},matcap:{uniforms:jo([Xt.common,Xt.bumpmap,Xt.normalmap,Xt.displacementmap,Xt.fog,{matcap:{value:null}}]),vertexShader:nn.meshmatcap_vert,fragmentShader:nn.meshmatcap_frag},points:{uniforms:jo([Xt.points,Xt.fog]),vertexShader:nn.points_vert,fragmentShader:nn.points_frag},dashed:{uniforms:jo([Xt.common,Xt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:nn.linedashed_vert,fragmentShader:nn.linedashed_frag},depth:{uniforms:jo([Xt.common,Xt.displacementmap]),vertexShader:nn.depth_vert,fragmentShader:nn.depth_frag},normal:{uniforms:jo([Xt.common,Xt.bumpmap,Xt.normalmap,Xt.displacementmap,{opacity:{value:1}}]),vertexShader:nn.meshnormal_vert,fragmentShader:nn.meshnormal_frag},sprite:{uniforms:jo([Xt.sprite,Xt.fog]),vertexShader:nn.sprite_vert,fragmentShader:nn.sprite_frag},background:{uniforms:{uvTransform:{value:new Ki},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:nn.background_vert,fragmentShader:nn.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Ki}},vertexShader:nn.backgroundCube_vert,fragmentShader:nn.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:nn.cube_vert,fragmentShader:nn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:nn.equirect_vert,fragmentShader:nn.equirect_frag},distanceRGBA:{uniforms:jo([Xt.common,Xt.displacementmap,{referencePosition:{value:new me},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:nn.distanceRGBA_vert,fragmentShader:nn.distanceRGBA_frag},shadow:{uniforms:jo([Xt.lights,Xt.fog,{color:{value:new jt(0)},opacity:{value:1}}]),vertexShader:nn.shadow_vert,fragmentShader:nn.shadow_frag}};Gu.physical={uniforms:jo([Gu.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Ki},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Ki},clearcoatNormalScale:{value:new Mt(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Ki},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Ki},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Ki},sheen:{value:0},sheenColor:{value:new jt(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Ki},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Ki},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Ki},transmissionSamplerSize:{value:new Mt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Ki},attenuationDistance:{value:0},attenuationColor:{value:new jt(0)},specularColor:{value:new jt(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Ki},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Ki},anisotropyVector:{value:new Mt},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Ki}}]),vertexShader:nn.meshphysical_vert,fragmentShader:nn.meshphysical_frag};const V2={r:0,b:0,g:0},Sv=new tl,whe=new di;function Mhe(e,t,i,n,r,s,a){const o=new jt(0);let l=s===!0?0:1,c,u,h=null,d=0,p=null;function g(w){let E=w.isScene===!0?w.background:null;return E&&E.isTexture&&(E=(w.backgroundBlurriness>0?i:t).get(E)),E}function x(w){let E=!1;const D=g(w);D===null?b(o,l):D&&D.isColor&&(b(D,1),E=!0);const T=e.xr.getEnvironmentBlendMode();T==="additive"?n.buffers.color.setClear(0,0,0,1,a):T==="alpha-blend"&&n.buffers.color.setClear(0,0,0,0,a),(e.autoClear||E)&&(n.buffers.depth.setTest(!0),n.buffers.depth.setMask(!0),n.buffers.color.setMask(!0),e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil))}function y(w,E){const D=g(E);D&&(D.isCubeTexture||D.mapping===gb)?(u===void 0&&(u=new ts(new j0(1,1,1),new Ju({name:"BackgroundCubeMaterial",uniforms:q1(Gu.backgroundCube.uniforms),vertexShader:Gu.backgroundCube.vertexShader,fragmentShader:Gu.backgroundCube.fragmentShader,side:el,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(T,I,R){this.matrixWorld.copyPosition(R.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(u)),Sv.copy(E.backgroundRotation),Sv.x*=-1,Sv.y*=-1,Sv.z*=-1,D.isCubeTexture&&D.isRenderTargetTexture===!1&&(Sv.y*=-1,Sv.z*=-1),u.material.uniforms.envMap.value=D,u.material.uniforms.flipEnvMap.value=D.isCubeTexture&&D.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=E.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=E.backgroundIntensity,u.material.uniforms.backgroundRotation.value.setFromMatrix4(whe.makeRotationFromEuler(Sv)),u.material.toneMapped=_n.getTransfer(D.colorSpace)!==Jn,(h!==D||d!==D.version||p!==e.toneMapping)&&(u.material.needsUpdate=!0,h=D,d=D.version,p=e.toneMapping),u.layers.enableAll(),w.unshift(u,u.geometry,u.material,0,0,null)):D&&D.isTexture&&(c===void 0&&(c=new ts(new xb(2,2),new Ju({name:"BackgroundMaterial",uniforms:q1(Gu.background.uniforms),vertexShader:Gu.background.vertexShader,fragmentShader:Gu.background.fragmentShader,side:bd,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(c)),c.material.uniforms.t2D.value=D,c.material.uniforms.backgroundIntensity.value=E.backgroundIntensity,c.material.toneMapped=_n.getTransfer(D.colorSpace)!==Jn,D.matrixAutoUpdate===!0&&D.updateMatrix(),c.material.uniforms.uvTransform.value.copy(D.matrix),(h!==D||d!==D.version||p!==e.toneMapping)&&(c.material.needsUpdate=!0,h=D,d=D.version,p=e.toneMapping),c.layers.enableAll(),w.unshift(c,c.geometry,c.material,0,0,null))}function b(w,E){w.getRGB(V2,EY(e)),n.buffers.color.setClear(V2.r,V2.g,V2.b,E,a)}function A(){u!==void 0&&(u.geometry.dispose(),u.material.dispose(),u=void 0),c!==void 0&&(c.geometry.dispose(),c.material.dispose(),c=void 0)}return{getClearColor:function(){return o},setClearColor:function(w,E=1){o.set(w),l=E,b(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(w){l=w,b(o,l)},render:x,addToRenderList:y,dispose:A}}function Ehe(e,t){const i=e.getParameter(e.MAX_VERTEX_ATTRIBS),n={},r=d(null);let s=r,a=!1;function o(P,U,H,V,j){let J=!1;const F=h(V,H,U);s!==F&&(s=F,c(s.object)),J=p(P,V,H,j),J&&g(P,V,H,j),j!==null&&t.update(j,e.ELEMENT_ARRAY_BUFFER),(J||a)&&(a=!1,E(P,U,H,V),j!==null&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.get(j).buffer))}function l(){return e.createVertexArray()}function c(P){return e.bindVertexArray(P)}function u(P){return e.deleteVertexArray(P)}function h(P,U,H){const V=H.wireframe===!0;let j=n[P.id];j===void 0&&(j={},n[P.id]=j);let J=j[U.id];J===void 0&&(J={},j[U.id]=J);let F=J[V];return F===void 0&&(F=d(l()),J[V]=F),F}function d(P){const U=[],H=[],V=[];for(let j=0;j<i;j++)U[j]=0,H[j]=0,V[j]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:U,enabledAttributes:H,attributeDivisors:V,object:P,attributes:{},index:null}}function p(P,U,H,V){const j=s.attributes,J=U.attributes;let F=0;const X=H.getAttributes();for(const W in X)if(X[W].location>=0){const Y=j[W];let $=J[W];if($===void 0&&(W==="instanceMatrix"&&P.instanceMatrix&&($=P.instanceMatrix),W==="instanceColor"&&P.instanceColor&&($=P.instanceColor)),Y===void 0||Y.attribute!==$||$&&Y.data!==$.data)return!0;F++}return s.attributesNum!==F||s.index!==V}function g(P,U,H,V){const j={},J=U.attributes;let F=0;const X=H.getAttributes();for(const W in X)if(X[W].location>=0){let Y=J[W];Y===void 0&&(W==="instanceMatrix"&&P.instanceMatrix&&(Y=P.instanceMatrix),W==="instanceColor"&&P.instanceColor&&(Y=P.instanceColor));const $={};$.attribute=Y,Y&&Y.data&&($.data=Y.data),j[W]=$,F++}s.attributes=j,s.attributesNum=F,s.index=V}function x(){const P=s.newAttributes;for(let U=0,H=P.length;U<H;U++)P[U]=0}function y(P){b(P,0)}function b(P,U){const H=s.newAttributes,V=s.enabledAttributes,j=s.attributeDivisors;H[P]=1,V[P]===0&&(e.enableVertexAttribArray(P),V[P]=1),j[P]!==U&&(e.vertexAttribDivisor(P,U),j[P]=U)}function A(){const P=s.newAttributes,U=s.enabledAttributes;for(let H=0,V=U.length;H<V;H++)U[H]!==P[H]&&(e.disableVertexAttribArray(H),U[H]=0)}function w(P,U,H,V,j,J,F){F===!0?e.vertexAttribIPointer(P,U,H,j,J):e.vertexAttribPointer(P,U,H,V,j,J)}function E(P,U,H,V){x();const j=V.attributes,J=H.getAttributes(),F=U.defaultAttributeValues;for(const X in J){const W=J[X];if(W.location>=0){let ne=j[X];if(ne===void 0&&(X==="instanceMatrix"&&P.instanceMatrix&&(ne=P.instanceMatrix),X==="instanceColor"&&P.instanceColor&&(ne=P.instanceColor)),ne!==void 0){const Y=ne.normalized,$=ne.itemSize,se=t.get(ne);if(se===void 0)continue;const fe=se.buffer,te=se.type,de=se.bytesPerElement,le=te===e.INT||te===e.UNSIGNED_INT||ne.gpuType===oR;if(ne.isInterleavedBufferAttribute){const _e=ne.data,be=_e.stride,we=ne.offset;if(_e.isInstancedInterleavedBuffer){for(let Me=0;Me<W.locationSize;Me++)b(W.location+Me,_e.meshPerAttribute);P.isInstancedMesh!==!0&&V._maxInstanceCount===void 0&&(V._maxInstanceCount=_e.meshPerAttribute*_e.count)}else for(let Me=0;Me<W.locationSize;Me++)y(W.location+Me);e.bindBuffer(e.ARRAY_BUFFER,fe);for(let Me=0;Me<W.locationSize;Me++)w(W.location+Me,$/W.locationSize,te,Y,be*de,(we+$/W.locationSize*Me)*de,le)}else{if(ne.isInstancedBufferAttribute){for(let _e=0;_e<W.locationSize;_e++)b(W.location+_e,ne.meshPerAttribute);P.isInstancedMesh!==!0&&V._maxInstanceCount===void 0&&(V._maxInstanceCount=ne.meshPerAttribute*ne.count)}else for(let _e=0;_e<W.locationSize;_e++)y(W.location+_e);e.bindBuffer(e.ARRAY_BUFFER,fe);for(let _e=0;_e<W.locationSize;_e++)w(W.location+_e,$/W.locationSize,te,Y,$*de,$/W.locationSize*_e*de,le)}}else if(F!==void 0){const Y=F[X];if(Y!==void 0)switch(Y.length){case 2:e.vertexAttrib2fv(W.location,Y);break;case 3:e.vertexAttrib3fv(W.location,Y);break;case 4:e.vertexAttrib4fv(W.location,Y);break;default:e.vertexAttrib1fv(W.location,Y)}}}}A()}function D(){R();for(const P in n){const U=n[P];for(const H in U){const V=U[H];for(const j in V)u(V[j].object),delete V[j];delete U[H]}delete n[P]}}function T(P){if(n[P.id]===void 0)return;const U=n[P.id];for(const H in U){const V=U[H];for(const j in V)u(V[j].object),delete V[j];delete U[H]}delete n[P.id]}function I(P){for(const U in n){const H=n[U];if(H[P.id]===void 0)continue;const V=H[P.id];for(const j in V)u(V[j].object),delete V[j];delete H[P.id]}}function R(){O(),a=!0,s!==r&&(s=r,c(s.object))}function O(){r.geometry=null,r.program=null,r.wireframe=!1}return{setup:o,reset:R,resetDefaultState:O,dispose:D,releaseStatesOfGeometry:T,releaseStatesOfProgram:I,initAttributes:x,enableAttribute:y,disableUnusedAttributes:A}}function The(e,t,i){let n;function r(c){n=c}function s(c,u){e.drawArrays(n,c,u),i.update(u,n,1)}function a(c,u,h){h!==0&&(e.drawArraysInstanced(n,c,u,h),i.update(u,n,h))}function o(c,u,h){if(h===0)return;t.get("WEBGL_multi_draw").multiDrawArraysWEBGL(n,c,0,u,0,h);let p=0;for(let g=0;g<h;g++)p+=u[g];i.update(p,n,1)}function l(c,u,h,d){if(h===0)return;const p=t.get("WEBGL_multi_draw");if(p===null)for(let g=0;g<c.length;g++)a(c[g],u[g],d[g]);else{p.multiDrawArraysInstancedWEBGL(n,c,0,u,0,d,0,h);let g=0;for(let x=0;x<h;x++)g+=u[x]*d[x];i.update(g,n,1)}}this.setMode=r,this.render=s,this.renderInstances=a,this.renderMultiDraw=o,this.renderMultiDrawInstances=l}function Che(e,t,i,n){let r;function s(){if(r!==void 0)return r;if(t.has("EXT_texture_filter_anisotropic")===!0){const I=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(I.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function a(I){return!(I!==go&&n.convert(I)!==e.getParameter(e.IMPLEMENTATION_COLOR_READ_FORMAT))}function o(I){const R=I===vb&&(t.has("EXT_color_buffer_half_float")||t.has("EXT_color_buffer_float"));return!(I!==Kc&&n.convert(I)!==e.getParameter(e.IMPLEMENTATION_COLOR_READ_TYPE)&&I!==Tl&&!R)}function l(I){if(I==="highp"){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";I="mediump"}return I==="mediump"&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let c=i.precision!==void 0?i.precision:"highp";const u=l(c);u!==c&&(console.warn("THREE.WebGLRenderer:",c,"not supported, using",u,"instead."),c=u);const h=i.logarithmicDepthBuffer===!0,d=i.reverseDepthBuffer===!0&&t.has("EXT_clip_control"),p=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),g=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),x=e.getParameter(e.MAX_TEXTURE_SIZE),y=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),b=e.getParameter(e.MAX_VERTEX_ATTRIBS),A=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),w=e.getParameter(e.MAX_VARYING_VECTORS),E=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),D=g>0,T=e.getParameter(e.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:s,getMaxPrecision:l,textureFormatReadable:a,textureTypeReadable:o,precision:c,logarithmicDepthBuffer:h,reverseDepthBuffer:d,maxTextures:p,maxVertexTextures:g,maxTextureSize:x,maxCubemapSize:y,maxAttributes:b,maxVertexUniforms:A,maxVaryings:w,maxFragmentUniforms:E,vertexTextures:D,maxSamples:T}}function Dhe(e){const t=this;let i=null,n=0,r=!1,s=!1;const a=new Ef,o=new Ki,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(h,d){const p=h.length!==0||d||n!==0||r;return r=d,n=h.length,p},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(h,d){i=u(h,d,0)},this.setState=function(h,d,p){const g=h.clippingPlanes,x=h.clipIntersection,y=h.clipShadows,b=e.get(h);if(!r||g===null||g.length===0||s&&!y)s?u(null):c();else{const A=s?0:n,w=A*4;let E=b.clippingState||null;l.value=E,E=u(g,d,w,p);for(let D=0;D!==w;++D)E[D]=i[D];b.clippingState=E,this.numIntersection=x?this.numPlanes:0,this.numPlanes+=A}};function c(){l.value!==i&&(l.value=i,l.needsUpdate=n>0),t.numPlanes=n,t.numIntersection=0}function u(h,d,p,g){const x=h!==null?h.length:0;let y=null;if(x!==0){if(y=l.value,g!==!0||y===null){const b=p+x*4,A=d.matrixWorldInverse;o.getNormalMatrix(A),(y===null||y.length<b)&&(y=new Float32Array(b));for(let w=0,E=p;w!==x;++w,E+=4)a.copy(h[w]).applyMatrix4(A,o),a.normal.toArray(y,E),y[E+3]=a.constant}l.value=y,l.needsUpdate=!0}return t.numPlanes=x,t.numIntersection=0,y}}function Rhe(e){let t=new WeakMap;function i(a,o){return o===YA?a.mapping=Jf:o===QA&&(a.mapping=Jm),a}function n(a){if(a&&a.isTexture){const o=a.mapping;if(o===YA||o===QA)if(t.has(a)){const l=t.get(a).texture;return i(l,a.mapping)}else{const l=a.image;if(l&&l.height>0){const c=new uF(l.height);return c.fromEquirectangularTexture(e,a),t.set(a,c),a.addEventListener("dispose",r),i(c.texture,a.mapping)}else return null}}return a}function r(a){const o=a.target;o.removeEventListener("dispose",r);const l=t.get(o);l!==void 0&&(t.delete(o),l.dispose())}function s(){t=new WeakMap}return{get:n,dispose:s}}const o1=4,bG=[.125,.215,.35,.446,.526,.582],jv=20,kO=new Qu,SG=new jt;let jO=null,WO=0,XO=0,qO=!1;const zv=(1+Math.sqrt(5))/2,vx=1/zv,_G=[new me(-zv,vx,0),new me(zv,vx,0),new me(-vx,0,zv),new me(vx,0,zv),new me(0,zv,-vx),new me(0,zv,vx),new me(-1,1,-1),new me(1,1,-1),new me(-1,1,1),new me(1,1,1)],Phe=new me;class aU{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,i=0,n=.1,r=100,s={}){const{size:a=256,position:o=Phe}=s;jO=this._renderer.getRenderTarget(),WO=this._renderer.getActiveCubeFace(),XO=this._renderer.getActiveMipmapLevel(),qO=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(a);const l=this._allocateTargets();return l.depthBuffer=!0,this._sceneToCubeUV(t,n,r,l,o),i>0&&this._blur(l,0,0,i),this._applyPMREM(l),this._cleanup(l),l}fromEquirectangular(t,i=null){return this._fromTexture(t,i)}fromCubemap(t,i=null){return this._fromTexture(t,i)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=MG(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=wG(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(jO,WO,XO),this._renderer.xr.enabled=qO,t.scissorTest=!1,H2(t,0,0,t.width,t.height)}_fromTexture(t,i){t.mapping===Jf||t.mapping===Jm?this._setSize(t.image.length===0?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),jO=this._renderer.getRenderTarget(),WO=this._renderer.getActiveCubeFace(),XO=this._renderer.getActiveMipmapLevel(),qO=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=i||this._allocateTargets();return this._textureToCubeUV(t,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),i=4*this._cubeSize,n={magFilter:hs,minFilter:hs,generateMipmaps:!1,type:vb,format:go,colorSpace:$m,depthBuffer:!1},r=AG(t,i,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==i){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=AG(t,i,n);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=Ohe(s)),this._blurMaterial=Bhe(s,t,i)}return r}_compileMaterial(t){const i=new ts(this._lodPlanes[0],t);this._renderer.compile(i,kO)}_sceneToCubeUV(t,i,n,r,s){const l=new Dr(90,1,i,n),c=[1,-1,1,1,1,1],u=[1,1,1,-1,-1,-1],h=this._renderer,d=h.autoClear,p=h.toneMapping;h.getClearColor(SG),h.toneMapping=ud,h.autoClear=!1;const g=new $l({name:"PMREM.Background",side:el,depthWrite:!1,depthTest:!1}),x=new ts(new j0,g);let y=!1;const b=t.background;b?b.isColor&&(g.color.copy(b),t.background=null,y=!0):(g.color.copy(SG),y=!0);for(let A=0;A<6;A++){const w=A%3;w===0?(l.up.set(0,c[A],0),l.position.set(s.x,s.y,s.z),l.lookAt(s.x+u[A],s.y,s.z)):w===1?(l.up.set(0,0,c[A]),l.position.set(s.x,s.y,s.z),l.lookAt(s.x,s.y+u[A],s.z)):(l.up.set(0,c[A],0),l.position.set(s.x,s.y,s.z),l.lookAt(s.x,s.y,s.z+u[A]));const E=this._cubeSize;H2(r,w*E,A>2?E:0,E,E),h.setRenderTarget(r),y&&h.render(x,l),h.render(t,l)}x.geometry.dispose(),x.material.dispose(),h.toneMapping=p,h.autoClear=d,t.background=b}_textureToCubeUV(t,i){const n=this._renderer,r=t.mapping===Jf||t.mapping===Jm;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=MG()),this._cubemapMaterial.uniforms.flipEnvMap.value=t.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=wG());const s=r?this._cubemapMaterial:this._equirectMaterial,a=new ts(this._lodPlanes[0],s),o=s.uniforms;o.envMap.value=t;const l=this._cubeSize;H2(i,0,0,3*l,2*l),n.setRenderTarget(i),n.render(a,kO)}_applyPMREM(t){const i=this._renderer,n=i.autoClear;i.autoClear=!1;const r=this._lodPlanes.length;for(let s=1;s<r;s++){const a=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),o=_G[(r-s-1)%_G.length];this._blur(t,s-1,s,a,o)}i.autoClear=n}_blur(t,i,n,r,s){const a=this._pingPongRenderTarget;this._halfBlur(t,a,i,n,r,"latitudinal",s),this._halfBlur(a,t,n,n,r,"longitudinal",s)}_halfBlur(t,i,n,r,s,a,o){const l=this._renderer,c=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,h=new ts(this._lodPlanes[r],c),d=c.uniforms,p=this._sizeLods[n]-1,g=isFinite(s)?Math.PI/(2*p):2*Math.PI/(2*jv-1),x=s/g,y=isFinite(s)?1+Math.floor(u*x):jv;y>jv&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${y} samples when the maximum is set to ${jv}`);const b=[];let A=0;for(let I=0;I<jv;++I){const R=I/x,O=Math.exp(-R*R/2);b.push(O),I===0?A+=O:I<y&&(A+=2*O)}for(let I=0;I<b.length;I++)b[I]=b[I]/A;d.envMap.value=t.texture,d.samples.value=y,d.weights.value=b,d.latitudinal.value=a==="latitudinal",o&&(d.poleAxis.value=o);const{_lodMax:w}=this;d.dTheta.value=g,d.mipInt.value=w-n;const E=this._sizeLods[r],D=3*E*(r>w-o1?r-w+o1:0),T=4*(this._cubeSize-E);H2(i,D,T,3*E,2*E),l.setRenderTarget(i),l.render(h,kO)}}function Ohe(e){const t=[],i=[],n=[];let r=e;const s=e-o1+1+bG.length;for(let a=0;a<s;a++){const o=Math.pow(2,r);i.push(o);let l=1/o;a>e-o1?l=bG[a-e+o1-1]:a===0&&(l=0),n.push(l);const c=1/(o-2),u=-c,h=1+c,d=[u,u,h,u,h,h,u,u,h,h,u,h],p=6,g=6,x=3,y=2,b=1,A=new Float32Array(x*g*p),w=new Float32Array(y*g*p),E=new Float32Array(b*g*p);for(let T=0;T<p;T++){const I=T%3*2/3-1,R=T>2?0:-1,O=[I,R,0,I+2/3,R,0,I+2/3,R+1,0,I,R,0,I+2/3,R+1,0,I,R+1,0];A.set(O,x*g*T),w.set(d,y*g*T);const P=[T,T,T,T,T,T];E.set(P,b*g*T)}const D=new ki;D.setAttribute("position",new Pn(A,x)),D.setAttribute("uv",new Pn(w,y)),D.setAttribute("faceIndex",new Pn(E,b)),t.push(D),r>o1&&r--}return{lodPlanes:t,sizeLods:i,sigmas:n}}function AG(e,t,i){const n=new Sd(e,t,i);return n.texture.mapping=gb,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function H2(e,t,i,n,r){e.viewport.set(t,i,n,r),e.scissor.set(t,i,n,r)}function Bhe(e,t,i){const n=new Float32Array(jv),r=new me(0,1,0);return new Ju({name:"SphericalGaussianBlur",defines:{n:jv,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:VF(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Wf,depthTest:!1,depthWrite:!1})}function wG(){return new Ju({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:VF(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Wf,depthTest:!1,depthWrite:!1})}function MG(){return new Ju({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:VF(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Wf,depthTest:!1,depthWrite:!1})}function VF(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function Ihe(e){let t=new WeakMap,i=null;function n(o){if(o&&o.isTexture){const l=o.mapping,c=l===YA||l===QA,u=l===Jf||l===Jm;if(c||u){let h=t.get(o);const d=h!==void 0?h.texture.pmremVersion:0;if(o.isRenderTargetTexture&&o.pmremVersion!==d)return i===null&&(i=new aU(e)),h=c?i.fromEquirectangular(o,h):i.fromCubemap(o,h),h.texture.pmremVersion=o.pmremVersion,t.set(o,h),h.texture;if(h!==void 0)return h.texture;{const p=o.image;return c&&p&&p.height>0||u&&p&&r(p)?(i===null&&(i=new aU(e)),h=c?i.fromEquirectangular(o):i.fromCubemap(o),h.texture.pmremVersion=o.pmremVersion,t.set(o,h),o.addEventListener("dispose",s),h.texture):null}}}return o}function r(o){let l=0;const c=6;for(let u=0;u<c;u++)o[u]!==void 0&&l++;return l===c}function s(o){const l=o.target;l.removeEventListener("dispose",s);const c=t.get(l);c!==void 0&&(t.delete(l),c.dispose())}function a(){t=new WeakMap,i!==null&&(i.dispose(),i=null)}return{get:n,dispose:a}}function Lhe(e){const t={};function i(n){if(t[n]!==void 0)return t[n];let r;switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return t[n]=r,r}return{has:function(n){return i(n)!==null},init:function(){i("EXT_color_buffer_float"),i("WEBGL_clip_cull_distance"),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture"),i("WEBGL_render_shared_exponent")},get:function(n){const r=i(n);return r===null&&S1("THREE.WebGLRenderer: "+n+" extension not supported."),r}}}function Uhe(e,t,i,n){const r={},s=new WeakMap;function a(h){const d=h.target;d.index!==null&&t.remove(d.index);for(const g in d.attributes)t.remove(d.attributes[g]);d.removeEventListener("dispose",a),delete r[d.id];const p=s.get(d);p&&(t.remove(p),s.delete(d)),n.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,i.memory.geometries--}function o(h,d){return r[d.id]===!0||(d.addEventListener("dispose",a),r[d.id]=!0,i.memory.geometries++),d}function l(h){const d=h.attributes;for(const p in d)t.update(d[p],e.ARRAY_BUFFER)}function c(h){const d=[],p=h.index,g=h.attributes.position;let x=0;if(p!==null){const A=p.array;x=p.version;for(let w=0,E=A.length;w<E;w+=3){const D=A[w+0],T=A[w+1],I=A[w+2];d.push(D,T,T,I,I,D)}}else if(g!==void 0){const A=g.array;x=g.version;for(let w=0,E=A.length/3-1;w<E;w+=3){const D=w+0,T=w+1,I=w+2;d.push(D,T,T,I,I,D)}}else return;const y=new(_Y(d)?lF:oF)(d,1);y.version=x;const b=s.get(h);b&&t.remove(b),s.set(h,y)}function u(h){const d=s.get(h);if(d){const p=h.index;p!==null&&d.version<p.version&&c(h)}else c(h);return s.get(h)}return{get:o,update:l,getWireframeAttribute:u}}function Nhe(e,t,i){let n;function r(d){n=d}let s,a;function o(d){s=d.type,a=d.bytesPerElement}function l(d,p){e.drawElements(n,p,s,d*a),i.update(p,n,1)}function c(d,p,g){g!==0&&(e.drawElementsInstanced(n,p,s,d*a,g),i.update(p,n,g))}function u(d,p,g){if(g===0)return;t.get("WEBGL_multi_draw").multiDrawElementsWEBGL(n,p,0,s,d,0,g);let y=0;for(let b=0;b<g;b++)y+=p[b];i.update(y,n,1)}function h(d,p,g,x){if(g===0)return;const y=t.get("WEBGL_multi_draw");if(y===null)for(let b=0;b<d.length;b++)c(d[b]/a,p[b],x[b]);else{y.multiDrawElementsInstancedWEBGL(n,p,0,s,d,0,x,0,g);let b=0;for(let A=0;A<g;A++)b+=p[A]*x[A];i.update(b,n,1)}}this.setMode=r,this.setIndex=o,this.render=l,this.renderInstances=c,this.renderMultiDraw=u,this.renderMultiDrawInstances=h}function zhe(e){const t={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function n(s,a,o){switch(i.calls++,a){case e.TRIANGLES:i.triangles+=o*(s/3);break;case e.LINES:i.lines+=o*(s/2);break;case e.LINE_STRIP:i.lines+=o*(s-1);break;case e.LINE_LOOP:i.lines+=o*s;break;case e.POINTS:i.points+=o*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function r(){i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:t,render:i,programs:null,autoReset:!0,reset:r,update:n}}function Fhe(e,t,i){const n=new WeakMap,r=new Rn;function s(a,o,l){const c=a.morphTargetInfluences,u=o.morphAttributes.position||o.morphAttributes.normal||o.morphAttributes.color,h=u!==void 0?u.length:0;let d=n.get(o);if(d===void 0||d.count!==h){let O=function(){I.dispose(),n.delete(o),o.removeEventListener("dispose",O)};d!==void 0&&d.texture.dispose();const p=o.morphAttributes.position!==void 0,g=o.morphAttributes.normal!==void 0,x=o.morphAttributes.color!==void 0,y=o.morphAttributes.position||[],b=o.morphAttributes.normal||[],A=o.morphAttributes.color||[];let w=0;p===!0&&(w=1),g===!0&&(w=2),x===!0&&(w=3);let E=o.attributes.position.count*w,D=1;E>t.maxTextureSize&&(D=Math.ceil(E/t.maxTextureSize),E=t.maxTextureSize);const T=new Float32Array(E*D*4*h),I=new pR(T,E,D,h);I.type=Tl,I.needsUpdate=!0;const R=w*4;for(let P=0;P<h;P++){const U=y[P],H=b[P],V=A[P],j=E*D*4*P;for(let J=0;J<U.count;J++){const F=J*R;p===!0&&(r.fromBufferAttribute(U,J),T[j+F+0]=r.x,T[j+F+1]=r.y,T[j+F+2]=r.z,T[j+F+3]=0),g===!0&&(r.fromBufferAttribute(H,J),T[j+F+4]=r.x,T[j+F+5]=r.y,T[j+F+6]=r.z,T[j+F+7]=0),x===!0&&(r.fromBufferAttribute(V,J),T[j+F+8]=r.x,T[j+F+9]=r.y,T[j+F+10]=r.z,T[j+F+11]=V.itemSize===4?r.w:1)}}d={count:h,texture:I,size:new Mt(E,D)},n.set(o,d),o.addEventListener("dispose",O)}if(a.isInstancedMesh===!0&&a.morphTexture!==null)l.getUniforms().setValue(e,"morphTexture",a.morphTexture,i);else{let p=0;for(let x=0;x<c.length;x++)p+=c[x];const g=o.morphTargetsRelative?1:1-p;l.getUniforms().setValue(e,"morphTargetBaseInfluence",g),l.getUniforms().setValue(e,"morphTargetInfluences",c)}l.getUniforms().setValue(e,"morphTargetsTexture",d.texture,i),l.getUniforms().setValue(e,"morphTargetsTextureSize",d.size)}return{update:s}}function Vhe(e,t,i,n){let r=new WeakMap;function s(l){const c=n.render.frame,u=l.geometry,h=t.get(l,u);if(r.get(h)!==c&&(t.update(h),r.set(h,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",o)===!1&&l.addEventListener("dispose",o),r.get(l)!==c&&(i.update(l.instanceMatrix,e.ARRAY_BUFFER),l.instanceColor!==null&&i.update(l.instanceColor,e.ARRAY_BUFFER),r.set(l,c))),l.isSkinnedMesh){const d=l.skeleton;r.get(d)!==c&&(d.update(),r.set(d,c))}return h}function a(){r=new WeakMap}function o(l){const c=l.target;c.removeEventListener("dispose",o),i.remove(c.instanceMatrix),c.instanceColor!==null&&i.remove(c.instanceColor)}return{update:s,dispose:a}}const yQ=new vr,EG=new vF(1,1),xQ=new pR,bQ=new mR,SQ=new Gw,TG=[],CG=[],DG=new Float32Array(16),RG=new Float32Array(9),PG=new Float32Array(4);function Sb(e,t,i){const n=e[0];if(n<=0||n>0)return e;const r=t*i;let s=TG[r];if(s===void 0&&(s=new Float32Array(r),TG[r]=s),t!==0){n.toArray(s,0);for(let a=1,o=0;a!==t;++a)o+=i,e[a].toArray(s,o)}return s}function Zs(e,t){if(e.length!==t.length)return!1;for(let i=0,n=e.length;i<n;i++)if(e[i]!==t[i])return!1;return!0}function $s(e,t){for(let i=0,n=t.length;i<n;i++)e[i]=t[i]}function UR(e,t){let i=CG[t];i===void 0&&(i=new Int32Array(t),CG[t]=i);for(let n=0;n!==t;++n)i[n]=e.allocateTextureUnit();return i}function Hhe(e,t){const i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function Ghe(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Zs(i,t))return;e.uniform2fv(this.addr,t),$s(i,t)}}function khe(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(t.r!==void 0)(i[0]!==t.r||i[1]!==t.g||i[2]!==t.b)&&(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(Zs(i,t))return;e.uniform3fv(this.addr,t),$s(i,t)}}function jhe(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Zs(i,t))return;e.uniform4fv(this.addr,t),$s(i,t)}}function Whe(e,t){const i=this.cache,n=t.elements;if(n===void 0){if(Zs(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),$s(i,t)}else{if(Zs(i,n))return;PG.set(n),e.uniformMatrix2fv(this.addr,!1,PG),$s(i,n)}}function Xhe(e,t){const i=this.cache,n=t.elements;if(n===void 0){if(Zs(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),$s(i,t)}else{if(Zs(i,n))return;RG.set(n),e.uniformMatrix3fv(this.addr,!1,RG),$s(i,n)}}function qhe(e,t){const i=this.cache,n=t.elements;if(n===void 0){if(Zs(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),$s(i,t)}else{if(Zs(i,n))return;DG.set(n),e.uniformMatrix4fv(this.addr,!1,DG),$s(i,n)}}function Yhe(e,t){const i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function Qhe(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2i(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Zs(i,t))return;e.uniform2iv(this.addr,t),$s(i,t)}}function Khe(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3i(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(Zs(i,t))return;e.uniform3iv(this.addr,t),$s(i,t)}}function Jhe(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Zs(i,t))return;e.uniform4iv(this.addr,t),$s(i,t)}}function Zhe(e,t){const i=this.cache;i[0]!==t&&(e.uniform1ui(this.addr,t),i[0]=t)}function $he(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2ui(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Zs(i,t))return;e.uniform2uiv(this.addr,t),$s(i,t)}}function ede(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3ui(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(Zs(i,t))return;e.uniform3uiv(this.addr,t),$s(i,t)}}function tde(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Zs(i,t))return;e.uniform4uiv(this.addr,t),$s(i,t)}}function ide(e,t,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r);let s;this.type===e.SAMPLER_2D_SHADOW?(EG.compareFunction=nF,s=EG):s=yQ,i.setTexture2D(t||s,r)}function nde(e,t,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTexture3D(t||bQ,r)}function rde(e,t,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTextureCube(t||SQ,r)}function sde(e,t,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTexture2DArray(t||xQ,r)}function ade(e){switch(e){case 5126:return Hhe;case 35664:return Ghe;case 35665:return khe;case 35666:return jhe;case 35674:return Whe;case 35675:return Xhe;case 35676:return qhe;case 5124:case 35670:return Yhe;case 35667:case 35671:return Qhe;case 35668:case 35672:return Khe;case 35669:case 35673:return Jhe;case 5125:return Zhe;case 36294:return $he;case 36295:return ede;case 36296:return tde;case 35678:case 36198:case 36298:case 36306:case 35682:return ide;case 35679:case 36299:case 36307:return nde;case 35680:case 36300:case 36308:case 36293:return rde;case 36289:case 36303:case 36311:case 36292:return sde}}function ode(e,t){e.uniform1fv(this.addr,t)}function lde(e,t){const i=Sb(t,this.size,2);e.uniform2fv(this.addr,i)}function cde(e,t){const i=Sb(t,this.size,3);e.uniform3fv(this.addr,i)}function ude(e,t){const i=Sb(t,this.size,4);e.uniform4fv(this.addr,i)}function hde(e,t){const i=Sb(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function dde(e,t){const i=Sb(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function fde(e,t){const i=Sb(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function pde(e,t){e.uniform1iv(this.addr,t)}function mde(e,t){e.uniform2iv(this.addr,t)}function gde(e,t){e.uniform3iv(this.addr,t)}function vde(e,t){e.uniform4iv(this.addr,t)}function yde(e,t){e.uniform1uiv(this.addr,t)}function xde(e,t){e.uniform2uiv(this.addr,t)}function bde(e,t){e.uniform3uiv(this.addr,t)}function Sde(e,t){e.uniform4uiv(this.addr,t)}function _de(e,t,i){const n=this.cache,r=t.length,s=UR(i,r);Zs(n,s)||(e.uniform1iv(this.addr,s),$s(n,s));for(let a=0;a!==r;++a)i.setTexture2D(t[a]||yQ,s[a])}function Ade(e,t,i){const n=this.cache,r=t.length,s=UR(i,r);Zs(n,s)||(e.uniform1iv(this.addr,s),$s(n,s));for(let a=0;a!==r;++a)i.setTexture3D(t[a]||bQ,s[a])}function wde(e,t,i){const n=this.cache,r=t.length,s=UR(i,r);Zs(n,s)||(e.uniform1iv(this.addr,s),$s(n,s));for(let a=0;a!==r;++a)i.setTextureCube(t[a]||SQ,s[a])}function Mde(e,t,i){const n=this.cache,r=t.length,s=UR(i,r);Zs(n,s)||(e.uniform1iv(this.addr,s),$s(n,s));for(let a=0;a!==r;++a)i.setTexture2DArray(t[a]||xQ,s[a])}function Ede(e){switch(e){case 5126:return ode;case 35664:return lde;case 35665:return cde;case 35666:return ude;case 35674:return hde;case 35675:return dde;case 35676:return fde;case 5124:case 35670:return pde;case 35667:case 35671:return mde;case 35668:case 35672:return gde;case 35669:case 35673:return vde;case 5125:return yde;case 36294:return xde;case 36295:return bde;case 36296:return Sde;case 35678:case 36198:case 36298:case 36306:case 35682:return _de;case 35679:case 36299:case 36307:return Ade;case 35680:case 36300:case 36308:case 36293:return wde;case 36289:case 36303:case 36311:case 36292:return Mde}}class Tde{constructor(t,i,n){this.id=t,this.addr=n,this.cache=[],this.type=i.type,this.setValue=ade(i.type)}}class Cde{constructor(t,i,n){this.id=t,this.addr=n,this.cache=[],this.type=i.type,this.size=i.size,this.setValue=Ede(i.type)}}class Dde{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,i,n){const r=this.seq;for(let s=0,a=r.length;s!==a;++s){const o=r[s];o.setValue(t,i[o.id],n)}}}const YO=/(\w+)(\])?(\[|\.)?/g;function OG(e,t){e.seq.push(t),e.map[t.id]=t}function Rde(e,t,i){const n=e.name,r=n.length;for(YO.lastIndex=0;;){const s=YO.exec(n),a=YO.lastIndex;let o=s[1];const l=s[2]==="]",c=s[3];if(l&&(o=o|0),c===void 0||c==="["&&a+2===r){OG(i,c===void 0?new Tde(o,e,t):new Cde(o,e,t));break}else{let h=i.map[o];h===void 0&&(h=new Dde(o),OG(i,h)),i=h}}}class MC{constructor(t,i){this.seq=[],this.map={};const n=t.getProgramParameter(i,t.ACTIVE_UNIFORMS);for(let r=0;r<n;++r){const s=t.getActiveUniform(i,r),a=t.getUniformLocation(i,s.name);Rde(s,a,this)}}setValue(t,i,n,r){const s=this.map[i];s!==void 0&&s.setValue(t,n,r)}setOptional(t,i,n){const r=i[n];r!==void 0&&this.setValue(t,n,r)}static upload(t,i,n,r){for(let s=0,a=i.length;s!==a;++s){const o=i[s],l=n[o.id];l.needsUpdate!==!1&&o.setValue(t,l.value,r)}}static seqWithValue(t,i){const n=[];for(let r=0,s=t.length;r!==s;++r){const a=t[r];a.id in i&&n.push(a)}return n}}function BG(e,t,i){const n=e.createShader(t);return e.shaderSource(n,i),e.compileShader(n),n}const Pde=37297;let Ode=0;function Bde(e,t){const i=e.split(`
`),n=[],r=Math.max(t-6,0),s=Math.min(t+6,i.length);for(let a=r;a<s;a++){const o=a+1;n.push(`${o===t?">":" "} ${o}: ${i[a]}`)}return n.join(`
`)}const IG=new Ki;function Ide(e){_n._getMatrix(IG,_n.workingColorSpace,e);const t=`mat3( ${IG.elements.map(i=>i.toFixed(4))} )`;switch(_n.getTransfer(e)){case JA:return[t,"LinearTransferOETF"];case Jn:return[t,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",e),[t,"LinearTransferOETF"]}}function LG(e,t,i){const n=e.getShaderParameter(t,e.COMPILE_STATUS),r=e.getShaderInfoLog(t).trim();if(n&&r==="")return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const a=parseInt(s[1]);return i.toUpperCase()+`

`+r+`

`+Bde(e.getShaderSource(t),a)}else return r}function Lde(e,t){const i=Ide(t);return[`vec4 ${e}( vec4 value ) {`,`	return ${i[1]}( vec4( value.rgb * ${i[0]}, value.a ) );`,"}"].join(`
`)}function Ude(e,t){let i;switch(t){case tY:i="Linear";break;case iY:i="Reinhard";break;case nY:i="Cineon";break;case qz:i="ACESFilmic";break;case sY:i="AgX";break;case aY:i="Neutral";break;case rY:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),i="Linear"}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}const G2=new me;function Nde(){_n.getLuminanceCoefficients(G2);const e=G2.x.toFixed(4),t=G2.y.toFixed(4),i=G2.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${e}, ${t}, ${i} );`,"	return dot( weights, rgb );","}"].join(`
`)}function zde(e){return[e.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",e.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(nA).join(`
`)}function Fde(e){const t=[];for(const i in e){const n=e[i];n!==!1&&t.push("#define "+i+" "+n)}return t.join(`
`)}function Vde(e,t){const i={},n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let r=0;r<n;r++){const s=e.getActiveAttrib(t,r),a=s.name;let o=1;s.type===e.FLOAT_MAT2&&(o=2),s.type===e.FLOAT_MAT3&&(o=3),s.type===e.FLOAT_MAT4&&(o=4),i[a]={type:s.type,location:e.getAttribLocation(t,a),locationSize:o}}return i}function nA(e){return e!==""}function UG(e,t){const i=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function NG(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const Hde=/^[ \t]*#include +<([\w\d./]+)>/gm;function oU(e){return e.replace(Hde,kde)}const Gde=new Map;function kde(e,t){let i=nn[t];if(i===void 0){const n=Gde.get(t);if(n!==void 0)i=nn[n],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,n);else throw new Error("Can not resolve #include <"+t+">")}return oU(i)}const jde=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function zG(e){return e.replace(jde,Wde)}function Wde(e,t,i,n){let r="";for(let s=parseInt(t);s<parseInt(i);s++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function FG(e){let t=`precision ${e.precision} float;
	precision ${e.precision} int;
	precision ${e.precision} sampler2D;
	precision ${e.precision} samplerCube;
	precision ${e.precision} sampler3D;
	precision ${e.precision} sampler2DArray;
	precision ${e.precision} sampler2DShadow;
	precision ${e.precision} samplerCubeShadow;
	precision ${e.precision} sampler2DArrayShadow;
	precision ${e.precision} isampler2D;
	precision ${e.precision} isampler3D;
	precision ${e.precision} isamplerCube;
	precision ${e.precision} isampler2DArray;
	precision ${e.precision} usampler2D;
	precision ${e.precision} usampler3D;
	precision ${e.precision} usamplerCube;
	precision ${e.precision} usampler2DArray;
	`;return e.precision==="highp"?t+=`
#define HIGH_PRECISION`:e.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:e.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function Xde(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===rR?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===gA?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===Hu&&(t="SHADOWMAP_TYPE_VSM"),t}function qde(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case Jf:case Jm:t="ENVMAP_TYPE_CUBE";break;case gb:t="ENVMAP_TYPE_CUBE_UV";break}return t}function Yde(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case Jm:t="ENVMAP_MODE_REFRACTION";break}return t}function Qde(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case Vw:t="ENVMAP_BLENDING_MULTIPLY";break;case $q:t="ENVMAP_BLENDING_MIX";break;case eY:t="ENVMAP_BLENDING_ADD";break}return t}function Kde(e){const t=e.envMapCubeUVHeight;if(t===null)return null;const i=Math.log2(t)-2,n=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,i),7*16)),texelHeight:n,maxMip:i}}function Jde(e,t,i,n){const r=e.getContext(),s=i.defines;let a=i.vertexShader,o=i.fragmentShader;const l=Xde(i),c=qde(i),u=Yde(i),h=Qde(i),d=Kde(i),p=zde(i),g=Fde(s),x=r.createProgram();let y,b,A=i.glslVersion?"#version "+i.glslVersion+`
`:"";i.isRawShaderMaterial?(y=["#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,g].filter(nA).join(`
`),y.length>0&&(y+=`
`),b=["#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,g].filter(nA).join(`
`),b.length>0&&(b+=`
`)):(y=[FG(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,g,i.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",i.batching?"#define USE_BATCHING":"",i.batchingColor?"#define USE_BATCHING_COLOR":"",i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.instancingMorph?"#define USE_INSTANCING_MORPH":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+u:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.displacementMap?"#define USE_DISPLACEMENTMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.mapUv?"#define MAP_UV "+i.mapUv:"",i.alphaMapUv?"#define ALPHAMAP_UV "+i.alphaMapUv:"",i.lightMapUv?"#define LIGHTMAP_UV "+i.lightMapUv:"",i.aoMapUv?"#define AOMAP_UV "+i.aoMapUv:"",i.emissiveMapUv?"#define EMISSIVEMAP_UV "+i.emissiveMapUv:"",i.bumpMapUv?"#define BUMPMAP_UV "+i.bumpMapUv:"",i.normalMapUv?"#define NORMALMAP_UV "+i.normalMapUv:"",i.displacementMapUv?"#define DISPLACEMENTMAP_UV "+i.displacementMapUv:"",i.metalnessMapUv?"#define METALNESSMAP_UV "+i.metalnessMapUv:"",i.roughnessMapUv?"#define ROUGHNESSMAP_UV "+i.roughnessMapUv:"",i.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+i.anisotropyMapUv:"",i.clearcoatMapUv?"#define CLEARCOATMAP_UV "+i.clearcoatMapUv:"",i.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+i.clearcoatNormalMapUv:"",i.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+i.clearcoatRoughnessMapUv:"",i.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+i.iridescenceMapUv:"",i.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+i.iridescenceThicknessMapUv:"",i.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+i.sheenColorMapUv:"",i.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+i.sheenRoughnessMapUv:"",i.specularMapUv?"#define SPECULARMAP_UV "+i.specularMapUv:"",i.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+i.specularColorMapUv:"",i.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+i.specularIntensityMapUv:"",i.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+i.transmissionMapUv:"",i.thicknessMapUv?"#define THICKNESSMAP_UV "+i.thicknessMapUv:"",i.vertexTangents&&i.flatShading===!1?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.morphColors?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(nA).join(`
`),b=[FG(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,g,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.envMap?"#define "+u:"",i.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.dispersion?"#define USE_DISPERSION":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.vertexTangents&&i.flatShading===!1?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor||i.batchingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==ud?"#define TONE_MAPPING":"",i.toneMapping!==ud?nn.tonemapping_pars_fragment:"",i.toneMapping!==ud?Ude("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",nn.colorspace_pars_fragment,Lde("linearToOutputTexel",i.outputColorSpace),Nde(),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(nA).join(`
`)),a=oU(a),a=UG(a,i),a=NG(a,i),o=oU(o),o=UG(o,i),o=NG(o,i),a=zG(a),o=zG(o),i.isRawShaderMaterial!==!0&&(A=`#version 300 es
`,y=[p,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+y,b=["#define varying in",i.glslVersion===ZL?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===ZL?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+b);const w=A+y+a,E=A+b+o,D=BG(r,r.VERTEX_SHADER,w),T=BG(r,r.FRAGMENT_SHADER,E);r.attachShader(x,D),r.attachShader(x,T),i.index0AttributeName!==void 0?r.bindAttribLocation(x,0,i.index0AttributeName):i.morphTargets===!0&&r.bindAttribLocation(x,0,"position"),r.linkProgram(x);function I(U){if(e.debug.checkShaderErrors){const H=r.getProgramInfoLog(x).trim(),V=r.getShaderInfoLog(D).trim(),j=r.getShaderInfoLog(T).trim();let J=!0,F=!0;if(r.getProgramParameter(x,r.LINK_STATUS)===!1)if(J=!1,typeof e.debug.onShaderError=="function")e.debug.onShaderError(r,x,D,T);else{const X=LG(r,D,"vertex"),W=LG(r,T,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(x,r.VALIDATE_STATUS)+`

Material Name: `+U.name+`
Material Type: `+U.type+`

Program Info Log: `+H+`
`+X+`
`+W)}else H!==""?console.warn("THREE.WebGLProgram: Program Info Log:",H):(V===""||j==="")&&(F=!1);F&&(U.diagnostics={runnable:J,programLog:H,vertexShader:{log:V,prefix:y},fragmentShader:{log:j,prefix:b}})}r.deleteShader(D),r.deleteShader(T),R=new MC(r,x),O=Vde(r,x)}let R;this.getUniforms=function(){return R===void 0&&I(this),R};let O;this.getAttributes=function(){return O===void 0&&I(this),O};let P=i.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return P===!1&&(P=r.getProgramParameter(x,Pde)),P},this.destroy=function(){n.releaseStatesOfProgram(this),r.deleteProgram(x),this.program=void 0},this.type=i.shaderType,this.name=i.shaderName,this.id=Ode++,this.cacheKey=t,this.usedTimes=1,this.program=x,this.vertexShader=D,this.fragmentShader=T,this}let Zde=0;class $de{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const i=t.vertexShader,n=t.fragmentShader,r=this._getShaderStage(i),s=this._getShaderStage(n),a=this._getShaderCacheForMaterial(t);return a.has(r)===!1&&(a.add(r),r.usedTimes++),a.has(s)===!1&&(a.add(s),s.usedTimes++),this}remove(t){const i=this.materialCache.get(t);for(const n of i)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const i=this.materialCache;let n=i.get(t);return n===void 0&&(n=new Set,i.set(t,n)),n}_getShaderStage(t){const i=this.shaderCache;let n=i.get(t);return n===void 0&&(n=new efe(t),i.set(t,n)),n}}class efe{constructor(t){this.id=Zde++,this.code=t,this.usedTimes=0}}function tfe(e,t,i,n,r,s,a){const o=new X1,l=new $de,c=new Set,u=[],h=r.logarithmicDepthBuffer,d=r.vertexTextures;let p=r.precision;const g={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function x(O){return c.add(O),O===0?"uv":`uv${O}`}function y(O,P,U,H,V){const j=H.fog,J=V.geometry,F=O.isMeshStandardMaterial?H.environment:null,X=(O.isMeshStandardMaterial?i:t).get(O.envMap||F),W=X&&X.mapping===gb?X.image.height:null,ne=g[O.type];O.precision!==null&&(p=r.getMaxPrecision(O.precision),p!==O.precision&&console.warn("THREE.WebGLProgram.getParameters:",O.precision,"not supported, using",p,"instead."));const Y=J.morphAttributes.position||J.morphAttributes.normal||J.morphAttributes.color,$=Y!==void 0?Y.length:0;let se=0;J.morphAttributes.position!==void 0&&(se=1),J.morphAttributes.normal!==void 0&&(se=2),J.morphAttributes.color!==void 0&&(se=3);let fe,te,de,le;if(ne){const Jt=Gu[ne];fe=Jt.vertexShader,te=Jt.fragmentShader}else fe=O.vertexShader,te=O.fragmentShader,l.update(O),de=l.getVertexShaderID(O),le=l.getFragmentShaderID(O);const _e=e.getRenderTarget(),be=e.state.buffers.depth.getReversed(),we=V.isInstancedMesh===!0,Me=V.isBatchedMesh===!0,Ne=!!O.map,Ge=!!O.matcap,We=!!X,ae=!!O.aoMap,He=!!O.lightMap,Ke=!!O.bumpMap,je=!!O.normalMap,Oe=!!O.displacementMap,Qe=!!O.emissiveMap,$e=!!O.metalnessMap,gt=!!O.roughnessMap,pe=O.anisotropy>0,k=O.clearcoat>0,Q=O.dispersion>0,xe=O.iridescence>0,K=O.sheen>0,Re=O.transmission>0,Le=pe&&!!O.anisotropyMap,st=k&&!!O.clearcoatMap,Be=k&&!!O.clearcoatNormalMap,bt=k&&!!O.clearcoatRoughnessMap,vt=xe&&!!O.iridescenceMap,Xe=xe&&!!O.iridescenceThicknessMap,xt=K&&!!O.sheenColorMap,_t=K&&!!O.sheenRoughnessMap,ye=!!O.specularMap,Ve=!!O.specularColorMap,At=!!O.specularIntensityMap,ie=Re&&!!O.transmissionMap,Ce=Re&&!!O.thicknessMap,De=!!O.gradientMap,at=!!O.alphaMap,ut=O.alphaTest>0,lt=!!O.alphaHash,It=!!O.extensions;let Vt=ud;O.toneMapped&&(_e===null||_e.isXRRenderTarget===!0)&&(Vt=e.toneMapping);const _i={shaderID:ne,shaderType:O.type,shaderName:O.name,vertexShader:fe,fragmentShader:te,defines:O.defines,customVertexShaderID:de,customFragmentShaderID:le,isRawShaderMaterial:O.isRawShaderMaterial===!0,glslVersion:O.glslVersion,precision:p,batching:Me,batchingColor:Me&&V._colorsTexture!==null,instancing:we,instancingColor:we&&V.instanceColor!==null,instancingMorph:we&&V.morphTexture!==null,supportsVertexTextures:d,outputColorSpace:_e===null?e.outputColorSpace:_e.isXRRenderTarget===!0?_e.texture.colorSpace:$m,alphaToCoverage:!!O.alphaToCoverage,map:Ne,matcap:Ge,envMap:We,envMapMode:We&&X.mapping,envMapCubeUVHeight:W,aoMap:ae,lightMap:He,bumpMap:Ke,normalMap:je,displacementMap:d&&Oe,emissiveMap:Qe,normalMapObjectSpace:je&&O.normalMapType===pY,normalMapTangentSpace:je&&O.normalMapType===lg,metalnessMap:$e,roughnessMap:gt,anisotropy:pe,anisotropyMap:Le,clearcoat:k,clearcoatMap:st,clearcoatNormalMap:Be,clearcoatRoughnessMap:bt,dispersion:Q,iridescence:xe,iridescenceMap:vt,iridescenceThicknessMap:Xe,sheen:K,sheenColorMap:xt,sheenRoughnessMap:_t,specularMap:ye,specularColorMap:Ve,specularIntensityMap:At,transmission:Re,transmissionMap:ie,thicknessMap:Ce,gradientMap:De,opaque:O.transparent===!1&&O.blending===f0&&O.alphaToCoverage===!1,alphaMap:at,alphaTest:ut,alphaHash:lt,combine:O.combine,mapUv:Ne&&x(O.map.channel),aoMapUv:ae&&x(O.aoMap.channel),lightMapUv:He&&x(O.lightMap.channel),bumpMapUv:Ke&&x(O.bumpMap.channel),normalMapUv:je&&x(O.normalMap.channel),displacementMapUv:Oe&&x(O.displacementMap.channel),emissiveMapUv:Qe&&x(O.emissiveMap.channel),metalnessMapUv:$e&&x(O.metalnessMap.channel),roughnessMapUv:gt&&x(O.roughnessMap.channel),anisotropyMapUv:Le&&x(O.anisotropyMap.channel),clearcoatMapUv:st&&x(O.clearcoatMap.channel),clearcoatNormalMapUv:Be&&x(O.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:bt&&x(O.clearcoatRoughnessMap.channel),iridescenceMapUv:vt&&x(O.iridescenceMap.channel),iridescenceThicknessMapUv:Xe&&x(O.iridescenceThicknessMap.channel),sheenColorMapUv:xt&&x(O.sheenColorMap.channel),sheenRoughnessMapUv:_t&&x(O.sheenRoughnessMap.channel),specularMapUv:ye&&x(O.specularMap.channel),specularColorMapUv:Ve&&x(O.specularColorMap.channel),specularIntensityMapUv:At&&x(O.specularIntensityMap.channel),transmissionMapUv:ie&&x(O.transmissionMap.channel),thicknessMapUv:Ce&&x(O.thicknessMap.channel),alphaMapUv:at&&x(O.alphaMap.channel),vertexTangents:!!J.attributes.tangent&&(je||pe),vertexColors:O.vertexColors,vertexAlphas:O.vertexColors===!0&&!!J.attributes.color&&J.attributes.color.itemSize===4,pointsUvs:V.isPoints===!0&&!!J.attributes.uv&&(Ne||at),fog:!!j,useFog:O.fog===!0,fogExp2:!!j&&j.isFogExp2,flatShading:O.flatShading===!0,sizeAttenuation:O.sizeAttenuation===!0,logarithmicDepthBuffer:h,reverseDepthBuffer:be,skinning:V.isSkinnedMesh===!0,morphTargets:J.morphAttributes.position!==void 0,morphNormals:J.morphAttributes.normal!==void 0,morphColors:J.morphAttributes.color!==void 0,morphTargetsCount:$,morphTextureStride:se,numDirLights:P.directional.length,numPointLights:P.point.length,numSpotLights:P.spot.length,numSpotLightMaps:P.spotLightMap.length,numRectAreaLights:P.rectArea.length,numHemiLights:P.hemi.length,numDirLightShadows:P.directionalShadowMap.length,numPointLightShadows:P.pointShadowMap.length,numSpotLightShadows:P.spotShadowMap.length,numSpotLightShadowsWithMaps:P.numSpotLightShadowsWithMaps,numLightProbes:P.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:O.dithering,shadowMapEnabled:e.shadowMap.enabled&&U.length>0,shadowMapType:e.shadowMap.type,toneMapping:Vt,decodeVideoTexture:Ne&&O.map.isVideoTexture===!0&&_n.getTransfer(O.map.colorSpace)===Jn,decodeVideoTextureEmissive:Qe&&O.emissiveMap.isVideoTexture===!0&&_n.getTransfer(O.emissiveMap.colorSpace)===Jn,premultipliedAlpha:O.premultipliedAlpha,doubleSided:O.side===Hc,flipSided:O.side===el,useDepthPacking:O.depthPacking>=0,depthPacking:O.depthPacking||0,index0AttributeName:O.index0AttributeName,extensionClipCullDistance:It&&O.extensions.clipCullDistance===!0&&n.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(It&&O.extensions.multiDraw===!0||Me)&&n.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:n.has("KHR_parallel_shader_compile"),customProgramCacheKey:O.customProgramCacheKey()};return _i.vertexUv1s=c.has(1),_i.vertexUv2s=c.has(2),_i.vertexUv3s=c.has(3),c.clear(),_i}function b(O){const P=[];if(O.shaderID?P.push(O.shaderID):(P.push(O.customVertexShaderID),P.push(O.customFragmentShaderID)),O.defines!==void 0)for(const U in O.defines)P.push(U),P.push(O.defines[U]);return O.isRawShaderMaterial===!1&&(A(P,O),w(P,O),P.push(e.outputColorSpace)),P.push(O.customProgramCacheKey),P.join()}function A(O,P){O.push(P.precision),O.push(P.outputColorSpace),O.push(P.envMapMode),O.push(P.envMapCubeUVHeight),O.push(P.mapUv),O.push(P.alphaMapUv),O.push(P.lightMapUv),O.push(P.aoMapUv),O.push(P.bumpMapUv),O.push(P.normalMapUv),O.push(P.displacementMapUv),O.push(P.emissiveMapUv),O.push(P.metalnessMapUv),O.push(P.roughnessMapUv),O.push(P.anisotropyMapUv),O.push(P.clearcoatMapUv),O.push(P.clearcoatNormalMapUv),O.push(P.clearcoatRoughnessMapUv),O.push(P.iridescenceMapUv),O.push(P.iridescenceThicknessMapUv),O.push(P.sheenColorMapUv),O.push(P.sheenRoughnessMapUv),O.push(P.specularMapUv),O.push(P.specularColorMapUv),O.push(P.specularIntensityMapUv),O.push(P.transmissionMapUv),O.push(P.thicknessMapUv),O.push(P.combine),O.push(P.fogExp2),O.push(P.sizeAttenuation),O.push(P.morphTargetsCount),O.push(P.morphAttributeCount),O.push(P.numDirLights),O.push(P.numPointLights),O.push(P.numSpotLights),O.push(P.numSpotLightMaps),O.push(P.numHemiLights),O.push(P.numRectAreaLights),O.push(P.numDirLightShadows),O.push(P.numPointLightShadows),O.push(P.numSpotLightShadows),O.push(P.numSpotLightShadowsWithMaps),O.push(P.numLightProbes),O.push(P.shadowMapType),O.push(P.toneMapping),O.push(P.numClippingPlanes),O.push(P.numClipIntersection),O.push(P.depthPacking)}function w(O,P){o.disableAll(),P.supportsVertexTextures&&o.enable(0),P.instancing&&o.enable(1),P.instancingColor&&o.enable(2),P.instancingMorph&&o.enable(3),P.matcap&&o.enable(4),P.envMap&&o.enable(5),P.normalMapObjectSpace&&o.enable(6),P.normalMapTangentSpace&&o.enable(7),P.clearcoat&&o.enable(8),P.iridescence&&o.enable(9),P.alphaTest&&o.enable(10),P.vertexColors&&o.enable(11),P.vertexAlphas&&o.enable(12),P.vertexUv1s&&o.enable(13),P.vertexUv2s&&o.enable(14),P.vertexUv3s&&o.enable(15),P.vertexTangents&&o.enable(16),P.anisotropy&&o.enable(17),P.alphaHash&&o.enable(18),P.batching&&o.enable(19),P.dispersion&&o.enable(20),P.batchingColor&&o.enable(21),O.push(o.mask),o.disableAll(),P.fog&&o.enable(0),P.useFog&&o.enable(1),P.flatShading&&o.enable(2),P.logarithmicDepthBuffer&&o.enable(3),P.reverseDepthBuffer&&o.enable(4),P.skinning&&o.enable(5),P.morphTargets&&o.enable(6),P.morphNormals&&o.enable(7),P.morphColors&&o.enable(8),P.premultipliedAlpha&&o.enable(9),P.shadowMapEnabled&&o.enable(10),P.doubleSided&&o.enable(11),P.flipSided&&o.enable(12),P.useDepthPacking&&o.enable(13),P.dithering&&o.enable(14),P.transmission&&o.enable(15),P.sheen&&o.enable(16),P.opaque&&o.enable(17),P.pointsUvs&&o.enable(18),P.decodeVideoTexture&&o.enable(19),P.decodeVideoTextureEmissive&&o.enable(20),P.alphaToCoverage&&o.enable(21),O.push(o.mask)}function E(O){const P=g[O.type];let U;if(P){const H=Gu[P];U=TY.clone(H.uniforms)}else U=O.uniforms;return U}function D(O,P){let U;for(let H=0,V=u.length;H<V;H++){const j=u[H];if(j.cacheKey===P){U=j,++U.usedTimes;break}}return U===void 0&&(U=new Jde(e,P,O,s),u.push(U)),U}function T(O){if(--O.usedTimes===0){const P=u.indexOf(O);u[P]=u[u.length-1],u.pop(),O.destroy()}}function I(O){l.remove(O)}function R(){l.dispose()}return{getParameters:y,getProgramCacheKey:b,getUniforms:E,acquireProgram:D,releaseProgram:T,releaseShaderCache:I,programs:u,dispose:R}}function ife(){let e=new WeakMap;function t(a){return e.has(a)}function i(a){let o=e.get(a);return o===void 0&&(o={},e.set(a,o)),o}function n(a){e.delete(a)}function r(a,o,l){e.get(a)[o]=l}function s(){e=new WeakMap}return{has:t,get:i,remove:n,update:r,dispose:s}}function nfe(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function VG(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function HG(){const e=[];let t=0;const i=[],n=[],r=[];function s(){t=0,i.length=0,n.length=0,r.length=0}function a(h,d,p,g,x,y){let b=e[t];return b===void 0?(b={id:h.id,object:h,geometry:d,material:p,groupOrder:g,renderOrder:h.renderOrder,z:x,group:y},e[t]=b):(b.id=h.id,b.object=h,b.geometry=d,b.material=p,b.groupOrder=g,b.renderOrder=h.renderOrder,b.z=x,b.group=y),t++,b}function o(h,d,p,g,x,y){const b=a(h,d,p,g,x,y);p.transmission>0?n.push(b):p.transparent===!0?r.push(b):i.push(b)}function l(h,d,p,g,x,y){const b=a(h,d,p,g,x,y);p.transmission>0?n.unshift(b):p.transparent===!0?r.unshift(b):i.unshift(b)}function c(h,d){i.length>1&&i.sort(h||nfe),n.length>1&&n.sort(d||VG),r.length>1&&r.sort(d||VG)}function u(){for(let h=t,d=e.length;h<d;h++){const p=e[h];if(p.id===null)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.group=null}}return{opaque:i,transmissive:n,transparent:r,init:s,push:o,unshift:l,finish:u,sort:c}}function rfe(){let e=new WeakMap;function t(n,r){const s=e.get(n);let a;return s===void 0?(a=new HG,e.set(n,[a])):r>=s.length?(a=new HG,s.push(a)):a=s[r],a}function i(){e=new WeakMap}return{get:t,dispose:i}}function sfe(){const e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let i;switch(t.type){case"DirectionalLight":i={direction:new me,color:new jt};break;case"SpotLight":i={position:new me,direction:new me,color:new jt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new me,color:new jt,distance:0,decay:0};break;case"HemisphereLight":i={direction:new me,skyColor:new jt,groundColor:new jt};break;case"RectAreaLight":i={color:new jt,position:new me,halfWidth:new me,halfHeight:new me};break}return e[t.id]=i,i}}}function afe(){const e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let i;switch(t.type){case"DirectionalLight":i={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Mt};break;case"SpotLight":i={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Mt};break;case"PointLight":i={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Mt,shadowCameraNear:1,shadowCameraFar:1e3};break}return e[t.id]=i,i}}}let ofe=0;function lfe(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function cfe(e){const t=new sfe,i=afe(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let c=0;c<9;c++)n.probe.push(new me);const r=new me,s=new di,a=new di;function o(c){let u=0,h=0,d=0;for(let O=0;O<9;O++)n.probe[O].set(0,0,0);let p=0,g=0,x=0,y=0,b=0,A=0,w=0,E=0,D=0,T=0,I=0;c.sort(lfe);for(let O=0,P=c.length;O<P;O++){const U=c[O],H=U.color,V=U.intensity,j=U.distance,J=U.shadow&&U.shadow.map?U.shadow.map.texture:null;if(U.isAmbientLight)u+=H.r*V,h+=H.g*V,d+=H.b*V;else if(U.isLightProbe){for(let F=0;F<9;F++)n.probe[F].addScaledVector(U.sh.coefficients[F],V);I++}else if(U.isDirectionalLight){const F=t.get(U);if(F.color.copy(U.color).multiplyScalar(U.intensity),U.castShadow){const X=U.shadow,W=i.get(U);W.shadowIntensity=X.intensity,W.shadowBias=X.bias,W.shadowNormalBias=X.normalBias,W.shadowRadius=X.radius,W.shadowMapSize=X.mapSize,n.directionalShadow[p]=W,n.directionalShadowMap[p]=J,n.directionalShadowMatrix[p]=U.shadow.matrix,A++}n.directional[p]=F,p++}else if(U.isSpotLight){const F=t.get(U);F.position.setFromMatrixPosition(U.matrixWorld),F.color.copy(H).multiplyScalar(V),F.distance=j,F.coneCos=Math.cos(U.angle),F.penumbraCos=Math.cos(U.angle*(1-U.penumbra)),F.decay=U.decay,n.spot[x]=F;const X=U.shadow;if(U.map&&(n.spotLightMap[D]=U.map,D++,X.updateMatrices(U),U.castShadow&&T++),n.spotLightMatrix[x]=X.matrix,U.castShadow){const W=i.get(U);W.shadowIntensity=X.intensity,W.shadowBias=X.bias,W.shadowNormalBias=X.normalBias,W.shadowRadius=X.radius,W.shadowMapSize=X.mapSize,n.spotShadow[x]=W,n.spotShadowMap[x]=J,E++}x++}else if(U.isRectAreaLight){const F=t.get(U);F.color.copy(H).multiplyScalar(V),F.halfWidth.set(U.width*.5,0,0),F.halfHeight.set(0,U.height*.5,0),n.rectArea[y]=F,y++}else if(U.isPointLight){const F=t.get(U);if(F.color.copy(U.color).multiplyScalar(U.intensity),F.distance=U.distance,F.decay=U.decay,U.castShadow){const X=U.shadow,W=i.get(U);W.shadowIntensity=X.intensity,W.shadowBias=X.bias,W.shadowNormalBias=X.normalBias,W.shadowRadius=X.radius,W.shadowMapSize=X.mapSize,W.shadowCameraNear=X.camera.near,W.shadowCameraFar=X.camera.far,n.pointShadow[g]=W,n.pointShadowMap[g]=J,n.pointShadowMatrix[g]=U.shadow.matrix,w++}n.point[g]=F,g++}else if(U.isHemisphereLight){const F=t.get(U);F.skyColor.copy(U.color).multiplyScalar(V),F.groundColor.copy(U.groundColor).multiplyScalar(V),n.hemi[b]=F,b++}}y>0&&(e.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=Xt.LTC_FLOAT_1,n.rectAreaLTC2=Xt.LTC_FLOAT_2):(n.rectAreaLTC1=Xt.LTC_HALF_1,n.rectAreaLTC2=Xt.LTC_HALF_2)),n.ambient[0]=u,n.ambient[1]=h,n.ambient[2]=d;const R=n.hash;(R.directionalLength!==p||R.pointLength!==g||R.spotLength!==x||R.rectAreaLength!==y||R.hemiLength!==b||R.numDirectionalShadows!==A||R.numPointShadows!==w||R.numSpotShadows!==E||R.numSpotMaps!==D||R.numLightProbes!==I)&&(n.directional.length=p,n.spot.length=x,n.rectArea.length=y,n.point.length=g,n.hemi.length=b,n.directionalShadow.length=A,n.directionalShadowMap.length=A,n.pointShadow.length=w,n.pointShadowMap.length=w,n.spotShadow.length=E,n.spotShadowMap.length=E,n.directionalShadowMatrix.length=A,n.pointShadowMatrix.length=w,n.spotLightMatrix.length=E+D-T,n.spotLightMap.length=D,n.numSpotLightShadowsWithMaps=T,n.numLightProbes=I,R.directionalLength=p,R.pointLength=g,R.spotLength=x,R.rectAreaLength=y,R.hemiLength=b,R.numDirectionalShadows=A,R.numPointShadows=w,R.numSpotShadows=E,R.numSpotMaps=D,R.numLightProbes=I,n.version=ofe++)}function l(c,u){let h=0,d=0,p=0,g=0,x=0;const y=u.matrixWorldInverse;for(let b=0,A=c.length;b<A;b++){const w=c[b];if(w.isDirectionalLight){const E=n.directional[h];E.direction.setFromMatrixPosition(w.matrixWorld),r.setFromMatrixPosition(w.target.matrixWorld),E.direction.sub(r),E.direction.transformDirection(y),h++}else if(w.isSpotLight){const E=n.spot[p];E.position.setFromMatrixPosition(w.matrixWorld),E.position.applyMatrix4(y),E.direction.setFromMatrixPosition(w.matrixWorld),r.setFromMatrixPosition(w.target.matrixWorld),E.direction.sub(r),E.direction.transformDirection(y),p++}else if(w.isRectAreaLight){const E=n.rectArea[g];E.position.setFromMatrixPosition(w.matrixWorld),E.position.applyMatrix4(y),a.identity(),s.copy(w.matrixWorld),s.premultiply(y),a.extractRotation(s),E.halfWidth.set(w.width*.5,0,0),E.halfHeight.set(0,w.height*.5,0),E.halfWidth.applyMatrix4(a),E.halfHeight.applyMatrix4(a),g++}else if(w.isPointLight){const E=n.point[d];E.position.setFromMatrixPosition(w.matrixWorld),E.position.applyMatrix4(y),d++}else if(w.isHemisphereLight){const E=n.hemi[x];E.direction.setFromMatrixPosition(w.matrixWorld),E.direction.transformDirection(y),x++}}}return{setup:o,setupView:l,state:n}}function GG(e){const t=new cfe(e),i=[],n=[];function r(u){c.camera=u,i.length=0,n.length=0}function s(u){i.push(u)}function a(u){n.push(u)}function o(){t.setup(i)}function l(u){t.setupView(i,u)}const c={lightsArray:i,shadowsArray:n,camera:null,lights:t,transmissionRenderTarget:{}};return{init:r,state:c,setupLights:o,setupLightsView:l,pushLight:s,pushShadow:a}}function ufe(e){let t=new WeakMap;function i(r,s=0){const a=t.get(r);let o;return a===void 0?(o=new GG(e),t.set(r,[o])):s>=a.length?(o=new GG(e),a.push(o)):o=a[s],o}function n(){t=new WeakMap}return{get:i,dispose:n}}const hfe=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,dfe=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function ffe(e,t,i){let n=new yb;const r=new Mt,s=new Mt,a=new Rn,o=new wF({depthPacking:fY}),l=new MF,c={},u=i.maxTextureSize,h={[bd]:el,[el]:bd,[Hc]:Hc},d=new Ju({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Mt},radius:{value:4}},vertexShader:hfe,fragmentShader:dfe}),p=d.clone();p.defines.HORIZONTAL_PASS=1;const g=new ki;g.setAttribute("position",new Pn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const x=new ts(g,d),y=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=rR;let b=this.type;this.render=function(T,I,R){if(y.enabled===!1||y.autoUpdate===!1&&y.needsUpdate===!1||T.length===0)return;const O=e.getRenderTarget(),P=e.getActiveCubeFace(),U=e.getActiveMipmapLevel(),H=e.state;H.setBlending(Wf),H.buffers.color.setClear(1,1,1,1),H.buffers.depth.setTest(!0),H.setScissorTest(!1);const V=b!==Hu&&this.type===Hu,j=b===Hu&&this.type!==Hu;for(let J=0,F=T.length;J<F;J++){const X=T[J],W=X.shadow;if(W===void 0){console.warn("THREE.WebGLShadowMap:",X,"has no shadow.");continue}if(W.autoUpdate===!1&&W.needsUpdate===!1)continue;r.copy(W.mapSize);const ne=W.getFrameExtents();if(r.multiply(ne),s.copy(W.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(s.x=Math.floor(u/ne.x),r.x=s.x*ne.x,W.mapSize.x=s.x),r.y>u&&(s.y=Math.floor(u/ne.y),r.y=s.y*ne.y,W.mapSize.y=s.y)),W.map===null||V===!0||j===!0){const $=this.type!==Hu?{minFilter:xa,magFilter:xa}:{};W.map!==null&&W.map.dispose(),W.map=new Sd(r.x,r.y,$),W.map.texture.name=X.name+".shadowMap",W.camera.updateProjectionMatrix()}e.setRenderTarget(W.map),e.clear();const Y=W.getViewportCount();for(let $=0;$<Y;$++){const se=W.getViewport($);a.set(s.x*se.x,s.y*se.y,s.x*se.z,s.y*se.w),H.viewport(a),W.updateMatrices(X,$),n=W.getFrustum(),E(I,R,W.camera,X,this.type)}W.isPointLightShadow!==!0&&this.type===Hu&&A(W,R),W.needsUpdate=!1}b=this.type,y.needsUpdate=!1,e.setRenderTarget(O,P,U)};function A(T,I){const R=t.update(x);d.defines.VSM_SAMPLES!==T.blurSamples&&(d.defines.VSM_SAMPLES=T.blurSamples,p.defines.VSM_SAMPLES=T.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),T.mapPass===null&&(T.mapPass=new Sd(r.x,r.y)),d.uniforms.shadow_pass.value=T.map.texture,d.uniforms.resolution.value=T.mapSize,d.uniforms.radius.value=T.radius,e.setRenderTarget(T.mapPass),e.clear(),e.renderBufferDirect(I,null,R,d,x,null),p.uniforms.shadow_pass.value=T.mapPass.texture,p.uniforms.resolution.value=T.mapSize,p.uniforms.radius.value=T.radius,e.setRenderTarget(T.map),e.clear(),e.renderBufferDirect(I,null,R,p,x,null)}function w(T,I,R,O){let P=null;const U=R.isPointLight===!0?T.customDistanceMaterial:T.customDepthMaterial;if(U!==void 0)P=U;else if(P=R.isPointLight===!0?l:o,e.localClippingEnabled&&I.clipShadows===!0&&Array.isArray(I.clippingPlanes)&&I.clippingPlanes.length!==0||I.displacementMap&&I.displacementScale!==0||I.alphaMap&&I.alphaTest>0||I.map&&I.alphaTest>0||I.alphaToCoverage===!0){const H=P.uuid,V=I.uuid;let j=c[H];j===void 0&&(j={},c[H]=j);let J=j[V];J===void 0&&(J=P.clone(),j[V]=J,I.addEventListener("dispose",D)),P=J}if(P.visible=I.visible,P.wireframe=I.wireframe,O===Hu?P.side=I.shadowSide!==null?I.shadowSide:I.side:P.side=I.shadowSide!==null?I.shadowSide:h[I.side],P.alphaMap=I.alphaMap,P.alphaTest=I.alphaToCoverage===!0?.5:I.alphaTest,P.map=I.map,P.clipShadows=I.clipShadows,P.clippingPlanes=I.clippingPlanes,P.clipIntersection=I.clipIntersection,P.displacementMap=I.displacementMap,P.displacementScale=I.displacementScale,P.displacementBias=I.displacementBias,P.wireframeLinewidth=I.wireframeLinewidth,P.linewidth=I.linewidth,R.isPointLight===!0&&P.isMeshDistanceMaterial===!0){const H=e.properties.get(P);H.light=R}return P}function E(T,I,R,O,P){if(T.visible===!1)return;if(T.layers.test(I.layers)&&(T.isMesh||T.isLine||T.isPoints)&&(T.castShadow||T.receiveShadow&&P===Hu)&&(!T.frustumCulled||n.intersectsObject(T))){T.modelViewMatrix.multiplyMatrices(R.matrixWorldInverse,T.matrixWorld);const V=t.update(T),j=T.material;if(Array.isArray(j)){const J=V.groups;for(let F=0,X=J.length;F<X;F++){const W=J[F],ne=j[W.materialIndex];if(ne&&ne.visible){const Y=w(T,ne,O,P);T.onBeforeShadow(e,T,I,R,V,Y,W),e.renderBufferDirect(R,null,V,Y,T,W),T.onAfterShadow(e,T,I,R,V,Y,W)}}}else if(j.visible){const J=w(T,j,O,P);T.onBeforeShadow(e,T,I,R,V,J,null),e.renderBufferDirect(R,null,V,J,T,null),T.onAfterShadow(e,T,I,R,V,J,null)}}const H=T.children;for(let V=0,j=H.length;V<j;V++)E(H[V],I,R,O,P)}function D(T){T.target.removeEventListener("dispose",D);for(const R in c){const O=c[R],P=T.target.uuid;P in O&&(O[P].dispose(),delete O[P])}}}const pfe={[tD]:iD,[nD]:aD,[rD]:oD,[E0]:sD,[iD]:tD,[aD]:nD,[oD]:rD,[sD]:E0};function mfe(e,t){function i(){let ie=!1;const Ce=new Rn;let De=null;const at=new Rn(0,0,0,0);return{setMask:function(ut){De!==ut&&!ie&&(e.colorMask(ut,ut,ut,ut),De=ut)},setLocked:function(ut){ie=ut},setClear:function(ut,lt,It,Vt,_i){_i===!0&&(ut*=Vt,lt*=Vt,It*=Vt),Ce.set(ut,lt,It,Vt),at.equals(Ce)===!1&&(e.clearColor(ut,lt,It,Vt),at.copy(Ce))},reset:function(){ie=!1,De=null,at.set(-1,0,0,0)}}}function n(){let ie=!1,Ce=!1,De=null,at=null,ut=null;return{setReversed:function(lt){if(Ce!==lt){const It=t.get("EXT_clip_control");lt?It.clipControlEXT(It.LOWER_LEFT_EXT,It.ZERO_TO_ONE_EXT):It.clipControlEXT(It.LOWER_LEFT_EXT,It.NEGATIVE_ONE_TO_ONE_EXT),Ce=lt;const Vt=ut;ut=null,this.setClear(Vt)}},getReversed:function(){return Ce},setTest:function(lt){lt?_e(e.DEPTH_TEST):be(e.DEPTH_TEST)},setMask:function(lt){De!==lt&&!ie&&(e.depthMask(lt),De=lt)},setFunc:function(lt){if(Ce&&(lt=pfe[lt]),at!==lt){switch(lt){case tD:e.depthFunc(e.NEVER);break;case iD:e.depthFunc(e.ALWAYS);break;case nD:e.depthFunc(e.LESS);break;case E0:e.depthFunc(e.LEQUAL);break;case rD:e.depthFunc(e.EQUAL);break;case sD:e.depthFunc(e.GEQUAL);break;case aD:e.depthFunc(e.GREATER);break;case oD:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}at=lt}},setLocked:function(lt){ie=lt},setClear:function(lt){ut!==lt&&(Ce&&(lt=1-lt),e.clearDepth(lt),ut=lt)},reset:function(){ie=!1,De=null,at=null,ut=null,Ce=!1}}}function r(){let ie=!1,Ce=null,De=null,at=null,ut=null,lt=null,It=null,Vt=null,_i=null;return{setTest:function(Jt){ie||(Jt?_e(e.STENCIL_TEST):be(e.STENCIL_TEST))},setMask:function(Jt){Ce!==Jt&&!ie&&(e.stencilMask(Jt),Ce=Jt)},setFunc:function(Jt,An,$i){(De!==Jt||at!==An||ut!==$i)&&(e.stencilFunc(Jt,An,$i),De=Jt,at=An,ut=$i)},setOp:function(Jt,An,$i){(lt!==Jt||It!==An||Vt!==$i)&&(e.stencilOp(Jt,An,$i),lt=Jt,It=An,Vt=$i)},setLocked:function(Jt){ie=Jt},setClear:function(Jt){_i!==Jt&&(e.clearStencil(Jt),_i=Jt)},reset:function(){ie=!1,Ce=null,De=null,at=null,ut=null,lt=null,It=null,Vt=null,_i=null}}}const s=new i,a=new n,o=new r,l=new WeakMap,c=new WeakMap;let u={},h={},d=new WeakMap,p=[],g=null,x=!1,y=null,b=null,A=null,w=null,E=null,D=null,T=null,I=new jt(0,0,0),R=0,O=!1,P=null,U=null,H=null,V=null,j=null;const J=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let F=!1,X=0;const W=e.getParameter(e.VERSION);W.indexOf("WebGL")!==-1?(X=parseFloat(/^WebGL (\d)/.exec(W)[1]),F=X>=1):W.indexOf("OpenGL ES")!==-1&&(X=parseFloat(/^OpenGL ES (\d)/.exec(W)[1]),F=X>=2);let ne=null,Y={};const $=e.getParameter(e.SCISSOR_BOX),se=e.getParameter(e.VIEWPORT),fe=new Rn().fromArray($),te=new Rn().fromArray(se);function de(ie,Ce,De,at){const ut=new Uint8Array(4),lt=e.createTexture();e.bindTexture(ie,lt),e.texParameteri(ie,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(ie,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let It=0;It<De;It++)ie===e.TEXTURE_3D||ie===e.TEXTURE_2D_ARRAY?e.texImage3D(Ce,0,e.RGBA,1,1,at,0,e.RGBA,e.UNSIGNED_BYTE,ut):e.texImage2D(Ce+It,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,ut);return lt}const le={};le[e.TEXTURE_2D]=de(e.TEXTURE_2D,e.TEXTURE_2D,1),le[e.TEXTURE_CUBE_MAP]=de(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),le[e.TEXTURE_2D_ARRAY]=de(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),le[e.TEXTURE_3D]=de(e.TEXTURE_3D,e.TEXTURE_3D,1,1),s.setClear(0,0,0,1),a.setClear(1),o.setClear(0),_e(e.DEPTH_TEST),a.setFunc(E0),Ke(!1),je(XL),_e(e.CULL_FACE),ae(Wf);function _e(ie){u[ie]!==!0&&(e.enable(ie),u[ie]=!0)}function be(ie){u[ie]!==!1&&(e.disable(ie),u[ie]=!1)}function we(ie,Ce){return h[ie]!==Ce?(e.bindFramebuffer(ie,Ce),h[ie]=Ce,ie===e.DRAW_FRAMEBUFFER&&(h[e.FRAMEBUFFER]=Ce),ie===e.FRAMEBUFFER&&(h[e.DRAW_FRAMEBUFFER]=Ce),!0):!1}function Me(ie,Ce){let De=p,at=!1;if(ie){De=d.get(Ce),De===void 0&&(De=[],d.set(Ce,De));const ut=ie.textures;if(De.length!==ut.length||De[0]!==e.COLOR_ATTACHMENT0){for(let lt=0,It=ut.length;lt<It;lt++)De[lt]=e.COLOR_ATTACHMENT0+lt;De.length=ut.length,at=!0}}else De[0]!==e.BACK&&(De[0]=e.BACK,at=!0);at&&e.drawBuffers(De)}function Ne(ie){return g!==ie?(e.useProgram(ie),g=ie,!0):!1}const Ge={[Cm]:e.FUNC_ADD,[Uq]:e.FUNC_SUBTRACT,[Nq]:e.FUNC_REVERSE_SUBTRACT};Ge[zq]=e.MIN,Ge[Fq]=e.MAX;const We={[Vq]:e.ZERO,[Hq]:e.ONE,[Gq]:e.SRC_COLOR,[$C]:e.SRC_ALPHA,[Yq]:e.SRC_ALPHA_SATURATE,[Xq]:e.DST_COLOR,[jq]:e.DST_ALPHA,[kq]:e.ONE_MINUS_SRC_COLOR,[eD]:e.ONE_MINUS_SRC_ALPHA,[qq]:e.ONE_MINUS_DST_COLOR,[Wq]:e.ONE_MINUS_DST_ALPHA,[Qq]:e.CONSTANT_COLOR,[Kq]:e.ONE_MINUS_CONSTANT_COLOR,[Jq]:e.CONSTANT_ALPHA,[Zq]:e.ONE_MINUS_CONSTANT_ALPHA};function ae(ie,Ce,De,at,ut,lt,It,Vt,_i,Jt){if(ie===Wf){x===!0&&(be(e.BLEND),x=!1);return}if(x===!1&&(_e(e.BLEND),x=!0),ie!==Lq){if(ie!==y||Jt!==O){if((b!==Cm||E!==Cm)&&(e.blendEquation(e.FUNC_ADD),b=Cm,E=Cm),Jt)switch(ie){case f0:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case qL:e.blendFunc(e.ONE,e.ONE);break;case YL:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case QL:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",ie);break}else switch(ie){case f0:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case qL:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case YL:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case QL:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",ie);break}A=null,w=null,D=null,T=null,I.set(0,0,0),R=0,y=ie,O=Jt}return}ut=ut||Ce,lt=lt||De,It=It||at,(Ce!==b||ut!==E)&&(e.blendEquationSeparate(Ge[Ce],Ge[ut]),b=Ce,E=ut),(De!==A||at!==w||lt!==D||It!==T)&&(e.blendFuncSeparate(We[De],We[at],We[lt],We[It]),A=De,w=at,D=lt,T=It),(Vt.equals(I)===!1||_i!==R)&&(e.blendColor(Vt.r,Vt.g,Vt.b,_i),I.copy(Vt),R=_i),y=ie,O=!1}function He(ie,Ce){ie.side===Hc?be(e.CULL_FACE):_e(e.CULL_FACE);let De=ie.side===el;Ce&&(De=!De),Ke(De),ie.blending===f0&&ie.transparent===!1?ae(Wf):ae(ie.blending,ie.blendEquation,ie.blendSrc,ie.blendDst,ie.blendEquationAlpha,ie.blendSrcAlpha,ie.blendDstAlpha,ie.blendColor,ie.blendAlpha,ie.premultipliedAlpha),a.setFunc(ie.depthFunc),a.setTest(ie.depthTest),a.setMask(ie.depthWrite),s.setMask(ie.colorWrite);const at=ie.stencilWrite;o.setTest(at),at&&(o.setMask(ie.stencilWriteMask),o.setFunc(ie.stencilFunc,ie.stencilRef,ie.stencilFuncMask),o.setOp(ie.stencilFail,ie.stencilZFail,ie.stencilZPass)),Qe(ie.polygonOffset,ie.polygonOffsetFactor,ie.polygonOffsetUnits),ie.alphaToCoverage===!0?_e(e.SAMPLE_ALPHA_TO_COVERAGE):be(e.SAMPLE_ALPHA_TO_COVERAGE)}function Ke(ie){P!==ie&&(ie?e.frontFace(e.CW):e.frontFace(e.CCW),P=ie)}function je(ie){ie!==Oq?(_e(e.CULL_FACE),ie!==U&&(ie===XL?e.cullFace(e.BACK):ie===Bq?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):be(e.CULL_FACE),U=ie}function Oe(ie){ie!==H&&(F&&e.lineWidth(ie),H=ie)}function Qe(ie,Ce,De){ie?(_e(e.POLYGON_OFFSET_FILL),(V!==Ce||j!==De)&&(e.polygonOffset(Ce,De),V=Ce,j=De)):be(e.POLYGON_OFFSET_FILL)}function $e(ie){ie?_e(e.SCISSOR_TEST):be(e.SCISSOR_TEST)}function gt(ie){ie===void 0&&(ie=e.TEXTURE0+J-1),ne!==ie&&(e.activeTexture(ie),ne=ie)}function pe(ie,Ce,De){De===void 0&&(ne===null?De=e.TEXTURE0+J-1:De=ne);let at=Y[De];at===void 0&&(at={type:void 0,texture:void 0},Y[De]=at),(at.type!==ie||at.texture!==Ce)&&(ne!==De&&(e.activeTexture(De),ne=De),e.bindTexture(ie,Ce||le[ie]),at.type=ie,at.texture=Ce)}function k(){const ie=Y[ne];ie!==void 0&&ie.type!==void 0&&(e.bindTexture(ie.type,null),ie.type=void 0,ie.texture=void 0)}function Q(){try{e.compressedTexImage2D(...arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function xe(){try{e.compressedTexImage3D(...arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function K(){try{e.texSubImage2D(...arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function Re(){try{e.texSubImage3D(...arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function Le(){try{e.compressedTexSubImage2D(...arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function st(){try{e.compressedTexSubImage3D(...arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function Be(){try{e.texStorage2D(...arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function bt(){try{e.texStorage3D(...arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function vt(){try{e.texImage2D(...arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function Xe(){try{e.texImage3D(...arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function xt(ie){fe.equals(ie)===!1&&(e.scissor(ie.x,ie.y,ie.z,ie.w),fe.copy(ie))}function _t(ie){te.equals(ie)===!1&&(e.viewport(ie.x,ie.y,ie.z,ie.w),te.copy(ie))}function ye(ie,Ce){let De=c.get(Ce);De===void 0&&(De=new WeakMap,c.set(Ce,De));let at=De.get(ie);at===void 0&&(at=e.getUniformBlockIndex(Ce,ie.name),De.set(ie,at))}function Ve(ie,Ce){const at=c.get(Ce).get(ie);l.get(Ce)!==at&&(e.uniformBlockBinding(Ce,at,ie.__bindingPointIndex),l.set(Ce,at))}function At(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.blendColor(0,0,0,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),a.setReversed(!1),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),u={},ne=null,Y={},h={},d=new WeakMap,p=[],g=null,x=!1,y=null,b=null,A=null,w=null,E=null,D=null,T=null,I=new jt(0,0,0),R=0,O=!1,P=null,U=null,H=null,V=null,j=null,fe.set(0,0,e.canvas.width,e.canvas.height),te.set(0,0,e.canvas.width,e.canvas.height),s.reset(),a.reset(),o.reset()}return{buffers:{color:s,depth:a,stencil:o},enable:_e,disable:be,bindFramebuffer:we,drawBuffers:Me,useProgram:Ne,setBlending:ae,setMaterial:He,setFlipSided:Ke,setCullFace:je,setLineWidth:Oe,setPolygonOffset:Qe,setScissorTest:$e,activeTexture:gt,bindTexture:pe,unbindTexture:k,compressedTexImage2D:Q,compressedTexImage3D:xe,texImage2D:vt,texImage3D:Xe,updateUBOMapping:ye,uniformBlockBinding:Ve,texStorage2D:Be,texStorage3D:bt,texSubImage2D:K,texSubImage3D:Re,compressedTexSubImage2D:Le,compressedTexSubImage3D:st,scissor:xt,viewport:_t,reset:At}}function gfe(e,t,i,n,r,s,a){const o=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,l=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),c=new Mt,u=new WeakMap;let h;const d=new WeakMap;let p=!1;try{p=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function g(k,Q){return p?new OffscreenCanvas(k,Q):ew("canvas")}function x(k,Q,xe){let K=1;const Re=pe(k);if((Re.width>xe||Re.height>xe)&&(K=xe/Math.max(Re.width,Re.height)),K<1)if(typeof HTMLImageElement<"u"&&k instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&k instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&k instanceof ImageBitmap||typeof VideoFrame<"u"&&k instanceof VideoFrame){const Le=Math.floor(K*Re.width),st=Math.floor(K*Re.height);h===void 0&&(h=g(Le,st));const Be=Q?g(Le,st):h;return Be.width=Le,Be.height=st,Be.getContext("2d").drawImage(k,0,0,Le,st),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Re.width+"x"+Re.height+") to ("+Le+"x"+st+")."),Be}else return"data"in k&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Re.width+"x"+Re.height+")."),k;return k}function y(k){return k.generateMipmaps}function b(k){e.generateMipmap(k)}function A(k){return k.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:k.isWebGL3DRenderTarget?e.TEXTURE_3D:k.isWebGLArrayRenderTarget||k.isCompressedArrayTexture?e.TEXTURE_2D_ARRAY:e.TEXTURE_2D}function w(k,Q,xe,K,Re=!1){if(k!==null){if(e[k]!==void 0)return e[k];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+k+"'")}let Le=Q;if(Q===e.RED&&(xe===e.FLOAT&&(Le=e.R32F),xe===e.HALF_FLOAT&&(Le=e.R16F),xe===e.UNSIGNED_BYTE&&(Le=e.R8)),Q===e.RED_INTEGER&&(xe===e.UNSIGNED_BYTE&&(Le=e.R8UI),xe===e.UNSIGNED_SHORT&&(Le=e.R16UI),xe===e.UNSIGNED_INT&&(Le=e.R32UI),xe===e.BYTE&&(Le=e.R8I),xe===e.SHORT&&(Le=e.R16I),xe===e.INT&&(Le=e.R32I)),Q===e.RG&&(xe===e.FLOAT&&(Le=e.RG32F),xe===e.HALF_FLOAT&&(Le=e.RG16F),xe===e.UNSIGNED_BYTE&&(Le=e.RG8)),Q===e.RG_INTEGER&&(xe===e.UNSIGNED_BYTE&&(Le=e.RG8UI),xe===e.UNSIGNED_SHORT&&(Le=e.RG16UI),xe===e.UNSIGNED_INT&&(Le=e.RG32UI),xe===e.BYTE&&(Le=e.RG8I),xe===e.SHORT&&(Le=e.RG16I),xe===e.INT&&(Le=e.RG32I)),Q===e.RGB_INTEGER&&(xe===e.UNSIGNED_BYTE&&(Le=e.RGB8UI),xe===e.UNSIGNED_SHORT&&(Le=e.RGB16UI),xe===e.UNSIGNED_INT&&(Le=e.RGB32UI),xe===e.BYTE&&(Le=e.RGB8I),xe===e.SHORT&&(Le=e.RGB16I),xe===e.INT&&(Le=e.RGB32I)),Q===e.RGBA_INTEGER&&(xe===e.UNSIGNED_BYTE&&(Le=e.RGBA8UI),xe===e.UNSIGNED_SHORT&&(Le=e.RGBA16UI),xe===e.UNSIGNED_INT&&(Le=e.RGBA32UI),xe===e.BYTE&&(Le=e.RGBA8I),xe===e.SHORT&&(Le=e.RGBA16I),xe===e.INT&&(Le=e.RGBA32I)),Q===e.RGB&&xe===e.UNSIGNED_INT_5_9_9_9_REV&&(Le=e.RGB9_E5),Q===e.RGBA){const st=Re?JA:_n.getTransfer(K);xe===e.FLOAT&&(Le=e.RGBA32F),xe===e.HALF_FLOAT&&(Le=e.RGBA16F),xe===e.UNSIGNED_BYTE&&(Le=st===Jn?e.SRGB8_ALPHA8:e.RGBA8),xe===e.UNSIGNED_SHORT_4_4_4_4&&(Le=e.RGBA4),xe===e.UNSIGNED_SHORT_5_5_5_1&&(Le=e.RGB5_A1)}return(Le===e.R16F||Le===e.R32F||Le===e.RG16F||Le===e.RG32F||Le===e.RGBA16F||Le===e.RGBA32F)&&t.get("EXT_color_buffer_float"),Le}function E(k,Q){let xe;return k?Q===null||Q===Zf||Q===V1?xe=e.DEPTH24_STENCIL8:Q===Tl?xe=e.DEPTH32F_STENCIL8:Q===F1&&(xe=e.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):Q===null||Q===Zf||Q===V1?xe=e.DEPTH_COMPONENT24:Q===Tl?xe=e.DEPTH_COMPONENT32F:Q===F1&&(xe=e.DEPTH_COMPONENT16),xe}function D(k,Q){return y(k)===!0||k.isFramebufferTexture&&k.minFilter!==xa&&k.minFilter!==hs?Math.log2(Math.max(Q.width,Q.height))+1:k.mipmaps!==void 0&&k.mipmaps.length>0?k.mipmaps.length:k.isCompressedTexture&&Array.isArray(k.image)?Q.mipmaps.length:1}function T(k){const Q=k.target;Q.removeEventListener("dispose",T),R(Q),Q.isVideoTexture&&u.delete(Q)}function I(k){const Q=k.target;Q.removeEventListener("dispose",I),P(Q)}function R(k){const Q=n.get(k);if(Q.__webglInit===void 0)return;const xe=k.source,K=d.get(xe);if(K){const Re=K[Q.__cacheKey];Re.usedTimes--,Re.usedTimes===0&&O(k),Object.keys(K).length===0&&d.delete(xe)}n.remove(k)}function O(k){const Q=n.get(k);e.deleteTexture(Q.__webglTexture);const xe=k.source,K=d.get(xe);delete K[Q.__cacheKey],a.memory.textures--}function P(k){const Q=n.get(k);if(k.depthTexture&&(k.depthTexture.dispose(),n.remove(k.depthTexture)),k.isWebGLCubeRenderTarget)for(let K=0;K<6;K++){if(Array.isArray(Q.__webglFramebuffer[K]))for(let Re=0;Re<Q.__webglFramebuffer[K].length;Re++)e.deleteFramebuffer(Q.__webglFramebuffer[K][Re]);else e.deleteFramebuffer(Q.__webglFramebuffer[K]);Q.__webglDepthbuffer&&e.deleteRenderbuffer(Q.__webglDepthbuffer[K])}else{if(Array.isArray(Q.__webglFramebuffer))for(let K=0;K<Q.__webglFramebuffer.length;K++)e.deleteFramebuffer(Q.__webglFramebuffer[K]);else e.deleteFramebuffer(Q.__webglFramebuffer);if(Q.__webglDepthbuffer&&e.deleteRenderbuffer(Q.__webglDepthbuffer),Q.__webglMultisampledFramebuffer&&e.deleteFramebuffer(Q.__webglMultisampledFramebuffer),Q.__webglColorRenderbuffer)for(let K=0;K<Q.__webglColorRenderbuffer.length;K++)Q.__webglColorRenderbuffer[K]&&e.deleteRenderbuffer(Q.__webglColorRenderbuffer[K]);Q.__webglDepthRenderbuffer&&e.deleteRenderbuffer(Q.__webglDepthRenderbuffer)}const xe=k.textures;for(let K=0,Re=xe.length;K<Re;K++){const Le=n.get(xe[K]);Le.__webglTexture&&(e.deleteTexture(Le.__webglTexture),a.memory.textures--),n.remove(xe[K])}n.remove(k)}let U=0;function H(){U=0}function V(){const k=U;return k>=r.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+k+" texture units while this GPU supports only "+r.maxTextures),U+=1,k}function j(k){const Q=[];return Q.push(k.wrapS),Q.push(k.wrapT),Q.push(k.wrapR||0),Q.push(k.magFilter),Q.push(k.minFilter),Q.push(k.anisotropy),Q.push(k.internalFormat),Q.push(k.format),Q.push(k.type),Q.push(k.generateMipmaps),Q.push(k.premultiplyAlpha),Q.push(k.flipY),Q.push(k.unpackAlignment),Q.push(k.colorSpace),Q.join()}function J(k,Q){const xe=n.get(k);if(k.isVideoTexture&&$e(k),k.isRenderTargetTexture===!1&&k.version>0&&xe.__version!==k.version){const K=k.image;if(K===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(K.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{le(xe,k,Q);return}}i.bindTexture(e.TEXTURE_2D,xe.__webglTexture,e.TEXTURE0+Q)}function F(k,Q){const xe=n.get(k);if(k.version>0&&xe.__version!==k.version){le(xe,k,Q);return}i.bindTexture(e.TEXTURE_2D_ARRAY,xe.__webglTexture,e.TEXTURE0+Q)}function X(k,Q){const xe=n.get(k);if(k.version>0&&xe.__version!==k.version){le(xe,k,Q);return}i.bindTexture(e.TEXTURE_3D,xe.__webglTexture,e.TEXTURE0+Q)}function W(k,Q){const xe=n.get(k);if(k.version>0&&xe.__version!==k.version){_e(xe,k,Q);return}i.bindTexture(e.TEXTURE_CUBE_MAP,xe.__webglTexture,e.TEXTURE0+Q)}const ne={[Zm]:e.REPEAT,[Zl]:e.CLAMP_TO_EDGE,[z1]:e.MIRRORED_REPEAT},Y={[xa]:e.NEAREST,[aR]:e.NEAREST_MIPMAP_NEAREST,[Jv]:e.NEAREST_MIPMAP_LINEAR,[hs]:e.LINEAR,[b1]:e.LINEAR_MIPMAP_NEAREST,[kc]:e.LINEAR_MIPMAP_LINEAR},$={[mY]:e.NEVER,[SY]:e.ALWAYS,[gY]:e.LESS,[nF]:e.LEQUAL,[vY]:e.EQUAL,[bY]:e.GEQUAL,[yY]:e.GREATER,[xY]:e.NOTEQUAL};function se(k,Q){if(Q.type===Tl&&t.has("OES_texture_float_linear")===!1&&(Q.magFilter===hs||Q.magFilter===b1||Q.magFilter===Jv||Q.magFilter===kc||Q.minFilter===hs||Q.minFilter===b1||Q.minFilter===Jv||Q.minFilter===kc)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),e.texParameteri(k,e.TEXTURE_WRAP_S,ne[Q.wrapS]),e.texParameteri(k,e.TEXTURE_WRAP_T,ne[Q.wrapT]),(k===e.TEXTURE_3D||k===e.TEXTURE_2D_ARRAY)&&e.texParameteri(k,e.TEXTURE_WRAP_R,ne[Q.wrapR]),e.texParameteri(k,e.TEXTURE_MAG_FILTER,Y[Q.magFilter]),e.texParameteri(k,e.TEXTURE_MIN_FILTER,Y[Q.minFilter]),Q.compareFunction&&(e.texParameteri(k,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(k,e.TEXTURE_COMPARE_FUNC,$[Q.compareFunction])),t.has("EXT_texture_filter_anisotropic")===!0){if(Q.magFilter===xa||Q.minFilter!==Jv&&Q.minFilter!==kc||Q.type===Tl&&t.has("OES_texture_float_linear")===!1)return;if(Q.anisotropy>1||n.get(Q).__currentAnisotropy){const xe=t.get("EXT_texture_filter_anisotropic");e.texParameterf(k,xe.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Q.anisotropy,r.getMaxAnisotropy())),n.get(Q).__currentAnisotropy=Q.anisotropy}}}function fe(k,Q){let xe=!1;k.__webglInit===void 0&&(k.__webglInit=!0,Q.addEventListener("dispose",T));const K=Q.source;let Re=d.get(K);Re===void 0&&(Re={},d.set(K,Re));const Le=j(Q);if(Le!==k.__cacheKey){Re[Le]===void 0&&(Re[Le]={texture:e.createTexture(),usedTimes:0},a.memory.textures++,xe=!0),Re[Le].usedTimes++;const st=Re[k.__cacheKey];st!==void 0&&(Re[k.__cacheKey].usedTimes--,st.usedTimes===0&&O(Q)),k.__cacheKey=Le,k.__webglTexture=Re[Le].texture}return xe}function te(k,Q,xe){return Math.floor(Math.floor(k/xe)/Q)}function de(k,Q,xe,K){const Le=k.updateRanges;if(Le.length===0)i.texSubImage2D(e.TEXTURE_2D,0,0,0,Q.width,Q.height,xe,K,Q.data);else{Le.sort((Xe,xt)=>Xe.start-xt.start);let st=0;for(let Xe=1;Xe<Le.length;Xe++){const xt=Le[st],_t=Le[Xe],ye=xt.start+xt.count,Ve=te(_t.start,Q.width,4),At=te(xt.start,Q.width,4);_t.start<=ye+1&&Ve===At&&te(_t.start+_t.count-1,Q.width,4)===Ve?xt.count=Math.max(xt.count,_t.start+_t.count-xt.start):(++st,Le[st]=_t)}Le.length=st+1;const Be=e.getParameter(e.UNPACK_ROW_LENGTH),bt=e.getParameter(e.UNPACK_SKIP_PIXELS),vt=e.getParameter(e.UNPACK_SKIP_ROWS);e.pixelStorei(e.UNPACK_ROW_LENGTH,Q.width);for(let Xe=0,xt=Le.length;Xe<xt;Xe++){const _t=Le[Xe],ye=Math.floor(_t.start/4),Ve=Math.ceil(_t.count/4),At=ye%Q.width,ie=Math.floor(ye/Q.width),Ce=Ve,De=1;e.pixelStorei(e.UNPACK_SKIP_PIXELS,At),e.pixelStorei(e.UNPACK_SKIP_ROWS,ie),i.texSubImage2D(e.TEXTURE_2D,0,At,ie,Ce,De,xe,K,Q.data)}k.clearUpdateRanges(),e.pixelStorei(e.UNPACK_ROW_LENGTH,Be),e.pixelStorei(e.UNPACK_SKIP_PIXELS,bt),e.pixelStorei(e.UNPACK_SKIP_ROWS,vt)}}function le(k,Q,xe){let K=e.TEXTURE_2D;(Q.isDataArrayTexture||Q.isCompressedArrayTexture)&&(K=e.TEXTURE_2D_ARRAY),Q.isData3DTexture&&(K=e.TEXTURE_3D);const Re=fe(k,Q),Le=Q.source;i.bindTexture(K,k.__webglTexture,e.TEXTURE0+xe);const st=n.get(Le);if(Le.version!==st.__version||Re===!0){i.activeTexture(e.TEXTURE0+xe);const Be=_n.getPrimaries(_n.workingColorSpace),bt=Q.colorSpace===Of?null:_n.getPrimaries(Q.colorSpace),vt=Q.colorSpace===Of||Be===bt?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,Q.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Q.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,Q.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,vt);let Xe=x(Q.image,!1,r.maxTextureSize);Xe=gt(Q,Xe);const xt=s.convert(Q.format,Q.colorSpace),_t=s.convert(Q.type);let ye=w(Q.internalFormat,xt,_t,Q.colorSpace,Q.isVideoTexture);se(K,Q);let Ve;const At=Q.mipmaps,ie=Q.isVideoTexture!==!0,Ce=st.__version===void 0||Re===!0,De=Le.dataReady,at=D(Q,Xe);if(Q.isDepthTexture)ye=E(Q.format===G1,Q.type),Ce&&(ie?i.texStorage2D(e.TEXTURE_2D,1,ye,Xe.width,Xe.height):i.texImage2D(e.TEXTURE_2D,0,ye,Xe.width,Xe.height,0,xt,_t,null));else if(Q.isDataTexture)if(At.length>0){ie&&Ce&&i.texStorage2D(e.TEXTURE_2D,at,ye,At[0].width,At[0].height);for(let ut=0,lt=At.length;ut<lt;ut++)Ve=At[ut],ie?De&&i.texSubImage2D(e.TEXTURE_2D,ut,0,0,Ve.width,Ve.height,xt,_t,Ve.data):i.texImage2D(e.TEXTURE_2D,ut,ye,Ve.width,Ve.height,0,xt,_t,Ve.data);Q.generateMipmaps=!1}else ie?(Ce&&i.texStorage2D(e.TEXTURE_2D,at,ye,Xe.width,Xe.height),De&&de(Q,Xe,xt,_t)):i.texImage2D(e.TEXTURE_2D,0,ye,Xe.width,Xe.height,0,xt,_t,Xe.data);else if(Q.isCompressedTexture)if(Q.isCompressedArrayTexture){ie&&Ce&&i.texStorage3D(e.TEXTURE_2D_ARRAY,at,ye,At[0].width,At[0].height,Xe.depth);for(let ut=0,lt=At.length;ut<lt;ut++)if(Ve=At[ut],Q.format!==go)if(xt!==null)if(ie){if(De)if(Q.layerUpdates.size>0){const It=sU(Ve.width,Ve.height,Q.format,Q.type);for(const Vt of Q.layerUpdates){const _i=Ve.data.subarray(Vt*It/Ve.data.BYTES_PER_ELEMENT,(Vt+1)*It/Ve.data.BYTES_PER_ELEMENT);i.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,ut,0,0,Vt,Ve.width,Ve.height,1,xt,_i)}Q.clearLayerUpdates()}else i.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,ut,0,0,0,Ve.width,Ve.height,Xe.depth,xt,Ve.data)}else i.compressedTexImage3D(e.TEXTURE_2D_ARRAY,ut,ye,Ve.width,Ve.height,Xe.depth,0,Ve.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else ie?De&&i.texSubImage3D(e.TEXTURE_2D_ARRAY,ut,0,0,0,Ve.width,Ve.height,Xe.depth,xt,_t,Ve.data):i.texImage3D(e.TEXTURE_2D_ARRAY,ut,ye,Ve.width,Ve.height,Xe.depth,0,xt,_t,Ve.data)}else{ie&&Ce&&i.texStorage2D(e.TEXTURE_2D,at,ye,At[0].width,At[0].height);for(let ut=0,lt=At.length;ut<lt;ut++)Ve=At[ut],Q.format!==go?xt!==null?ie?De&&i.compressedTexSubImage2D(e.TEXTURE_2D,ut,0,0,Ve.width,Ve.height,xt,Ve.data):i.compressedTexImage2D(e.TEXTURE_2D,ut,ye,Ve.width,Ve.height,0,Ve.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):ie?De&&i.texSubImage2D(e.TEXTURE_2D,ut,0,0,Ve.width,Ve.height,xt,_t,Ve.data):i.texImage2D(e.TEXTURE_2D,ut,ye,Ve.width,Ve.height,0,xt,_t,Ve.data)}else if(Q.isDataArrayTexture)if(ie){if(Ce&&i.texStorage3D(e.TEXTURE_2D_ARRAY,at,ye,Xe.width,Xe.height,Xe.depth),De)if(Q.layerUpdates.size>0){const ut=sU(Xe.width,Xe.height,Q.format,Q.type);for(const lt of Q.layerUpdates){const It=Xe.data.subarray(lt*ut/Xe.data.BYTES_PER_ELEMENT,(lt+1)*ut/Xe.data.BYTES_PER_ELEMENT);i.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,lt,Xe.width,Xe.height,1,xt,_t,It)}Q.clearLayerUpdates()}else i.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,Xe.width,Xe.height,Xe.depth,xt,_t,Xe.data)}else i.texImage3D(e.TEXTURE_2D_ARRAY,0,ye,Xe.width,Xe.height,Xe.depth,0,xt,_t,Xe.data);else if(Q.isData3DTexture)ie?(Ce&&i.texStorage3D(e.TEXTURE_3D,at,ye,Xe.width,Xe.height,Xe.depth),De&&i.texSubImage3D(e.TEXTURE_3D,0,0,0,0,Xe.width,Xe.height,Xe.depth,xt,_t,Xe.data)):i.texImage3D(e.TEXTURE_3D,0,ye,Xe.width,Xe.height,Xe.depth,0,xt,_t,Xe.data);else if(Q.isFramebufferTexture){if(Ce)if(ie)i.texStorage2D(e.TEXTURE_2D,at,ye,Xe.width,Xe.height);else{let ut=Xe.width,lt=Xe.height;for(let It=0;It<at;It++)i.texImage2D(e.TEXTURE_2D,It,ye,ut,lt,0,xt,_t,null),ut>>=1,lt>>=1}}else if(At.length>0){if(ie&&Ce){const ut=pe(At[0]);i.texStorage2D(e.TEXTURE_2D,at,ye,ut.width,ut.height)}for(let ut=0,lt=At.length;ut<lt;ut++)Ve=At[ut],ie?De&&i.texSubImage2D(e.TEXTURE_2D,ut,0,0,xt,_t,Ve):i.texImage2D(e.TEXTURE_2D,ut,ye,xt,_t,Ve);Q.generateMipmaps=!1}else if(ie){if(Ce){const ut=pe(Xe);i.texStorage2D(e.TEXTURE_2D,at,ye,ut.width,ut.height)}De&&i.texSubImage2D(e.TEXTURE_2D,0,0,0,xt,_t,Xe)}else i.texImage2D(e.TEXTURE_2D,0,ye,xt,_t,Xe);y(Q)&&b(K),st.__version=Le.version,Q.onUpdate&&Q.onUpdate(Q)}k.__version=Q.version}function _e(k,Q,xe){if(Q.image.length!==6)return;const K=fe(k,Q),Re=Q.source;i.bindTexture(e.TEXTURE_CUBE_MAP,k.__webglTexture,e.TEXTURE0+xe);const Le=n.get(Re);if(Re.version!==Le.__version||K===!0){i.activeTexture(e.TEXTURE0+xe);const st=_n.getPrimaries(_n.workingColorSpace),Be=Q.colorSpace===Of?null:_n.getPrimaries(Q.colorSpace),bt=Q.colorSpace===Of||st===Be?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,Q.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Q.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,Q.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,bt);const vt=Q.isCompressedTexture||Q.image[0].isCompressedTexture,Xe=Q.image[0]&&Q.image[0].isDataTexture,xt=[];for(let lt=0;lt<6;lt++)!vt&&!Xe?xt[lt]=x(Q.image[lt],!0,r.maxCubemapSize):xt[lt]=Xe?Q.image[lt].image:Q.image[lt],xt[lt]=gt(Q,xt[lt]);const _t=xt[0],ye=s.convert(Q.format,Q.colorSpace),Ve=s.convert(Q.type),At=w(Q.internalFormat,ye,Ve,Q.colorSpace),ie=Q.isVideoTexture!==!0,Ce=Le.__version===void 0||K===!0,De=Re.dataReady;let at=D(Q,_t);se(e.TEXTURE_CUBE_MAP,Q);let ut;if(vt){ie&&Ce&&i.texStorage2D(e.TEXTURE_CUBE_MAP,at,At,_t.width,_t.height);for(let lt=0;lt<6;lt++){ut=xt[lt].mipmaps;for(let It=0;It<ut.length;It++){const Vt=ut[It];Q.format!==go?ye!==null?ie?De&&i.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+lt,It,0,0,Vt.width,Vt.height,ye,Vt.data):i.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+lt,It,At,Vt.width,Vt.height,0,Vt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):ie?De&&i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+lt,It,0,0,Vt.width,Vt.height,ye,Ve,Vt.data):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+lt,It,At,Vt.width,Vt.height,0,ye,Ve,Vt.data)}}}else{if(ut=Q.mipmaps,ie&&Ce){ut.length>0&&at++;const lt=pe(xt[0]);i.texStorage2D(e.TEXTURE_CUBE_MAP,at,At,lt.width,lt.height)}for(let lt=0;lt<6;lt++)if(Xe){ie?De&&i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+lt,0,0,0,xt[lt].width,xt[lt].height,ye,Ve,xt[lt].data):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+lt,0,At,xt[lt].width,xt[lt].height,0,ye,Ve,xt[lt].data);for(let It=0;It<ut.length;It++){const _i=ut[It].image[lt].image;ie?De&&i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+lt,It+1,0,0,_i.width,_i.height,ye,Ve,_i.data):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+lt,It+1,At,_i.width,_i.height,0,ye,Ve,_i.data)}}else{ie?De&&i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+lt,0,0,0,ye,Ve,xt[lt]):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+lt,0,At,ye,Ve,xt[lt]);for(let It=0;It<ut.length;It++){const Vt=ut[It];ie?De&&i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+lt,It+1,0,0,ye,Ve,Vt.image[lt]):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+lt,It+1,At,ye,Ve,Vt.image[lt])}}}y(Q)&&b(e.TEXTURE_CUBE_MAP),Le.__version=Re.version,Q.onUpdate&&Q.onUpdate(Q)}k.__version=Q.version}function be(k,Q,xe,K,Re,Le){const st=s.convert(xe.format,xe.colorSpace),Be=s.convert(xe.type),bt=w(xe.internalFormat,st,Be,xe.colorSpace),vt=n.get(Q),Xe=n.get(xe);if(Xe.__renderTarget=Q,!vt.__hasExternalTextures){const xt=Math.max(1,Q.width>>Le),_t=Math.max(1,Q.height>>Le);Re===e.TEXTURE_3D||Re===e.TEXTURE_2D_ARRAY?i.texImage3D(Re,Le,bt,xt,_t,Q.depth,0,st,Be,null):i.texImage2D(Re,Le,bt,xt,_t,0,st,Be,null)}i.bindFramebuffer(e.FRAMEBUFFER,k),Qe(Q)?o.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,K,Re,Xe.__webglTexture,0,Oe(Q)):(Re===e.TEXTURE_2D||Re>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&Re<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,K,Re,Xe.__webglTexture,Le),i.bindFramebuffer(e.FRAMEBUFFER,null)}function we(k,Q,xe){if(e.bindRenderbuffer(e.RENDERBUFFER,k),Q.depthBuffer){const K=Q.depthTexture,Re=K&&K.isDepthTexture?K.type:null,Le=E(Q.stencilBuffer,Re),st=Q.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,Be=Oe(Q);Qe(Q)?o.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,Be,Le,Q.width,Q.height):xe?e.renderbufferStorageMultisample(e.RENDERBUFFER,Be,Le,Q.width,Q.height):e.renderbufferStorage(e.RENDERBUFFER,Le,Q.width,Q.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,st,e.RENDERBUFFER,k)}else{const K=Q.textures;for(let Re=0;Re<K.length;Re++){const Le=K[Re],st=s.convert(Le.format,Le.colorSpace),Be=s.convert(Le.type),bt=w(Le.internalFormat,st,Be,Le.colorSpace),vt=Oe(Q);xe&&Qe(Q)===!1?e.renderbufferStorageMultisample(e.RENDERBUFFER,vt,bt,Q.width,Q.height):Qe(Q)?o.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,vt,bt,Q.width,Q.height):e.renderbufferStorage(e.RENDERBUFFER,bt,Q.width,Q.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function Me(k,Q){if(Q&&Q.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(e.FRAMEBUFFER,k),!(Q.depthTexture&&Q.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const K=n.get(Q.depthTexture);K.__renderTarget=Q,(!K.__webglTexture||Q.depthTexture.image.width!==Q.width||Q.depthTexture.image.height!==Q.height)&&(Q.depthTexture.image.width=Q.width,Q.depthTexture.image.height=Q.height,Q.depthTexture.needsUpdate=!0),J(Q.depthTexture,0);const Re=K.__webglTexture,Le=Oe(Q);if(Q.depthTexture.format===H1)Qe(Q)?o.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,Re,0,Le):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,Re,0);else if(Q.depthTexture.format===G1)Qe(Q)?o.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,Re,0,Le):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,Re,0);else throw new Error("Unknown depthTexture format")}function Ne(k){const Q=n.get(k),xe=k.isWebGLCubeRenderTarget===!0;if(Q.__boundDepthTexture!==k.depthTexture){const K=k.depthTexture;if(Q.__depthDisposeCallback&&Q.__depthDisposeCallback(),K){const Re=()=>{delete Q.__boundDepthTexture,delete Q.__depthDisposeCallback,K.removeEventListener("dispose",Re)};K.addEventListener("dispose",Re),Q.__depthDisposeCallback=Re}Q.__boundDepthTexture=K}if(k.depthTexture&&!Q.__autoAllocateDepthBuffer){if(xe)throw new Error("target.depthTexture not supported in Cube render targets");const K=k.texture.mipmaps;K&&K.length>0?Me(Q.__webglFramebuffer[0],k):Me(Q.__webglFramebuffer,k)}else if(xe){Q.__webglDepthbuffer=[];for(let K=0;K<6;K++)if(i.bindFramebuffer(e.FRAMEBUFFER,Q.__webglFramebuffer[K]),Q.__webglDepthbuffer[K]===void 0)Q.__webglDepthbuffer[K]=e.createRenderbuffer(),we(Q.__webglDepthbuffer[K],k,!1);else{const Re=k.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,Le=Q.__webglDepthbuffer[K];e.bindRenderbuffer(e.RENDERBUFFER,Le),e.framebufferRenderbuffer(e.FRAMEBUFFER,Re,e.RENDERBUFFER,Le)}}else{const K=k.texture.mipmaps;if(K&&K.length>0?i.bindFramebuffer(e.FRAMEBUFFER,Q.__webglFramebuffer[0]):i.bindFramebuffer(e.FRAMEBUFFER,Q.__webglFramebuffer),Q.__webglDepthbuffer===void 0)Q.__webglDepthbuffer=e.createRenderbuffer(),we(Q.__webglDepthbuffer,k,!1);else{const Re=k.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,Le=Q.__webglDepthbuffer;e.bindRenderbuffer(e.RENDERBUFFER,Le),e.framebufferRenderbuffer(e.FRAMEBUFFER,Re,e.RENDERBUFFER,Le)}}i.bindFramebuffer(e.FRAMEBUFFER,null)}function Ge(k,Q,xe){const K=n.get(k);Q!==void 0&&be(K.__webglFramebuffer,k,k.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,0),xe!==void 0&&Ne(k)}function We(k){const Q=k.texture,xe=n.get(k),K=n.get(Q);k.addEventListener("dispose",I);const Re=k.textures,Le=k.isWebGLCubeRenderTarget===!0,st=Re.length>1;if(st||(K.__webglTexture===void 0&&(K.__webglTexture=e.createTexture()),K.__version=Q.version,a.memory.textures++),Le){xe.__webglFramebuffer=[];for(let Be=0;Be<6;Be++)if(Q.mipmaps&&Q.mipmaps.length>0){xe.__webglFramebuffer[Be]=[];for(let bt=0;bt<Q.mipmaps.length;bt++)xe.__webglFramebuffer[Be][bt]=e.createFramebuffer()}else xe.__webglFramebuffer[Be]=e.createFramebuffer()}else{if(Q.mipmaps&&Q.mipmaps.length>0){xe.__webglFramebuffer=[];for(let Be=0;Be<Q.mipmaps.length;Be++)xe.__webglFramebuffer[Be]=e.createFramebuffer()}else xe.__webglFramebuffer=e.createFramebuffer();if(st)for(let Be=0,bt=Re.length;Be<bt;Be++){const vt=n.get(Re[Be]);vt.__webglTexture===void 0&&(vt.__webglTexture=e.createTexture(),a.memory.textures++)}if(k.samples>0&&Qe(k)===!1){xe.__webglMultisampledFramebuffer=e.createFramebuffer(),xe.__webglColorRenderbuffer=[],i.bindFramebuffer(e.FRAMEBUFFER,xe.__webglMultisampledFramebuffer);for(let Be=0;Be<Re.length;Be++){const bt=Re[Be];xe.__webglColorRenderbuffer[Be]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,xe.__webglColorRenderbuffer[Be]);const vt=s.convert(bt.format,bt.colorSpace),Xe=s.convert(bt.type),xt=w(bt.internalFormat,vt,Xe,bt.colorSpace,k.isXRRenderTarget===!0),_t=Oe(k);e.renderbufferStorageMultisample(e.RENDERBUFFER,_t,xt,k.width,k.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+Be,e.RENDERBUFFER,xe.__webglColorRenderbuffer[Be])}e.bindRenderbuffer(e.RENDERBUFFER,null),k.depthBuffer&&(xe.__webglDepthRenderbuffer=e.createRenderbuffer(),we(xe.__webglDepthRenderbuffer,k,!0)),i.bindFramebuffer(e.FRAMEBUFFER,null)}}if(Le){i.bindTexture(e.TEXTURE_CUBE_MAP,K.__webglTexture),se(e.TEXTURE_CUBE_MAP,Q);for(let Be=0;Be<6;Be++)if(Q.mipmaps&&Q.mipmaps.length>0)for(let bt=0;bt<Q.mipmaps.length;bt++)be(xe.__webglFramebuffer[Be][bt],k,Q,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+Be,bt);else be(xe.__webglFramebuffer[Be],k,Q,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+Be,0);y(Q)&&b(e.TEXTURE_CUBE_MAP),i.unbindTexture()}else if(st){for(let Be=0,bt=Re.length;Be<bt;Be++){const vt=Re[Be],Xe=n.get(vt);i.bindTexture(e.TEXTURE_2D,Xe.__webglTexture),se(e.TEXTURE_2D,vt),be(xe.__webglFramebuffer,k,vt,e.COLOR_ATTACHMENT0+Be,e.TEXTURE_2D,0),y(vt)&&b(e.TEXTURE_2D)}i.unbindTexture()}else{let Be=e.TEXTURE_2D;if((k.isWebGL3DRenderTarget||k.isWebGLArrayRenderTarget)&&(Be=k.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY),i.bindTexture(Be,K.__webglTexture),se(Be,Q),Q.mipmaps&&Q.mipmaps.length>0)for(let bt=0;bt<Q.mipmaps.length;bt++)be(xe.__webglFramebuffer[bt],k,Q,e.COLOR_ATTACHMENT0,Be,bt);else be(xe.__webglFramebuffer,k,Q,e.COLOR_ATTACHMENT0,Be,0);y(Q)&&b(Be),i.unbindTexture()}k.depthBuffer&&Ne(k)}function ae(k){const Q=k.textures;for(let xe=0,K=Q.length;xe<K;xe++){const Re=Q[xe];if(y(Re)){const Le=A(k),st=n.get(Re).__webglTexture;i.bindTexture(Le,st),b(Le),i.unbindTexture()}}}const He=[],Ke=[];function je(k){if(k.samples>0){if(Qe(k)===!1){const Q=k.textures,xe=k.width,K=k.height;let Re=e.COLOR_BUFFER_BIT;const Le=k.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,st=n.get(k),Be=Q.length>1;if(Be)for(let vt=0;vt<Q.length;vt++)i.bindFramebuffer(e.FRAMEBUFFER,st.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+vt,e.RENDERBUFFER,null),i.bindFramebuffer(e.FRAMEBUFFER,st.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+vt,e.TEXTURE_2D,null,0);i.bindFramebuffer(e.READ_FRAMEBUFFER,st.__webglMultisampledFramebuffer);const bt=k.texture.mipmaps;bt&&bt.length>0?i.bindFramebuffer(e.DRAW_FRAMEBUFFER,st.__webglFramebuffer[0]):i.bindFramebuffer(e.DRAW_FRAMEBUFFER,st.__webglFramebuffer);for(let vt=0;vt<Q.length;vt++){if(k.resolveDepthBuffer&&(k.depthBuffer&&(Re|=e.DEPTH_BUFFER_BIT),k.stencilBuffer&&k.resolveStencilBuffer&&(Re|=e.STENCIL_BUFFER_BIT)),Be){e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,st.__webglColorRenderbuffer[vt]);const Xe=n.get(Q[vt]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,Xe,0)}e.blitFramebuffer(0,0,xe,K,0,0,xe,K,Re,e.NEAREST),l===!0&&(He.length=0,Ke.length=0,He.push(e.COLOR_ATTACHMENT0+vt),k.depthBuffer&&k.resolveDepthBuffer===!1&&(He.push(Le),Ke.push(Le),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,Ke)),e.invalidateFramebuffer(e.READ_FRAMEBUFFER,He))}if(i.bindFramebuffer(e.READ_FRAMEBUFFER,null),i.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),Be)for(let vt=0;vt<Q.length;vt++){i.bindFramebuffer(e.FRAMEBUFFER,st.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+vt,e.RENDERBUFFER,st.__webglColorRenderbuffer[vt]);const Xe=n.get(Q[vt]).__webglTexture;i.bindFramebuffer(e.FRAMEBUFFER,st.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+vt,e.TEXTURE_2D,Xe,0)}i.bindFramebuffer(e.DRAW_FRAMEBUFFER,st.__webglMultisampledFramebuffer)}else if(k.depthBuffer&&k.resolveDepthBuffer===!1&&l){const Q=k.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[Q])}}}function Oe(k){return Math.min(r.maxSamples,k.samples)}function Qe(k){const Q=n.get(k);return k.samples>0&&t.has("WEBGL_multisampled_render_to_texture")===!0&&Q.__useRenderToTexture!==!1}function $e(k){const Q=a.render.frame;u.get(k)!==Q&&(u.set(k,Q),k.update())}function gt(k,Q){const xe=k.colorSpace,K=k.format,Re=k.type;return k.isCompressedTexture===!0||k.isVideoTexture===!0||xe!==$m&&xe!==Of&&(_n.getTransfer(xe)===Jn?(K!==go||Re!==Kc)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",xe)),Q}function pe(k){return typeof HTMLImageElement<"u"&&k instanceof HTMLImageElement?(c.width=k.naturalWidth||k.width,c.height=k.naturalHeight||k.height):typeof VideoFrame<"u"&&k instanceof VideoFrame?(c.width=k.displayWidth,c.height=k.displayHeight):(c.width=k.width,c.height=k.height),c}this.allocateTextureUnit=V,this.resetTextureUnits=H,this.setTexture2D=J,this.setTexture2DArray=F,this.setTexture3D=X,this.setTextureCube=W,this.rebindTextures=Ge,this.setupRenderTarget=We,this.updateRenderTargetMipmap=ae,this.updateMultisampleRenderTarget=je,this.setupDepthRenderbuffer=Ne,this.setupFrameBufferTexture=be,this.useMultisampledRTT=Qe}function _Q(e,t){function i(n,r=Of){let s;const a=_n.getTransfer(r);if(n===Kc)return e.UNSIGNED_BYTE;if(n===lR)return e.UNSIGNED_SHORT_4_4_4_4;if(n===cR)return e.UNSIGNED_SHORT_5_5_5_1;if(n===Kz)return e.UNSIGNED_INT_5_9_9_9_REV;if(n===Yz)return e.BYTE;if(n===Qz)return e.SHORT;if(n===F1)return e.UNSIGNED_SHORT;if(n===oR)return e.INT;if(n===Zf)return e.UNSIGNED_INT;if(n===Tl)return e.FLOAT;if(n===vb)return e.HALF_FLOAT;if(n===Jz)return e.ALPHA;if(n===Zz)return e.RGB;if(n===go)return e.RGBA;if(n===H1)return e.DEPTH_COMPONENT;if(n===G1)return e.DEPTH_STENCIL;if(n===uR)return e.RED;if(n===Hw)return e.RED_INTEGER;if(n===$z)return e.RG;if(n===hR)return e.RG_INTEGER;if(n===dR)return e.RGBA_INTEGER;if(n===vA||n===yA||n===xA||n===bA)if(a===Jn)if(s=t.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(n===vA)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===yA)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===xA)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===bA)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=t.get("WEBGL_compressed_texture_s3tc"),s!==null){if(n===vA)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===yA)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===xA)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===bA)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(n===lD||n===cD||n===uD||n===hD)if(s=t.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(n===lD)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===cD)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===uD)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===hD)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(n===dD||n===fD||n===pD)if(s=t.get("WEBGL_compressed_texture_etc"),s!==null){if(n===dD||n===fD)return a===Jn?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(n===pD)return a===Jn?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(n===mD||n===gD||n===vD||n===yD||n===xD||n===bD||n===SD||n===_D||n===AD||n===wD||n===MD||n===ED||n===TD||n===CD)if(s=t.get("WEBGL_compressed_texture_astc"),s!==null){if(n===mD)return a===Jn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===gD)return a===Jn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===vD)return a===Jn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===yD)return a===Jn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===xD)return a===Jn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===bD)return a===Jn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===SD)return a===Jn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===_D)return a===Jn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===AD)return a===Jn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===wD)return a===Jn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===MD)return a===Jn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===ED)return a===Jn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===TD)return a===Jn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===CD)return a===Jn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(n===SA||n===DD||n===RD)if(s=t.get("EXT_texture_compression_bptc"),s!==null){if(n===SA)return a===Jn?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===DD)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===RD)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(n===eF||n===PD||n===OD||n===BD)if(s=t.get("EXT_texture_compression_rgtc"),s!==null){if(n===SA)return s.COMPRESSED_RED_RGTC1_EXT;if(n===PD)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===OD)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===BD)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return n===V1?e.UNSIGNED_INT_24_8:e[n]!==void 0?e[n]:null}return{convert:i}}const vfe=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,yfe=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class xfe{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(t,i,n){if(this.texture===null){const r=new vr,s=t.properties.get(r);s.__webglTexture=i.texture,(i.depthNear!==n.depthNear||i.depthFar!==n.depthFar)&&(this.depthNear=i.depthNear,this.depthFar=i.depthFar),this.texture=r}}getMesh(t){if(this.texture!==null&&this.mesh===null){const i=t.cameras[0].viewport,n=new Ju({vertexShader:vfe,fragmentShader:yfe,uniforms:{depthColor:{value:this.texture},depthWidth:{value:i.z},depthHeight:{value:i.w}}});this.mesh=new ts(new xb(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class bfe extends Cd{constructor(t,i){super();const n=this;let r=null,s=1,a=null,o="local-floor",l=1,c=null,u=null,h=null,d=null,p=null,g=null;const x=new xfe,y=i.getContextAttributes();let b=null,A=null;const w=[],E=[],D=new Mt;let T=null;const I=new Dr;I.viewport=new Rn;const R=new Dr;R.viewport=new Rn;const O=[I,R],P=new hQ;let U=null,H=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(te){let de=w[te];return de===void 0&&(de=new wC,w[te]=de),de.getTargetRaySpace()},this.getControllerGrip=function(te){let de=w[te];return de===void 0&&(de=new wC,w[te]=de),de.getGripSpace()},this.getHand=function(te){let de=w[te];return de===void 0&&(de=new wC,w[te]=de),de.getHandSpace()};function V(te){const de=E.indexOf(te.inputSource);if(de===-1)return;const le=w[de];le!==void 0&&(le.update(te.inputSource,te.frame,c||a),le.dispatchEvent({type:te.type,data:te.inputSource}))}function j(){r.removeEventListener("select",V),r.removeEventListener("selectstart",V),r.removeEventListener("selectend",V),r.removeEventListener("squeeze",V),r.removeEventListener("squeezestart",V),r.removeEventListener("squeezeend",V),r.removeEventListener("end",j),r.removeEventListener("inputsourceschange",J);for(let te=0;te<w.length;te++){const de=E[te];de!==null&&(E[te]=null,w[te].disconnect(de))}U=null,H=null,x.reset(),t.setRenderTarget(b),p=null,d=null,h=null,r=null,A=null,fe.stop(),n.isPresenting=!1,t.setPixelRatio(T),t.setSize(D.width,D.height,!1),n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(te){s=te,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(te){o=te,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||a},this.setReferenceSpace=function(te){c=te},this.getBaseLayer=function(){return d!==null?d:p},this.getBinding=function(){return h},this.getFrame=function(){return g},this.getSession=function(){return r},this.setSession=async function(te){if(r=te,r!==null){if(b=t.getRenderTarget(),r.addEventListener("select",V),r.addEventListener("selectstart",V),r.addEventListener("selectend",V),r.addEventListener("squeeze",V),r.addEventListener("squeezestart",V),r.addEventListener("squeezeend",V),r.addEventListener("end",j),r.addEventListener("inputsourceschange",J),y.xrCompatible!==!0&&await i.makeXRCompatible(),T=t.getPixelRatio(),t.getSize(D),typeof XRWebGLBinding<"u"&&"createProjectionLayer"in XRWebGLBinding.prototype){let le=null,_e=null,be=null;y.depth&&(be=y.stencil?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24,le=y.stencil?G1:H1,_e=y.stencil?V1:Zf);const we={colorFormat:i.RGBA8,depthFormat:be,scaleFactor:s};h=new XRWebGLBinding(r,i),d=h.createProjectionLayer(we),r.updateRenderState({layers:[d]}),t.setPixelRatio(1),t.setSize(d.textureWidth,d.textureHeight,!1),A=new Sd(d.textureWidth,d.textureHeight,{format:go,type:Kc,depthTexture:new vF(d.textureWidth,d.textureHeight,_e,void 0,void 0,void 0,void 0,void 0,void 0,le),stencilBuffer:y.stencil,colorSpace:t.outputColorSpace,samples:y.antialias?4:0,resolveDepthBuffer:d.ignoreDepthValues===!1,resolveStencilBuffer:d.ignoreDepthValues===!1})}else{const le={antialias:y.antialias,alpha:!0,depth:y.depth,stencil:y.stencil,framebufferScaleFactor:s};p=new XRWebGLLayer(r,i,le),r.updateRenderState({baseLayer:p}),t.setPixelRatio(1),t.setSize(p.framebufferWidth,p.framebufferHeight,!1),A=new Sd(p.framebufferWidth,p.framebufferHeight,{format:go,type:Kc,colorSpace:t.outputColorSpace,stencilBuffer:y.stencil,resolveDepthBuffer:p.ignoreDepthValues===!1,resolveStencilBuffer:p.ignoreDepthValues===!1})}A.isXRRenderTarget=!0,this.setFoveation(l),c=null,a=await r.requestReferenceSpace(o),fe.setContext(r),fe.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(r!==null)return r.environmentBlendMode},this.getDepthTexture=function(){return x.getDepthTexture()};function J(te){for(let de=0;de<te.removed.length;de++){const le=te.removed[de],_e=E.indexOf(le);_e>=0&&(E[_e]=null,w[_e].disconnect(le))}for(let de=0;de<te.added.length;de++){const le=te.added[de];let _e=E.indexOf(le);if(_e===-1){for(let we=0;we<w.length;we++)if(we>=E.length){E.push(le),_e=we;break}else if(E[we]===null){E[we]=le,_e=we;break}if(_e===-1)break}const be=w[_e];be&&be.connect(le)}}const F=new me,X=new me;function W(te,de,le){F.setFromMatrixPosition(de.matrixWorld),X.setFromMatrixPosition(le.matrixWorld);const _e=F.distanceTo(X),be=de.projectionMatrix.elements,we=le.projectionMatrix.elements,Me=be[14]/(be[10]-1),Ne=be[14]/(be[10]+1),Ge=(be[9]+1)/be[5],We=(be[9]-1)/be[5],ae=(be[8]-1)/be[0],He=(we[8]+1)/we[0],Ke=Me*ae,je=Me*He,Oe=_e/(-ae+He),Qe=Oe*-ae;if(de.matrixWorld.decompose(te.position,te.quaternion,te.scale),te.translateX(Qe),te.translateZ(Oe),te.matrixWorld.compose(te.position,te.quaternion,te.scale),te.matrixWorldInverse.copy(te.matrixWorld).invert(),be[10]===-1)te.projectionMatrix.copy(de.projectionMatrix),te.projectionMatrixInverse.copy(de.projectionMatrixInverse);else{const $e=Me+Oe,gt=Ne+Oe,pe=Ke-Qe,k=je+(_e-Qe),Q=Ge*Ne/gt*$e,xe=We*Ne/gt*$e;te.projectionMatrix.makePerspective(pe,k,Q,xe,$e,gt),te.projectionMatrixInverse.copy(te.projectionMatrix).invert()}}function ne(te,de){de===null?te.matrixWorld.copy(te.matrix):te.matrixWorld.multiplyMatrices(de.matrixWorld,te.matrix),te.matrixWorldInverse.copy(te.matrixWorld).invert()}this.updateCamera=function(te){if(r===null)return;let de=te.near,le=te.far;x.texture!==null&&(x.depthNear>0&&(de=x.depthNear),x.depthFar>0&&(le=x.depthFar)),P.near=R.near=I.near=de,P.far=R.far=I.far=le,(U!==P.near||H!==P.far)&&(r.updateRenderState({depthNear:P.near,depthFar:P.far}),U=P.near,H=P.far),I.layers.mask=te.layers.mask|2,R.layers.mask=te.layers.mask|4,P.layers.mask=I.layers.mask|R.layers.mask;const _e=te.parent,be=P.cameras;ne(P,_e);for(let we=0;we<be.length;we++)ne(be[we],_e);be.length===2?W(P,I,R):P.projectionMatrix.copy(I.projectionMatrix),Y(te,P,_e)};function Y(te,de,le){le===null?te.matrix.copy(de.matrixWorld):(te.matrix.copy(le.matrixWorld),te.matrix.invert(),te.matrix.multiply(de.matrixWorld)),te.matrix.decompose(te.position,te.quaternion,te.scale),te.updateMatrixWorld(!0),te.projectionMatrix.copy(de.projectionMatrix),te.projectionMatrixInverse.copy(de.projectionMatrixInverse),te.isPerspectiveCamera&&(te.fov=W1*2*Math.atan(1/te.projectionMatrix.elements[5]),te.zoom=1)}this.getCamera=function(){return P},this.getFoveation=function(){if(!(d===null&&p===null))return l},this.setFoveation=function(te){l=te,d!==null&&(d.fixedFoveation=te),p!==null&&p.fixedFoveation!==void 0&&(p.fixedFoveation=te)},this.hasDepthSensing=function(){return x.texture!==null},this.getDepthSensingMesh=function(){return x.getMesh(P)};let $=null;function se(te,de){if(u=de.getViewerPose(c||a),g=de,u!==null){const le=u.views;p!==null&&(t.setRenderTargetFramebuffer(A,p.framebuffer),t.setRenderTarget(A));let _e=!1;le.length!==P.cameras.length&&(P.cameras.length=0,_e=!0);for(let Me=0;Me<le.length;Me++){const Ne=le[Me];let Ge=null;if(p!==null)Ge=p.getViewport(Ne);else{const ae=h.getViewSubImage(d,Ne);Ge=ae.viewport,Me===0&&(t.setRenderTargetTextures(A,ae.colorTexture,ae.depthStencilTexture),t.setRenderTarget(A))}let We=O[Me];We===void 0&&(We=new Dr,We.layers.enable(Me),We.viewport=new Rn,O[Me]=We),We.matrix.fromArray(Ne.transform.matrix),We.matrix.decompose(We.position,We.quaternion,We.scale),We.projectionMatrix.fromArray(Ne.projectionMatrix),We.projectionMatrixInverse.copy(We.projectionMatrix).invert(),We.viewport.set(Ge.x,Ge.y,Ge.width,Ge.height),Me===0&&(P.matrix.copy(We.matrix),P.matrix.decompose(P.position,P.quaternion,P.scale)),_e===!0&&P.cameras.push(We)}const be=r.enabledFeatures;if(be&&be.includes("depth-sensing")&&r.depthUsage=="gpu-optimized"&&h){const Me=h.getDepthInformation(le[0]);Me&&Me.isValid&&Me.texture&&x.init(t,Me,r.renderState)}}for(let le=0;le<w.length;le++){const _e=E[le],be=w[le];_e!==null&&be!==void 0&&be.update(_e,de,c||a)}$&&$(te,de),de.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:de}),g=null}const fe=new vQ;fe.setAnimationLoop(se),this.setAnimationLoop=function(te){$=te},this.dispose=function(){}}}const _v=new tl,Sfe=new di;function _fe(e,t){function i(y,b){y.matrixAutoUpdate===!0&&y.updateMatrix(),b.value.copy(y.matrix)}function n(y,b){b.color.getRGB(y.fogColor.value,EY(e)),b.isFog?(y.fogNear.value=b.near,y.fogFar.value=b.far):b.isFogExp2&&(y.fogDensity.value=b.density)}function r(y,b,A,w,E){b.isMeshBasicMaterial||b.isMeshLambertMaterial?s(y,b):b.isMeshToonMaterial?(s(y,b),h(y,b)):b.isMeshPhongMaterial?(s(y,b),u(y,b)):b.isMeshStandardMaterial?(s(y,b),d(y,b),b.isMeshPhysicalMaterial&&p(y,b,E)):b.isMeshMatcapMaterial?(s(y,b),g(y,b)):b.isMeshDepthMaterial?s(y,b):b.isMeshDistanceMaterial?(s(y,b),x(y,b)):b.isMeshNormalMaterial?s(y,b):b.isLineBasicMaterial?(a(y,b),b.isLineDashedMaterial&&o(y,b)):b.isPointsMaterial?l(y,b,A,w):b.isSpriteMaterial?c(y,b):b.isShadowMaterial?(y.color.value.copy(b.color),y.opacity.value=b.opacity):b.isShaderMaterial&&(b.uniformsNeedUpdate=!1)}function s(y,b){y.opacity.value=b.opacity,b.color&&y.diffuse.value.copy(b.color),b.emissive&&y.emissive.value.copy(b.emissive).multiplyScalar(b.emissiveIntensity),b.map&&(y.map.value=b.map,i(b.map,y.mapTransform)),b.alphaMap&&(y.alphaMap.value=b.alphaMap,i(b.alphaMap,y.alphaMapTransform)),b.bumpMap&&(y.bumpMap.value=b.bumpMap,i(b.bumpMap,y.bumpMapTransform),y.bumpScale.value=b.bumpScale,b.side===el&&(y.bumpScale.value*=-1)),b.normalMap&&(y.normalMap.value=b.normalMap,i(b.normalMap,y.normalMapTransform),y.normalScale.value.copy(b.normalScale),b.side===el&&y.normalScale.value.negate()),b.displacementMap&&(y.displacementMap.value=b.displacementMap,i(b.displacementMap,y.displacementMapTransform),y.displacementScale.value=b.displacementScale,y.displacementBias.value=b.displacementBias),b.emissiveMap&&(y.emissiveMap.value=b.emissiveMap,i(b.emissiveMap,y.emissiveMapTransform)),b.specularMap&&(y.specularMap.value=b.specularMap,i(b.specularMap,y.specularMapTransform)),b.alphaTest>0&&(y.alphaTest.value=b.alphaTest);const A=t.get(b),w=A.envMap,E=A.envMapRotation;w&&(y.envMap.value=w,_v.copy(E),_v.x*=-1,_v.y*=-1,_v.z*=-1,w.isCubeTexture&&w.isRenderTargetTexture===!1&&(_v.y*=-1,_v.z*=-1),y.envMapRotation.value.setFromMatrix4(Sfe.makeRotationFromEuler(_v)),y.flipEnvMap.value=w.isCubeTexture&&w.isRenderTargetTexture===!1?-1:1,y.reflectivity.value=b.reflectivity,y.ior.value=b.ior,y.refractionRatio.value=b.refractionRatio),b.lightMap&&(y.lightMap.value=b.lightMap,y.lightMapIntensity.value=b.lightMapIntensity,i(b.lightMap,y.lightMapTransform)),b.aoMap&&(y.aoMap.value=b.aoMap,y.aoMapIntensity.value=b.aoMapIntensity,i(b.aoMap,y.aoMapTransform))}function a(y,b){y.diffuse.value.copy(b.color),y.opacity.value=b.opacity,b.map&&(y.map.value=b.map,i(b.map,y.mapTransform))}function o(y,b){y.dashSize.value=b.dashSize,y.totalSize.value=b.dashSize+b.gapSize,y.scale.value=b.scale}function l(y,b,A,w){y.diffuse.value.copy(b.color),y.opacity.value=b.opacity,y.size.value=b.size*A,y.scale.value=w*.5,b.map&&(y.map.value=b.map,i(b.map,y.uvTransform)),b.alphaMap&&(y.alphaMap.value=b.alphaMap,i(b.alphaMap,y.alphaMapTransform)),b.alphaTest>0&&(y.alphaTest.value=b.alphaTest)}function c(y,b){y.diffuse.value.copy(b.color),y.opacity.value=b.opacity,y.rotation.value=b.rotation,b.map&&(y.map.value=b.map,i(b.map,y.mapTransform)),b.alphaMap&&(y.alphaMap.value=b.alphaMap,i(b.alphaMap,y.alphaMapTransform)),b.alphaTest>0&&(y.alphaTest.value=b.alphaTest)}function u(y,b){y.specular.value.copy(b.specular),y.shininess.value=Math.max(b.shininess,1e-4)}function h(y,b){b.gradientMap&&(y.gradientMap.value=b.gradientMap)}function d(y,b){y.metalness.value=b.metalness,b.metalnessMap&&(y.metalnessMap.value=b.metalnessMap,i(b.metalnessMap,y.metalnessMapTransform)),y.roughness.value=b.roughness,b.roughnessMap&&(y.roughnessMap.value=b.roughnessMap,i(b.roughnessMap,y.roughnessMapTransform)),b.envMap&&(y.envMapIntensity.value=b.envMapIntensity)}function p(y,b,A){y.ior.value=b.ior,b.sheen>0&&(y.sheenColor.value.copy(b.sheenColor).multiplyScalar(b.sheen),y.sheenRoughness.value=b.sheenRoughness,b.sheenColorMap&&(y.sheenColorMap.value=b.sheenColorMap,i(b.sheenColorMap,y.sheenColorMapTransform)),b.sheenRoughnessMap&&(y.sheenRoughnessMap.value=b.sheenRoughnessMap,i(b.sheenRoughnessMap,y.sheenRoughnessMapTransform))),b.clearcoat>0&&(y.clearcoat.value=b.clearcoat,y.clearcoatRoughness.value=b.clearcoatRoughness,b.clearcoatMap&&(y.clearcoatMap.value=b.clearcoatMap,i(b.clearcoatMap,y.clearcoatMapTransform)),b.clearcoatRoughnessMap&&(y.clearcoatRoughnessMap.value=b.clearcoatRoughnessMap,i(b.clearcoatRoughnessMap,y.clearcoatRoughnessMapTransform)),b.clearcoatNormalMap&&(y.clearcoatNormalMap.value=b.clearcoatNormalMap,i(b.clearcoatNormalMap,y.clearcoatNormalMapTransform),y.clearcoatNormalScale.value.copy(b.clearcoatNormalScale),b.side===el&&y.clearcoatNormalScale.value.negate())),b.dispersion>0&&(y.dispersion.value=b.dispersion),b.iridescence>0&&(y.iridescence.value=b.iridescence,y.iridescenceIOR.value=b.iridescenceIOR,y.iridescenceThicknessMinimum.value=b.iridescenceThicknessRange[0],y.iridescenceThicknessMaximum.value=b.iridescenceThicknessRange[1],b.iridescenceMap&&(y.iridescenceMap.value=b.iridescenceMap,i(b.iridescenceMap,y.iridescenceMapTransform)),b.iridescenceThicknessMap&&(y.iridescenceThicknessMap.value=b.iridescenceThicknessMap,i(b.iridescenceThicknessMap,y.iridescenceThicknessMapTransform))),b.transmission>0&&(y.transmission.value=b.transmission,y.transmissionSamplerMap.value=A.texture,y.transmissionSamplerSize.value.set(A.width,A.height),b.transmissionMap&&(y.transmissionMap.value=b.transmissionMap,i(b.transmissionMap,y.transmissionMapTransform)),y.thickness.value=b.thickness,b.thicknessMap&&(y.thicknessMap.value=b.thicknessMap,i(b.thicknessMap,y.thicknessMapTransform)),y.attenuationDistance.value=b.attenuationDistance,y.attenuationColor.value.copy(b.attenuationColor)),b.anisotropy>0&&(y.anisotropyVector.value.set(b.anisotropy*Math.cos(b.anisotropyRotation),b.anisotropy*Math.sin(b.anisotropyRotation)),b.anisotropyMap&&(y.anisotropyMap.value=b.anisotropyMap,i(b.anisotropyMap,y.anisotropyMapTransform))),y.specularIntensity.value=b.specularIntensity,y.specularColor.value.copy(b.specularColor),b.specularColorMap&&(y.specularColorMap.value=b.specularColorMap,i(b.specularColorMap,y.specularColorMapTransform)),b.specularIntensityMap&&(y.specularIntensityMap.value=b.specularIntensityMap,i(b.specularIntensityMap,y.specularIntensityMapTransform))}function g(y,b){b.matcap&&(y.matcap.value=b.matcap)}function x(y,b){const A=t.get(b).light;y.referencePosition.value.setFromMatrixPosition(A.matrixWorld),y.nearDistance.value=A.shadow.camera.near,y.farDistance.value=A.shadow.camera.far}return{refreshFogUniforms:n,refreshMaterialUniforms:r}}function Afe(e,t,i,n){let r={},s={},a=[];const o=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS);function l(A,w){const E=w.program;n.uniformBlockBinding(A,E)}function c(A,w){let E=r[A.id];E===void 0&&(g(A),E=u(A),r[A.id]=E,A.addEventListener("dispose",y));const D=w.program;n.updateUBOMapping(A,D);const T=t.render.frame;s[A.id]!==T&&(d(A),s[A.id]=T)}function u(A){const w=h();A.__bindingPointIndex=w;const E=e.createBuffer(),D=A.__size,T=A.usage;return e.bindBuffer(e.UNIFORM_BUFFER,E),e.bufferData(e.UNIFORM_BUFFER,D,T),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,w,E),E}function h(){for(let A=0;A<o;A++)if(a.indexOf(A)===-1)return a.push(A),A;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(A){const w=r[A.id],E=A.uniforms,D=A.__cache;e.bindBuffer(e.UNIFORM_BUFFER,w);for(let T=0,I=E.length;T<I;T++){const R=Array.isArray(E[T])?E[T]:[E[T]];for(let O=0,P=R.length;O<P;O++){const U=R[O];if(p(U,T,O,D)===!0){const H=U.__offset,V=Array.isArray(U.value)?U.value:[U.value];let j=0;for(let J=0;J<V.length;J++){const F=V[J],X=x(F);typeof F=="number"||typeof F=="boolean"?(U.__data[0]=F,e.bufferSubData(e.UNIFORM_BUFFER,H+j,U.__data)):F.isMatrix3?(U.__data[0]=F.elements[0],U.__data[1]=F.elements[1],U.__data[2]=F.elements[2],U.__data[3]=0,U.__data[4]=F.elements[3],U.__data[5]=F.elements[4],U.__data[6]=F.elements[5],U.__data[7]=0,U.__data[8]=F.elements[6],U.__data[9]=F.elements[7],U.__data[10]=F.elements[8],U.__data[11]=0):(F.toArray(U.__data,j),j+=X.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,H,U.__data)}}}e.bindBuffer(e.UNIFORM_BUFFER,null)}function p(A,w,E,D){const T=A.value,I=w+"_"+E;if(D[I]===void 0)return typeof T=="number"||typeof T=="boolean"?D[I]=T:D[I]=T.clone(),!0;{const R=D[I];if(typeof T=="number"||typeof T=="boolean"){if(R!==T)return D[I]=T,!0}else if(R.equals(T)===!1)return R.copy(T),!0}return!1}function g(A){const w=A.uniforms;let E=0;const D=16;for(let I=0,R=w.length;I<R;I++){const O=Array.isArray(w[I])?w[I]:[w[I]];for(let P=0,U=O.length;P<U;P++){const H=O[P],V=Array.isArray(H.value)?H.value:[H.value];for(let j=0,J=V.length;j<J;j++){const F=V[j],X=x(F),W=E%D,ne=W%X.boundary,Y=W+ne;E+=ne,Y!==0&&D-Y<X.storage&&(E+=D-Y),H.__data=new Float32Array(X.storage/Float32Array.BYTES_PER_ELEMENT),H.__offset=E,E+=X.storage}}}const T=E%D;return T>0&&(E+=D-T),A.__size=E,A.__cache={},this}function x(A){const w={boundary:0,storage:0};return typeof A=="number"||typeof A=="boolean"?(w.boundary=4,w.storage=4):A.isVector2?(w.boundary=8,w.storage=8):A.isVector3||A.isColor?(w.boundary=16,w.storage=12):A.isVector4?(w.boundary=16,w.storage=16):A.isMatrix3?(w.boundary=48,w.storage=48):A.isMatrix4?(w.boundary=64,w.storage=64):A.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",A),w}function y(A){const w=A.target;w.removeEventListener("dispose",y);const E=a.indexOf(w.__bindingPointIndex);a.splice(E,1),e.deleteBuffer(r[w.id]),delete r[w.id],delete s[w.id]}function b(){for(const A in r)e.deleteBuffer(r[A]);a=[],r={},s={}}return{bind:l,update:c,dispose:b}}class AQ{constructor(t={}){const{canvas:i=AY(),context:n=null,depth:r=!0,stencil:s=!1,alpha:a=!1,antialias:o=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:h=!1,reverseDepthBuffer:d=!1}=t;this.isWebGLRenderer=!0;let p;if(n!==null){if(typeof WebGLRenderingContext<"u"&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");p=n.getContextAttributes().alpha}else p=a;const g=new Uint32Array(4),x=new Int32Array(4);let y=null,b=null;const A=[],w=[];this.domElement=i,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=ud,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const E=this;let D=!1;this._outputColorSpace=fo;let T=0,I=0,R=null,O=-1,P=null;const U=new Rn,H=new Rn;let V=null;const j=new jt(0);let J=0,F=i.width,X=i.height,W=1,ne=null,Y=null;const $=new Rn(0,0,F,X),se=new Rn(0,0,F,X);let fe=!1;const te=new yb;let de=!1,le=!1;const _e=new di,be=new di,we=new me,Me=new Rn,Ne={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let Ge=!1;function We(){return R===null?W:1}let ae=n;function He(oe,Ue){return i.getContext(oe,Ue)}try{const oe={alpha:!0,depth:r,stencil:s,antialias:o,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:h};if("setAttribute"in i&&i.setAttribute("data-engine",`three.js r${mb}`),i.addEventListener("webglcontextlost",at,!1),i.addEventListener("webglcontextrestored",ut,!1),i.addEventListener("webglcontextcreationerror",lt,!1),ae===null){const Ue="webgl2";if(ae=He(Ue,oe),ae===null)throw He(Ue)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(oe){throw console.error("THREE.WebGLRenderer: "+oe.message),oe}let Ke,je,Oe,Qe,$e,gt,pe,k,Q,xe,K,Re,Le,st,Be,bt,vt,Xe,xt,_t,ye,Ve,At,ie;function Ce(){Ke=new Lhe(ae),Ke.init(),Ve=new _Q(ae,Ke),je=new Che(ae,Ke,t,Ve),Oe=new mfe(ae,Ke),je.reverseDepthBuffer&&d&&Oe.buffers.depth.setReversed(!0),Qe=new zhe(ae),$e=new ife,gt=new gfe(ae,Ke,Oe,$e,je,Ve,Qe),pe=new Rhe(E),k=new Ihe(E),Q=new jle(ae),At=new Ehe(ae,Q),xe=new Uhe(ae,Q,Qe,At),K=new Vhe(ae,xe,Q,Qe),xt=new Fhe(ae,je,gt),bt=new Dhe($e),Re=new tfe(E,pe,k,Ke,je,At,bt),Le=new _fe(E,$e),st=new rfe,Be=new ufe(Ke),Xe=new Mhe(E,pe,k,Oe,K,p,l),vt=new ffe(E,K,je),ie=new Afe(ae,Qe,je,Oe),_t=new The(ae,Ke,Qe),ye=new Nhe(ae,Ke,Qe),Qe.programs=Re.programs,E.capabilities=je,E.extensions=Ke,E.properties=$e,E.renderLists=st,E.shadowMap=vt,E.state=Oe,E.info=Qe}Ce();const De=new bfe(E,ae);this.xr=De,this.getContext=function(){return ae},this.getContextAttributes=function(){return ae.getContextAttributes()},this.forceContextLoss=function(){const oe=Ke.get("WEBGL_lose_context");oe&&oe.loseContext()},this.forceContextRestore=function(){const oe=Ke.get("WEBGL_lose_context");oe&&oe.restoreContext()},this.getPixelRatio=function(){return W},this.setPixelRatio=function(oe){oe!==void 0&&(W=oe,this.setSize(F,X,!1))},this.getSize=function(oe){return oe.set(F,X)},this.setSize=function(oe,Ue,nt=!0){if(De.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}F=oe,X=Ue,i.width=Math.floor(oe*W),i.height=Math.floor(Ue*W),nt===!0&&(i.style.width=oe+"px",i.style.height=Ue+"px"),this.setViewport(0,0,oe,Ue)},this.getDrawingBufferSize=function(oe){return oe.set(F*W,X*W).floor()},this.setDrawingBufferSize=function(oe,Ue,nt){F=oe,X=Ue,W=nt,i.width=Math.floor(oe*nt),i.height=Math.floor(Ue*nt),this.setViewport(0,0,oe,Ue)},this.getCurrentViewport=function(oe){return oe.copy(U)},this.getViewport=function(oe){return oe.copy($)},this.setViewport=function(oe,Ue,nt,Ze){oe.isVector4?$.set(oe.x,oe.y,oe.z,oe.w):$.set(oe,Ue,nt,Ze),Oe.viewport(U.copy($).multiplyScalar(W).round())},this.getScissor=function(oe){return oe.copy(se)},this.setScissor=function(oe,Ue,nt,Ze){oe.isVector4?se.set(oe.x,oe.y,oe.z,oe.w):se.set(oe,Ue,nt,Ze),Oe.scissor(H.copy(se).multiplyScalar(W).round())},this.getScissorTest=function(){return fe},this.setScissorTest=function(oe){Oe.setScissorTest(fe=oe)},this.setOpaqueSort=function(oe){ne=oe},this.setTransparentSort=function(oe){Y=oe},this.getClearColor=function(oe){return oe.copy(Xe.getClearColor())},this.setClearColor=function(){Xe.setClearColor(...arguments)},this.getClearAlpha=function(){return Xe.getClearAlpha()},this.setClearAlpha=function(){Xe.setClearAlpha(...arguments)},this.clear=function(oe=!0,Ue=!0,nt=!0){let Ze=0;if(oe){let Ie=!1;if(R!==null){const Rt=R.texture.format;Ie=Rt===dR||Rt===hR||Rt===Hw}if(Ie){const Rt=R.texture.type,wt=Rt===Kc||Rt===Zf||Rt===F1||Rt===V1||Rt===lR||Rt===cR,Nt=Xe.getClearColor(),Ht=Xe.getClearAlpha(),ai=Nt.r,$t=Nt.g,Z=Nt.b;wt?(g[0]=ai,g[1]=$t,g[2]=Z,g[3]=Ht,ae.clearBufferuiv(ae.COLOR,0,g)):(x[0]=ai,x[1]=$t,x[2]=Z,x[3]=Ht,ae.clearBufferiv(ae.COLOR,0,x))}else Ze|=ae.COLOR_BUFFER_BIT}Ue&&(Ze|=ae.DEPTH_BUFFER_BIT),nt&&(Ze|=ae.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),ae.clear(Ze)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){i.removeEventListener("webglcontextlost",at,!1),i.removeEventListener("webglcontextrestored",ut,!1),i.removeEventListener("webglcontextcreationerror",lt,!1),Xe.dispose(),st.dispose(),Be.dispose(),$e.dispose(),pe.dispose(),k.dispose(),K.dispose(),At.dispose(),ie.dispose(),Re.dispose(),De.dispose(),De.removeEventListener("sessionstart",jn),De.removeEventListener("sessionend",xr),Gr.stop()};function at(oe){oe.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),D=!0}function ut(){console.log("THREE.WebGLRenderer: Context Restored."),D=!1;const oe=Qe.autoReset,Ue=vt.enabled,nt=vt.autoUpdate,Ze=vt.needsUpdate,Ie=vt.type;Ce(),Qe.autoReset=oe,vt.enabled=Ue,vt.autoUpdate=nt,vt.needsUpdate=Ze,vt.type=Ie}function lt(oe){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",oe.statusMessage)}function It(oe){const Ue=oe.target;Ue.removeEventListener("dispose",It),Vt(Ue)}function Vt(oe){_i(oe),$e.remove(oe)}function _i(oe){const Ue=$e.get(oe).programs;Ue!==void 0&&(Ue.forEach(function(nt){Re.releaseProgram(nt)}),oe.isShaderMaterial&&Re.releaseShaderCache(oe))}this.renderBufferDirect=function(oe,Ue,nt,Ze,Ie,Rt){Ue===null&&(Ue=Ne);const wt=Ie.isMesh&&Ie.matrixWorld.determinant()<0,Nt=oi(oe,Ue,nt,Ze,Ie);Oe.setMaterial(Ze,wt);let Ht=nt.index,ai=1;if(Ze.wireframe===!0){if(Ht=xe.getWireframeAttribute(nt),Ht===void 0)return;ai=2}const $t=nt.drawRange,Z=nt.attributes.position;let re=$t.start*ai,Se=($t.start+$t.count)*ai;Rt!==null&&(re=Math.max(re,Rt.start*ai),Se=Math.min(Se,(Rt.start+Rt.count)*ai)),Ht!==null?(re=Math.max(re,0),Se=Math.min(Se,Ht.count)):Z!=null&&(re=Math.max(re,0),Se=Math.min(Se,Z.count));const ue=Se-re;if(ue<0||ue===1/0)return;At.setup(Ie,Ze,Nt,nt,Ht);let Pe,yt=_t;if(Ht!==null&&(Pe=Q.get(Ht),yt=ye,yt.setIndex(Pe)),Ie.isMesh)Ze.wireframe===!0?(Oe.setLineWidth(Ze.wireframeLinewidth*We()),yt.setMode(ae.LINES)):yt.setMode(ae.TRIANGLES);else if(Ie.isLine){let ti=Ze.linewidth;ti===void 0&&(ti=1),Oe.setLineWidth(ti*We()),Ie.isLineSegments?yt.setMode(ae.LINES):Ie.isLineLoop?yt.setMode(ae.LINE_LOOP):yt.setMode(ae.LINE_STRIP)}else Ie.isPoints?yt.setMode(ae.POINTS):Ie.isSprite&&yt.setMode(ae.TRIANGLES);if(Ie.isBatchedMesh)if(Ie._multiDrawInstances!==null)S1("THREE.WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),yt.renderMultiDrawInstances(Ie._multiDrawStarts,Ie._multiDrawCounts,Ie._multiDrawCount,Ie._multiDrawInstances);else if(Ke.get("WEBGL_multi_draw"))yt.renderMultiDraw(Ie._multiDrawStarts,Ie._multiDrawCounts,Ie._multiDrawCount);else{const ti=Ie._multiDrawStarts,Wn=Ie._multiDrawCounts,en=Ie._multiDrawCount,Pr=Ht?Q.get(Ht).bytesPerElement:1,wa=$e.get(Ze).currentProgram.getUniforms();for(let Dn=0;Dn<en;Dn++)wa.setValue(ae,"_gl_DrawID",Dn),yt.render(ti[Dn]/Pr,Wn[Dn])}else if(Ie.isInstancedMesh)yt.renderInstances(re,ue,Ie.count);else if(nt.isInstancedBufferGeometry){const ti=nt._maxInstanceCount!==void 0?nt._maxInstanceCount:1/0,Wn=Math.min(nt.instanceCount,ti);yt.renderInstances(re,ue,Wn)}else yt.render(re,ue)};function Jt(oe,Ue,nt){oe.transparent===!0&&oe.side===Hc&&oe.forceSinglePass===!1?(oe.side=el,oe.needsUpdate=!0,ot(oe,Ue,nt),oe.side=bd,oe.needsUpdate=!0,ot(oe,Ue,nt),oe.side=Hc):ot(oe,Ue,nt)}this.compile=function(oe,Ue,nt=null){nt===null&&(nt=oe),b=Be.get(nt),b.init(Ue),w.push(b),nt.traverseVisible(function(Ie){Ie.isLight&&Ie.layers.test(Ue.layers)&&(b.pushLight(Ie),Ie.castShadow&&b.pushShadow(Ie))}),oe!==nt&&oe.traverseVisible(function(Ie){Ie.isLight&&Ie.layers.test(Ue.layers)&&(b.pushLight(Ie),Ie.castShadow&&b.pushShadow(Ie))}),b.setupLights();const Ze=new Set;return oe.traverse(function(Ie){if(!(Ie.isMesh||Ie.isPoints||Ie.isLine||Ie.isSprite))return;const Rt=Ie.material;if(Rt)if(Array.isArray(Rt))for(let wt=0;wt<Rt.length;wt++){const Nt=Rt[wt];Jt(Nt,nt,Ie),Ze.add(Nt)}else Jt(Rt,nt,Ie),Ze.add(Rt)}),b=w.pop(),Ze},this.compileAsync=function(oe,Ue,nt=null){const Ze=this.compile(oe,Ue,nt);return new Promise(Ie=>{function Rt(){if(Ze.forEach(function(wt){$e.get(wt).currentProgram.isReady()&&Ze.delete(wt)}),Ze.size===0){Ie(oe);return}setTimeout(Rt,10)}Ke.get("KHR_parallel_shader_compile")!==null?Rt():setTimeout(Rt,10)})};let An=null;function $i(oe){An&&An(oe)}function jn(){Gr.stop()}function xr(){Gr.start()}const Gr=new vQ;Gr.setAnimationLoop($i),typeof self<"u"&&Gr.setContext(self),this.setAnimationLoop=function(oe){An=oe,De.setAnimationLoop(oe),oe===null?Gr.stop():Gr.start()},De.addEventListener("sessionstart",jn),De.addEventListener("sessionend",xr),this.render=function(oe,Ue){if(Ue!==void 0&&Ue.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(D===!0)return;if(oe.matrixWorldAutoUpdate===!0&&oe.updateMatrixWorld(),Ue.parent===null&&Ue.matrixWorldAutoUpdate===!0&&Ue.updateMatrixWorld(),De.enabled===!0&&De.isPresenting===!0&&(De.cameraAutoUpdate===!0&&De.updateCamera(Ue),Ue=De.getCamera()),oe.isScene===!0&&oe.onBeforeRender(E,oe,Ue,R),b=Be.get(oe,w.length),b.init(Ue),w.push(b),be.multiplyMatrices(Ue.projectionMatrix,Ue.matrixWorldInverse),te.setFromProjectionMatrix(be),le=this.localClippingEnabled,de=bt.init(this.clippingPlanes,le),y=st.get(oe,A.length),y.init(),A.push(y),De.enabled===!0&&De.isPresenting===!0){const Rt=E.xr.getDepthSensingMesh();Rt!==null&&kr(Rt,Ue,-1/0,E.sortObjects)}kr(oe,Ue,0,E.sortObjects),y.finish(),E.sortObjects===!0&&y.sort(ne,Y),Ge=De.enabled===!1||De.isPresenting===!1||De.hasDepthSensing()===!1,Ge&&Xe.addToRenderList(y,oe),this.info.render.frame++,de===!0&&bt.beginShadows();const nt=b.state.shadowsArray;vt.render(nt,oe,Ue),de===!0&&bt.endShadows(),this.info.autoReset===!0&&this.info.reset();const Ze=y.opaque,Ie=y.transmissive;if(b.setupLights(),Ue.isArrayCamera){const Rt=Ue.cameras;if(Ie.length>0)for(let wt=0,Nt=Rt.length;wt<Nt;wt++){const Ht=Rt[wt];et(Ze,Ie,oe,Ht)}Ge&&Xe.render(oe);for(let wt=0,Nt=Rt.length;wt<Nt;wt++){const Ht=Rt[wt];ve(y,oe,Ht,Ht.viewport)}}else Ie.length>0&&et(Ze,Ie,oe,Ue),Ge&&Xe.render(oe),ve(y,oe,Ue);R!==null&&I===0&&(gt.updateMultisampleRenderTarget(R),gt.updateRenderTargetMipmap(R)),oe.isScene===!0&&oe.onAfterRender(E,oe,Ue),At.resetDefaultState(),O=-1,P=null,w.pop(),w.length>0?(b=w[w.length-1],de===!0&&bt.setGlobalState(E.clippingPlanes,b.state.camera)):b=null,A.pop(),A.length>0?y=A[A.length-1]:y=null};function kr(oe,Ue,nt,Ze){if(oe.visible===!1)return;if(oe.layers.test(Ue.layers)){if(oe.isGroup)nt=oe.renderOrder;else if(oe.isLOD)oe.autoUpdate===!0&&oe.update(Ue);else if(oe.isLight)b.pushLight(oe),oe.castShadow&&b.pushShadow(oe);else if(oe.isSprite){if(!oe.frustumCulled||te.intersectsSprite(oe)){Ze&&Me.setFromMatrixPosition(oe.matrixWorld).applyMatrix4(be);const wt=K.update(oe),Nt=oe.material;Nt.visible&&y.push(oe,wt,Nt,nt,Me.z,null)}}else if((oe.isMesh||oe.isLine||oe.isPoints)&&(!oe.frustumCulled||te.intersectsObject(oe))){const wt=K.update(oe),Nt=oe.material;if(Ze&&(oe.boundingSphere!==void 0?(oe.boundingSphere===null&&oe.computeBoundingSphere(),Me.copy(oe.boundingSphere.center)):(wt.boundingSphere===null&&wt.computeBoundingSphere(),Me.copy(wt.boundingSphere.center)),Me.applyMatrix4(oe.matrixWorld).applyMatrix4(be)),Array.isArray(Nt)){const Ht=wt.groups;for(let ai=0,$t=Ht.length;ai<$t;ai++){const Z=Ht[ai],re=Nt[Z.materialIndex];re&&re.visible&&y.push(oe,wt,re,nt,Me.z,Z)}}else Nt.visible&&y.push(oe,wt,Nt,nt,Me.z,null)}}const Rt=oe.children;for(let wt=0,Nt=Rt.length;wt<Nt;wt++)kr(Rt[wt],Ue,nt,Ze)}function ve(oe,Ue,nt,Ze){const Ie=oe.opaque,Rt=oe.transmissive,wt=oe.transparent;b.setupLightsView(nt),de===!0&&bt.setGlobalState(E.clippingPlanes,nt),Ze&&Oe.viewport(U.copy(Ze)),Ie.length>0&&ft(Ie,Ue,nt),Rt.length>0&&ft(Rt,Ue,nt),wt.length>0&&ft(wt,Ue,nt),Oe.buffers.depth.setTest(!0),Oe.buffers.depth.setMask(!0),Oe.buffers.color.setMask(!0),Oe.setPolygonOffset(!1)}function et(oe,Ue,nt,Ze){if((nt.isScene===!0?nt.overrideMaterial:null)!==null)return;b.state.transmissionRenderTarget[Ze.id]===void 0&&(b.state.transmissionRenderTarget[Ze.id]=new Sd(1,1,{generateMipmaps:!0,type:Ke.has("EXT_color_buffer_half_float")||Ke.has("EXT_color_buffer_float")?vb:Kc,minFilter:kc,samples:4,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:_n.workingColorSpace}));const Rt=b.state.transmissionRenderTarget[Ze.id],wt=Ze.viewport||U;Rt.setSize(wt.z*E.transmissionResolutionScale,wt.w*E.transmissionResolutionScale);const Nt=E.getRenderTarget();E.setRenderTarget(Rt),E.getClearColor(j),J=E.getClearAlpha(),J<1&&E.setClearColor(16777215,.5),E.clear(),Ge&&Xe.render(nt);const Ht=E.toneMapping;E.toneMapping=ud;const ai=Ze.viewport;if(Ze.viewport!==void 0&&(Ze.viewport=void 0),b.setupLightsView(Ze),de===!0&&bt.setGlobalState(E.clippingPlanes,Ze),ft(oe,nt,Ze),gt.updateMultisampleRenderTarget(Rt),gt.updateRenderTargetMipmap(Rt),Ke.has("WEBGL_multisampled_render_to_texture")===!1){let $t=!1;for(let Z=0,re=Ue.length;Z<re;Z++){const Se=Ue[Z],ue=Se.object,Pe=Se.geometry,yt=Se.material,ti=Se.group;if(yt.side===Hc&&ue.layers.test(Ze.layers)){const Wn=yt.side;yt.side=el,yt.needsUpdate=!0,Ye(ue,nt,Ze,Pe,yt,ti),yt.side=Wn,yt.needsUpdate=!0,$t=!0}}$t===!0&&(gt.updateMultisampleRenderTarget(Rt),gt.updateRenderTargetMipmap(Rt))}E.setRenderTarget(Nt),E.setClearColor(j,J),ai!==void 0&&(Ze.viewport=ai),E.toneMapping=Ht}function ft(oe,Ue,nt){const Ze=Ue.isScene===!0?Ue.overrideMaterial:null;for(let Ie=0,Rt=oe.length;Ie<Rt;Ie++){const wt=oe[Ie],Nt=wt.object,Ht=wt.geometry,ai=wt.group;let $t=wt.material;$t.allowOverride===!0&&Ze!==null&&($t=Ze),Nt.layers.test(nt.layers)&&Ye(Nt,Ue,nt,Ht,$t,ai)}}function Ye(oe,Ue,nt,Ze,Ie,Rt){oe.onBeforeRender(E,Ue,nt,Ze,Ie,Rt),oe.modelViewMatrix.multiplyMatrices(nt.matrixWorldInverse,oe.matrixWorld),oe.normalMatrix.getNormalMatrix(oe.modelViewMatrix),Ie.onBeforeRender(E,Ue,nt,Ze,oe,Rt),Ie.transparent===!0&&Ie.side===Hc&&Ie.forceSinglePass===!1?(Ie.side=el,Ie.needsUpdate=!0,E.renderBufferDirect(nt,Ue,Ze,Ie,oe,Rt),Ie.side=bd,Ie.needsUpdate=!0,E.renderBufferDirect(nt,Ue,Ze,Ie,oe,Rt),Ie.side=Hc):E.renderBufferDirect(nt,Ue,Ze,Ie,oe,Rt),oe.onAfterRender(E,Ue,nt,Ze,Ie,Rt)}function ot(oe,Ue,nt){Ue.isScene!==!0&&(Ue=Ne);const Ze=$e.get(oe),Ie=b.state.lights,Rt=b.state.shadowsArray,wt=Ie.state.version,Nt=Re.getParameters(oe,Ie.state,Rt,Ue,nt),Ht=Re.getProgramCacheKey(Nt);let ai=Ze.programs;Ze.environment=oe.isMeshStandardMaterial?Ue.environment:null,Ze.fog=Ue.fog,Ze.envMap=(oe.isMeshStandardMaterial?k:pe).get(oe.envMap||Ze.environment),Ze.envMapRotation=Ze.environment!==null&&oe.envMap===null?Ue.environmentRotation:oe.envMapRotation,ai===void 0&&(oe.addEventListener("dispose",It),ai=new Map,Ze.programs=ai);let $t=ai.get(Ht);if($t!==void 0){if(Ze.currentProgram===$t&&Ze.lightsStateVersion===wt)return si(oe,Nt),$t}else Nt.uniforms=Re.getUniforms(oe),oe.onBeforeCompile(Nt,E),$t=Re.acquireProgram(Nt,Ht),ai.set(Ht,$t),Ze.uniforms=Nt.uniforms;const Z=Ze.uniforms;return(!oe.isShaderMaterial&&!oe.isRawShaderMaterial||oe.clipping===!0)&&(Z.clippingPlanes=bt.uniform),si(oe,Nt),Ze.needsLights=fi(oe),Ze.lightsStateVersion=wt,Ze.needsLights&&(Z.ambientLightColor.value=Ie.state.ambient,Z.lightProbe.value=Ie.state.probe,Z.directionalLights.value=Ie.state.directional,Z.directionalLightShadows.value=Ie.state.directionalShadow,Z.spotLights.value=Ie.state.spot,Z.spotLightShadows.value=Ie.state.spotShadow,Z.rectAreaLights.value=Ie.state.rectArea,Z.ltc_1.value=Ie.state.rectAreaLTC1,Z.ltc_2.value=Ie.state.rectAreaLTC2,Z.pointLights.value=Ie.state.point,Z.pointLightShadows.value=Ie.state.pointShadow,Z.hemisphereLights.value=Ie.state.hemi,Z.directionalShadowMap.value=Ie.state.directionalShadowMap,Z.directionalShadowMatrix.value=Ie.state.directionalShadowMatrix,Z.spotShadowMap.value=Ie.state.spotShadowMap,Z.spotLightMatrix.value=Ie.state.spotLightMatrix,Z.spotLightMap.value=Ie.state.spotLightMap,Z.pointShadowMap.value=Ie.state.pointShadowMap,Z.pointShadowMatrix.value=Ie.state.pointShadowMatrix),Ze.currentProgram=$t,Ze.uniformsList=null,$t}function kt(oe){if(oe.uniformsList===null){const Ue=oe.currentProgram.getUniforms();oe.uniformsList=MC.seqWithValue(Ue.seq,oe.uniforms)}return oe.uniformsList}function si(oe,Ue){const nt=$e.get(oe);nt.outputColorSpace=Ue.outputColorSpace,nt.batching=Ue.batching,nt.batchingColor=Ue.batchingColor,nt.instancing=Ue.instancing,nt.instancingColor=Ue.instancingColor,nt.instancingMorph=Ue.instancingMorph,nt.skinning=Ue.skinning,nt.morphTargets=Ue.morphTargets,nt.morphNormals=Ue.morphNormals,nt.morphColors=Ue.morphColors,nt.morphTargetsCount=Ue.morphTargetsCount,nt.numClippingPlanes=Ue.numClippingPlanes,nt.numIntersection=Ue.numClipIntersection,nt.vertexAlphas=Ue.vertexAlphas,nt.vertexTangents=Ue.vertexTangents,nt.toneMapping=Ue.toneMapping}function oi(oe,Ue,nt,Ze,Ie){Ue.isScene!==!0&&(Ue=Ne),gt.resetTextureUnits();const Rt=Ue.fog,wt=Ze.isMeshStandardMaterial?Ue.environment:null,Nt=R===null?E.outputColorSpace:R.isXRRenderTarget===!0?R.texture.colorSpace:$m,Ht=(Ze.isMeshStandardMaterial?k:pe).get(Ze.envMap||wt),ai=Ze.vertexColors===!0&&!!nt.attributes.color&&nt.attributes.color.itemSize===4,$t=!!nt.attributes.tangent&&(!!Ze.normalMap||Ze.anisotropy>0),Z=!!nt.morphAttributes.position,re=!!nt.morphAttributes.normal,Se=!!nt.morphAttributes.color;let ue=ud;Ze.toneMapped&&(R===null||R.isXRRenderTarget===!0)&&(ue=E.toneMapping);const Pe=nt.morphAttributes.position||nt.morphAttributes.normal||nt.morphAttributes.color,yt=Pe!==void 0?Pe.length:0,ti=$e.get(Ze),Wn=b.state.lights;if(de===!0&&(le===!0||oe!==P)){const gs=oe===P&&Ze.id===O;bt.setState(Ze,oe,gs)}let en=!1;Ze.version===ti.__version?(ti.needsLights&&ti.lightsStateVersion!==Wn.state.version||ti.outputColorSpace!==Nt||Ie.isBatchedMesh&&ti.batching===!1||!Ie.isBatchedMesh&&ti.batching===!0||Ie.isBatchedMesh&&ti.batchingColor===!0&&Ie.colorTexture===null||Ie.isBatchedMesh&&ti.batchingColor===!1&&Ie.colorTexture!==null||Ie.isInstancedMesh&&ti.instancing===!1||!Ie.isInstancedMesh&&ti.instancing===!0||Ie.isSkinnedMesh&&ti.skinning===!1||!Ie.isSkinnedMesh&&ti.skinning===!0||Ie.isInstancedMesh&&ti.instancingColor===!0&&Ie.instanceColor===null||Ie.isInstancedMesh&&ti.instancingColor===!1&&Ie.instanceColor!==null||Ie.isInstancedMesh&&ti.instancingMorph===!0&&Ie.morphTexture===null||Ie.isInstancedMesh&&ti.instancingMorph===!1&&Ie.morphTexture!==null||ti.envMap!==Ht||Ze.fog===!0&&ti.fog!==Rt||ti.numClippingPlanes!==void 0&&(ti.numClippingPlanes!==bt.numPlanes||ti.numIntersection!==bt.numIntersection)||ti.vertexAlphas!==ai||ti.vertexTangents!==$t||ti.morphTargets!==Z||ti.morphNormals!==re||ti.morphColors!==Se||ti.toneMapping!==ue||ti.morphTargetsCount!==yt)&&(en=!0):(en=!0,ti.__version=Ze.version);let Pr=ti.currentProgram;en===!0&&(Pr=ot(Ze,Ue,Ie));let wa=!1,Dn=!1,rc=!1;const Vn=Pr.getUniforms(),Bs=ti.uniforms;if(Oe.useProgram(Pr.program)&&(wa=!0,Dn=!0,rc=!0),Ze.id!==O&&(O=Ze.id,Dn=!0),wa||P!==oe){Oe.buffers.depth.getReversed()?(_e.copy(oe.projectionMatrix),pae(_e),mae(_e),Vn.setValue(ae,"projectionMatrix",_e)):Vn.setValue(ae,"projectionMatrix",oe.projectionMatrix),Vn.setValue(ae,"viewMatrix",oe.matrixWorldInverse);const vs=Vn.map.cameraPosition;vs!==void 0&&vs.setValue(ae,we.setFromMatrixPosition(oe.matrixWorld)),je.logarithmicDepthBuffer&&Vn.setValue(ae,"logDepthBufFC",2/(Math.log(oe.far+1)/Math.LN2)),(Ze.isMeshPhongMaterial||Ze.isMeshToonMaterial||Ze.isMeshLambertMaterial||Ze.isMeshBasicMaterial||Ze.isMeshStandardMaterial||Ze.isShaderMaterial)&&Vn.setValue(ae,"isOrthographic",oe.isOrthographicCamera===!0),P!==oe&&(P=oe,Dn=!0,rc=!0)}if(Ie.isSkinnedMesh){Vn.setOptional(ae,Ie,"bindMatrix"),Vn.setOptional(ae,Ie,"bindMatrixInverse");const gs=Ie.skeleton;gs&&(gs.boneTexture===null&&gs.computeBoneTexture(),Vn.setValue(ae,"boneTexture",gs.boneTexture,gt))}Ie.isBatchedMesh&&(Vn.setOptional(ae,Ie,"batchingTexture"),Vn.setValue(ae,"batchingTexture",Ie._matricesTexture,gt),Vn.setOptional(ae,Ie,"batchingIdTexture"),Vn.setValue(ae,"batchingIdTexture",Ie._indirectTexture,gt),Vn.setOptional(ae,Ie,"batchingColorTexture"),Ie._colorsTexture!==null&&Vn.setValue(ae,"batchingColorTexture",Ie._colorsTexture,gt));const jr=nt.morphAttributes;if((jr.position!==void 0||jr.normal!==void 0||jr.color!==void 0)&&xt.update(Ie,nt,Pr),(Dn||ti.receiveShadow!==Ie.receiveShadow)&&(ti.receiveShadow=Ie.receiveShadow,Vn.setValue(ae,"receiveShadow",Ie.receiveShadow)),Ze.isMeshGouraudMaterial&&Ze.envMap!==null&&(Bs.envMap.value=Ht,Bs.flipEnvMap.value=Ht.isCubeTexture&&Ht.isRenderTargetTexture===!1?-1:1),Ze.isMeshStandardMaterial&&Ze.envMap===null&&Ue.environment!==null&&(Bs.envMapIntensity.value=Ue.environmentIntensity),Dn&&(Vn.setValue(ae,"toneMappingExposure",E.toneMappingExposure),ti.needsLights&&Zt(Bs,rc),Rt&&Ze.fog===!0&&Le.refreshFogUniforms(Bs,Rt),Le.refreshMaterialUniforms(Bs,Ze,W,X,b.state.transmissionRenderTarget[oe.id]),MC.upload(ae,kt(ti),Bs,gt)),Ze.isShaderMaterial&&Ze.uniformsNeedUpdate===!0&&(MC.upload(ae,kt(ti),Bs,gt),Ze.uniformsNeedUpdate=!1),Ze.isSpriteMaterial&&Vn.setValue(ae,"center",Ie.center),Vn.setValue(ae,"modelViewMatrix",Ie.modelViewMatrix),Vn.setValue(ae,"normalMatrix",Ie.normalMatrix),Vn.setValue(ae,"modelMatrix",Ie.matrixWorld),Ze.isShaderMaterial||Ze.isRawShaderMaterial){const gs=Ze.uniformsGroups;for(let vs=0,Ma=gs.length;vs<Ma;vs++){const sc=gs[vs];ie.update(sc,Pr),ie.bind(sc,Pr)}}return Pr}function Zt(oe,Ue){oe.ambientLightColor.needsUpdate=Ue,oe.lightProbe.needsUpdate=Ue,oe.directionalLights.needsUpdate=Ue,oe.directionalLightShadows.needsUpdate=Ue,oe.pointLights.needsUpdate=Ue,oe.pointLightShadows.needsUpdate=Ue,oe.spotLights.needsUpdate=Ue,oe.spotLightShadows.needsUpdate=Ue,oe.rectAreaLights.needsUpdate=Ue,oe.hemisphereLights.needsUpdate=Ue}function fi(oe){return oe.isMeshLambertMaterial||oe.isMeshToonMaterial||oe.isMeshPhongMaterial||oe.isMeshStandardMaterial||oe.isShadowMaterial||oe.isShaderMaterial&&oe.lights===!0}this.getActiveCubeFace=function(){return T},this.getActiveMipmapLevel=function(){return I},this.getRenderTarget=function(){return R},this.setRenderTargetTextures=function(oe,Ue,nt){const Ze=$e.get(oe);Ze.__autoAllocateDepthBuffer=oe.resolveDepthBuffer===!1,Ze.__autoAllocateDepthBuffer===!1&&(Ze.__useRenderToTexture=!1),$e.get(oe.texture).__webglTexture=Ue,$e.get(oe.depthTexture).__webglTexture=Ze.__autoAllocateDepthBuffer?void 0:nt,Ze.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(oe,Ue){const nt=$e.get(oe);nt.__webglFramebuffer=Ue,nt.__useDefaultFramebuffer=Ue===void 0};const Ri=ae.createFramebuffer();this.setRenderTarget=function(oe,Ue=0,nt=0){R=oe,T=Ue,I=nt;let Ze=!0,Ie=null,Rt=!1,wt=!1;if(oe){const Ht=$e.get(oe);if(Ht.__useDefaultFramebuffer!==void 0)Oe.bindFramebuffer(ae.FRAMEBUFFER,null),Ze=!1;else if(Ht.__webglFramebuffer===void 0)gt.setupRenderTarget(oe);else if(Ht.__hasExternalTextures)gt.rebindTextures(oe,$e.get(oe.texture).__webglTexture,$e.get(oe.depthTexture).__webglTexture);else if(oe.depthBuffer){const Z=oe.depthTexture;if(Ht.__boundDepthTexture!==Z){if(Z!==null&&$e.has(Z)&&(oe.width!==Z.image.width||oe.height!==Z.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");gt.setupDepthRenderbuffer(oe)}}const ai=oe.texture;(ai.isData3DTexture||ai.isDataArrayTexture||ai.isCompressedArrayTexture)&&(wt=!0);const $t=$e.get(oe).__webglFramebuffer;oe.isWebGLCubeRenderTarget?(Array.isArray($t[Ue])?Ie=$t[Ue][nt]:Ie=$t[Ue],Rt=!0):oe.samples>0&&gt.useMultisampledRTT(oe)===!1?Ie=$e.get(oe).__webglMultisampledFramebuffer:Array.isArray($t)?Ie=$t[nt]:Ie=$t,U.copy(oe.viewport),H.copy(oe.scissor),V=oe.scissorTest}else U.copy($).multiplyScalar(W).floor(),H.copy(se).multiplyScalar(W).floor(),V=fe;if(nt!==0&&(Ie=Ri),Oe.bindFramebuffer(ae.FRAMEBUFFER,Ie)&&Ze&&Oe.drawBuffers(oe,Ie),Oe.viewport(U),Oe.scissor(H),Oe.setScissorTest(V),Rt){const Ht=$e.get(oe.texture);ae.framebufferTexture2D(ae.FRAMEBUFFER,ae.COLOR_ATTACHMENT0,ae.TEXTURE_CUBE_MAP_POSITIVE_X+Ue,Ht.__webglTexture,nt)}else if(wt){const Ht=$e.get(oe.texture),ai=Ue;ae.framebufferTextureLayer(ae.FRAMEBUFFER,ae.COLOR_ATTACHMENT0,Ht.__webglTexture,nt,ai)}else if(oe!==null&&nt!==0){const Ht=$e.get(oe.texture);ae.framebufferTexture2D(ae.FRAMEBUFFER,ae.COLOR_ATTACHMENT0,ae.TEXTURE_2D,Ht.__webglTexture,nt)}O=-1},this.readRenderTargetPixels=function(oe,Ue,nt,Ze,Ie,Rt,wt,Nt=0){if(!(oe&&oe.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Ht=$e.get(oe).__webglFramebuffer;if(oe.isWebGLCubeRenderTarget&&wt!==void 0&&(Ht=Ht[wt]),Ht){Oe.bindFramebuffer(ae.FRAMEBUFFER,Ht);try{const ai=oe.textures[Nt],$t=ai.format,Z=ai.type;if(!je.textureFormatReadable($t)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!je.textureTypeReadable(Z)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Ue>=0&&Ue<=oe.width-Ze&&nt>=0&&nt<=oe.height-Ie&&(oe.textures.length>1&&ae.readBuffer(ae.COLOR_ATTACHMENT0+Nt),ae.readPixels(Ue,nt,Ze,Ie,Ve.convert($t),Ve.convert(Z),Rt))}finally{const ai=R!==null?$e.get(R).__webglFramebuffer:null;Oe.bindFramebuffer(ae.FRAMEBUFFER,ai)}}},this.readRenderTargetPixelsAsync=async function(oe,Ue,nt,Ze,Ie,Rt,wt,Nt=0){if(!(oe&&oe.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Ht=$e.get(oe).__webglFramebuffer;if(oe.isWebGLCubeRenderTarget&&wt!==void 0&&(Ht=Ht[wt]),Ht)if(Ue>=0&&Ue<=oe.width-Ze&&nt>=0&&nt<=oe.height-Ie){Oe.bindFramebuffer(ae.FRAMEBUFFER,Ht);const ai=oe.textures[Nt],$t=ai.format,Z=ai.type;if(!je.textureFormatReadable($t))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!je.textureTypeReadable(Z))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const re=ae.createBuffer();ae.bindBuffer(ae.PIXEL_PACK_BUFFER,re),ae.bufferData(ae.PIXEL_PACK_BUFFER,Rt.byteLength,ae.STREAM_READ),oe.textures.length>1&&ae.readBuffer(ae.COLOR_ATTACHMENT0+Nt),ae.readPixels(Ue,nt,Ze,Ie,Ve.convert($t),Ve.convert(Z),0);const Se=R!==null?$e.get(R).__webglFramebuffer:null;Oe.bindFramebuffer(ae.FRAMEBUFFER,Se);const ue=ae.fenceSync(ae.SYNC_GPU_COMMANDS_COMPLETE,0);return ae.flush(),await fae(ae,ue,4),ae.bindBuffer(ae.PIXEL_PACK_BUFFER,re),ae.getBufferSubData(ae.PIXEL_PACK_BUFFER,0,Rt),ae.deleteBuffer(re),ae.deleteSync(ue),Rt}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")},this.copyFramebufferToTexture=function(oe,Ue=null,nt=0){const Ze=Math.pow(2,-nt),Ie=Math.floor(oe.image.width*Ze),Rt=Math.floor(oe.image.height*Ze),wt=Ue!==null?Ue.x:0,Nt=Ue!==null?Ue.y:0;gt.setTexture2D(oe,0),ae.copyTexSubImage2D(ae.TEXTURE_2D,nt,0,0,wt,Nt,Ie,Rt),Oe.unbindTexture()};const Pi=ae.createFramebuffer(),li=ae.createFramebuffer();this.copyTextureToTexture=function(oe,Ue,nt=null,Ze=null,Ie=0,Rt=null){Rt===null&&(Ie!==0?(S1("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),Rt=Ie,Ie=0):Rt=0);let wt,Nt,Ht,ai,$t,Z,re,Se,ue;const Pe=oe.isCompressedTexture?oe.mipmaps[Rt]:oe.image;if(nt!==null)wt=nt.max.x-nt.min.x,Nt=nt.max.y-nt.min.y,Ht=nt.isBox3?nt.max.z-nt.min.z:1,ai=nt.min.x,$t=nt.min.y,Z=nt.isBox3?nt.min.z:0;else{const jr=Math.pow(2,-Ie);wt=Math.floor(Pe.width*jr),Nt=Math.floor(Pe.height*jr),oe.isDataArrayTexture?Ht=Pe.depth:oe.isData3DTexture?Ht=Math.floor(Pe.depth*jr):Ht=1,ai=0,$t=0,Z=0}Ze!==null?(re=Ze.x,Se=Ze.y,ue=Ze.z):(re=0,Se=0,ue=0);const yt=Ve.convert(Ue.format),ti=Ve.convert(Ue.type);let Wn;Ue.isData3DTexture?(gt.setTexture3D(Ue,0),Wn=ae.TEXTURE_3D):Ue.isDataArrayTexture||Ue.isCompressedArrayTexture?(gt.setTexture2DArray(Ue,0),Wn=ae.TEXTURE_2D_ARRAY):(gt.setTexture2D(Ue,0),Wn=ae.TEXTURE_2D),ae.pixelStorei(ae.UNPACK_FLIP_Y_WEBGL,Ue.flipY),ae.pixelStorei(ae.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ue.premultiplyAlpha),ae.pixelStorei(ae.UNPACK_ALIGNMENT,Ue.unpackAlignment);const en=ae.getParameter(ae.UNPACK_ROW_LENGTH),Pr=ae.getParameter(ae.UNPACK_IMAGE_HEIGHT),wa=ae.getParameter(ae.UNPACK_SKIP_PIXELS),Dn=ae.getParameter(ae.UNPACK_SKIP_ROWS),rc=ae.getParameter(ae.UNPACK_SKIP_IMAGES);ae.pixelStorei(ae.UNPACK_ROW_LENGTH,Pe.width),ae.pixelStorei(ae.UNPACK_IMAGE_HEIGHT,Pe.height),ae.pixelStorei(ae.UNPACK_SKIP_PIXELS,ai),ae.pixelStorei(ae.UNPACK_SKIP_ROWS,$t),ae.pixelStorei(ae.UNPACK_SKIP_IMAGES,Z);const Vn=oe.isDataArrayTexture||oe.isData3DTexture,Bs=Ue.isDataArrayTexture||Ue.isData3DTexture;if(oe.isDepthTexture){const jr=$e.get(oe),gs=$e.get(Ue),vs=$e.get(jr.__renderTarget),Ma=$e.get(gs.__renderTarget);Oe.bindFramebuffer(ae.READ_FRAMEBUFFER,vs.__webglFramebuffer),Oe.bindFramebuffer(ae.DRAW_FRAMEBUFFER,Ma.__webglFramebuffer);for(let sc=0;sc<Ht;sc++)Vn&&(ae.framebufferTextureLayer(ae.READ_FRAMEBUFFER,ae.COLOR_ATTACHMENT0,$e.get(oe).__webglTexture,Ie,Z+sc),ae.framebufferTextureLayer(ae.DRAW_FRAMEBUFFER,ae.COLOR_ATTACHMENT0,$e.get(Ue).__webglTexture,Rt,ue+sc)),ae.blitFramebuffer(ai,$t,wt,Nt,re,Se,wt,Nt,ae.DEPTH_BUFFER_BIT,ae.NEAREST);Oe.bindFramebuffer(ae.READ_FRAMEBUFFER,null),Oe.bindFramebuffer(ae.DRAW_FRAMEBUFFER,null)}else if(Ie!==0||oe.isRenderTargetTexture||$e.has(oe)){const jr=$e.get(oe),gs=$e.get(Ue);Oe.bindFramebuffer(ae.READ_FRAMEBUFFER,Pi),Oe.bindFramebuffer(ae.DRAW_FRAMEBUFFER,li);for(let vs=0;vs<Ht;vs++)Vn?ae.framebufferTextureLayer(ae.READ_FRAMEBUFFER,ae.COLOR_ATTACHMENT0,jr.__webglTexture,Ie,Z+vs):ae.framebufferTexture2D(ae.READ_FRAMEBUFFER,ae.COLOR_ATTACHMENT0,ae.TEXTURE_2D,jr.__webglTexture,Ie),Bs?ae.framebufferTextureLayer(ae.DRAW_FRAMEBUFFER,ae.COLOR_ATTACHMENT0,gs.__webglTexture,Rt,ue+vs):ae.framebufferTexture2D(ae.DRAW_FRAMEBUFFER,ae.COLOR_ATTACHMENT0,ae.TEXTURE_2D,gs.__webglTexture,Rt),Ie!==0?ae.blitFramebuffer(ai,$t,wt,Nt,re,Se,wt,Nt,ae.COLOR_BUFFER_BIT,ae.NEAREST):Bs?ae.copyTexSubImage3D(Wn,Rt,re,Se,ue+vs,ai,$t,wt,Nt):ae.copyTexSubImage2D(Wn,Rt,re,Se,ai,$t,wt,Nt);Oe.bindFramebuffer(ae.READ_FRAMEBUFFER,null),Oe.bindFramebuffer(ae.DRAW_FRAMEBUFFER,null)}else Bs?oe.isDataTexture||oe.isData3DTexture?ae.texSubImage3D(Wn,Rt,re,Se,ue,wt,Nt,Ht,yt,ti,Pe.data):Ue.isCompressedArrayTexture?ae.compressedTexSubImage3D(Wn,Rt,re,Se,ue,wt,Nt,Ht,yt,Pe.data):ae.texSubImage3D(Wn,Rt,re,Se,ue,wt,Nt,Ht,yt,ti,Pe):oe.isDataTexture?ae.texSubImage2D(ae.TEXTURE_2D,Rt,re,Se,wt,Nt,yt,ti,Pe.data):oe.isCompressedTexture?ae.compressedTexSubImage2D(ae.TEXTURE_2D,Rt,re,Se,Pe.width,Pe.height,yt,Pe.data):ae.texSubImage2D(ae.TEXTURE_2D,Rt,re,Se,wt,Nt,yt,ti,Pe);ae.pixelStorei(ae.UNPACK_ROW_LENGTH,en),ae.pixelStorei(ae.UNPACK_IMAGE_HEIGHT,Pr),ae.pixelStorei(ae.UNPACK_SKIP_PIXELS,wa),ae.pixelStorei(ae.UNPACK_SKIP_ROWS,Dn),ae.pixelStorei(ae.UNPACK_SKIP_IMAGES,rc),Rt===0&&Ue.generateMipmaps&&ae.generateMipmap(Wn),Oe.unbindTexture()},this.copyTextureToTexture3D=function(oe,Ue,nt=null,Ze=null,Ie=0){return S1('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(oe,Ue,nt,Ze,Ie)},this.initRenderTarget=function(oe){$e.get(oe).__webglFramebuffer===void 0&&gt.setupRenderTarget(oe)},this.initTexture=function(oe){oe.isCubeTexture?gt.setTextureCube(oe,0):oe.isData3DTexture?gt.setTexture3D(oe,0):oe.isDataArrayTexture||oe.isCompressedArrayTexture?gt.setTexture2DArray(oe,0):gt.setTexture2D(oe,0),Oe.unbindTexture()},this.resetState=function(){T=0,I=0,R=null,Oe.reset(),At.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return jc}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(t){this._outputColorSpace=t;const i=this.getContext();i.drawingBufferColorSpace=_n._getDrawingBufferColorSpace(t),i.unpackColorSpace=_n._getUnpackColorSpace()}}const wfe=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:qz,AddEquation:Cm,AddOperation:eY,AdditiveAnimationBlendMode:tF,AdditiveBlending:qL,AgXToneMapping:sY,AlphaFormat:Jz,AlwaysCompare:SY,AlwaysDepth:iD,AlwaysStencilFunc:JL,AmbientLight:rQ,AnimationAction:pQ,AnimationClip:Q1,AnimationLoader:Hoe,AnimationMixer:ple,AnimationObjectGroup:dle,AnimationUtils:Noe,ArcCurve:IY,ArrayCamera:hQ,ArrowHelper:Lle,AttachedBindMode:KL,Audio:dQ,AudioAnalyser:ile,AudioContext:IF,AudioListener:$oe,AudioLoader:Koe,AxesHelper:Ule,BackSide:el,BasicDepthPacking:dY,BasicShadowMap:Iq,BatchedMesh:PY,Bone:xR,BooleanKeyframeTrack:W0,Box2:Sle,Box3:Ya,Box3Helper:Ble,BoxGeometry:j0,BoxHelper:Ole,BufferAttribute:Pn,BufferGeometry:ki,BufferGeometryLoader:cQ,ByteType:Yz,Cache:Nf,Camera:gR,CameraHelper:Ple,CanvasTexture:aoe,CapsuleGeometry:_R,CatmullRomCurve3:LY,CineonToneMapping:nY,CircleGeometry:AR,ClampToEdgeWrapping:Zl,Clock:LF,Color:jt,ColorKeyframeTrack:CF,ColorManagement:_n,CompressedArrayTexture:roe,CompressedCubeTexture:soe,CompressedTexture:SR,CompressedTextureLoader:Goe,ConeGeometry:qw,ConstantAlphaFactor:Jq,ConstantColorFactor:Qq,Controls:zle,CubeCamera:cF,CubeReflectionMapping:Jf,CubeRefractionMapping:Jm,CubeTexture:Gw,CubeTextureLoader:koe,CubeUVReflectionMapping:gb,CubicBezierCurve:xF,CubicBezierCurve3:UY,CubicInterpolant:eQ,CullFaceBack:XL,CullFaceFront:Bq,CullFaceFrontBack:vse,CullFaceNone:Oq,Curve:nh,CurvePath:zY,CustomBlending:Lq,CustomToneMapping:rY,CylinderGeometry:Xw,Cylindrical:ble,Data3DTexture:mR,DataArrayTexture:pR,DataTexture:hd,DataTextureLoader:joe,DataUtils:Rae,DecrementStencilOp:Cse,DecrementWrapStencilOp:Rse,DefaultLoadingManager:a1,DepthFormat:H1,DepthStencilFormat:G1,DepthTexture:vF,DetachedBindMode:oY,DirectionalLight:BF,DirectionalLightHelper:Rle,DiscreteInterpolant:tQ,DodecahedronGeometry:wR,DoubleSide:Hc,DstAlphaFactor:jq,DstColorFactor:Xq,DynamicCopyUsage:jse,DynamicDrawUsage:p0,DynamicReadUsage:Hse,EdgesGeometry:BY,EllipseCurve:MR,EqualCompare:vY,EqualDepth:rD,EqualStencilFunc:Ise,EquirectangularReflectionMapping:YA,EquirectangularRefractionMapping:QA,Euler:tl,EventDispatcher:Cd,ExtrudeGeometry:ER,FileLoader:ic,Float16BufferAttribute:Nae,Float32BufferAttribute:ei,FloatType:Tl,Fog:yR,FogExp2:vR,FramebufferTexture:noe,FrontSide:bd,Frustum:yb,FrustumArray:bR,GLBufferAttribute:xle,GLSL1:Xse,GLSL3:ZL,GreaterCompare:yY,GreaterDepth:aD,GreaterEqualCompare:bY,GreaterEqualDepth:sD,GreaterEqualStencilFunc:zse,GreaterStencilFunc:Use,GridHelper:Cle,Group:Uf,HalfFloatType:vb,HemisphereLight:nQ,HemisphereLightHelper:Tle,IcosahedronGeometry:TR,ImageBitmapLoader:uQ,ImageLoader:rw,ImageUtils:wY,IncrementStencilOp:Tse,IncrementWrapStencilOp:Dse,InstancedBufferAttribute:T0,InstancedBufferGeometry:lQ,InstancedInterleavedBuffer:yle,InstancedMesh:pF,Int16BufferAttribute:Lae,Int32BufferAttribute:Uae,Int8BufferAttribute:Oae,IntType:oR,InterleavedBuffer:kw,InterleavedBufferAttribute:eg,Interpolant:bb,InterpolateDiscrete:k1,InterpolateLinear:j1,InterpolateSmooth:AC,InterpolationSamplingMode:Qse,InterpolationSamplingType:Yse,InvertStencilOp:Pse,KeepStencilOp:Nv,KeyframeTrack:tu,LOD:RY,LatheGeometry:CR,Layers:X1,LessCompare:gY,LessDepth:nD,LessEqualCompare:nF,LessEqualDepth:E0,LessEqualStencilFunc:Lse,LessStencilFunc:Bse,Light:ug,LightProbe:oQ,Line:$f,Line3:_le,LineBasicMaterial:So,LineCurve:bF,LineCurve3:NY,LineDashedMaterial:JY,LineLoop:mF,LineSegments:ih,LinearFilter:hs,LinearInterpolant:TF,LinearMipMapLinearFilter:Sse,LinearMipMapNearestFilter:bse,LinearMipmapLinearFilter:kc,LinearMipmapNearestFilter:b1,LinearSRGBColorSpace:$m,LinearToneMapping:tY,LinearTransfer:JA,Loader:_o,LoaderUtils:Wm,LoadingManager:DF,LoopOnce:lY,LoopPingPong:uY,LoopRepeat:cY,MOUSE:Lv,Material:Js,MaterialLoader:LR,MathUtils:sF,Matrix2:FF,Matrix3:Ki,Matrix4:di,MaxEquation:Fq,Mesh:ts,MeshBasicMaterial:$l,MeshDepthMaterial:wF,MeshDistanceMaterial:MF,MeshLambertMaterial:QY,MeshMatcapMaterial:KY,MeshNormalMaterial:YY,MeshPhongMaterial:XY,MeshPhysicalMaterial:eu,MeshStandardMaterial:Kw,MeshToonMaterial:qY,MinEquation:zq,MirroredRepeatWrapping:z1,MixOperation:$q,MultiplyBlending:QL,MultiplyOperation:Vw,NearestFilter:xa,NearestMipMapLinearFilter:xse,NearestMipMapNearestFilter:yse,NearestMipmapLinearFilter:Jv,NearestMipmapNearestFilter:aR,NeutralToneMapping:aY,NeverCompare:mY,NeverDepth:tD,NeverStencilFunc:Ose,NoBlending:Wf,NoColorSpace:Of,NoToneMapping:ud,NormalAnimationBlendMode:fR,NormalBlending:f0,NotEqualCompare:xY,NotEqualDepth:oD,NotEqualStencilFunc:Nse,NumberKeyframeTrack:D0,Object3D:gn,ObjectLoader:Yoe,ObjectSpaceNormalMap:pY,OctahedronGeometry:Yw,OneFactor:Hq,OneMinusConstantAlphaFactor:Zq,OneMinusConstantColorFactor:Kq,OneMinusDstAlphaFactor:Wq,OneMinusDstColorFactor:qq,OneMinusSrcAlphaFactor:eD,OneMinusSrcColorFactor:kq,OrthographicCamera:Qu,PCFShadowMap:rR,PCFSoftShadowMap:gA,PMREMGenerator:aU,Path:zD,PerspectiveCamera:Dr,Plane:Ef,PlaneGeometry:xb,PlaneHelper:Ile,PointLight:OF,PointLightHelper:Mle,Points:gF,PointsMaterial:Ww,PolarGridHelper:Dle,PolyhedronGeometry:cg,PositionalAudio:tle,PropertyBinding:Cn,PropertyMixer:fQ,QuadraticBezierCurve:SF,QuadraticBezierCurve3:_F,Quaternion:ba,QuaternionKeyframeTrack:R0,QuaternionLinearInterpolant:iQ,RED_GREEN_RGTC2_Format:OD,RED_RGTC1_Format:eF,REVISION:mb,RGBADepthPacking:fY,RGBAFormat:go,RGBAIntegerFormat:dR,RGBA_ASTC_10x10_Format:ED,RGBA_ASTC_10x5_Format:AD,RGBA_ASTC_10x6_Format:wD,RGBA_ASTC_10x8_Format:MD,RGBA_ASTC_12x10_Format:TD,RGBA_ASTC_12x12_Format:CD,RGBA_ASTC_4x4_Format:mD,RGBA_ASTC_5x4_Format:gD,RGBA_ASTC_5x5_Format:vD,RGBA_ASTC_6x5_Format:yD,RGBA_ASTC_6x6_Format:xD,RGBA_ASTC_8x5_Format:bD,RGBA_ASTC_8x6_Format:SD,RGBA_ASTC_8x8_Format:_D,RGBA_BPTC_Format:SA,RGBA_ETC2_EAC_Format:pD,RGBA_PVRTC_2BPPV1_Format:hD,RGBA_PVRTC_4BPPV1_Format:uD,RGBA_S3TC_DXT1_Format:yA,RGBA_S3TC_DXT3_Format:xA,RGBA_S3TC_DXT5_Format:bA,RGBDepthPacking:Ase,RGBFormat:Zz,RGBIntegerFormat:_se,RGB_BPTC_SIGNED_Format:DD,RGB_BPTC_UNSIGNED_Format:RD,RGB_ETC1_Format:dD,RGB_ETC2_Format:fD,RGB_PVRTC_2BPPV1_Format:cD,RGB_PVRTC_4BPPV1_Format:lD,RGB_S3TC_DXT1_Format:vA,RGDepthPacking:wse,RGFormat:$z,RGIntegerFormat:hR,RawShaderMaterial:WY,Ray:k0,Raycaster:mQ,RectAreaLight:sQ,RedFormat:uR,RedIntegerFormat:Hw,ReinhardToneMapping:iY,RenderTarget:aF,RenderTarget3D:mle,RepeatWrapping:Zm,ReplaceStencilOp:Ese,ReverseSubtractEquation:Nq,RingGeometry:DR,SIGNED_RED_GREEN_RGTC2_Format:BD,SIGNED_RED_RGTC1_Format:PD,SRGBColorSpace:fo,SRGBTransfer:Jn,Scene:hF,ShaderChunk:nn,ShaderLib:Gu,ShaderMaterial:Ju,ShadowMaterial:jY,Shape:g0,ShapeGeometry:RR,ShapePath:Nle,ShapeUtils:Wu,ShortType:Qz,Skeleton:jw,SkeletonHelper:wle,SkinnedMesh:fF,Source:Lm,Sphere:Sa,SphereGeometry:Qw,Spherical:rU,SphericalHarmonics3:aQ,SplineCurve:AF,SpotLight:PF,SpotLightHelper:Ale,Sprite:DY,SpriteMaterial:dF,SrcAlphaFactor:$C,SrcAlphaSaturateFactor:Yq,SrcColorFactor:Gq,StaticCopyUsage:kse,StaticDrawUsage:ZA,StaticReadUsage:Vse,StereoCamera:Joe,StreamCopyUsage:Wse,StreamDrawUsage:Fse,StreamReadUsage:Gse,StringKeyframeTrack:X0,SubtractEquation:Uq,SubtractiveBlending:YL,TOUCH:Uv,TangentSpaceNormalMap:lg,TetrahedronGeometry:PR,Texture:vr,TextureLoader:Jw,TextureUtils:kle,TimestampQuery:qse,TorusGeometry:OR,TorusKnotGeometry:BR,Triangle:wl,TriangleFanDrawMode:ID,TriangleStripDrawMode:iF,TrianglesDrawMode:hY,TubeGeometry:IR,UVMapping:sR,Uint16BufferAttribute:oF,Uint32BufferAttribute:lF,Uint8BufferAttribute:Bae,Uint8ClampedBufferAttribute:Iae,Uniform:zF,UniformsGroup:vle,UniformsLib:Xt,UniformsUtils:TY,UnsignedByteType:Kc,UnsignedInt248Type:V1,UnsignedInt5999Type:Kz,UnsignedIntType:Zf,UnsignedShort4444Type:lR,UnsignedShort5551Type:cR,UnsignedShortType:F1,VSMShadowMap:Hu,Vector2:Mt,Vector3:me,Vector4:Rn,VectorKeyframeTrack:P0,VideoFrameTexture:ioe,VideoTexture:OY,WebGL3DRenderTarget:bae,WebGLArrayRenderTarget:xae,WebGLCoordinateSystem:jc,WebGLCubeRenderTarget:uF,WebGLRenderTarget:Sd,WebGLRenderer:AQ,WebGLUtils:_Q,WebGPUCoordinateSystem:$A,WebXRController:wC,WireframeGeometry:kY,WrapAroundEnding:KA,ZeroCurvatureEnding:Zv,ZeroFactor:Vq,ZeroSlopeEnding:$v,ZeroStencilOp:Mse,createCanvasElement:AY},Symbol.toStringTag,{value:"Module"}));var QO={exports:{}},lf={};/**
 * @license React
 * react-reconciler-constants.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kG;function Mfe(){return kG||(kG=1,lf.ConcurrentRoot=1,lf.ContinuousEventPriority=8,lf.DefaultEventPriority=32,lf.DiscreteEventPriority=2,lf.IdleEventPriority=268435456,lf.LegacyRoot=0,lf.NoEventPriority=0),lf}var jG;function Efe(){return jG||(jG=1,QO.exports=Mfe()),QO.exports}var EC=Efe(),KO={exports:{}},JO={},ZO={exports:{}},$O={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var WG;function Tfe(){if(WG)return $O;WG=1;var e=og();function t(h,d){return h===d&&(h!==0||1/h===1/d)||h!==h&&d!==d}var i=typeof Object.is=="function"?Object.is:t,n=e.useState,r=e.useEffect,s=e.useLayoutEffect,a=e.useDebugValue;function o(h,d){var p=d(),g=n({inst:{value:p,getSnapshot:d}}),x=g[0].inst,y=g[1];return s(function(){x.value=p,x.getSnapshot=d,l(x)&&y({inst:x})},[h,p,d]),r(function(){return l(x)&&y({inst:x}),h(function(){l(x)&&y({inst:x})})},[h]),a(p),p}function l(h){var d=h.getSnapshot;h=h.value;try{var p=d();return!i(h,p)}catch{return!0}}function c(h,d){return d()}var u=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?c:o;return $O.useSyncExternalStore=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:u,$O}var XG;function Cfe(){return XG||(XG=1,ZO.exports=Tfe()),ZO.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qG;function Dfe(){if(qG)return JO;qG=1;var e=og(),t=Cfe();function i(c,u){return c===u&&(c!==0||1/c===1/u)||c!==c&&u!==u}var n=typeof Object.is=="function"?Object.is:i,r=t.useSyncExternalStore,s=e.useRef,a=e.useEffect,o=e.useMemo,l=e.useDebugValue;return JO.useSyncExternalStoreWithSelector=function(c,u,h,d,p){var g=s(null);if(g.current===null){var x={hasValue:!1,value:null};g.current=x}else x=g.current;g=o(function(){function b(T){if(!A){if(A=!0,w=T,T=d(T),p!==void 0&&x.hasValue){var I=x.value;if(p(I,T))return E=I}return E=T}if(I=E,n(w,T))return I;var R=d(T);return p!==void 0&&p(I,R)?(w=T,I):(w=T,E=R)}var A=!1,w,E,D=h===void 0?null:h;return[function(){return b(u())},D===null?void 0:function(){return b(D())}]},[u,h,d,p]);var y=r(c,g[0],g[1]);return a(function(){x.hasValue=!0,x.value=y},[y]),l(y),y},JO}var YG;function Rfe(){return YG||(YG=1,KO.exports=Dfe()),KO.exports}var Pfe=Rfe();const Ofe=Uw(Pfe),QG=e=>{let t;const i=new Set,n=(c,u)=>{const h=typeof c=="function"?c(t):c;if(!Object.is(h,t)){const d=t;t=u??(typeof h!="object"||h===null)?h:Object.assign({},t,h),i.forEach(p=>p(t,d))}},r=()=>t,o={setState:n,getState:r,getInitialState:()=>l,subscribe:c=>(i.add(c),()=>i.delete(c))},l=t=e(n,r,o);return o},wQ=e=>e?QG(e):QG,{useSyncExternalStoreWithSelector:Bfe}=Ofe,Ife=e=>e;function Lfe(e,t=Ife,i){const n=Bfe(e.subscribe,e.getState,e.getInitialState,t,i);return JC.useDebugValue(n),n}const KG=(e,t)=>{const i=wQ(e),n=(r,s=t)=>Lfe(i,r,s);return Object.assign(n,i),n},Ufe=(e,t)=>e?KG(e,t):KG;var eB={exports:{}},tB={exports:{}},iB={exports:{}},nB={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var JG;function Nfe(){return JG||(JG=1,function(e){function t(F,X){var W=F.length;F.push(X);e:for(;0<W;){var ne=W-1>>>1,Y=F[ne];if(0<r(Y,X))F[ne]=X,F[W]=Y,W=ne;else break e}}function i(F){return F.length===0?null:F[0]}function n(F){if(F.length===0)return null;var X=F[0],W=F.pop();if(W!==X){F[0]=W;e:for(var ne=0,Y=F.length,$=Y>>>1;ne<$;){var se=2*(ne+1)-1,fe=F[se],te=se+1,de=F[te];if(0>r(fe,W))te<Y&&0>r(de,fe)?(F[ne]=de,F[te]=W,ne=te):(F[ne]=fe,F[se]=W,ne=se);else if(te<Y&&0>r(de,W))F[ne]=de,F[te]=W,ne=te;else break e}}return X}function r(F,X){var W=F.sortIndex-X.sortIndex;return W!==0?W:F.id-X.id}if(e.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;e.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();e.unstable_now=function(){return a.now()-o}}var l=[],c=[],u=1,h=null,d=3,p=!1,g=!1,x=!1,y=typeof setTimeout=="function"?setTimeout:null,b=typeof clearTimeout=="function"?clearTimeout:null,A=typeof setImmediate<"u"?setImmediate:null;function w(F){for(var X=i(c);X!==null;){if(X.callback===null)n(c);else if(X.startTime<=F)n(c),X.sortIndex=X.expirationTime,t(l,X);else break;X=i(c)}}function E(F){if(x=!1,w(F),!g)if(i(l)!==null)g=!0,j();else{var X=i(c);X!==null&&J(E,X.startTime-F)}}var D=!1,T=-1,I=5,R=-1;function O(){return!(e.unstable_now()-R<I)}function P(){if(D){var F=e.unstable_now();R=F;var X=!0;try{e:{g=!1,x&&(x=!1,b(T),T=-1),p=!0;var W=d;try{t:{for(w(F),h=i(l);h!==null&&!(h.expirationTime>F&&O());){var ne=h.callback;if(typeof ne=="function"){h.callback=null,d=h.priorityLevel;var Y=ne(h.expirationTime<=F);if(F=e.unstable_now(),typeof Y=="function"){h.callback=Y,w(F),X=!0;break t}h===i(l)&&n(l),w(F)}else n(l);h=i(l)}if(h!==null)X=!0;else{var $=i(c);$!==null&&J(E,$.startTime-F),X=!1}}break e}finally{h=null,d=W,p=!1}X=void 0}}finally{X?U():D=!1}}}var U;if(typeof A=="function")U=function(){A(P)};else if(typeof MessageChannel<"u"){var H=new MessageChannel,V=H.port2;H.port1.onmessage=P,U=function(){V.postMessage(null)}}else U=function(){y(P,0)};function j(){D||(D=!0,U())}function J(F,X){T=y(function(){F(e.unstable_now())},X)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(F){F.callback=null},e.unstable_continueExecution=function(){g||p||(g=!0,j())},e.unstable_forceFrameRate=function(F){0>F||125<F?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<F?Math.floor(1e3/F):5},e.unstable_getCurrentPriorityLevel=function(){return d},e.unstable_getFirstCallbackNode=function(){return i(l)},e.unstable_next=function(F){switch(d){case 1:case 2:case 3:var X=3;break;default:X=d}var W=d;d=X;try{return F()}finally{d=W}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(F,X){switch(F){case 1:case 2:case 3:case 4:case 5:break;default:F=3}var W=d;d=F;try{return X()}finally{d=W}},e.unstable_scheduleCallback=function(F,X,W){var ne=e.unstable_now();switch(typeof W=="object"&&W!==null?(W=W.delay,W=typeof W=="number"&&0<W?ne+W:ne):W=ne,F){case 1:var Y=-1;break;case 2:Y=250;break;case 5:Y=1073741823;break;case 4:Y=1e4;break;default:Y=5e3}return Y=W+Y,F={id:u++,callback:X,priorityLevel:F,startTime:W,expirationTime:Y,sortIndex:-1},W>ne?(F.sortIndex=W,t(c,F),i(l)===null&&F===i(c)&&(x?(b(T),T=-1):x=!0,J(E,W-ne))):(F.sortIndex=Y,t(l,F),g||p||(g=!0,j())),F},e.unstable_shouldYield=O,e.unstable_wrapCallback=function(F){var X=d;return function(){var W=d;d=X;try{return F.apply(this,arguments)}finally{d=W}}}}(nB)),nB}var ZG;function zfe(){return ZG||(ZG=1,iB.exports=Nfe()),iB.exports}/**
 * @license React
 * react-reconciler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $G;function Ffe(){return $G||($G=1,function(e){e.exports=function(t){function i(v,S,C,L){return new xS(v,S,C,L)}function n(){}function r(v){var S="https://react.dev/errors/"+v;if(1<arguments.length){S+="?args[]="+encodeURIComponent(arguments[1]);for(var C=2;C<arguments.length;C++)S+="&args[]="+encodeURIComponent(arguments[C])}return"Minified React error #"+v+"; visit "+S+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(v){return v===null||typeof v!="object"?null:(v=pu&&v[pu]||v["@@iterator"],typeof v=="function"?v:null)}function a(v){if(v==null)return null;if(typeof v=="function")return v.$$typeof===AS?null:v.displayName||v.name||null;if(typeof v=="string")return v;switch(v){case Sh:return"Fragment";case ll:return"Portal";case _y:return"Profiler";case Wg:return"StrictMode";case Ay:return"Suspense";case Rp:return"SuspenseList"}if(typeof v=="object")switch(v.$$typeof){case Ul:return(v.displayName||"Context")+".Provider";case SS:return(v._context.displayName||"Context")+".Consumer";case qg:var S=v.render;return v=v.displayName,v||(v=S.displayName||S.name||"",v=v!==""?"ForwardRef("+v+")":"ForwardRef"),v;case wy:return S=v.displayName||null,S!==null?S:a(v.type)||"Memo";case cl:S=v._payload,v=v._init;try{return a(v(S))}catch{}}return null}function o(v){if(uc===void 0)try{throw Error()}catch(C){var S=C.stack.trim().match(/\n( *(at )?)/);uc=S&&S[1]||"",mu=-1<C.stack.indexOf(`
    at`)?" (<anonymous>)":-1<C.stack.indexOf("@")?"@unknown:0:0":""}return`
`+uc+v+mu}function l(v,S){if(!v||Ud)return"";Ud=!0;var C=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var L={DetermineComponentFrameRoot:function(){try{if(S){var Wt=function(){throw Error()};if(Object.defineProperty(Wt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Wt,[])}catch(Vi){var Yt=Vi}Reflect.construct(v,[],Wt)}else{try{Wt.call()}catch(Vi){Yt=Vi}v.call(Wt.prototype)}}else{try{throw Error()}catch(Vi){Yt=Vi}(Wt=v())&&typeof Wt.catch=="function"&&Wt.catch(function(){})}}catch(Vi){if(Vi&&Yt&&typeof Vi.stack=="string")return[Vi.stack,Yt.stack]}return[null,null]}};L.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var z=Object.getOwnPropertyDescriptor(L.DetermineComponentFrameRoot,"name");z&&z.configurable&&Object.defineProperty(L.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var q=L.DetermineComponentFrameRoot(),he=q[0],Te=q[1];if(he&&Te){var Je=he.split(`
`),Et=Te.split(`
`);for(z=L=0;L<Je.length&&!Je[L].includes("DetermineComponentFrameRoot");)L++;for(;z<Et.length&&!Et[z].includes("DetermineComponentFrameRoot");)z++;if(L===Je.length||z===Et.length)for(L=Je.length-1,z=Et.length-1;1<=L&&0<=z&&Je[L]!==Et[z];)z--;for(;1<=L&&0<=z;L--,z--)if(Je[L]!==Et[z]){if(L!==1||z!==1)do if(L--,z--,0>z||Je[L]!==Et[z]){var Ut=`
`+Je[L].replace(" at new "," at ");return v.displayName&&Ut.includes("<anonymous>")&&(Ut=Ut.replace("<anonymous>",v.displayName)),Ut}while(1<=L&&0<=z);break}}}finally{Ud=!1,Error.prepareStackTrace=C}return(C=v?v.displayName||v.name:"")?o(C):""}function c(v){switch(v.tag){case 26:case 27:case 5:return o(v.type);case 16:return o("Lazy");case 13:return o("Suspense");case 19:return o("SuspenseList");case 0:case 15:return v=l(v.type,!1),v;case 11:return v=l(v.type.render,!1),v;case 1:return v=l(v.type,!0),v;default:return""}}function u(v){try{var S="";do S+=c(v),v=v.return;while(v);return S}catch(C){return`
Error generating stack: `+C.message+`
`+C.stack}}function h(v){var S=v,C=v;if(v.alternate)for(;S.return;)S=S.return;else{v=S;do S=v,(S.flags&4098)!==0&&(C=S.return),v=S.return;while(v)}return S.tag===3?C:null}function d(v){if(h(v)!==v)throw Error(r(188))}function p(v){var S=v.alternate;if(!S){if(S=h(v),S===null)throw Error(r(188));return S!==v?null:v}for(var C=v,L=S;;){var z=C.return;if(z===null)break;var q=z.alternate;if(q===null){if(L=z.return,L!==null){C=L;continue}break}if(z.child===q.child){for(q=z.child;q;){if(q===C)return d(z),v;if(q===L)return d(z),S;q=q.sibling}throw Error(r(188))}if(C.return!==L.return)C=z,L=q;else{for(var he=!1,Te=z.child;Te;){if(Te===C){he=!0,C=z,L=q;break}if(Te===L){he=!0,L=z,C=q;break}Te=Te.sibling}if(!he){for(Te=q.child;Te;){if(Te===C){he=!0,C=q,L=z;break}if(Te===L){he=!0,L=q,C=z;break}Te=Te.sibling}if(!he)throw Error(r(189))}}if(C.alternate!==L)throw Error(r(190))}if(C.tag!==3)throw Error(r(188));return C.stateNode.current===C?v:S}function g(v){var S=v.tag;if(S===5||S===26||S===27||S===6)return v;for(v=v.child;v!==null;){if(S=g(v),S!==null)return S;v=v.sibling}return null}function x(v){var S=v.tag;if(S===5||S===26||S===27||S===6)return v;for(v=v.child;v!==null;){if(v.tag!==4&&(S=x(v),S!==null))return S;v=v.sibling}return null}function y(v){return{current:v}}function b(v){0>xu||(v.current=Ir[xu],Ir[xu]=null,xu--)}function A(v,S){xu++,Ir[xu]=v.current,v.current=S}function w(v){return v>>>=0,v===0?32:31-(TE(v)/CE|0)|0}function E(v){var S=v&42;if(S!==0)return S;switch(v&-v){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return v&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return v&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return v}}function D(v,S){var C=v.pendingLanes;if(C===0)return 0;var L=0,z=v.suspendedLanes,q=v.pingedLanes,he=v.warmLanes;v=v.finishedLanes!==0;var Te=C&134217727;return Te!==0?(C=Te&~z,C!==0?L=E(C):(q&=Te,q!==0?L=E(q):v||(he=Te&~he,he!==0&&(L=E(he))))):(Te=C&~z,Te!==0?L=E(Te):q!==0?L=E(q):v||(he=C&~he,he!==0&&(L=E(he)))),L===0?0:S!==0&&S!==L&&(S&z)===0&&(z=L&-L,he=S&-S,z>=he||z===32&&(he&4194176)!==0)?S:L}function T(v,S){return(v.pendingLanes&~(v.suspendedLanes&~v.pingedLanes)&S)===0}function I(v,S){switch(v){case 1:case 2:case 4:case 8:return S+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return S+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function R(){var v=dc;return dc<<=1,(dc&4194176)===0&&(dc=128),v}function O(){var v=Fd;return Fd<<=1,(Fd&62914560)===0&&(Fd=4194304),v}function P(v){for(var S=[],C=0;31>C;C++)S.push(v);return S}function U(v,S){v.pendingLanes|=S,S!==268435456&&(v.suspendedLanes=0,v.pingedLanes=0,v.warmLanes=0)}function H(v,S,C,L,z,q){var he=v.pendingLanes;v.pendingLanes=C,v.suspendedLanes=0,v.pingedLanes=0,v.warmLanes=0,v.expiredLanes&=C,v.entangledLanes&=C,v.errorRecoveryDisabledLanes&=C,v.shellSuspendCounter=0;var Te=v.entanglements,Je=v.expirationTimes,Et=v.hiddenUpdates;for(C=he&~C;0<C;){var Ut=31-Pa(C),Wt=1<<Ut;Te[Ut]=0,Je[Ut]=-1;var Yt=Et[Ut];if(Yt!==null)for(Et[Ut]=null,Ut=0;Ut<Yt.length;Ut++){var Vi=Yt[Ut];Vi!==null&&(Vi.lane&=-536870913)}C&=~Wt}L!==0&&V(v,L,0),q!==0&&z===0&&v.tag!==0&&(v.suspendedLanes|=q&~(he&~S))}function V(v,S,C){v.pendingLanes|=S,v.suspendedLanes&=~S;var L=31-Pa(S);v.entangledLanes|=S,v.entanglements[L]=v.entanglements[L]|1073741824|C&4194218}function j(v,S){var C=v.entangledLanes|=S;for(v=v.entanglements;C;){var L=31-Pa(C),z=1<<L;z&S|v[L]&S&&(v[L]|=S),C&=~z}}function J(v){return v&=-v,2<v?8<v?(v&134217727)!==0?32:268435456:8:2}function F(v){if(no&&typeof no.onCommitFiberRoot=="function")try{no.onCommitFiberRoot(Lr,v,void 0,(v.current.flags&128)===128)}catch{}}function X(v){if(typeof PE=="function"&&bs(v),no&&typeof no.setStrictMode=="function")try{no.setStrictMode(Lr,v)}catch{}}function W(v,S){return v===S&&(v!==0||1/v===1/S)||v!==v&&S!==S}function ne(v,S){if(typeof v=="object"&&v!==null){var C=GS.get(v);return C!==void 0?C:(S={value:v,source:S,stack:u(S)},GS.set(v,S),S)}return{value:v,source:S,stack:u(S)}}function Y(v,S){Vd[Hd++]=Fp,Vd[Hd++]=Gd,Gd=v,Fp=S}function $(v,S,C){Co[Do++]=Fl,Co[Do++]=Vl,Co[Do++]=Ch,Ch=v;var L=Fl;v=Vl;var z=32-Pa(L)-1;L&=~(1<<z),C+=1;var q=32-Pa(S)+z;if(30<q){var he=z-z%5;q=(L&(1<<he)-1).toString(32),L>>=he,z-=he,Fl=1<<32-Pa(S)+z|C<<z|L,Vl=q+v}else Fl=1<<q|C<<z|L,Vl=v}function se(v){v.return!==null&&(Y(v,1),$(v,1,0))}function fe(v){for(;v===Gd;)Gd=Vd[--Hd],Vd[Hd]=null,Fp=Vd[--Hd],Vd[Hd]=null;for(;v===Ch;)Ch=Co[--Do],Co[Do]=null,Vl=Co[--Do],Co[Do]=null,Fl=Co[--Do],Co[Do]=null}function te(v,S){A(fc,S),A(Vp,v),A(ns,null),v=XM(S),b(ns),A(ns,v)}function de(){b(ns),b(Vp),b(fc)}function le(v){v.memoizedState!==null&&A(kd,v);var S=ns.current,C=Ip(S,v.type);S!==C&&(A(Vp,v),A(ns,C))}function _e(v){Vp.current===v&&(b(ns),b(Vp)),kd.current===v&&(b(kd),Da?Nl._currentValue=Ah:Nl._currentValue2=Ah)}function be(v){var S=Error(r(418,""));throw We(ne(S,v)),iv}function we(v,S){if(!Fs)throw Error(r(175));vE(v.stateNode,v.type,v.memoizedProps,S,v)||be(v)}function Me(v){for(Vs=v.return;Vs;)switch(Vs.tag){case 3:case 27:Ss=!0;return;case 5:case 13:Ss=!1;return;default:Vs=Vs.return}}function Ne(v){if(!Fs||v!==Vs)return!1;if(!pn)return Me(v),pn=!0,!1;var S=!1;if(Xn?v.tag!==3&&v.tag!==27&&(v.tag!==5||By(v.type)&&!Wi(v.type,v.memoizedProps))&&(S=!0):v.tag!==3&&(v.tag!==5||By(v.type)&&!Wi(v.type,v.memoizedProps))&&(S=!0),S&&Hs&&be(v),Me(v),v.tag===13){if(!Fs)throw Error(r(316));if(v=v.memoizedState,v=v!==null?v.dehydrated:null,!v)throw Error(r(317));Hs=xE(v)}else Hs=Vs?zS(v.stateNode):null;return!0}function Ge(){Fs&&(Hs=Vs=null,pn=!1)}function We(v){dl===null?dl=[v]:dl.push(v)}function ae(){for(var v=jd,S=Hl=jd=0;S<v;){var C=fl[S];fl[S++]=null;var L=fl[S];fl[S++]=null;var z=fl[S];fl[S++]=null;var q=fl[S];if(fl[S++]=null,L!==null&&z!==null){var he=L.pending;he===null?z.next=z:(z.next=he.next,he.next=z),L.pending=z}q!==0&&Oe(C,z,q)}}function He(v,S,C,L){fl[jd++]=v,fl[jd++]=S,fl[jd++]=C,fl[jd++]=L,Hl|=L,v.lanes|=L,v=v.alternate,v!==null&&(v.lanes|=L)}function Ke(v,S,C,L){return He(v,S,C,L),Qe(v)}function je(v,S){return He(v,null,null,S),Qe(v)}function Oe(v,S,C){v.lanes|=C;var L=v.alternate;L!==null&&(L.lanes|=C);for(var z=!1,q=v.return;q!==null;)q.childLanes|=C,L=q.alternate,L!==null&&(L.childLanes|=C),q.tag===22&&(v=q.stateNode,v===null||v._visibility&1||(z=!0)),v=q,q=q.return;z&&S!==null&&v.tag===3&&(q=v.stateNode,z=31-Pa(C),q=q.hiddenUpdates,v=q[z],v===null?q[z]=[S]:v.push(S),S.lane=C|536870912)}function Qe(v){if(50<Qp)throw Qp=0,Yy=null,Error(r(185));for(var S=v.return;S!==null;)v=S,S=v.return;return v.tag===3?v.stateNode:null}function $e(v){v!==bu&&v.next===null&&(bu===null?nv=bu=v:bu=bu.next=v),ir=!0,Wd||(Wd=!0,K(pe))}function gt(v,S){if(!kS&&ir){kS=!0;do for(var C=!1,L=nv;L!==null;){if(v!==0){var z=L.pendingLanes;if(z===0)var q=0;else{var he=L.suspendedLanes,Te=L.pingedLanes;q=(1<<31-Pa(42|v)+1)-1,q&=z&~(he&~Te),q=q&201326677?q&201326677|1:q?q|2:0}q!==0&&(C=!0,xe(L,q))}else q=on,q=D(L,L===In?q:0),(q&3)===0||T(L,q)||(C=!0,xe(L,q));L=L.next}while(C);kS=!1}}function pe(){ir=Wd=!1;var v=0;Hp!==0&&(KM()&&(v=Hp),Hp=0);for(var S=hl(),C=null,L=nv;L!==null;){var z=L.next,q=k(L,S);q===0?(L.next=null,C===null?nv=z:C.next=z,z===null&&(bu=C)):(C=L,(v!==0||(q&3)!==0)&&(ir=!0)),L=z}gt(v)}function k(v,S){for(var C=v.suspendedLanes,L=v.pingedLanes,z=v.expirationTimes,q=v.pendingLanes&-62914561;0<q;){var he=31-Pa(q),Te=1<<he,Je=z[he];Je===-1?((Te&C)===0||(Te&L)!==0)&&(z[he]=I(Te,S)):Je<=S&&(v.expiredLanes|=Te),q&=~Te}if(S=In,C=on,C=D(v,v===S?C:0),L=v.callbackNode,C===0||v===S&&Hn===2||v.cancelPendingCommit!==null)return L!==null&&L!==null&&Ny(L),v.callbackNode=null,v.callbackPriority=0;if((C&3)===0||T(v,C)){if(S=C&-C,S===v.callbackPriority)return S;switch(L!==null&&Ny(L),J(C)){case 2:case 8:C=RE;break;case 32:C=Vy;break;case 268435456:C=TP;break;default:C=Vy}return L=Q.bind(null,v),C=tv(C,L),v.callbackPriority=S,v.callbackNode=C,S}return L!==null&&L!==null&&Ny(L),v.callbackPriority=2,v.callbackNode=null,2}function Q(v,S){var C=v.callbackNode;if(Ll()&&v.callbackNode!==C)return null;var L=on;return L=D(v,v===In?L:0),L===0?null:(gh(v,L,S),k(v,hl()),v.callbackNode!=null&&v.callbackNode===C?Q.bind(null,v):null)}function xe(v,S){if(Ll())return null;gh(v,S,!0)}function K(v){CS?yu(function(){(xn&6)!==0?tv(Fy,v):v()}):tv(Fy,v)}function Re(){return Hp===0&&(Hp=R()),Hp}function Le(v,S){if(Gp===null){var C=Gp=[];Xd=0,Ro=Re(),qd={status:"pending",value:void 0,then:function(L){C.push(L)}}}return Xd++,S.then(st,st),S}function st(){if(--Xd===0&&Gp!==null){qd!==null&&(qd.status="fulfilled");var v=Gp;Gp=null,Ro=0,qd=null;for(var S=0;S<v.length;S++)(0,v[S])()}}function Be(v,S){var C=[],L={status:"pending",value:null,reason:null,then:function(z){C.push(z)}};return v.then(function(){L.status="fulfilled",L.value=S;for(var z=0;z<C.length;z++)(0,C[z])(S)},function(z){for(L.status="rejected",L.reason=z,z=0;z<C.length;z++)(0,C[z])(void 0)}),L}function bt(v){v.updateQueue={baseState:v.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function vt(v,S){v=v.updateQueue,S.updateQueue===v&&(S.updateQueue={baseState:v.baseState,firstBaseUpdate:v.firstBaseUpdate,lastBaseUpdate:v.lastBaseUpdate,shared:v.shared,callbacks:null})}function Xe(v){return{lane:v,tag:0,payload:null,callback:null,next:null}}function xt(v,S,C){var L=v.updateQueue;if(L===null)return null;if(L=L.shared,(xn&2)!==0){var z=L.pending;return z===null?S.next=S:(S.next=z.next,z.next=S),L.pending=S,S=Qe(v),Oe(v,null,C),S}return He(v,L,S,C),Qe(v)}function _t(v,S,C){if(S=S.updateQueue,S!==null&&(S=S.shared,(C&4194176)!==0)){var L=S.lanes;L&=v.pendingLanes,C|=L,S.lanes=C,j(v,C)}}function ye(v,S){var C=v.updateQueue,L=v.alternate;if(L!==null&&(L=L.updateQueue,C===L)){var z=null,q=null;if(C=C.firstBaseUpdate,C!==null){do{var he={lane:C.lane,tag:C.tag,payload:C.payload,callback:null,next:null};q===null?z=q=he:q=q.next=he,C=C.next}while(C!==null);q===null?z=q=S:q=q.next=S}else z=q=S;C={baseState:L.baseState,firstBaseUpdate:z,lastBaseUpdate:q,shared:L.shared,callbacks:L.callbacks},v.updateQueue=C;return}v=C.lastBaseUpdate,v===null?C.firstBaseUpdate=S:v.next=S,C.lastBaseUpdate=S}function Ve(){if(Yd){var v=qd;if(v!==null)throw v}}function At(v,S,C,L){Yd=!1;var z=v.updateQueue;Su=!1;var q=z.firstBaseUpdate,he=z.lastBaseUpdate,Te=z.shared.pending;if(Te!==null){z.shared.pending=null;var Je=Te,Et=Je.next;Je.next=null,he===null?q=Et:he.next=Et,he=Je;var Ut=v.alternate;Ut!==null&&(Ut=Ut.updateQueue,Te=Ut.lastBaseUpdate,Te!==he&&(Te===null?Ut.firstBaseUpdate=Et:Te.next=Et,Ut.lastBaseUpdate=Je))}if(q!==null){var Wt=z.baseState;he=0,Ut=Et=Je=null,Te=q;do{var Yt=Te.lane&-536870913,Vi=Yt!==Te.lane;if(Vi?(on&Yt)===Yt:(L&Yt)===Yt){Yt!==0&&Yt===Ro&&(Yd=!0),Ut!==null&&(Ut=Ut.next={lane:0,tag:Te.tag,payload:Te.payload,callback:null,next:null});e:{var zo=v,Nh=Te;Yt=S;var zh=C;switch(Nh.tag){case 1:if(zo=Nh.payload,typeof zo=="function"){Wt=zo.call(zh,Wt,Yt);break e}Wt=zo;break e;case 3:zo.flags=zo.flags&-65537|128;case 0:if(zo=Nh.payload,Yt=typeof zo=="function"?zo.call(zh,Wt,Yt):zo,Yt==null)break e;Wt=Sy({},Wt,Yt);break e;case 2:Su=!0}}Yt=Te.callback,Yt!==null&&(v.flags|=64,Vi&&(v.flags|=8192),Vi=z.callbacks,Vi===null?z.callbacks=[Yt]:Vi.push(Yt))}else Vi={lane:Yt,tag:Te.tag,payload:Te.payload,callback:Te.callback,next:null},Ut===null?(Et=Ut=Vi,Je=Wt):Ut=Ut.next=Vi,he|=Yt;if(Te=Te.next,Te===null){if(Te=z.shared.pending,Te===null)break;Vi=Te,Te=Vi.next,Vi.next=null,z.lastBaseUpdate=Vi,z.shared.pending=null}}while(!0);Ut===null&&(Je=Wt),z.baseState=Je,z.firstBaseUpdate=Et,z.lastBaseUpdate=Ut,q===null&&(z.shared.lanes=0),Uo|=he,v.lanes=he,v.memoizedState=Wt}}function ie(v,S){if(typeof v!="function")throw Error(r(191,v));v.call(S)}function Ce(v,S){var C=v.callbacks;if(C!==null)for(v.callbacks=null,v=0;v<C.length;v++)ie(C[v],S)}function De(v,S){if(ro(v,S))return!0;if(typeof v!="object"||v===null||typeof S!="object"||S===null)return!1;var C=Object.keys(v),L=Object.keys(S);if(C.length!==L.length)return!1;for(L=0;L<C.length;L++){var z=C[L];if(!pc.call(S,z)||!ro(v[z],S[z]))return!1}return!0}function at(v){return v=v.status,v==="fulfilled"||v==="rejected"}function ut(){}function lt(v,S,C){switch(C=v[C],C===void 0?v.push(S):C!==S&&(S.then(ut,ut),S=C),S.status){case"fulfilled":return S.value;case"rejected":throw v=S.reason,v===kp?Error(r(483)):v;default:if(typeof S.status=="string")S.then(ut,ut);else{if(v=In,v!==null&&100<v.shellSuspendCounter)throw Error(r(482));v=S,v.status="pending",v.then(function(L){if(S.status==="pending"){var z=S;z.status="fulfilled",z.value=L}},function(L){if(S.status==="pending"){var z=S;z.status="rejected",z.reason=L}})}switch(S.status){case"fulfilled":return S.value;case"rejected":throw v=S.reason,v===kp?Error(r(483)):v}throw Dh=S,kp}}function It(){if(Dh===null)throw Error(r(459));var v=Dh;return Dh=null,v}function Vt(v){var S=Ph;return Ph+=1,Rh===null&&(Rh=[]),lt(Rh,v,S)}function _i(v,S){S=S.props.ref,v.ref=S!==void 0?S:null}function Jt(v,S){throw S.$$typeof===bP?Error(r(525)):(v=Object.prototype.toString.call(S),Error(r(31,v==="[object Object]"?"object with keys {"+Object.keys(S).join(", ")+"}":v)))}function An(v){var S=v._init;return S(v._payload)}function $i(v){function S(ct,ze){if(v){var pt=ct.deletions;pt===null?(ct.deletions=[ze],ct.flags|=16):pt.push(ze)}}function C(ct,ze){if(!v)return null;for(;ze!==null;)S(ct,ze),ze=ze.sibling;return null}function L(ct){for(var ze=new Map;ct!==null;)ct.key!==null?ze.set(ct.key,ct):ze.set(ct.index,ct),ct=ct.sibling;return ze}function z(ct,ze){return ct=ol(ct,ze),ct.index=0,ct.sibling=null,ct}function q(ct,ze,pt){return ct.index=pt,v?(pt=ct.alternate,pt!==null?(pt=pt.index,pt<ze?(ct.flags|=33554434,ze):pt):(ct.flags|=33554434,ze)):(ct.flags|=1048576,ze)}function he(ct){return v&&ct.alternate===null&&(ct.flags|=33554434),ct}function Te(ct,ze,pt,Lt){return ze===null||ze.tag!==6?(ze=xy(pt,ct.mode,Lt),ze.return=ct,ze):(ze=z(ze,pt),ze.return=ct,ze)}function Je(ct,ze,pt,Lt){var ci=pt.type;return ci===Sh?Ut(ct,ze,pt.props.children,Lt,pt.key):ze!==null&&(ze.elementType===ci||typeof ci=="object"&&ci!==null&&ci.$$typeof===cl&&An(ci)===ze.type)?(ze=z(ze,pt.props),_i(ze,pt),ze.return=ct,ze):(ze=cc(pt.type,pt.key,pt.props,null,ct.mode,Lt),_i(ze,pt),ze.return=ct,ze)}function Et(ct,ze,pt,Lt){return ze===null||ze.tag!==4||ze.stateNode.containerInfo!==pt.containerInfo||ze.stateNode.implementation!==pt.implementation?(ze=bS(pt,ct.mode,Lt),ze.return=ct,ze):(ze=z(ze,pt.children||[]),ze.return=ct,ze)}function Ut(ct,ze,pt,Lt,ci){return ze===null||ze.tag!==7?(ze=wr(pt,ct.mode,Lt,ci),ze.return=ct,ze):(ze=z(ze,pt),ze.return=ct,ze)}function Wt(ct,ze,pt){if(typeof ze=="string"&&ze!==""||typeof ze=="number"||typeof ze=="bigint")return ze=xy(""+ze,ct.mode,pt),ze.return=ct,ze;if(typeof ze=="object"&&ze!==null){switch(ze.$$typeof){case jg:return pt=cc(ze.type,ze.key,ze.props,null,ct.mode,pt),_i(pt,ze),pt.return=ct,pt;case ll:return ze=bS(ze,ct.mode,pt),ze.return=ct,ze;case cl:var Lt=ze._init;return ze=Lt(ze._payload),Wt(ct,ze,pt)}if(Pp(ze)||s(ze))return ze=wr(ze,ct.mode,pt,null),ze.return=ct,ze;if(typeof ze.then=="function")return Wt(ct,Vt(ze),pt);if(ze.$$typeof===Ul)return Wt(ct,Dg(ct,ze),pt);Jt(ct,ze)}return null}function Yt(ct,ze,pt,Lt){var ci=ze!==null?ze.key:null;if(typeof pt=="string"&&pt!==""||typeof pt=="number"||typeof pt=="bigint")return ci!==null?null:Te(ct,ze,""+pt,Lt);if(typeof pt=="object"&&pt!==null){switch(pt.$$typeof){case jg:return pt.key===ci?Je(ct,ze,pt,Lt):null;case ll:return pt.key===ci?Et(ct,ze,pt,Lt):null;case cl:return ci=pt._init,pt=ci(pt._payload),Yt(ct,ze,pt,Lt)}if(Pp(pt)||s(pt))return ci!==null?null:Ut(ct,ze,pt,Lt,null);if(typeof pt.then=="function")return Yt(ct,ze,Vt(pt),Lt);if(pt.$$typeof===Ul)return Yt(ct,ze,Dg(ct,pt),Lt);Jt(ct,pt)}return null}function Vi(ct,ze,pt,Lt,ci){if(typeof Lt=="string"&&Lt!==""||typeof Lt=="number"||typeof Lt=="bigint")return ct=ct.get(pt)||null,Te(ze,ct,""+Lt,ci);if(typeof Lt=="object"&&Lt!==null){switch(Lt.$$typeof){case jg:return ct=ct.get(Lt.key===null?pt:Lt.key)||null,Je(ze,ct,Lt,ci);case ll:return ct=ct.get(Lt.key===null?pt:Lt.key)||null,Et(ze,ct,Lt,ci);case cl:var hr=Lt._init;return Lt=hr(Lt._payload),Vi(ct,ze,pt,Lt,ci)}if(Pp(Lt)||s(Lt))return ct=ct.get(pt)||null,Ut(ze,ct,Lt,ci,null);if(typeof Lt.then=="function")return Vi(ct,ze,pt,Vt(Lt),ci);if(Lt.$$typeof===Ul)return Vi(ct,ze,pt,Dg(ze,Lt),ci);Jt(ze,Lt)}return null}function zo(ct,ze,pt,Lt){for(var ci=null,hr=null,Ii=ze,Mn=ze=0,Ur=null;Ii!==null&&Mn<pt.length;Mn++){Ii.index>Mn?(Ur=Ii,Ii=null):Ur=Ii.sibling;var an=Yt(ct,Ii,pt[Mn],Lt);if(an===null){Ii===null&&(Ii=Ur);break}v&&Ii&&an.alternate===null&&S(ct,Ii),ze=q(an,ze,Mn),hr===null?ci=an:hr.sibling=an,hr=an,Ii=Ur}if(Mn===pt.length)return C(ct,Ii),pn&&Y(ct,Mn),ci;if(Ii===null){for(;Mn<pt.length;Mn++)Ii=Wt(ct,pt[Mn],Lt),Ii!==null&&(ze=q(Ii,ze,Mn),hr===null?ci=Ii:hr.sibling=Ii,hr=Ii);return pn&&Y(ct,Mn),ci}for(Ii=L(Ii);Mn<pt.length;Mn++)Ur=Vi(Ii,ct,Mn,pt[Mn],Lt),Ur!==null&&(v&&Ur.alternate!==null&&Ii.delete(Ur.key===null?Mn:Ur.key),ze=q(Ur,ze,Mn),hr===null?ci=Ur:hr.sibling=Ur,hr=Ur);return v&&Ii.forEach(function(_c){return S(ct,_c)}),pn&&Y(ct,Mn),ci}function Nh(ct,ze,pt,Lt){if(pt==null)throw Error(r(151));for(var ci=null,hr=null,Ii=ze,Mn=ze=0,Ur=null,an=pt.next();Ii!==null&&!an.done;Mn++,an=pt.next()){Ii.index>Mn?(Ur=Ii,Ii=null):Ur=Ii.sibling;var _c=Yt(ct,Ii,an.value,Lt);if(_c===null){Ii===null&&(Ii=Ur);break}v&&Ii&&_c.alternate===null&&S(ct,Ii),ze=q(_c,ze,Mn),hr===null?ci=_c:hr.sibling=_c,hr=_c,Ii=Ur}if(an.done)return C(ct,Ii),pn&&Y(ct,Mn),ci;if(Ii===null){for(;!an.done;Mn++,an=pt.next())an=Wt(ct,an.value,Lt),an!==null&&(ze=q(an,ze,Mn),hr===null?ci=an:hr.sibling=an,hr=an);return pn&&Y(ct,Mn),ci}for(Ii=L(Ii);!an.done;Mn++,an=pt.next())an=Vi(Ii,ct,Mn,an.value,Lt),an!==null&&(v&&an.alternate!==null&&Ii.delete(an.key===null?Mn:an.key),ze=q(an,ze,Mn),hr===null?ci=an:hr.sibling=an,hr=an);return v&&Ii.forEach(function(Qy){return S(ct,Qy)}),pn&&Y(ct,Mn),ci}function zh(ct,ze,pt,Lt){if(typeof pt=="object"&&pt!==null&&pt.type===Sh&&pt.key===null&&(pt=pt.props.children),typeof pt=="object"&&pt!==null){switch(pt.$$typeof){case jg:e:{for(var ci=pt.key;ze!==null;){if(ze.key===ci){if(ci=pt.type,ci===Sh){if(ze.tag===7){C(ct,ze.sibling),Lt=z(ze,pt.props.children),Lt.return=ct,ct=Lt;break e}}else if(ze.elementType===ci||typeof ci=="object"&&ci!==null&&ci.$$typeof===cl&&An(ci)===ze.type){C(ct,ze.sibling),Lt=z(ze,pt.props),_i(Lt,pt),Lt.return=ct,ct=Lt;break e}C(ct,ze);break}else S(ct,ze);ze=ze.sibling}pt.type===Sh?(Lt=wr(pt.props.children,ct.mode,Lt,pt.key),Lt.return=ct,ct=Lt):(Lt=cc(pt.type,pt.key,pt.props,null,ct.mode,Lt),_i(Lt,pt),Lt.return=ct,ct=Lt)}return he(ct);case ll:e:{for(ci=pt.key;ze!==null;){if(ze.key===ci)if(ze.tag===4&&ze.stateNode.containerInfo===pt.containerInfo&&ze.stateNode.implementation===pt.implementation){C(ct,ze.sibling),Lt=z(ze,pt.children||[]),Lt.return=ct,ct=Lt;break e}else{C(ct,ze);break}else S(ct,ze);ze=ze.sibling}Lt=bS(pt,ct.mode,Lt),Lt.return=ct,ct=Lt}return he(ct);case cl:return ci=pt._init,pt=ci(pt._payload),zh(ct,ze,pt,Lt)}if(Pp(pt))return zo(ct,ze,pt,Lt);if(s(pt)){if(ci=s(pt),typeof ci!="function")throw Error(r(150));return pt=ci.call(pt),Nh(ct,ze,pt,Lt)}if(typeof pt.then=="function")return zh(ct,ze,Vt(pt),Lt);if(pt.$$typeof===Ul)return zh(ct,ze,Dg(ct,pt),Lt);Jt(ct,pt)}return typeof pt=="string"&&pt!==""||typeof pt=="number"||typeof pt=="bigint"?(pt=""+pt,ze!==null&&ze.tag===6?(C(ct,ze.sibling),Lt=z(ze,pt),Lt.return=ct,ct=Lt):(C(ct,ze),Lt=xy(pt,ct.mode,Lt),Lt.return=ct,ct=Lt),he(ct)):C(ct,ze)}return function(ct,ze,pt,Lt){try{Ph=0;var ci=zh(ct,ze,pt,Lt);return Rh=null,ci}catch(Ii){if(Ii===kp)throw Ii;var hr=i(29,Ii,null,ct.mode);return hr.lanes=Lt,hr.return=ct,hr}finally{}}}function jn(v,S){v=aa,A(jp,v),A(nr,S),aa=v|S.baseLanes}function xr(){A(jp,aa),A(nr,nr.current)}function Gr(){aa=jp.current,b(nr),b(jp)}function kr(v){var S=v.alternate;A(rs,rs.current&1),A(Po,v),qn===null&&(S===null||nr.current!==null||S.memoizedState!==null)&&(qn=v)}function ve(v){if(v.tag===22){if(A(rs,rs.current),A(Po,v),qn===null){var S=v.alternate;S!==null&&S.memoizedState!==null&&(qn=v)}}else et()}function et(){A(rs,rs.current),A(Po,Po.current)}function ft(v){b(Po),qn===v&&(qn=null),b(rs)}function Ye(v){for(var S=v;S!==null;){if(S.tag===13){var C=S.memoizedState;if(C!==null&&(C=C.dehydrated,C===null||Ry(C)||Py(C)))return S}else if(S.tag===19&&S.memoizedProps.revealOrder!==void 0){if((S.flags&128)!==0)return S}else if(S.child!==null){S.child.return=S,S=S.child;continue}if(S===v)break;for(;S.sibling===null;){if(S.return===null||S.return===v)return null;S=S.return}S.sibling.return=S.return,S=S.sibling}return null}function ot(){throw Error(r(321))}function kt(v,S){if(S===null)return!1;for(var C=0;C<S.length&&C<v.length;C++)if(!ro(v[C],S[C]))return!1;return!0}function si(v,S,C,L,z,q){return _u=q,Ji=S,S.memoizedState=null,S.updateQueue=null,S.lanes=0,Bi.H=v===null||v.memoizedState===null?Ih:Oa,Bh=!1,q=C(L,z),Bh=!1,Qd&&(q=Zt(S,C,L,z)),oi(v),q}function oi(v){Bi.H=Mr;var S=bi!==null&&bi.next!==null;if(_u=0,yn=bi=Ji=null,pl=!1,Kd=0,_s=null,S)throw Error(r(300));v===null||Yn||(v=v.dependencies,v!==null&&Cg(v)&&(Yn=!0))}function Zt(v,S,C,L){Ji=v;var z=0;do{if(Qd&&(_s=null),Kd=0,Qd=!1,25<=z)throw Error(r(301));if(z+=1,yn=bi=null,v.updateQueue!=null){var q=v.updateQueue;q.lastEffect=null,q.events=null,q.stores=null,q.memoCache!=null&&(q.memoCache.index=0)}Bi.H=Oo,q=S(C,L)}while(Qd);return q}function fi(){var v=Bi.H,S=v.useState()[0];return S=typeof S.then=="function"?nt(S):S,v=v.useState()[0],(bi!==null?bi.memoizedState:null)!==v&&(Ji.flags|=1024),S}function Ri(){var v=Hy!==0;return Hy=0,v}function Pi(v,S,C){S.updateQueue=v.updateQueue,S.flags&=-2053,v.lanes&=~C}function li(v){if(pl){for(v=v.memoizedState;v!==null;){var S=v.queue;S!==null&&(S.pending=null),v=v.next}pl=!1}_u=0,yn=bi=Ji=null,Qd=!1,Kd=Hy=0,_s=null}function oe(){var v={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return yn===null?Ji.memoizedState=yn=v:yn=yn.next=v,yn}function Ue(){if(bi===null){var v=Ji.alternate;v=v!==null?v.memoizedState:null}else v=bi.next;var S=yn===null?Ji.memoizedState:yn.next;if(S!==null)yn=S,bi=v;else{if(v===null)throw Ji.alternate===null?Error(r(467)):Error(r(310));bi=v,v={memoizedState:bi.memoizedState,baseState:bi.baseState,baseQueue:bi.baseQueue,queue:bi.queue,next:null},yn===null?Ji.memoizedState=yn=v:yn=yn.next=v}return yn}function nt(v){var S=Kd;return Kd+=1,_s===null&&(_s=[]),v=lt(_s,v,S),S=Ji,(yn===null?S.memoizedState:yn.next)===null&&(S=S.alternate,Bi.H=S===null||S.memoizedState===null?Ih:Oa),v}function Ze(v){if(v!==null&&typeof v=="object"){if(typeof v.then=="function")return nt(v);if(v.$$typeof===Ul)return Ls(v)}throw Error(r(438,String(v)))}function Ie(v){var S=null,C=Ji.updateQueue;if(C!==null&&(S=C.memoCache),S==null){var L=Ji.alternate;L!==null&&(L=L.updateQueue,L!==null&&(L=L.memoCache,L!=null&&(S={data:L.data.map(function(z){return z.slice()}),index:0})))}if(S==null&&(S={data:[],index:0}),C===null&&(C=Gy(),Ji.updateQueue=C),C.memoCache=S,C=S.data[S.index],C===void 0)for(C=S.data[S.index]=Array(v),L=0;L<v;L++)C[L]=WM;return S.index++,C}function Rt(v,S){return typeof S=="function"?S(v):S}function wt(v){var S=Ue();return Nt(S,bi,v)}function Nt(v,S,C){var L=v.queue;if(L===null)throw Error(r(311));L.lastRenderedReducer=C;var z=v.baseQueue,q=L.pending;if(q!==null){if(z!==null){var he=z.next;z.next=q.next,q.next=he}S.baseQueue=z=q,L.pending=null}if(q=v.baseState,z===null)v.memoizedState=q;else{S=z.next;var Te=he=null,Je=null,Et=S,Ut=!1;do{var Wt=Et.lane&-536870913;if(Wt!==Et.lane?(on&Wt)===Wt:(_u&Wt)===Wt){var Yt=Et.revertLane;if(Yt===0)Je!==null&&(Je=Je.next={lane:0,revertLane:0,action:Et.action,hasEagerState:Et.hasEagerState,eagerState:Et.eagerState,next:null}),Wt===Ro&&(Ut=!0);else if((_u&Yt)===Yt){Et=Et.next,Yt===Ro&&(Ut=!0);continue}else Wt={lane:0,revertLane:Et.revertLane,action:Et.action,hasEagerState:Et.hasEagerState,eagerState:Et.eagerState,next:null},Je===null?(Te=Je=Wt,he=q):Je=Je.next=Wt,Ji.lanes|=Yt,Uo|=Yt;Wt=Et.action,Bh&&C(q,Wt),q=Et.hasEagerState?Et.eagerState:C(q,Wt)}else Yt={lane:Wt,revertLane:Et.revertLane,action:Et.action,hasEagerState:Et.hasEagerState,eagerState:Et.eagerState,next:null},Je===null?(Te=Je=Yt,he=q):Je=Je.next=Yt,Ji.lanes|=Wt,Uo|=Wt;Et=Et.next}while(Et!==null&&Et!==S);if(Je===null?he=q:Je.next=Te,!ro(q,v.memoizedState)&&(Yn=!0,Ut&&(C=qd,C!==null)))throw C;v.memoizedState=q,v.baseState=he,v.baseQueue=Je,L.lastRenderedState=q}return z===null&&(L.lanes=0),[v.memoizedState,L.dispatch]}function Ht(v){var S=Ue(),C=S.queue;if(C===null)throw Error(r(311));C.lastRenderedReducer=v;var L=C.dispatch,z=C.pending,q=S.memoizedState;if(z!==null){C.pending=null;var he=z=z.next;do q=v(q,he.action),he=he.next;while(he!==z);ro(q,S.memoizedState)||(Yn=!0),S.memoizedState=q,S.baseQueue===null&&(S.baseState=q),C.lastRenderedState=q}return[q,L]}function ai(v,S,C){var L=Ji,z=Ue(),q=pn;if(q){if(C===void 0)throw Error(r(407));C=C()}else C=S();var he=!ro((bi||z).memoizedState,C);if(he&&(z.memoizedState=C,Yn=!0),z=z.queue,Wb(re.bind(null,L,z,v),[v]),z.getSnapshot!==S||he||yn!==null&&yn.memoizedState.tag&1){if(L.flags|=2048,Ma(9,Z.bind(null,L,z,C,S),{destroy:void 0},null),In===null)throw Error(r(349));q||(_u&60)!==0||$t(L,S,C)}return C}function $t(v,S,C){v.flags|=16384,v={getSnapshot:S,value:C},S=Ji.updateQueue,S===null?(S=Gy(),Ji.updateQueue=S,S.stores=[v]):(C=S.stores,C===null?S.stores=[v]:C.push(v))}function Z(v,S,C,L){S.value=C,S.getSnapshot=L,Se(S)&&ue(v)}function re(v,S,C){return C(function(){Se(S)&&ue(v)})}function Se(v){var S=v.getSnapshot;v=v.value;try{var C=S();return!ro(v,C)}catch{return!0}}function ue(v){var S=je(v,2);S!==null&&xs(S,v,2)}function Pe(v){var S=oe();if(typeof v=="function"){var C=v;if(v=C(),Bh){X(!0);try{C()}finally{X(!1)}}}return S.memoizedState=S.baseState=v,S.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Rt,lastRenderedState:v},S}function yt(v,S,C,L){return v.baseState=C,Nt(v,bi,typeof L=="function"?L:Rt)}function ti(v,S,C,L,z){if(Ag(v))throw Error(r(485));if(v=S.action,v!==null){var q={payload:z,action:v,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(he){q.listeners.push(he)}};Bi.T!==null?C(!0):q.isTransition=!1,L(q),C=S.pending,C===null?(q.next=S.pending=q,Wn(S,q)):(q.next=C.next,S.pending=C.next=q)}}function Wn(v,S){var C=S.action,L=S.payload,z=v.state;if(S.isTransition){var q=Bi.T,he={};Bi.T=he;try{var Te=C(z,L),Je=Bi.S;Je!==null&&Je(he,Te),en(v,S,Te)}catch(Et){wa(v,S,Et)}finally{Bi.T=q}}else try{q=C(z,L),en(v,S,q)}catch(Et){wa(v,S,Et)}}function en(v,S,C){C!==null&&typeof C=="object"&&typeof C.then=="function"?C.then(function(L){Pr(v,S,L)},function(L){return wa(v,S,L)}):Pr(v,S,C)}function Pr(v,S,C){S.status="fulfilled",S.value=C,Dn(S),v.state=C,S=v.pending,S!==null&&(C=S.next,C===S?v.pending=null:(C=C.next,S.next=C,Wn(v,C)))}function wa(v,S,C){var L=v.pending;if(v.pending=null,L!==null){L=L.next;do S.status="rejected",S.reason=C,Dn(S),S=S.next;while(S!==L)}v.action=null}function Dn(v){v=v.listeners;for(var S=0;S<v.length;S++)(0,v[S])()}function rc(v,S){return S}function Vn(v,S){if(pn){var C=In.formState;if(C!==null){e:{var L=Ji;if(pn){if(Hs){var z=NS(Hs,Ss);if(z){Hs=zS(z),L=fE(z);break e}}be(L)}L=!1}L&&(S=C[0])}}C=oe(),C.memoizedState=C.baseState=S,L={pending:null,lanes:0,dispatch:null,lastRenderedReducer:rc,lastRenderedState:S},C.queue=L,C=Qb.bind(null,Ji,L),L.dispatch=C,L=Pe(!1);var q=fp.bind(null,Ji,!1,L.queue);return L=oe(),z={state:S,dispatch:null,action:v,pending:null},L.queue=z,C=ti.bind(null,Ji,z,q,C),z.dispatch=C,L.memoizedState=v,[S,C,!1]}function Bs(v){var S=Ue();return jr(S,bi,v)}function jr(v,S,C){S=Nt(v,S,rc)[0],v=wt(Rt)[0],S=typeof S=="object"&&S!==null&&typeof S.then=="function"?nt(S):S;var L=Ue(),z=L.queue,q=z.dispatch;return C!==L.memoizedState&&(Ji.flags|=2048,Ma(9,gs.bind(null,z,C),{destroy:void 0},null)),[S,q,v]}function gs(v,S){v.action=S}function vs(v){var S=Ue(),C=bi;if(C!==null)return jr(S,C,v);Ue(),S=S.memoizedState,C=Ue();var L=C.queue.dispatch;return C.memoizedState=v,[S,L,!1]}function Ma(v,S,C,L){return v={tag:v,create:S,inst:C,deps:L,next:null},S=Ji.updateQueue,S===null&&(S=Gy(),Ji.updateQueue=S),C=S.lastEffect,C===null?S.lastEffect=v.next=v:(L=C.next,C.next=v,v.next=L,S.lastEffect=v),v}function sc(){return Ue().memoizedState}function yg(v,S,C,L){var z=oe();Ji.flags|=v,z.memoizedState=Ma(1|S,C,{destroy:void 0},L===void 0?null:L)}function xg(v,S,C,L){var z=Ue();L=L===void 0?null:L;var q=z.memoizedState.inst;bi!==null&&L!==null&&kt(L,bi.memoizedState.deps)?z.memoizedState=Ma(S,C,q,L):(Ji.flags|=v,z.memoizedState=Ma(1|S,C,q,L))}function $0(v,S){yg(8390656,8,v,S)}function Wb(v,S){xg(2048,8,v,S)}function AM(v,S){return xg(4,2,v,S)}function bg(v,S){return xg(4,4,v,S)}function ey(v,S){if(typeof S=="function"){v=v();var C=S(v);return function(){typeof C=="function"?C():S(null)}}if(S!=null)return v=v(),S.current=v,function(){S.current=null}}function ty(v,S,C){C=C!=null?C.concat([v]):null,xg(4,4,ey.bind(null,S,v),C)}function ah(){}function Od(v,S){var C=Ue();S=S===void 0?null:S;var L=C.memoizedState;return S!==null&&kt(S,L[1])?L[0]:(C.memoizedState=[v,S],v)}function Xb(v,S){var C=Ue();S=S===void 0?null:S;var L=C.memoizedState;if(S!==null&&kt(S,L[1]))return L[0];if(L=v(),Bh){X(!0);try{v()}finally{X(!1)}}return C.memoizedState=[L,S],L}function Sg(v,S,C){return C===void 0||(_u&1073741824)!==0?v.memoizedState=S:(v.memoizedState=C,v=pS(),Ji.lanes|=v,Uo|=v,C)}function qb(v,S,C,L){return ro(C,S)?C:nr.current!==null?(v=Sg(v,C,L),ro(v,S)||(Yn=!0),v):(_u&42)===0?(Yn=!0,v.memoizedState=C):(v=pS(),Ji.lanes|=v,Uo|=v,S)}function hp(v,S,C,L,z){var q=vu();ra(q!==0&&8>q?q:8);var he=Bi.T,Te={};Bi.T=Te,fp(v,!1,S,C);try{var Je=z(),Et=Bi.S;if(Et!==null&&Et(Te,Je),Je!==null&&typeof Je=="object"&&typeof Je.then=="function"){var Ut=Be(Je,L);oh(v,S,Ut,Or(v))}else oh(v,S,L,Or(v))}catch(Wt){oh(v,S,{then:function(){},status:"rejected",reason:Wt},Or())}finally{ra(q),Bi.T=he}}function ac(v){var S=v.memoizedState;if(S!==null)return S;S={memoizedState:Ah,baseState:Ah,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Rt,lastRenderedState:Ah},next:null};var C={};return S.next={memoizedState:C,baseState:C,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Rt,lastRenderedState:C},next:null},v.memoizedState=S,v=v.alternate,v!==null&&(v.memoizedState=S),S}function _g(){return Ls(Nl)}function dp(){return Ue().memoizedState}function iu(){return Ue().memoizedState}function Yb(v){for(var S=v.return;S!==null;){switch(S.tag){case 24:case 3:var C=Or();v=Xe(C);var L=xt(S,v,C);L!==null&&(xs(L,S,C),_t(L,S,C)),S={cache:hh()},v.payload=S;return}S=S.return}}function iy(v,S,C){var L=Or();C={lane:L,revertLane:0,action:C,hasEagerState:!1,eagerState:null,next:null},Ag(v)?Ea(S,C):(C=Ke(v,S,C,L),C!==null&&(xs(C,v,L),lh(C,S,L)))}function Qb(v,S,C){var L=Or();oh(v,S,C,L)}function oh(v,S,C,L){var z={lane:L,revertLane:0,action:C,hasEagerState:!1,eagerState:null,next:null};if(Ag(v))Ea(S,z);else{var q=v.alternate;if(v.lanes===0&&(q===null||q.lanes===0)&&(q=S.lastRenderedReducer,q!==null))try{var he=S.lastRenderedState,Te=q(he,C);if(z.hasEagerState=!0,z.eagerState=Te,ro(Te,he))return He(v,S,z,0),In===null&&ae(),!1}catch{}finally{}if(C=Ke(v,S,z,L),C!==null)return xs(C,v,L),lh(C,S,L),!0}return!1}function fp(v,S,C,L){if(L={lane:2,revertLane:Re(),action:L,hasEagerState:!1,eagerState:null,next:null},Ag(v)){if(S)throw Error(r(479))}else S=Ke(v,C,L,2),S!==null&&xs(S,v,2)}function Ag(v){var S=v.alternate;return v===Ji||S!==null&&S===Ji}function Ea(v,S){Qd=pl=!0;var C=v.pending;C===null?S.next=S:(S.next=C.next,C.next=S),v.pending=S}function lh(v,S,C){if((C&4194176)!==0){var L=S.lanes;L&=v.pendingLanes,C|=L,S.lanes=C,j(v,C)}}function pp(v,S,C,L){S=v.memoizedState,C=C(L,S),C=C==null?S:Sy({},S,C),v.memoizedState=C,v.lanes===0&&(v.updateQueue.baseState=C)}function mp(v,S,C,L,z,q,he){return v=v.stateNode,typeof v.shouldComponentUpdate=="function"?v.shouldComponentUpdate(L,q,he):S.prototype&&S.prototype.isPureReactComponent?!De(C,L)||!De(z,q):!0}function wM(v,S,C,L){v=S.state,typeof S.componentWillReceiveProps=="function"&&S.componentWillReceiveProps(C,L),typeof S.UNSAFE_componentWillReceiveProps=="function"&&S.UNSAFE_componentWillReceiveProps(C,L),S.state!==v&&gc.enqueueReplaceState(S,S.state,null)}function nu(v,S){var C=S;if("ref"in S){C={};for(var L in S)L!=="ref"&&(C[L]=S[L])}if(v=v.defaultProps){C===S&&(C=Sy({},C));for(var z in v)C[z]===void 0&&(C[z]=v[z])}return C}function gp(v,S){try{var C=v.onUncaughtError;C(S.value,{componentStack:S.stack})}catch(L){setTimeout(function(){throw L})}}function vp(v,S,C){try{var L=v.onCaughtError;L(C.value,{componentStack:C.stack,errorBoundary:S.tag===1?S.stateNode:null})}catch(z){setTimeout(function(){throw z})}}function yp(v,S,C){return C=Xe(C),C.tag=3,C.payload={element:null},C.callback=function(){gp(v,S)},C}function Kb(v){return v=Xe(v),v.tag=3,v}function MM(v,S,C,L){var z=C.type.getDerivedStateFromError;if(typeof z=="function"){var q=L.value;v.payload=function(){return z(q)},v.callback=function(){vp(S,C,L)}}var he=C.stateNode;he!==null&&typeof he.componentDidCatch=="function"&&(v.callback=function(){vp(S,C,L),typeof z!="function"&&(Lh===null?Lh=new Set([this]):Lh.add(this));var Te=L.stack;this.componentDidCatch(L.value,{componentStack:Te!==null?Te:""})})}function gP(v,S,C,L,z){if(C.flags|=32768,L!==null&&typeof L=="object"&&typeof L.then=="function"){if(S=C.alternate,S!==null&&Tg(S,C,z,!0),C=Po.current,C!==null){switch(C.tag){case 13:return qn===null?hu():C.alternate===null&&Qn===0&&(Qn=3),C.flags&=-257,C.flags|=65536,C.lanes=z,L===sv?C.flags|=16384:(S=C.updateQueue,S===null?C.updateQueue=new Set([L]):S.add(L),Ld(v,L,z)),!1;case 22:return C.flags|=65536,L===sv?C.flags|=16384:(S=C.updateQueue,S===null?(S={transitions:null,markerInstances:null,retryQueue:new Set([L])},C.updateQueue=S):(C=S.retryQueue,C===null?S.retryQueue=new Set([L]):C.add(L)),Ld(v,L,z)),!1}throw Error(r(435,C.tag))}return Ld(v,L,z),hu(),!1}if(pn)return S=Po.current,S!==null?((S.flags&65536)===0&&(S.flags|=256),S.flags|=65536,S.lanes=z,L!==iv&&(v=Error(r(422),{cause:L}),We(ne(v,C)))):(L!==iv&&(S=Error(r(423),{cause:L}),We(ne(S,C))),v=v.current.alternate,v.flags|=65536,z&=-z,v.lanes|=z,L=ne(L,C),z=yp(v.stateNode,L,z),ye(v,z),Qn!==4&&(Qn=2)),!1;var q=Error(r(520),{cause:L});if(q=ne(q,C),Zd===null?Zd=[q]:Zd.push(q),Qn!==4&&(Qn=2),S===null)return!0;L=ne(L,C),C=S;do{switch(C.tag){case 3:return C.flags|=65536,v=z&-z,C.lanes|=v,v=yp(C.stateNode,L,v),ye(C,v),!1;case 1:if(S=C.type,q=C.stateNode,(C.flags&128)===0&&(typeof S.getDerivedStateFromError=="function"||q!==null&&typeof q.componentDidCatch=="function"&&(Lh===null||!Lh.has(q))))return C.flags|=65536,z&=-z,C.lanes|=z,z=Kb(z),MM(z,v,C,L),ye(C,z),!1}C=C.return}while(C!==null);return!1}function Is(v,S,C,L){S.child=v===null?mc(S,null,C,L):Oh(S,v.child,C,L)}function ny(v,S,C,L,z){C=C.render;var q=S.ref;if("ref"in L){var he={};for(var Te in L)Te!=="ref"&&(he[Te]=L[Te])}else he=L;return uh(S),L=si(v,S,C,he,q,z),Te=Ri(),v!==null&&!Yn?(Pi(v,S,z),ru(v,S,z)):(pn&&Te&&se(S),S.flags|=1,Is(v,S,L,z),S.child)}function EM(v,S,C,L,z){if(v===null){var q=C.type;return typeof q=="function"&&!Vg(q)&&q.defaultProps===void 0&&C.compare===null?(S.tag=15,S.type=q,TM(v,S,q,L,z)):(v=cc(C.type,null,L,S,S.mode,z),v.ref=S.ref,v.return=S,S.child=v)}if(q=v.child,!tS(v,z)){var he=q.memoizedProps;if(C=C.compare,C=C!==null?C:De,C(he,L)&&v.ref===S.ref)return ru(v,S,z)}return S.flags|=1,v=ol(q,L),v.ref=S.ref,v.return=S,S.child=v}function TM(v,S,C,L,z){if(v!==null){var q=v.memoizedProps;if(De(q,L)&&v.ref===S.ref)if(Yn=!1,S.pendingProps=L=q,tS(v,z))(v.flags&131072)!==0&&(Yn=!0);else return S.lanes=v.lanes,ru(v,S,z)}return ry(v,S,C,L,z)}function CM(v,S,C){var L=S.pendingProps,z=L.children,q=(S.stateNode._pendingVisibility&2)!==0,he=v!==null?v.memoizedState:null;if(wg(v,S),L.mode==="hidden"||q){if((S.flags&128)!==0){if(L=he!==null?he.baseLanes|C:C,v!==null){for(z=S.child=v.child,q=0;z!==null;)q=q|z.lanes|z.childLanes,z=z.sibling;S.childLanes=q&~L}else S.childLanes=0,S.child=null;return DM(v,S,L,C)}if((C&536870912)!==0)S.memoizedState={baseLanes:0,cachePool:null},v!==null&&ay(S,he!==null?he.cachePool:null),he!==null?jn(S,he):xr(),ve(S);else return S.lanes=S.childLanes=536870912,DM(v,S,he!==null?he.baseLanes|C:C,C)}else he!==null?(ay(S,he.cachePool),jn(S,he),et(),S.memoizedState=null):(v!==null&&ay(S,null),xr(),et());return Is(v,S,z,C),S.child}function DM(v,S,C,L){var z=nS();return z=z===null?null:{parent:Da?rr._currentValue:rr._currentValue2,pool:z},S.memoizedState={baseLanes:C,cachePool:z},v!==null&&ay(S,null),xr(),ve(S),v!==null&&Tg(v,S,L,!0),null}function wg(v,S){var C=S.ref;if(C===null)v!==null&&v.ref!==null&&(S.flags|=2097664);else{if(typeof C!="function"&&typeof C!="object")throw Error(r(284));(v===null||v.ref!==C)&&(S.flags|=2097664)}}function ry(v,S,C,L,z){return uh(S),C=si(v,S,C,L,void 0,z),L=Ri(),v!==null&&!Yn?(Pi(v,S,z),ru(v,S,z)):(pn&&L&&se(S),S.flags|=1,Is(v,S,C,z),S.child)}function RM(v,S,C,L,z,q){return uh(S),S.updateQueue=null,C=Zt(S,L,C,z),oi(v),L=Ri(),v!==null&&!Yn?(Pi(v,S,q),ru(v,S,q)):(pn&&L&&se(S),S.flags|=1,Is(v,S,C,q),S.child)}function PM(v,S,C,L,z){if(uh(S),S.stateNode===null){var q=Th,he=C.contextType;typeof he=="object"&&he!==null&&(q=Ls(he)),q=new C(L,q),S.memoizedState=q.state!==null&&q.state!==void 0?q.state:null,q.updater=gc,S.stateNode=q,q._reactInternals=S,q=S.stateNode,q.props=L,q.state=S.memoizedState,q.refs={},bt(S),he=C.contextType,q.context=typeof he=="object"&&he!==null?Ls(he):Th,q.state=S.memoizedState,he=C.getDerivedStateFromProps,typeof he=="function"&&(pp(S,C,he,L),q.state=S.memoizedState),typeof C.getDerivedStateFromProps=="function"||typeof q.getSnapshotBeforeUpdate=="function"||typeof q.UNSAFE_componentWillMount!="function"&&typeof q.componentWillMount!="function"||(he=q.state,typeof q.componentWillMount=="function"&&q.componentWillMount(),typeof q.UNSAFE_componentWillMount=="function"&&q.UNSAFE_componentWillMount(),he!==q.state&&gc.enqueueReplaceState(q,q.state,null),At(S,L,q,z),Ve(),q.state=S.memoizedState),typeof q.componentDidMount=="function"&&(S.flags|=4194308),L=!0}else if(v===null){q=S.stateNode;var Te=S.memoizedProps,Je=nu(C,Te);q.props=Je;var Et=q.context,Ut=C.contextType;he=Th,typeof Ut=="object"&&Ut!==null&&(he=Ls(Ut));var Wt=C.getDerivedStateFromProps;Ut=typeof Wt=="function"||typeof q.getSnapshotBeforeUpdate=="function",Te=S.pendingProps!==Te,Ut||typeof q.UNSAFE_componentWillReceiveProps!="function"&&typeof q.componentWillReceiveProps!="function"||(Te||Et!==he)&&wM(S,q,L,he),Su=!1;var Yt=S.memoizedState;q.state=Yt,At(S,L,q,z),Ve(),Et=S.memoizedState,Te||Yt!==Et||Su?(typeof Wt=="function"&&(pp(S,C,Wt,L),Et=S.memoizedState),(Je=Su||mp(S,C,Je,L,Yt,Et,he))?(Ut||typeof q.UNSAFE_componentWillMount!="function"&&typeof q.componentWillMount!="function"||(typeof q.componentWillMount=="function"&&q.componentWillMount(),typeof q.UNSAFE_componentWillMount=="function"&&q.UNSAFE_componentWillMount()),typeof q.componentDidMount=="function"&&(S.flags|=4194308)):(typeof q.componentDidMount=="function"&&(S.flags|=4194308),S.memoizedProps=L,S.memoizedState=Et),q.props=L,q.state=Et,q.context=he,L=Je):(typeof q.componentDidMount=="function"&&(S.flags|=4194308),L=!1)}else{q=S.stateNode,vt(v,S),he=S.memoizedProps,Ut=nu(C,he),q.props=Ut,Wt=S.pendingProps,Yt=q.context,Et=C.contextType,Je=Th,typeof Et=="object"&&Et!==null&&(Je=Ls(Et)),Te=C.getDerivedStateFromProps,(Et=typeof Te=="function"||typeof q.getSnapshotBeforeUpdate=="function")||typeof q.UNSAFE_componentWillReceiveProps!="function"&&typeof q.componentWillReceiveProps!="function"||(he!==Wt||Yt!==Je)&&wM(S,q,L,Je),Su=!1,Yt=S.memoizedState,q.state=Yt,At(S,L,q,z),Ve();var Vi=S.memoizedState;he!==Wt||Yt!==Vi||Su||v!==null&&v.dependencies!==null&&Cg(v.dependencies)?(typeof Te=="function"&&(pp(S,C,Te,L),Vi=S.memoizedState),(Ut=Su||mp(S,C,Ut,L,Yt,Vi,Je)||v!==null&&v.dependencies!==null&&Cg(v.dependencies))?(Et||typeof q.UNSAFE_componentWillUpdate!="function"&&typeof q.componentWillUpdate!="function"||(typeof q.componentWillUpdate=="function"&&q.componentWillUpdate(L,Vi,Je),typeof q.UNSAFE_componentWillUpdate=="function"&&q.UNSAFE_componentWillUpdate(L,Vi,Je)),typeof q.componentDidUpdate=="function"&&(S.flags|=4),typeof q.getSnapshotBeforeUpdate=="function"&&(S.flags|=1024)):(typeof q.componentDidUpdate!="function"||he===v.memoizedProps&&Yt===v.memoizedState||(S.flags|=4),typeof q.getSnapshotBeforeUpdate!="function"||he===v.memoizedProps&&Yt===v.memoizedState||(S.flags|=1024),S.memoizedProps=L,S.memoizedState=Vi),q.props=L,q.state=Vi,q.context=Je,L=Ut):(typeof q.componentDidUpdate!="function"||he===v.memoizedProps&&Yt===v.memoizedState||(S.flags|=4),typeof q.getSnapshotBeforeUpdate!="function"||he===v.memoizedProps&&Yt===v.memoizedState||(S.flags|=1024),L=!1)}return q=L,wg(v,S),L=(S.flags&128)!==0,q||L?(q=S.stateNode,C=L&&typeof C.getDerivedStateFromError!="function"?null:q.render(),S.flags|=1,v!==null&&L?(S.child=Oh(S,v.child,null,z),S.child=Oh(S,null,C,z)):Is(v,S,C,z),S.memoizedState=q.state,v=S.child):v=ru(v,S,z),v}function OM(v,S,C,L){return Ge(),S.flags|=256,Is(v,S,C,L),S.child}function Jb(v){return{baseLanes:v,cachePool:rS()}}function Mg(v,S,C){return v=v!==null?v.childLanes&~C:0,S&&(v|=No),v}function BM(v,S,C){var L=S.pendingProps,z=!1,q=(S.flags&128)!==0,he;if((he=q)||(he=v!==null&&v.memoizedState===null?!1:(rs.current&2)!==0),he&&(z=!0,S.flags&=-129),he=(S.flags&32)!==0,S.flags&=-33,v===null){if(pn){if(z?kr(S):et(),pn){var Te=Hs,Je;(Je=Te)&&(Te=gE(Te,Ss),Te!==null?(S.memoizedState={dehydrated:Te,treeContext:Ch!==null?{id:Fl,overflow:Vl}:null,retryLane:536870912},Je=i(18,null,null,0),Je.stateNode=Te,Je.return=S,S.child=Je,Vs=S,Hs=null,Je=!0):Je=!1),Je||be(S)}if(Te=S.memoizedState,Te!==null&&(Te=Te.dehydrated,Te!==null))return Py(Te)?S.lanes=16:S.lanes=536870912,null;ft(S)}return Te=L.children,L=L.fallback,z?(et(),z=S.mode,Te=$b({mode:"hidden",children:Te},z),L=wr(L,z,C,null),Te.return=S,L.return=S,Te.sibling=L,S.child=Te,z=S.child,z.memoizedState=Jb(C),z.childLanes=Mg(v,he,C),S.memoizedState=Wy,L):(kr(S),Zb(S,Te))}if(Je=v.memoizedState,Je!==null&&(Te=Je.dehydrated,Te!==null)){if(q)S.flags&256?(kr(S),S.flags&=-257,S=sy(v,S,C)):S.memoizedState!==null?(et(),S.child=v.child,S.flags|=128,S=null):(et(),z=L.fallback,Te=S.mode,L=$b({mode:"visible",children:L.children},Te),z=wr(z,Te,C,null),z.flags|=2,L.return=S,z.return=S,L.sibling=z,S.child=L,Oh(S,v.child,null,C),L=S.child,L.memoizedState=Jb(C),L.childLanes=Mg(v,he,C),S.memoizedState=Wy,S=z);else if(kr(S),Py(Te))he=hE(Te).digest,L=Error(r(419)),L.stack="",L.digest=he,We({value:L,source:null,stack:null}),S=sy(v,S,C);else if(Yn||Tg(v,S,C,!1),he=(C&v.childLanes)!==0,Yn||he){if(he=In,he!==null){if(L=C&-C,(L&42)!==0)L=1;else switch(L){case 2:L=1;break;case 8:L=4;break;case 32:L=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:L=64;break;case 268435456:L=134217728;break;default:L=0}if(L=(L&(he.suspendedLanes|C))!==0?0:L,L!==0&&L!==Je.retryLane)throw Je.retryLane=L,je(v,L),xs(he,v,L),jy}Ry(Te)||hu(),S=sy(v,S,C)}else Ry(Te)?(S.flags|=128,S.child=v.child,S=du.bind(null,v),dE(Te,S),S=null):(v=Je.treeContext,Fs&&(Hs=mE(Te),Vs=S,pn=!0,dl=null,Ss=!1,v!==null&&(Co[Do++]=Fl,Co[Do++]=Vl,Co[Do++]=Ch,Fl=v.id,Vl=v.overflow,Ch=S)),S=Zb(S,L.children),S.flags|=4096);return S}return z?(et(),z=L.fallback,Te=S.mode,Je=v.child,q=Je.sibling,L=ol(Je,{mode:"hidden",children:L.children}),L.subtreeFlags=Je.subtreeFlags&31457280,q!==null?z=ol(q,z):(z=wr(z,Te,C,null),z.flags|=2),z.return=S,L.return=S,L.sibling=z,S.child=L,L=z,z=S.child,Te=v.child.memoizedState,Te===null?Te=Jb(C):(Je=Te.cachePool,Je!==null?(q=Da?rr._currentValue:rr._currentValue2,Je=Je.parent!==q?{parent:q,pool:q}:Je):Je=rS(),Te={baseLanes:Te.baseLanes|C,cachePool:Je}),z.memoizedState=Te,z.childLanes=Mg(v,he,C),S.memoizedState=Wy,L):(kr(S),C=v.child,v=C.sibling,C=ol(C,{mode:"visible",children:L.children}),C.return=S,C.sibling=null,v!==null&&(he=S.deletions,he===null?(S.deletions=[v],S.flags|=16):he.push(v)),S.child=C,S.memoizedState=null,C)}function Zb(v,S){return S=$b({mode:"visible",children:S},v.mode),S.return=v,v.child=S}function $b(v,S){return Gg(v,S,0,null)}function sy(v,S,C){return Oh(S,v.child,null,C),v=Zb(S,S.pendingProps.children),v.flags|=2,S.memoizedState=null,v}function IM(v,S,C){v.lanes|=S;var L=v.alternate;L!==null&&(L.lanes|=S),Eg(v.return,S,C)}function eS(v,S,C,L,z){var q=v.memoizedState;q===null?v.memoizedState={isBackwards:S,rendering:null,renderingStartTime:0,last:L,tail:C,tailMode:z}:(q.isBackwards=S,q.rendering=null,q.renderingStartTime=0,q.last=L,q.tail=C,q.tailMode=z)}function LM(v,S,C){var L=S.pendingProps,z=L.revealOrder,q=L.tail;if(Is(v,S,L.children,C),L=rs.current,(L&2)!==0)L=L&1|2,S.flags|=128;else{if(v!==null&&(v.flags&128)!==0)e:for(v=S.child;v!==null;){if(v.tag===13)v.memoizedState!==null&&IM(v,C,S);else if(v.tag===19)IM(v,C,S);else if(v.child!==null){v.child.return=v,v=v.child;continue}if(v===S)break e;for(;v.sibling===null;){if(v.return===null||v.return===S)break e;v=v.return}v.sibling.return=v.return,v=v.sibling}L&=1}switch(A(rs,L),z){case"forwards":for(C=S.child,z=null;C!==null;)v=C.alternate,v!==null&&Ye(v)===null&&(z=C),C=C.sibling;C=z,C===null?(z=S.child,S.child=null):(z=C.sibling,C.sibling=null),eS(S,!1,z,C,q);break;case"backwards":for(C=null,z=S.child,S.child=null;z!==null;){if(v=z.alternate,v!==null&&Ye(v)===null){S.child=z;break}v=z.sibling,z.sibling=C,C=z,z=v}eS(S,!0,C,null,q);break;case"together":eS(S,!1,null,null,void 0);break;default:S.memoizedState=null}return S.child}function ru(v,S,C){if(v!==null&&(S.dependencies=v.dependencies),Uo|=S.lanes,(C&S.childLanes)===0)if(v!==null){if(Tg(v,S,C,!1),(C&S.childLanes)===0)return null}else return null;if(v!==null&&S.child!==v.child)throw Error(r(153));if(S.child!==null){for(v=S.child,C=ol(v,v.pendingProps),S.child=C,C.return=S;v.sibling!==null;)v=v.sibling,C=C.sibling=ol(v,v.pendingProps),C.return=S;C.sibling=null}return S.child}function tS(v,S){return(v.lanes&S)!==0?!0:(v=v.dependencies,!!(v!==null&&Cg(v)))}function vP(v,S,C){switch(S.tag){case 3:te(S,S.stateNode.containerInfo),ch(S,rr,v.memoizedState.cache),Ge();break;case 27:case 5:le(S);break;case 4:te(S,S.stateNode.containerInfo);break;case 10:ch(S,S.type,S.memoizedProps.value);break;case 13:var L=S.memoizedState;if(L!==null)return L.dehydrated!==null?(kr(S),S.flags|=128,null):(C&S.child.childLanes)!==0?BM(v,S,C):(kr(S),v=ru(v,S,C),v!==null?v.sibling:null);kr(S);break;case 19:var z=(v.flags&128)!==0;if(L=(C&S.childLanes)!==0,L||(Tg(v,S,C,!1),L=(C&S.childLanes)!==0),z){if(L)return LM(v,S,C);S.flags|=128}if(z=S.memoizedState,z!==null&&(z.rendering=null,z.tail=null,z.lastEffect=null),A(rs,rs.current),L)break;return null;case 22:case 23:return S.lanes=0,CM(v,S,C);case 24:ch(S,rr,v.memoizedState.cache)}return ru(v,S,C)}function UM(v,S,C){if(v!==null)if(v.memoizedProps!==S.pendingProps)Yn=!0;else{if(!tS(v,C)&&(S.flags&128)===0)return Yn=!1,vP(v,S,C);Yn=(v.flags&131072)!==0}else Yn=!1,pn&&(S.flags&1048576)!==0&&$(S,Fp,S.index);switch(S.lanes=0,S.tag){case 16:e:{v=S.pendingProps;var L=S.elementType,z=L._init;if(L=z(L._payload),S.type=L,typeof L=="function")Vg(L)?(v=nu(L,v),S.tag=1,S=PM(null,S,L,v,C)):(S.tag=0,S=ry(null,S,L,v,C));else{if(L!=null){if(z=L.$$typeof,z===qg){S.tag=11,S=ny(null,S,L,v,C);break e}else if(z===wy){S.tag=14,S=EM(null,S,L,v,C);break e}}throw S=a(L)||L,Error(r(306,S,""))}}return S;case 0:return ry(v,S,S.type,S.pendingProps,C);case 1:return L=S.type,z=nu(L,S.pendingProps),PM(v,S,L,z,C);case 3:e:{if(te(S,S.stateNode.containerInfo),v===null)throw Error(r(387));var q=S.pendingProps;z=S.memoizedState,L=z.element,vt(v,S),At(S,q,null,C);var he=S.memoizedState;if(q=he.cache,ch(S,rr,q),q!==z.cache&&Bd(S,[rr],C,!0),Ve(),q=he.element,Fs&&z.isDehydrated)if(z={element:q,isDehydrated:!1,cache:he.cache},S.updateQueue.baseState=z,S.memoizedState=z,S.flags&256){S=OM(v,S,q,C);break e}else if(q!==L){L=ne(Error(r(424)),S),We(L),S=OM(v,S,q,C);break e}else for(Fs&&(Hs=pE(S.stateNode.containerInfo),Vs=S,pn=!0,dl=null,Ss=!0),C=mc(S,null,q,C),S.child=C;C;)C.flags=C.flags&-3|4096,C=C.sibling;else{if(Ge(),q===L){S=ru(v,S,C);break e}Is(v,S,q,C)}S=S.child}return S;case 26:if(To)return wg(v,S),v===null?(C=HS(S.type,null,S.pendingProps,null))?S.memoizedState=C:pn||(S.stateNode=Uy(S.type,S.pendingProps,fc.current,S)):S.memoizedState=HS(S.type,v.memoizedProps,S.pendingProps,v.memoizedState),null;case 27:if(Xn)return le(S),v===null&&Xn&&pn&&(L=S.stateNode=zl(S.type,S.pendingProps,fc.current,ns.current,!1),Vs=S,Ss=!0,Hs=Oy(L)),L=S.pendingProps.children,v!==null||pn?Is(v,S,L,C):S.child=Oh(S,null,L,C),wg(v,S),S.child;case 5:return v===null&&pn&&(Iy(S.type,S.pendingProps,ns.current),(z=L=Hs)&&(L=wP(L,S.type,S.pendingProps,Ss),L!==null?(S.stateNode=L,Vs=S,Hs=Oy(L),Ss=!1,z=!0):z=!1),z||be(S)),le(S),z=S.type,q=S.pendingProps,he=v!==null?v.memoizedProps:null,L=q.children,Wi(z,q)?L=null:he!==null&&Wi(z,he)&&(S.flags|=32),S.memoizedState!==null&&(z=si(v,S,fi,null,null,C),Da?Nl._currentValue=z:Nl._currentValue2=z),wg(v,S),Is(v,S,L,C),S.child;case 6:return v===null&&pn&&(SE(S.pendingProps,ns.current),(v=C=Hs)&&(C=FS(C,S.pendingProps,Ss),C!==null?(S.stateNode=C,Vs=S,Hs=null,v=!0):v=!1),v||be(S)),null;case 13:return BM(v,S,C);case 4:return te(S,S.stateNode.containerInfo),L=S.pendingProps,v===null?S.child=Oh(S,null,L,C):Is(v,S,L,C),S.child;case 11:return ny(v,S,S.type,S.pendingProps,C);case 7:return Is(v,S,S.pendingProps,C),S.child;case 8:return Is(v,S,S.pendingProps.children,C),S.child;case 12:return Is(v,S,S.pendingProps.children,C),S.child;case 10:return L=S.pendingProps,ch(S,S.type,L.value),Is(v,S,L.children,C),S.child;case 9:return z=S.type._context,L=S.pendingProps.children,uh(S),z=Ls(z),L=L(z),S.flags|=1,Is(v,S,L,C),S.child;case 14:return EM(v,S,S.type,S.pendingProps,C);case 15:return TM(v,S,S.type,S.pendingProps,C);case 19:return LM(v,S,C);case 22:return CM(v,S,C);case 24:return uh(S),L=Ls(rr),v===null?(z=nS(),z===null&&(z=In,q=hh(),z.pooledCache=q,q.refCount++,q!==null&&(z.pooledCacheLanes|=C),z=q),S.memoizedState={parent:L,cache:z},bt(S),ch(S,rr,z)):((v.lanes&C)!==0&&(vt(v,S),At(S,null,null,C),Ve()),z=v.memoizedState,q=S.memoizedState,z.parent!==L?(z={parent:L,cache:L},S.memoizedState=z,S.lanes===0&&(S.memoizedState=S.updateQueue.baseState=z),ch(S,rr,L)):(L=q.cache,ch(S,rr,L),L!==z.cache&&Bd(S,[rr],C,!0))),Is(v,S,S.pendingProps.children,C),S.child;case 29:throw S.pendingProps}throw Error(r(156,S.tag))}function ch(v,S,C){Da?(A(Au,S._currentValue),S._currentValue=C):(A(Au,S._currentValue2),S._currentValue2=C)}function su(v){var S=Au.current;Da?v._currentValue=S:v._currentValue2=S,b(Au)}function Eg(v,S,C){for(;v!==null;){var L=v.alternate;if((v.childLanes&S)!==S?(v.childLanes|=S,L!==null&&(L.childLanes|=S)):L!==null&&(L.childLanes&S)!==S&&(L.childLanes|=S),v===C)break;v=v.return}}function Bd(v,S,C,L){var z=v.child;for(z!==null&&(z.return=v);z!==null;){var q=z.dependencies;if(q!==null){var he=z.child;q=q.firstContext;e:for(;q!==null;){var Te=q;q=z;for(var Je=0;Je<S.length;Je++)if(Te.context===S[Je]){q.lanes|=C,Te=q.alternate,Te!==null&&(Te.lanes|=C),Eg(q.return,C,v),L||(he=null);break e}q=Te.next}}else if(z.tag===18){if(he=z.return,he===null)throw Error(r(341));he.lanes|=C,q=he.alternate,q!==null&&(q.lanes|=C),Eg(he,C,v),he=null}else he=z.child;if(he!==null)he.return=z;else for(he=z;he!==null;){if(he===v){he=null;break}if(z=he.sibling,z!==null){z.return=he.return,he=z;break}he=he.return}z=he}}function Tg(v,S,C,L){v=null;for(var z=S,q=!1;z!==null;){if(!q){if((z.flags&524288)!==0)q=!0;else if((z.flags&262144)!==0)break}if(z.tag===10){var he=z.alternate;if(he===null)throw Error(r(387));if(he=he.memoizedProps,he!==null){var Te=z.type;ro(z.pendingProps.value,he.value)||(v!==null?v.push(Te):v=[Te])}}else if(z===kd.current){if(he=z.alternate,he===null)throw Error(r(387));he.memoizedState.memoizedState!==z.memoizedState.memoizedState&&(v!==null?v.push(Nl):v=[Nl])}z=z.return}v!==null&&Bd(S,v,C,L),S.flags|=262144}function Cg(v){for(v=v.firstContext;v!==null;){var S=v.context;if(!ro(Da?S._currentValue:S._currentValue2,v.memoizedValue))return!0;v=v.next}return!1}function uh(v){kl=v,Bo=null,v=v.dependencies,v!==null&&(v.firstContext=null)}function Ls(v){return iS(kl,v)}function Dg(v,S){return kl===null&&uh(v),iS(v,S)}function iS(v,S){var C=Da?S._currentValue:S._currentValue2;if(S={context:S,memoizedValue:C,next:null},Bo===null){if(v===null)throw Error(r(308));Bo=S,v.dependencies={lanes:0,firstContext:S},v.flags|=524288}else Bo=Bo.next=S;return C}function hh(){return{controller:new Wp,data:new Map,refCount:0}}function Rg(v){v.refCount--,v.refCount===0&&OE(BE,function(){v.controller.abort()})}function nS(){var v=vc.current;return v!==null?v:In.pooledCache}function ay(v,S){S===null?A(vc,vc.current):A(vc,S.pool)}function rS(){var v=nS();return v===null?null:{parent:Da?rr._currentValue:rr._currentValue2,pool:v}}function Ja(v){v.flags|=4}function xp(v,S){if(v!==null&&v.child===S.child)return!1;if((S.flags&16)!==0)return!0;for(v=S.child;v!==null;){if((v.flags&13878)!==0||(v.subtreeFlags&13878)!==0)return!0;v=v.sibling}return!1}function Id(v,S,C,L){if(is)for(C=S.child;C!==null;){if(C.tag===5||C.tag===6)Qg(v,C.stateNode);else if(!(C.tag===4||Xn&&C.tag===27)&&C.child!==null){C.child.return=C,C=C.child;continue}if(C===S)break;for(;C.sibling===null;){if(C.return===null||C.return===S)return;C=C.return}C.sibling.return=C.return,C=C.sibling}else if(ul)for(var z=S.child;z!==null;){if(z.tag===5){var q=z.stateNode;C&&L&&(q=LS(q,z.type,z.memoizedProps)),Qg(v,q)}else if(z.tag===6)q=z.stateNode,C&&L&&(q=US(q,z.memoizedProps)),Qg(v,q);else if(z.tag!==4){if(z.tag===22&&z.memoizedState!==null)q=z.child,q!==null&&(q.return=z),Id(v,z,!0,!0);else if(z.child!==null){z.child.return=z,z=z.child;continue}}if(z===S)break;for(;z.sibling===null;){if(z.return===null||z.return===S)return;z=z.return}z.sibling.return=z.return,z=z.sibling}}function NM(v,S,C,L){if(ul)for(var z=S.child;z!==null;){if(z.tag===5){var q=z.stateNode;C&&L&&(q=LS(q,z.type,z.memoizedProps)),IS(v,q)}else if(z.tag===6)q=z.stateNode,C&&L&&(q=US(q,z.memoizedProps)),IS(v,q);else if(z.tag!==4){if(z.tag===22&&z.memoizedState!==null)q=z.child,q!==null&&(q.return=z),NM(v,z,!(z.memoizedProps!==null&&z.memoizedProps.mode==="manual"),!0);else if(z.child!==null){z.child.return=z,z=z.child;continue}}if(z===S)break;for(;z.sibling===null;){if(z.return===null||z.return===S)return;z=z.return}z.sibling.return=z.return,z=z.sibling}}function Pg(v,S){if(ul&&xp(v,S)){v=S.stateNode;var C=v.containerInfo,L=Kg();NM(L,S,!1,!1),v.pendingChildren=L,Ja(S),Dy(C,L)}}function oy(v,S,C,L){if(is)v.memoizedProps!==L&&Ja(S);else if(ul){var z=v.stateNode,q=v.memoizedProps;if((v=xp(v,S))||q!==L){var he=ns.current;q=Up(z,C,q,L,!v,null),q===z?S.stateNode=z:(gu(q,C,L,he)&&Ja(S),S.stateNode=q,v?Id(q,S,!1,!1):Ja(S))}else S.stateNode=z}}function ly(v,S,C){if(ES(S,C)){if(v.flags|=16777216,!Ty(S,C))if(vh())v.flags|=8192;else throw Dh=sv,rv}else v.flags&=-16777217}function cy(v,S){if(wE(S)){if(v.flags|=16777216,!zd(S))if(vh())v.flags|=8192;else throw Dh=sv,rv}else v.flags&=-16777217}function bp(v,S){S!==null&&(v.flags|=4),v.flags&16384&&(S=v.tag!==22?O():536870912,v.lanes|=S,bc|=S)}function Sp(v,S){if(!pn)switch(v.tailMode){case"hidden":S=v.tail;for(var C=null;S!==null;)S.alternate!==null&&(C=S),S=S.sibling;C===null?v.tail=null:C.sibling=null;break;case"collapsed":C=v.tail;for(var L=null;C!==null;)C.alternate!==null&&(L=C),C=C.sibling;L===null?S||v.tail===null?v.tail=null:v.tail.sibling=null:L.sibling=null}}function pr(v){var S=v.alternate!==null&&v.alternate.child===v.child,C=0,L=0;if(S)for(var z=v.child;z!==null;)C|=z.lanes|z.childLanes,L|=z.subtreeFlags&31457280,L|=z.flags&31457280,z.return=v,z=z.sibling;else for(z=v.child;z!==null;)C|=z.lanes|z.childLanes,L|=z.subtreeFlags,L|=z.flags,z.return=v,z=z.sibling;return v.subtreeFlags|=L,v.childLanes=C,S}function zM(v,S,C){var L=S.pendingProps;switch(fe(S),S.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return pr(S),null;case 1:return pr(S),null;case 3:return C=S.stateNode,L=null,v!==null&&(L=v.memoizedState.cache),S.memoizedState.cache!==L&&(S.flags|=2048),su(rr),de(),C.pendingContext&&(C.context=C.pendingContext,C.pendingContext=null),(v===null||v.child===null)&&(Ne(S)?Ja(S):v===null||v.memoizedState.isDehydrated&&(S.flags&256)===0||(S.flags|=1024,dl!==null&&(zg(dl),dl=null))),Pg(v,S),pr(S),null;case 26:if(To){C=S.type;var z=S.memoizedState;return v===null?(Ja(S),z!==null?(pr(S),cy(S,z)):(pr(S),ly(S,C,L))):z?z!==v.memoizedState?(Ja(S),pr(S),cy(S,z)):(pr(S),S.flags&=-16777217):(is?v.memoizedProps!==L&&Ja(S):oy(v,S,C,L),pr(S),ly(S,C,L)),null}case 27:if(Xn){if(_e(S),C=fc.current,z=S.type,v!==null&&S.stateNode!=null)is?v.memoizedProps!==L&&Ja(S):oy(v,S,z,L);else{if(!L){if(S.stateNode===null)throw Error(r(166));return pr(S),null}v=ns.current,Ne(S)?we(S,v):(v=zl(z,L,C,v,!0),S.stateNode=v,Ja(S))}return pr(S),null}case 5:if(_e(S),C=S.type,v!==null&&S.stateNode!=null)oy(v,S,C,L);else{if(!L){if(S.stateNode===null)throw Error(r(166));return pr(S),null}v=ns.current,Ne(S)?we(S,v):(z=MS(C,L,fc.current,v,S),Id(z,S,!1,!1),S.stateNode=z,gu(z,C,L,v)&&Ja(S))}return pr(S),ly(S,S.type,S.pendingProps),null;case 6:if(v&&S.stateNode!=null)C=v.memoizedProps,is?C!==L&&Ja(S):ul&&(C!==L?(S.stateNode=Nn(L,fc.current,ns.current,S),Ja(S)):S.stateNode=v.stateNode);else{if(typeof L!="string"&&S.stateNode===null)throw Error(r(166));if(v=fc.current,C=ns.current,Ne(S)){if(!Fs)throw Error(r(176));if(v=S.stateNode,C=S.memoizedProps,L=null,z=Vs,z!==null)switch(z.tag){case 27:case 5:L=z.memoizedProps}VS(v,C,S,L)||be(S)}else S.stateNode=Nn(L,v,C,S)}return pr(S),null;case 13:if(L=S.memoizedState,v===null||v.memoizedState!==null&&v.memoizedState.dehydrated!==null){if(z=Ne(S),L!==null&&L.dehydrated!==null){if(v===null){if(!z)throw Error(r(318));if(!Fs)throw Error(r(344));if(z=S.memoizedState,z=z!==null?z.dehydrated:null,!z)throw Error(r(317));yE(z,S)}else Ge(),(S.flags&128)===0&&(S.memoizedState=null),S.flags|=4;pr(S),z=!1}else dl!==null&&(zg(dl),dl=null),z=!0;if(!z)return S.flags&256?(ft(S),S):(ft(S),null)}if(ft(S),(S.flags&128)!==0)return S.lanes=C,S;if(C=L!==null,v=v!==null&&v.memoizedState!==null,C){L=S.child,z=null,L.alternate!==null&&L.alternate.memoizedState!==null&&L.alternate.memoizedState.cachePool!==null&&(z=L.alternate.memoizedState.cachePool.pool);var q=null;L.memoizedState!==null&&L.memoizedState.cachePool!==null&&(q=L.memoizedState.cachePool.pool),q!==z&&(L.flags|=2048)}return C!==v&&C&&(S.child.flags|=8192),bp(S,S.updateQueue),pr(S),null;case 4:return de(),Pg(v,S),v===null&&Br(S.stateNode.containerInfo),pr(S),null;case 10:return su(S.type),pr(S),null;case 19:if(b(rs),z=S.memoizedState,z===null)return pr(S),null;if(L=(S.flags&128)!==0,q=z.rendering,q===null)if(L)Sp(z,!1);else{if(Qn!==0||v!==null&&(v.flags&128)!==0)for(v=S.child;v!==null;){if(q=Ye(v),q!==null){for(S.flags|=128,Sp(z,!1),v=q.updateQueue,S.updateQueue=v,bp(S,v),S.subtreeFlags=0,v=C,C=S.child;C!==null;)Hg(C,v),C=C.sibling;return A(rs,rs.current&1|2),S.child}v=v.sibling}z.tail!==null&&hl()>Yp&&(S.flags|=128,L=!0,Sp(z,!1),S.lanes=4194304)}else{if(!L)if(v=Ye(q),v!==null){if(S.flags|=128,L=!0,v=v.updateQueue,S.updateQueue=v,bp(S,v),Sp(z,!0),z.tail===null&&z.tailMode==="hidden"&&!q.alternate&&!pn)return pr(S),null}else 2*hl()-z.renderingStartTime>Yp&&C!==536870912&&(S.flags|=128,L=!0,Sp(z,!1),S.lanes=4194304);z.isBackwards?(q.sibling=S.child,S.child=q):(v=z.last,v!==null?v.sibling=q:S.child=q,z.last=q)}return z.tail!==null?(S=z.tail,z.rendering=S,z.tail=S.sibling,z.renderingStartTime=hl(),S.sibling=null,v=rs.current,A(rs,L?v&1|2:v&1),S):(pr(S),null);case 22:case 23:return ft(S),Gr(),L=S.memoizedState!==null,v!==null?v.memoizedState!==null!==L&&(S.flags|=8192):L&&(S.flags|=8192),L?(C&536870912)!==0&&(S.flags&128)===0&&(pr(S),S.subtreeFlags&6&&(S.flags|=8192)):pr(S),C=S.updateQueue,C!==null&&bp(S,C.retryQueue),C=null,v!==null&&v.memoizedState!==null&&v.memoizedState.cachePool!==null&&(C=v.memoizedState.cachePool.pool),L=null,S.memoizedState!==null&&S.memoizedState.cachePool!==null&&(L=S.memoizedState.cachePool.pool),L!==C&&(S.flags|=2048),v!==null&&b(vc),null;case 24:return C=null,v!==null&&(C=v.memoizedState.cache),S.memoizedState.cache!==C&&(S.flags|=2048),su(rr),pr(S),null;case 25:return null}throw Error(r(156,S.tag))}function yP(v,S){switch(fe(S),S.tag){case 1:return v=S.flags,v&65536?(S.flags=v&-65537|128,S):null;case 3:return su(rr),de(),v=S.flags,(v&65536)!==0&&(v&128)===0?(S.flags=v&-65537|128,S):null;case 26:case 27:case 5:return _e(S),null;case 13:if(ft(S),v=S.memoizedState,v!==null&&v.dehydrated!==null){if(S.alternate===null)throw Error(r(340));Ge()}return v=S.flags,v&65536?(S.flags=v&-65537|128,S):null;case 19:return b(rs),null;case 4:return de(),null;case 10:return su(S.type),null;case 22:case 23:return ft(S),Gr(),v!==null&&b(vc),v=S.flags,v&65536?(S.flags=v&-65537|128,S):null;case 24:return su(rr),null;case 25:return null;default:return null}}function FM(v,S){switch(fe(S),S.tag){case 3:su(rr),de();break;case 26:case 27:case 5:_e(S);break;case 4:de();break;case 13:ft(S);break;case 19:b(rs);break;case 10:su(S.type);break;case 22:case 23:ft(S),Gr(),v!==null&&b(vc);break;case 24:su(rr)}}function Og(v,S){try{var C=S.updateQueue,L=C!==null?C.lastEffect:null;if(L!==null){var z=L.next;C=z;do{if((C.tag&v)===v){L=void 0;var q=C.create,he=C.inst;L=q(),he.destroy=L}C=C.next}while(C!==z)}}catch(Te){On(S,S.return,Te)}}function dh(v,S,C){try{var L=S.updateQueue,z=L!==null?L.lastEffect:null;if(z!==null){var q=z.next;L=q;do{if((L.tag&v)===v){var he=L.inst,Te=he.destroy;if(Te!==void 0){he.destroy=void 0,z=S;var Je=C;try{Te()}catch(Et){On(z,Je,Et)}}}L=L.next}while(L!==q)}}catch(Et){On(S,S.return,Et)}}function VM(v){var S=v.updateQueue;if(S!==null){var C=v.stateNode;try{Ce(S,C)}catch(L){On(v,v.return,L)}}}function Za(v,S,C){C.props=nu(v.type,v.memoizedProps),C.state=v.memoizedState;try{C.componentWillUnmount()}catch(L){On(v,S,L)}}function Il(v,S){try{var C=v.ref;if(C!==null){var L=v.stateNode;switch(v.tag){case 26:case 27:case 5:var z=Bp(L);break;default:z=L}typeof C=="function"?v.refCleanup=C(z):C.current=z}}catch(q){On(v,S,q)}}function $a(v,S){var C=v.ref,L=v.refCleanup;if(C!==null)if(typeof L=="function")try{L()}catch(z){On(v,S,z)}finally{v.refCleanup=null,v=v.alternate,v!=null&&(v.refCleanup=null)}else if(typeof C=="function")try{C(null)}catch(z){On(v,S,z)}else C.current=null}function sS(v){var S=v.type,C=v.memoizedProps,L=v.stateNode;try{_P(L,S,C,v)}catch(z){On(v,v.return,z)}}function aS(v,S,C){try{nE(v.stateNode,v.type,C,S,v)}catch(L){On(v,v.return,L)}}function oS(v){return v.tag===5||v.tag===3||(To?v.tag===26:!1)||(Xn?v.tag===27:!1)||v.tag===4}function Bg(v){e:for(;;){for(;v.sibling===null;){if(v.return===null||oS(v.return))return null;v=v.return}for(v.sibling.return=v.return,v=v.sibling;v.tag!==5&&v.tag!==6&&(!Xn||v.tag!==27)&&v.tag!==18;){if(v.flags&2||v.child===null||v.tag===4)continue e;v.child.return=v,v=v.child}if(!(v.flags&2))return v.stateNode}}function lS(v,S,C){var L=v.tag;if(L===5||L===6)v=v.stateNode,S?sE(C,v,S):PS(C,v);else if(!(L===4||Xn&&L===27)&&(v=v.child,v!==null))for(lS(v,S,C),v=v.sibling;v!==null;)lS(v,S,C),v=v.sibling}function au(v,S,C){var L=v.tag;if(L===5||L===6)v=v.stateNode,S?rE(C,v,S):tE(C,v);else if(!(L===4||Xn&&L===27)&&(v=v.child,v!==null))for(au(v,S,C),v=v.sibling;v!==null;)au(v,S,C),v=v.sibling}function uy(v,S,C){v=v.containerInfo;try{Np(v,C)}catch(L){On(S,S.return,L)}}function Ig(v,S){for(My(v.containerInfo),Fi=S;Fi!==null;)if(v=Fi,S=v.child,(v.subtreeFlags&1028)!==0&&S!==null)S.return=v,Fi=S;else for(;Fi!==null;){v=Fi;var C=v.alternate;switch(S=v.flags,v.tag){case 0:break;case 11:case 15:break;case 1:if((S&1024)!==0&&C!==null){S=void 0;var L=v,z=C.memoizedProps;C=C.memoizedState;var q=L.stateNode;try{var he=nu(L.type,z,L.elementType===L.type);S=q.getSnapshotBeforeUpdate(he,C),q.__reactInternalSnapshotBeforeUpdate=S}catch(Te){On(L,L.return,Te)}}break;case 3:(S&1024)!==0&&is&&uE(v.stateNode.containerInfo);break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((S&1024)!==0)throw Error(r(163))}if(S=v.sibling,S!==null){S.return=v.return,Fi=S;break}Fi=v.return}return he=sn,sn=!1,he}function hy(v,S,C){var L=C.flags;switch(C.tag){case 0:case 11:case 15:lu(v,C),L&4&&Og(5,C);break;case 1:if(lu(v,C),L&4)if(v=C.stateNode,S===null)try{v.componentDidMount()}catch(Te){On(C,C.return,Te)}else{var z=nu(C.type,S.memoizedProps);S=S.memoizedState;try{v.componentDidUpdate(z,S,v.__reactInternalSnapshotBeforeUpdate)}catch(Te){On(C,C.return,Te)}}L&64&&VM(C),L&512&&Il(C,C.return);break;case 3:if(lu(v,C),L&64&&(L=C.updateQueue,L!==null)){if(v=null,C.child!==null)switch(C.child.tag){case 27:case 5:v=Bp(C.child.stateNode);break;case 1:v=C.child.stateNode}try{Ce(L,v)}catch(Te){On(C,C.return,Te)}}break;case 26:if(To){lu(v,C),L&512&&Il(C,C.return);break}case 27:case 5:lu(v,C),S===null&&L&4&&sS(C),L&512&&Il(C,C.return);break;case 12:lu(v,C);break;case 13:lu(v,C),L&4&&dy(v,C);break;case 22:if(z=C.memoizedState!==null||yc,!z){S=S!==null&&S.memoizedState!==null||Er;var q=yc,he=Er;yc=z,(Er=S)&&!he?cu(v,C,(C.subtreeFlags&8772)!==0):lu(v,C),yc=q,Er=he}L&512&&(C.memoizedProps.mode==="manual"?Il(C,C.return):$a(C,C.return));break;default:lu(v,C)}}function cS(v){var S=v.alternate;S!==null&&(v.alternate=null,cS(S)),v.child=null,v.deletions=null,v.sibling=null,v.tag===5&&(S=v.stateNode,S!==null&&SP(S)),v.stateNode=null,v.return=null,v.dependencies=null,v.memoizedProps=null,v.memoizedState=null,v.pendingProps=null,v.stateNode=null,v.updateQueue=null}function Us(v,S,C){for(C=C.child;C!==null;)fh(v,S,C),C=C.sibling}function fh(v,S,C){if(no&&typeof no.onCommitFiberUnmount=="function")try{no.onCommitFiberUnmount(Lr,C)}catch{}switch(C.tag){case 26:if(To){Er||$a(C,S),Us(v,S,C),C.memoizedState?Nd(C.memoizedState):C.stateNode&&zp(C.stateNode);break}case 27:if(Xn){Er||$a(C,S);var L=pi,z=Qi;pi=C.stateNode,Us(v,S,C),Eh(C.stateNode),pi=L,Qi=z;break}case 5:Er||$a(C,S);case 6:if(is){if(L=pi,z=Qi,pi=null,Us(v,S,C),pi=L,Qi=z,pi!==null)if(Qi)try{aE(pi,C.stateNode)}catch(q){On(C,S,q)}else try{OS(pi,C.stateNode)}catch(q){On(C,S,q)}}else Us(v,S,C);break;case 18:is&&pi!==null&&(Qi?Jg(pi,C.stateNode):bE(pi,C.stateNode));break;case 4:is?(L=pi,z=Qi,pi=C.stateNode.containerInfo,Qi=!0,Us(v,S,C),pi=L,Qi=z):(ul&&uy(C.stateNode,C,Kg()),Us(v,S,C));break;case 0:case 11:case 14:case 15:Er||dh(2,C,S),Er||dh(4,C,S),Us(v,S,C);break;case 1:Er||($a(C,S),L=C.stateNode,typeof L.componentWillUnmount=="function"&&Za(C,S,L)),Us(v,S,C);break;case 21:Us(v,S,C);break;case 22:Er||$a(C,S),Er=(L=Er)||C.memoizedState!==null,Us(v,S,C),Er=L;break;default:Us(v,S,C)}}function dy(v,S){if(Fs&&S.memoizedState===null&&(v=S.alternate,v!==null&&(v=v.memoizedState,v!==null&&(v=v.dehydrated,v!==null))))try{EP(v)}catch(C){On(S,S.return,C)}}function HM(v){switch(v.tag){case 13:case 19:var S=v.stateNode;return S===null&&(S=v.stateNode=new Bn),S;case 22:return v=v.stateNode,S=v._retryCache,S===null&&(S=v._retryCache=new Bn),S;default:throw Error(r(435,v.tag))}}function ou(v,S){var C=HM(v);S.forEach(function(L){var z=bh.bind(null,v,L);C.has(L)||(C.add(L),L.then(z,z))})}function Ta(v,S){var C=S.deletions;if(C!==null)for(var L=0;L<C.length;L++){var z=C[L],q=v,he=S;if(is){var Te=he;e:for(;Te!==null;){switch(Te.tag){case 27:case 5:pi=Te.stateNode,Qi=!1;break e;case 3:pi=Te.stateNode.containerInfo,Qi=!0;break e;case 4:pi=Te.stateNode.containerInfo,Qi=!0;break e}Te=Te.return}if(pi===null)throw Error(r(160));fh(q,he,z),pi=null,Qi=!1}else fh(q,he,z);q=z.alternate,q!==null&&(q.return=null),z.return=null}if(S.subtreeFlags&13878)for(S=S.child;S!==null;)uS(S,v),S=S.sibling}function uS(v,S){var C=v.alternate,L=v.flags;switch(v.tag){case 0:case 11:case 14:case 15:Ta(S,v),eo(v),L&4&&(dh(3,v,v.return),Og(3,v),dh(5,v,v.return));break;case 1:Ta(S,v),eo(v),L&512&&(Er||C===null||$a(C,C.return)),L&64&&yc&&(v=v.updateQueue,v!==null&&(L=v.callbacks,L!==null&&(C=v.shared.hiddenCallbacks,v.shared.hiddenCallbacks=C===null?L:C.concat(L))));break;case 26:if(To){var z=Sr;Ta(S,v),eo(v),L&512&&(Er||C===null||$a(C,C.return)),L&4&&(L=C!==null?C.memoizedState:null,S=v.memoizedState,C===null?S===null?v.stateNode===null?v.stateNode=$g(z,v.type,v.memoizedProps,v):ev(z,v.type,v.stateNode):v.stateNode=_E(z,S,v.memoizedProps):L!==S?(L===null?C.stateNode!==null&&zp(C.stateNode):Nd(L),S===null?ev(z,v.type,v.stateNode):_E(z,S,v.memoizedProps)):S===null&&v.stateNode!==null&&aS(v,v.memoizedProps,C.memoizedProps));break}case 27:if(Xn&&L&4&&v.alternate===null){z=v.stateNode;var q=v.memoizedProps;try{Mh(z),EE(v.type,q,z,v)}catch(Ut){On(v,v.return,Ut)}}case 5:if(Ta(S,v),eo(v),L&512&&(Er||C===null||$a(C,C.return)),is){if(v.flags&32){S=v.stateNode;try{BS(S)}catch(Ut){On(v,v.return,Ut)}}L&4&&v.stateNode!=null&&(S=v.memoizedProps,aS(v,S,C!==null?C.memoizedProps:S)),L&1024&&(WS=!0)}break;case 6:if(Ta(S,v),eo(v),L&4&&is){if(v.stateNode===null)throw Error(r(162));L=v.memoizedProps,C=C!==null?C.memoizedProps:L,S=v.stateNode;try{iE(S,C,L)}catch(Ut){On(v,v.return,Ut)}}break;case 3:if(To?(AE(),z=Sr,Sr=Ly(S.containerInfo),Ta(S,v),Sr=z):Ta(S,v),eo(v),L&4){if(is&&Fs&&C!==null&&C.memoizedState.isDehydrated)try{MP(S.containerInfo)}catch(Ut){On(v,v.return,Ut)}if(ul){L=S.containerInfo,C=S.pendingChildren;try{Np(L,C)}catch(Ut){On(v,v.return,Ut)}}}WS&&(WS=!1,GM(v));break;case 4:To?(C=Sr,Sr=Ly(v.stateNode.containerInfo),Ta(S,v),eo(v),Sr=C):(Ta(S,v),eo(v)),L&4&&ul&&uy(v.stateNode,v,v.stateNode.pendingChildren);break;case 12:Ta(S,v),eo(v);break;case 13:Ta(S,v),eo(v),v.child.flags&8192&&v.memoizedState!==null!=(C!==null&&C.memoizedState!==null)&&(Ba=hl()),L&4&&(L=v.updateQueue,L!==null&&(v.updateQueue=null,ou(v,L)));break;case 22:L&512&&(Er||C===null||$a(C,C.return)),z=v.memoizedState!==null;var he=C!==null&&C.memoizedState!==null,Te=yc,Je=Er;if(yc=Te||z,Er=Je||he,Ta(S,v),Er=Je,yc=Te,eo(v),S=v.stateNode,S._current=v,S._visibility&=-3,S._visibility|=S._pendingVisibility&2,L&8192&&(S._visibility=z?S._visibility&-2:S._visibility|1,z&&(S=yc||Er,C===null||he||S||_p(v)),is&&(v.memoizedProps===null||v.memoizedProps.mode!=="manual"))){e:if(C=null,is)for(S=v;;){if(S.tag===5||To&&S.tag===26||Xn&&S.tag===27){if(C===null){he=C=S;try{q=he.stateNode,z?oE(q):cE(he.stateNode,he.memoizedProps)}catch(Ut){On(he,he.return,Ut)}}}else if(S.tag===6){if(C===null){he=S;try{var Et=he.stateNode;z?lE(Et):AP(Et,he.memoizedProps)}catch(Ut){On(he,he.return,Ut)}}}else if((S.tag!==22&&S.tag!==23||S.memoizedState===null||S===v)&&S.child!==null){S.child.return=S,S=S.child;continue}if(S===v)break e;for(;S.sibling===null;){if(S.return===null||S.return===v)break e;C===S&&(C=null),S=S.return}C===S&&(C=null),S.sibling.return=S.return,S=S.sibling}}L&4&&(L=v.updateQueue,L!==null&&(C=L.retryQueue,C!==null&&(L.retryQueue=null,ou(v,C))));break;case 19:Ta(S,v),eo(v),L&4&&(L=v.updateQueue,L!==null&&(v.updateQueue=null,ou(v,L)));break;case 21:break;default:Ta(S,v),eo(v)}}function eo(v){var S=v.flags;if(S&2){try{if(is&&(!Xn||v.tag!==27)){e:{for(var C=v.return;C!==null;){if(oS(C)){var L=C;break e}C=C.return}throw Error(r(160))}switch(L.tag){case 27:if(Xn){var z=L.stateNode,q=Bg(v);au(v,q,z);break}case 5:var he=L.stateNode;L.flags&32&&(BS(he),L.flags&=-33);var Te=Bg(v);au(v,Te,he);break;case 3:case 4:var Je=L.stateNode.containerInfo,Et=Bg(v);lS(v,Et,Je);break;default:throw Error(r(161))}}}catch(Ut){On(v,v.return,Ut)}v.flags&=-3}S&4096&&(v.flags&=-4097)}function GM(v){if(v.subtreeFlags&1024)for(v=v.child;v!==null;){var S=v;GM(S),S.tag===5&&S.flags&1024&&Cy(S.stateNode),v=v.sibling}}function lu(v,S){if(S.subtreeFlags&8772)for(S=S.child;S!==null;)hy(v,S.alternate,S),S=S.sibling}function _p(v){for(v=v.child;v!==null;){var S=v;switch(S.tag){case 0:case 11:case 14:case 15:dh(4,S,S.return),_p(S);break;case 1:$a(S,S.return);var C=S.stateNode;typeof C.componentWillUnmount=="function"&&Za(S,S.return,C),_p(S);break;case 26:case 27:case 5:$a(S,S.return),_p(S);break;case 22:$a(S,S.return),S.memoizedState===null&&_p(S);break;default:_p(S)}v=v.sibling}}function cu(v,S,C){for(C=C&&(S.subtreeFlags&8772)!==0,S=S.child;S!==null;){var L=S.alternate,z=v,q=S,he=q.flags;switch(q.tag){case 0:case 11:case 15:cu(z,q,C),Og(4,q);break;case 1:if(cu(z,q,C),L=q,z=L.stateNode,typeof z.componentDidMount=="function")try{z.componentDidMount()}catch(Et){On(L,L.return,Et)}if(L=q,z=L.updateQueue,z!==null){var Te=L.stateNode;try{var Je=z.shared.hiddenCallbacks;if(Je!==null)for(z.shared.hiddenCallbacks=null,z=0;z<Je.length;z++)ie(Je[z],Te)}catch(Et){On(L,L.return,Et)}}C&&he&64&&VM(q),Il(q,q.return);break;case 26:case 27:case 5:cu(z,q,C),C&&L===null&&he&4&&sS(q),Il(q,q.return);break;case 12:cu(z,q,C);break;case 13:cu(z,q,C),C&&he&4&&dy(z,q);break;case 22:q.memoizedState===null&&cu(z,q,C),Il(q,q.return);break;default:cu(z,q,C)}S=S.sibling}}function fy(v,S){var C=null;v!==null&&v.memoizedState!==null&&v.memoizedState.cachePool!==null&&(C=v.memoizedState.cachePool.pool),v=null,S.memoizedState!==null&&S.memoizedState.cachePool!==null&&(v=S.memoizedState.cachePool.pool),v!==C&&(v!=null&&v.refCount++,C!=null&&Rg(C))}function Lg(v,S){v=null,S.alternate!==null&&(v=S.alternate.memoizedState.cache),S=S.memoizedState.cache,S!==v&&(S.refCount++,v!=null&&Rg(v))}function ys(v,S,C,L){if(S.subtreeFlags&10256)for(S=S.child;S!==null;)hS(v,S,C,L),S=S.sibling}function hS(v,S,C,L){var z=S.flags;switch(S.tag){case 0:case 11:case 15:ys(v,S,C,L),z&2048&&Og(9,S);break;case 3:ys(v,S,C,L),z&2048&&(v=null,S.alternate!==null&&(v=S.alternate.memoizedState.cache),S=S.memoizedState.cache,S!==v&&(S.refCount++,v!=null&&Rg(v)));break;case 12:if(z&2048){ys(v,S,C,L),v=S.stateNode;try{var q=S.memoizedProps,he=q.id,Te=q.onPostCommit;typeof Te=="function"&&Te(he,S.alternate===null?"mount":"update",v.passiveEffectDuration,-0)}catch(Je){On(S,S.return,Je)}}else ys(v,S,C,L);break;case 23:break;case 22:q=S.stateNode,S.memoizedState!==null?q._visibility&4?ys(v,S,C,L):na(v,S):q._visibility&4?ys(v,S,C,L):(q._visibility|=4,Ns(v,S,C,L,(S.subtreeFlags&10256)!==0)),z&2048&&fy(S.alternate,S);break;case 24:ys(v,S,C,L),z&2048&&Lg(S.alternate,S);break;default:ys(v,S,C,L)}}function Ns(v,S,C,L,z){for(z=z&&(S.subtreeFlags&10256)!==0,S=S.child;S!==null;){var q=v,he=S,Te=C,Je=L,Et=he.flags;switch(he.tag){case 0:case 11:case 15:Ns(q,he,Te,Je,z),Og(8,he);break;case 23:break;case 22:var Ut=he.stateNode;he.memoizedState!==null?Ut._visibility&4?Ns(q,he,Te,Je,z):na(q,he):(Ut._visibility|=4,Ns(q,he,Te,Je,z)),z&&Et&2048&&fy(he.alternate,he);break;case 24:Ns(q,he,Te,Je,z),z&&Et&2048&&Lg(he.alternate,he);break;default:Ns(q,he,Te,Je,z)}S=S.sibling}}function na(v,S){if(S.subtreeFlags&10256)for(S=S.child;S!==null;){var C=v,L=S,z=L.flags;switch(L.tag){case 22:na(C,L),z&2048&&fy(L.alternate,L);break;case 24:na(C,L),z&2048&&Lg(L.alternate,L);break;default:na(C,L)}S=S.sibling}}function sl(v){if(v.subtreeFlags&Io)for(v=v.child;v!==null;)py(v),v=v.sibling}function py(v){switch(v.tag){case 26:sl(v),v.flags&Io&&(v.memoizedState!==null?ME(Sr,v.memoizedState,v.memoizedProps):Ra(v.type,v.memoizedProps));break;case 5:sl(v),v.flags&Io&&Ra(v.type,v.memoizedProps);break;case 3:case 4:if(To){var S=Sr;Sr=Ly(v.stateNode.containerInfo),sl(v),Sr=S}else sl(v);break;case 22:v.memoizedState===null&&(S=v.alternate,S!==null&&S.memoizedState!==null?(S=Io,Io=16777216,sl(v),Io=S):sl(v));break;default:sl(v)}}function Ug(v){var S=v.alternate;if(S!==null&&(v=S.child,v!==null)){S.child=null;do S=v.sibling,v.sibling=null,v=S;while(v!==null)}}function ph(v){var S=v.deletions;if((v.flags&16)!==0){if(S!==null)for(var C=0;C<S.length;C++){var L=S[C];Fi=L,dS(L,v)}Ug(v)}if(v.subtreeFlags&10256)for(v=v.child;v!==null;)my(v),v=v.sibling}function my(v){switch(v.tag){case 0:case 11:case 15:ph(v),v.flags&2048&&dh(9,v,v.return);break;case 3:ph(v);break;case 12:ph(v);break;case 22:var S=v.stateNode;v.memoizedState!==null&&S._visibility&4&&(v.return===null||v.return.tag!==13)?(S._visibility&=-5,uu(v)):ph(v);break;default:ph(v)}}function uu(v){var S=v.deletions;if((v.flags&16)!==0){if(S!==null)for(var C=0;C<S.length;C++){var L=S[C];Fi=L,dS(L,v)}Ug(v)}for(v=v.child;v!==null;){switch(S=v,S.tag){case 0:case 11:case 15:dh(8,S,S.return),uu(S);break;case 22:C=S.stateNode,C._visibility&4&&(C._visibility&=-5,uu(S));break;default:uu(S)}v=v.sibling}}function dS(v,S){for(;Fi!==null;){var C=Fi;switch(C.tag){case 0:case 11:case 15:dh(8,C,S);break;case 23:case 22:if(C.memoizedState!==null&&C.memoizedState.cachePool!==null){var L=C.memoizedState.cachePool.pool;L!=null&&L.refCount++}break;case 24:Rg(C.memoizedState.cache)}if(L=C.child,L!==null)L.return=C,Fi=L;else e:for(C=v;Fi!==null;){L=Fi;var z=L.sibling,q=L.return;if(cS(L),L===C){Fi=null;break e}if(z!==null){z.return=q,Fi=z;break e}Fi=q}}}function Ap(v){var S=YM(v);if(S!=null){if(typeof S.memoizedProps["data-testname"]!="string")throw Error(r(364));return S}if(v=DS(v),v===null)throw Error(r(362));return v.stateNode.current}function mh(v,S){var C=v.tag;switch(S.$$typeof){case qp:if(v.type===S.value)return!0;break;case ml:e:{for(S=S.value,v=[v,0],C=0;C<v.length;){var L=v[C++],z=L.tag,q=v[C++],he=S[q];if(z!==5&&z!==26&&z!==27||!Lp(L)){for(;he!=null&&mh(L,he);)q++,he=S[q];if(q===S.length){S=!0;break e}else for(L=L.child;L!==null;)v.push(L,q),L=L.sibling}}S=!1}return S;case ur:if((C===5||C===26||C===27)&&ZM(v.stateNode,S.value))return!0;break;case xc:if((C===5||C===6||C===26||C===27)&&(v=JM(v),v!==null&&0<=v.indexOf(S.value)))return!0;break;case jl:if((C===5||C===26||C===27)&&(v=v.memoizedProps["data-testname"],typeof v=="string"&&v.toLowerCase()===S.value.toLowerCase()))return!0;break;default:throw Error(r(365))}return!1}function fS(v){switch(v.$$typeof){case qp:return"<"+(a(v.value)||"Unknown")+">";case ml:return":has("+(fS(v)||"")+")";case ur:return'[role="'+v.value+'"]';case xc:return'"'+v.value+'"';case jl:return'[data-testname="'+v.value+'"]';default:throw Error(r(365))}}function to(v,S){var C=[];v=[v,0];for(var L=0;L<v.length;){var z=v[L++],q=z.tag,he=v[L++],Te=S[he];if(q!==5&&q!==26&&q!==27||!Lp(z)){for(;Te!=null&&mh(z,Te);)he++,Te=S[he];if(he===S.length)C.push(z);else for(z=z.child;z!==null;)v.push(z,he),z=z.sibling}}return C}function Ng(v,S){if(!wh)throw Error(r(363));v=Ap(v),v=to(v,S),S=[],v=Array.from(v);for(var C=0;C<v.length;){var L=v[C++],z=L.tag;if(z===5||z===26||z===27)Lp(L)||S.push(L.stateNode);else for(L=L.child;L!==null;)v.push(L),L=L.sibling}return S}function Or(){if((xn&2)!==0&&on!==0)return on&-on;if(Bi.T!==null){var v=Ro;return v!==0?v:Re()}return QM()}function pS(){No===0&&(No=(on&536870912)===0||pn?R():536870912);var v=Po.current;return v!==null&&(v.flags|=32),No}function xs(v,S,C){(v===In&&Hn===2||v.cancelPendingCommit!==null)&&(zs(v,0),io(v,on,No,!1)),U(v,C),((xn&2)===0||v!==In)&&(v===In&&((xn&2)===0&&(wu|=C),Qn===4&&io(v,on,No,!1)),$e(v))}function gh(v,S,C){if((xn&6)!==0)throw Error(r(327));var L=!C&&(S&60)===0&&(S&v.expiredLanes)===0||T(v,S),z=L?gS(v,S):vy(v,S,!0),q=L;do{if(z===0){Lo&&!L&&io(v,S,0,!1);break}else if(z===6)io(v,S,0,!vl);else{if(C=v.current.alternate,q&&!wp(C)){z=vy(v,S,!1),q=!1;continue}if(z===2){if(q=S,v.errorRecoveryDisabledLanes&q)var he=0;else he=v.pendingLanes&-536870913,he=he!==0?he:he&536870912?536870912:0;if(he!==0){S=he;e:{var Te=v;z=Zd;var Je=Fs&&Te.current.memoizedState.isDehydrated;if(Je&&(zs(Te,he).flags|=256),he=vy(Te,he,!1),he!==2){if(ss&&!Je){Te.errorRecoveryDisabledLanes|=q,wu|=q,z=4;break e}q=Tr,Tr=z,q!==null&&zg(q)}z=he}if(q=!1,z!==2)continue}}if(z===1){zs(v,0),io(v,S,0,!0);break}e:{switch(L=v,z){case 0:case 1:throw Error(r(345));case 4:if((S&4194176)===S){io(L,S,No,!vl);break e}break;case 2:Tr=null;break;case 3:case 5:break;default:throw Error(r(329))}if(L.finishedWork=C,L.finishedLanes=S,(S&62914560)===S&&(q=Ba+300-hl(),10<q)){if(io(L,S,No,!vl),D(L,0)!==0)break e;L.timeoutHandle=Xr(gy.bind(null,L,C,Tr,ov,Xy,S,No,wu,bc,vl,2,-0,0),q);break e}gy(L,C,Tr,ov,Xy,S,No,wu,bc,vl,0,-0,0)}}break}while(!0);$e(v)}function zg(v){Tr===null?Tr=v:Tr.push.apply(Tr,v)}function gy(v,S,C,L,z,q,he,Te,Je,Et,Ut,Wt,Yt){var Vi=S.subtreeFlags;if((Vi&8192||(Vi&16785408)===16785408)&&(TS(),py(S),S=qr(),S!==null)){v.cancelPendingCommit=S(yh.bind(null,v,C,L,z,he,Te,Je,1,Wt,Yt)),io(v,q,he,!Et);return}yh(v,C,L,z,he,Te,Je,Ut,Wt,Yt)}function wp(v){for(var S=v;;){var C=S.tag;if((C===0||C===11||C===15)&&S.flags&16384&&(C=S.updateQueue,C!==null&&(C=C.stores,C!==null)))for(var L=0;L<C.length;L++){var z=C[L],q=z.getSnapshot;z=z.value;try{if(!ro(q(),z))return!1}catch{return!1}}if(C=S.child,S.subtreeFlags&16384&&C!==null)C.return=S,S=C;else{if(S===v)break;for(;S.sibling===null;){if(S.return===null||S.return===v)return!0;S=S.return}S.sibling.return=S.return,S=S.sibling}}return!0}function io(v,S,C,L){S&=~av,S&=~wu,v.suspendedLanes|=S,v.pingedLanes&=~S,L&&(v.warmLanes|=S),L=v.expirationTimes;for(var z=S;0<z;){var q=31-Pa(z),he=1<<q;L[q]=-1,z&=~he}C!==0&&V(v,C,S)}function Fg(){return(xn&6)===0?(gt(0),!1):!0}function Mp(){if(Ai!==null){if(Hn===0)var v=Ai.return;else v=Ai,Bo=kl=null,li(v),Rh=null,Ph=0,v=Ai;for(;v!==null;)FM(v.alternate,v),v=v.return;Ai=null}}function zs(v,S){v.finishedWork=null,v.finishedLanes=0;var C=v.timeoutHandle;C!==_h&&(v.timeoutHandle=_h,Ey(C)),C=v.cancelPendingCommit,C!==null&&(v.cancelPendingCommit=null,C()),Mp(),In=v,Ai=C=ol(v.current,null),on=S,Hn=0,sa=null,vl=!1,Lo=T(v,S),ss=!1,bc=No=av=wu=Uo=Qn=0,Tr=Zd=null,Xy=!1,(S&8)!==0&&(S|=S&32);var L=v.entangledLanes;if(L!==0)for(v=v.entanglements,L&=S;0<L;){var z=31-Pa(L),q=1<<z;S|=v[z],L&=~q}return aa=S,ae(),C}function wo(v,S){Ji=null,Bi.H=Mr,S===kp?(S=It(),Hn=3):S===rv?(S=It(),Hn=4):Hn=S===jy?8:S!==null&&typeof S=="object"&&typeof S.then=="function"?6:1,sa=S,Ai===null&&(Qn=1,gp(v,ne(S,v.current)))}function vh(){var v=Po.current;return v===null?!0:(on&4194176)===on?qn===null:(on&62914560)===on||(on&536870912)!==0?v===qn:!1}function oc(){var v=Bi.H;return Bi.H=Mr,v===null?Mr:v}function lc(){var v=Bi.A;return Bi.A=Xp,v}function hu(){Qn=4,vl||(on&4194176)!==on&&Po.current!==null||(Lo=!0),(Uo&134217727)===0&&(wu&134217727)===0||In===null||io(In,on,No,!1)}function vy(v,S,C){var L=xn;xn|=2;var z=oc(),q=lc();(In!==v||on!==S)&&(ov=null,zs(v,S)),S=!1;var he=Qn;e:do try{if(Hn!==0&&Ai!==null){var Te=Ai,Je=sa;switch(Hn){case 8:Mp(),he=6;break e;case 3:case 2:case 6:Po.current===null&&(S=!0);var Et=Hn;if(Hn=0,sa=null,al(v,Te,Je,Et),C&&Lo){he=0;break e}break;default:Et=Hn,Hn=0,sa=null,al(v,Te,Je,Et)}}mS(),he=Qn;break}catch(Ut){wo(v,Ut)}while(!0);return S&&v.shellSuspendCounter++,Bo=kl=null,xn=L,Bi.H=z,Bi.A=q,Ai===null&&(In=null,on=0,ae()),he}function mS(){for(;Ai!==null;)br(Ai)}function gS(v,S){var C=xn;xn|=2;var L=oc(),z=lc();In!==v||on!==S?(ov=null,Yp=hl()+500,zs(v,S)):Lo=T(v,S);e:do try{if(Hn!==0&&Ai!==null){S=Ai;var q=sa;t:switch(Hn){case 1:Hn=0,sa=null,al(v,S,q,1);break;case 2:if(at(q)){Hn=0,sa=null,wn(S);break}S=function(){Hn===2&&In===v&&(Hn=7),$e(v)},q.then(S,S);break e;case 3:Hn=7;break e;case 4:Hn=5;break e;case 7:at(q)?(Hn=0,sa=null,wn(S)):(Hn=0,sa=null,al(v,S,q,7));break;case 5:var he=null;switch(Ai.tag){case 26:he=Ai.memoizedState;case 5:case 27:var Te=Ai,Je=Te.type,Et=Te.pendingProps;if(he?zd(he):Ty(Je,Et)){Hn=0,sa=null;var Ut=Te.sibling;if(Ut!==null)Ai=Ut;else{var Wt=Te.return;Wt!==null?(Ai=Wt,Mo(Wt)):Ai=null}break t}}Hn=0,sa=null,al(v,S,q,5);break;case 6:Hn=0,sa=null,al(v,S,q,6);break;case 8:Mp(),Qn=6;break e;default:throw Error(r(462))}}Ca();break}catch(Yt){wo(v,Yt)}while(!0);return Bo=kl=null,Bi.H=L,Bi.A=z,xn=C,Ai!==null?0:(In=null,on=0,ae(),Qn)}function Ca(){for(;Ai!==null&&!DE();)br(Ai)}function br(v){var S=UM(v.alternate,v,aa);v.memoizedProps=v.pendingProps,S===null?Mo(v):Ai=S}function wn(v){var S=v,C=S.alternate;switch(S.tag){case 15:case 0:S=RM(C,S,S.pendingProps,S.type,void 0,on);break;case 11:S=RM(C,S,S.pendingProps,S.type.render,S.ref,on);break;case 5:li(S);default:FM(C,S),S=Ai=Hg(S,aa),S=UM(C,S,aa)}v.memoizedProps=v.pendingProps,S===null?Mo(v):Ai=S}function al(v,S,C,L){Bo=kl=null,li(S),Rh=null,Ph=0;var z=S.return;try{if(gP(v,z,S,C,on)){Qn=1,gp(v,ne(C,v.current)),Ai=null;return}}catch(q){if(z!==null)throw Ai=z,q;Qn=1,gp(v,ne(C,v.current)),Ai=null;return}S.flags&32768?(pn||L===1?v=!0:Lo||(on&536870912)!==0?v=!1:(vl=v=!0,(L===2||L===3||L===6)&&(L=Po.current,L!==null&&L.tag===13&&(L.flags|=16384))),yy(S,v)):Mo(S)}function Mo(v){var S=v;do{if((S.flags&32768)!==0){yy(S,vl);return}v=S.return;var C=zM(S.alternate,S,aa);if(C!==null){Ai=C;return}if(S=S.sibling,S!==null){Ai=S;return}Ai=S=v}while(S!==null);Qn===0&&(Qn=5)}function yy(v,S){do{var C=yP(v.alternate,v);if(C!==null){C.flags&=32767,Ai=C;return}if(C=v.return,C!==null&&(C.flags|=32768,C.subtreeFlags=0,C.deletions=null),!S&&(v=v.sibling,v!==null)){Ai=v;return}Ai=v=C}while(v!==null);Qn=6,Ai=null}function yh(v,S,C,L,z,q,he,Te,Je,Et){var Ut=Bi.T,Wt=vu();try{ra(2),Bi.T=null,kM(v,S,C,L,Wt,z,q,he,Te,Je,Et)}finally{Bi.T=Ut,ra(Wt)}}function kM(v,S,C,L,z,q,he,Te){do Ll();while(Sc!==null);if((xn&6)!==0)throw Error(r(327));var Je=v.finishedWork;if(L=v.finishedLanes,Je===null)return null;if(v.finishedWork=null,v.finishedLanes=0,Je===v.current)throw Error(r(177));v.callbackNode=null,v.callbackPriority=0,v.cancelPendingCommit=null;var Et=Je.lanes|Je.childLanes;if(Et|=Hl,H(v,L,Et,q,he,Te),v===In&&(Ai=In=null,on=0),(Je.subtreeFlags&10256)===0&&(Je.flags&10256)===0||Wl||(Wl=!0,Uh=Et,qy=C,fu(Vy,function(){return Ll(),null})),C=(Je.flags&15990)!==0,(Je.subtreeFlags&15990)!==0||C?(C=Bi.T,Bi.T=null,q=vu(),ra(2),he=xn,xn|=4,Ig(v,Je),uS(Je,v),qM(v.containerInfo),v.current=Je,hy(v,Je.alternate,Je),zy(),xn=he,ra(q),Bi.T=C):v.current=Je,Wl?(Wl=!1,Sc=v,$d=L):vS(v,Et),Et=v.pendingLanes,Et===0&&(Lh=null),F(Je.stateNode),$e(v),S!==null)for(z=v.onRecoverableError,Je=0;Je<S.length;Je++)Et=S[Je],z(Et.value,{componentStack:Et.stack});return($d&3)!==0&&Ll(),Et=v.pendingLanes,(L&4194218)!==0&&(Et&42)!==0?v===Yy?Qp++:(Qp=0,Yy=v):Qp=0,gt(0),null}function vS(v,S){(v.pooledCacheLanes&=S)===0&&(S=v.pooledCache,S!=null&&(v.pooledCache=null,Rg(S)))}function Ll(){if(Sc!==null){var v=Sc,S=Uh;Uh=0;var C=J($d),L=32>C?32:C;C=Bi.T;var z=vu();try{if(ra(L),Bi.T=null,Sc===null)var q=!1;else{L=qy,qy=null;var he=Sc,Te=$d;if(Sc=null,$d=0,(xn&6)!==0)throw Error(r(331));var Je=xn;if(xn|=4,my(he.current),hS(he,he.current,Te,L),xn=Je,gt(0,!1),no&&typeof no.onPostCommitFiberRoot=="function")try{no.onPostCommitFiberRoot(Lr,he)}catch{}q=!0}return q}finally{ra(z),Bi.T=C,vS(v,S)}}return!1}function Ep(v,S,C){S=ne(C,S),S=yp(v.stateNode,S,2),v=xt(v,S,2),v!==null&&(U(v,2),$e(v))}function On(v,S,C){if(v.tag===3)Ep(v,v,C);else for(;S!==null;){if(S.tag===3){Ep(S,v,C);break}else if(S.tag===1){var L=S.stateNode;if(typeof S.type.getDerivedStateFromError=="function"||typeof L.componentDidCatch=="function"&&(Lh===null||!Lh.has(L))){v=ne(C,v),C=Kb(2),L=xt(S,C,2),L!==null&&(MM(C,L,S,v),U(L,2),$e(L));break}}S=S.return}}function Ld(v,S,C){var L=v.pingCache;if(L===null){L=v.pingCache=new gl;var z=new Set;L.set(S,z)}else z=L.get(S),z===void 0&&(z=new Set,L.set(S,z));z.has(C)||(ss=!0,z.add(C),v=yS.bind(null,v,S,C),S.then(v,v))}function yS(v,S,C){var L=v.pingCache;L!==null&&L.delete(S),v.pingedLanes|=v.suspendedLanes&C,v.warmLanes&=~C,In===v&&(on&C)===C&&(Qn===4||Qn===3&&(on&62914560)===on&&300>hl()-Ba?(xn&2)===0&&zs(v,0):av|=C,bc===on&&(bc=0)),$e(v)}function xh(v,S){S===0&&(S=O()),v=je(v,S),v!==null&&(U(v,S),$e(v))}function du(v){var S=v.memoizedState,C=0;S!==null&&(C=S.retryLane),xh(v,C)}function bh(v,S){var C=0;switch(v.tag){case 13:var L=v.stateNode,z=v.memoizedState;z!==null&&(C=z.retryLane);break;case 19:L=v.stateNode;break;case 22:L=v.stateNode._retryCache;break;default:throw Error(r(314))}L!==null&&L.delete(S),xh(v,C)}function fu(v,S){return tv(v,S)}function xS(v,S,C,L){this.tag=v,this.key=C,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=S,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=L,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Vg(v){return v=v.prototype,!(!v||!v.isReactComponent)}function ol(v,S){var C=v.alternate;return C===null?(C=i(v.tag,S,v.key,v.mode),C.elementType=v.elementType,C.type=v.type,C.stateNode=v.stateNode,C.alternate=v,v.alternate=C):(C.pendingProps=S,C.type=v.type,C.flags=0,C.subtreeFlags=0,C.deletions=null),C.flags=v.flags&31457280,C.childLanes=v.childLanes,C.lanes=v.lanes,C.child=v.child,C.memoizedProps=v.memoizedProps,C.memoizedState=v.memoizedState,C.updateQueue=v.updateQueue,S=v.dependencies,C.dependencies=S===null?null:{lanes:S.lanes,firstContext:S.firstContext},C.sibling=v.sibling,C.index=v.index,C.ref=v.ref,C.refCleanup=v.refCleanup,C}function Hg(v,S){v.flags&=31457282;var C=v.alternate;return C===null?(v.childLanes=0,v.lanes=S,v.child=null,v.subtreeFlags=0,v.memoizedProps=null,v.memoizedState=null,v.updateQueue=null,v.dependencies=null,v.stateNode=null):(v.childLanes=C.childLanes,v.lanes=C.lanes,v.child=C.child,v.subtreeFlags=0,v.deletions=null,v.memoizedProps=C.memoizedProps,v.memoizedState=C.memoizedState,v.updateQueue=C.updateQueue,v.type=C.type,S=C.dependencies,v.dependencies=S===null?null:{lanes:S.lanes,firstContext:S.firstContext}),v}function cc(v,S,C,L,z,q){var he=0;if(L=v,typeof v=="function")Vg(v)&&(he=1);else if(typeof v=="string")he=To&&Xn?Zg(v,C,ns.current)?26:hc(v)?27:5:To?Zg(v,C,ns.current)?26:5:Xn&&hc(v)?27:5;else e:switch(v){case Sh:return wr(C.children,z,q,S);case Wg:he=8,z|=24;break;case _y:return v=i(12,C,S,z|2),v.elementType=_y,v.lanes=q,v;case Ay:return v=i(13,C,S,z),v.elementType=Ay,v.lanes=q,v;case Rp:return v=i(19,C,S,z),v.elementType=Rp,v.lanes=q,v;case _S:return Gg(C,z,q,S);default:if(typeof v=="object"&&v!==null)switch(v.$$typeof){case Xg:case Ul:he=10;break e;case SS:he=9;break e;case qg:he=11;break e;case wy:he=14;break e;case cl:he=16,L=null;break e}he=29,C=Error(r(130,v===null?"null":typeof v,"")),L=null}return S=i(he,C,S,z),S.elementType=v,S.type=L,S.lanes=q,S}function wr(v,S,C,L){return v=i(7,v,L,S),v.lanes=C,v}function Gg(v,S,C,L){v=i(22,v,L,S),v.elementType=_S,v.lanes=C;var z={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var q=z._current;if(q===null)throw Error(r(456));if((z._pendingVisibility&2)===0){var he=je(q,2);he!==null&&(z._pendingVisibility|=2,xs(he,q,2))}},attach:function(){var q=z._current;if(q===null)throw Error(r(456));if((z._pendingVisibility&2)!==0){var he=je(q,2);he!==null&&(z._pendingVisibility&=-3,xs(he,q,2))}}};return v.stateNode=z,v}function xy(v,S,C){return v=i(6,v,null,S),v.lanes=C,v}function bS(v,S,C){return S=i(4,v.children!==null?v.children:[],v.key,S),S.lanes=C,S.stateNode={containerInfo:v.containerInfo,pendingChildren:null,implementation:v.implementation},S}function xP(v,S,C,L,z,q,he,Te){this.tag=1,this.containerInfo=v,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=_h,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=P(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=P(0),this.hiddenUpdates=P(null),this.identifierPrefix=L,this.onUncaughtError=z,this.onCaughtError=q,this.onRecoverableError=he,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Te,this.incompleteTransitions=new Map}function jM(v,S,C,L,z,q,he,Te,Je,Et,Ut,Wt){return v=new xP(v,S,C,he,Te,Je,Et,Wt),S=1,q===!0&&(S|=24),q=i(3,null,null,S),v.current=q,q.stateNode=v,S=hh(),S.refCount++,v.pooledCache=S,S.refCount++,q.memoizedState={element:L,isDehydrated:C,cache:S},bt(q),v}function Wr(v){return v?(v=Th,v):Th}function by(v){var S=v._reactInternals;if(S===void 0)throw typeof v.render=="function"?Error(r(188)):(v=Object.keys(v).join(","),Error(r(268,v)));return v=p(S),v=v!==null?g(v):null,v===null?null:Bp(v.stateNode)}function Tp(v,S,C,L,z,q){z=Wr(z),L.context===null?L.context=z:L.pendingContext=z,L=Xe(S),L.payload={element:C},q=q===void 0?null:q,q!==null&&(L.callback=q),C=xt(v,L,S),C!==null&&(xs(C,v,S),_t(C,v,S))}function Cp(v,S){if(v=v.memoizedState,v!==null&&v.dehydrated!==null){var C=v.retryLane;v.retryLane=C!==0&&C<S?C:S}}function kg(v,S){Cp(v,S),(v=v.alternate)&&Cp(v,S)}var ji={},Dp=og(),Eo=zfe(),Sy=Object.assign,bP=Symbol.for("react.element"),jg=Symbol.for("react.transitional.element"),ll=Symbol.for("react.portal"),Sh=Symbol.for("react.fragment"),Wg=Symbol.for("react.strict_mode"),_y=Symbol.for("react.profiler"),Xg=Symbol.for("react.provider"),SS=Symbol.for("react.consumer"),Ul=Symbol.for("react.context"),qg=Symbol.for("react.forward_ref"),Ay=Symbol.for("react.suspense"),Rp=Symbol.for("react.suspense_list"),wy=Symbol.for("react.memo"),cl=Symbol.for("react.lazy"),_S=Symbol.for("react.offscreen"),WM=Symbol.for("react.memo_cache_sentinel"),pu=Symbol.iterator,AS=Symbol.for("react.client.reference"),Bi=Dp.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,uc,mu,Ud=!1,Pp=Array.isArray,wS=t.rendererVersion,Yg=t.rendererPackageName,Op=t.extraDevToolsConfig,Bp=t.getPublicInstance,XM=t.getRootHostContext,Ip=t.getChildHostContext,My=t.prepareForCommit,qM=t.resetAfterCommit,MS=t.createInstance,Qg=t.appendInitialChild,gu=t.finalizeInitialChildren,Wi=t.shouldSetTextContent,Nn=t.createTextInstance,Xr=t.scheduleTimeout,Ey=t.cancelTimeout,_h=t.noTimeout,Da=t.isPrimaryRenderer;t.warnsIfNotActing;var is=t.supportsMutation,ul=t.supportsPersistence,Fs=t.supportsHydration,YM=t.getInstanceFromNode;t.beforeActiveInstanceBlur,t.afterActiveInstanceBlur;var Br=t.preparePortalMount;t.prepareScopeUpdate,t.getInstanceFromScope;var ra=t.setCurrentUpdatePriority,vu=t.getCurrentUpdatePriority,QM=t.resolveUpdatePriority;t.resolveEventType,t.resolveEventTimeStamp;var KM=t.shouldAttemptEagerTransition,SP=t.detachDeletedInstance;t.requestPostPaintCallback;var ES=t.maySuspendCommit,Ty=t.preloadInstance,TS=t.startSuspendingCommit,Ra=t.suspendInstance,qr=t.waitForCommitToBeReady,Ah=t.NotPendingTransition,Nl=t.HostTransitionContext,Cy=t.resetFormInstance;t.bindToConsole;var CS=t.supportsMicrotasks,yu=t.scheduleMicrotask,wh=t.supportsTestSelectors,DS=t.findFiberRoot,RS=t.getBoundingRect,JM=t.getTextContent,Lp=t.isHiddenSubtree,ZM=t.matchAccessibilityRole,$M=t.setFocusIfFocusable,eE=t.setupIntersectionObserver,tE=t.appendChild,PS=t.appendChildToContainer,iE=t.commitTextUpdate,_P=t.commitMount,nE=t.commitUpdate,rE=t.insertBefore,sE=t.insertInContainerBefore,OS=t.removeChild,aE=t.removeChildFromContainer,BS=t.resetTextContent,oE=t.hideInstance,lE=t.hideTextInstance,cE=t.unhideInstance,AP=t.unhideTextInstance,uE=t.clearContainer,Up=t.cloneInstance,Kg=t.createContainerChildSet,IS=t.appendChildToContainerChildSet,Dy=t.finalizeContainerChildren,Np=t.replaceContainerChildren,LS=t.cloneHiddenInstance,US=t.cloneHiddenTextInstance,Ry=t.isSuspenseInstancePending,Py=t.isSuspenseInstanceFallback,hE=t.getSuspenseInstanceFallbackErrorDetails,dE=t.registerSuspenseInstanceRetry,NS=t.canHydrateFormStateMarker,fE=t.isFormStateMarkerMatching,zS=t.getNextHydratableSibling,Oy=t.getFirstHydratableChild,pE=t.getFirstHydratableChildWithinContainer,mE=t.getFirstHydratableChildWithinSuspenseInstance,wP=t.canHydrateInstance,FS=t.canHydrateTextInstance,gE=t.canHydrateSuspenseInstance,vE=t.hydrateInstance,VS=t.hydrateTextInstance,yE=t.hydrateSuspenseInstance,xE=t.getNextHydratableInstanceAfterSuspenseInstance,MP=t.commitHydratedContainer,EP=t.commitHydratedSuspenseInstance,bE=t.clearSuspenseBoundary,Jg=t.clearSuspenseBoundaryFromContainer,By=t.shouldDeleteUnhydratedTailInstances;t.diffHydratedPropsForDevWarnings,t.diffHydratedTextForDevWarnings,t.describeHydratableInstanceForDevWarnings;var Iy=t.validateHydratableInstance,SE=t.validateHydratableTextInstance,To=t.supportsResources,Zg=t.isHostHoistableType,Ly=t.getHoistableRoot,HS=t.getResource,_E=t.acquireResource,Nd=t.releaseResource,$g=t.hydrateHoistable,ev=t.mountHoistable,zp=t.unmountHoistable,Uy=t.createHoistableInstance,AE=t.prepareToCommitHoistables,wE=t.mayResourceSuspendCommit,zd=t.preloadResource,ME=t.suspendResource,Xn=t.supportsSingletons,zl=t.resolveSingletonInstance,Mh=t.clearSingleton,EE=t.acquireSingletonInstance,Eh=t.releaseSingletonInstance,hc=t.isHostSingletonType,Ir=[],xu=-1,Th={},Pa=Math.clz32?Math.clz32:w,TE=Math.log,CE=Math.LN2,dc=128,Fd=4194304,tv=Eo.unstable_scheduleCallback,Ny=Eo.unstable_cancelCallback,DE=Eo.unstable_shouldYield,zy=Eo.unstable_requestPaint,hl=Eo.unstable_now,Fy=Eo.unstable_ImmediatePriority,RE=Eo.unstable_UserBlockingPriority,Vy=Eo.unstable_NormalPriority,TP=Eo.unstable_IdlePriority,PE=Eo.log,bs=Eo.unstable_setDisableYieldValue,Lr=null,no=null,ro=typeof Object.is=="function"?Object.is:W,GS=new WeakMap,Vd=[],Hd=0,Gd=null,Fp=0,Co=[],Do=0,Ch=null,Fl=1,Vl="",ns=y(null),Vp=y(null),fc=y(null),kd=y(null),Vs=null,Hs=null,pn=!1,dl=null,Ss=!1,iv=Error(r(519)),fl=[],jd=0,Hl=0,nv=null,bu=null,Wd=!1,ir=!1,kS=!1,Hp=0,Gp=null,Xd=0,Ro=0,qd=null,Su=!1,Yd=!1,pc=Object.prototype.hasOwnProperty,kp=Error(r(460)),rv=Error(r(474)),sv={then:function(){}},Dh=null,Rh=null,Ph=0,Oh=$i(!0),mc=$i(!1),nr=y(null),jp=y(0),Po=y(null),qn=null,rs=y(0),_u=0,Ji=null,bi=null,yn=null,pl=!1,Qd=!1,Bh=!1,Hy=0,Kd=0,_s=null,Gl=0,Gy=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}},Mr={readContext:Ls,use:Ze,useCallback:ot,useContext:ot,useEffect:ot,useImperativeHandle:ot,useLayoutEffect:ot,useInsertionEffect:ot,useMemo:ot,useReducer:ot,useRef:ot,useState:ot,useDebugValue:ot,useDeferredValue:ot,useTransition:ot,useSyncExternalStore:ot,useId:ot};Mr.useCacheRefresh=ot,Mr.useMemoCache=ot,Mr.useHostTransitionStatus=ot,Mr.useFormState=ot,Mr.useActionState=ot,Mr.useOptimistic=ot;var Ih={readContext:Ls,use:Ze,useCallback:function(v,S){return oe().memoizedState=[v,S===void 0?null:S],v},useContext:Ls,useEffect:$0,useImperativeHandle:function(v,S,C){C=C!=null?C.concat([v]):null,yg(4194308,4,ey.bind(null,S,v),C)},useLayoutEffect:function(v,S){return yg(4194308,4,v,S)},useInsertionEffect:function(v,S){yg(4,2,v,S)},useMemo:function(v,S){var C=oe();S=S===void 0?null:S;var L=v();if(Bh){X(!0);try{v()}finally{X(!1)}}return C.memoizedState=[L,S],L},useReducer:function(v,S,C){var L=oe();if(C!==void 0){var z=C(S);if(Bh){X(!0);try{C(S)}finally{X(!1)}}}else z=S;return L.memoizedState=L.baseState=z,v={pending:null,lanes:0,dispatch:null,lastRenderedReducer:v,lastRenderedState:z},L.queue=v,v=v.dispatch=iy.bind(null,Ji,v),[L.memoizedState,v]},useRef:function(v){var S=oe();return v={current:v},S.memoizedState=v},useState:function(v){v=Pe(v);var S=v.queue,C=Qb.bind(null,Ji,S);return S.dispatch=C,[v.memoizedState,C]},useDebugValue:ah,useDeferredValue:function(v,S){var C=oe();return Sg(C,v,S)},useTransition:function(){var v=Pe(!1);return v=hp.bind(null,Ji,v.queue,!0,!1),oe().memoizedState=v,[!1,v]},useSyncExternalStore:function(v,S,C){var L=Ji,z=oe();if(pn){if(C===void 0)throw Error(r(407));C=C()}else{if(C=S(),In===null)throw Error(r(349));(on&60)!==0||$t(L,S,C)}z.memoizedState=C;var q={value:C,getSnapshot:S};return z.queue=q,$0(re.bind(null,L,q,v),[v]),L.flags|=2048,Ma(9,Z.bind(null,L,q,C,S),{destroy:void 0},null),C},useId:function(){var v=oe(),S=In.identifierPrefix;if(pn){var C=Vl,L=Fl;C=(L&~(1<<32-Pa(L)-1)).toString(32)+C,S=":"+S+"R"+C,C=Hy++,0<C&&(S+="H"+C.toString(32)),S+=":"}else C=Gl++,S=":"+S+"r"+C.toString(32)+":";return v.memoizedState=S},useCacheRefresh:function(){return oe().memoizedState=Yb.bind(null,Ji)}};Ih.useMemoCache=Ie,Ih.useHostTransitionStatus=_g,Ih.useFormState=Vn,Ih.useActionState=Vn,Ih.useOptimistic=function(v){var S=oe();S.memoizedState=S.baseState=v;var C={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return S.queue=C,S=fp.bind(null,Ji,!0,C),C.dispatch=S,[v,S]};var Oa={readContext:Ls,use:Ze,useCallback:Od,useContext:Ls,useEffect:Wb,useImperativeHandle:ty,useInsertionEffect:AM,useLayoutEffect:bg,useMemo:Xb,useReducer:wt,useRef:sc,useState:function(){return wt(Rt)},useDebugValue:ah,useDeferredValue:function(v,S){var C=Ue();return qb(C,bi.memoizedState,v,S)},useTransition:function(){var v=wt(Rt)[0],S=Ue().memoizedState;return[typeof v=="boolean"?v:nt(v),S]},useSyncExternalStore:ai,useId:dp};Oa.useCacheRefresh=iu,Oa.useMemoCache=Ie,Oa.useHostTransitionStatus=_g,Oa.useFormState=Bs,Oa.useActionState=Bs,Oa.useOptimistic=function(v,S){var C=Ue();return yt(C,bi,v,S)};var Oo={readContext:Ls,use:Ze,useCallback:Od,useContext:Ls,useEffect:Wb,useImperativeHandle:ty,useInsertionEffect:AM,useLayoutEffect:bg,useMemo:Xb,useReducer:Ht,useRef:sc,useState:function(){return Ht(Rt)},useDebugValue:ah,useDeferredValue:function(v,S){var C=Ue();return bi===null?Sg(C,v,S):qb(C,bi.memoizedState,v,S)},useTransition:function(){var v=Ht(Rt)[0],S=Ue().memoizedState;return[typeof v=="boolean"?v:nt(v),S]},useSyncExternalStore:ai,useId:dp};Oo.useCacheRefresh=iu,Oo.useMemoCache=Ie,Oo.useHostTransitionStatus=_g,Oo.useFormState=vs,Oo.useActionState=vs,Oo.useOptimistic=function(v,S){var C=Ue();return bi!==null?yt(C,bi,v,S):(C.baseState=v,[v,C.queue.dispatch])};var gc={isMounted:function(v){return(v=v._reactInternals)?h(v)===v:!1},enqueueSetState:function(v,S,C){v=v._reactInternals;var L=Or(),z=Xe(L);z.payload=S,C!=null&&(z.callback=C),S=xt(v,z,L),S!==null&&(xs(S,v,L),_t(S,v,L))},enqueueReplaceState:function(v,S,C){v=v._reactInternals;var L=Or(),z=Xe(L);z.tag=1,z.payload=S,C!=null&&(z.callback=C),S=xt(v,z,L),S!==null&&(xs(S,v,L),_t(S,v,L))},enqueueForceUpdate:function(v,S){v=v._reactInternals;var C=Or(),L=Xe(C);L.tag=2,S!=null&&(L.callback=S),S=xt(v,L,C),S!==null&&(xs(S,v,C),_t(S,v,C))}},ky=typeof reportError=="function"?reportError:function(v){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var S=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof v=="object"&&v!==null&&typeof v.message=="string"?String(v.message):String(v),error:v});if(!window.dispatchEvent(S))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",v);return}console.error(v)},jy=Error(r(461)),Yn=!1,Wy={dehydrated:null,treeContext:null,retryLane:0},Au=y(null),kl=null,Bo=null,Wp=typeof AbortController<"u"?AbortController:function(){var v=[],S=this.signal={aborted:!1,addEventListener:function(C,L){v.push(L)}};this.abort=function(){S.aborted=!0,v.forEach(function(C){return C()})}},OE=Eo.unstable_scheduleCallback,BE=Eo.unstable_NormalPriority,rr={$$typeof:Ul,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0},jS=Bi.S;Bi.S=function(v,S){typeof S=="object"&&S!==null&&typeof S.then=="function"&&Le(v,S),jS!==null&&jS(v,S)};var vc=y(null),yc=!1,Er=!1,WS=!1,Bn=typeof WeakSet=="function"?WeakSet:Set,Fi=null,sn=!1,pi=null,Qi=!1,Sr=null,Io=8192,Xp={getCacheForType:function(v){var S=Ls(rr),C=S.data.get(v);return C===void 0&&(C=v(),S.data.set(v,C)),C}},qp=0,ml=1,ur=2,jl=3,xc=4;if(typeof Symbol=="function"&&Symbol.for){var Jd=Symbol.for;qp=Jd("selector.component"),ml=Jd("selector.has_pseudo_class"),ur=Jd("selector.role"),jl=Jd("selector.test_id"),xc=Jd("selector.text")}var gl=typeof WeakMap=="function"?WeakMap:Map,xn=0,In=null,Ai=null,on=0,Hn=0,sa=null,vl=!1,Lo=!1,ss=!1,aa=0,Qn=0,Uo=0,wu=0,av=0,No=0,bc=0,Zd=null,Tr=null,Xy=!1,Ba=0,Yp=1/0,ov=null,Lh=null,Wl=!1,Sc=null,$d=0,Uh=0,qy=null,Qp=0,Yy=null;return ji.attemptContinuousHydration=function(v){if(v.tag===13){var S=je(v,67108864);S!==null&&xs(S,v,67108864),kg(v,67108864)}},ji.attemptHydrationAtCurrentPriority=function(v){if(v.tag===13){var S=Or(),C=je(v,S);C!==null&&xs(C,v,S),kg(v,S)}},ji.attemptSynchronousHydration=function(v){switch(v.tag){case 3:if(v=v.stateNode,v.current.memoizedState.isDehydrated){var S=E(v.pendingLanes);if(S!==0){for(v.pendingLanes|=2,v.entangledLanes|=2;S;){var C=1<<31-Pa(S);v.entanglements[1]|=C,S&=~C}$e(v),(xn&6)===0&&(Yp=hl()+500,gt(0))}}break;case 13:S=je(v,2),S!==null&&xs(S,v,2),Fg(),kg(v,2)}},ji.batchedUpdates=function(v,S){return v(S)},ji.createComponentSelector=function(v){return{$$typeof:qp,value:v}},ji.createContainer=function(v,S,C,L,z,q,he,Te,Je,Et){return jM(v,S,!1,null,C,L,q,he,Te,Je,Et,null)},ji.createHasPseudoClassSelector=function(v){return{$$typeof:ml,value:v}},ji.createHydrationContainer=function(v,S,C,L,z,q,he,Te,Je,Et,Ut,Wt,Yt){return v=jM(C,L,!0,v,z,q,Te,Je,Et,Ut,Wt,Yt),v.context=Wr(null),C=v.current,L=Or(),z=Xe(L),z.callback=S??null,xt(C,z,L),v.current.lanes=L,U(v,L),$e(v),v},ji.createPortal=function(v,S,C){var L=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ll,key:L==null?null:""+L,children:v,containerInfo:S,implementation:C}},ji.createRoleSelector=function(v){return{$$typeof:ur,value:v}},ji.createTestNameSelector=function(v){return{$$typeof:jl,value:v}},ji.createTextSelector=function(v){return{$$typeof:xc,value:v}},ji.defaultOnCaughtError=function(v){console.error(v)},ji.defaultOnRecoverableError=function(v){ky(v)},ji.defaultOnUncaughtError=function(v){ky(v)},ji.deferredUpdates=function(v){var S=Bi.T,C=vu();try{return ra(32),Bi.T=null,v()}finally{ra(C),Bi.T=S}},ji.discreteUpdates=function(v,S,C,L,z){var q=Bi.T,he=vu();try{return ra(2),Bi.T=null,v(S,C,L,z)}finally{ra(he),Bi.T=q,xn===0&&(Yp=hl()+500)}},ji.findAllNodes=Ng,ji.findBoundingRects=function(v,S){if(!wh)throw Error(r(363));S=Ng(v,S),v=[];for(var C=0;C<S.length;C++)v.push(RS(S[C]));for(S=v.length-1;0<S;S--){C=v[S];for(var L=C.x,z=L+C.width,q=C.y,he=q+C.height,Te=S-1;0<=Te;Te--)if(S!==Te){var Je=v[Te],Et=Je.x,Ut=Et+Je.width,Wt=Je.y,Yt=Wt+Je.height;if(L>=Et&&q>=Wt&&z<=Ut&&he<=Yt){v.splice(S,1);break}else if(L!==Et||C.width!==Je.width||Yt<q||Wt>he){if(!(q!==Wt||C.height!==Je.height||Ut<L||Et>z)){Et>L&&(Je.width+=Et-L,Je.x=L),Ut<z&&(Je.width=z-Et),v.splice(S,1);break}}else{Wt>q&&(Je.height+=Wt-q,Je.y=q),Yt<he&&(Je.height=he-Wt),v.splice(S,1);break}}}return v},ji.findHostInstance=by,ji.findHostInstanceWithNoPortals=function(v){return v=p(v),v=v!==null?x(v):null,v===null?null:Bp(v.stateNode)},ji.findHostInstanceWithWarning=function(v){return by(v)},ji.flushPassiveEffects=Ll,ji.flushSyncFromReconciler=function(v){var S=xn;xn|=1;var C=Bi.T,L=vu();try{if(ra(2),Bi.T=null,v)return v()}finally{ra(L),Bi.T=C,xn=S,(xn&6)===0&&gt(0)}},ji.flushSyncWork=Fg,ji.focusWithin=function(v,S){if(!wh)throw Error(r(363));for(v=Ap(v),S=to(v,S),S=Array.from(S),v=0;v<S.length;){var C=S[v++],L=C.tag;if(!Lp(C)){if((L===5||L===26||L===27)&&$M(C.stateNode))return!0;for(C=C.child;C!==null;)S.push(C),C=C.sibling}}return!1},ji.getFindAllNodesFailureDescription=function(v,S){if(!wh)throw Error(r(363));var C=0,L=[];v=[Ap(v),0];for(var z=0;z<v.length;){var q=v[z++],he=q.tag,Te=v[z++],Je=S[Te];if((he!==5&&he!==26&&he!==27||!Lp(q))&&(mh(q,Je)&&(L.push(fS(Je)),Te++,Te>C&&(C=Te)),Te<S.length))for(q=q.child;q!==null;)v.push(q,Te),q=q.sibling}if(C<S.length){for(v=[];C<S.length;C++)v.push(fS(S[C]));return`findAllNodes was able to match part of the selector:
  `+(L.join(" > ")+`

No matching component was found for:
  `)+v.join(" > ")}return null},ji.getPublicRootInstance=function(v){if(v=v.current,!v.child)return null;switch(v.child.tag){case 27:case 5:return Bp(v.child.stateNode);default:return v.child.stateNode}},ji.injectIntoDevTools=function(){var v={bundleType:0,version:wS,rendererPackageName:Yg,currentDispatcherRef:Bi,findFiberByHostInstance:YM,reconcilerVersion:"19.0.0"};if(Op!==null&&(v.rendererConfig=Op),typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")v=!1;else{var S=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(S.isDisabled||!S.supportsFiber)v=!0;else{try{Lr=S.inject(v),no=S}catch{}v=!!S.checkDCE}}return v},ji.isAlreadyRendering=function(){return!1},ji.observeVisibleRects=function(v,S,C,L){if(!wh)throw Error(r(363));v=Ng(v,S);var z=eE(v,C,L).disconnect;return{disconnect:function(){z()}}},ji.shouldError=function(){return null},ji.shouldSuspend=function(){return!1},ji.startHostTransition=function(v,S,C,L){if(v.tag!==5)throw Error(r(476));var z=ac(v).queue;hp(v,z,S,Ah,C===null?n:function(){var q=ac(v).next.queue;return oh(v,q,{},Or()),C(L)})},ji.updateContainer=function(v,S,C,L){var z=S.current,q=Or();return Tp(z,q,v,S,C,L),q},ji.updateContainerSync=function(v,S,C,L){return S.tag===0&&Ll(),Tp(S.current,2,v,S,C,L),2},ji},e.exports.default=e.exports,Object.defineProperty(e.exports,"__esModule",{value:!0})}(tB)),tB.exports}var ek;function Vfe(){return ek||(ek=1,eB.exports=Ffe()),eB.exports}var Hfe=Vfe();const Gfe=Uw(Hfe);var rB={exports:{}},sB={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tk;function kfe(){return tk||(tk=1,function(e){function t(F,X){var W=F.length;F.push(X);e:for(;0<W;){var ne=W-1>>>1,Y=F[ne];if(0<r(Y,X))F[ne]=X,F[W]=Y,W=ne;else break e}}function i(F){return F.length===0?null:F[0]}function n(F){if(F.length===0)return null;var X=F[0],W=F.pop();if(W!==X){F[0]=W;e:for(var ne=0,Y=F.length,$=Y>>>1;ne<$;){var se=2*(ne+1)-1,fe=F[se],te=se+1,de=F[te];if(0>r(fe,W))te<Y&&0>r(de,fe)?(F[ne]=de,F[te]=W,ne=te):(F[ne]=fe,F[se]=W,ne=se);else if(te<Y&&0>r(de,W))F[ne]=de,F[te]=W,ne=te;else break e}}return X}function r(F,X){var W=F.sortIndex-X.sortIndex;return W!==0?W:F.id-X.id}if(e.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;e.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();e.unstable_now=function(){return a.now()-o}}var l=[],c=[],u=1,h=null,d=3,p=!1,g=!1,x=!1,y=typeof setTimeout=="function"?setTimeout:null,b=typeof clearTimeout=="function"?clearTimeout:null,A=typeof setImmediate<"u"?setImmediate:null;function w(F){for(var X=i(c);X!==null;){if(X.callback===null)n(c);else if(X.startTime<=F)n(c),X.sortIndex=X.expirationTime,t(l,X);else break;X=i(c)}}function E(F){if(x=!1,w(F),!g)if(i(l)!==null)g=!0,j();else{var X=i(c);X!==null&&J(E,X.startTime-F)}}var D=!1,T=-1,I=5,R=-1;function O(){return!(e.unstable_now()-R<I)}function P(){if(D){var F=e.unstable_now();R=F;var X=!0;try{e:{g=!1,x&&(x=!1,b(T),T=-1),p=!0;var W=d;try{t:{for(w(F),h=i(l);h!==null&&!(h.expirationTime>F&&O());){var ne=h.callback;if(typeof ne=="function"){h.callback=null,d=h.priorityLevel;var Y=ne(h.expirationTime<=F);if(F=e.unstable_now(),typeof Y=="function"){h.callback=Y,w(F),X=!0;break t}h===i(l)&&n(l),w(F)}else n(l);h=i(l)}if(h!==null)X=!0;else{var $=i(c);$!==null&&J(E,$.startTime-F),X=!1}}break e}finally{h=null,d=W,p=!1}X=void 0}}finally{X?U():D=!1}}}var U;if(typeof A=="function")U=function(){A(P)};else if(typeof MessageChannel<"u"){var H=new MessageChannel,V=H.port2;H.port1.onmessage=P,U=function(){V.postMessage(null)}}else U=function(){y(P,0)};function j(){D||(D=!0,U())}function J(F,X){T=y(function(){F(e.unstable_now())},X)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(F){F.callback=null},e.unstable_continueExecution=function(){g||p||(g=!0,j())},e.unstable_forceFrameRate=function(F){0>F||125<F?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<F?Math.floor(1e3/F):5},e.unstable_getCurrentPriorityLevel=function(){return d},e.unstable_getFirstCallbackNode=function(){return i(l)},e.unstable_next=function(F){switch(d){case 1:case 2:case 3:var X=3;break;default:X=d}var W=d;d=X;try{return F()}finally{d=W}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(F,X){switch(F){case 1:case 2:case 3:case 4:case 5:break;default:F=3}var W=d;d=F;try{return X()}finally{d=W}},e.unstable_scheduleCallback=function(F,X,W){var ne=e.unstable_now();switch(typeof W=="object"&&W!==null?(W=W.delay,W=typeof W=="number"&&0<W?ne+W:ne):W=ne,F){case 1:var Y=-1;break;case 2:Y=250;break;case 5:Y=1073741823;break;case 4:Y=1e4;break;default:Y=5e3}return Y=W+Y,F={id:u++,callback:X,priorityLevel:F,startTime:W,expirationTime:Y,sortIndex:-1},W>ne?(F.sortIndex=W,t(c,F),i(l)===null&&F===i(c)&&(x?(b(T),T=-1):x=!0,J(E,W-ne))):(F.sortIndex=Y,t(l,F),g||p||(g=!0,j())),F},e.unstable_shouldYield=O,e.unstable_wrapCallback=function(F){var X=d;return function(){var W=d;d=X;try{return F.apply(this,arguments)}finally{d=W}}}}(sB)),sB}var ik;function jfe(){return ik||(ik=1,rB.exports=kfe()),rB.exports}var nk=jfe();const Wfe=e=>typeof e=="object"&&typeof e.then=="function",t0=[];function MQ(e,t,i=(n,r)=>n===r){if(e===t)return!0;if(!e||!t)return!1;const n=e.length;if(t.length!==n)return!1;for(let r=0;r<n;r++)if(!i(e[r],t[r]))return!1;return!0}function EQ(e,t=null,i=!1,n={}){t===null&&(t=[e]);for(const s of t0)if(MQ(t,s.keys,s.equal)){if(i)return;if(Object.prototype.hasOwnProperty.call(s,"error"))throw s.error;if(Object.prototype.hasOwnProperty.call(s,"response"))return n.lifespan&&n.lifespan>0&&(s.timeout&&clearTimeout(s.timeout),s.timeout=setTimeout(s.remove,n.lifespan)),s.response;if(!i)throw s.promise}const r={keys:t,equal:n.equal,remove:()=>{const s=t0.indexOf(r);s!==-1&&t0.splice(s,1)},promise:(Wfe(e)?e:e(...t)).then(s=>{r.response=s,n.lifespan&&n.lifespan>0&&(r.timeout=setTimeout(r.remove,n.lifespan))}).catch(s=>r.error=s)};if(t0.push(r),!i)throw r.promise}const Xfe=(e,t,i)=>EQ(e,t,!1,i),qfe=(e,t,i)=>void EQ(e,t,!0,i),Yfe=e=>{if(e===void 0||e.length===0)t0.splice(0,t0.length);else{const t=t0.find(i=>MQ(e,i.keys,i.equal));t&&t.remove()}};function HF(e,t,i){if(!e)return;if(i(e)===!0)return e;let n=t?e.return:e.child;for(;n;){const r=HF(n,t,i);if(r)return r;n=t?null:n.sibling}}function TQ(e){try{return Object.defineProperties(e,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return e}}const GF=TQ(ge.createContext(null));class CQ extends ge.Component{render(){return ge.createElement(GF.Provider,{value:this._reactInternals},this.props.children)}}function DQ(){const e=ge.useContext(GF);if(e===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const t=ge.useId();return ge.useMemo(()=>{for(const i of[e,e==null?void 0:e.alternate]){if(!i)continue;const n=HF(i,!1,r=>{let s=r.memoizedState;for(;s;){if(s.memoizedState===t)return!0;s=s.next}});if(n)return n}},[e,t])}const Qfe=Symbol.for("react.context"),Kfe=e=>e!==null&&typeof e=="object"&&"$$typeof"in e&&e.$$typeof===Qfe;function Jfe(){const e=DQ(),[t]=ge.useState(()=>new Map);t.clear();let i=e;for(;i;){const n=i.type;Kfe(n)&&n!==GF&&!t.has(n)&&t.set(n,ge.use(TQ(n))),i=i.return}return t}function Zfe(){const e=Jfe();return ge.useMemo(()=>Array.from(e.keys()).reduce((t,i)=>n=>ge.createElement(t,null,ge.createElement(i.Provider,{...n,value:e.get(i)})),t=>ge.createElement(CQ,{...t})),[e])}function RQ(e){let t=e.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const PQ=e=>e&&e.isOrthographicCamera,$fe=e=>e&&e.hasOwnProperty("current"),epe=e=>e!=null&&(typeof e=="string"||typeof e=="number"||e.isColor),Zw=((e,t)=>typeof window<"u"&&(((e=window.document)==null?void 0:e.createElement)||((t=window.navigator)==null?void 0:t.product)==="ReactNative"))()?ge.useLayoutEffect:ge.useEffect;function OQ(e){const t=ge.useRef(e);return Zw(()=>void(t.current=e),[e]),t}function tpe(){const e=DQ(),t=Zfe();return ge.useMemo(()=>({children:i})=>{const r=!!HF(e,!0,s=>s.type===ge.StrictMode)?ge.StrictMode:ge.Fragment;return ke.jsx(r,{children:ke.jsx(t,{children:i})})},[e,t])}function ipe({set:e}){return Zw(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}const npe=(e=>(e=class extends ge.Component{constructor(...i){super(...i),this.state={error:!1}}componentDidCatch(i){this.props.set(i)}render(){return this.state.error?null:this.props.children}},e.getDerivedStateFromError=()=>({error:!0}),e))();function BQ(e){var t;const i=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],i),e[1]):e}function yx(e){var t;return(t=e.__r3f)==null?void 0:t.root.getState()}const Cr={obj:e=>e===Object(e)&&!Cr.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,nul:e=>e===null,arr:e=>Array.isArray(e),equ(e,t,{arrays:i="shallow",objects:n="reference",strict:r=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(Cr.str(e)||Cr.num(e)||Cr.boo(e))return e===t;const s=Cr.obj(e);if(s&&n==="reference")return e===t;const a=Cr.arr(e);if(a&&i==="reference")return e===t;if((a||s)&&e===t)return!0;let o;for(o in e)if(!(o in t))return!1;if(s&&i==="shallow"&&n==="shallow"){for(o in r?t:e)if(!Cr.equ(e[o],t[o],{strict:r,objects:"reference"}))return!1}else for(o in r?t:e)if(e[o]!==t[o])return!1;if(Cr.und(o)){if(a&&e.length===0&&t.length===0||s&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function rpe(e){const t={nodes:{},materials:{},meshes:{}};return e&&e.traverse(i=>{i.name&&(t.nodes[i.name]=i),i.material&&!t.materials[i.material.name]&&(t.materials[i.material.name]=i.material),i.isMesh&&!t.meshes[i.name]&&(t.meshes[i.name]=i)}),t}function spe(e){e.type!=="Scene"&&(e.dispose==null||e.dispose());for(const t in e){const i=e[t];(i==null?void 0:i.type)!=="Scene"&&(i==null||i.dispose==null||i.dispose())}}const IQ=["children","key","ref"];function ape(e){const t={};for(const i in e)IQ.includes(i)||(t[i]=e[i]);return t}function FD(e,t,i,n){const r=e;let s=r==null?void 0:r.__r3f;return s||(s={root:t,type:i,parent:null,children:[],props:ape(n),object:r,eventCount:0,handlers:{},isHidden:!1},r&&(r.__r3f=s)),s}function sw(e,t){let i=e[t];if(!t.includes("-"))return{root:e,key:t,target:i};i=e;for(const r of t.split("-")){var n;t=r,e=i,i=(n=i)==null?void 0:n[t]}return{root:e,key:t,target:i}}const rk=/-\d+$/;function VD(e,t){if(Cr.str(t.props.attach)){if(rk.test(t.props.attach)){const r=t.props.attach.replace(rk,""),{root:s,key:a}=sw(e.object,r);Array.isArray(s[a])||(s[a]=[])}const{root:i,key:n}=sw(e.object,t.props.attach);t.previousAttach=i[n],i[n]=t.object}else Cr.fun(t.props.attach)&&(t.previousAttach=t.props.attach(e.object,t.object))}function HD(e,t){if(Cr.str(t.props.attach)){const{root:i,key:n}=sw(e.object,t.props.attach),r=t.previousAttach;r===void 0?delete i[n]:i[n]=r}else t.previousAttach==null||t.previousAttach(e.object,t.object);delete t.previousAttach}const lU=[...IQ,"args","dispose","attach","object","onUpdate","dispose"],sk=new Map;function ope(e){let t=sk.get(e.constructor);try{t||(t=new e.constructor,sk.set(e.constructor,t))}catch{}return t}function lpe(e,t){const i={};for(const n in t)if(!lU.includes(n)&&!Cr.equ(t[n],e.props[n])){i[n]=t[n];for(const r in t)r.startsWith(`${n}-`)&&(i[r]=t[r])}for(const n in e.props){if(lU.includes(n)||t.hasOwnProperty(n))continue;const{root:r,key:s}=sw(e.object,n);if(r.constructor&&r.constructor.length===0){const a=ope(r);Cr.und(a)||(i[s]=a[s])}else i[s]=0}return i}const cpe=["map","emissiveMap","sheenColorMap","specularColorMap","envMap"],upe=/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/;function Gc(e,t){var i;const n=e.__r3f,r=n&&RQ(n).getState(),s=n==null?void 0:n.eventCount;for(const o in t){let l=t[o];if(lU.includes(o))continue;if(n&&upe.test(o)){typeof l=="function"?n.handlers[o]=l:delete n.handlers[o],n.eventCount=Object.keys(n.handlers).length;continue}if(l===void 0)continue;let{root:c,key:u,target:h}=sw(e,o);if(h instanceof X1&&l instanceof X1)h.mask=l.mask;else if(h instanceof jt&&epe(l))h.set(l);else if(h!==null&&typeof h=="object"&&typeof h.set=="function"&&typeof h.copy=="function"&&l!=null&&l.constructor&&h.constructor===l.constructor)h.copy(l);else if(h!==null&&typeof h=="object"&&typeof h.set=="function"&&Array.isArray(l))typeof h.fromArray=="function"?h.fromArray(l):h.set(...l);else if(h!==null&&typeof h=="object"&&typeof h.set=="function"&&typeof l=="number")typeof h.setScalar=="function"?h.setScalar(l):h.set(l);else{var a;c[u]=l,r&&!r.linear&&cpe.includes(u)&&(a=c[u])!=null&&a.isTexture&&c[u].format===go&&c[u].type===Kc&&(c[u].colorSpace=fo)}}if(n!=null&&n.parent&&r!=null&&r.internal&&(i=n.object)!=null&&i.isObject3D&&s!==n.eventCount){const o=n.object,l=r.internal.interaction.indexOf(o);l>-1&&r.internal.interaction.splice(l,1),n.eventCount&&o.raycast!==null&&r.internal.interaction.push(o)}return n&&n.props.attach===void 0&&(n.object.isBufferGeometry?n.props.attach="geometry":n.object.isMaterial&&(n.props.attach="material")),n&&_b(n),e}function _b(e){var t;if(!e.parent)return;e.props.onUpdate==null||e.props.onUpdate(e.object);const i=(t=e.root)==null||t.getState==null?void 0:t.getState();i&&i.internal.frames===0&&i.invalidate()}function hpe(e,t){e.manual||(PQ(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix())}const Xo=e=>e==null?void 0:e.isObject3D;function k2(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function LQ(e,t,i,n){const r=i.get(t);r&&(i.delete(t),i.size===0&&(e.delete(n),r.target.releasePointerCapture(n)))}function dpe(e,t){const{internal:i}=e.getState();i.interaction=i.interaction.filter(n=>n!==t),i.initialHits=i.initialHits.filter(n=>n!==t),i.hovered.forEach((n,r)=>{(n.eventObject===t||n.object===t)&&i.hovered.delete(r)}),i.capturedMap.forEach((n,r)=>{LQ(i.capturedMap,t,n,r)})}function fpe(e){function t(l){const{internal:c}=e.getState(),u=l.offsetX-c.initialClick[0],h=l.offsetY-c.initialClick[1];return Math.round(Math.sqrt(u*u+h*h))}function i(l){return l.filter(c=>["Move","Over","Enter","Out","Leave"].some(u=>{var h;return(h=c.__r3f)==null?void 0:h.handlers["onPointer"+u]}))}function n(l,c){const u=e.getState(),h=new Set,d=[],p=c?c(u.internal.interaction):u.internal.interaction;for(let b=0;b<p.length;b++){const A=yx(p[b]);A&&(A.raycaster.camera=void 0)}u.previousRoot||u.events.compute==null||u.events.compute(l,u);function g(b){const A=yx(b);if(!A||!A.events.enabled||A.raycaster.camera===null)return[];if(A.raycaster.camera===void 0){var w;A.events.compute==null||A.events.compute(l,A,(w=A.previousRoot)==null?void 0:w.getState()),A.raycaster.camera===void 0&&(A.raycaster.camera=null)}return A.raycaster.camera?A.raycaster.intersectObject(b,!0):[]}let x=p.flatMap(g).sort((b,A)=>{const w=yx(b.object),E=yx(A.object);return!w||!E?b.distance-A.distance:E.events.priority-w.events.priority||b.distance-A.distance}).filter(b=>{const A=k2(b);return h.has(A)?!1:(h.add(A),!0)});u.events.filter&&(x=u.events.filter(x,u));for(const b of x){let A=b.object;for(;A;){var y;(y=A.__r3f)!=null&&y.eventCount&&d.push({...b,eventObject:A}),A=A.parent}}if("pointerId"in l&&u.internal.capturedMap.has(l.pointerId))for(let b of u.internal.capturedMap.get(l.pointerId).values())h.has(k2(b.intersection))||d.push(b.intersection);return d}function r(l,c,u,h){if(l.length){const d={stopped:!1};for(const p of l){let g=yx(p.object);if(g||p.object.traverseAncestors(x=>{const y=yx(x);if(y)return g=y,!1}),g){const{raycaster:x,pointer:y,camera:b,internal:A}=g,w=new me(y.x,y.y,0).unproject(b),E=O=>{var P,U;return(P=(U=A.capturedMap.get(O))==null?void 0:U.has(p.eventObject))!=null?P:!1},D=O=>{const P={intersection:p,target:c.target};A.capturedMap.has(O)?A.capturedMap.get(O).set(p.eventObject,P):A.capturedMap.set(O,new Map([[p.eventObject,P]])),c.target.setPointerCapture(O)},T=O=>{const P=A.capturedMap.get(O);P&&LQ(A.capturedMap,p.eventObject,P,O)};let I={};for(let O in c){let P=c[O];typeof P!="function"&&(I[O]=P)}let R={...p,...I,pointer:y,intersections:l,stopped:d.stopped,delta:u,unprojectedPoint:w,ray:x.ray,camera:b,stopPropagation(){const O="pointerId"in c&&A.capturedMap.get(c.pointerId);if((!O||O.has(p.eventObject))&&(R.stopped=d.stopped=!0,A.hovered.size&&Array.from(A.hovered.values()).find(P=>P.eventObject===p.eventObject))){const P=l.slice(0,l.indexOf(p));s([...P,p])}},target:{hasPointerCapture:E,setPointerCapture:D,releasePointerCapture:T},currentTarget:{hasPointerCapture:E,setPointerCapture:D,releasePointerCapture:T},nativeEvent:c};if(h(R),d.stopped===!0)break}}}return l}function s(l){const{internal:c}=e.getState();for(const u of c.hovered.values())if(!l.length||!l.find(h=>h.object===u.object&&h.index===u.index&&h.instanceId===u.instanceId)){const d=u.eventObject.__r3f;if(c.hovered.delete(k2(u)),d!=null&&d.eventCount){const p=d.handlers,g={...u,intersections:l};p.onPointerOut==null||p.onPointerOut(g),p.onPointerLeave==null||p.onPointerLeave(g)}}}function a(l,c){for(let u=0;u<c.length;u++){const h=c[u].__r3f;h==null||h.handlers.onPointerMissed==null||h.handlers.onPointerMissed(l)}}function o(l){switch(l){case"onPointerLeave":case"onPointerCancel":return()=>s([]);case"onLostPointerCapture":return c=>{const{internal:u}=e.getState();"pointerId"in c&&u.capturedMap.has(c.pointerId)&&requestAnimationFrame(()=>{u.capturedMap.has(c.pointerId)&&(u.capturedMap.delete(c.pointerId),s([]))})}}return function(u){const{onPointerMissed:h,internal:d}=e.getState();d.lastEvent.current=u;const p=l==="onPointerMove",g=l==="onClick"||l==="onContextMenu"||l==="onDoubleClick",y=n(u,p?i:void 0),b=g?t(u):0;l==="onPointerDown"&&(d.initialClick=[u.offsetX,u.offsetY],d.initialHits=y.map(w=>w.eventObject)),g&&!y.length&&b<=2&&(a(u,d.interaction),h&&h(u)),p&&s(y);function A(w){const E=w.eventObject,D=E.__r3f;if(!(D!=null&&D.eventCount))return;const T=D.handlers;if(p){if(T.onPointerOver||T.onPointerEnter||T.onPointerOut||T.onPointerLeave){const I=k2(w),R=d.hovered.get(I);R?R.stopped&&w.stopPropagation():(d.hovered.set(I,w),T.onPointerOver==null||T.onPointerOver(w),T.onPointerEnter==null||T.onPointerEnter(w))}T.onPointerMove==null||T.onPointerMove(w)}else{const I=T[l];I?(!g||d.initialHits.includes(E))&&(a(u,d.interaction.filter(R=>!d.initialHits.includes(R))),I(w)):g&&d.initialHits.includes(E)&&a(u,d.interaction.filter(R=>!d.initialHits.includes(R)))}}r(y,u,b,A)}}return{handlePointer:o}}const ak=e=>!!(e!=null&&e.render),UQ=ge.createContext(null),ppe=(e,t)=>{const i=Ufe((o,l)=>{const c=new me,u=new me,h=new me;function d(b=l().camera,A=u,w=l().size){const{width:E,height:D,top:T,left:I}=w,R=E/D;A.isVector3?h.copy(A):h.set(...A);const O=b.getWorldPosition(c).distanceTo(h);if(PQ(b))return{width:E/b.zoom,height:D/b.zoom,top:T,left:I,factor:1,distance:O,aspect:R};{const P=b.fov*Math.PI/180,U=2*Math.tan(P/2)*O,H=U*(E/D);return{width:H,height:U,top:T,left:I,factor:E/H,distance:O,aspect:R}}}let p;const g=b=>o(A=>({performance:{...A.performance,current:b}})),x=new Mt;return{set:o,get:l,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},scene:null,xr:null,invalidate:(b=1)=>e(l(),b),advance:(b,A)=>t(b,A,l()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new LF,pointer:x,mouse:x,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const b=l();p&&clearTimeout(p),b.performance.current!==b.performance.min&&g(b.performance.min),p=setTimeout(()=>g(l().performance.max),b.performance.debounce)}},size:{width:0,height:0,top:0,left:0},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:d},setEvents:b=>o(A=>({...A,events:{...A.events,...b}})),setSize:(b,A,w=0,E=0)=>{const D=l().camera,T={width:b,height:A,top:w,left:E};o(I=>({size:T,viewport:{...I.viewport,...d(D,u,T)}}))},setDpr:b=>o(A=>{const w=BQ(b);return{viewport:{...A.viewport,dpr:w,initialDpr:A.viewport.initialDpr||w}}}),setFrameloop:(b="always")=>{const A=l().clock;A.stop(),A.elapsedTime=0,b!=="never"&&(A.start(),A.elapsedTime=0),o(()=>({frameloop:b}))},previousRoot:void 0,internal:{interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,lastEvent:ge.createRef(),active:!1,frames:0,priority:0,subscribe:(b,A,w)=>{const E=l().internal;return E.priority=E.priority+(A>0?1:0),E.subscribers.push({ref:b,priority:A,store:w}),E.subscribers=E.subscribers.sort((D,T)=>D.priority-T.priority),()=>{const D=l().internal;D!=null&&D.subscribers&&(D.priority=D.priority-(A>0?1:0),D.subscribers=D.subscribers.filter(T=>T.ref!==b))}}}}}),n=i.getState();let r=n.size,s=n.viewport.dpr,a=n.camera;return i.subscribe(()=>{const{camera:o,size:l,viewport:c,gl:u,set:h}=i.getState();if(l.width!==r.width||l.height!==r.height||c.dpr!==s){r=l,s=c.dpr,hpe(o,l),c.dpr>0&&u.setPixelRatio(c.dpr);const d=typeof HTMLCanvasElement<"u"&&u.domElement instanceof HTMLCanvasElement;u.setSize(l.width,l.height,d)}o!==a&&(a=o,h(d=>({viewport:{...d.viewport,...d.viewport.getCurrentViewport(o)}})))}),i.subscribe(o=>e(o)),i};function NQ(){const e=ge.useContext(UQ);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function Kl(e=i=>i,t){return NQ()(e,t)}function Ab(e,t=0){const i=NQ(),n=i.getState().internal.subscribe,r=OQ(e);return Zw(()=>n(r,t,i),[t,n,i]),null}const ok=new WeakMap,mpe=e=>{var t;return typeof e=="function"&&(e==null||(t=e.prototype)==null?void 0:t.constructor)===e};function zQ(e,t){return function(i,...n){let r;return mpe(i)?(r=ok.get(i),r||(r=new i,ok.set(i,r))):r=i,e&&e(r),Promise.all(n.map(s=>new Promise((a,o)=>r.load(s,l=>{Xo(l==null?void 0:l.scene)&&Object.assign(l,rpe(l.scene)),a(l)},t,l=>o(new Error(`Could not load ${s}: ${l==null?void 0:l.message}`))))))}}function hg(e,t,i,n){const r=Array.isArray(t)?t:[t],s=Xfe(zQ(i,n),[e,...r],{equal:Cr.equ});return Array.isArray(t)?s:s[0]}hg.preload=function(e,t,i){const n=Array.isArray(t)?t:[t];return qfe(zQ(i),[e,...n])};hg.clear=function(e,t){const i=Array.isArray(t)?t:[t];return Yfe([e,...i])};function gpe(e){const t=Gfe(e);return t.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:ge.version}),t}const FQ=0,K1={},vpe=/^three(?=[A-Z])/,NR=e=>`${e[0].toUpperCase()}${e.slice(1)}`;let ype=0;const xpe=e=>typeof e=="function";function bpe(e){if(xpe(e)){const t=`${ype++}`;return K1[t]=e,t}else Object.assign(K1,e)}function VQ(e,t){const i=NR(e),n=K1[i];if(e!=="primitive"&&!n)throw new Error(`R3F: ${i} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(e==="primitive"&&!t.object)throw new Error("R3F: Primitives without 'object' are invalid!");if(t.args!==void 0&&!Array.isArray(t.args))throw new Error("R3F: The args prop must be an array!")}function Spe(e,t,i){var n;return e=NR(e)in K1?e:e.replace(vpe,""),VQ(e,t),e==="primitive"&&(n=t.object)!=null&&n.__r3f&&delete t.object.__r3f,FD(t.object,i,e,t)}function _pe(e){if(!e.isHidden){var t;e.props.attach&&(t=e.parent)!=null&&t.object?HD(e.parent,e):Xo(e.object)&&(e.object.visible=!1),e.isHidden=!0,_b(e)}}function HQ(e){if(e.isHidden){var t;e.props.attach&&(t=e.parent)!=null&&t.object?VD(e.parent,e):Xo(e.object)&&e.props.visible!==!1&&(e.object.visible=!0),e.isHidden=!1,_b(e)}}function kF(e,t,i){const n=t.root.getState();if(!(!e.parent&&e.object!==n.scene)){if(!t.object){var r,s;const a=K1[NR(t.type)];t.object=(r=t.props.object)!=null?r:new a(...(s=t.props.args)!=null?s:[]),t.object.__r3f=t}if(Gc(t.object,t.props),t.props.attach)VD(e,t);else if(Xo(t.object)&&Xo(e.object)){const a=e.object.children.indexOf(i==null?void 0:i.object);if(i&&a!==-1){const o=e.object.children.indexOf(t.object);if(o!==-1){e.object.children.splice(o,1);const l=o<a?a-1:a;e.object.children.splice(l,0,t.object)}else t.object.parent=e.object,e.object.children.splice(a,0,t.object),t.object.dispatchEvent({type:"added"}),e.object.dispatchEvent({type:"childadded",child:t.object})}else e.object.add(t.object)}for(const a of t.children)kF(t,a);_b(t)}}function aB(e,t){t&&(t.parent=e,e.children.push(t),kF(e,t))}function lk(e,t,i){if(!t||!i)return;t.parent=e;const n=e.children.indexOf(i);n!==-1?e.children.splice(n,0,t):e.children.push(t),kF(e,t,i)}function GQ(e){if(typeof e.dispose=="function"){const t=()=>{try{e.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT<"u"?t():nk.unstable_scheduleCallback(nk.unstable_IdlePriority,t)}}function cU(e,t,i){if(!t)return;t.parent=null;const n=e.children.indexOf(t);n!==-1&&e.children.splice(n,1),t.props.attach?HD(e,t):Xo(t.object)&&Xo(e.object)&&(e.object.remove(t.object),dpe(RQ(t),t.object));const r=t.props.dispose!==null&&i!==!1;for(let s=t.children.length-1;s>=0;s--){const a=t.children[s];cU(t,a,r)}t.children.length=0,delete t.object.__r3f,r&&t.type!=="primitive"&&t.object.type!=="Scene"&&GQ(t.object),i===void 0&&_b(t)}function Ape(e,t){for(const i of[e,e.alternate])if(i!==null)if(typeof i.ref=="function"){i.refCleanup==null||i.refCleanup();const n=i.ref(t);typeof n=="function"&&(i.refCleanup=n)}else i.ref&&(i.ref.current=t)}const TC=[];function wpe(){for(const[i]of TC){const n=i.parent;if(n){i.props.attach?HD(n,i):Xo(i.object)&&Xo(n.object)&&n.object.remove(i.object);for(const r of i.children)r.props.attach?HD(i,r):Xo(r.object)&&Xo(i.object)&&i.object.remove(r.object)}i.isHidden&&HQ(i),i.object.__r3f&&delete i.object.__r3f,i.type!=="primitive"&&GQ(i.object)}for(const[i,n,r]of TC){i.props=n;const s=i.parent;if(s){var e,t;const a=K1[NR(i.type)];i.object=(e=i.props.object)!=null?e:new a(...(t=i.props.args)!=null?t:[]),i.object.__r3f=i,Ape(r,i.object),Gc(i.object,i.props),i.props.attach?VD(s,i):Xo(i.object)&&Xo(s.object)&&s.object.add(i.object);for(const o of i.children)o.props.attach?VD(i,o):Xo(o.object)&&Xo(i.object)&&i.object.add(o.object);_b(i)}}TC.length=0}const oB=()=>{},ck={};let j2=FQ;const Mpe=0,Epe=4,uU=gpe({isPrimaryRenderer:!1,warnsIfNotActing:!1,supportsMutation:!0,supportsPersistence:!1,supportsHydration:!1,createInstance:Spe,removeChild:cU,appendChild:aB,appendInitialChild:aB,insertBefore:lk,appendChildToContainer(e,t){const i=e.getState().scene.__r3f;!t||!i||aB(i,t)},removeChildFromContainer(e,t){const i=e.getState().scene.__r3f;!t||!i||cU(i,t)},insertInContainerBefore(e,t,i){const n=e.getState().scene.__r3f;!t||!i||!n||lk(n,t,i)},getRootHostContext:()=>ck,getChildHostContext:()=>ck,commitUpdate(e,t,i,n,r){var s,a,o;VQ(t,n);let l=!1;if((e.type==="primitive"&&i.object!==n.object||((s=n.args)==null?void 0:s.length)!==((a=i.args)==null?void 0:a.length)||(o=n.args)!=null&&o.some((u,h)=>{var d;return u!==((d=i.args)==null?void 0:d[h])}))&&(l=!0),l)TC.push([e,{...n},r]);else{const u=lpe(e,n);Object.keys(u).length&&(Object.assign(e.props,u),Gc(e.object,u))}(r.sibling===null||(r.flags&Epe)===Mpe)&&wpe()},finalizeInitialChildren:()=>!1,commitMount(){},getPublicInstance:e=>e==null?void 0:e.object,prepareForCommit:()=>null,preparePortalMount:e=>FD(e.getState().scene,e,"",{}),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance:_pe,unhideInstance:HQ,createTextInstance:oB,hideTextInstance:oB,unhideTextInstance:oB,scheduleTimeout:typeof setTimeout=="function"?setTimeout:void 0,cancelTimeout:typeof clearTimeout=="function"?clearTimeout:void 0,noTimeout:-1,getInstanceFromNode:()=>null,beforeActiveInstanceBlur(){},afterActiveInstanceBlur(){},detachDeletedInstance(){},prepareScopeUpdate(){},getInstanceFromScope:()=>null,shouldAttemptEagerTransition:()=>!1,trackSchedulerEvent:()=>{},resolveEventType:()=>null,resolveEventTimeStamp:()=>-1.1,requestPostPaintCallback(){},maySuspendCommit:()=>!1,preloadInstance:()=>!0,startSuspendingCommit(){},suspendInstance(){},waitForCommitToBeReady:()=>null,NotPendingTransition:null,HostTransitionContext:ge.createContext(null),setCurrentUpdatePriority(e){j2=e},getCurrentUpdatePriority(){return j2},resolveUpdatePriority(){var e;if(j2!==FQ)return j2;switch(typeof window<"u"&&((e=window.event)==null?void 0:e.type)){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return EC.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return EC.ContinuousEventPriority;default:return EC.DefaultEventPriority}},resetFormInstance(){}}),O0=new Map,xx={objects:"shallow",strict:!1};function Tpe(e,t){if(!t&&typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:i,height:n,top:r,left:s}=e.parentElement.getBoundingClientRect();return{width:i,height:n,top:r,left:s}}else if(!t&&typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0};return{width:0,height:0,top:0,left:0,...t}}function Cpe(e){const t=O0.get(e),i=t==null?void 0:t.fiber,n=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const r=typeof reportError=="function"?reportError:console.error,s=n||ppe(fU,hk),a=i||uU.createContainer(s,EC.ConcurrentRoot,null,!1,null,"",r,r,r,null);t||O0.set(e,{fiber:a,store:s});let o,l,c=!1,u=null;return{async configure(h={}){let d;u=new Promise($=>d=$);let{gl:p,size:g,scene:x,events:y,onCreated:b,shadows:A=!1,linear:w=!1,flat:E=!1,legacy:D=!1,orthographic:T=!1,frameloop:I="always",dpr:R=[1,2],performance:O,raycaster:P,camera:U,onPointerMissed:H}=h,V=s.getState(),j=V.gl;if(!V.gl){const $={canvas:e,powerPreference:"high-performance",antialias:!0,alpha:!0},se=typeof p=="function"?await p($):p;ak(se)?j=se:j=new AQ({...$,...p}),V.set({gl:j})}let J=V.raycaster;J||V.set({raycaster:J=new mQ});const{params:F,...X}=P||{};if(Cr.equ(X,J,xx)||Gc(J,{...X}),Cr.equ(F,J.params,xx)||Gc(J,{params:{...J.params,...F}}),!V.camera||V.camera===l&&!Cr.equ(l,U,xx)){l=U;const $=U==null?void 0:U.isCamera,se=$?U:T?new Qu(0,0,0,0,.1,1e3):new Dr(75,0,.1,1e3);$||(se.position.z=5,U&&(Gc(se,U),se.manual||("aspect"in U||"left"in U||"right"in U||"bottom"in U||"top"in U)&&(se.manual=!0,se.updateProjectionMatrix())),!V.camera&&!(U!=null&&U.rotation)&&se.lookAt(0,0,0)),V.set({camera:se}),J.camera=se}if(!V.scene){let $;x!=null&&x.isScene?($=x,FD($,s,"",{})):($=new hF,FD($,s,"",{}),x&&Gc($,x)),V.set({scene:$})}y&&!V.events.handlers&&V.set({events:y(s)});const W=Tpe(e,g);if(Cr.equ(W,V.size,xx)||V.setSize(W.width,W.height,W.top,W.left),R&&V.viewport.dpr!==BQ(R)&&V.setDpr(R),V.frameloop!==I&&V.setFrameloop(I),V.onPointerMissed||V.set({onPointerMissed:H}),O&&!Cr.equ(O,V.performance,xx)&&V.set($=>({performance:{...$.performance,...O}})),!V.xr){var ne;const $=(te,de)=>{const le=s.getState();le.frameloop!=="never"&&hk(te,!0,le,de)},se=()=>{const te=s.getState();te.gl.xr.enabled=te.gl.xr.isPresenting,te.gl.xr.setAnimationLoop(te.gl.xr.isPresenting?$:null),te.gl.xr.isPresenting||fU(te)},fe={connect(){const te=s.getState().gl;te.xr.addEventListener("sessionstart",se),te.xr.addEventListener("sessionend",se)},disconnect(){const te=s.getState().gl;te.xr.removeEventListener("sessionstart",se),te.xr.removeEventListener("sessionend",se)}};typeof((ne=j.xr)==null?void 0:ne.addEventListener)=="function"&&fe.connect(),V.set({xr:fe})}if(j.shadowMap){const $=j.shadowMap.enabled,se=j.shadowMap.type;if(j.shadowMap.enabled=!!A,Cr.boo(A))j.shadowMap.type=gA;else if(Cr.str(A)){var Y;const fe={basic:Iq,percentage:rR,soft:gA,variance:Hu};j.shadowMap.type=(Y=fe[A])!=null?Y:gA}else Cr.obj(A)&&Object.assign(j.shadowMap,A);($!==j.shadowMap.enabled||se!==j.shadowMap.type)&&(j.shadowMap.needsUpdate=!0)}return _n.enabled=!D,c||(j.outputColorSpace=w?$m:fo,j.toneMapping=E?ud:qz),V.legacy!==D&&V.set(()=>({legacy:D})),V.linear!==w&&V.set(()=>({linear:w})),V.flat!==E&&V.set(()=>({flat:E})),p&&!Cr.fun(p)&&!ak(p)&&!Cr.equ(p,j,xx)&&Gc(j,p),o=b,c=!0,d(),this},render(h){return!c&&!u&&this.configure(),u.then(()=>{uU.updateContainer(ke.jsx(Dpe,{store:s,children:h,onCreated:o,rootElement:e}),a,null,()=>{})}),s},unmount(){kQ(e)}}}function Dpe({store:e,children:t,onCreated:i,rootElement:n}){return Zw(()=>{const r=e.getState();r.set(s=>({internal:{...s.internal,active:!0}})),i&&i(r),e.getState().events.connected||r.events.connect==null||r.events.connect(n)},[]),ke.jsx(UQ.Provider,{value:e,children:t})}function kQ(e,t){const i=O0.get(e),n=i==null?void 0:i.fiber;if(n){const r=i==null?void 0:i.store.getState();r&&(r.internal.active=!1),uU.updateContainer(null,n,null,()=>{r&&setTimeout(()=>{try{var s,a,o,l;r.events.disconnect==null||r.events.disconnect(),(s=r.gl)==null||(a=s.renderLists)==null||a.dispose==null||a.dispose(),(o=r.gl)==null||o.forceContextLoss==null||o.forceContextLoss(),(l=r.gl)!=null&&l.xr&&r.xr.disconnect(),spe(r.scene),O0.delete(e)}catch{}},500)})}}const Rpe=new Set,Ppe=new Set,Ope=new Set;function lB(e,t){if(e.size)for(const{callback:i}of e.values())i(t)}function MA(e,t){switch(e){case"before":return lB(Rpe,t);case"after":return lB(Ppe,t);case"tail":return lB(Ope,t)}}let cB,uB;function hU(e,t,i){let n=t.clock.getDelta();t.frameloop==="never"&&typeof e=="number"&&(n=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),cB=t.internal.subscribers;for(let r=0;r<cB.length;r++)uB=cB[r],uB.ref.current(uB.store.getState(),n,i);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}let GD=!1,dU=!1,hB,uk,bx;function jQ(e){uk=requestAnimationFrame(jQ),GD=!0,hB=0,MA("before",e),dU=!0;for(const i of O0.values()){var t;bx=i.store.getState(),bx.internal.active&&(bx.frameloop==="always"||bx.internal.frames>0)&&!((t=bx.gl.xr)!=null&&t.isPresenting)&&(hB+=hU(e,bx))}if(dU=!1,MA("after",e),hB===0)return MA("tail",e),GD=!1,cancelAnimationFrame(uk)}function fU(e,t=1){var i;if(!e)return O0.forEach(n=>fU(n.store.getState(),t));(i=e.gl.xr)!=null&&i.isPresenting||!e.internal.active||e.frameloop==="never"||(t>1?e.internal.frames=Math.min(60,e.internal.frames+t):dU?e.internal.frames=2:e.internal.frames=1,GD||(GD=!0,requestAnimationFrame(jQ)))}function hk(e,t=!0,i,n){if(t&&MA("before",e),i)hU(e,i,n);else for(const r of O0.values())hU(e,r.store.getState());t&&MA("after",e)}const dB={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Bpe(e){const{handlePointer:t}=fpe(e);return{priority:1,enabled:!0,compute(i,n,r){n.pointer.set(i.offsetX/n.size.width*2-1,-(i.offsetY/n.size.height)*2+1),n.raycaster.setFromCamera(n.pointer,n.camera)},connected:void 0,handlers:Object.keys(dB).reduce((i,n)=>({...i,[n]:t(n)}),{}),update:()=>{var i;const{events:n,internal:r}=e.getState();(i=r.lastEvent)!=null&&i.current&&n.handlers&&n.handlers.onPointerMove(r.lastEvent.current)},connect:i=>{const{set:n,events:r}=e.getState();if(r.disconnect==null||r.disconnect(),n(s=>({events:{...s.events,connected:i}})),r.handlers)for(const s in r.handlers){const a=r.handlers[s],[o,l]=dB[s];i.addEventListener(o,a,{passive:l})}},disconnect:()=>{const{set:i,events:n}=e.getState();if(n.connected){if(n.handlers)for(const r in n.handlers){const s=n.handlers[r],[a]=dB[r];n.connected.removeEventListener(a,s)}i(r=>({events:{...r.events,connected:void 0}}))}}}}function dk(e,t){let i;return(...n)=>{window.clearTimeout(i),i=window.setTimeout(()=>e(...n),t)}}function Ipe({debounce:e,scroll:t,polyfill:i,offsetSize:n}={debounce:0,scroll:!1,offsetSize:!1}){const r=i||(typeof window>"u"?class{}:window.ResizeObserver);if(!r)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[s,a]=ge.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),o=ge.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:s,orientationHandler:null}),l=e?typeof e=="number"?e:e.scroll:null,c=e?typeof e=="number"?e:e.resize:null,u=ge.useRef(!1);ge.useEffect(()=>(u.current=!0,()=>void(u.current=!1)));const[h,d,p]=ge.useMemo(()=>{const b=()=>{if(!o.current.element)return;const{left:A,top:w,width:E,height:D,bottom:T,right:I,x:R,y:O}=o.current.element.getBoundingClientRect(),P={left:A,top:w,width:E,height:D,bottom:T,right:I,x:R,y:O};o.current.element instanceof HTMLElement&&n&&(P.height=o.current.element.offsetHeight,P.width=o.current.element.offsetWidth),Object.freeze(P),u.current&&!zpe(o.current.lastBounds,P)&&a(o.current.lastBounds=P)};return[b,c?dk(b,c):b,l?dk(b,l):b]},[a,n,l,c]);function g(){o.current.scrollContainers&&(o.current.scrollContainers.forEach(b=>b.removeEventListener("scroll",p,!0)),o.current.scrollContainers=null),o.current.resizeObserver&&(o.current.resizeObserver.disconnect(),o.current.resizeObserver=null),o.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",o.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",o.current.orientationHandler))}function x(){o.current.element&&(o.current.resizeObserver=new r(p),o.current.resizeObserver.observe(o.current.element),t&&o.current.scrollContainers&&o.current.scrollContainers.forEach(b=>b.addEventListener("scroll",p,{capture:!0,passive:!0})),o.current.orientationHandler=()=>{p()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",o.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",o.current.orientationHandler))}const y=b=>{!b||b===o.current.element||(g(),o.current.element=b,o.current.scrollContainers=WQ(b),x())};return Upe(p,!!t),Lpe(d),ge.useEffect(()=>{g(),x()},[t,p,d]),ge.useEffect(()=>g,[]),[y,s,h]}function Lpe(e){ge.useEffect(()=>{const t=e;return window.addEventListener("resize",t),()=>void window.removeEventListener("resize",t)},[e])}function Upe(e,t){ge.useEffect(()=>{if(t){const i=e;return window.addEventListener("scroll",i,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",i,!0)}},[e,t])}function WQ(e){const t=[];if(!e||e===document.body)return t;const{overflow:i,overflowX:n,overflowY:r}=window.getComputedStyle(e);return[i,n,r].some(s=>s==="auto"||s==="scroll")&&t.push(e),[...t,...WQ(e.parentElement)]}const Npe=["x","y","top","bottom","left","right","width","height"],zpe=(e,t)=>Npe.every(i=>e[i]===t[i]);function Fpe({ref:e,children:t,fallback:i,resize:n,style:r,gl:s,events:a=Bpe,eventSource:o,eventPrefix:l,shadows:c,linear:u,flat:h,legacy:d,orthographic:p,frameloop:g,dpr:x,performance:y,raycaster:b,camera:A,scene:w,onPointerMissed:E,onCreated:D,...T}){ge.useMemo(()=>bpe(wfe),[]);const I=tpe(),[R,O]=Ipe({scroll:!0,debounce:{scroll:50,resize:0},...n}),P=ge.useRef(null),U=ge.useRef(null);ge.useImperativeHandle(e,()=>P.current);const H=OQ(E),[V,j]=ge.useState(!1),[J,F]=ge.useState(!1);if(V)throw V;if(J)throw J;const X=ge.useRef(null);Zw(()=>{const ne=P.current;if(O.width>0&&O.height>0&&ne){X.current||(X.current=Cpe(ne));async function Y(){await X.current.configure({gl:s,scene:w,events:a,shadows:c,linear:u,flat:h,legacy:d,orthographic:p,frameloop:g,dpr:x,performance:y,raycaster:b,camera:A,size:O,onPointerMissed:(...$)=>H.current==null?void 0:H.current(...$),onCreated:$=>{$.events.connect==null||$.events.connect(o?$fe(o)?o.current:o:U.current),l&&$.setEvents({compute:(se,fe)=>{const te=se[l+"X"],de=se[l+"Y"];fe.pointer.set(te/fe.size.width*2-1,-(de/fe.size.height)*2+1),fe.raycaster.setFromCamera(fe.pointer,fe.camera)}}),D==null||D($)}}),X.current.render(ke.jsx(I,{children:ke.jsx(npe,{set:F,children:ke.jsx(ge.Suspense,{fallback:ke.jsx(ipe,{set:j}),children:t??null})})}))}Y()}}),ge.useEffect(()=>{const ne=P.current;if(ne)return()=>kQ(ne)},[]);const W=o?"none":"auto";return ke.jsx("div",{ref:U,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:W,...r},...T,children:ke.jsx("div",{ref:R,style:{width:"100%",height:"100%"},children:ke.jsx("canvas",{ref:P,style:{display:"block"},children:i})})})}function jF(e){return ke.jsx(CQ,{children:ke.jsx(Fpe,{...e})})}function _d(){return _d=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)({}).hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},_d.apply(null,arguments)}const $w=new me,WF=new me,Vpe=new me,fk=new Mt;function Hpe(e,t,i){const n=$w.setFromMatrixPosition(e.matrixWorld);n.project(t);const r=i.width/2,s=i.height/2;return[n.x*r+r,-(n.y*s)+s]}function Gpe(e,t){const i=$w.setFromMatrixPosition(e.matrixWorld),n=WF.setFromMatrixPosition(t.matrixWorld),r=i.sub(n),s=t.getWorldDirection(Vpe);return r.angleTo(s)>Math.PI/2}function kpe(e,t,i,n){const r=$w.setFromMatrixPosition(e.matrixWorld),s=r.clone();s.project(t),fk.set(s.x,s.y),i.setFromCamera(fk,t);const a=i.intersectObjects(n,!0);if(a.length){const o=a[0].distance;return r.distanceTo(i.ray.origin)<o}return!0}function jpe(e,t){if(t instanceof Qu)return t.zoom;if(t instanceof Dr){const i=$w.setFromMatrixPosition(e.matrixWorld),n=WF.setFromMatrixPosition(t.matrixWorld),r=t.fov*Math.PI/180,s=i.distanceTo(n);return 1/(2*Math.tan(r/2)*s)}else return 1}function Wpe(e,t,i){if(t instanceof Dr||t instanceof Qu){const n=$w.setFromMatrixPosition(e.matrixWorld),r=WF.setFromMatrixPosition(t.matrixWorld),s=n.distanceTo(r),a=(i[1]-i[0])/(t.far-t.near),o=i[1]-a*t.far;return Math.round(a*s+o)}}const pU=e=>Math.abs(e)<1e-10?0:e;function XQ(e,t,i=""){let n="matrix3d(";for(let r=0;r!==16;r++)n+=pU(t[r]*e.elements[r])+(r!==15?",":")");return i+n}const Xpe=(e=>t=>XQ(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),qpe=(e=>(t,i)=>XQ(t,e(i),"translate(-50%,-50%)"))(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1]);function Ype(e){return e&&typeof e=="object"&&"current"in e}const Qpe=ge.forwardRef(({children:e,eps:t=.001,style:i,className:n,prepend:r,center:s,fullscreen:a,portal:o,distanceFactor:l,sprite:c=!1,transform:u=!1,occlude:h,onOcclude:d,castShadow:p,receiveShadow:g,material:x,geometry:y,zIndexRange:b=[16777271,0],calculatePosition:A=Hpe,as:w="div",wrapperClass:E,pointerEvents:D="auto",...T},I)=>{const{gl:R,camera:O,scene:P,size:U,raycaster:H,events:V,viewport:j}=Kl(),[J]=ge.useState(()=>document.createElement(w)),F=ge.useRef(null),X=ge.useRef(null),W=ge.useRef(0),ne=ge.useRef([0,0]),Y=ge.useRef(null),$=ge.useRef(null),se=(o==null?void 0:o.current)||V.connected||R.domElement.parentNode,fe=ge.useRef(null),te=ge.useRef(!1),de=ge.useMemo(()=>h&&h!=="blending"||Array.isArray(h)&&h.length&&Ype(h[0]),[h]);ge.useLayoutEffect(()=>{const Me=R.domElement;h&&h==="blending"?(Me.style.zIndex=`${Math.floor(b[0]/2)}`,Me.style.position="absolute",Me.style.pointerEvents="none"):(Me.style.zIndex=null,Me.style.position=null,Me.style.pointerEvents=null)},[h]),ge.useLayoutEffect(()=>{if(X.current){const Me=F.current=gq.createRoot(J);if(P.updateMatrixWorld(),u)J.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const Ne=A(X.current,O,U);J.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${Ne[0]}px,${Ne[1]}px,0);transform-origin:0 0;`}return se&&(r?se.prepend(J):se.appendChild(J)),()=>{se&&se.removeChild(J),Me.unmount()}}},[se,u]),ge.useLayoutEffect(()=>{E&&(J.className=E)},[E]);const le=ge.useMemo(()=>u?{position:"absolute",top:0,left:0,width:U.width,height:U.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:s?"translate3d(-50%,-50%,0)":"none",...a&&{top:-U.height/2,left:-U.width/2,width:U.width,height:U.height},...i},[i,s,a,U,u]),_e=ge.useMemo(()=>({position:"absolute",pointerEvents:D}),[D]);ge.useLayoutEffect(()=>{if(te.current=!1,u){var Me;(Me=F.current)==null||Me.render(ge.createElement("div",{ref:Y,style:le},ge.createElement("div",{ref:$,style:_e},ge.createElement("div",{ref:I,className:n,style:i,children:e}))))}else{var Ne;(Ne=F.current)==null||Ne.render(ge.createElement("div",{ref:I,style:le,className:n,children:e}))}});const be=ge.useRef(!0);Ab(Me=>{if(X.current){O.updateMatrixWorld(),X.current.updateWorldMatrix(!0,!1);const Ne=u?ne.current:A(X.current,O,U);if(u||Math.abs(W.current-O.zoom)>t||Math.abs(ne.current[0]-Ne[0])>t||Math.abs(ne.current[1]-Ne[1])>t){const Ge=Gpe(X.current,O);let We=!1;de&&(Array.isArray(h)?We=h.map(je=>je.current):h!=="blending"&&(We=[P]));const ae=be.current;if(We){const je=kpe(X.current,O,H,We);be.current=je&&!Ge}else be.current=!Ge;ae!==be.current&&(d?d(!be.current):J.style.display=be.current?"block":"none");const He=Math.floor(b[0]/2),Ke=h?de?[b[0],He]:[He-1,0]:b;if(J.style.zIndex=`${Wpe(X.current,O,Ke)}`,u){const[je,Oe]=[U.width/2,U.height/2],Qe=O.projectionMatrix.elements[5]*Oe,{isOrthographicCamera:$e,top:gt,left:pe,bottom:k,right:Q}=O,xe=Xpe(O.matrixWorldInverse),K=$e?`scale(${Qe})translate(${pU(-(Q+pe)/2)}px,${pU((gt+k)/2)}px)`:`translateZ(${Qe}px)`;let Re=X.current.matrixWorld;c&&(Re=O.matrixWorldInverse.clone().transpose().copyPosition(Re).scale(X.current.scale),Re.elements[3]=Re.elements[7]=Re.elements[11]=0,Re.elements[15]=1),J.style.width=U.width+"px",J.style.height=U.height+"px",J.style.perspective=$e?"":`${Qe}px`,Y.current&&$.current&&(Y.current.style.transform=`${K}${xe}translate(${je}px,${Oe}px)`,$.current.style.transform=qpe(Re,1/((l||10)/400)))}else{const je=l===void 0?1:jpe(X.current,O)*l;J.style.transform=`translate3d(${Ne[0]}px,${Ne[1]}px,0) scale(${je})`}ne.current=Ne,W.current=O.zoom}}if(!de&&fe.current&&!te.current)if(u){if(Y.current){const Ne=Y.current.children[0];if(Ne!=null&&Ne.clientWidth&&Ne!=null&&Ne.clientHeight){const{isOrthographicCamera:Ge}=O;if(Ge||y)T.scale&&(Array.isArray(T.scale)?T.scale instanceof me?fe.current.scale.copy(T.scale.clone().divideScalar(1)):fe.current.scale.set(1/T.scale[0],1/T.scale[1],1/T.scale[2]):fe.current.scale.setScalar(1/T.scale));else{const We=(l||10)/400,ae=Ne.clientWidth*We,He=Ne.clientHeight*We;fe.current.scale.set(ae,He,1)}te.current=!0}}}else{const Ne=J.children[0];if(Ne!=null&&Ne.clientWidth&&Ne!=null&&Ne.clientHeight){const Ge=1/j.factor,We=Ne.clientWidth*Ge,ae=Ne.clientHeight*Ge;fe.current.scale.set(We,ae,1),te.current=!0}fe.current.lookAt(Me.camera.position)}});const we=ge.useMemo(()=>({vertexShader:u?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[u]);return ge.createElement("group",_d({},T,{ref:X}),h&&!de&&ge.createElement("mesh",{castShadow:p,receiveShadow:g,ref:fe},y||ge.createElement("planeGeometry",null),x||ge.createElement("shaderMaterial",{side:Hc,vertexShader:we.vertexShader,fragmentShader:we.fragmentShader})))}),Kpe=e=>e;function Jpe(e,t=Kpe){const i=JC.useSyncExternalStore(e.subscribe,()=>t(e.getState()),()=>t(e.getInitialState()));return JC.useDebugValue(i),i}const pk=e=>{const t=wQ(e),i=n=>Jpe(t,n);return Object.assign(i,t),i},Zpe=e=>e?pk(e):pk;let b_=0;const $pe=Zpe(e=>(a1.onStart=(t,i,n)=>{e({active:!0,item:t,loaded:i,total:n,progress:(i-b_)/(n-b_)*100})},a1.onLoad=()=>{e({active:!1})},a1.onError=t=>e(i=>({errors:[...i.errors,t]})),a1.onProgress=(t,i,n)=>{i===n&&(b_=n),e({active:!0,item:t,loaded:i,total:n,progress:(i-b_)/(n-b_)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0}));function A1(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function mk(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function gk(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?mk(Object(i),!0).forEach(function(n){A1(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):mk(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}new Mt;new Mt;function qQ(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Mc=function e(t,i,n){var r=this;qQ(this,e),A1(this,"dot2",function(s,a){return r.x*s+r.y*a}),A1(this,"dot3",function(s,a,o){return r.x*s+r.y*a+r.z*o}),this.x=t,this.y=i,this.z=n},eme=[new Mc(1,1,0),new Mc(-1,1,0),new Mc(1,-1,0),new Mc(-1,-1,0),new Mc(1,0,1),new Mc(-1,0,1),new Mc(1,0,-1),new Mc(-1,0,-1),new Mc(0,1,1),new Mc(0,-1,1),new Mc(0,1,-1),new Mc(0,-1,-1)],vk=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],yk=new Array(512),xk=new Array(512),tme=function(t){t>0&&t<1&&(t*=65536),t=Math.floor(t),t<256&&(t|=t<<8);for(var i=0;i<256;i++){var n;i&1?n=vk[i]^t&255:n=vk[i]^t>>8&255,yk[i]=yk[i+256]=n,xk[i]=xk[i+256]=eme[n%12]}};tme(0);function ime(e){if(typeof e=="number")e=Math.abs(e);else if(typeof e=="string"){var t=e;e=0;for(var i=0;i<t.length;i++)e=(e+(i+1)*(t.charCodeAt(i)%96))%2147483647}return e===0&&(e=311),e}function bk(e){var t=ime(e);return function(){var i=t*48271%2147483647;return t=i,i/2147483647}}var nme=function e(t){var i=this;qQ(this,e),A1(this,"seed",0),A1(this,"init",function(n){i.seed=n,i.value=bk(n)}),A1(this,"value",bk(this.seed)),this.init(t)},rme=new nme(Math.random()),sme={radius:1,center:[0,0,0]};function ame(e,t){for(var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:rme,n=gk(gk({},sme),t),r=n.radius,s=n.center,a=0;a<e.length;a+=3){var o=Math.pow(i.value(),.3333333333333333),l=i.value()*2-1,c=i.value()*2-1,u=i.value()*2-1,h=Math.sqrt(l*l+c*c+u*u);l=o*l/h,c=o*c/h,u=o*u/h,e[a]=l*r+s[0],e[a+1]=c*r+s[1],e[a+2]=u*r+s[2]}return e}const ome=parseInt(mb.replace(/\D+/g,""));function Sk(e,t){if(t===hY)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t===ID||t===iF){let i=e.getIndex();if(i===null){const a=[],o=e.getAttribute("position");if(o!==void 0){for(let l=0;l<o.count;l++)a.push(l);e.setIndex(a),i=e.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e}const n=i.count-2,r=[];if(i)if(t===ID)for(let a=1;a<=n;a++)r.push(i.getX(0)),r.push(i.getX(a)),r.push(i.getX(a+1));else for(let a=0;a<n;a++)a%2===0?(r.push(i.getX(a)),r.push(i.getX(a+1)),r.push(i.getX(a+2))):(r.push(i.getX(a+2)),r.push(i.getX(a+1)),r.push(i.getX(a)));r.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=e.clone();return s.setIndex(r),s.clearGroups(),s}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}var lme=Object.defineProperty,cme=(e,t,i)=>t in e?lme(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,ume=(e,t,i)=>(cme(e,t+"",i),i);class hme{constructor(){ume(this,"_listeners")}addEventListener(t,i){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[t]===void 0&&(n[t]=[]),n[t].indexOf(i)===-1&&n[t].push(i)}hasEventListener(t,i){if(this._listeners===void 0)return!1;const n=this._listeners;return n[t]!==void 0&&n[t].indexOf(i)!==-1}removeEventListener(t,i){if(this._listeners===void 0)return;const r=this._listeners[t];if(r!==void 0){const s=r.indexOf(i);s!==-1&&r.splice(s,1)}}dispatchEvent(t){if(this._listeners===void 0)return;const n=this._listeners[t.type];if(n!==void 0){t.target=this;const r=n.slice(0);for(let s=0,a=r.length;s<a;s++)r[s].call(this,t);t.target=null}}}var dme=Object.defineProperty,fme=(e,t,i)=>t in e?dme(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,wi=(e,t,i)=>(fme(e,typeof t!="symbol"?t+"":t,i),i);const W2=new k0,_k=new Ef,pme=Math.cos(70*(Math.PI/180)),Ak=(e,t)=>(e%t+t)%t;let mme=class extends hme{constructor(t,i){super(),wi(this,"object"),wi(this,"domElement"),wi(this,"enabled",!0),wi(this,"target",new me),wi(this,"minDistance",0),wi(this,"maxDistance",1/0),wi(this,"minZoom",0),wi(this,"maxZoom",1/0),wi(this,"minPolarAngle",0),wi(this,"maxPolarAngle",Math.PI),wi(this,"minAzimuthAngle",-1/0),wi(this,"maxAzimuthAngle",1/0),wi(this,"enableDamping",!1),wi(this,"dampingFactor",.05),wi(this,"enableZoom",!0),wi(this,"zoomSpeed",1),wi(this,"enableRotate",!0),wi(this,"rotateSpeed",1),wi(this,"enablePan",!0),wi(this,"panSpeed",1),wi(this,"screenSpacePanning",!0),wi(this,"keyPanSpeed",7),wi(this,"zoomToCursor",!1),wi(this,"autoRotate",!1),wi(this,"autoRotateSpeed",2),wi(this,"reverseOrbit",!1),wi(this,"reverseHorizontalOrbit",!1),wi(this,"reverseVerticalOrbit",!1),wi(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),wi(this,"mouseButtons",{LEFT:Lv.ROTATE,MIDDLE:Lv.DOLLY,RIGHT:Lv.PAN}),wi(this,"touches",{ONE:Uv.ROTATE,TWO:Uv.DOLLY_PAN}),wi(this,"target0"),wi(this,"position0"),wi(this,"zoom0"),wi(this,"_domElementKeyEvents",null),wi(this,"getPolarAngle"),wi(this,"getAzimuthalAngle"),wi(this,"setPolarAngle"),wi(this,"setAzimuthalAngle"),wi(this,"getDistance"),wi(this,"getZoomScale"),wi(this,"listenToKeyEvents"),wi(this,"stopListenToKeyEvents"),wi(this,"saveState"),wi(this,"reset"),wi(this,"update"),wi(this,"connect"),wi(this,"dispose"),wi(this,"dollyIn"),wi(this,"dollyOut"),wi(this,"getScale"),wi(this,"setScale"),this.object=t,this.domElement=i,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>u.phi,this.getAzimuthalAngle=()=>u.theta,this.setPolarAngle=ye=>{let Ve=Ak(ye,2*Math.PI),At=u.phi;At<0&&(At+=2*Math.PI),Ve<0&&(Ve+=2*Math.PI);let ie=Math.abs(Ve-At);2*Math.PI-ie<ie&&(Ve<At?Ve+=2*Math.PI:At+=2*Math.PI),h.phi=Ve-At,n.update()},this.setAzimuthalAngle=ye=>{let Ve=Ak(ye,2*Math.PI),At=u.theta;At<0&&(At+=2*Math.PI),Ve<0&&(Ve+=2*Math.PI);let ie=Math.abs(Ve-At);2*Math.PI-ie<ie&&(Ve<At?Ve+=2*Math.PI:At+=2*Math.PI),h.theta=Ve-At,n.update()},this.getDistance=()=>n.object.position.distanceTo(n.target),this.listenToKeyEvents=ye=>{ye.addEventListener("keydown",Le),this._domElementKeyEvents=ye},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",Le),this._domElementKeyEvents=null},this.saveState=()=>{n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=()=>{n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(r),n.update(),l=o.NONE},this.update=(()=>{const ye=new me,Ve=new me(0,1,0),At=new ba().setFromUnitVectors(t.up,Ve),ie=At.clone().invert(),Ce=new me,De=new ba,at=2*Math.PI;return function(){const lt=n.object.position;At.setFromUnitVectors(t.up,Ve),ie.copy(At).invert(),ye.copy(lt).sub(n.target),ye.applyQuaternion(At),u.setFromVector3(ye),n.autoRotate&&l===o.NONE&&j(H()),n.enableDamping?(u.theta+=h.theta*n.dampingFactor,u.phi+=h.phi*n.dampingFactor):(u.theta+=h.theta,u.phi+=h.phi);let It=n.minAzimuthAngle,Vt=n.maxAzimuthAngle;isFinite(It)&&isFinite(Vt)&&(It<-Math.PI?It+=at:It>Math.PI&&(It-=at),Vt<-Math.PI?Vt+=at:Vt>Math.PI&&(Vt-=at),It<=Vt?u.theta=Math.max(It,Math.min(Vt,u.theta)):u.theta=u.theta>(It+Vt)/2?Math.max(It,u.theta):Math.min(Vt,u.theta)),u.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,u.phi)),u.makeSafe(),n.enableDamping===!0?n.target.addScaledVector(p,n.dampingFactor):n.target.add(p),n.zoomToCursor&&O||n.object.isOrthographicCamera?u.radius=fe(u.radius):u.radius=fe(u.radius*d),ye.setFromSpherical(u),ye.applyQuaternion(ie),lt.copy(n.target).add(ye),n.object.matrixAutoUpdate||n.object.updateMatrix(),n.object.lookAt(n.target),n.enableDamping===!0?(h.theta*=1-n.dampingFactor,h.phi*=1-n.dampingFactor,p.multiplyScalar(1-n.dampingFactor)):(h.set(0,0,0),p.set(0,0,0));let _i=!1;if(n.zoomToCursor&&O){let Jt=null;if(n.object instanceof Dr&&n.object.isPerspectiveCamera){const An=ye.length();Jt=fe(An*d);const $i=An-Jt;n.object.position.addScaledVector(I,$i),n.object.updateMatrixWorld()}else if(n.object.isOrthographicCamera){const An=new me(R.x,R.y,0);An.unproject(n.object),n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/d)),n.object.updateProjectionMatrix(),_i=!0;const $i=new me(R.x,R.y,0);$i.unproject(n.object),n.object.position.sub($i).add(An),n.object.updateMatrixWorld(),Jt=ye.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),n.zoomToCursor=!1;Jt!==null&&(n.screenSpacePanning?n.target.set(0,0,-1).transformDirection(n.object.matrix).multiplyScalar(Jt).add(n.object.position):(W2.origin.copy(n.object.position),W2.direction.set(0,0,-1).transformDirection(n.object.matrix),Math.abs(n.object.up.dot(W2.direction))<pme?t.lookAt(n.target):(_k.setFromNormalAndCoplanarPoint(n.object.up,n.target),W2.intersectPlane(_k,n.target))))}else n.object instanceof Qu&&n.object.isOrthographicCamera&&(_i=d!==1,_i&&(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/d)),n.object.updateProjectionMatrix()));return d=1,O=!1,_i||Ce.distanceToSquared(n.object.position)>c||8*(1-De.dot(n.object.quaternion))>c?(n.dispatchEvent(r),Ce.copy(n.object.position),De.copy(n.object.quaternion),_i=!1,!0):!1}})(),this.connect=ye=>{n.domElement=ye,n.domElement.style.touchAction="none",n.domElement.addEventListener("contextmenu",bt),n.domElement.addEventListener("pointerdown",pe),n.domElement.addEventListener("pointercancel",Q),n.domElement.addEventListener("wheel",Re)},this.dispose=()=>{var ye,Ve,At,ie,Ce,De;n.domElement&&(n.domElement.style.touchAction="auto"),(ye=n.domElement)==null||ye.removeEventListener("contextmenu",bt),(Ve=n.domElement)==null||Ve.removeEventListener("pointerdown",pe),(At=n.domElement)==null||At.removeEventListener("pointercancel",Q),(ie=n.domElement)==null||ie.removeEventListener("wheel",Re),(Ce=n.domElement)==null||Ce.ownerDocument.removeEventListener("pointermove",k),(De=n.domElement)==null||De.ownerDocument.removeEventListener("pointerup",Q),n._domElementKeyEvents!==null&&n._domElementKeyEvents.removeEventListener("keydown",Le)};const n=this,r={type:"change"},s={type:"start"},a={type:"end"},o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let l=o.NONE;const c=1e-6,u=new rU,h=new rU;let d=1;const p=new me,g=new Mt,x=new Mt,y=new Mt,b=new Mt,A=new Mt,w=new Mt,E=new Mt,D=new Mt,T=new Mt,I=new me,R=new Mt;let O=!1;const P=[],U={};function H(){return 2*Math.PI/60/60*n.autoRotateSpeed}function V(){return Math.pow(.95,n.zoomSpeed)}function j(ye){n.reverseOrbit||n.reverseHorizontalOrbit?h.theta+=ye:h.theta-=ye}function J(ye){n.reverseOrbit||n.reverseVerticalOrbit?h.phi+=ye:h.phi-=ye}const F=(()=>{const ye=new me;return function(At,ie){ye.setFromMatrixColumn(ie,0),ye.multiplyScalar(-At),p.add(ye)}})(),X=(()=>{const ye=new me;return function(At,ie){n.screenSpacePanning===!0?ye.setFromMatrixColumn(ie,1):(ye.setFromMatrixColumn(ie,0),ye.crossVectors(n.object.up,ye)),ye.multiplyScalar(At),p.add(ye)}})(),W=(()=>{const ye=new me;return function(At,ie){const Ce=n.domElement;if(Ce&&n.object instanceof Dr&&n.object.isPerspectiveCamera){const De=n.object.position;ye.copy(De).sub(n.target);let at=ye.length();at*=Math.tan(n.object.fov/2*Math.PI/180),F(2*At*at/Ce.clientHeight,n.object.matrix),X(2*ie*at/Ce.clientHeight,n.object.matrix)}else Ce&&n.object instanceof Qu&&n.object.isOrthographicCamera?(F(At*(n.object.right-n.object.left)/n.object.zoom/Ce.clientWidth,n.object.matrix),X(ie*(n.object.top-n.object.bottom)/n.object.zoom/Ce.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}})();function ne(ye){n.object instanceof Dr&&n.object.isPerspectiveCamera||n.object instanceof Qu&&n.object.isOrthographicCamera?d=ye:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function Y(ye){ne(d/ye)}function $(ye){ne(d*ye)}function se(ye){if(!n.zoomToCursor||!n.domElement)return;O=!0;const Ve=n.domElement.getBoundingClientRect(),At=ye.clientX-Ve.left,ie=ye.clientY-Ve.top,Ce=Ve.width,De=Ve.height;R.x=At/Ce*2-1,R.y=-(ie/De)*2+1,I.set(R.x,R.y,1).unproject(n.object).sub(n.object.position).normalize()}function fe(ye){return Math.max(n.minDistance,Math.min(n.maxDistance,ye))}function te(ye){g.set(ye.clientX,ye.clientY)}function de(ye){se(ye),E.set(ye.clientX,ye.clientY)}function le(ye){b.set(ye.clientX,ye.clientY)}function _e(ye){x.set(ye.clientX,ye.clientY),y.subVectors(x,g).multiplyScalar(n.rotateSpeed);const Ve=n.domElement;Ve&&(j(2*Math.PI*y.x/Ve.clientHeight),J(2*Math.PI*y.y/Ve.clientHeight)),g.copy(x),n.update()}function be(ye){D.set(ye.clientX,ye.clientY),T.subVectors(D,E),T.y>0?Y(V()):T.y<0&&$(V()),E.copy(D),n.update()}function we(ye){A.set(ye.clientX,ye.clientY),w.subVectors(A,b).multiplyScalar(n.panSpeed),W(w.x,w.y),b.copy(A),n.update()}function Me(ye){se(ye),ye.deltaY<0?$(V()):ye.deltaY>0&&Y(V()),n.update()}function Ne(ye){let Ve=!1;switch(ye.code){case n.keys.UP:W(0,n.keyPanSpeed),Ve=!0;break;case n.keys.BOTTOM:W(0,-n.keyPanSpeed),Ve=!0;break;case n.keys.LEFT:W(n.keyPanSpeed,0),Ve=!0;break;case n.keys.RIGHT:W(-n.keyPanSpeed,0),Ve=!0;break}Ve&&(ye.preventDefault(),n.update())}function Ge(){if(P.length==1)g.set(P[0].pageX,P[0].pageY);else{const ye=.5*(P[0].pageX+P[1].pageX),Ve=.5*(P[0].pageY+P[1].pageY);g.set(ye,Ve)}}function We(){if(P.length==1)b.set(P[0].pageX,P[0].pageY);else{const ye=.5*(P[0].pageX+P[1].pageX),Ve=.5*(P[0].pageY+P[1].pageY);b.set(ye,Ve)}}function ae(){const ye=P[0].pageX-P[1].pageX,Ve=P[0].pageY-P[1].pageY,At=Math.sqrt(ye*ye+Ve*Ve);E.set(0,At)}function He(){n.enableZoom&&ae(),n.enablePan&&We()}function Ke(){n.enableZoom&&ae(),n.enableRotate&&Ge()}function je(ye){if(P.length==1)x.set(ye.pageX,ye.pageY);else{const At=_t(ye),ie=.5*(ye.pageX+At.x),Ce=.5*(ye.pageY+At.y);x.set(ie,Ce)}y.subVectors(x,g).multiplyScalar(n.rotateSpeed);const Ve=n.domElement;Ve&&(j(2*Math.PI*y.x/Ve.clientHeight),J(2*Math.PI*y.y/Ve.clientHeight)),g.copy(x)}function Oe(ye){if(P.length==1)A.set(ye.pageX,ye.pageY);else{const Ve=_t(ye),At=.5*(ye.pageX+Ve.x),ie=.5*(ye.pageY+Ve.y);A.set(At,ie)}w.subVectors(A,b).multiplyScalar(n.panSpeed),W(w.x,w.y),b.copy(A)}function Qe(ye){const Ve=_t(ye),At=ye.pageX-Ve.x,ie=ye.pageY-Ve.y,Ce=Math.sqrt(At*At+ie*ie);D.set(0,Ce),T.set(0,Math.pow(D.y/E.y,n.zoomSpeed)),Y(T.y),E.copy(D)}function $e(ye){n.enableZoom&&Qe(ye),n.enablePan&&Oe(ye)}function gt(ye){n.enableZoom&&Qe(ye),n.enableRotate&&je(ye)}function pe(ye){var Ve,At;n.enabled!==!1&&(P.length===0&&((Ve=n.domElement)==null||Ve.ownerDocument.addEventListener("pointermove",k),(At=n.domElement)==null||At.ownerDocument.addEventListener("pointerup",Q)),vt(ye),ye.pointerType==="touch"?st(ye):xe(ye))}function k(ye){n.enabled!==!1&&(ye.pointerType==="touch"?Be(ye):K(ye))}function Q(ye){var Ve,At,ie;Xe(ye),P.length===0&&((Ve=n.domElement)==null||Ve.releasePointerCapture(ye.pointerId),(At=n.domElement)==null||At.ownerDocument.removeEventListener("pointermove",k),(ie=n.domElement)==null||ie.ownerDocument.removeEventListener("pointerup",Q)),n.dispatchEvent(a),l=o.NONE}function xe(ye){let Ve;switch(ye.button){case 0:Ve=n.mouseButtons.LEFT;break;case 1:Ve=n.mouseButtons.MIDDLE;break;case 2:Ve=n.mouseButtons.RIGHT;break;default:Ve=-1}switch(Ve){case Lv.DOLLY:if(n.enableZoom===!1)return;de(ye),l=o.DOLLY;break;case Lv.ROTATE:if(ye.ctrlKey||ye.metaKey||ye.shiftKey){if(n.enablePan===!1)return;le(ye),l=o.PAN}else{if(n.enableRotate===!1)return;te(ye),l=o.ROTATE}break;case Lv.PAN:if(ye.ctrlKey||ye.metaKey||ye.shiftKey){if(n.enableRotate===!1)return;te(ye),l=o.ROTATE}else{if(n.enablePan===!1)return;le(ye),l=o.PAN}break;default:l=o.NONE}l!==o.NONE&&n.dispatchEvent(s)}function K(ye){if(n.enabled!==!1)switch(l){case o.ROTATE:if(n.enableRotate===!1)return;_e(ye);break;case o.DOLLY:if(n.enableZoom===!1)return;be(ye);break;case o.PAN:if(n.enablePan===!1)return;we(ye);break}}function Re(ye){n.enabled===!1||n.enableZoom===!1||l!==o.NONE&&l!==o.ROTATE||(ye.preventDefault(),n.dispatchEvent(s),Me(ye),n.dispatchEvent(a))}function Le(ye){n.enabled===!1||n.enablePan===!1||Ne(ye)}function st(ye){switch(xt(ye),P.length){case 1:switch(n.touches.ONE){case Uv.ROTATE:if(n.enableRotate===!1)return;Ge(),l=o.TOUCH_ROTATE;break;case Uv.PAN:if(n.enablePan===!1)return;We(),l=o.TOUCH_PAN;break;default:l=o.NONE}break;case 2:switch(n.touches.TWO){case Uv.DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;He(),l=o.TOUCH_DOLLY_PAN;break;case Uv.DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;Ke(),l=o.TOUCH_DOLLY_ROTATE;break;default:l=o.NONE}break;default:l=o.NONE}l!==o.NONE&&n.dispatchEvent(s)}function Be(ye){switch(xt(ye),l){case o.TOUCH_ROTATE:if(n.enableRotate===!1)return;je(ye),n.update();break;case o.TOUCH_PAN:if(n.enablePan===!1)return;Oe(ye),n.update();break;case o.TOUCH_DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;$e(ye),n.update();break;case o.TOUCH_DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;gt(ye),n.update();break;default:l=o.NONE}}function bt(ye){n.enabled!==!1&&ye.preventDefault()}function vt(ye){P.push(ye)}function Xe(ye){delete U[ye.pointerId];for(let Ve=0;Ve<P.length;Ve++)if(P[Ve].pointerId==ye.pointerId){P.splice(Ve,1);return}}function xt(ye){let Ve=U[ye.pointerId];Ve===void 0&&(Ve=new Mt,U[ye.pointerId]=Ve),Ve.set(ye.pageX,ye.pageY)}function _t(ye){const Ve=ye.pointerId===P[0].pointerId?P[1]:P[0];return U[Ve.pointerId]}this.dollyIn=(ye=V())=>{$(ye),n.update()},this.dollyOut=(ye=V())=>{Y(ye),n.update()},this.getScale=()=>d,this.setScale=ye=>{ne(ye),n.update()},this.getZoomScale=()=>V(),i!==void 0&&this.connect(i),this.update()}};function kD(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let i=0,n=e.length;i<n;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch{return t}}const i0="srgb",qf="srgb-linear",wk=3001,gme=3e3;class XF extends _o{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(i){return new Sme(i)}),this.register(function(i){return new _me(i)}),this.register(function(i){return new Pme(i)}),this.register(function(i){return new Ome(i)}),this.register(function(i){return new Bme(i)}),this.register(function(i){return new wme(i)}),this.register(function(i){return new Mme(i)}),this.register(function(i){return new Eme(i)}),this.register(function(i){return new Tme(i)}),this.register(function(i){return new bme(i)}),this.register(function(i){return new Cme(i)}),this.register(function(i){return new Ame(i)}),this.register(function(i){return new Rme(i)}),this.register(function(i){return new Dme(i)}),this.register(function(i){return new yme(i)}),this.register(function(i){return new Ime(i)}),this.register(function(i){return new Lme(i)})}load(t,i,n,r){const s=this;let a;if(this.resourcePath!=="")a=this.resourcePath;else if(this.path!==""){const c=Wm.extractUrlBase(t);a=Wm.resolveURL(c,this.path)}else a=Wm.extractUrlBase(t);this.manager.itemStart(t);const o=function(c){r?r(c):console.error(c),s.manager.itemError(t),s.manager.itemEnd(t)},l=new ic(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(t,function(c){try{s.parse(c,a,function(u){i(u),s.manager.itemEnd(t)},o)}catch(u){o(u)}},n,o)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return this.pluginCallbacks.indexOf(t)===-1&&this.pluginCallbacks.push(t),this}unregister(t){return this.pluginCallbacks.indexOf(t)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,i,n,r){let s;const a={},o={};if(typeof t=="string")s=JSON.parse(t);else if(t instanceof ArrayBuffer)if(kD(new Uint8Array(t.slice(0,4)))===YQ){try{a[fn.KHR_BINARY_GLTF]=new Ume(t)}catch(u){r&&r(u);return}s=JSON.parse(a[fn.KHR_BINARY_GLTF].content)}else s=JSON.parse(kD(new Uint8Array(t)));else s=t;if(s.asset===void 0||s.asset.version[0]<2){r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new Qme(s,{path:i||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let c=0;c<this.pluginCallbacks.length;c++){const u=this.pluginCallbacks[c](l);u.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),o[u.name]=u,a[u.name]=!0}if(s.extensionsUsed)for(let c=0;c<s.extensionsUsed.length;++c){const u=s.extensionsUsed[c],h=s.extensionsRequired||[];switch(u){case fn.KHR_MATERIALS_UNLIT:a[u]=new xme;break;case fn.KHR_DRACO_MESH_COMPRESSION:a[u]=new Nme(s,this.dracoLoader);break;case fn.KHR_TEXTURE_TRANSFORM:a[u]=new zme;break;case fn.KHR_MESH_QUANTIZATION:a[u]=new Fme;break;default:h.indexOf(u)>=0&&o[u]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}l.setExtensions(a),l.setPlugins(o),l.parse(n,r)}parseAsync(t,i){const n=this;return new Promise(function(r,s){n.parse(t,i,r,s)})}}function vme(){let e={};return{get:function(t){return e[t]},add:function(t,i){e[t]=i},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const fn={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class yme{constructor(t){this.parser=t,this.name=fn.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,i=this.parser.json.nodes||[];for(let n=0,r=i.length;n<r;n++){const s=i[n];s.extensions&&s.extensions[this.name]&&s.extensions[this.name].light!==void 0&&t._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(t){const i=this.parser,n="light:"+t;let r=i.cache.get(n);if(r)return r;const s=i.json,l=((s.extensions&&s.extensions[this.name]||{}).lights||[])[t];let c;const u=new jt(16777215);l.color!==void 0&&u.setRGB(l.color[0],l.color[1],l.color[2],qf);const h=l.range!==void 0?l.range:0;switch(l.type){case"directional":c=new BF(u),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new OF(u),c.distance=h;break;case"spot":c=new PF(u),c.distance=h,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,c.angle=l.spot.outerConeAngle,c.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return c.position.set(0,0,0),c.decay=2,Af(c,l),l.intensity!==void 0&&(c.intensity=l.intensity),c.name=i.createUniqueName(l.name||"light_"+t),r=Promise.resolve(c),i.cache.add(n,r),r}getDependency(t,i){if(t==="light")return this._loadLight(i)}createNodeAttachment(t){const i=this,n=this.parser,s=n.json.nodes[t],o=(s.extensions&&s.extensions[this.name]||{}).light;return o===void 0?null:this._loadLight(o).then(function(l){return n._getNodeRef(i.cache,o,l)})}}class xme{constructor(){this.name=fn.KHR_MATERIALS_UNLIT}getMaterialType(){return $l}extendParams(t,i,n){const r=[];t.color=new jt(1,1,1),t.opacity=1;const s=i.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const a=s.baseColorFactor;t.color.setRGB(a[0],a[1],a[2],qf),t.opacity=a[3]}s.baseColorTexture!==void 0&&r.push(n.assignTexture(t,"map",s.baseColorTexture,i0))}return Promise.all(r)}}class bme{constructor(t){this.parser=t,this.name=fn.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(t,i){const r=this.parser.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name].emissiveStrength;return s!==void 0&&(i.emissiveIntensity=s),Promise.resolve()}}class Sme{constructor(t){this.parser=t,this.name=fn.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:eu}extendMaterialParams(t,i){const n=this.parser,r=n.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],a=r.extensions[this.name];if(a.clearcoatFactor!==void 0&&(i.clearcoat=a.clearcoatFactor),a.clearcoatTexture!==void 0&&s.push(n.assignTexture(i,"clearcoatMap",a.clearcoatTexture)),a.clearcoatRoughnessFactor!==void 0&&(i.clearcoatRoughness=a.clearcoatRoughnessFactor),a.clearcoatRoughnessTexture!==void 0&&s.push(n.assignTexture(i,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),a.clearcoatNormalTexture!==void 0&&(s.push(n.assignTexture(i,"clearcoatNormalMap",a.clearcoatNormalTexture)),a.clearcoatNormalTexture.scale!==void 0)){const o=a.clearcoatNormalTexture.scale;i.clearcoatNormalScale=new Mt(o,o)}return Promise.all(s)}}class _me{constructor(t){this.parser=t,this.name=fn.KHR_MATERIALS_DISPERSION}getMaterialType(t){const n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:eu}extendMaterialParams(t,i){const r=this.parser.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name];return i.dispersion=s.dispersion!==void 0?s.dispersion:0,Promise.resolve()}}class Ame{constructor(t){this.parser=t,this.name=fn.KHR_MATERIALS_IRIDESCENCE}getMaterialType(t){const n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:eu}extendMaterialParams(t,i){const n=this.parser,r=n.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],a=r.extensions[this.name];return a.iridescenceFactor!==void 0&&(i.iridescence=a.iridescenceFactor),a.iridescenceTexture!==void 0&&s.push(n.assignTexture(i,"iridescenceMap",a.iridescenceTexture)),a.iridescenceIor!==void 0&&(i.iridescenceIOR=a.iridescenceIor),i.iridescenceThicknessRange===void 0&&(i.iridescenceThicknessRange=[100,400]),a.iridescenceThicknessMinimum!==void 0&&(i.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),a.iridescenceThicknessMaximum!==void 0&&(i.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),a.iridescenceThicknessTexture!==void 0&&s.push(n.assignTexture(i,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(s)}}class wme{constructor(t){this.parser=t,this.name=fn.KHR_MATERIALS_SHEEN}getMaterialType(t){const n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:eu}extendMaterialParams(t,i){const n=this.parser,r=n.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[];i.sheenColor=new jt(0,0,0),i.sheenRoughness=0,i.sheen=1;const a=r.extensions[this.name];if(a.sheenColorFactor!==void 0){const o=a.sheenColorFactor;i.sheenColor.setRGB(o[0],o[1],o[2],qf)}return a.sheenRoughnessFactor!==void 0&&(i.sheenRoughness=a.sheenRoughnessFactor),a.sheenColorTexture!==void 0&&s.push(n.assignTexture(i,"sheenColorMap",a.sheenColorTexture,i0)),a.sheenRoughnessTexture!==void 0&&s.push(n.assignTexture(i,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(s)}}class Mme{constructor(t){this.parser=t,this.name=fn.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:eu}extendMaterialParams(t,i){const n=this.parser,r=n.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],a=r.extensions[this.name];return a.transmissionFactor!==void 0&&(i.transmission=a.transmissionFactor),a.transmissionTexture!==void 0&&s.push(n.assignTexture(i,"transmissionMap",a.transmissionTexture)),Promise.all(s)}}class Eme{constructor(t){this.parser=t,this.name=fn.KHR_MATERIALS_VOLUME}getMaterialType(t){const n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:eu}extendMaterialParams(t,i){const n=this.parser,r=n.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],a=r.extensions[this.name];i.thickness=a.thicknessFactor!==void 0?a.thicknessFactor:0,a.thicknessTexture!==void 0&&s.push(n.assignTexture(i,"thicknessMap",a.thicknessTexture)),i.attenuationDistance=a.attenuationDistance||1/0;const o=a.attenuationColor||[1,1,1];return i.attenuationColor=new jt().setRGB(o[0],o[1],o[2],qf),Promise.all(s)}}class Tme{constructor(t){this.parser=t,this.name=fn.KHR_MATERIALS_IOR}getMaterialType(t){const n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:eu}extendMaterialParams(t,i){const r=this.parser.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name];return i.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}}class Cme{constructor(t){this.parser=t,this.name=fn.KHR_MATERIALS_SPECULAR}getMaterialType(t){const n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:eu}extendMaterialParams(t,i){const n=this.parser,r=n.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],a=r.extensions[this.name];i.specularIntensity=a.specularFactor!==void 0?a.specularFactor:1,a.specularTexture!==void 0&&s.push(n.assignTexture(i,"specularIntensityMap",a.specularTexture));const o=a.specularColorFactor||[1,1,1];return i.specularColor=new jt().setRGB(o[0],o[1],o[2],qf),a.specularColorTexture!==void 0&&s.push(n.assignTexture(i,"specularColorMap",a.specularColorTexture,i0)),Promise.all(s)}}class Dme{constructor(t){this.parser=t,this.name=fn.EXT_MATERIALS_BUMP}getMaterialType(t){const n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:eu}extendMaterialParams(t,i){const n=this.parser,r=n.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],a=r.extensions[this.name];return i.bumpScale=a.bumpFactor!==void 0?a.bumpFactor:1,a.bumpTexture!==void 0&&s.push(n.assignTexture(i,"bumpMap",a.bumpTexture)),Promise.all(s)}}class Rme{constructor(t){this.parser=t,this.name=fn.KHR_MATERIALS_ANISOTROPY}getMaterialType(t){const n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:eu}extendMaterialParams(t,i){const n=this.parser,r=n.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],a=r.extensions[this.name];return a.anisotropyStrength!==void 0&&(i.anisotropy=a.anisotropyStrength),a.anisotropyRotation!==void 0&&(i.anisotropyRotation=a.anisotropyRotation),a.anisotropyTexture!==void 0&&s.push(n.assignTexture(i,"anisotropyMap",a.anisotropyTexture)),Promise.all(s)}}class Pme{constructor(t){this.parser=t,this.name=fn.KHR_TEXTURE_BASISU}loadTexture(t){const i=this.parser,n=i.json,r=n.textures[t];if(!r.extensions||!r.extensions[this.name])return null;const s=r.extensions[this.name],a=i.options.ktx2Loader;if(!a){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return i.loadTextureImage(t,s.source,a)}}class Ome{constructor(t){this.parser=t,this.name=fn.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const i=this.name,n=this.parser,r=n.json,s=r.textures[t];if(!s.extensions||!s.extensions[i])return null;const a=s.extensions[i],o=r.images[a.source];let l=n.textureLoader;if(o.uri){const c=n.options.manager.getHandler(o.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return n.loadTextureImage(t,a.source,l);if(r.extensionsRequired&&r.extensionsRequired.indexOf(i)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const i=new Image;i.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",i.onload=i.onerror=function(){t(i.height===1)}})),this.isSupported}}class Bme{constructor(t){this.parser=t,this.name=fn.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(t){const i=this.name,n=this.parser,r=n.json,s=r.textures[t];if(!s.extensions||!s.extensions[i])return null;const a=s.extensions[i],o=r.images[a.source];let l=n.textureLoader;if(o.uri){const c=n.options.manager.getHandler(o.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return n.loadTextureImage(t,a.source,l);if(r.extensionsRequired&&r.extensionsRequired.indexOf(i)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const i=new Image;i.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",i.onload=i.onerror=function(){t(i.height===1)}})),this.isSupported}}class Ime{constructor(t){this.name=fn.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const i=this.parser.json,n=i.bufferViews[t];if(n.extensions&&n.extensions[this.name]){const r=n.extensions[this.name],s=this.parser.getDependency("buffer",r.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(o){const l=r.byteOffset||0,c=r.byteLength||0,u=r.count,h=r.byteStride,d=new Uint8Array(o,l,c);return a.decodeGltfBufferAsync?a.decodeGltfBufferAsync(u,h,d,r.mode,r.filter).then(function(p){return p.buffer}):a.ready.then(function(){const p=new ArrayBuffer(u*h);return a.decodeGltfBuffer(new Uint8Array(p),u,h,d,r.mode,r.filter),p})})}else return null}}class Lme{constructor(t){this.name=fn.EXT_MESH_GPU_INSTANCING,this.parser=t}createNodeMesh(t){const i=this.parser.json,n=i.nodes[t];if(!n.extensions||!n.extensions[this.name]||n.mesh===void 0)return null;const r=i.meshes[n.mesh];for(const c of r.primitives)if(c.mode!==Ic.TRIANGLES&&c.mode!==Ic.TRIANGLE_STRIP&&c.mode!==Ic.TRIANGLE_FAN&&c.mode!==void 0)return null;const a=n.extensions[this.name].attributes,o=[],l={};for(const c in a)o.push(this.parser.getDependency("accessor",a[c]).then(u=>(l[c]=u,l[c])));return o.length<1?null:(o.push(this.parser.createNodeMesh(t)),Promise.all(o).then(c=>{const u=c.pop(),h=u.isGroup?u.children:[u],d=c[0].count,p=[];for(const g of h){const x=new di,y=new me,b=new ba,A=new me(1,1,1),w=new pF(g.geometry,g.material,d);for(let E=0;E<d;E++)l.TRANSLATION&&y.fromBufferAttribute(l.TRANSLATION,E),l.ROTATION&&b.fromBufferAttribute(l.ROTATION,E),l.SCALE&&A.fromBufferAttribute(l.SCALE,E),w.setMatrixAt(E,x.compose(y,b,A));for(const E in l)if(E==="_COLOR_0"){const D=l[E];w.instanceColor=new T0(D.array,D.itemSize,D.normalized)}else E!=="TRANSLATION"&&E!=="ROTATION"&&E!=="SCALE"&&g.geometry.setAttribute(E,l[E]);gn.prototype.copy.call(w,g),this.parser.assignFinalMaterial(w),p.push(w)}return u.isGroup?(u.clear(),u.add(...p),u):p[0]}))}}const YQ="glTF",S_=12,Mk={JSON:1313821514,BIN:5130562};class Ume{constructor(t){this.name=fn.KHR_BINARY_GLTF,this.content=null,this.body=null;const i=new DataView(t,0,S_);if(this.header={magic:kD(new Uint8Array(t.slice(0,4))),version:i.getUint32(4,!0),length:i.getUint32(8,!0)},this.header.magic!==YQ)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-S_,r=new DataView(t,S_);let s=0;for(;s<n;){const a=r.getUint32(s,!0);s+=4;const o=r.getUint32(s,!0);if(s+=4,o===Mk.JSON){const l=new Uint8Array(t,S_+s,a);this.content=kD(l)}else if(o===Mk.BIN){const l=S_+s;this.body=t.slice(l,l+a)}s+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Nme{constructor(t,i){if(!i)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=fn.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=i,this.dracoLoader.preload()}decodePrimitive(t,i){const n=this.json,r=this.dracoLoader,s=t.extensions[this.name].bufferView,a=t.extensions[this.name].attributes,o={},l={},c={};for(const u in a){const h=mU[u]||u.toLowerCase();o[h]=a[u]}for(const u in t.attributes){const h=mU[u]||u.toLowerCase();if(a[u]!==void 0){const d=n.accessors[t.attributes[u]],p=w1[d.componentType];c[h]=p.name,l[h]=d.normalized===!0}}return i.getDependency("bufferView",s).then(function(u){return new Promise(function(h,d){r.decodeDracoFile(u,function(p){for(const g in p.attributes){const x=p.attributes[g],y=l[g];y!==void 0&&(x.normalized=y)}h(p)},o,c,qf,d)})})}}class zme{constructor(){this.name=fn.KHR_TEXTURE_TRANSFORM}extendTexture(t,i){return(i.texCoord===void 0||i.texCoord===t.channel)&&i.offset===void 0&&i.rotation===void 0&&i.scale===void 0||(t=t.clone(),i.texCoord!==void 0&&(t.channel=i.texCoord),i.offset!==void 0&&t.offset.fromArray(i.offset),i.rotation!==void 0&&(t.rotation=i.rotation),i.scale!==void 0&&t.repeat.fromArray(i.scale),t.needsUpdate=!0),t}}class Fme{constructor(){this.name=fn.KHR_MESH_QUANTIZATION}}class QQ extends bb{constructor(t,i,n,r){super(t,i,n,r)}copySampleValue_(t){const i=this.resultBuffer,n=this.sampleValues,r=this.valueSize,s=t*r*3+r;for(let a=0;a!==r;a++)i[a]=n[s+a];return i}interpolate_(t,i,n,r){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=o*2,c=o*3,u=r-i,h=(n-i)/u,d=h*h,p=d*h,g=t*c,x=g-c,y=-2*p+3*d,b=p-d,A=1-y,w=b-d+h;for(let E=0;E!==o;E++){const D=a[x+E+o],T=a[x+E+l]*u,I=a[g+E+o],R=a[g+E]*u;s[E]=A*D+w*T+y*I+b*R}return s}}const Vme=new ba;class Hme extends QQ{interpolate_(t,i,n,r){const s=super.interpolate_(t,i,n,r);return Vme.fromArray(s).normalize().toArray(s),s}}const Ic={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},w1={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Ek={9728:xa,9729:hs,9984:aR,9985:b1,9986:Jv,9987:kc},Tk={33071:Zl,33648:z1,10497:Zm},fB={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},mU={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...ome>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},cm={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Gme={CUBICSPLINE:void 0,LINEAR:j1,STEP:k1},pB={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function kme(e){return e.DefaultMaterial===void 0&&(e.DefaultMaterial=new Kw({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:bd})),e.DefaultMaterial}function Av(e,t,i){for(const n in i.extensions)e[n]===void 0&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[n]=i.extensions[n])}function Af(e,t){t.extras!==void 0&&(typeof t.extras=="object"?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function jme(e,t,i){let n=!1,r=!1,s=!1;for(let c=0,u=t.length;c<u;c++){const h=t[c];if(h.POSITION!==void 0&&(n=!0),h.NORMAL!==void 0&&(r=!0),h.COLOR_0!==void 0&&(s=!0),n&&r&&s)break}if(!n&&!r&&!s)return Promise.resolve(e);const a=[],o=[],l=[];for(let c=0,u=t.length;c<u;c++){const h=t[c];if(n){const d=h.POSITION!==void 0?i.getDependency("accessor",h.POSITION):e.attributes.position;a.push(d)}if(r){const d=h.NORMAL!==void 0?i.getDependency("accessor",h.NORMAL):e.attributes.normal;o.push(d)}if(s){const d=h.COLOR_0!==void 0?i.getDependency("accessor",h.COLOR_0):e.attributes.color;l.push(d)}}return Promise.all([Promise.all(a),Promise.all(o),Promise.all(l)]).then(function(c){const u=c[0],h=c[1],d=c[2];return n&&(e.morphAttributes.position=u),r&&(e.morphAttributes.normal=h),s&&(e.morphAttributes.color=d),e.morphTargetsRelative=!0,e})}function Wme(e,t){if(e.updateMorphTargets(),t.weights!==void 0)for(let i=0,n=t.weights.length;i<n;i++)e.morphTargetInfluences[i]=t.weights[i];if(t.extras&&Array.isArray(t.extras.targetNames)){const i=t.extras.targetNames;if(e.morphTargetInfluences.length===i.length){e.morphTargetDictionary={};for(let n=0,r=i.length;n<r;n++)e.morphTargetDictionary[i[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Xme(e){let t;const i=e.extensions&&e.extensions[fn.KHR_DRACO_MESH_COMPRESSION];if(i?t="draco:"+i.bufferView+":"+i.indices+":"+mB(i.attributes):t=e.indices+":"+mB(e.attributes)+":"+e.mode,e.targets!==void 0)for(let n=0,r=e.targets.length;n<r;n++)t+=":"+mB(e.targets[n]);return t}function mB(e){let t="";const i=Object.keys(e).sort();for(let n=0,r=i.length;n<r;n++)t+=i[n]+":"+e[i[n]]+";";return t}function gU(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function qme(e){return e.search(/\.jpe?g($|\?)/i)>0||e.search(/^data\:image\/jpeg/)===0?"image/jpeg":e.search(/\.webp($|\?)/i)>0||e.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const Yme=new di;class Qme{constructor(t={},i={}){this.json=t,this.extensions={},this.plugins={},this.options=i,this.cache=new vme,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,r=!1,s=-1;typeof navigator<"u"&&typeof navigator.userAgent<"u"&&(n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,r=navigator.userAgent.indexOf("Firefox")>-1,s=r?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||n||r&&s<98?this.textureLoader=new Jw(this.options.manager):this.textureLoader=new uQ(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new ic(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,i){const n=this,r=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(a){return a._markDefs&&a._markDefs()}),Promise.all(this._invokeAll(function(a){return a.beforeRoot&&a.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(a){const o={scene:a[0][r.scene||0],scenes:a[0],animations:a[1],cameras:a[2],asset:r.asset,parser:n,userData:{}};return Av(s,o,r),Af(o,r),Promise.all(n._invokeAll(function(l){return l.afterRoot&&l.afterRoot(o)})).then(function(){for(const l of o.scenes)l.updateMatrixWorld();t(o)})}).catch(i)}_markDefs(){const t=this.json.nodes||[],i=this.json.skins||[],n=this.json.meshes||[];for(let r=0,s=i.length;r<s;r++){const a=i[r].joints;for(let o=0,l=a.length;o<l;o++)t[a[o]].isBone=!0}for(let r=0,s=t.length;r<s;r++){const a=t[r];a.mesh!==void 0&&(this._addNodeRef(this.meshCache,a.mesh),a.skin!==void 0&&(n[a.mesh].isSkinnedMesh=!0)),a.camera!==void 0&&this._addNodeRef(this.cameraCache,a.camera)}}_addNodeRef(t,i){i!==void 0&&(t.refs[i]===void 0&&(t.refs[i]=t.uses[i]=0),t.refs[i]++)}_getNodeRef(t,i,n){if(t.refs[i]<=1)return n;const r=n.clone(),s=(a,o)=>{const l=this.associations.get(a);l!=null&&this.associations.set(o,l);for(const[c,u]of a.children.entries())s(u,o.children[c])};return s(n,r),r.name+="_instance_"+t.uses[i]++,r}_invokeOne(t){const i=Object.values(this.plugins);i.push(this);for(let n=0;n<i.length;n++){const r=t(i[n]);if(r)return r}return null}_invokeAll(t){const i=Object.values(this.plugins);i.unshift(this);const n=[];for(let r=0;r<i.length;r++){const s=t(i[r]);s&&n.push(s)}return n}getDependency(t,i){const n=t+":"+i;let r=this.cache.get(n);if(!r){switch(t){case"scene":r=this.loadScene(i);break;case"node":r=this._invokeOne(function(s){return s.loadNode&&s.loadNode(i)});break;case"mesh":r=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(i)});break;case"accessor":r=this.loadAccessor(i);break;case"bufferView":r=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(i)});break;case"buffer":r=this.loadBuffer(i);break;case"material":r=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(i)});break;case"texture":r=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(i)});break;case"skin":r=this.loadSkin(i);break;case"animation":r=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(i)});break;case"camera":r=this.loadCamera(i);break;default:if(r=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(t,i)}),!r)throw new Error("Unknown type: "+t);break}this.cache.add(n,r)}return r}getDependencies(t){let i=this.cache.get(t);if(!i){const n=this,r=this.json[t+(t==="mesh"?"es":"s")]||[];i=Promise.all(r.map(function(s,a){return n.getDependency(t,a)})),this.cache.add(t,i)}return i}loadBuffer(t){const i=this.json.buffers[t],n=this.fileLoader;if(i.type&&i.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+i.type+" buffer type is not supported.");if(i.uri===void 0&&t===0)return Promise.resolve(this.extensions[fn.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(s,a){n.load(Wm.resolveURL(i.uri,r.path),s,void 0,function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+i.uri+'".'))})})}loadBufferView(t){const i=this.json.bufferViews[t];return this.getDependency("buffer",i.buffer).then(function(n){const r=i.byteLength||0,s=i.byteOffset||0;return n.slice(s,s+r)})}loadAccessor(t){const i=this,n=this.json,r=this.json.accessors[t];if(r.bufferView===void 0&&r.sparse===void 0){const a=fB[r.type],o=w1[r.componentType],l=r.normalized===!0,c=new o(r.count*a);return Promise.resolve(new Pn(c,a,l))}const s=[];return r.bufferView!==void 0?s.push(this.getDependency("bufferView",r.bufferView)):s.push(null),r.sparse!==void 0&&(s.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(s).then(function(a){const o=a[0],l=fB[r.type],c=w1[r.componentType],u=c.BYTES_PER_ELEMENT,h=u*l,d=r.byteOffset||0,p=r.bufferView!==void 0?n.bufferViews[r.bufferView].byteStride:void 0,g=r.normalized===!0;let x,y;if(p&&p!==h){const b=Math.floor(d/p),A="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+b+":"+r.count;let w=i.cache.get(A);w||(x=new c(o,b*p,r.count*p/u),w=new kw(x,p/u),i.cache.add(A,w)),y=new eg(w,l,d%p/u,g)}else o===null?x=new c(r.count*l):x=new c(o,d,r.count*l),y=new Pn(x,l,g);if(r.sparse!==void 0){const b=fB.SCALAR,A=w1[r.sparse.indices.componentType],w=r.sparse.indices.byteOffset||0,E=r.sparse.values.byteOffset||0,D=new A(a[1],w,r.sparse.count*b),T=new c(a[2],E,r.sparse.count*l);o!==null&&(y=new Pn(y.array.slice(),y.itemSize,y.normalized));for(let I=0,R=D.length;I<R;I++){const O=D[I];if(y.setX(O,T[I*l]),l>=2&&y.setY(O,T[I*l+1]),l>=3&&y.setZ(O,T[I*l+2]),l>=4&&y.setW(O,T[I*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return y})}loadTexture(t){const i=this.json,n=this.options,s=i.textures[t].source,a=i.images[s];let o=this.textureLoader;if(a.uri){const l=n.manager.getHandler(a.uri);l!==null&&(o=l)}return this.loadTextureImage(t,s,o)}loadTextureImage(t,i,n){const r=this,s=this.json,a=s.textures[t],o=s.images[i],l=(o.uri||o.bufferView)+":"+a.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(i,n).then(function(u){u.flipY=!1,u.name=a.name||o.name||"",u.name===""&&typeof o.uri=="string"&&o.uri.startsWith("data:image/")===!1&&(u.name=o.uri);const d=(s.samplers||{})[a.sampler]||{};return u.magFilter=Ek[d.magFilter]||hs,u.minFilter=Ek[d.minFilter]||kc,u.wrapS=Tk[d.wrapS]||Zm,u.wrapT=Tk[d.wrapT]||Zm,r.associations.set(u,{textures:t}),u}).catch(function(){return null});return this.textureCache[l]=c,c}loadImageSource(t,i){const n=this,r=this.json,s=this.options;if(this.sourceCache[t]!==void 0)return this.sourceCache[t].then(h=>h.clone());const a=r.images[t],o=self.URL||self.webkitURL;let l=a.uri||"",c=!1;if(a.bufferView!==void 0)l=n.getDependency("bufferView",a.bufferView).then(function(h){c=!0;const d=new Blob([h],{type:a.mimeType});return l=o.createObjectURL(d),l});else if(a.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");const u=Promise.resolve(l).then(function(h){return new Promise(function(d,p){let g=d;i.isImageBitmapLoader===!0&&(g=function(x){const y=new vr(x);y.needsUpdate=!0,d(y)}),i.load(Wm.resolveURL(h,s.path),g,void 0,p)})}).then(function(h){return c===!0&&o.revokeObjectURL(l),Af(h,a),h.userData.mimeType=a.mimeType||qme(a.uri),h}).catch(function(h){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),h});return this.sourceCache[t]=u,u}assignTexture(t,i,n,r){const s=this;return this.getDependency("texture",n.index).then(function(a){if(!a)return null;if(n.texCoord!==void 0&&n.texCoord>0&&(a=a.clone(),a.channel=n.texCoord),s.extensions[fn.KHR_TEXTURE_TRANSFORM]){const o=n.extensions!==void 0?n.extensions[fn.KHR_TEXTURE_TRANSFORM]:void 0;if(o){const l=s.associations.get(a);a=s.extensions[fn.KHR_TEXTURE_TRANSFORM].extendTexture(a,o),s.associations.set(a,l)}}return r!==void 0&&(typeof r=="number"&&(r=r===wk?i0:qf),"colorSpace"in a?a.colorSpace=r:a.encoding=r===i0?wk:gme),t[i]=a,a})}assignFinalMaterial(t){const i=t.geometry;let n=t.material;const r=i.attributes.tangent===void 0,s=i.attributes.color!==void 0,a=i.attributes.normal===void 0;if(t.isPoints){const o="PointsMaterial:"+n.uuid;let l=this.cache.get(o);l||(l=new Ww,Js.prototype.copy.call(l,n),l.color.copy(n.color),l.map=n.map,l.sizeAttenuation=!1,this.cache.add(o,l)),n=l}else if(t.isLine){const o="LineBasicMaterial:"+n.uuid;let l=this.cache.get(o);l||(l=new So,Js.prototype.copy.call(l,n),l.color.copy(n.color),l.map=n.map,this.cache.add(o,l)),n=l}if(r||s||a){let o="ClonedMaterial:"+n.uuid+":";r&&(o+="derivative-tangents:"),s&&(o+="vertex-colors:"),a&&(o+="flat-shading:");let l=this.cache.get(o);l||(l=n.clone(),s&&(l.vertexColors=!0),a&&(l.flatShading=!0),r&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(o,l),this.associations.set(l,this.associations.get(n))),n=l}t.material=n}getMaterialType(){return Kw}loadMaterial(t){const i=this,n=this.json,r=this.extensions,s=n.materials[t];let a;const o={},l=s.extensions||{},c=[];if(l[fn.KHR_MATERIALS_UNLIT]){const h=r[fn.KHR_MATERIALS_UNLIT];a=h.getMaterialType(),c.push(h.extendParams(o,s,i))}else{const h=s.pbrMetallicRoughness||{};if(o.color=new jt(1,1,1),o.opacity=1,Array.isArray(h.baseColorFactor)){const d=h.baseColorFactor;o.color.setRGB(d[0],d[1],d[2],qf),o.opacity=d[3]}h.baseColorTexture!==void 0&&c.push(i.assignTexture(o,"map",h.baseColorTexture,i0)),o.metalness=h.metallicFactor!==void 0?h.metallicFactor:1,o.roughness=h.roughnessFactor!==void 0?h.roughnessFactor:1,h.metallicRoughnessTexture!==void 0&&(c.push(i.assignTexture(o,"metalnessMap",h.metallicRoughnessTexture)),c.push(i.assignTexture(o,"roughnessMap",h.metallicRoughnessTexture))),a=this._invokeOne(function(d){return d.getMaterialType&&d.getMaterialType(t)}),c.push(Promise.all(this._invokeAll(function(d){return d.extendMaterialParams&&d.extendMaterialParams(t,o)})))}s.doubleSided===!0&&(o.side=Hc);const u=s.alphaMode||pB.OPAQUE;if(u===pB.BLEND?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,u===pB.MASK&&(o.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5)),s.normalTexture!==void 0&&a!==$l&&(c.push(i.assignTexture(o,"normalMap",s.normalTexture)),o.normalScale=new Mt(1,1),s.normalTexture.scale!==void 0)){const h=s.normalTexture.scale;o.normalScale.set(h,h)}if(s.occlusionTexture!==void 0&&a!==$l&&(c.push(i.assignTexture(o,"aoMap",s.occlusionTexture)),s.occlusionTexture.strength!==void 0&&(o.aoMapIntensity=s.occlusionTexture.strength)),s.emissiveFactor!==void 0&&a!==$l){const h=s.emissiveFactor;o.emissive=new jt().setRGB(h[0],h[1],h[2],qf)}return s.emissiveTexture!==void 0&&a!==$l&&c.push(i.assignTexture(o,"emissiveMap",s.emissiveTexture,i0)),Promise.all(c).then(function(){const h=new a(o);return s.name&&(h.name=s.name),Af(h,s),i.associations.set(h,{materials:t}),s.extensions&&Av(r,h,s),h})}createUniqueName(t){const i=Cn.sanitizeNodeName(t||"");return i in this.nodeNamesUsed?i+"_"+ ++this.nodeNamesUsed[i]:(this.nodeNamesUsed[i]=0,i)}loadGeometries(t){const i=this,n=this.extensions,r=this.primitiveCache;function s(o){return n[fn.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(o,i).then(function(l){return Ck(l,o,i)})}const a=[];for(let o=0,l=t.length;o<l;o++){const c=t[o],u=Xme(c),h=r[u];if(h)a.push(h.promise);else{let d;c.extensions&&c.extensions[fn.KHR_DRACO_MESH_COMPRESSION]?d=s(c):d=Ck(new ki,c,i),r[u]={primitive:c,promise:d},a.push(d)}}return Promise.all(a)}loadMesh(t){const i=this,n=this.json,r=this.extensions,s=n.meshes[t],a=s.primitives,o=[];for(let l=0,c=a.length;l<c;l++){const u=a[l].material===void 0?kme(this.cache):this.getDependency("material",a[l].material);o.push(u)}return o.push(i.loadGeometries(a)),Promise.all(o).then(function(l){const c=l.slice(0,l.length-1),u=l[l.length-1],h=[];for(let p=0,g=u.length;p<g;p++){const x=u[p],y=a[p];let b;const A=c[p];if(y.mode===Ic.TRIANGLES||y.mode===Ic.TRIANGLE_STRIP||y.mode===Ic.TRIANGLE_FAN||y.mode===void 0)b=s.isSkinnedMesh===!0?new fF(x,A):new ts(x,A),b.isSkinnedMesh===!0&&b.normalizeSkinWeights(),y.mode===Ic.TRIANGLE_STRIP?b.geometry=Sk(b.geometry,iF):y.mode===Ic.TRIANGLE_FAN&&(b.geometry=Sk(b.geometry,ID));else if(y.mode===Ic.LINES)b=new ih(x,A);else if(y.mode===Ic.LINE_STRIP)b=new $f(x,A);else if(y.mode===Ic.LINE_LOOP)b=new mF(x,A);else if(y.mode===Ic.POINTS)b=new gF(x,A);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+y.mode);Object.keys(b.geometry.morphAttributes).length>0&&Wme(b,s),b.name=i.createUniqueName(s.name||"mesh_"+t),Af(b,s),y.extensions&&Av(r,b,y),i.assignFinalMaterial(b),h.push(b)}for(let p=0,g=h.length;p<g;p++)i.associations.set(h[p],{meshes:t,primitives:p});if(h.length===1)return s.extensions&&Av(r,h[0],s),h[0];const d=new Uf;s.extensions&&Av(r,d,s),i.associations.set(d,{meshes:t});for(let p=0,g=h.length;p<g;p++)d.add(h[p]);return d})}loadCamera(t){let i;const n=this.json.cameras[t],r=n[n.type];if(!r){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?i=new Dr(sF.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):n.type==="orthographic"&&(i=new Qu(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),n.name&&(i.name=this.createUniqueName(n.name)),Af(i,n),Promise.resolve(i)}loadSkin(t){const i=this.json.skins[t],n=[];for(let r=0,s=i.joints.length;r<s;r++)n.push(this._loadNodeShallow(i.joints[r]));return i.inverseBindMatrices!==void 0?n.push(this.getDependency("accessor",i.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(r){const s=r.pop(),a=r,o=[],l=[];for(let c=0,u=a.length;c<u;c++){const h=a[c];if(h){o.push(h);const d=new di;s!==null&&d.fromArray(s.array,c*16),l.push(d)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',i.joints[c])}return new jw(o,l)})}loadAnimation(t){const i=this.json,n=this,r=i.animations[t],s=r.name?r.name:"animation_"+t,a=[],o=[],l=[],c=[],u=[];for(let h=0,d=r.channels.length;h<d;h++){const p=r.channels[h],g=r.samplers[p.sampler],x=p.target,y=x.node,b=r.parameters!==void 0?r.parameters[g.input]:g.input,A=r.parameters!==void 0?r.parameters[g.output]:g.output;x.node!==void 0&&(a.push(this.getDependency("node",y)),o.push(this.getDependency("accessor",b)),l.push(this.getDependency("accessor",A)),c.push(g),u.push(x))}return Promise.all([Promise.all(a),Promise.all(o),Promise.all(l),Promise.all(c),Promise.all(u)]).then(function(h){const d=h[0],p=h[1],g=h[2],x=h[3],y=h[4],b=[];for(let A=0,w=d.length;A<w;A++){const E=d[A],D=p[A],T=g[A],I=x[A],R=y[A];if(E===void 0)continue;E.updateMatrix&&E.updateMatrix();const O=n._createAnimationTracks(E,D,T,I,R);if(O)for(let P=0;P<O.length;P++)b.push(O[P])}return new Q1(s,void 0,b)})}createNodeMesh(t){const i=this.json,n=this,r=i.nodes[t];return r.mesh===void 0?null:n.getDependency("mesh",r.mesh).then(function(s){const a=n._getNodeRef(n.meshCache,r.mesh,s);return r.weights!==void 0&&a.traverse(function(o){if(o.isMesh)for(let l=0,c=r.weights.length;l<c;l++)o.morphTargetInfluences[l]=r.weights[l]}),a})}loadNode(t){const i=this.json,n=this,r=i.nodes[t],s=n._loadNodeShallow(t),a=[],o=r.children||[];for(let c=0,u=o.length;c<u;c++)a.push(n.getDependency("node",o[c]));const l=r.skin===void 0?Promise.resolve(null):n.getDependency("skin",r.skin);return Promise.all([s,Promise.all(a),l]).then(function(c){const u=c[0],h=c[1],d=c[2];d!==null&&u.traverse(function(p){p.isSkinnedMesh&&p.bind(d,Yme)});for(let p=0,g=h.length;p<g;p++)u.add(h[p]);return u})}_loadNodeShallow(t){const i=this.json,n=this.extensions,r=this;if(this.nodeCache[t]!==void 0)return this.nodeCache[t];const s=i.nodes[t],a=s.name?r.createUniqueName(s.name):"",o=[],l=r._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(t)});return l&&o.push(l),s.camera!==void 0&&o.push(r.getDependency("camera",s.camera).then(function(c){return r._getNodeRef(r.cameraCache,s.camera,c)})),r._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(t)}).forEach(function(c){o.push(c)}),this.nodeCache[t]=Promise.all(o).then(function(c){let u;if(s.isBone===!0?u=new xR:c.length>1?u=new Uf:c.length===1?u=c[0]:u=new gn,u!==c[0])for(let h=0,d=c.length;h<d;h++)u.add(c[h]);if(s.name&&(u.userData.name=s.name,u.name=a),Af(u,s),s.extensions&&Av(n,u,s),s.matrix!==void 0){const h=new di;h.fromArray(s.matrix),u.applyMatrix4(h)}else s.translation!==void 0&&u.position.fromArray(s.translation),s.rotation!==void 0&&u.quaternion.fromArray(s.rotation),s.scale!==void 0&&u.scale.fromArray(s.scale);return r.associations.has(u)||r.associations.set(u,{}),r.associations.get(u).nodes=t,u}),this.nodeCache[t]}loadScene(t){const i=this.extensions,n=this.json.scenes[t],r=this,s=new Uf;n.name&&(s.name=r.createUniqueName(n.name)),Af(s,n),n.extensions&&Av(i,s,n);const a=n.nodes||[],o=[];for(let l=0,c=a.length;l<c;l++)o.push(r.getDependency("node",a[l]));return Promise.all(o).then(function(l){for(let u=0,h=l.length;u<h;u++)s.add(l[u]);const c=u=>{const h=new Map;for(const[d,p]of r.associations)(d instanceof Js||d instanceof vr)&&h.set(d,p);return u.traverse(d=>{const p=r.associations.get(d);p!=null&&h.set(d,p)}),h};return r.associations=c(s),s})}_createAnimationTracks(t,i,n,r,s){const a=[],o=t.name?t.name:t.uuid,l=[];cm[s.path]===cm.weights?t.traverse(function(d){d.morphTargetInfluences&&l.push(d.name?d.name:d.uuid)}):l.push(o);let c;switch(cm[s.path]){case cm.weights:c=D0;break;case cm.rotation:c=R0;break;case cm.position:case cm.scale:c=P0;break;default:switch(n.itemSize){case 1:c=D0;break;case 2:case 3:default:c=P0;break}break}const u=r.interpolation!==void 0?Gme[r.interpolation]:j1,h=this._getArrayFromAccessor(n);for(let d=0,p=l.length;d<p;d++){const g=new c(l[d]+"."+cm[s.path],i.array,h,u);r.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(g),a.push(g)}return a}_getArrayFromAccessor(t){let i=t.array;if(t.normalized){const n=gU(i.constructor),r=new Float32Array(i.length);for(let s=0,a=i.length;s<a;s++)r[s]=i[s]*n;i=r}return i}_createCubicSplineTrackInterpolant(t){t.createInterpolant=function(n){const r=this instanceof R0?Hme:QQ;return new r(this.times,this.values,this.getValueSize()/3,n)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Kme(e,t,i){const n=t.attributes,r=new Ya;if(n.POSITION!==void 0){const o=i.json.accessors[n.POSITION],l=o.min,c=o.max;if(l!==void 0&&c!==void 0){if(r.set(new me(l[0],l[1],l[2]),new me(c[0],c[1],c[2])),o.normalized){const u=gU(w1[o.componentType]);r.min.multiplyScalar(u),r.max.multiplyScalar(u)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const s=t.targets;if(s!==void 0){const o=new me,l=new me;for(let c=0,u=s.length;c<u;c++){const h=s[c];if(h.POSITION!==void 0){const d=i.json.accessors[h.POSITION],p=d.min,g=d.max;if(p!==void 0&&g!==void 0){if(l.setX(Math.max(Math.abs(p[0]),Math.abs(g[0]))),l.setY(Math.max(Math.abs(p[1]),Math.abs(g[1]))),l.setZ(Math.max(Math.abs(p[2]),Math.abs(g[2]))),d.normalized){const x=gU(w1[d.componentType]);l.multiplyScalar(x)}o.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(o)}e.boundingBox=r;const a=new Sa;r.getCenter(a.center),a.radius=r.min.distanceTo(r.max)/2,e.boundingSphere=a}function Ck(e,t,i){const n=t.attributes,r=[];function s(a,o){return i.getDependency("accessor",a).then(function(l){e.setAttribute(o,l)})}for(const a in n){const o=mU[a]||a.toLowerCase();o in e.attributes||r.push(s(n[a],o))}if(t.indices!==void 0&&!e.index){const a=i.getDependency("accessor",t.indices).then(function(o){e.setIndex(o)});r.push(a)}return Af(e,t),Kme(e,t,i),Promise.all(r).then(function(){return t.targets!==void 0?jme(e,t.targets,i):e})}class Jme extends ki{constructor(t,i,n,r){super();const s=[],a=[],o=[],l=new me,c=new di;c.makeRotationFromEuler(n),c.setPosition(i);const u=new di;u.copy(c).invert(),h(),this.setAttribute("position",new ei(s,3)),this.setAttribute("normal",new ei(a,3)),this.setAttribute("uv",new ei(o,2));function h(){let x,y=[];const b=new me,A=new me;if(t.geometry.isGeometry===!0){console.error("THREE.DecalGeometry no longer supports THREE.Geometry. Use BufferGeometry instead.");return}const w=t.geometry,E=w.attributes.position,D=w.attributes.normal;if(w.index!==null){const T=w.index;for(x=0;x<T.count;x++)b.fromBufferAttribute(E,T.getX(x)),A.fromBufferAttribute(D,T.getX(x)),d(y,b,A)}else for(x=0;x<E.count;x++)b.fromBufferAttribute(E,x),A.fromBufferAttribute(D,x),d(y,b,A);for(y=p(y,l.set(1,0,0)),y=p(y,l.set(-1,0,0)),y=p(y,l.set(0,1,0)),y=p(y,l.set(0,-1,0)),y=p(y,l.set(0,0,1)),y=p(y,l.set(0,0,-1)),x=0;x<y.length;x++){const T=y[x];o.push(.5+T.position.x/r.x,.5+T.position.y/r.y),T.position.applyMatrix4(c),s.push(T.position.x,T.position.y,T.position.z),a.push(T.normal.x,T.normal.y,T.normal.z)}}function d(x,y,b){y.applyMatrix4(t.matrixWorld),y.applyMatrix4(u),b.transformDirection(t.matrixWorld),x.push(new Dk(y.clone(),b.clone()))}function p(x,y){const b=[],A=.5*Math.abs(r.dot(y));for(let w=0;w<x.length;w+=3){let E,D,T,I=0,R,O,P,U;const H=x[w+0].position.dot(y)-A,V=x[w+1].position.dot(y)-A,j=x[w+2].position.dot(y)-A;switch(E=H>0,D=V>0,T=j>0,I=(E?1:0)+(D?1:0)+(T?1:0),I){case 0:{b.push(x[w]),b.push(x[w+1]),b.push(x[w+2]);break}case 1:{if(E&&(R=x[w+1],O=x[w+2],P=g(x[w],R,y,A),U=g(x[w],O,y,A)),D){R=x[w],O=x[w+2],P=g(x[w+1],R,y,A),U=g(x[w+1],O,y,A),b.push(P),b.push(O.clone()),b.push(R.clone()),b.push(O.clone()),b.push(P.clone()),b.push(U);break}T&&(R=x[w],O=x[w+1],P=g(x[w+2],R,y,A),U=g(x[w+2],O,y,A)),b.push(R.clone()),b.push(O.clone()),b.push(P),b.push(U),b.push(P.clone()),b.push(O.clone());break}case 2:{E||(R=x[w].clone(),O=g(R,x[w+1],y,A),P=g(R,x[w+2],y,A),b.push(R),b.push(O),b.push(P)),D||(R=x[w+1].clone(),O=g(R,x[w+2],y,A),P=g(R,x[w],y,A),b.push(R),b.push(O),b.push(P)),T||(R=x[w+2].clone(),O=g(R,x[w],y,A),P=g(R,x[w+1],y,A),b.push(R),b.push(O),b.push(P));break}}}return b}function g(x,y,b,A){const w=x.position.dot(b)-A,E=y.position.dot(b)-A,D=w/(w-E);return new Dk(new me(x.position.x+D*(y.position.x-x.position.x),x.position.y+D*(y.position.y-x.position.y),x.position.z+D*(y.position.z-x.position.z)),new me(x.normal.x+D*(y.normal.x-x.normal.x),x.normal.y+D*(y.normal.y-x.normal.y),x.normal.z+D*(y.normal.z-x.normal.z)))}}}class Dk{constructor(t,i){this.position=t,this.normal=i}clone(){return new this.constructor(this.position.clone(),this.normal.clone())}}const gB=new WeakMap;class Zme extends _o{constructor(t){super(t),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(t){return this.decoderPath=t,this}setDecoderConfig(t){return this.decoderConfig=t,this}setWorkerLimit(t){return this.workerLimit=t,this}load(t,i,n,r){const s=new ic(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,a=>{const o={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(a,o).then(i).catch(r)},n,r)}decodeDracoFile(t,i,n,r){const s={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!n};this.decodeGeometry(t,s).then(i)}decodeGeometry(t,i){for(const l in i.attributeTypes){const c=i.attributeTypes[l];c.BYTES_PER_ELEMENT!==void 0&&(i.attributeTypes[l]=c.name)}const n=JSON.stringify(i);if(gB.has(t)){const l=gB.get(t);if(l.key===n)return l.promise;if(t.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let r;const s=this.workerNextTaskID++,a=t.byteLength,o=this._getWorker(s,a).then(l=>(r=l,new Promise((c,u)=>{r._callbacks[s]={resolve:c,reject:u},r.postMessage({type:"decode",id:s,taskConfig:i,buffer:t},[t])}))).then(l=>this._createGeometry(l.geometry));return o.catch(()=>!0).then(()=>{r&&s&&this._releaseTask(r,s)}),gB.set(t,{key:n,promise:o}),o}_createGeometry(t){const i=new ki;t.index&&i.setIndex(new Pn(t.index.array,1));for(let n=0;n<t.attributes.length;n++){const r=t.attributes[n],s=r.name,a=r.array,o=r.itemSize;i.setAttribute(s,new Pn(a,o))}return i}_loadLibrary(t,i){const n=new ic(this.manager);return n.setPath(this.decoderPath),n.setResponseType(i),n.setWithCredentials(this.withCredentials),new Promise((r,s)=>{n.load(t,r,void 0,s)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const t=typeof WebAssembly!="object"||this.decoderConfig.type==="js",i=[];return t?i.push(this._loadLibrary("draco_decoder.js","text")):(i.push(this._loadLibrary("draco_wasm_wrapper.js","text")),i.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(i).then(n=>{const r=n[0];t||(this.decoderConfig.wasmBinary=n[1]);const s=$me.toString(),a=["/* draco decoder */",r,"","/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([a]))}),this.decoderPending}_getWorker(t,i){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const r=new Worker(this.workerSourceURL);r._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:this.decoderConfig}),r.onmessage=function(s){const a=s.data;switch(a.type){case"decode":r._callbacks[a.id].resolve(a);break;case"error":r._callbacks[a.id].reject(a);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+a.type+'"')}},this.workerPool.push(r)}else this.workerPool.sort(function(r,s){return r._taskLoad>s._taskLoad?-1:1});const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[t]=i,n._taskLoad+=i,n})}_releaseTask(t,i){t._taskLoad-=t._taskCosts[i],delete t._callbacks[i],delete t._taskCosts[i]}debug(){console.log("Task load: ",this.workerPool.map(t=>t._taskLoad))}dispose(){for(let t=0;t<this.workerPool.length;++t)this.workerPool[t].terminate();return this.workerPool.length=0,this}}function $me(){let e,t;onmessage=function(a){const o=a.data;switch(o.type){case"init":e=o.decoderConfig,t=new Promise(function(u){e.onModuleLoaded=function(h){u({draco:h})},DracoDecoderModule(e)});break;case"decode":const l=o.buffer,c=o.taskConfig;t.then(u=>{const h=u.draco,d=new h.Decoder,p=new h.DecoderBuffer;p.Init(new Int8Array(l),l.byteLength);try{const g=i(h,d,p,c),x=g.attributes.map(y=>y.array.buffer);g.index&&x.push(g.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:g},x)}catch(g){console.error(g),self.postMessage({type:"error",id:o.id,error:g.message})}finally{h.destroy(p),h.destroy(d)}});break}};function i(a,o,l,c){const u=c.attributeIDs,h=c.attributeTypes;let d,p;const g=o.GetEncodedGeometryType(l);if(g===a.TRIANGULAR_MESH)d=new a.Mesh,p=o.DecodeBufferToMesh(l,d);else if(g===a.POINT_CLOUD)d=new a.PointCloud,p=o.DecodeBufferToPointCloud(l,d);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!p.ok()||d.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+p.error_msg());const x={index:null,attributes:[]};for(const y in u){const b=self[h[y]];let A,w;if(c.useUniqueIDs)w=u[y],A=o.GetAttributeByUniqueId(d,w);else{if(w=o.GetAttributeId(d,a[u[y]]),w===-1)continue;A=o.GetAttribute(d,w)}x.attributes.push(r(a,o,d,y,b,A))}return g===a.TRIANGULAR_MESH&&(x.index=n(a,o,d)),a.destroy(d),x}function n(a,o,l){const u=l.num_faces()*3,h=u*4,d=a._malloc(h);o.GetTrianglesUInt32Array(l,h,d);const p=new Uint32Array(a.HEAPF32.buffer,d,u).slice();return a._free(d),{array:p,itemSize:1}}function r(a,o,l,c,u,h){const d=h.num_components(),g=l.num_points()*d,x=g*u.BYTES_PER_ELEMENT,y=s(a,u),b=a._malloc(x);o.GetAttributeDataArrayForAllPoints(l,h,y,x,b);const A=new u(a.HEAPF32.buffer,b,g).slice();return a._free(b),{name:c,array:A,itemSize:d}}function s(a,o){switch(o){case Float32Array:return a.DT_FLOAT32;case Int8Array:return a.DT_INT8;case Int16Array:return a.DT_INT16;case Int32Array:return a.DT_INT32;case Uint8Array:return a.DT_UINT8;case Uint16Array:return a.DT_UINT16;case Uint32Array:return a.DT_UINT32}}}let X2;const vB=()=>{if(X2)return X2;const e="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",t="B9h9z9tFBBBFiI9gBB9gLaaaaaFa9gEaaaB9gFaFaEMcBBFBFFGGGEILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBOn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBNI9z9iqlBVc+N9IcIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMk8lLbaE97F9+FaL978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAeDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAeDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBReCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBH8ZCFD9tA8ZAPD9OD9hD9RH8ZDQBTFtGmEYIPLdKeOnHpAIAQJDBIBHyCFD9tAyAPD9OD9hD9RHyAIASJDBIBH8cCFD9tA8cAPD9OD9hD9RH8cDQBTFtGmEYIPLdKeOnH8dDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAeD9uHeDyBjGBAEAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeApA8dDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNiV8ZcpMyS8cQ8df8eb8fHdAyA8cDQNiV8ZcpMyS8cQ8df8eb8fH8ZDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/dLEK97FaF97GXGXAGCI9HQBAF9FQFCBRGEXABABDBBBHECiD+rFCiD+sFD/6FHIAECND+rFCiD+sFD/6FAID/gFAECTD+rFCiD+sFD/6FHLD/gFD/kFD/lFHKCBDtD+2FHOAICUUUU94DtHND9OD9RD/kFHI9DBB/+hDYAIAID/mFAKAKD/mFALAOALAND9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHLD/mF9DBBX9LDYHOD/kFCgFDtD9OAECUUU94DtD9OD9QAIALD/mFAOD/kFCND+rFCU/+EDtD9OD9QAKALD/mFAOD/kFCTD+rFCUU/8ODtD9OD9QDMBBABCTJRBAGCIJHGAF9JQBSGMMAF9FQBCBRGEXABCTJHVAVDBBBHECBDtHOCUU98D8cFCUU98D8cEHND9OABDBBBHKAEDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAKAEDQBFGENVcMTtmYi8ZpyHECTD+sFD/6FHID/gFAECTD+rFCTD+sFD/6FHLD/gFD/kFD/lFHE9DB/+g6DYALAEAOD+2FHOALCUUUU94DtHcD9OD9RD/kFHLALD/mFAEAED/mFAIAOAIAcD9OD9RD/kFHEAED/mFD/kFD/kFD/jFD/nFHID/mF9DBBX9LDYHOD/kFCTD+rFALAID/mFAOD/kFCggEDtD9OD9QHLAEAID/mFAOD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHEDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAKAND9OALAEDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM/hEIGaF97FaL978jUUUUBCTlREGXAF9FQBCBRIEXAEABDBBBHLABCTJHKDBBBHODQILKOSQfbPden8c8d8e8fHNCTD+sFHVCID+rFDMIBAB9DBBU8/DY9D/zI818/DYAVCEDtD9QD/6FD/nFHVALAODQBFGENVcMTtmYi8ZpyHLCTD+rFCTD+sFD/6FD/mFHOAOD/mFAVALCTD+sFD/6FD/mFHcAcD/mFAVANCTD+rFCTD+sFD/6FD/mFHNAND/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHVD/mF9DBBX9LDYHLD/kFCggEDtHMD9OAcAVD/mFALD/kFCTD+rFD9QHcANAVD/mFALD/kFCTD+rFAOAVD/mFALD/kFAMD9OD9QHVDQBFTtGEmYILPdKOenHLD8dBAEDBIBDyB+t+J83EBABCNJALD8dFAEDBIBDyF+t+J83EBAKAcAVDQNVi8ZcMpySQ8c8dfb8e8fHVD8dBAEDBIBDyG+t+J83EBABCiJAVD8dFAEDBIBDyE+t+J83EBABCAJRBAICIJHIAF9JQBMMM9jFF97GXAGCGrAF9sHG9FQBCBRFEXABABDBBBHECND+rFCND+sFD/6FAECiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBABCTJRBAFCIJHFAG9JQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",i=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),n=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if(typeof WebAssembly!="object")return{supported:!1};let r=e;WebAssembly.validate(i)&&(r=t);let s;const a=WebAssembly.instantiate(o(r),{}).then(h=>{s=h.instance,s.exports.__wasm_call_ctors()});function o(h){const d=new Uint8Array(h.length);for(let g=0;g<h.length;++g){const x=h.charCodeAt(g);d[g]=x>96?x-71:x>64?x-65:x>47?x+4:x>46?63:62}let p=0;for(let g=0;g<h.length;++g)d[p++]=d[g]<60?n[d[g]]:(d[g]-60)*64+d[++g];return d.buffer.slice(0,p)}function l(h,d,p,g,x,y){const b=s.exports.sbrk,A=p+3&-4,w=b(A*g),E=b(x.length),D=new Uint8Array(s.exports.memory.buffer);D.set(x,E);const T=h(w,p,g,E,x.length);if(T===0&&y&&y(w,A,g),d.set(D.subarray(w,w+p*g)),b(w-b(0)),T!==0)throw new Error(`Malformed buffer data: ${T}`)}const c={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},u={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return X2={ready:a,supported:!0,decodeVertexBuffer(h,d,p,g,x){l(s.exports.meshopt_decodeVertexBuffer,h,d,p,g,s.exports[c[x]])},decodeIndexBuffer(h,d,p,g){l(s.exports.meshopt_decodeIndexBuffer,h,d,p,g)},decodeIndexSequence(h,d,p,g){l(s.exports.meshopt_decodeIndexSequence,h,d,p,g)},decodeGltfBuffer(h,d,p,g,x,y){l(s.exports[u[x]],h,d,p,g,s.exports[c[y]])}},X2},yB=e=>e===Object(e)&&!Array.isArray(e)&&typeof e!="function";function qF(e,t){const i=Kl(s=>s.gl),n=hg(Jw,yB(e)?Object.values(e):e);return ge.useLayoutEffect(()=>{t==null||t(n)},[t]),ge.useEffect(()=>{if("initTexture"in i){let s=[];Array.isArray(n)?s=n:n instanceof vr?s=[n]:yB(n)&&(s=Object.values(n)),s.forEach(a=>{a instanceof vr&&i.initTexture(a)})}},[i,n]),ge.useMemo(()=>{if(yB(e)){const s={};let a=0;for(const o in e)s[o]=n[a++];return s}else return n},[e,n])}qF.preload=e=>hg.preload(Jw,e);qF.clear=e=>hg.clear(Jw,e);const ege=()=>parseInt(mb.replace(/\D+/g,"")),KQ=ege();function tge(e){return Array.isArray(e)}function xB(e=[0,0,0]){return tge(e)?e:e instanceof me||e instanceof tl?[e.x,e.y,e.z]:[e,e,e]}const ige=ge.forwardRef(function({debug:t,depthTest:i=!1,polygonOffsetFactor:n=-10,map:r,mesh:s,children:a,position:o,rotation:l,scale:c,...u},h){const d=ge.useRef(null);ge.useImperativeHandle(h,()=>d.current);const p=ge.useRef(null),g=ge.useRef({position:new me,rotation:new tl,scale:new me(1,1,1)});return ge.useLayoutEffect(()=>{const x=(s==null?void 0:s.current)||d.current.parent,y=d.current;if(!(x instanceof ts))throw new Error('Decal must have a Mesh as parent or specify its "mesh" prop');if(x){Gc(g.current,{position:o,scale:c});const b=x.matrixWorld.clone();if(x.matrixWorld.identity(),!l||typeof l=="number"){const A=new gn;A.position.copy(g.current.position);const w=x.geometry.attributes.position.array;x.geometry.attributes.normal===void 0&&x.geometry.computeVertexNormals();const E=x.geometry.attributes.normal.array;let D=1/0,T=new me;const I=A.position.x,R=A.position.y,O=A.position.z,P=w.length;let U=-1;for(let H=0;H<P;H+=3){const V=w[H],j=w[H+1],J=w[H+2],F=V-I,X=j-R,W=J-O,ne=F*F+X*X+W*W;ne<D&&(D=ne,U=H)}T.fromArray(E,U),A.lookAt(A.position.clone().add(T)),A.rotateZ(Math.PI),A.rotateY(Math.PI),typeof l=="number"&&A.rotateZ(l),Gc(g.current,{rotation:A.rotation})}else Gc(g.current,{rotation:l});return p.current&&Gc(p.current,g.current),y.geometry=new Jme(x,g.current.position,g.current.rotation,g.current.scale),x.matrixWorld=b,()=>{y.geometry.dispose()}}},[s,...xB(o),...xB(c),...xB(l)]),ge.useLayoutEffect(()=>{p.current&&p.current.traverse(x=>x.raycast=()=>null)},[t]),ge.createElement("mesh",_d({ref:d,"material-transparent":!0,"material-polygonOffset":!0,"material-polygonOffsetFactor":n,"material-depthTest":i,"material-map":r},u),a,t&&ge.createElement("mesh",{ref:p},ge.createElement("boxGeometry",null),ge.createElement("meshNormalMaterial",{wireframe:!0}),ge.createElement("axesHelper",null)))});let q2=null,JQ="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function ZQ(e=!0,t=!0,i){return n=>{i&&i(n),e&&(q2||(q2=new Zme),q2.setDecoderPath(typeof e=="string"?e:JQ),n.setDRACOLoader(q2)),t&&n.setMeshoptDecoder(typeof vB=="function"?vB():vB)}}const zR=(e,t,i,n)=>hg(XF,e,ZQ(t,i,n));zR.preload=(e,t,i,n)=>hg.preload(XF,e,ZQ(t,i,n));zR.clear=e=>hg.clear(XF,e);zR.setDecoderPath=e=>{JQ=e};const $Q=ge.forwardRef(({makeDefault:e,camera:t,regress:i,domElement:n,enableDamping:r=!0,keyEvents:s=!1,onChange:a,onStart:o,onEnd:l,...c},u)=>{const h=Kl(T=>T.invalidate),d=Kl(T=>T.camera),p=Kl(T=>T.gl),g=Kl(T=>T.events),x=Kl(T=>T.setEvents),y=Kl(T=>T.set),b=Kl(T=>T.get),A=Kl(T=>T.performance),w=t||d,E=n||g.connected||p.domElement,D=ge.useMemo(()=>new mme(w),[w]);return Ab(()=>{D.enabled&&D.update()},-1),ge.useEffect(()=>(s&&D.connect(s===!0?E:s),D.connect(E),()=>void D.dispose()),[s,E,i,D,h]),ge.useEffect(()=>{const T=O=>{h(),i&&A.regress(),a&&a(O)},I=O=>{o&&o(O)},R=O=>{l&&l(O)};return D.addEventListener("change",T),D.addEventListener("start",I),D.addEventListener("end",R),()=>{D.removeEventListener("start",I),D.removeEventListener("end",R),D.removeEventListener("change",T)}},[a,o,l,D,h,x]),ge.useEffect(()=>{if(e){const T=b().controls;return y({controls:D}),()=>y({controls:T})}},[e,D]),ge.createElement("primitive",_d({ref:u,object:D,enableDamping:r},c))}),nge="modulepreload",rge=function(e){return"/"+e},Rk={},dg=function(t,i,n){let r=Promise.resolve();if(i&&i.length>0){let a=function(c){return Promise.all(c.map(u=>Promise.resolve(u).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));r=a(i.map(c=>{if(c=rge(c),c in Rk)return;Rk[c]=!0;const u=c.endsWith(".css"),h=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${h}`))return;const d=document.createElement("link");if(d.rel=u?"stylesheet":nge,u||(d.as="script"),d.crossOrigin="",d.href=c,l&&d.setAttribute("nonce",l),document.head.appendChild(d),u)return new Promise((p,g)=>{d.addEventListener("load",p),d.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return r.then(a=>{for(const o of a||[])o.status==="rejected"&&s(o.reason);return t().catch(s)})},bB=KQ>=154?"opaque_fragment":"output_fragment";class sge extends Ww{constructor(t){super(t),this.onBeforeCompile=(i,n)=>{const{isWebGL2:r}=n.capabilities;i.fragmentShader=i.fragmentShader.replace(`#include <${bB}>`,`
        ${r?`#include <${bB}>`:`#extension GL_OES_standard_derivatives : enable
#include <${bB}>`}
      vec2 cxy = 2.0 * gl_PointCoord - 1.0;
      float r = dot(cxy, cxy);
      float delta = fwidth(r);     
      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);
      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );
      #include <tonemapping_fragment>
      #include <${KQ>=154?"colorspace_fragment":"encodings_fragment"}>
      `)}}}const age=ge.forwardRef((e,t)=>{const[i]=ge.useState(()=>new sge(null));return ge.createElement("primitive",_d({},e,{object:i,ref:t,attach:"material"}))}),oge=ge.forwardRef(({children:e,enabled:t=!0,speed:i=1,rotationIntensity:n=1,floatIntensity:r=1,floatingRange:s=[-.1,.1],autoInvalidate:a=!1,...o},l)=>{const c=ge.useRef(null);ge.useImperativeHandle(l,()=>c.current,[]);const u=ge.useRef(Math.random()*1e4);return Ab(h=>{var d,p;if(!t||i===0)return;a&&h.invalidate();const g=u.current+h.clock.elapsedTime;c.current.rotation.x=Math.cos(g/4*i)/8*n,c.current.rotation.y=Math.sin(g/4*i)/8*n,c.current.rotation.z=Math.sin(g/4*i)/20*n;let x=Math.sin(g/4*i)/10;x=sF.mapLinear(x,-.1,.1,(d=s==null?void 0:s[0])!==null&&d!==void 0?d:-.1,(p=s==null?void 0:s[1])!==null&&p!==void 0?p:.1),c.current.position.y=x*r,c.current.updateMatrix()}),ge.createElement("group",o,ge.createElement("group",{ref:c,matrixAutoUpdate:!1},e))});let wv,__;const lge=ge.createContext(null),Pk=new di,Ok=new me,cge=ge.forwardRef(({children:e,range:t,limit:i=1e3,...n},r)=>{const s=ge.useRef(null);ge.useImperativeHandle(r,()=>s.current,[]);const[a,o]=ge.useState([]),[[l,c,u]]=ge.useState(()=>[new Float32Array(i*3),Float32Array.from({length:i*3},()=>1),Float32Array.from({length:i},()=>1)]);ge.useEffect(()=>{s.current.geometry.attributes.position.needsUpdate=!0}),Ab(()=>{for(s.current.updateMatrix(),s.current.updateMatrixWorld(),Pk.copy(s.current.matrixWorld).invert(),s.current.geometry.drawRange.count=Math.min(i,t!==void 0?t:i,a.length),wv=0;wv<a.length;wv++)__=a[wv].current,__.getWorldPosition(Ok).applyMatrix4(Pk),Ok.toArray(l,wv*3),s.current.geometry.attributes.position.needsUpdate=!0,__.matrixWorldNeedsUpdate=!0,__.color.toArray(c,wv*3),s.current.geometry.attributes.color.needsUpdate=!0,u.set([__.size],wv),s.current.geometry.attributes.size.needsUpdate=!0});const h=ge.useMemo(()=>({getParent:()=>s,subscribe:d=>(o(p=>[...p,d]),()=>o(p=>p.filter(g=>g.current!==d.current)))}),[]);return ge.createElement("points",_d({userData:{instances:a},matrixAutoUpdate:!1,ref:s,raycast:()=>null},n),ge.createElement("bufferGeometry",null,ge.createElement("bufferAttribute",{attach:"attributes-position",args:[l,3],usage:p0}),ge.createElement("bufferAttribute",{attach:"attributes-color",args:[c,3],usage:p0}),ge.createElement("bufferAttribute",{attach:"attributes-size",args:[u,1],usage:p0})),ge.createElement(lge.Provider,{value:h},e))}),uge=ge.forwardRef(({children:e,positions:t,colors:i,sizes:n,stride:r=3,...s},a)=>{const o=ge.useRef(null);return ge.useImperativeHandle(a,()=>o.current,[]),Ab(()=>{const l=o.current.geometry.attributes;l.position.needsUpdate=!0,i&&(l.color.needsUpdate=!0),n&&(l.size.needsUpdate=!0)}),ge.createElement("points",_d({ref:o},s),ge.createElement("bufferGeometry",null,ge.createElement("bufferAttribute",{attach:"attributes-position",args:[t,r],usage:p0}),i&&ge.createElement("bufferAttribute",{attach:"attributes-color",args:[i,r],count:i.length/r,usage:p0}),n&&ge.createElement("bufferAttribute",{attach:"attributes-size",args:[n,1],count:n.length/r,usage:p0})),e)}),hge=ge.forwardRef((e,t)=>e.positions instanceof Float32Array?ge.createElement(uge,_d({},e,{ref:t})):ge.createElement(cge,_d({},e,{ref:t})));function YF({all:e,scene:t,camera:i}){const n=Kl(({gl:a})=>a),r=Kl(({camera:a})=>a),s=Kl(({scene:a})=>a);return ge.useLayoutEffect(()=>{const a=[];e&&(t||s).traverse(c=>{c.visible===!1&&(a.push(c),c.visible=!0)}),n.compile(t||s,i||r);const o=new uF(128);new cF(.01,1e5,o).update(n,t||s),o.dispose(),a.forEach(c=>c.visible=!1)},[]),null}const eK=()=>{const{progress:e}=$pe();return ke.jsxs(Qpe,{as:"div",center:!0,style:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},children:[ke.jsx("span",{className:"canvas-loader"}),ke.jsxs("p",{style:{fontSize:14,color:"#F1F1F1",fontWeight:800,marginTop:40},children:[e.toFixed(2),"%"]})]})},dge=()=>{const e=zR("./planet/scene.gltf");return ke.jsx("primitive",{object:e.scene,scale:2.5,"position-y":0,"rotation-y":0})},fge=()=>ke.jsx(jF,{shadows:!0,frameloop:"demand",dpr:[1,2],gl:{preserveDrawingBuffer:!0},camera:{fov:45,near:.1,far:200,position:[-4,3,6]},children:ke.jsxs(ge.Suspense,{fallback:ke.jsx(eK,{}),children:[ke.jsx($Q,{autoRotate:!0,enableZoom:!1,maxPolarAngle:Math.PI/2,minPolarAngle:Math.PI/2}),ke.jsx(dge,{}),ke.jsx(YF,{all:!0})]})}),pge=e=>{const[t]=qF([e.imgUrl]);return ke.jsxs(oge,{speed:1.75,rotationIntensity:1,floatIntensity:2,children:[ke.jsx("ambientLight",{intensity:.25}),ke.jsx("directionalLight",{position:[0,0,.05]}),ke.jsxs("mesh",{castShadow:!0,receiveShadow:!0,scale:2.75,children:[ke.jsx("icosahedronGeometry",{args:[1,5]}),ke.jsx("meshStandardMaterial",{color:"#fff8eb",polygonOffset:!0,polygonOffsetFactor:-5,flatShading:!0}),ke.jsx(ige,{position:[0,0,1],rotation:[2*Math.PI,0,6.25],scale:1,map:t,flatShading:!0})]})]})},mge=({icon:e})=>ke.jsxs(jF,{frameloop:"demand",dpr:[1,2],gl:{preserveDrawingBuffer:!0},children:[ke.jsxs(ge.Suspense,{fallback:ke.jsx(eK,{}),children:[ke.jsx($Q,{enableZoom:!1}),ke.jsx(pge,{imgUrl:e})]}),ke.jsx(YF,{all:!0})]}),gge=e=>{const t=ge.useRef(),[i]=ge.useState(()=>ame(new Float32Array(5e3),{radius:1.2}));return Ab((n,r)=>{t.current.rotation.x-=r/10,t.current.rotation.y-=r/15}),ke.jsx("group",{rotation:[0,0,Math.PI/4],children:ke.jsx(hge,{ref:t,positions:i,stride:3,frustumCulled:!0,...e,children:ke.jsx(age,{transparent:!0,color:"#f272c8",size:.002,sizeAttenuation:!0,depthWrite:!1})})})},vge=()=>ke.jsx("div",{className:"w-full h-auto absolute inset-0 z-[-1]",children:ke.jsxs(jF,{camera:{position:[0,0,1]},children:[ke.jsx(ge.Suspense,{fallback:null,children:ke.jsx(gge,{})}),ke.jsx(YF,{all:!0})]})}),tK=ge.createContext({});function yge(e){const t=ge.useRef(null);return t.current===null&&(t.current=e()),t.current}const QF=typeof window<"u",xge=QF?ge.useLayoutEffect:ge.useEffect,KF=ge.createContext(null);function JF(e,t){e.indexOf(t)===-1&&e.push(t)}function ZF(e,t){const i=e.indexOf(t);i>-1&&e.splice(i,1)}const ep=(e,t,i)=>i>t?t:i<e?e:i;let $F=()=>{};const tp={},iK=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e);function nK(e){return typeof e=="object"&&e!==null}const rK=e=>/^0[^.\s]+$/u.test(e);function e4(e){let t;return()=>(t===void 0&&(t=e()),t)}const Xc=e=>e,bge=(e,t)=>i=>t(e(i)),eM=(...e)=>e.reduce(bge),aw=(e,t,i)=>{const n=t-e;return n===0?1:(i-e)/n};class t4{constructor(){this.subscriptions=[]}add(t){return JF(this.subscriptions,t),()=>ZF(this.subscriptions,t)}notify(t,i,n){const r=this.subscriptions.length;if(r)if(r===1)this.subscriptions[0](t,i,n);else for(let s=0;s<r;s++){const a=this.subscriptions[s];a&&a(t,i,n)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const dd=e=>e*1e3,fd=e=>e/1e3;function sK(e,t){return t?e*(1e3/t):0}const aK=(e,t,i)=>(((1-3*i+3*t)*e+(3*i-6*t))*e+3*t)*e,Sge=1e-7,_ge=12;function Age(e,t,i,n,r){let s,a,o=0;do a=t+(i-t)/2,s=aK(a,n,r)-e,s>0?i=a:t=a;while(Math.abs(s)>Sge&&++o<_ge);return a}function tM(e,t,i,n){if(e===t&&i===n)return Xc;const r=s=>Age(s,0,1,e,i);return s=>s===0||s===1?s:aK(r(s),t,n)}const oK=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,lK=e=>t=>1-e(1-t),cK=tM(.33,1.53,.69,.99),i4=lK(cK),uK=oK(i4),hK=e=>(e*=2)<1?.5*i4(e):.5*(2-Math.pow(2,-10*(e-1))),n4=e=>1-Math.sin(Math.acos(e)),dK=lK(n4),fK=oK(n4),wge=tM(.42,0,1,1),Mge=tM(0,0,.58,1),pK=tM(.42,0,.58,1),Ege=e=>Array.isArray(e)&&typeof e[0]!="number",mK=e=>Array.isArray(e)&&typeof e[0]=="number",Tge={linear:Xc,easeIn:wge,easeInOut:pK,easeOut:Mge,circIn:n4,circInOut:fK,circOut:dK,backIn:i4,backInOut:uK,backOut:cK,anticipate:hK},Cge=e=>typeof e=="string",Bk=e=>{if(mK(e)){$F(e.length===4);const[t,i,n,r]=e;return tM(t,i,n,r)}else if(Cge(e))return Tge[e];return e},Y2=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"],Ik={value:null};function Dge(e,t){let i=new Set,n=new Set,r=!1,s=!1;const a=new WeakSet;let o={delta:0,timestamp:0,isProcessing:!1},l=0;function c(h){a.has(h)&&(u.schedule(h),e()),l++,h(o)}const u={schedule:(h,d=!1,p=!1)=>{const x=p&&r?i:n;return d&&a.add(h),x.has(h)||x.add(h),h},cancel:h=>{n.delete(h),a.delete(h)},process:h=>{if(o=h,r){s=!0;return}r=!0,[i,n]=[n,i],i.forEach(c),t&&Ik.value&&Ik.value.frameloop[t].push(l),l=0,i.clear(),r=!1,s&&(s=!1,u.process(h))}};return u}const Rge=40;function gK(e,t){let i=!1,n=!0;const r={delta:0,timestamp:0,isProcessing:!1},s=()=>i=!0,a=Y2.reduce((w,E)=>(w[E]=Dge(s,t?E:void 0),w),{}),{setup:o,read:l,resolveKeyframes:c,preUpdate:u,update:h,preRender:d,render:p,postRender:g}=a,x=()=>{const w=tp.useManualTiming?r.timestamp:performance.now();i=!1,tp.useManualTiming||(r.delta=n?1e3/60:Math.max(Math.min(w-r.timestamp,Rge),1)),r.timestamp=w,r.isProcessing=!0,o.process(r),l.process(r),c.process(r),u.process(r),h.process(r),d.process(r),p.process(r),g.process(r),r.isProcessing=!1,i&&t&&(n=!1,e(x))},y=()=>{i=!0,n=!0,r.isProcessing||e(x)};return{schedule:Y2.reduce((w,E)=>{const D=a[E];return w[E]=(T,I=!1,R=!1)=>(i||y(),D.schedule(T,I,R)),w},{}),cancel:w=>{for(let E=0;E<Y2.length;E++)a[Y2[E]].cancel(w)},state:r,steps:a}}const{schedule:Vr,cancel:tg,state:za,steps:SB}=gK(typeof requestAnimationFrame<"u"?requestAnimationFrame:Xc,!0);let CC;function Pge(){CC=void 0}const Cl={now:()=>(CC===void 0&&Cl.set(za.isProcessing||tp.useManualTiming?za.timestamp:performance.now()),CC),set:e=>{CC=e,queueMicrotask(Pge)}},vK=e=>t=>typeof t=="string"&&t.startsWith(e),r4=vK("--"),Oge=vK("var(--"),s4=e=>Oge(e)?Bge.test(e.split("/*")[0].trim()):!1,Bge=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,wb={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},ow={...wb,transform:e=>ep(0,1,e)},Q2={...wb,default:1},EA=e=>Math.round(e*1e5)/1e5,a4=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function Ige(e){return e==null}const Lge=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,o4=(e,t)=>i=>!!(typeof i=="string"&&Lge.test(i)&&i.startsWith(e)||t&&!Ige(i)&&Object.prototype.hasOwnProperty.call(i,t)),yK=(e,t,i)=>n=>{if(typeof n!="string")return n;const[r,s,a,o]=n.match(a4);return{[e]:parseFloat(r),[t]:parseFloat(s),[i]:parseFloat(a),alpha:o!==void 0?parseFloat(o):1}},Uge=e=>ep(0,255,e),_B={...wb,transform:e=>Math.round(Uge(e))},n0={test:o4("rgb","red"),parse:yK("red","green","blue"),transform:({red:e,green:t,blue:i,alpha:n=1})=>"rgba("+_B.transform(e)+", "+_B.transform(t)+", "+_B.transform(i)+", "+EA(ow.transform(n))+")"};function Nge(e){let t="",i="",n="",r="";return e.length>5?(t=e.substring(1,3),i=e.substring(3,5),n=e.substring(5,7),r=e.substring(7,9)):(t=e.substring(1,2),i=e.substring(2,3),n=e.substring(3,4),r=e.substring(4,5),t+=t,i+=i,n+=n,r+=r),{red:parseInt(t,16),green:parseInt(i,16),blue:parseInt(n,16),alpha:r?parseInt(r,16)/255:1}}const vU={test:o4("#"),parse:Nge,transform:n0.transform},iM=e=>({test:t=>typeof t=="string"&&t.endsWith(e)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${e}`}),Mm=iM("deg"),pd=iM("%"),Ni=iM("px"),zge=iM("vh"),Fge=iM("vw"),Lk={...pd,parse:e=>pd.parse(e)/100,transform:e=>pd.transform(e*100)},l1={test:o4("hsl","hue"),parse:yK("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:i,alpha:n=1})=>"hsla("+Math.round(e)+", "+pd.transform(EA(t))+", "+pd.transform(EA(i))+", "+EA(ow.transform(n))+")"},ho={test:e=>n0.test(e)||vU.test(e)||l1.test(e),parse:e=>n0.test(e)?n0.parse(e):l1.test(e)?l1.parse(e):vU.parse(e),transform:e=>typeof e=="string"?e:e.hasOwnProperty("red")?n0.transform(e):l1.transform(e)},Vge=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function Hge(e){var t,i;return isNaN(e)&&typeof e=="string"&&(((t=e.match(a4))==null?void 0:t.length)||0)+(((i=e.match(Vge))==null?void 0:i.length)||0)>0}const xK="number",bK="color",Gge="var",kge="var(",Uk="${}",jge=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function lw(e){const t=e.toString(),i=[],n={color:[],number:[],var:[]},r=[];let s=0;const o=t.replace(jge,l=>(ho.test(l)?(n.color.push(s),r.push(bK),i.push(ho.parse(l))):l.startsWith(kge)?(n.var.push(s),r.push(Gge),i.push(l)):(n.number.push(s),r.push(xK),i.push(parseFloat(l))),++s,Uk)).split(Uk);return{values:i,split:o,indexes:n,types:r}}function SK(e){return lw(e).values}function _K(e){const{split:t,types:i}=lw(e),n=t.length;return r=>{let s="";for(let a=0;a<n;a++)if(s+=t[a],r[a]!==void 0){const o=i[a];o===xK?s+=EA(r[a]):o===bK?s+=ho.transform(r[a]):s+=r[a]}return s}}const Wge=e=>typeof e=="number"?0:e;function Xge(e){const t=SK(e);return _K(e)(t.map(Wge))}const ig={test:Hge,parse:SK,createTransformer:_K,getAnimatableNone:Xge};function AB(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+(t-e)*6*i:i<1/2?t:i<2/3?e+(t-e)*(2/3-i)*6:e}function qge({hue:e,saturation:t,lightness:i,alpha:n}){e/=360,t/=100,i/=100;let r=0,s=0,a=0;if(!t)r=s=a=i;else{const o=i<.5?i*(1+t):i+t-i*t,l=2*i-o;r=AB(l,o,e+1/3),s=AB(l,o,e),a=AB(l,o,e-1/3)}return{red:Math.round(r*255),green:Math.round(s*255),blue:Math.round(a*255),alpha:n}}function jD(e,t){return i=>i>0?t:e}const zr=(e,t,i)=>e+(t-e)*i,wB=(e,t,i)=>{const n=e*e,r=i*(t*t-n)+n;return r<0?0:Math.sqrt(r)},Yge=[vU,n0,l1],Qge=e=>Yge.find(t=>t.test(e));function Nk(e){const t=Qge(e);if(!t)return!1;let i=t.parse(e);return t===l1&&(i=qge(i)),i}const zk=(e,t)=>{const i=Nk(e),n=Nk(t);if(!i||!n)return jD(e,t);const r={...i};return s=>(r.red=wB(i.red,n.red,s),r.green=wB(i.green,n.green,s),r.blue=wB(i.blue,n.blue,s),r.alpha=zr(i.alpha,n.alpha,s),n0.transform(r))},yU=new Set(["none","hidden"]);function Kge(e,t){return yU.has(e)?i=>i<=0?e:t:i=>i>=1?t:e}function Jge(e,t){return i=>zr(e,t,i)}function l4(e){return typeof e=="number"?Jge:typeof e=="string"?s4(e)?jD:ho.test(e)?zk:eve:Array.isArray(e)?AK:typeof e=="object"?ho.test(e)?zk:Zge:jD}function AK(e,t){const i=[...e],n=i.length,r=e.map((s,a)=>l4(s)(s,t[a]));return s=>{for(let a=0;a<n;a++)i[a]=r[a](s);return i}}function Zge(e,t){const i={...e,...t},n={};for(const r in i)e[r]!==void 0&&t[r]!==void 0&&(n[r]=l4(e[r])(e[r],t[r]));return r=>{for(const s in n)i[s]=n[s](r);return i}}function $ge(e,t){const i=[],n={color:0,var:0,number:0};for(let r=0;r<t.values.length;r++){const s=t.types[r],a=e.indexes[s][n[s]],o=e.values[a]??0;i[r]=o,n[s]++}return i}const eve=(e,t)=>{const i=ig.createTransformer(t),n=lw(e),r=lw(t);return n.indexes.var.length===r.indexes.var.length&&n.indexes.color.length===r.indexes.color.length&&n.indexes.number.length>=r.indexes.number.length?yU.has(e)&&!r.values.length||yU.has(t)&&!n.values.length?Kge(e,t):eM(AK($ge(n,r),r.values),i):jD(e,t)};function wK(e,t,i){return typeof e=="number"&&typeof t=="number"&&typeof i=="number"?zr(e,t,i):l4(e)(e,t)}const tve=e=>{const t=({timestamp:i})=>e(i);return{start:(i=!0)=>Vr.update(t,i),stop:()=>tg(t),now:()=>za.isProcessing?za.timestamp:Cl.now()}},MK=(e,t,i=10)=>{let n="";const r=Math.max(Math.round(t/i),2);for(let s=0;s<r;s++)n+=e(s/(r-1))+", ";return`linear(${n.substring(0,n.length-2)})`},WD=2e4;function c4(e){let t=0;const i=50;let n=e.next(t);for(;!n.done&&t<WD;)t+=i,n=e.next(t);return t>=WD?1/0:t}function ive(e,t=100,i){const n=i({...e,keyframes:[0,t]}),r=Math.min(c4(n),WD);return{type:"keyframes",ease:s=>n.next(r*s).value/t,duration:fd(r)}}const nve=5;function EK(e,t,i){const n=Math.max(t-nve,0);return sK(i-e(n),t-n)}const Jr={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},Fk=.001;function rve({duration:e=Jr.duration,bounce:t=Jr.bounce,velocity:i=Jr.velocity,mass:n=Jr.mass}){let r,s,a=1-t;a=ep(Jr.minDamping,Jr.maxDamping,a),e=ep(Jr.minDuration,Jr.maxDuration,fd(e)),a<1?(r=c=>{const u=c*a,h=u*e,d=u-i,p=xU(c,a),g=Math.exp(-h);return Fk-d/p*g},s=c=>{const h=c*a*e,d=h*i+i,p=Math.pow(a,2)*Math.pow(c,2)*e,g=Math.exp(-h),x=xU(Math.pow(c,2),a);return(-r(c)+Fk>0?-1:1)*((d-p)*g)/x}):(r=c=>{const u=Math.exp(-c*e),h=(c-i)*e+1;return-.001+u*h},s=c=>{const u=Math.exp(-c*e),h=(i-c)*(e*e);return u*h});const o=5/e,l=ave(r,s,o);if(e=dd(e),isNaN(l))return{stiffness:Jr.stiffness,damping:Jr.damping,duration:e};{const c=Math.pow(l,2)*n;return{stiffness:c,damping:a*2*Math.sqrt(n*c),duration:e}}}const sve=12;function ave(e,t,i){let n=i;for(let r=1;r<sve;r++)n=n-e(n)/t(n);return n}function xU(e,t){return e*Math.sqrt(1-t*t)}const ove=["duration","bounce"],lve=["stiffness","damping","mass"];function Vk(e,t){return t.some(i=>e[i]!==void 0)}function cve(e){let t={velocity:Jr.velocity,stiffness:Jr.stiffness,damping:Jr.damping,mass:Jr.mass,isResolvedFromDuration:!1,...e};if(!Vk(e,lve)&&Vk(e,ove))if(e.visualDuration){const i=e.visualDuration,n=2*Math.PI/(i*1.2),r=n*n,s=2*ep(.05,1,1-(e.bounce||0))*Math.sqrt(r);t={...t,mass:Jr.mass,stiffness:r,damping:s}}else{const i=rve(e);t={...t,...i,mass:Jr.mass},t.isResolvedFromDuration=!0}return t}function XD(e=Jr.visualDuration,t=Jr.bounce){const i=typeof e!="object"?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:n,restDelta:r}=i;const s=i.keyframes[0],a=i.keyframes[i.keyframes.length-1],o={done:!1,value:s},{stiffness:l,damping:c,mass:u,duration:h,velocity:d,isResolvedFromDuration:p}=cve({...i,velocity:-fd(i.velocity||0)}),g=d||0,x=c/(2*Math.sqrt(l*u)),y=a-s,b=fd(Math.sqrt(l/u)),A=Math.abs(y)<5;n||(n=A?Jr.restSpeed.granular:Jr.restSpeed.default),r||(r=A?Jr.restDelta.granular:Jr.restDelta.default);let w;if(x<1){const D=xU(b,x);w=T=>{const I=Math.exp(-x*b*T);return a-I*((g+x*b*y)/D*Math.sin(D*T)+y*Math.cos(D*T))}}else if(x===1)w=D=>a-Math.exp(-b*D)*(y+(g+b*y)*D);else{const D=b*Math.sqrt(x*x-1);w=T=>{const I=Math.exp(-x*b*T),R=Math.min(D*T,300);return a-I*((g+x*b*y)*Math.sinh(R)+D*y*Math.cosh(R))/D}}const E={calculatedDuration:p&&h||null,next:D=>{const T=w(D);if(p)o.done=D>=h;else{let I=D===0?g:0;x<1&&(I=D===0?dd(g):EK(w,D,T));const R=Math.abs(I)<=n,O=Math.abs(a-T)<=r;o.done=R&&O}return o.value=o.done?a:T,o},toString:()=>{const D=Math.min(c4(E),WD),T=MK(I=>E.next(D*I).value,D,30);return D+"ms "+T},toTransition:()=>{}};return E}XD.applyToOptions=e=>{const t=ive(e,100,XD);return e.ease=t.ease,e.duration=dd(t.duration),e.type="keyframes",e};function bU({keyframes:e,velocity:t=0,power:i=.8,timeConstant:n=325,bounceDamping:r=10,bounceStiffness:s=500,modifyTarget:a,min:o,max:l,restDelta:c=.5,restSpeed:u}){const h=e[0],d={done:!1,value:h},p=R=>o!==void 0&&R<o||l!==void 0&&R>l,g=R=>o===void 0?l:l===void 0||Math.abs(o-R)<Math.abs(l-R)?o:l;let x=i*t;const y=h+x,b=a===void 0?y:a(y);b!==y&&(x=b-h);const A=R=>-x*Math.exp(-R/n),w=R=>b+A(R),E=R=>{const O=A(R),P=w(R);d.done=Math.abs(O)<=c,d.value=d.done?b:P};let D,T;const I=R=>{p(d.value)&&(D=R,T=XD({keyframes:[d.value,g(d.value)],velocity:EK(w,R,d.value),damping:r,stiffness:s,restDelta:c,restSpeed:u}))};return I(0),{calculatedDuration:null,next:R=>{let O=!1;return!T&&D===void 0&&(O=!0,E(R),I(R)),D!==void 0&&R>=D?T.next(R-D):(!O&&E(R),d)}}}function uve(e,t,i){const n=[],r=i||tp.mix||wK,s=e.length-1;for(let a=0;a<s;a++){let o=r(e[a],e[a+1]);if(t){const l=Array.isArray(t)?t[a]||Xc:t;o=eM(l,o)}n.push(o)}return n}function hve(e,t,{clamp:i=!0,ease:n,mixer:r}={}){const s=e.length;if($F(s===t.length),s===1)return()=>t[0];if(s===2&&t[0]===t[1])return()=>t[1];const a=e[0]===e[1];e[0]>e[s-1]&&(e=[...e].reverse(),t=[...t].reverse());const o=uve(t,n,r),l=o.length,c=u=>{if(a&&u<e[0])return t[0];let h=0;if(l>1)for(;h<e.length-2&&!(u<e[h+1]);h++);const d=aw(e[h],e[h+1],u);return o[h](d)};return i?u=>c(ep(e[0],e[s-1],u)):c}function dve(e,t){const i=e[e.length-1];for(let n=1;n<=t;n++){const r=aw(0,t,n);e.push(zr(i,1,r))}}function fve(e){const t=[0];return dve(t,e.length-1),t}function pve(e,t){return e.map(i=>i*t)}function mve(e,t){return e.map(()=>t||pK).splice(0,e.length-1)}function TA({duration:e=300,keyframes:t,times:i,ease:n="easeInOut"}){const r=Ege(n)?n.map(Bk):Bk(n),s={done:!1,value:t[0]},a=pve(i&&i.length===t.length?i:fve(t),e),o=hve(a,t,{ease:Array.isArray(r)?r:mve(t,r)});return{calculatedDuration:e,next:l=>(s.value=o(l),s.done=l>=e,s)}}const gve=e=>e!==null;function u4(e,{repeat:t,repeatType:i="loop"},n,r=1){const s=e.filter(gve),o=r<0||t&&i!=="loop"&&t%2===1?0:s.length-1;return!o||n===void 0?s[o]:n}const vve={decay:bU,inertia:bU,tween:TA,keyframes:TA,spring:XD};function TK(e){typeof e.type=="string"&&(e.type=vve[e.type])}class h4{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(t=>{this.resolve=t})}notifyFinished(){this.resolve()}then(t,i){return this.finished.then(t,i)}}const yve=e=>e/100;class d4 extends h4{constructor(t){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var n,r;const{motionValue:i}=this.options;i&&i.updatedAt!==Cl.now()&&this.tick(Cl.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),(r=(n=this.options).onStop)==null||r.call(n))},this.options=t,this.initAnimation(),this.play(),t.autoplay===!1&&this.pause()}initAnimation(){const{options:t}=this;TK(t);const{type:i=TA,repeat:n=0,repeatDelay:r=0,repeatType:s,velocity:a=0}=t;let{keyframes:o}=t;const l=i||TA;l!==TA&&typeof o[0]!="number"&&(this.mixKeyframes=eM(yve,wK(o[0],o[1])),o=[0,100]);const c=l({...t,keyframes:o});s==="mirror"&&(this.mirroredGenerator=l({...t,keyframes:[...o].reverse(),velocity:-a})),c.calculatedDuration===null&&(c.calculatedDuration=c4(c));const{calculatedDuration:u}=c;this.calculatedDuration=u,this.resolvedDuration=u+r,this.totalDuration=this.resolvedDuration*(n+1)-r,this.generator=c}updateTime(t){const i=Math.round(t-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=i}tick(t,i=!1){const{generator:n,totalDuration:r,mixKeyframes:s,mirroredGenerator:a,resolvedDuration:o,calculatedDuration:l}=this;if(this.startTime===null)return n.next(0);const{delay:c=0,keyframes:u,repeat:h,repeatType:d,repeatDelay:p,type:g,onUpdate:x,finalKeyframe:y}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-r/this.speed,this.startTime)),i?this.currentTime=t:this.updateTime(t);const b=this.currentTime-c*(this.playbackSpeed>=0?1:-1),A=this.playbackSpeed>=0?b<0:b>r;this.currentTime=Math.max(b,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=r);let w=this.currentTime,E=n;if(h){const R=Math.min(this.currentTime,r)/o;let O=Math.floor(R),P=R%1;!P&&R>=1&&(P=1),P===1&&O--,O=Math.min(O,h+1),!!(O%2)&&(d==="reverse"?(P=1-P,p&&(P-=p/o)):d==="mirror"&&(E=a)),w=ep(0,1,P)*o}const D=A?{done:!1,value:u[0]}:E.next(w);s&&(D.value=s(D.value));let{done:T}=D;!A&&l!==null&&(T=this.playbackSpeed>=0?this.currentTime>=r:this.currentTime<=0);const I=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&T);return I&&g!==bU&&(D.value=u4(u,this.options,y,this.speed)),x&&x(D.value),I&&this.finish(),D}then(t,i){return this.finished.then(t,i)}get duration(){return fd(this.calculatedDuration)}get time(){return fd(this.currentTime)}set time(t){var i;t=dd(t),this.currentTime=t,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.playbackSpeed),(i=this.driver)==null||i.start(!1)}get speed(){return this.playbackSpeed}set speed(t){this.updateTime(Cl.now());const i=this.playbackSpeed!==t;this.playbackSpeed=t,i&&(this.time=fd(this.currentTime))}play(){var r,s;if(this.isStopped)return;const{driver:t=tve,startTime:i}=this.options;this.driver||(this.driver=t(a=>this.tick(a))),(s=(r=this.options).onPlay)==null||s.call(r);const n=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=n):this.holdTime!==null?this.startTime=n-this.holdTime:this.startTime||(this.startTime=i??n),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(Cl.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){var t,i;this.notifyFinished(),this.teardown(),this.state="finished",(i=(t=this.options).onComplete)==null||i.call(t)}cancel(){var t,i;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),(i=(t=this.options).onCancel)==null||i.call(t)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}attachTimeline(t){var i;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),(i=this.driver)==null||i.stop(),t.observe(this)}}function xve(e){for(let t=1;t<e.length;t++)e[t]??(e[t]=e[t-1])}const r0=e=>e*180/Math.PI,SU=e=>{const t=r0(Math.atan2(e[1],e[0]));return _U(t)},bve={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:e=>(Math.abs(e[0])+Math.abs(e[3]))/2,rotate:SU,rotateZ:SU,skewX:e=>r0(Math.atan(e[1])),skewY:e=>r0(Math.atan(e[2])),skew:e=>(Math.abs(e[1])+Math.abs(e[2]))/2},_U=e=>(e=e%360,e<0&&(e+=360),e),Hk=SU,Gk=e=>Math.sqrt(e[0]*e[0]+e[1]*e[1]),kk=e=>Math.sqrt(e[4]*e[4]+e[5]*e[5]),Sve={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:Gk,scaleY:kk,scale:e=>(Gk(e)+kk(e))/2,rotateX:e=>_U(r0(Math.atan2(e[6],e[5]))),rotateY:e=>_U(r0(Math.atan2(-e[2],e[0]))),rotateZ:Hk,rotate:Hk,skewX:e=>r0(Math.atan(e[4])),skewY:e=>r0(Math.atan(e[1])),skew:e=>(Math.abs(e[1])+Math.abs(e[4]))/2};function AU(e){return e.includes("scale")?1:0}function wU(e,t){if(!e||e==="none")return AU(t);const i=e.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let n,r;if(i)n=Sve,r=i;else{const o=e.match(/^matrix\(([-\d.e\s,]+)\)$/u);n=bve,r=o}if(!r)return AU(t);const s=n[t],a=r[1].split(",").map(Ave);return typeof s=="function"?s(a):a[s]}const _ve=(e,t)=>{const{transform:i="none"}=getComputedStyle(e);return wU(i,t)};function Ave(e){return parseFloat(e.trim())}const Mb=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Eb=new Set(Mb),jk=e=>e===wb||e===Ni,wve=new Set(["x","y","z"]),Mve=Mb.filter(e=>!wve.has(e));function Eve(e){const t=[];return Mve.forEach(i=>{const n=e.getValue(i);n!==void 0&&(t.push([i,n.get()]),n.set(i.startsWith("scale")?1:0))}),t}const v0={width:({x:e},{paddingLeft:t="0",paddingRight:i="0"})=>e.max-e.min-parseFloat(t)-parseFloat(i),height:({y:e},{paddingTop:t="0",paddingBottom:i="0"})=>e.max-e.min-parseFloat(t)-parseFloat(i),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:(e,{transform:t})=>wU(t,"x"),y:(e,{transform:t})=>wU(t,"y")};v0.translateX=v0.x;v0.translateY=v0.y;const y0=new Set;let MU=!1,EU=!1,TU=!1;function CK(){if(EU){const e=Array.from(y0).filter(n=>n.needsMeasurement),t=new Set(e.map(n=>n.element)),i=new Map;t.forEach(n=>{const r=Eve(n);r.length&&(i.set(n,r),n.render())}),e.forEach(n=>n.measureInitialState()),t.forEach(n=>{n.render();const r=i.get(n);r&&r.forEach(([s,a])=>{var o;(o=n.getValue(s))==null||o.set(a)})}),e.forEach(n=>n.measureEndState()),e.forEach(n=>{n.suspendedScrollY!==void 0&&window.scrollTo(0,n.suspendedScrollY)})}EU=!1,MU=!1,y0.forEach(e=>e.complete(TU)),y0.clear()}function DK(){y0.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(EU=!0)})}function Tve(){TU=!0,DK(),CK(),TU=!1}class f4{constructor(t,i,n,r,s,a=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...t],this.onComplete=i,this.name=n,this.motionValue=r,this.element=s,this.isAsync=a}scheduleResolve(){this.state="scheduled",this.isAsync?(y0.add(this),MU||(MU=!0,Vr.read(DK),Vr.resolveKeyframes(CK))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:i,element:n,motionValue:r}=this;if(t[0]===null){const s=r==null?void 0:r.get(),a=t[t.length-1];if(s!==void 0)t[0]=s;else if(n&&i){const o=n.readValue(i,a);o!=null&&(t[0]=o)}t[0]===void 0&&(t[0]=a),r&&s===void 0&&r.set(t[0])}xve(t)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(t=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,t),y0.delete(this)}cancel(){this.state==="scheduled"&&(y0.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const Cve=e=>e.startsWith("--");function Dve(e,t,i){Cve(t)?e.style.setProperty(t,i):e.style[t]=i}const Rve=e4(()=>window.ScrollTimeline!==void 0),Pve={};function Ove(e,t){const i=e4(e);return()=>Pve[t]??i()}const RK=Ove(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),rA=([e,t,i,n])=>`cubic-bezier(${e}, ${t}, ${i}, ${n})`,Wk={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:rA([0,.65,.55,1]),circOut:rA([.55,0,1,.45]),backIn:rA([.31,.01,.66,-.59]),backOut:rA([.33,1.53,.69,.99])};function PK(e,t){if(e)return typeof e=="function"?RK()?MK(e,t):"ease-out":mK(e)?rA(e):Array.isArray(e)?e.map(i=>PK(i,t)||Wk.easeOut):Wk[e]}function Bve(e,t,i,{delay:n=0,duration:r=300,repeat:s=0,repeatType:a="loop",ease:o="easeOut",times:l}={},c=void 0){const u={[t]:i};l&&(u.offset=l);const h=PK(o,r);Array.isArray(h)&&(u.easing=h);const d={delay:n,duration:r,easing:Array.isArray(h)?"linear":h,fill:"both",iterations:s+1,direction:a==="reverse"?"alternate":"normal"};return c&&(d.pseudoElement=c),e.animate(u,d)}function OK(e){return typeof e=="function"&&"applyToOptions"in e}function Ive({type:e,...t}){return OK(e)&&RK()?e.applyToOptions(t):(t.duration??(t.duration=300),t.ease??(t.ease="easeOut"),t)}class Lve extends h4{constructor(t){if(super(),this.finishedTime=null,this.isStopped=!1,!t)return;const{element:i,name:n,keyframes:r,pseudoElement:s,allowFlatten:a=!1,finalKeyframe:o,onComplete:l}=t;this.isPseudoElement=!!s,this.allowFlatten=a,this.options=t,$F(typeof t.type!="string");const c=Ive(t);this.animation=Bve(i,n,r,c,s),c.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!s){const u=u4(r,this.options,o,this.speed);this.updateMotionValue?this.updateMotionValue(u):Dve(i,n,u),this.animation.cancel()}l==null||l(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){var t,i;(i=(t=this.animation).finish)==null||i.call(t)}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:t}=this;t==="idle"||t==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var t,i;this.isPseudoElement||(i=(t=this.animation).commitStyles)==null||i.call(t)}get duration(){var i,n;const t=((n=(i=this.animation.effect)==null?void 0:i.getComputedTiming)==null?void 0:n.call(i).duration)||0;return fd(Number(t))}get time(){return fd(Number(this.animation.currentTime)||0)}set time(t){this.finishedTime=null,this.animation.currentTime=dd(t)}get speed(){return this.animation.playbackRate}set speed(t){t<0&&(this.finishedTime=null),this.animation.playbackRate=t}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(t){this.animation.startTime=t}attachTimeline({timeline:t,observe:i}){var n;return this.allowFlatten&&((n=this.animation.effect)==null||n.updateTiming({easing:"linear"})),this.animation.onfinish=null,t&&Rve()?(this.animation.timeline=t,Xc):i(this)}}const BK={anticipate:hK,backInOut:uK,circInOut:fK};function Uve(e){return e in BK}function Nve(e){typeof e.ease=="string"&&Uve(e.ease)&&(e.ease=BK[e.ease])}const Xk=10;class zve extends Lve{constructor(t){Nve(t),TK(t),super(t),t.startTime&&(this.startTime=t.startTime),this.options=t}updateMotionValue(t){const{motionValue:i,onUpdate:n,onComplete:r,element:s,...a}=this.options;if(!i)return;if(t!==void 0){i.set(t);return}const o=new d4({...a,autoplay:!1}),l=dd(this.finishedTime??this.time);i.setWithVelocity(o.sample(l-Xk).value,o.sample(l).value,Xk),o.stop()}}const qk=(e,t)=>t==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(ig.test(e)||e==="0")&&!e.startsWith("url("));function Fve(e){const t=e[0];if(e.length===1)return!0;for(let i=0;i<e.length;i++)if(e[i]!==t)return!0}function Vve(e,t,i,n){const r=e[0];if(r===null)return!1;if(t==="display"||t==="visibility")return!0;const s=e[e.length-1],a=qk(r,t),o=qk(s,t);return!a||!o?!1:Fve(e)||(i==="spring"||OK(i))&&n}function IK(e){return nK(e)&&"offsetHeight"in e}const Hve=new Set(["opacity","clipPath","filter","transform"]),Gve=e4(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function kve(e){var c;const{motionValue:t,name:i,repeatDelay:n,repeatType:r,damping:s,type:a}=e;if(!IK((c=t==null?void 0:t.owner)==null?void 0:c.current))return!1;const{onUpdate:o,transformTemplate:l}=t.owner.getProps();return Gve()&&i&&Hve.has(i)&&(i!=="transform"||!l)&&!o&&!n&&r!=="mirror"&&s!==0&&a!=="inertia"}const jve=40;class Wve extends h4{constructor({autoplay:t=!0,delay:i=0,type:n="keyframes",repeat:r=0,repeatDelay:s=0,repeatType:a="loop",keyframes:o,name:l,motionValue:c,element:u,...h}){var g;super(),this.stop=()=>{var x,y;this._animation&&(this._animation.stop(),(x=this.stopTimeline)==null||x.call(this)),(y=this.keyframeResolver)==null||y.cancel()},this.createdAt=Cl.now();const d={autoplay:t,delay:i,type:n,repeat:r,repeatDelay:s,repeatType:a,name:l,motionValue:c,element:u,...h},p=(u==null?void 0:u.KeyframeResolver)||f4;this.keyframeResolver=new p(o,(x,y,b)=>this.onKeyframesResolved(x,y,d,!b),l,c,u),(g=this.keyframeResolver)==null||g.scheduleResolve()}onKeyframesResolved(t,i,n,r){this.keyframeResolver=void 0;const{name:s,type:a,velocity:o,delay:l,isHandoff:c,onUpdate:u}=n;this.resolvedAt=Cl.now(),Vve(t,s,a,o)||((tp.instantAnimations||!l)&&(u==null||u(u4(t,n,i))),t[0]=t[t.length-1],n.duration=0,n.repeat=0);const d={startTime:r?this.resolvedAt?this.resolvedAt-this.createdAt>jve?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:i,...n,keyframes:t},p=!c&&kve(d)?new zve({...d,element:d.motionValue.owner.current}):new d4(d);p.finished.then(()=>this.notifyFinished()).catch(Xc),this.pendingTimeline&&(this.stopTimeline=p.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=p}get finished(){return this._animation?this.animation.finished:this._finished}then(t,i){return this.finished.finally(t).then(()=>{})}get animation(){var t;return this._animation||((t=this.keyframeResolver)==null||t.resume(),Tve()),this._animation}get duration(){return this.animation.duration}get time(){return this.animation.time}set time(t){this.animation.time=t}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(t){this.animation.speed=t}get startTime(){return this.animation.startTime}attachTimeline(t){return this._animation?this.stopTimeline=this.animation.attachTimeline(t):this.pendingTimeline=t,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var t;this._animation&&this.animation.cancel(),(t=this.keyframeResolver)==null||t.cancel()}}const Xve=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function qve(e){const t=Xve.exec(e);if(!t)return[,];const[,i,n,r]=t;return[`--${i??n}`,r]}function LK(e,t,i=1){const[n,r]=qve(e);if(!n)return;const s=window.getComputedStyle(t).getPropertyValue(n);if(s){const a=s.trim();return iK(a)?parseFloat(a):a}return s4(r)?LK(r,t,i+1):r}function p4(e,t){return(e==null?void 0:e[t])??(e==null?void 0:e.default)??e}const UK=new Set(["width","height","top","left","right","bottom",...Mb]),Yve={test:e=>e==="auto",parse:e=>e},NK=e=>t=>t.test(e),zK=[wb,Ni,pd,Mm,Fge,zge,Yve],Yk=e=>zK.find(NK(e));function Qve(e){return typeof e=="number"?e===0:e!==null?e==="none"||e==="0"||rK(e):!0}const Kve=new Set(["brightness","contrast","saturate","opacity"]);function Jve(e){const[t,i]=e.slice(0,-1).split("(");if(t==="drop-shadow")return e;const[n]=i.match(a4)||[];if(!n)return e;const r=i.replace(n,"");let s=Kve.has(t)?1:0;return n!==i&&(s*=100),t+"("+s+r+")"}const Zve=/\b([a-z-]*)\(.*?\)/gu,CU={...ig,getAnimatableNone:e=>{const t=e.match(Zve);return t?t.map(Jve).join(" "):e}},Qk={...wb,transform:Math.round},$ve={rotate:Mm,rotateX:Mm,rotateY:Mm,rotateZ:Mm,scale:Q2,scaleX:Q2,scaleY:Q2,scaleZ:Q2,skew:Mm,skewX:Mm,skewY:Mm,distance:Ni,translateX:Ni,translateY:Ni,translateZ:Ni,x:Ni,y:Ni,z:Ni,perspective:Ni,transformPerspective:Ni,opacity:ow,originX:Lk,originY:Lk,originZ:Ni},m4={borderWidth:Ni,borderTopWidth:Ni,borderRightWidth:Ni,borderBottomWidth:Ni,borderLeftWidth:Ni,borderRadius:Ni,radius:Ni,borderTopLeftRadius:Ni,borderTopRightRadius:Ni,borderBottomRightRadius:Ni,borderBottomLeftRadius:Ni,width:Ni,maxWidth:Ni,height:Ni,maxHeight:Ni,top:Ni,right:Ni,bottom:Ni,left:Ni,padding:Ni,paddingTop:Ni,paddingRight:Ni,paddingBottom:Ni,paddingLeft:Ni,margin:Ni,marginTop:Ni,marginRight:Ni,marginBottom:Ni,marginLeft:Ni,backgroundPositionX:Ni,backgroundPositionY:Ni,...$ve,zIndex:Qk,fillOpacity:ow,strokeOpacity:ow,numOctaves:Qk},e0e={...m4,color:ho,backgroundColor:ho,outlineColor:ho,fill:ho,stroke:ho,borderColor:ho,borderTopColor:ho,borderRightColor:ho,borderBottomColor:ho,borderLeftColor:ho,filter:CU,WebkitFilter:CU},FK=e=>e0e[e];function VK(e,t){let i=FK(e);return i!==CU&&(i=ig),i.getAnimatableNone?i.getAnimatableNone(t):void 0}const t0e=new Set(["auto","none","0"]);function i0e(e,t,i){let n=0,r;for(;n<e.length&&!r;){const s=e[n];typeof s=="string"&&!t0e.has(s)&&lw(s).values.length&&(r=e[n]),n++}if(r&&i)for(const s of t)e[s]=VK(i,r)}class n0e extends f4{constructor(t,i,n,r,s){super(t,i,n,r,s,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:i,name:n}=this;if(!i||!i.current)return;super.readKeyframes();for(let l=0;l<t.length;l++){let c=t[l];if(typeof c=="string"&&(c=c.trim(),s4(c))){const u=LK(c,i.current);u!==void 0&&(t[l]=u),l===t.length-1&&(this.finalKeyframe=c)}}if(this.resolveNoneKeyframes(),!UK.has(n)||t.length!==2)return;const[r,s]=t,a=Yk(r),o=Yk(s);if(a!==o)if(jk(a)&&jk(o))for(let l=0;l<t.length;l++){const c=t[l];typeof c=="string"&&(t[l]=parseFloat(c))}else v0[n]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:i}=this,n=[];for(let r=0;r<t.length;r++)(t[r]===null||Qve(t[r]))&&n.push(r);n.length&&i0e(t,n,i)}measureInitialState(){const{element:t,unresolvedKeyframes:i,name:n}=this;if(!t||!t.current)return;n==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=v0[n](t.measureViewportBox(),window.getComputedStyle(t.current)),i[0]=this.measuredOrigin;const r=i[i.length-1];r!==void 0&&t.getValue(n,r).jump(r,!1)}measureEndState(){var o;const{element:t,name:i,unresolvedKeyframes:n}=this;if(!t||!t.current)return;const r=t.getValue(i);r&&r.jump(this.measuredOrigin,!1);const s=n.length-1,a=n[s];n[s]=v0[i](t.measureViewportBox(),window.getComputedStyle(t.current)),a!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=a),(o=this.removedTransforms)!=null&&o.length&&this.removedTransforms.forEach(([l,c])=>{t.getValue(l).set(c)}),this.resolveNoneKeyframes()}}function r0e(e,t,i){if(e instanceof EventTarget)return[e];if(typeof e=="string"){let n=document;const r=(i==null?void 0:i[e])??n.querySelectorAll(e);return r?Array.from(r):[]}return Array.from(e)}const HK=(e,t)=>t&&typeof e=="number"?t.transform(e):e,Kk=30,s0e=e=>!isNaN(parseFloat(e));class a0e{constructor(t,i={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=(n,r=!0)=>{var a,o;const s=Cl.now();if(this.updatedAt!==s&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(n),this.current!==this.prev&&((a=this.events.change)==null||a.notify(this.current),this.dependents))for(const l of this.dependents)l.dirty();r&&((o=this.events.renderRequest)==null||o.notify(this.current))},this.hasAnimated=!1,this.setCurrent(t),this.owner=i.owner}setCurrent(t){this.current=t,this.updatedAt=Cl.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=s0e(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,i){this.events[t]||(this.events[t]=new t4);const n=this.events[t].add(i);return t==="change"?()=>{n(),Vr.read(()=>{this.events.change.getSize()||this.stop()})}:n}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,i){this.passiveEffect=t,this.stopPassiveEffect=i}set(t,i=!0){!i||!this.passiveEffect?this.updateAndNotify(t,i):this.passiveEffect(t,this.updateAndNotify)}setWithVelocity(t,i,n){this.set(i),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-n}jump(t,i=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,i&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var t;(t=this.events.change)==null||t.notify(this.current)}addDependent(t){this.dependents||(this.dependents=new Set),this.dependents.add(t)}removeDependent(t){this.dependents&&this.dependents.delete(t)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=Cl.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>Kk)return 0;const i=Math.min(this.updatedAt-this.prevUpdatedAt,Kk);return sK(parseFloat(this.current)-parseFloat(this.prevFrameValue),i)}start(t){return this.stop(),new Promise(i=>{this.hasAnimated=!0,this.animation=t(i),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var t,i;(t=this.dependents)==null||t.clear(),(i=this.events.destroy)==null||i.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function J1(e,t){return new a0e(e,t)}const{schedule:g4}=gK(queueMicrotask,!1),Vu={x:!1,y:!1};function GK(){return Vu.x||Vu.y}function o0e(e){return e==="x"||e==="y"?Vu[e]?null:(Vu[e]=!0,()=>{Vu[e]=!1}):Vu.x||Vu.y?null:(Vu.x=Vu.y=!0,()=>{Vu.x=Vu.y=!1})}function kK(e,t){const i=r0e(e),n=new AbortController,r={passive:!0,...t,signal:n.signal};return[i,r,()=>n.abort()]}function Jk(e){return!(e.pointerType==="touch"||GK())}function l0e(e,t,i={}){const[n,r,s]=kK(e,i),a=o=>{if(!Jk(o))return;const{target:l}=o,c=t(l,o);if(typeof c!="function"||!l)return;const u=h=>{Jk(h)&&(c(h),l.removeEventListener("pointerleave",u))};l.addEventListener("pointerleave",u,r)};return n.forEach(o=>{o.addEventListener("pointerenter",a,r)}),s}const jK=(e,t)=>t?e===t?!0:jK(e,t.parentElement):!1,v4=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1,c0e=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function u0e(e){return c0e.has(e.tagName)||e.tabIndex!==-1}const DC=new WeakSet;function Zk(e){return t=>{t.key==="Enter"&&e(t)}}function MB(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}const h0e=(e,t)=>{const i=e.currentTarget;if(!i)return;const n=Zk(()=>{if(DC.has(i))return;MB(i,"down");const r=Zk(()=>{MB(i,"up")}),s=()=>MB(i,"cancel");i.addEventListener("keyup",r,t),i.addEventListener("blur",s,t)});i.addEventListener("keydown",n,t),i.addEventListener("blur",()=>i.removeEventListener("keydown",n),t)};function $k(e){return v4(e)&&!GK()}function d0e(e,t,i={}){const[n,r,s]=kK(e,i),a=o=>{const l=o.currentTarget;if(!$k(o))return;DC.add(l);const c=t(l,o),u=(p,g)=>{window.removeEventListener("pointerup",h),window.removeEventListener("pointercancel",d),DC.has(l)&&DC.delete(l),$k(p)&&typeof c=="function"&&c(p,{success:g})},h=p=>{u(p,l===window||l===document||i.useGlobalTarget||jK(l,p.target))},d=p=>{u(p,!1)};window.addEventListener("pointerup",h,r),window.addEventListener("pointercancel",d,r)};return n.forEach(o=>{(i.useGlobalTarget?window:o).addEventListener("pointerdown",a,r),IK(o)&&(o.addEventListener("focus",c=>h0e(c,r)),!u0e(o)&&!o.hasAttribute("tabindex")&&(o.tabIndex=0))}),s}function WK(e){return nK(e)&&"ownerSVGElement"in e}function f0e(e){return WK(e)&&e.tagName==="svg"}const vo=e=>!!(e&&e.getVelocity),p0e=[...zK,ho,ig],m0e=e=>p0e.find(NK(e)),XK=ge.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});function g0e(e=!0){const t=ge.useContext(KF);if(t===null)return[!0,null];const{isPresent:i,onExitComplete:n,register:r}=t,s=ge.useId();ge.useEffect(()=>{if(e)return r(s)},[e]);const a=ge.useCallback(()=>e&&n&&n(s),[s,n,e]);return!i&&n?[!1,a]:[!0]}const qK=ge.createContext({strict:!1}),e6={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Z1={};for(const e in e6)Z1[e]={isEnabled:t=>e6[e].some(i=>!!t[i])};function v0e(e){for(const t in e)Z1[t]={...Z1[t],...e[t]}}const y0e=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function qD(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||y0e.has(e)}let YK=e=>!qD(e);function x0e(e){e&&(YK=t=>t.startsWith("on")?!qD(t):e(t))}try{x0e(require("@emotion/is-prop-valid").default)}catch{}function b0e(e,t,i){const n={};for(const r in e)r==="values"&&typeof e.values=="object"||(YK(r)||i===!0&&qD(r)||!t&&!qD(r)||e.draggable&&r.startsWith("onDrag"))&&(n[r]=e[r]);return n}function S0e(e){if(typeof Proxy>"u")return e;const t=new Map,i=(...n)=>e(...n);return new Proxy(i,{get:(n,r)=>r==="create"?e:(t.has(r)||t.set(r,e(r)),t.get(r))})}const FR=ge.createContext({});function VR(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}function cw(e){return typeof e=="string"||Array.isArray(e)}const y4=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],x4=["initial",...y4];function HR(e){return VR(e.animate)||x4.some(t=>cw(e[t]))}function QK(e){return!!(HR(e)||e.variants)}function _0e(e,t){if(HR(e)){const{initial:i,animate:n}=e;return{initial:i===!1||cw(i)?i:void 0,animate:cw(n)?n:void 0}}return e.inherit!==!1?t:{}}function A0e(e){const{initial:t,animate:i}=_0e(e,ge.useContext(FR));return ge.useMemo(()=>({initial:t,animate:i}),[t6(t),t6(i)])}function t6(e){return Array.isArray(e)?e.join(" "):e}const w0e=Symbol.for("motionComponentSymbol");function c1(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function M0e(e,t,i){return ge.useCallback(n=>{n&&e.onMount&&e.onMount(n),t&&(n?t.mount(n):t.unmount()),i&&(typeof i=="function"?i(n):c1(i)&&(i.current=n))},[t])}const b4=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),E0e="framerAppearId",KK="data-"+b4(E0e),JK=ge.createContext({});function T0e(e,t,i,n,r){var x,y;const{visualElement:s}=ge.useContext(FR),a=ge.useContext(qK),o=ge.useContext(KF),l=ge.useContext(XK).reducedMotion,c=ge.useRef(null);n=n||a.renderer,!c.current&&n&&(c.current=n(e,{visualState:t,parent:s,props:i,presenceContext:o,blockInitialAnimation:o?o.initial===!1:!1,reducedMotionConfig:l}));const u=c.current,h=ge.useContext(JK);u&&!u.projection&&r&&(u.type==="html"||u.type==="svg")&&C0e(c.current,i,r,h);const d=ge.useRef(!1);ge.useInsertionEffect(()=>{u&&d.current&&u.update(i,o)});const p=i[KK],g=ge.useRef(!!p&&!((x=window.MotionHandoffIsComplete)!=null&&x.call(window,p))&&((y=window.MotionHasOptimisedAnimation)==null?void 0:y.call(window,p)));return xge(()=>{u&&(d.current=!0,window.MotionIsMounted=!0,u.updateFeatures(),g4.render(u.render),g.current&&u.animationState&&u.animationState.animateChanges())}),ge.useEffect(()=>{u&&(!g.current&&u.animationState&&u.animationState.animateChanges(),g.current&&(queueMicrotask(()=>{var b;(b=window.MotionHandoffMarkAsComplete)==null||b.call(window,p)}),g.current=!1))}),u}function C0e(e,t,i,n){const{layoutId:r,layout:s,drag:a,dragConstraints:o,layoutScroll:l,layoutRoot:c,layoutCrossfade:u}=t;e.projection=new i(e.latestValues,t["data-framer-portal-id"]?void 0:ZK(e.parent)),e.projection.setOptions({layoutId:r,layout:s,alwaysMeasureLayout:!!a||o&&c1(o),visualElement:e,animationType:typeof s=="string"?s:"both",initialPromotionConfig:n,crossfade:u,layoutScroll:l,layoutRoot:c})}function ZK(e){if(e)return e.options.allowProjection!==!1?e.projection:ZK(e.parent)}function D0e({preloadedFeatures:e,createVisualElement:t,useRender:i,useVisualState:n,Component:r}){e&&v0e(e);function s(o,l){let c;const u={...ge.useContext(XK),...o,layoutId:R0e(o)},{isStatic:h}=u,d=A0e(o),p=n(o,h);if(!h&&QF){P0e();const g=O0e(u);c=g.MeasureLayout,d.visualElement=T0e(r,p,u,t,g.ProjectionNode)}return ke.jsxs(FR.Provider,{value:d,children:[c&&d.visualElement?ke.jsx(c,{visualElement:d.visualElement,...u}):null,i(r,o,M0e(p,d.visualElement,l),p,h,d.visualElement)]})}s.displayName=`motion.${typeof r=="string"?r:`create(${r.displayName??r.name??""})`}`;const a=ge.forwardRef(s);return a[w0e]=r,a}function R0e({layoutId:e}){const t=ge.useContext(tK).id;return t&&e!==void 0?t+"-"+e:e}function P0e(e,t){ge.useContext(qK).strict}function O0e(e){const{drag:t,layout:i}=Z1;if(!t&&!i)return{};const n={...t,...i};return{MeasureLayout:t!=null&&t.isEnabled(e)||i!=null&&i.isEnabled(e)?n.MeasureLayout:void 0,ProjectionNode:n.ProjectionNode}}const uw={};function B0e(e){for(const t in e)uw[t]=e[t],r4(t)&&(uw[t].isCSSVariable=!0)}function $K(e,{layout:t,layoutId:i}){return Eb.has(e)||e.startsWith("origin")||(t||i!==void 0)&&(!!uw[e]||e==="opacity")}const I0e={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},L0e=Mb.length;function U0e(e,t,i){let n="",r=!0;for(let s=0;s<L0e;s++){const a=Mb[s],o=e[a];if(o===void 0)continue;let l=!0;if(typeof o=="number"?l=o===(a.startsWith("scale")?1:0):l=parseFloat(o)===0,!l||i){const c=HK(o,m4[a]);if(!l){r=!1;const u=I0e[a]||a;n+=`${u}(${c}) `}i&&(t[a]=c)}}return n=n.trim(),i?n=i(t,r?"":n):r&&(n="none"),n}function S4(e,t,i){const{style:n,vars:r,transformOrigin:s}=e;let a=!1,o=!1;for(const l in t){const c=t[l];if(Eb.has(l)){a=!0;continue}else if(r4(l)){r[l]=c;continue}else{const u=HK(c,m4[l]);l.startsWith("origin")?(o=!0,s[l]=u):n[l]=u}}if(t.transform||(a||i?n.transform=U0e(t,e.transform,i):n.transform&&(n.transform="none")),o){const{originX:l="50%",originY:c="50%",originZ:u=0}=s;n.transformOrigin=`${l} ${c} ${u}`}}const _4=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function eJ(e,t,i){for(const n in t)!vo(t[n])&&!$K(n,i)&&(e[n]=t[n])}function N0e({transformTemplate:e},t){return ge.useMemo(()=>{const i=_4();return S4(i,t,e),Object.assign({},i.vars,i.style)},[t])}function z0e(e,t){const i=e.style||{},n={};return eJ(n,i,e),Object.assign(n,N0e(e,t)),n}function F0e(e,t){const i={},n=z0e(e,t);return e.drag&&e.dragListener!==!1&&(i.draggable=!1,n.userSelect=n.WebkitUserSelect=n.WebkitTouchCallout="none",n.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(i.tabIndex=0),i.style=n,i}const V0e={offset:"stroke-dashoffset",array:"stroke-dasharray"},H0e={offset:"strokeDashoffset",array:"strokeDasharray"};function G0e(e,t,i=1,n=0,r=!0){e.pathLength=1;const s=r?V0e:H0e;e[s.offset]=Ni.transform(-n);const a=Ni.transform(t),o=Ni.transform(i);e[s.array]=`${a} ${o}`}function tJ(e,{attrX:t,attrY:i,attrScale:n,pathLength:r,pathSpacing:s=1,pathOffset:a=0,...o},l,c,u){if(S4(e,o,c),l){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:h,style:d}=e;h.transform&&(d.transform=h.transform,delete h.transform),(d.transform||h.transformOrigin)&&(d.transformOrigin=h.transformOrigin??"50% 50%",delete h.transformOrigin),d.transform&&(d.transformBox=(u==null?void 0:u.transformBox)??"fill-box",delete h.transformBox),t!==void 0&&(h.x=t),i!==void 0&&(h.y=i),n!==void 0&&(h.scale=n),r!==void 0&&G0e(h,r,s,a,!1)}const iJ=()=>({..._4(),attrs:{}}),nJ=e=>typeof e=="string"&&e.toLowerCase()==="svg";function k0e(e,t,i,n){const r=ge.useMemo(()=>{const s=iJ();return tJ(s,t,nJ(n),e.transformTemplate,e.style),{...s.attrs,style:{...s.style}}},[t]);if(e.style){const s={};eJ(s,e.style,e),r.style={...s,...r.style}}return r}const j0e=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function A4(e){return typeof e!="string"||e.includes("-")?!1:!!(j0e.indexOf(e)>-1||/[A-Z]/u.test(e))}function W0e(e=!1){return(i,n,r,{latestValues:s},a)=>{const l=(A4(i)?k0e:F0e)(n,s,a,i),c=b0e(n,typeof i=="string",e),u=i!==ge.Fragment?{...c,...l,ref:r}:{},{children:h}=n,d=ge.useMemo(()=>vo(h)?h.get():h,[h]);return ge.createElement(i,{...u,children:d})}}function i6(e){const t=[{},{}];return e==null||e.values.forEach((i,n)=>{t[0][n]=i.get(),t[1][n]=i.getVelocity()}),t}function w4(e,t,i,n){if(typeof t=="function"){const[r,s]=i6(n);t=t(i!==void 0?i:e.custom,r,s)}if(typeof t=="string"&&(t=e.variants&&e.variants[t]),typeof t=="function"){const[r,s]=i6(n);t=t(i!==void 0?i:e.custom,r,s)}return t}function RC(e){return vo(e)?e.get():e}function X0e({scrapeMotionValuesFromProps:e,createRenderState:t},i,n,r){return{latestValues:q0e(i,n,r,e),renderState:t()}}const rJ=e=>(t,i)=>{const n=ge.useContext(FR),r=ge.useContext(KF),s=()=>X0e(e,t,n,r);return i?s():yge(s)};function q0e(e,t,i,n){const r={},s=n(e,{});for(const d in s)r[d]=RC(s[d]);let{initial:a,animate:o}=e;const l=HR(e),c=QK(e);t&&c&&!l&&e.inherit!==!1&&(a===void 0&&(a=t.initial),o===void 0&&(o=t.animate));let u=i?i.initial===!1:!1;u=u||a===!1;const h=u?o:a;if(h&&typeof h!="boolean"&&!VR(h)){const d=Array.isArray(h)?h:[h];for(let p=0;p<d.length;p++){const g=w4(e,d[p]);if(g){const{transitionEnd:x,transition:y,...b}=g;for(const A in b){let w=b[A];if(Array.isArray(w)){const E=u?w.length-1:0;w=w[E]}w!==null&&(r[A]=w)}for(const A in x)r[A]=x[A]}}}return r}function M4(e,t,i){var s;const{style:n}=e,r={};for(const a in n)(vo(n[a])||t.style&&vo(t.style[a])||$K(a,e)||((s=i==null?void 0:i.getValue(a))==null?void 0:s.liveStyle)!==void 0)&&(r[a]=n[a]);return r}const Y0e={useVisualState:rJ({scrapeMotionValuesFromProps:M4,createRenderState:_4})};function sJ(e,t,i){const n=M4(e,t,i);for(const r in e)if(vo(e[r])||vo(t[r])){const s=Mb.indexOf(r)!==-1?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r;n[s]=e[r]}return n}const Q0e={useVisualState:rJ({scrapeMotionValuesFromProps:sJ,createRenderState:iJ})};function K0e(e,t){return function(n,{forwardMotionProps:r}={forwardMotionProps:!1}){const a={...A4(n)?Q0e:Y0e,preloadedFeatures:e,useRender:W0e(r),createVisualElement:t,Component:n};return D0e(a)}}function hw(e,t,i){const n=e.getProps();return w4(n,t,i!==void 0?i:n.custom,e)}const DU=e=>Array.isArray(e);function J0e(e,t,i){e.hasValue(t)?e.getValue(t).set(i):e.addValue(t,J1(i))}function Z0e(e){return DU(e)?e[e.length-1]||0:e}function $0e(e,t){const i=hw(e,t);let{transitionEnd:n={},transition:r={},...s}=i||{};s={...s,...n};for(const a in s){const o=Z0e(s[a]);J0e(e,a,o)}}function eye(e){return!!(vo(e)&&e.add)}function RU(e,t){const i=e.getValue("willChange");if(eye(i))return i.add(t);if(!i&&tp.WillChange){const n=new tp.WillChange("auto");e.addValue("willChange",n),n.add(t)}}function aJ(e){return e.props[KK]}const tye=e=>e!==null;function iye(e,{repeat:t,repeatType:i="loop"},n){const r=e.filter(tye),s=t&&i!=="loop"&&t%2===1?0:r.length-1;return r[s]}const nye={type:"spring",stiffness:500,damping:25,restSpeed:10},rye=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),sye={type:"keyframes",duration:.8},aye={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},oye=(e,{keyframes:t})=>t.length>2?sye:Eb.has(e)?e.startsWith("scale")?rye(t[1]):nye:aye;function lye({when:e,delay:t,delayChildren:i,staggerChildren:n,staggerDirection:r,repeat:s,repeatType:a,repeatDelay:o,from:l,elapsed:c,...u}){return!!Object.keys(u).length}const E4=(e,t,i,n={},r,s)=>a=>{const o=p4(n,e)||{},l=o.delay||n.delay||0;let{elapsed:c=0}=n;c=c-dd(l);const u={keyframes:Array.isArray(i)?i:[null,i],ease:"easeOut",velocity:t.getVelocity(),...o,delay:-c,onUpdate:d=>{t.set(d),o.onUpdate&&o.onUpdate(d)},onComplete:()=>{a(),o.onComplete&&o.onComplete()},name:e,motionValue:t,element:s?void 0:r};lye(o)||Object.assign(u,oye(e,u)),u.duration&&(u.duration=dd(u.duration)),u.repeatDelay&&(u.repeatDelay=dd(u.repeatDelay)),u.from!==void 0&&(u.keyframes[0]=u.from);let h=!1;if((u.type===!1||u.duration===0&&!u.repeatDelay)&&(u.duration=0,u.delay===0&&(h=!0)),(tp.instantAnimations||tp.skipAnimations)&&(h=!0,u.duration=0,u.delay=0),u.allowFlatten=!o.type&&!o.ease,h&&!s&&t.get()!==void 0){const d=iye(u.keyframes,o);if(d!==void 0){Vr.update(()=>{u.onUpdate(d),u.onComplete()});return}}return o.isSync?new d4(u):new Wve(u)};function cye({protectedKeys:e,needsAnimating:t},i){const n=e.hasOwnProperty(i)&&t[i]!==!0;return t[i]=!1,n}function oJ(e,t,{delay:i=0,transitionOverride:n,type:r}={}){let{transition:s=e.getDefaultTransition(),transitionEnd:a,...o}=t;n&&(s=n);const l=[],c=r&&e.animationState&&e.animationState.getState()[r];for(const u in o){const h=e.getValue(u,e.latestValues[u]??null),d=o[u];if(d===void 0||c&&cye(c,u))continue;const p={delay:i,...p4(s||{},u)},g=h.get();if(g!==void 0&&!h.isAnimating&&!Array.isArray(d)&&d===g&&!p.velocity)continue;let x=!1;if(window.MotionHandoffAnimation){const b=aJ(e);if(b){const A=window.MotionHandoffAnimation(b,u,Vr);A!==null&&(p.startTime=A,x=!0)}}RU(e,u),h.start(E4(u,h,d,e.shouldReduceMotion&&UK.has(u)?{type:!1}:p,e,x));const y=h.animation;y&&l.push(y)}return a&&Promise.all(l).then(()=>{Vr.update(()=>{a&&$0e(e,a)})}),l}function PU(e,t,i={}){var l;const n=hw(e,t,i.type==="exit"?(l=e.presenceContext)==null?void 0:l.custom:void 0);let{transition:r=e.getDefaultTransition()||{}}=n||{};i.transitionOverride&&(r=i.transitionOverride);const s=n?()=>Promise.all(oJ(e,n,i)):()=>Promise.resolve(),a=e.variantChildren&&e.variantChildren.size?(c=0)=>{const{delayChildren:u=0,staggerChildren:h,staggerDirection:d}=r;return uye(e,t,u+c,h,d,i)}:()=>Promise.resolve(),{when:o}=r;if(o){const[c,u]=o==="beforeChildren"?[s,a]:[a,s];return c().then(()=>u())}else return Promise.all([s(),a(i.delay)])}function uye(e,t,i=0,n=0,r=1,s){const a=[],o=(e.variantChildren.size-1)*n,l=r===1?(c=0)=>c*n:(c=0)=>o-c*n;return Array.from(e.variantChildren).sort(hye).forEach((c,u)=>{c.notify("AnimationStart",t),a.push(PU(c,t,{...s,delay:i+l(u)}).then(()=>c.notify("AnimationComplete",t)))}),Promise.all(a)}function hye(e,t){return e.sortNodePosition(t)}function dye(e,t,i={}){e.notify("AnimationStart",t);let n;if(Array.isArray(t)){const r=t.map(s=>PU(e,s,i));n=Promise.all(r)}else if(typeof t=="string")n=PU(e,t,i);else{const r=typeof t=="function"?hw(e,t,i.custom):t;n=Promise.all(oJ(e,r,i))}return n.then(()=>{e.notify("AnimationComplete",t)})}function lJ(e,t){if(!Array.isArray(t))return!1;const i=t.length;if(i!==e.length)return!1;for(let n=0;n<i;n++)if(t[n]!==e[n])return!1;return!0}const fye=x4.length;function cJ(e){if(!e)return;if(!e.isControllingVariants){const i=e.parent?cJ(e.parent)||{}:{};return e.props.initial!==void 0&&(i.initial=e.props.initial),i}const t={};for(let i=0;i<fye;i++){const n=x4[i],r=e.props[n];(cw(r)||r===!1)&&(t[n]=r)}return t}const pye=[...y4].reverse(),mye=y4.length;function gye(e){return t=>Promise.all(t.map(({animation:i,options:n})=>dye(e,i,n)))}function vye(e){let t=gye(e),i=n6(),n=!0;const r=l=>(c,u)=>{var d;const h=hw(e,u,l==="exit"?(d=e.presenceContext)==null?void 0:d.custom:void 0);if(h){const{transition:p,transitionEnd:g,...x}=h;c={...c,...x,...g}}return c};function s(l){t=l(e)}function a(l){const{props:c}=e,u=cJ(e.parent)||{},h=[],d=new Set;let p={},g=1/0;for(let y=0;y<mye;y++){const b=pye[y],A=i[b],w=c[b]!==void 0?c[b]:u[b],E=cw(w),D=b===l?A.isActive:null;D===!1&&(g=y);let T=w===u[b]&&w!==c[b]&&E;if(T&&n&&e.manuallyAnimateOnMount&&(T=!1),A.protectedKeys={...p},!A.isActive&&D===null||!w&&!A.prevProp||VR(w)||typeof w=="boolean")continue;const I=yye(A.prevProp,w);let R=I||b===l&&A.isActive&&!T&&E||y>g&&E,O=!1;const P=Array.isArray(w)?w:[w];let U=P.reduce(r(b),{});D===!1&&(U={});const{prevResolvedValues:H={}}=A,V={...H,...U},j=X=>{R=!0,d.has(X)&&(O=!0,d.delete(X)),A.needsAnimating[X]=!0;const W=e.getValue(X);W&&(W.liveStyle=!1)};for(const X in V){const W=U[X],ne=H[X];if(p.hasOwnProperty(X))continue;let Y=!1;DU(W)&&DU(ne)?Y=!lJ(W,ne):Y=W!==ne,Y?W!=null?j(X):d.add(X):W!==void 0&&d.has(X)?j(X):A.protectedKeys[X]=!0}A.prevProp=w,A.prevResolvedValues=U,A.isActive&&(p={...p,...U}),n&&e.blockInitialAnimation&&(R=!1),R&&(!(T&&I)||O)&&h.push(...P.map(X=>({animation:X,options:{type:b}})))}if(d.size){const y={};if(typeof c.initial!="boolean"){const b=hw(e,Array.isArray(c.initial)?c.initial[0]:c.initial);b&&b.transition&&(y.transition=b.transition)}d.forEach(b=>{const A=e.getBaseTarget(b),w=e.getValue(b);w&&(w.liveStyle=!0),y[b]=A??null}),h.push({animation:y})}let x=!!h.length;return n&&(c.initial===!1||c.initial===c.animate)&&!e.manuallyAnimateOnMount&&(x=!1),n=!1,x?t(h):Promise.resolve()}function o(l,c){var h;if(i[l].isActive===c)return Promise.resolve();(h=e.variantChildren)==null||h.forEach(d=>{var p;return(p=d.animationState)==null?void 0:p.setActive(l,c)}),i[l].isActive=c;const u=a(l);for(const d in i)i[d].protectedKeys={};return u}return{animateChanges:a,setActive:o,setAnimateFunction:s,getState:()=>i,reset:()=>{i=n6(),n=!0}}}function yye(e,t){return typeof t=="string"?t!==e:Array.isArray(t)?!lJ(t,e):!1}function Mv(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function n6(){return{animate:Mv(!0),whileInView:Mv(),whileHover:Mv(),whileTap:Mv(),whileDrag:Mv(),whileFocus:Mv(),exit:Mv()}}class fg{constructor(t){this.isMounted=!1,this.node=t}update(){}}class xye extends fg{constructor(t){super(t),t.animationState||(t.animationState=vye(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();VR(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:i}=this.node.prevProps||{};t!==i&&this.updateAnimationControlsSubscription()}unmount(){var t;this.node.animationState.reset(),(t=this.unmountControls)==null||t.call(this)}}let bye=0;class Sye extends fg{constructor(){super(...arguments),this.id=bye++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:i}=this.node.presenceContext,{isPresent:n}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===n)return;const r=this.node.animationState.setActive("exit",!t);i&&!t&&r.then(()=>{i(this.id)})}mount(){const{register:t,onExitComplete:i}=this.node.presenceContext||{};i&&i(this.id),t&&(this.unmount=t(this.id))}unmount(){}}const _ye={animation:{Feature:xye},exit:{Feature:Sye}};function dw(e,t,i,n={passive:!0}){return e.addEventListener(t,i,n),()=>e.removeEventListener(t,i)}function nM(e){return{point:{x:e.pageX,y:e.pageY}}}const Aye=e=>t=>v4(t)&&e(t,nM(t));function CA(e,t,i,n){return dw(e,t,Aye(i),n)}function uJ({top:e,left:t,right:i,bottom:n}){return{x:{min:t,max:i},y:{min:e,max:n}}}function wye({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function Mye(e,t){if(!t)return e;const i=t({x:e.left,y:e.top}),n=t({x:e.right,y:e.bottom});return{top:i.y,left:i.x,bottom:n.y,right:n.x}}const hJ=1e-4,Eye=1-hJ,Tye=1+hJ,dJ=.01,Cye=0-dJ,Dye=0+dJ;function Jo(e){return e.max-e.min}function Rye(e,t,i){return Math.abs(e-t)<=i}function r6(e,t,i,n=.5){e.origin=n,e.originPoint=zr(t.min,t.max,e.origin),e.scale=Jo(i)/Jo(t),e.translate=zr(i.min,i.max,e.origin)-e.originPoint,(e.scale>=Eye&&e.scale<=Tye||isNaN(e.scale))&&(e.scale=1),(e.translate>=Cye&&e.translate<=Dye||isNaN(e.translate))&&(e.translate=0)}function DA(e,t,i,n){r6(e.x,t.x,i.x,n?n.originX:void 0),r6(e.y,t.y,i.y,n?n.originY:void 0)}function s6(e,t,i){e.min=i.min+t.min,e.max=e.min+Jo(t)}function Pye(e,t,i){s6(e.x,t.x,i.x),s6(e.y,t.y,i.y)}function a6(e,t,i){e.min=t.min-i.min,e.max=e.min+Jo(t)}function RA(e,t,i){a6(e.x,t.x,i.x),a6(e.y,t.y,i.y)}const o6=()=>({translate:0,scale:1,origin:0,originPoint:0}),u1=()=>({x:o6(),y:o6()}),l6=()=>({min:0,max:0}),us=()=>({x:l6(),y:l6()});function Bc(e){return[e("x"),e("y")]}function EB(e){return e===void 0||e===1}function OU({scale:e,scaleX:t,scaleY:i}){return!EB(e)||!EB(t)||!EB(i)}function Fv(e){return OU(e)||fJ(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function fJ(e){return c6(e.x)||c6(e.y)}function c6(e){return e&&e!=="0%"}function YD(e,t,i){const n=e-i,r=t*n;return i+r}function u6(e,t,i,n,r){return r!==void 0&&(e=YD(e,r,n)),YD(e,i,n)+t}function BU(e,t=0,i=1,n,r){e.min=u6(e.min,t,i,n,r),e.max=u6(e.max,t,i,n,r)}function pJ(e,{x:t,y:i}){BU(e.x,t.translate,t.scale,t.originPoint),BU(e.y,i.translate,i.scale,i.originPoint)}const h6=.999999999999,d6=1.0000000000001;function Oye(e,t,i,n=!1){const r=i.length;if(!r)return;t.x=t.y=1;let s,a;for(let o=0;o<r;o++){s=i[o],a=s.projectionDelta;const{visualElement:l}=s.options;l&&l.props.style&&l.props.style.display==="contents"||(n&&s.options.layoutScroll&&s.scroll&&s!==s.root&&d1(e,{x:-s.scroll.offset.x,y:-s.scroll.offset.y}),a&&(t.x*=a.x.scale,t.y*=a.y.scale,pJ(e,a)),n&&Fv(s.latestValues)&&d1(e,s.latestValues))}t.x<d6&&t.x>h6&&(t.x=1),t.y<d6&&t.y>h6&&(t.y=1)}function h1(e,t){e.min=e.min+t,e.max=e.max+t}function f6(e,t,i,n,r=.5){const s=zr(e.min,e.max,r);BU(e,t,i,s,n)}function d1(e,t){f6(e.x,t.x,t.scaleX,t.scale,t.originX),f6(e.y,t.y,t.scaleY,t.scale,t.originY)}function mJ(e,t){return uJ(Mye(e.getBoundingClientRect(),t))}function Bye(e,t,i){const n=mJ(e,i),{scroll:r}=t;return r&&(h1(n.x,r.offset.x),h1(n.y,r.offset.y)),n}const gJ=({current:e})=>e?e.ownerDocument.defaultView:null,p6=(e,t)=>Math.abs(e-t);function Iye(e,t){const i=p6(e.x,t.x),n=p6(e.y,t.y);return Math.sqrt(i**2+n**2)}class vJ{constructor(t,i,{transformPagePoint:n,contextWindow:r,dragSnapToOrigin:s=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const h=CB(this.lastMoveEventInfo,this.history),d=this.startEvent!==null,p=Iye(h.offset,{x:0,y:0})>=3;if(!d&&!p)return;const{point:g}=h,{timestamp:x}=za;this.history.push({...g,timestamp:x});const{onStart:y,onMove:b}=this.handlers;d||(y&&y(this.lastMoveEvent,h),this.startEvent=this.lastMoveEvent),b&&b(this.lastMoveEvent,h)},this.handlePointerMove=(h,d)=>{this.lastMoveEvent=h,this.lastMoveEventInfo=TB(d,this.transformPagePoint),Vr.update(this.updatePoint,!0)},this.handlePointerUp=(h,d)=>{this.end();const{onEnd:p,onSessionEnd:g,resumeAnimation:x}=this.handlers;if(this.dragSnapToOrigin&&x&&x(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const y=CB(h.type==="pointercancel"?this.lastMoveEventInfo:TB(d,this.transformPagePoint),this.history);this.startEvent&&p&&p(h,y),g&&g(h,y)},!v4(t))return;this.dragSnapToOrigin=s,this.handlers=i,this.transformPagePoint=n,this.contextWindow=r||window;const a=nM(t),o=TB(a,this.transformPagePoint),{point:l}=o,{timestamp:c}=za;this.history=[{...l,timestamp:c}];const{onSessionStart:u}=i;u&&u(t,CB(o,this.history)),this.removeListeners=eM(CA(this.contextWindow,"pointermove",this.handlePointerMove),CA(this.contextWindow,"pointerup",this.handlePointerUp),CA(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),tg(this.updatePoint)}}function TB(e,t){return t?{point:t(e.point)}:e}function m6(e,t){return{x:e.x-t.x,y:e.y-t.y}}function CB({point:e},t){return{point:e,delta:m6(e,yJ(t)),offset:m6(e,Lye(t)),velocity:Uye(t,.1)}}function Lye(e){return e[0]}function yJ(e){return e[e.length-1]}function Uye(e,t){if(e.length<2)return{x:0,y:0};let i=e.length-1,n=null;const r=yJ(e);for(;i>=0&&(n=e[i],!(r.timestamp-n.timestamp>dd(t)));)i--;if(!n)return{x:0,y:0};const s=fd(r.timestamp-n.timestamp);if(s===0)return{x:0,y:0};const a={x:(r.x-n.x)/s,y:(r.y-n.y)/s};return a.x===1/0&&(a.x=0),a.y===1/0&&(a.y=0),a}function Nye(e,{min:t,max:i},n){return t!==void 0&&e<t?e=n?zr(t,e,n.min):Math.max(e,t):i!==void 0&&e>i&&(e=n?zr(i,e,n.max):Math.min(e,i)),e}function g6(e,t,i){return{min:t!==void 0?e.min+t:void 0,max:i!==void 0?e.max+i-(e.max-e.min):void 0}}function zye(e,{top:t,left:i,bottom:n,right:r}){return{x:g6(e.x,i,r),y:g6(e.y,t,n)}}function v6(e,t){let i=t.min-e.min,n=t.max-e.max;return t.max-t.min<e.max-e.min&&([i,n]=[n,i]),{min:i,max:n}}function Fye(e,t){return{x:v6(e.x,t.x),y:v6(e.y,t.y)}}function Vye(e,t){let i=.5;const n=Jo(e),r=Jo(t);return r>n?i=aw(t.min,t.max-n,e.min):n>r&&(i=aw(e.min,e.max-r,t.min)),ep(0,1,i)}function Hye(e,t){const i={};return t.min!==void 0&&(i.min=t.min-e.min),t.max!==void 0&&(i.max=t.max-e.min),i}const IU=.35;function Gye(e=IU){return e===!1?e=0:e===!0&&(e=IU),{x:y6(e,"left","right"),y:y6(e,"top","bottom")}}function y6(e,t,i){return{min:x6(e,t),max:x6(e,i)}}function x6(e,t){return typeof e=="number"?e:e[t]||0}const kye=new WeakMap;class jye{constructor(t){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=us(),this.visualElement=t}start(t,{snapToCursor:i=!1}={}){const{presenceContext:n}=this.visualElement;if(n&&n.isPresent===!1)return;const r=u=>{const{dragSnapToOrigin:h}=this.getProps();h?this.pauseAnimation():this.stopAnimation(),i&&this.snapToCursor(nM(u).point)},s=(u,h)=>{const{drag:d,dragPropagation:p,onDragStart:g}=this.getProps();if(d&&!p&&(this.openDragLock&&this.openDragLock(),this.openDragLock=o0e(d),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Bc(y=>{let b=this.getAxisMotionValue(y).get()||0;if(pd.test(b)){const{projection:A}=this.visualElement;if(A&&A.layout){const w=A.layout.layoutBox[y];w&&(b=Jo(w)*(parseFloat(b)/100))}}this.originPoint[y]=b}),g&&Vr.postRender(()=>g(u,h)),RU(this.visualElement,"transform");const{animationState:x}=this.visualElement;x&&x.setActive("whileDrag",!0)},a=(u,h)=>{const{dragPropagation:d,dragDirectionLock:p,onDirectionLock:g,onDrag:x}=this.getProps();if(!d&&!this.openDragLock)return;const{offset:y}=h;if(p&&this.currentDirection===null){this.currentDirection=Wye(y),this.currentDirection!==null&&g&&g(this.currentDirection);return}this.updateAxis("x",h.point,y),this.updateAxis("y",h.point,y),this.visualElement.render(),x&&x(u,h)},o=(u,h)=>this.stop(u,h),l=()=>Bc(u=>{var h;return this.getAnimationState(u)==="paused"&&((h=this.getAxisMotionValue(u).animation)==null?void 0:h.play())}),{dragSnapToOrigin:c}=this.getProps();this.panSession=new vJ(t,{onSessionStart:r,onStart:s,onMove:a,onSessionEnd:o,resumeAnimation:l},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:c,contextWindow:gJ(this.visualElement)})}stop(t,i){const n=this.isDragging;if(this.cancel(),!n)return;const{velocity:r}=i;this.startAnimation(r);const{onDragEnd:s}=this.getProps();s&&Vr.postRender(()=>s(t,i))}cancel(){this.isDragging=!1;const{projection:t,animationState:i}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:n}=this.getProps();!n&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),i&&i.setActive("whileDrag",!1)}updateAxis(t,i,n){const{drag:r}=this.getProps();if(!n||!K2(t,r,this.currentDirection))return;const s=this.getAxisMotionValue(t);let a=this.originPoint[t]+n[t];this.constraints&&this.constraints[t]&&(a=Nye(a,this.constraints[t],this.elastic[t])),s.set(a)}resolveConstraints(){var s;const{dragConstraints:t,dragElastic:i}=this.getProps(),n=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(s=this.visualElement.projection)==null?void 0:s.layout,r=this.constraints;t&&c1(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):t&&n?this.constraints=zye(n.layoutBox,t):this.constraints=!1,this.elastic=Gye(i),r!==this.constraints&&n&&this.constraints&&!this.hasMutatedConstraints&&Bc(a=>{this.constraints!==!1&&this.getAxisMotionValue(a)&&(this.constraints[a]=Hye(n.layoutBox[a],this.constraints[a]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:i}=this.getProps();if(!t||!c1(t))return!1;const n=t.current,{projection:r}=this.visualElement;if(!r||!r.layout)return!1;const s=Bye(n,r.root,this.visualElement.getTransformPagePoint());let a=Fye(r.layout.layoutBox,s);if(i){const o=i(wye(a));this.hasMutatedConstraints=!!o,o&&(a=uJ(o))}return a}startAnimation(t){const{drag:i,dragMomentum:n,dragElastic:r,dragTransition:s,dragSnapToOrigin:a,onDragTransitionEnd:o}=this.getProps(),l=this.constraints||{},c=Bc(u=>{if(!K2(u,i,this.currentDirection))return;let h=l&&l[u]||{};a&&(h={min:0,max:0});const d=r?200:1e6,p=r?40:1e7,g={type:"inertia",velocity:n?t[u]:0,bounceStiffness:d,bounceDamping:p,timeConstant:750,restDelta:1,restSpeed:10,...s,...h};return this.startAxisValueAnimation(u,g)});return Promise.all(c).then(o)}startAxisValueAnimation(t,i){const n=this.getAxisMotionValue(t);return RU(this.visualElement,t),n.start(E4(t,n,0,i,this.visualElement,!1))}stopAnimation(){Bc(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){Bc(t=>{var i;return(i=this.getAxisMotionValue(t).animation)==null?void 0:i.pause()})}getAnimationState(t){var i;return(i=this.getAxisMotionValue(t).animation)==null?void 0:i.state}getAxisMotionValue(t){const i=`_drag${t.toUpperCase()}`,n=this.visualElement.getProps(),r=n[i];return r||this.visualElement.getValue(t,(n.initial?n.initial[t]:void 0)||0)}snapToCursor(t){Bc(i=>{const{drag:n}=this.getProps();if(!K2(i,n,this.currentDirection))return;const{projection:r}=this.visualElement,s=this.getAxisMotionValue(i);if(r&&r.layout){const{min:a,max:o}=r.layout.layoutBox[i];s.set(t[i]-zr(a,o,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:i}=this.getProps(),{projection:n}=this.visualElement;if(!c1(i)||!n||!this.constraints)return;this.stopAnimation();const r={x:0,y:0};Bc(a=>{const o=this.getAxisMotionValue(a);if(o&&this.constraints!==!1){const l=o.get();r[a]=Vye({min:l,max:l},this.constraints[a])}});const{transformTemplate:s}=this.visualElement.getProps();this.visualElement.current.style.transform=s?s({},""):"none",n.root&&n.root.updateScroll(),n.updateLayout(),this.resolveConstraints(),Bc(a=>{if(!K2(a,t,null))return;const o=this.getAxisMotionValue(a),{min:l,max:c}=this.constraints[a];o.set(zr(l,c,r[a]))})}addListeners(){if(!this.visualElement.current)return;kye.set(this.visualElement,this);const t=this.visualElement.current,i=CA(t,"pointerdown",l=>{const{drag:c,dragListener:u=!0}=this.getProps();c&&u&&this.start(l)}),n=()=>{const{dragConstraints:l}=this.getProps();c1(l)&&l.current&&(this.constraints=this.resolveRefConstraints())},{projection:r}=this.visualElement,s=r.addEventListener("measure",n);r&&!r.layout&&(r.root&&r.root.updateScroll(),r.updateLayout()),Vr.read(n);const a=dw(window,"resize",()=>this.scalePositionWithinConstraints()),o=r.addEventListener("didUpdate",({delta:l,hasLayoutChanged:c})=>{this.isDragging&&c&&(Bc(u=>{const h=this.getAxisMotionValue(u);h&&(this.originPoint[u]+=l[u].translate,h.set(h.get()+l[u].translate))}),this.visualElement.render())});return()=>{a(),i(),s(),o&&o()}}getProps(){const t=this.visualElement.getProps(),{drag:i=!1,dragDirectionLock:n=!1,dragPropagation:r=!1,dragConstraints:s=!1,dragElastic:a=IU,dragMomentum:o=!0}=t;return{...t,drag:i,dragDirectionLock:n,dragPropagation:r,dragConstraints:s,dragElastic:a,dragMomentum:o}}}function K2(e,t,i){return(t===!0||t===e)&&(i===null||i===e)}function Wye(e,t=10){let i=null;return Math.abs(e.y)>t?i="y":Math.abs(e.x)>t&&(i="x"),i}class Xye extends fg{constructor(t){super(t),this.removeGroupControls=Xc,this.removeListeners=Xc,this.controls=new jye(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Xc}unmount(){this.removeGroupControls(),this.removeListeners()}}const b6=e=>(t,i)=>{e&&Vr.postRender(()=>e(t,i))};class qye extends fg{constructor(){super(...arguments),this.removePointerDownListener=Xc}onPointerDown(t){this.session=new vJ(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:gJ(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:i,onPan:n,onPanEnd:r}=this.node.getProps();return{onSessionStart:b6(t),onStart:b6(i),onMove:n,onEnd:(s,a)=>{delete this.session,r&&Vr.postRender(()=>r(s,a))}}}mount(){this.removePointerDownListener=CA(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const PC={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function S6(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const A_={correct:(e,t)=>{if(!t.target)return e;if(typeof e=="string")if(Ni.test(e))e=parseFloat(e);else return e;const i=S6(e,t.target.x),n=S6(e,t.target.y);return`${i}% ${n}%`}},Yye={correct:(e,{treeScale:t,projectionDelta:i})=>{const n=e,r=ig.parse(e);if(r.length>5)return n;const s=ig.createTransformer(e),a=typeof r[0]!="number"?1:0,o=i.x.scale*t.x,l=i.y.scale*t.y;r[0+a]/=o,r[1+a]/=l;const c=zr(o,l,.5);return typeof r[2+a]=="number"&&(r[2+a]/=c),typeof r[3+a]=="number"&&(r[3+a]/=c),s(r)}};class Qye extends ge.Component{componentDidMount(){const{visualElement:t,layoutGroup:i,switchLayoutGroup:n,layoutId:r}=this.props,{projection:s}=t;B0e(Kye),s&&(i.group&&i.group.add(s),n&&n.register&&r&&n.register(s),s.root.didUpdate(),s.addEventListener("animationComplete",()=>{this.safeToRemove()}),s.setOptions({...s.options,onExitComplete:()=>this.safeToRemove()})),PC.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:i,visualElement:n,drag:r,isPresent:s}=this.props,{projection:a}=n;return a&&(a.isPresent=s,r||t.layoutDependency!==i||i===void 0||t.isPresent!==s?a.willUpdate():this.safeToRemove(),t.isPresent!==s&&(s?a.promote():a.relegate()||Vr.postRender(()=>{const o=a.getStack();(!o||!o.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),g4.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:i,switchLayoutGroup:n}=this.props,{projection:r}=t;r&&(r.scheduleCheckAfterUnmount(),i&&i.group&&i.group.remove(r),n&&n.deregister&&n.deregister(r))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function xJ(e){const[t,i]=g0e(),n=ge.useContext(tK);return ke.jsx(Qye,{...e,layoutGroup:n,switchLayoutGroup:ge.useContext(JK),isPresent:t,safeToRemove:i})}const Kye={borderRadius:{...A_,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:A_,borderTopRightRadius:A_,borderBottomLeftRadius:A_,borderBottomRightRadius:A_,boxShadow:Yye};function Jye(e,t,i){const n=vo(e)?e:J1(e);return n.start(E4("",n,t,i)),n.animation}const Zye=(e,t)=>e.depth-t.depth;class $ye{constructor(){this.children=[],this.isDirty=!1}add(t){JF(this.children,t),this.isDirty=!0}remove(t){ZF(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(Zye),this.isDirty=!1,this.children.forEach(t)}}function exe(e,t){const i=Cl.now(),n=({timestamp:r})=>{const s=r-i;s>=t&&(tg(n),e(s-t))};return Vr.setup(n,!0),()=>tg(n)}const bJ=["TopLeft","TopRight","BottomLeft","BottomRight"],txe=bJ.length,_6=e=>typeof e=="string"?parseFloat(e):e,A6=e=>typeof e=="number"||Ni.test(e);function ixe(e,t,i,n,r,s){r?(e.opacity=zr(0,i.opacity??1,nxe(n)),e.opacityExit=zr(t.opacity??1,0,rxe(n))):s&&(e.opacity=zr(t.opacity??1,i.opacity??1,n));for(let a=0;a<txe;a++){const o=`border${bJ[a]}Radius`;let l=w6(t,o),c=w6(i,o);if(l===void 0&&c===void 0)continue;l||(l=0),c||(c=0),l===0||c===0||A6(l)===A6(c)?(e[o]=Math.max(zr(_6(l),_6(c),n),0),(pd.test(c)||pd.test(l))&&(e[o]+="%")):e[o]=c}(t.rotate||i.rotate)&&(e.rotate=zr(t.rotate||0,i.rotate||0,n))}function w6(e,t){return e[t]!==void 0?e[t]:e.borderRadius}const nxe=SJ(0,.5,dK),rxe=SJ(.5,.95,Xc);function SJ(e,t,i){return n=>n<e?0:n>t?1:i(aw(e,t,n))}function M6(e,t){e.min=t.min,e.max=t.max}function Ec(e,t){M6(e.x,t.x),M6(e.y,t.y)}function E6(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function T6(e,t,i,n,r){return e-=t,e=YD(e,1/i,n),r!==void 0&&(e=YD(e,1/r,n)),e}function sxe(e,t=0,i=1,n=.5,r,s=e,a=e){if(pd.test(t)&&(t=parseFloat(t),t=zr(a.min,a.max,t/100)-a.min),typeof t!="number")return;let o=zr(s.min,s.max,n);e===s&&(o-=t),e.min=T6(e.min,t,i,o,r),e.max=T6(e.max,t,i,o,r)}function C6(e,t,[i,n,r],s,a){sxe(e,t[i],t[n],t[r],t.scale,s,a)}const axe=["x","scaleX","originX"],oxe=["y","scaleY","originY"];function D6(e,t,i,n){C6(e.x,t,axe,i?i.x:void 0,n?n.x:void 0),C6(e.y,t,oxe,i?i.y:void 0,n?n.y:void 0)}function R6(e){return e.translate===0&&e.scale===1}function _J(e){return R6(e.x)&&R6(e.y)}function P6(e,t){return e.min===t.min&&e.max===t.max}function lxe(e,t){return P6(e.x,t.x)&&P6(e.y,t.y)}function O6(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function AJ(e,t){return O6(e.x,t.x)&&O6(e.y,t.y)}function B6(e){return Jo(e.x)/Jo(e.y)}function I6(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class cxe{constructor(){this.members=[]}add(t){JF(this.members,t),t.scheduleRender()}remove(t){if(ZF(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const i=this.members[this.members.length-1];i&&this.promote(i)}}relegate(t){const i=this.members.findIndex(r=>t===r);if(i===0)return!1;let n;for(let r=i;r>=0;r--){const s=this.members[r];if(s.isPresent!==!1){n=s;break}}return n?(this.promote(n),!0):!1}promote(t,i){const n=this.lead;if(t!==n&&(this.prevLead=n,this.lead=t,t.show(),n)){n.instance&&n.scheduleRender(),t.scheduleRender(),t.resumeFrom=n,i&&(t.resumeFrom.preserveOpacity=!0),n.snapshot&&(t.snapshot=n.snapshot,t.snapshot.latestValues=n.animationValues||n.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:r}=t.options;r===!1&&n.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:i,resumingFrom:n}=t;i.onExitComplete&&i.onExitComplete(),n&&n.options.onExitComplete&&n.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function uxe(e,t,i){let n="";const r=e.x.translate/t.x,s=e.y.translate/t.y,a=(i==null?void 0:i.z)||0;if((r||s||a)&&(n=`translate3d(${r}px, ${s}px, ${a}px) `),(t.x!==1||t.y!==1)&&(n+=`scale(${1/t.x}, ${1/t.y}) `),i){const{transformPerspective:c,rotate:u,rotateX:h,rotateY:d,skewX:p,skewY:g}=i;c&&(n=`perspective(${c}px) ${n}`),u&&(n+=`rotate(${u}deg) `),h&&(n+=`rotateX(${h}deg) `),d&&(n+=`rotateY(${d}deg) `),p&&(n+=`skewX(${p}deg) `),g&&(n+=`skewY(${g}deg) `)}const o=e.x.scale*t.x,l=e.y.scale*t.y;return(o!==1||l!==1)&&(n+=`scale(${o}, ${l})`),n||"none"}const DB=["","X","Y","Z"],hxe={visibility:"hidden"},dxe=1e3;let fxe=0;function RB(e,t,i,n){const{latestValues:r}=t;r[e]&&(i[e]=r[e],t.setStaticValue(e,0),n&&(n[e]=0))}function wJ(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const i=aJ(t);if(window.MotionHasOptimisedAnimation(i,"transform")){const{layout:r,layoutId:s}=e.options;window.MotionCancelOptimisedAnimation(i,"transform",Vr,!(r||s))}const{parent:n}=e;n&&!n.hasCheckedOptimisedAppear&&wJ(n)}function MJ({attachResizeListener:e,defaultParent:t,measureScroll:i,checkIsScrollRoot:n,resetTransform:r}){return class{constructor(a={},o=t==null?void 0:t()){this.id=fxe++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(gxe),this.nodes.forEach(Sxe),this.nodes.forEach(_xe),this.nodes.forEach(vxe)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=a,this.root=o?o.root||o:this,this.path=o?[...o.path,o]:[],this.parent=o,this.depth=o?o.depth+1:0;for(let l=0;l<this.path.length;l++)this.path[l].shouldResetTransform=!0;this.root===this&&(this.nodes=new $ye)}addEventListener(a,o){return this.eventHandlers.has(a)||this.eventHandlers.set(a,new t4),this.eventHandlers.get(a).add(o)}notifyListeners(a,...o){const l=this.eventHandlers.get(a);l&&l.notify(...o)}hasListeners(a){return this.eventHandlers.has(a)}mount(a){if(this.instance)return;this.isSVG=WK(a)&&!f0e(a),this.instance=a;const{layoutId:o,layout:l,visualElement:c}=this.options;if(c&&!c.current&&c.mount(a),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(l||o)&&(this.isLayoutDirty=!0),e){let u;const h=()=>this.root.updateBlockedByResize=!1;e(a,()=>{this.root.updateBlockedByResize=!0,u&&u(),u=exe(h,250),PC.hasAnimatedSinceResize&&(PC.hasAnimatedSinceResize=!1,this.nodes.forEach(U6))})}o&&this.root.registerSharedNode(o,this),this.options.animate!==!1&&c&&(o||l)&&this.addEventListener("didUpdate",({delta:u,hasLayoutChanged:h,hasRelativeLayoutChanged:d,layout:p})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const g=this.options.transition||c.getDefaultTransition()||Txe,{onLayoutAnimationStart:x,onLayoutAnimationComplete:y}=c.getProps(),b=!this.targetLayout||!AJ(this.targetLayout,p),A=!h&&d;if(this.options.layoutRoot||this.resumeFrom||A||h&&(b||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const w={...p4(g,"layout"),onPlay:x,onComplete:y};(c.shouldReduceMotion||this.options.layoutRoot)&&(w.delay=0,w.type=!1),this.startAnimation(w),this.setAnimationOrigin(u,A)}else h||U6(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=p})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const a=this.getStack();a&&a.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),tg(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(Axe),this.animationId++)}getTransformTemplate(){const{visualElement:a}=this.options;return a&&a.getProps().transformTemplate}willUpdate(a=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&wJ(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let u=0;u<this.path.length;u++){const h=this.path[u];h.shouldResetTransform=!0,h.updateScroll("snapshot"),h.options.layoutRoot&&h.willUpdate(!1)}const{layoutId:o,layout:l}=this.options;if(o===void 0&&!l)return;const c=this.getTransformTemplate();this.prevTransformTemplateValue=c?c(this.latestValues,""):void 0,this.updateSnapshot(),a&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(L6);return}this.isUpdating||this.nodes.forEach(xxe),this.isUpdating=!1,this.nodes.forEach(bxe),this.nodes.forEach(pxe),this.nodes.forEach(mxe),this.clearAllSnapshots();const o=Cl.now();za.delta=ep(0,1e3/60,o-za.timestamp),za.timestamp=o,za.isProcessing=!0,SB.update.process(za),SB.preRender.process(za),SB.render.process(za),za.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,g4.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(yxe),this.sharedNodes.forEach(wxe)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Vr.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Vr.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!Jo(this.snapshot.measuredBox.x)&&!Jo(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let l=0;l<this.path.length;l++)this.path[l].updateScroll();const a=this.layout;this.layout=this.measure(!1),this.layoutCorrected=us(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:o}=this.options;o&&o.notify("LayoutMeasure",this.layout.layoutBox,a?a.layoutBox:void 0)}updateScroll(a="measure"){let o=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===a&&(o=!1),o&&this.instance){const l=n(this.instance);this.scroll={animationId:this.root.animationId,phase:a,isRoot:l,offset:i(this.instance),wasRoot:this.scroll?this.scroll.isRoot:l}}}resetTransform(){if(!r)return;const a=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,o=this.projectionDelta&&!_J(this.projectionDelta),l=this.getTransformTemplate(),c=l?l(this.latestValues,""):void 0,u=c!==this.prevTransformTemplateValue;a&&this.instance&&(o||Fv(this.latestValues)||u)&&(r(this.instance,c),this.shouldResetTransform=!1,this.scheduleRender())}measure(a=!0){const o=this.measurePageBox();let l=this.removeElementScroll(o);return a&&(l=this.removeTransform(l)),Cxe(l),{animationId:this.root.animationId,measuredBox:o,layoutBox:l,latestValues:{},source:this.id}}measurePageBox(){var c;const{visualElement:a}=this.options;if(!a)return us();const o=a.measureViewportBox();if(!(((c=this.scroll)==null?void 0:c.wasRoot)||this.path.some(Dxe))){const{scroll:u}=this.root;u&&(h1(o.x,u.offset.x),h1(o.y,u.offset.y))}return o}removeElementScroll(a){var l;const o=us();if(Ec(o,a),(l=this.scroll)!=null&&l.wasRoot)return o;for(let c=0;c<this.path.length;c++){const u=this.path[c],{scroll:h,options:d}=u;u!==this.root&&h&&d.layoutScroll&&(h.wasRoot&&Ec(o,a),h1(o.x,h.offset.x),h1(o.y,h.offset.y))}return o}applyTransform(a,o=!1){const l=us();Ec(l,a);for(let c=0;c<this.path.length;c++){const u=this.path[c];!o&&u.options.layoutScroll&&u.scroll&&u!==u.root&&d1(l,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),Fv(u.latestValues)&&d1(l,u.latestValues)}return Fv(this.latestValues)&&d1(l,this.latestValues),l}removeTransform(a){const o=us();Ec(o,a);for(let l=0;l<this.path.length;l++){const c=this.path[l];if(!c.instance||!Fv(c.latestValues))continue;OU(c.latestValues)&&c.updateSnapshot();const u=us(),h=c.measurePageBox();Ec(u,h),D6(o,c.latestValues,c.snapshot?c.snapshot.layoutBox:void 0,u)}return Fv(this.latestValues)&&D6(o,this.latestValues),o}setTargetDelta(a){this.targetDelta=a,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(a){this.options={...this.options,...a,crossfade:a.crossfade!==void 0?a.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==za.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(a=!1){var d;const o=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=o.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=o.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=o.isSharedProjectionDirty);const l=!!this.resumingFrom||this!==o;if(!(a||l&&this.isSharedProjectionDirty||this.isProjectionDirty||(d=this.parent)!=null&&d.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:u,layoutId:h}=this.options;if(!(!this.layout||!(u||h))){if(this.resolvedRelativeTargetAt=za.timestamp,!this.targetDelta&&!this.relativeTarget){const p=this.getClosestProjectingParent();p&&p.layout&&this.animationProgress!==1?(this.relativeParent=p,this.forceRelativeParentToResolveTarget(),this.relativeTarget=us(),this.relativeTargetOrigin=us(),RA(this.relativeTargetOrigin,this.layout.layoutBox,p.layout.layoutBox),Ec(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=us(),this.targetWithTransforms=us()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),Pye(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Ec(this.target,this.layout.layoutBox),pJ(this.target,this.targetDelta)):Ec(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const p=this.getClosestProjectingParent();p&&!!p.resumingFrom==!!this.resumingFrom&&!p.options.layoutScroll&&p.target&&this.animationProgress!==1?(this.relativeParent=p,this.forceRelativeParentToResolveTarget(),this.relativeTarget=us(),this.relativeTargetOrigin=us(),RA(this.relativeTargetOrigin,this.target,p.target),Ec(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||OU(this.parent.latestValues)||fJ(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var g;const a=this.getLead(),o=!!this.resumingFrom||this!==a;let l=!0;if((this.isProjectionDirty||(g=this.parent)!=null&&g.isProjectionDirty)&&(l=!1),o&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(l=!1),this.resolvedRelativeTargetAt===za.timestamp&&(l=!1),l)return;const{layout:c,layoutId:u}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(c||u))return;Ec(this.layoutCorrected,this.layout.layoutBox);const h=this.treeScale.x,d=this.treeScale.y;Oye(this.layoutCorrected,this.treeScale,this.path,o),a.layout&&!a.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(a.target=a.layout.layoutBox,a.targetWithTransforms=us());const{target:p}=a;if(!p){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(E6(this.prevProjectionDelta.x,this.projectionDelta.x),E6(this.prevProjectionDelta.y,this.projectionDelta.y)),DA(this.projectionDelta,this.layoutCorrected,p,this.latestValues),(this.treeScale.x!==h||this.treeScale.y!==d||!I6(this.projectionDelta.x,this.prevProjectionDelta.x)||!I6(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",p))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(a=!0){var o;if((o=this.options.visualElement)==null||o.scheduleRender(),a){const l=this.getStack();l&&l.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=u1(),this.projectionDelta=u1(),this.projectionDeltaWithTransform=u1()}setAnimationOrigin(a,o=!1){const l=this.snapshot,c=l?l.latestValues:{},u={...this.latestValues},h=u1();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!o;const d=us(),p=l?l.source:void 0,g=this.layout?this.layout.source:void 0,x=p!==g,y=this.getStack(),b=!y||y.members.length<=1,A=!!(x&&!b&&this.options.crossfade===!0&&!this.path.some(Exe));this.animationProgress=0;let w;this.mixTargetDelta=E=>{const D=E/1e3;N6(h.x,a.x,D),N6(h.y,a.y,D),this.setTargetDelta(h),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(RA(d,this.layout.layoutBox,this.relativeParent.layout.layoutBox),Mxe(this.relativeTarget,this.relativeTargetOrigin,d,D),w&&lxe(this.relativeTarget,w)&&(this.isProjectionDirty=!1),w||(w=us()),Ec(w,this.relativeTarget)),x&&(this.animationValues=u,ixe(u,c,this.latestValues,D,A,b)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=D},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(a){var o,l,c;this.notifyListeners("animationStart"),(o=this.currentAnimation)==null||o.stop(),(c=(l=this.resumingFrom)==null?void 0:l.currentAnimation)==null||c.stop(),this.pendingAnimation&&(tg(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Vr.update(()=>{PC.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=J1(0)),this.currentAnimation=Jye(this.motionValue,[0,1e3],{...a,velocity:0,isSync:!0,onUpdate:u=>{this.mixTargetDelta(u),a.onUpdate&&a.onUpdate(u)},onStop:()=>{},onComplete:()=>{a.onComplete&&a.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const a=this.getStack();a&&a.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(dxe),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const a=this.getLead();let{targetWithTransforms:o,target:l,layout:c,latestValues:u}=a;if(!(!o||!l||!c)){if(this!==a&&this.layout&&c&&EJ(this.options.animationType,this.layout.layoutBox,c.layoutBox)){l=this.target||us();const h=Jo(this.layout.layoutBox.x);l.x.min=a.target.x.min,l.x.max=l.x.min+h;const d=Jo(this.layout.layoutBox.y);l.y.min=a.target.y.min,l.y.max=l.y.min+d}Ec(o,l),d1(o,u),DA(this.projectionDeltaWithTransform,this.layoutCorrected,o,u)}}registerSharedNode(a,o){this.sharedNodes.has(a)||this.sharedNodes.set(a,new cxe),this.sharedNodes.get(a).add(o);const c=o.options.initialPromotionConfig;o.promote({transition:c?c.transition:void 0,preserveFollowOpacity:c&&c.shouldPreserveFollowOpacity?c.shouldPreserveFollowOpacity(o):void 0})}isLead(){const a=this.getStack();return a?a.lead===this:!0}getLead(){var o;const{layoutId:a}=this.options;return a?((o=this.getStack())==null?void 0:o.lead)||this:this}getPrevLead(){var o;const{layoutId:a}=this.options;return a?(o=this.getStack())==null?void 0:o.prevLead:void 0}getStack(){const{layoutId:a}=this.options;if(a)return this.root.sharedNodes.get(a)}promote({needsReset:a,transition:o,preserveFollowOpacity:l}={}){const c=this.getStack();c&&c.promote(this,l),a&&(this.projectionDelta=void 0,this.needsReset=!0),o&&this.setOptions({transition:o})}relegate(){const a=this.getStack();return a?a.relegate(this):!1}resetSkewAndRotation(){const{visualElement:a}=this.options;if(!a)return;let o=!1;const{latestValues:l}=a;if((l.z||l.rotate||l.rotateX||l.rotateY||l.rotateZ||l.skewX||l.skewY)&&(o=!0),!o)return;const c={};l.z&&RB("z",a,c,this.animationValues);for(let u=0;u<DB.length;u++)RB(`rotate${DB[u]}`,a,c,this.animationValues),RB(`skew${DB[u]}`,a,c,this.animationValues);a.render();for(const u in c)a.setStaticValue(u,c[u]),this.animationValues&&(this.animationValues[u]=c[u]);a.scheduleRender()}getProjectionStyles(a){if(!this.instance||this.isSVG)return;if(!this.isVisible)return hxe;const o={visibility:""},l=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,o.opacity="",o.pointerEvents=RC(a==null?void 0:a.pointerEvents)||"",o.transform=l?l(this.latestValues,""):"none",o;const c=this.getLead();if(!this.projectionDelta||!this.layout||!c.target){const p={};return this.options.layoutId&&(p.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,p.pointerEvents=RC(a==null?void 0:a.pointerEvents)||""),this.hasProjected&&!Fv(this.latestValues)&&(p.transform=l?l({},""):"none",this.hasProjected=!1),p}const u=c.animationValues||c.latestValues;this.applyTransformsToTarget(),o.transform=uxe(this.projectionDeltaWithTransform,this.treeScale,u),l&&(o.transform=l(u,o.transform));const{x:h,y:d}=this.projectionDelta;o.transformOrigin=`${h.origin*100}% ${d.origin*100}% 0`,c.animationValues?o.opacity=c===this?u.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:u.opacityExit:o.opacity=c===this?u.opacity!==void 0?u.opacity:"":u.opacityExit!==void 0?u.opacityExit:0;for(const p in uw){if(u[p]===void 0)continue;const{correct:g,applyTo:x,isCSSVariable:y}=uw[p],b=o.transform==="none"?u[p]:g(u[p],c);if(x){const A=x.length;for(let w=0;w<A;w++)o[x[w]]=b}else y?this.options.visualElement.renderState.vars[p]=b:o[p]=b}return this.options.layoutId&&(o.pointerEvents=c===this?RC(a==null?void 0:a.pointerEvents)||"":"none"),o}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(a=>{var o;return(o=a.currentAnimation)==null?void 0:o.stop()}),this.root.nodes.forEach(L6),this.root.sharedNodes.clear()}}}function pxe(e){e.updateLayout()}function mxe(e){var i;const t=((i=e.resumeFrom)==null?void 0:i.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&t&&e.hasListeners("didUpdate")){const{layoutBox:n,measuredBox:r}=e.layout,{animationType:s}=e.options,a=t.source!==e.layout.source;s==="size"?Bc(h=>{const d=a?t.measuredBox[h]:t.layoutBox[h],p=Jo(d);d.min=n[h].min,d.max=d.min+p}):EJ(s,t.layoutBox,n)&&Bc(h=>{const d=a?t.measuredBox[h]:t.layoutBox[h],p=Jo(n[h]);d.max=d.min+p,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[h].max=e.relativeTarget[h].min+p)});const o=u1();DA(o,n,t.layoutBox);const l=u1();a?DA(l,e.applyTransform(r,!0),t.measuredBox):DA(l,n,t.layoutBox);const c=!_J(o);let u=!1;if(!e.resumeFrom){const h=e.getClosestProjectingParent();if(h&&!h.resumeFrom){const{snapshot:d,layout:p}=h;if(d&&p){const g=us();RA(g,t.layoutBox,d.layoutBox);const x=us();RA(x,n,p.layoutBox),AJ(g,x)||(u=!0),h.options.layoutRoot&&(e.relativeTarget=x,e.relativeTargetOrigin=g,e.relativeParent=h)}}}e.notifyListeners("didUpdate",{layout:n,snapshot:t,delta:l,layoutDelta:o,hasLayoutChanged:c,hasRelativeLayoutChanged:u})}else if(e.isLead()){const{onExitComplete:n}=e.options;n&&n()}e.options.transition=void 0}function gxe(e){e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function vxe(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function yxe(e){e.clearSnapshot()}function L6(e){e.clearMeasurements()}function xxe(e){e.isLayoutDirty=!1}function bxe(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function U6(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function Sxe(e){e.resolveTargetDelta()}function _xe(e){e.calcProjection()}function Axe(e){e.resetSkewAndRotation()}function wxe(e){e.removeLeadSnapshot()}function N6(e,t,i){e.translate=zr(t.translate,0,i),e.scale=zr(t.scale,1,i),e.origin=t.origin,e.originPoint=t.originPoint}function z6(e,t,i,n){e.min=zr(t.min,i.min,n),e.max=zr(t.max,i.max,n)}function Mxe(e,t,i,n){z6(e.x,t.x,i.x,n),z6(e.y,t.y,i.y,n)}function Exe(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const Txe={duration:.45,ease:[.4,0,.1,1]},F6=e=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),V6=F6("applewebkit/")&&!F6("chrome/")?Math.round:Xc;function H6(e){e.min=V6(e.min),e.max=V6(e.max)}function Cxe(e){H6(e.x),H6(e.y)}function EJ(e,t,i){return e==="position"||e==="preserve-aspect"&&!Rye(B6(t),B6(i),.2)}function Dxe(e){var t;return e!==e.root&&((t=e.scroll)==null?void 0:t.wasRoot)}const Rxe=MJ({attachResizeListener:(e,t)=>dw(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),PB={current:void 0},TJ=MJ({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!PB.current){const e=new Rxe({});e.mount(window),e.setOptions({layoutScroll:!0}),PB.current=e}return PB.current},resetTransform:(e,t)=>{e.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),Pxe={pan:{Feature:qye},drag:{Feature:Xye,ProjectionNode:TJ,MeasureLayout:xJ}};function G6(e,t,i){const{props:n}=e;e.animationState&&n.whileHover&&e.animationState.setActive("whileHover",i==="Start");const r="onHover"+i,s=n[r];s&&Vr.postRender(()=>s(t,nM(t)))}class Oxe extends fg{mount(){const{current:t}=this.node;t&&(this.unmount=l0e(t,(i,n)=>(G6(this.node,n,"Start"),r=>G6(this.node,r,"End"))))}unmount(){}}class Bxe extends fg{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=eM(dw(this.node.current,"focus",()=>this.onFocus()),dw(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function k6(e,t,i){const{props:n}=e;if(e.current instanceof HTMLButtonElement&&e.current.disabled)return;e.animationState&&n.whileTap&&e.animationState.setActive("whileTap",i==="Start");const r="onTap"+(i==="End"?"":i),s=n[r];s&&Vr.postRender(()=>s(t,nM(t)))}class Ixe extends fg{mount(){const{current:t}=this.node;t&&(this.unmount=d0e(t,(i,n)=>(k6(this.node,n,"Start"),(r,{success:s})=>k6(this.node,r,s?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const LU=new WeakMap,OB=new WeakMap,Lxe=e=>{const t=LU.get(e.target);t&&t(e)},Uxe=e=>{e.forEach(Lxe)};function Nxe({root:e,...t}){const i=e||document;OB.has(i)||OB.set(i,{});const n=OB.get(i),r=JSON.stringify(t);return n[r]||(n[r]=new IntersectionObserver(Uxe,{root:e,...t})),n[r]}function zxe(e,t,i){const n=Nxe(t);return LU.set(e,i),n.observe(e),()=>{LU.delete(e),n.unobserve(e)}}const Fxe={some:0,all:1};class Vxe extends fg{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:i,margin:n,amount:r="some",once:s}=t,a={root:i?i.current:void 0,rootMargin:n,threshold:typeof r=="number"?r:Fxe[r]},o=l=>{const{isIntersecting:c}=l;if(this.isInView===c||(this.isInView=c,s&&!c&&this.hasEnteredView))return;c&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",c);const{onViewportEnter:u,onViewportLeave:h}=this.node.getProps(),d=c?u:h;d&&d(l)};return zxe(this.node.current,a,o)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:i}=this.node;["amount","margin","root"].some(Hxe(t,i))&&this.startObserver()}unmount(){}}function Hxe({viewport:e={}},{viewport:t={}}={}){return i=>e[i]!==t[i]}const Gxe={inView:{Feature:Vxe},tap:{Feature:Ixe},focus:{Feature:Bxe},hover:{Feature:Oxe}},kxe={layout:{ProjectionNode:TJ,MeasureLayout:xJ}},UU={current:null},CJ={current:!1};function jxe(){if(CJ.current=!0,!!QF)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>UU.current=e.matches;e.addListener(t),t()}else UU.current=!1}const Wxe=new WeakMap;function Xxe(e,t,i){for(const n in t){const r=t[n],s=i[n];if(vo(r))e.addValue(n,r);else if(vo(s))e.addValue(n,J1(r,{owner:e}));else if(s!==r)if(e.hasValue(n)){const a=e.getValue(n);a.liveStyle===!0?a.jump(r):a.hasAnimated||a.set(r)}else{const a=e.getStaticValue(n);e.addValue(n,J1(a!==void 0?a:r,{owner:e}))}}for(const n in i)t[n]===void 0&&e.removeValue(n);return t}const j6=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class qxe{scrapeMotionValuesFromProps(t,i,n){return{}}constructor({parent:t,props:i,presenceContext:n,reducedMotionConfig:r,blockInitialAnimation:s,visualState:a},o={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=f4,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const d=Cl.now();this.renderScheduledAt<d&&(this.renderScheduledAt=d,Vr.render(this.render,!1,!0))};const{latestValues:l,renderState:c}=a;this.latestValues=l,this.baseTarget={...l},this.initialValues=i.initial?{...l}:{},this.renderState=c,this.parent=t,this.props=i,this.presenceContext=n,this.depth=t?t.depth+1:0,this.reducedMotionConfig=r,this.options=o,this.blockInitialAnimation=!!s,this.isControllingVariants=HR(i),this.isVariantNode=QK(i),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:u,...h}=this.scrapeMotionValuesFromProps(i,{},this);for(const d in h){const p=h[d];l[d]!==void 0&&vo(p)&&p.set(l[d],!1)}}mount(t){this.current=t,Wxe.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((i,n)=>this.bindToMotionValue(n,i)),CJ.current||jxe(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:UU.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),tg(this.notifyUpdate),tg(this.render),this.valueSubscriptions.forEach(t=>t()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const i=this.features[t];i&&(i.unmount(),i.isMounted=!1)}this.current=null}bindToMotionValue(t,i){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const n=Eb.has(t);n&&this.onBindTransform&&this.onBindTransform();const r=i.on("change",o=>{this.latestValues[t]=o,this.props.onUpdate&&Vr.preRender(this.notifyUpdate),n&&this.projection&&(this.projection.isTransformDirty=!0)}),s=i.on("renderRequest",this.scheduleRender);let a;window.MotionCheckAppearSync&&(a=window.MotionCheckAppearSync(this,t,i)),this.valueSubscriptions.set(t,()=>{r(),s(),a&&a(),i.owner&&i.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in Z1){const i=Z1[t];if(!i)continue;const{isEnabled:n,Feature:r}=i;if(!this.features[t]&&r&&n(this.props)&&(this.features[t]=new r(this)),this.features[t]){const s=this.features[t];s.isMounted?s.update():(s.mount(),s.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):us()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,i){this.latestValues[t]=i}update(t,i){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=i;for(let n=0;n<j6.length;n++){const r=j6[n];this.propEventSubscriptions[r]&&(this.propEventSubscriptions[r](),delete this.propEventSubscriptions[r]);const s="on"+r,a=t[s];a&&(this.propEventSubscriptions[r]=this.on(r,a))}this.prevMotionValues=Xxe(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const i=this.getClosestVariantNode();if(i)return i.variantChildren&&i.variantChildren.add(t),()=>i.variantChildren.delete(t)}addValue(t,i){const n=this.values.get(t);i!==n&&(n&&this.removeValue(t),this.bindToMotionValue(t,i),this.values.set(t,i),this.latestValues[t]=i.get())}removeValue(t){this.values.delete(t);const i=this.valueSubscriptions.get(t);i&&(i(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,i){if(this.props.values&&this.props.values[t])return this.props.values[t];let n=this.values.get(t);return n===void 0&&i!==void 0&&(n=J1(i===null?void 0:i,{owner:this}),this.addValue(t,n)),n}readValue(t,i){let n=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:this.getBaseTargetFromProps(this.props,t)??this.readValueFromInstance(this.current,t,this.options);return n!=null&&(typeof n=="string"&&(iK(n)||rK(n))?n=parseFloat(n):!m0e(n)&&ig.test(i)&&(n=VK(t,i)),this.setBaseTarget(t,vo(n)?n.get():n)),vo(n)?n.get():n}setBaseTarget(t,i){this.baseTarget[t]=i}getBaseTarget(t){var s;const{initial:i}=this.props;let n;if(typeof i=="string"||typeof i=="object"){const a=w4(this.props,i,(s=this.presenceContext)==null?void 0:s.custom);a&&(n=a[t])}if(i&&n!==void 0)return n;const r=this.getBaseTargetFromProps(this.props,t);return r!==void 0&&!vo(r)?r:this.initialValues[t]!==void 0&&n===void 0?void 0:this.baseTarget[t]}on(t,i){return this.events[t]||(this.events[t]=new t4),this.events[t].add(i)}notify(t,...i){this.events[t]&&this.events[t].notify(...i)}}class DJ extends qxe{constructor(){super(...arguments),this.KeyframeResolver=n0e}sortInstanceNodePosition(t,i){return t.compareDocumentPosition(i)&2?1:-1}getBaseTargetFromProps(t,i){return t.style?t.style[i]:void 0}removeValueFromRenderState(t,{vars:i,style:n}){delete i[t],delete n[t]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;vo(t)&&(this.childSubscription=t.on("change",i=>{this.current&&(this.current.textContent=`${i}`)}))}}function RJ(e,{style:t,vars:i},n,r){Object.assign(e.style,t,r&&r.getProjectionStyles(n));for(const s in i)e.style.setProperty(s,i[s])}function Yxe(e){return window.getComputedStyle(e)}class Qxe extends DJ{constructor(){super(...arguments),this.type="html",this.renderInstance=RJ}readValueFromInstance(t,i){var n;if(Eb.has(i))return(n=this.projection)!=null&&n.isProjecting?AU(i):_ve(t,i);{const r=Yxe(t),s=(r4(i)?r.getPropertyValue(i):r[i])||0;return typeof s=="string"?s.trim():s}}measureInstanceViewportBox(t,{transformPagePoint:i}){return mJ(t,i)}build(t,i,n){S4(t,i,n.transformTemplate)}scrapeMotionValuesFromProps(t,i,n){return M4(t,i,n)}}const PJ=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function Kxe(e,t,i,n){RJ(e,t,void 0,n);for(const r in t.attrs)e.setAttribute(PJ.has(r)?r:b4(r),t.attrs[r])}class Jxe extends DJ{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=us}getBaseTargetFromProps(t,i){return t[i]}readValueFromInstance(t,i){if(Eb.has(i)){const n=FK(i);return n&&n.default||0}return i=PJ.has(i)?i:b4(i),t.getAttribute(i)}scrapeMotionValuesFromProps(t,i,n){return sJ(t,i,n)}build(t,i,n){tJ(t,i,this.isSVGTag,n.transformTemplate,n.style)}renderInstance(t,i,n,r){Kxe(t,i,n,r)}mount(t){this.isSVGTag=nJ(t.tagName),super.mount(t)}}const Zxe=(e,t)=>A4(e)?new Jxe(t):new Qxe(t,{allowProjection:e!==ge.Fragment}),$xe=K0e({..._ye,...Gxe,...Pxe,...kxe},Zxe),Jc=S0e($xe),ja={paddingX:"sm:px-16 px-6",padding:"sm:px-16 px-6 sm:py-16 py-10",heroHeadText:"font-black text-white lg:text-[80px] sm:text-[60px] xs:text-[50px] text-[40px] lg:leading-[98px] mt-2",heroSubText:"text-[#dfd9ff] font-medium lg:text-[30px] sm:text-[26px] xs:text-[20px] text-[16px] lg:leading-[40px]",sectionHeadText:"text-white font-black md:text-[60px] sm:text-[50px] xs:text-[40px] text-[30px]",sectionSubText:"sm:text-[18px] text-[14px] text-secondary uppercase tracking-wider"};var e1e=Object.create,GR=Object.defineProperty,t1e=Object.getOwnPropertyDescriptor,i1e=Object.getOwnPropertyNames,n1e=Object.getPrototypeOf,r1e=Object.prototype.hasOwnProperty,s1e=(e,t,i)=>t in e?GR(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,q0=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),a1e=(e,t)=>{for(var i in t)GR(e,i,{get:t[i],enumerable:!0})},o1e=(e,t,i,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of i1e(t))!r1e.call(e,r)&&r!==i&&GR(e,r,{get:()=>t[r],enumerable:!(n=t1e(t,r))||n.enumerable});return e},pg=(e,t,i)=>(i=e!=null?e1e(n1e(e)):{},o1e(t||!e||!e.__esModule?GR(i,"default",{value:e,enumerable:!0}):i,e)),sA=(e,t,i)=>(s1e(e,typeof t!="symbol"?t+"":t,i),i),l1e=q0((e,t)=>{(function(i,n){typeof e=="object"?t.exports=n():typeof define=="function"&&define.amd?define(n):i.Alea=n()})(e,function(){return i.importState=function(r){var s=new i;return s.importState(r),s},i;function i(){return function(r){var s=0,a=0,o=0,l=1;r.length==0&&(r=[+new Date]);var c=n();s=c(" "),a=c(" "),o=c(" ");for(var u=0;u<r.length;u++)s-=c(r[u]),s<0&&(s+=1),a-=c(r[u]),a<0&&(a+=1),o-=c(r[u]),o<0&&(o+=1);c=null;var h=function(){var d=2091639*s+l*23283064365386963e-26;return s=a,a=o,o=d-(l=d|0)};return h.next=h,h.uint32=function(){return h()*4294967296},h.fract53=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.version="Alea 0.9",h.args=r,h.exportState=function(){return[s,a,o,l]},h.importState=function(d){s=+d[0]||0,a=+d[1]||0,o=+d[2]||0,l=+d[3]||0},h}(Array.prototype.slice.call(arguments))}function n(){var r=4022871197,s=function(a){a=a.toString();for(var o=0;o<a.length;o++){r+=a.charCodeAt(o);var l=.02519603282416938*r;r=l>>>0,l-=r,l*=r,r=l>>>0,l-=r,r+=l*4294967296}return(r>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})}),OJ=q0((e,t)=>{(function(i,n){typeof e=="object"&&typeof t<"u"?n(e):typeof define=="function"&&define.amd?define(["exports"],n):n((i=typeof globalThis<"u"?globalThis:i||self).SVDJS={})})(e,function(i){i.SVD=function(n,r,s,a,o){if(r=r===void 0||r,s=s===void 0||s,o=1e-64/(a=a||Math.pow(2,-52)),!n)throw new TypeError("Matrix a is not defined");var l,c,u,h,d,p,g,x,y,b,A,w,E=n[0].length,D=n.length;if(D<E)throw new TypeError("Invalid matrix: m < n");for(var T=[],I=[],R=[],O=r==="f"?D:E,P=b=g=0;P<D;P++)I[P]=new Array(O).fill(0);for(P=0;P<E;P++)R[P]=new Array(E).fill(0);var U,H=new Array(E).fill(0);for(P=0;P<D;P++)for(l=0;l<E;l++)I[P][l]=n[P][l];for(P=0;P<E;P++){for(T[P]=g,y=0,u=P+1,l=P;l<D;l++)y+=Math.pow(I[l][P],2);if(y<o)g=0;else for(x=(p=I[P][P])*(g=p<0?Math.sqrt(y):-Math.sqrt(y))-y,I[P][P]=p-g,l=u;l<E;l++){for(y=0,c=P;c<D;c++)y+=I[c][P]*I[c][l];for(p=y/x,c=P;c<D;c++)I[c][l]=I[c][l]+p*I[c][P]}for(H[P]=g,y=0,l=u;l<E;l++)y+=Math.pow(I[P][l],2);if(y<o)g=0;else{for(x=(p=I[P][P+1])*(g=p<0?Math.sqrt(y):-Math.sqrt(y))-y,I[P][P+1]=p-g,l=u;l<E;l++)T[l]=I[P][l]/x;for(l=u;l<D;l++){for(y=0,c=u;c<E;c++)y+=I[l][c]*I[P][c];for(c=u;c<E;c++)I[l][c]=I[l][c]+y*T[c]}}b<(A=Math.abs(H[P])+Math.abs(T[P]))&&(b=A)}if(s)for(P=E-1;0<=P;P--){if(g!==0){for(x=I[P][P+1]*g,l=u;l<E;l++)R[l][P]=I[P][l]/x;for(l=u;l<E;l++){for(y=0,c=u;c<E;c++)y+=I[P][c]*R[c][l];for(c=u;c<E;c++)R[c][l]=R[c][l]+y*R[c][P]}}for(l=u;l<E;l++)R[P][l]=0,R[l][P]=0;R[P][P]=1,g=T[P],u=P}if(r){if(r==="f")for(P=E;P<D;P++){for(l=E;l<D;l++)I[P][l]=0;I[P][P]=1}for(P=E-1;0<=P;P--){for(u=P+1,g=H[P],l=u;l<O;l++)I[P][l]=0;if(g!==0){for(x=I[P][P]*g,l=u;l<O;l++){for(y=0,c=u;c<D;c++)y+=I[c][P]*I[c][l];for(p=y/x,c=P;c<D;c++)I[c][l]=I[c][l]+p*I[c][P]}for(l=P;l<D;l++)I[l][P]=I[l][P]/g}else for(l=P;l<D;l++)I[l][P]=0;I[P][P]=I[P][P]+1}}for(a*=b,c=E-1;0<=c;c--)for(var V=0;V<50;V++){for(U=!1,u=c;0<=u;u--){if(Math.abs(T[u])<=a){U=!0;break}if(Math.abs(H[u-1])<=a)break}if(!U){for(d=0,h=u-(y=1),P=u;P<c+1&&(p=y*T[P],T[P]=d*T[P],!(Math.abs(p)<=a));P++)if(g=H[P],H[P]=Math.sqrt(p*p+g*g),d=g/(x=H[P]),y=-p/x,r)for(l=0;l<D;l++)A=I[l][h],w=I[l][P],I[l][h]=A*d+w*y,I[l][P]=-A*y+w*d}if(w=H[c],u===c){if(w<0&&(H[c]=-w,s))for(l=0;l<E;l++)R[l][c]=-R[l][c];break}for(b=H[u],p=(((A=H[c-1])-w)*(A+w)+((g=T[c-1])-(x=T[c]))*(g+x))/(2*x*A),g=Math.sqrt(p*p+1),p=((b-w)*(b+w)+x*(A/(p<0?p-g:p+g)-x))/b,P=u+(y=d=1);P<c+1;P++){if(g=T[P],A=H[P],x=y*g,g*=d,w=Math.sqrt(p*p+x*x),p=b*(d=p/(T[P-1]=w))+g*(y=x/w),g=-b*y+g*d,x=A*y,A*=d,s)for(l=0;l<E;l++)b=R[l][P-1],w=R[l][P],R[l][P-1]=b*d+w*y,R[l][P]=-b*y+w*d;if(w=Math.sqrt(p*p+x*x),p=(d=p/(H[P-1]=w))*g+(y=x/w)*A,b=-y*g+d*A,r)for(l=0;l<D;l++)A=I[l][P-1],w=I[l][P],I[l][P-1]=A*d+w*y,I[l][P]=-A*y+w*d}T[u]=0,T[c]=p,H[c]=b}for(P=0;P<E;P++)H[P]<a&&(H[P]=0);return{u:I,q:H,v:R}},i.VERSION="1.1.1",Object.defineProperty(i,"__esModule",{value:!0})})}),c1e=q0((e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;function i(n){if(n===null||n===!0||n===!1)return NaN;var r=Number(n);return isNaN(r)?r:r<0?Math.ceil(r):Math.floor(r)}t.exports=e.default}),u1e=q0((e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;function i(n){var r=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()));return r.setUTCFullYear(n.getFullYear()),n.getTime()-r.getTime()}t.exports=e.default}),h1e=q0((e,t)=>{function i(s,a){function o(){this.constructor=s}o.prototype=a.prototype,s.prototype=new o}function n(s,a,o,l){this.message=s,this.expected=a,this.found=o,this.location=l,this.name="SyntaxError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,n)}i(n,Error),n.buildMessage=function(s,a){var o={literal:function(g){return'"'+c(g.text)+'"'},class:function(g){var x="",y;for(y=0;y<g.parts.length;y++)x+=g.parts[y]instanceof Array?u(g.parts[y][0])+"-"+u(g.parts[y][1]):u(g.parts[y]);return"["+(g.inverted?"^":"")+x+"]"},any:function(g){return"any character"},end:function(g){return"end of input"},other:function(g){return g.description}};function l(g){return g.charCodeAt(0).toString(16).toUpperCase()}function c(g){return g.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(x){return"\\x0"+l(x)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(x){return"\\x"+l(x)})}function u(g){return g.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(x){return"\\x0"+l(x)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(x){return"\\x"+l(x)})}function h(g){return o[g.type](g)}function d(g){var x=new Array(g.length),y,b;for(y=0;y<g.length;y++)x[y]=h(g[y]);if(x.sort(),x.length>0){for(y=1,b=1;y<x.length;y++)x[y-1]!==x[y]&&(x[b]=x[y],b++);x.length=b}switch(x.length){case 1:return x[0];case 2:return x[0]+" or "+x[1];default:return x.slice(0,-1).join(", ")+", or "+x[x.length-1]}}function p(g){return g?'"'+c(g)+'"':"end of input"}return"Expected "+d(s)+" but "+p(a)+" found."};function r(s,a){a=a!==void 0?a:{};var o={},l={svg_path:At},c=At,u=function(Z){if(!Z)return[];for(var re=[],Se=0;Se<Z.length;Se++)re=re.concat.apply(re,Z[Se]);var ue=re[0];return ue&&ue.code=="m"&&(delete ue.relative,ue.code="M"),re},h=function(Z,re){return Nt(Z,re)},d=/^[Mm]/,p=vt(["M","m"],!1,!1),g=function(Z,re,Se){var ue=$t(Z,[re]);return Se&&(ue=ue.concat($t(Z=="M"?"L":"l",Se[1]))),ue},x=/^[Zz]/,y=vt(["Z","z"],!1,!1),b=function(){return $t("Z")},A=/^[Ll]/,w=vt(["L","l"],!1,!1),E=function(Z,re){return $t(Z,re)},D=/^[Hh]/,T=vt(["H","h"],!1,!1),I=function(Z,re){return $t(Z,re.map(function(Se){return{x:Se}}))},R=/^[Vv]/,O=vt(["V","v"],!1,!1),P=function(Z,re){return $t(Z,re.map(function(Se){return{y:Se}}))},U=/^[Cc]/,H=vt(["C","c"],!1,!1),V=function(Z,re,Se){return{x1:Z.x,y1:Z.y,x2:re.x,y2:re.y,x:Se.x,y:Se.y}},j=/^[Ss]/,J=vt(["S","s"],!1,!1),F=function(Z,re){return{x2:Z.x,y2:Z.y,x:re.x,y:re.y}},X=/^[Qq]/,W=vt(["Q","q"],!1,!1),ne=function(Z,re){return{x1:Z.x,y1:Z.y,x:re.x,y:re.y}},Y=/^[Tt]/,$=vt(["T","t"],!1,!1),se=/^[Aa]/,fe=vt(["A","a"],!1,!1),te=function(Z,re,Se,ue,Pe,yt){return{rx:Z,ry:re,xAxisRotation:Se,largeArc:ue,sweep:Pe,x:yt.x,y:yt.y}},de=function(Z,re){return{x:Z,y:re}},le=function(Z){return Z*1},_e=function(Z){return Z.join("")*1},be=/^[01]/,we=vt(["0","1"],!1,!1),Me=function(Z){return Z=="1"},Ne=function(){return""},Ge=",",We=bt(",",!1),ae=function(Z){return Z.join("")},He=".",Ke=bt(".",!1),je=/^[eE]/,Oe=vt(["e","E"],!1,!1),Qe=/^[+\-]/,$e=vt(["+","-"],!1,!1),gt=/^[0-9]/,pe=vt([["0","9"]],!1,!1),k=function(Z){return Z.join("")},Q=/^[ \t\n\r]/,xe=vt([" ","	",`
`,"\r"],!1,!1),K=0,Re=[{line:1,column:1}],Le=0,st=[],Be;if("startRule"in a){if(!(a.startRule in l))throw new Error(`Can't start parsing from rule "`+a.startRule+'".');c=l[a.startRule]}function bt(Z,re){return{type:"literal",text:Z,ignoreCase:re}}function vt(Z,re,Se){return{type:"class",parts:Z,inverted:re,ignoreCase:Se}}function Xe(){return{type:"end"}}function xt(Z){var re=Re[Z],Se;if(re)return re;for(Se=Z-1;!Re[Se];)Se--;for(re=Re[Se],re={line:re.line,column:re.column};Se<Z;)s.charCodeAt(Se)===10?(re.line++,re.column=1):re.column++,Se++;return Re[Z]=re,re}function _t(Z,re){var Se=xt(Z),ue=xt(re);return{start:{offset:Z,line:Se.line,column:Se.column},end:{offset:re,line:ue.line,column:ue.column}}}function ye(Z){K<Le||(K>Le&&(Le=K,st=[]),st.push(Z))}function Ve(Z,re,Se){return new n(n.buildMessage(Z,re),Z,re,Se)}function At(){var Z,re,Se,ue,Pe;for(Z=K,re=[],Se=wt();Se!==o;)re.push(Se),Se=wt();if(re!==o)if(Se=ie(),Se===o&&(Se=null),Se!==o){for(ue=[],Pe=wt();Pe!==o;)ue.push(Pe),Pe=wt();ue!==o?(re=u(Se),Z=re):(K=Z,Z=o)}else K=Z,Z=o;else K=Z,Z=o;return Z}function ie(){var Z,re,Se,ue,Pe,yt;if(Z=K,re=Ce(),re!==o){for(Se=[],ue=K,Pe=[],yt=wt();yt!==o;)Pe.push(yt),yt=wt();for(Pe!==o?(yt=Ce(),yt!==o?(Pe=[Pe,yt],ue=Pe):(K=ue,ue=o)):(K=ue,ue=o);ue!==o;){for(Se.push(ue),ue=K,Pe=[],yt=wt();yt!==o;)Pe.push(yt),yt=wt();Pe!==o?(yt=Ce(),yt!==o?(Pe=[Pe,yt],ue=Pe):(K=ue,ue=o)):(K=ue,ue=o)}Se!==o?(re=h(re,Se),Z=re):(K=Z,Z=o)}else K=Z,Z=o;return Z}function Ce(){var Z,re,Se,ue,Pe,yt;if(Z=K,re=at(),re!==o){for(Se=[],ue=K,Pe=[],yt=wt();yt!==o;)Pe.push(yt),yt=wt();for(Pe!==o?(yt=De(),yt!==o?(Pe=[Pe,yt],ue=Pe):(K=ue,ue=o)):(K=ue,ue=o);ue!==o;){for(Se.push(ue),ue=K,Pe=[],yt=wt();yt!==o;)Pe.push(yt),yt=wt();Pe!==o?(yt=De(),yt!==o?(Pe=[Pe,yt],ue=Pe):(K=ue,ue=o)):(K=ue,ue=o)}Se!==o?(re=h(re,Se),Z=re):(K=Z,Z=o)}else K=Z,Z=o;return Z}function De(){var Z;return Z=ut(),Z===o&&(Z=lt(),Z===o&&(Z=Vt(),Z===o&&(Z=Jt(),Z===o&&(Z=An(),Z===o&&(Z=xr(),Z===o&&(Z=ve(),Z===o&&(Z=Ye(),Z===o&&(Z=kt())))))))),Z}function at(){var Z,re,Se,ue,Pe,yt,ti;if(Z=K,d.test(s.charAt(K))?(re=s.charAt(K),K++):(re=o,ye(p)),re!==o){for(Se=[],ue=wt();ue!==o;)Se.push(ue),ue=wt();Se!==o?(ue=Zt(),ue!==o?(Pe=K,yt=li(),yt===o&&(yt=null),yt!==o?(ti=It(),ti!==o?(yt=[yt,ti],Pe=yt):(K=Pe,Pe=o)):(K=Pe,Pe=o),Pe===o&&(Pe=null),Pe!==o?(re=g(re,ue,Pe),Z=re):(K=Z,Z=o)):(K=Z,Z=o)):(K=Z,Z=o)}else K=Z,Z=o;return Z}function ut(){var Z,re;return Z=K,x.test(s.charAt(K))?(re=s.charAt(K),K++):(re=o,ye(y)),re!==o&&(re=b()),Z=re,Z}function lt(){var Z,re,Se,ue;if(Z=K,A.test(s.charAt(K))?(re=s.charAt(K),K++):(re=o,ye(w)),re!==o){for(Se=[],ue=wt();ue!==o;)Se.push(ue),ue=wt();Se!==o?(ue=It(),ue!==o?(re=E(re,ue),Z=re):(K=Z,Z=o)):(K=Z,Z=o)}else K=Z,Z=o;return Z}function It(){var Z,re,Se,ue,Pe,yt;if(Z=K,re=Zt(),re!==o){for(Se=[],ue=K,Pe=li(),Pe===o&&(Pe=null),Pe!==o?(yt=Zt(),yt!==o?(Pe=[Pe,yt],ue=Pe):(K=ue,ue=o)):(K=ue,ue=o);ue!==o;)Se.push(ue),ue=K,Pe=li(),Pe===o&&(Pe=null),Pe!==o?(yt=Zt(),yt!==o?(Pe=[Pe,yt],ue=Pe):(K=ue,ue=o)):(K=ue,ue=o);Se!==o?(re=h(re,Se),Z=re):(K=Z,Z=o)}else K=Z,Z=o;return Z}function Vt(){var Z,re,Se,ue;if(Z=K,D.test(s.charAt(K))?(re=s.charAt(K),K++):(re=o,ye(T)),re!==o){for(Se=[],ue=wt();ue!==o;)Se.push(ue),ue=wt();Se!==o?(ue=_i(),ue!==o?(re=I(re,ue),Z=re):(K=Z,Z=o)):(K=Z,Z=o)}else K=Z,Z=o;return Z}function _i(){var Z,re,Se,ue,Pe,yt;if(Z=K,re=Ri(),re!==o){for(Se=[],ue=K,Pe=li(),Pe===o&&(Pe=null),Pe!==o?(yt=Ri(),yt!==o?(Pe=[Pe,yt],ue=Pe):(K=ue,ue=o)):(K=ue,ue=o);ue!==o;)Se.push(ue),ue=K,Pe=li(),Pe===o&&(Pe=null),Pe!==o?(yt=Ri(),yt!==o?(Pe=[Pe,yt],ue=Pe):(K=ue,ue=o)):(K=ue,ue=o);Se!==o?(re=h(re,Se),Z=re):(K=Z,Z=o)}else K=Z,Z=o;return Z}function Jt(){var Z,re,Se,ue;if(Z=K,R.test(s.charAt(K))?(re=s.charAt(K),K++):(re=o,ye(O)),re!==o){for(Se=[],ue=wt();ue!==o;)Se.push(ue),ue=wt();Se!==o?(ue=_i(),ue!==o?(re=P(re,ue),Z=re):(K=Z,Z=o)):(K=Z,Z=o)}else K=Z,Z=o;return Z}function An(){var Z,re,Se,ue;if(Z=K,U.test(s.charAt(K))?(re=s.charAt(K),K++):(re=o,ye(H)),re!==o){for(Se=[],ue=wt();ue!==o;)Se.push(ue),ue=wt();Se!==o?(ue=$i(),ue!==o?(re=E(re,ue),Z=re):(K=Z,Z=o)):(K=Z,Z=o)}else K=Z,Z=o;return Z}function $i(){var Z,re,Se,ue,Pe,yt;if(Z=K,re=jn(),re!==o){for(Se=[],ue=K,Pe=li(),Pe===o&&(Pe=null),Pe!==o?(yt=jn(),yt!==o?(Pe=[Pe,yt],ue=Pe):(K=ue,ue=o)):(K=ue,ue=o);ue!==o;)Se.push(ue),ue=K,Pe=li(),Pe===o&&(Pe=null),Pe!==o?(yt=jn(),yt!==o?(Pe=[Pe,yt],ue=Pe):(K=ue,ue=o)):(K=ue,ue=o);Se!==o?(re=h(re,Se),Z=re):(K=Z,Z=o)}else K=Z,Z=o;return Z}function jn(){var Z,re,Se,ue,Pe,yt;return Z=K,re=Zt(),re!==o?(Se=li(),Se===o&&(Se=null),Se!==o?(ue=Zt(),ue!==o?(Pe=li(),Pe===o&&(Pe=null),Pe!==o?(yt=Zt(),yt!==o?(re=V(re,ue,yt),Z=re):(K=Z,Z=o)):(K=Z,Z=o)):(K=Z,Z=o)):(K=Z,Z=o)):(K=Z,Z=o),Z}function xr(){var Z,re,Se,ue;if(Z=K,j.test(s.charAt(K))?(re=s.charAt(K),K++):(re=o,ye(J)),re!==o){for(Se=[],ue=wt();ue!==o;)Se.push(ue),ue=wt();Se!==o?(ue=Gr(),ue!==o?(re=E(re,ue),Z=re):(K=Z,Z=o)):(K=Z,Z=o)}else K=Z,Z=o;return Z}function Gr(){var Z,re,Se,ue,Pe,yt;if(Z=K,re=kr(),re!==o){for(Se=[],ue=K,Pe=li(),Pe===o&&(Pe=null),Pe!==o?(yt=kr(),yt!==o?(Pe=[Pe,yt],ue=Pe):(K=ue,ue=o)):(K=ue,ue=o);ue!==o;)Se.push(ue),ue=K,Pe=li(),Pe===o&&(Pe=null),Pe!==o?(yt=kr(),yt!==o?(Pe=[Pe,yt],ue=Pe):(K=ue,ue=o)):(K=ue,ue=o);Se!==o?(re=h(re,Se),Z=re):(K=Z,Z=o)}else K=Z,Z=o;return Z}function kr(){var Z,re,Se,ue;return Z=K,re=Zt(),re!==o?(Se=li(),Se===o&&(Se=null),Se!==o?(ue=Zt(),ue!==o?(re=F(re,ue),Z=re):(K=Z,Z=o)):(K=Z,Z=o)):(K=Z,Z=o),Z}function ve(){var Z,re,Se,ue;if(Z=K,X.test(s.charAt(K))?(re=s.charAt(K),K++):(re=o,ye(W)),re!==o){for(Se=[],ue=wt();ue!==o;)Se.push(ue),ue=wt();Se!==o?(ue=et(),ue!==o?(re=E(re,ue),Z=re):(K=Z,Z=o)):(K=Z,Z=o)}else K=Z,Z=o;return Z}function et(){var Z,re,Se,ue,Pe,yt;if(Z=K,re=ft(),re!==o){for(Se=[],ue=K,Pe=li(),Pe===o&&(Pe=null),Pe!==o?(yt=ft(),yt!==o?(Pe=[Pe,yt],ue=Pe):(K=ue,ue=o)):(K=ue,ue=o);ue!==o;)Se.push(ue),ue=K,Pe=li(),Pe===o&&(Pe=null),Pe!==o?(yt=ft(),yt!==o?(Pe=[Pe,yt],ue=Pe):(K=ue,ue=o)):(K=ue,ue=o);Se!==o?(re=h(re,Se),Z=re):(K=Z,Z=o)}else K=Z,Z=o;return Z}function ft(){var Z,re,Se,ue;return Z=K,re=Zt(),re!==o?(Se=li(),Se===o&&(Se=null),Se!==o?(ue=Zt(),ue!==o?(re=ne(re,ue),Z=re):(K=Z,Z=o)):(K=Z,Z=o)):(K=Z,Z=o),Z}function Ye(){var Z,re,Se,ue;if(Z=K,Y.test(s.charAt(K))?(re=s.charAt(K),K++):(re=o,ye($)),re!==o){for(Se=[],ue=wt();ue!==o;)Se.push(ue),ue=wt();Se!==o?(ue=ot(),ue!==o?(re=E(re,ue),Z=re):(K=Z,Z=o)):(K=Z,Z=o)}else K=Z,Z=o;return Z}function ot(){var Z,re,Se,ue,Pe,yt;if(Z=K,re=Zt(),re!==o){for(Se=[],ue=K,Pe=li(),Pe===o&&(Pe=null),Pe!==o?(yt=Zt(),yt!==o?(Pe=[Pe,yt],ue=Pe):(K=ue,ue=o)):(K=ue,ue=o);ue!==o;)Se.push(ue),ue=K,Pe=li(),Pe===o&&(Pe=null),Pe!==o?(yt=Zt(),yt!==o?(Pe=[Pe,yt],ue=Pe):(K=ue,ue=o)):(K=ue,ue=o);Se!==o?(re=h(re,Se),Z=re):(K=Z,Z=o)}else K=Z,Z=o;return Z}function kt(){var Z,re,Se,ue;if(Z=K,se.test(s.charAt(K))?(re=s.charAt(K),K++):(re=o,ye(fe)),re!==o){for(Se=[],ue=wt();ue!==o;)Se.push(ue),ue=wt();Se!==o?(ue=si(),ue!==o?(re=E(re,ue),Z=re):(K=Z,Z=o)):(K=Z,Z=o)}else K=Z,Z=o;return Z}function si(){var Z,re,Se,ue,Pe,yt;if(Z=K,re=oi(),re!==o){for(Se=[],ue=K,Pe=li(),Pe===o&&(Pe=null),Pe!==o?(yt=oi(),yt!==o?(Pe=[Pe,yt],ue=Pe):(K=ue,ue=o)):(K=ue,ue=o);ue!==o;)Se.push(ue),ue=K,Pe=li(),Pe===o&&(Pe=null),Pe!==o?(yt=oi(),yt!==o?(Pe=[Pe,yt],ue=Pe):(K=ue,ue=o)):(K=ue,ue=o);Se!==o?(re=h(re,Se),Z=re):(K=Z,Z=o)}else K=Z,Z=o;return Z}function oi(){var Z,re,Se,ue,Pe,yt,ti,Wn,en,Pr,wa,Dn;return Z=K,re=fi(),re!==o?(Se=li(),Se===o&&(Se=null),Se!==o?(ue=fi(),ue!==o?(Pe=li(),Pe===o&&(Pe=null),Pe!==o?(yt=Ri(),yt!==o?(ti=li(),ti!==o?(Wn=Pi(),Wn!==o?(en=li(),en===o&&(en=null),en!==o?(Pr=Pi(),Pr!==o?(wa=li(),wa===o&&(wa=null),wa!==o?(Dn=Zt(),Dn!==o?(re=te(re,ue,yt,Wn,Pr,Dn),Z=re):(K=Z,Z=o)):(K=Z,Z=o)):(K=Z,Z=o)):(K=Z,Z=o)):(K=Z,Z=o)):(K=Z,Z=o)):(K=Z,Z=o)):(K=Z,Z=o)):(K=Z,Z=o)):(K=Z,Z=o)):(K=Z,Z=o),Z}function Zt(){var Z,re,Se,ue;return Z=K,re=Ri(),re!==o?(Se=li(),Se===o&&(Se=null),Se!==o?(ue=Ri(),ue!==o?(re=de(re,ue),Z=re):(K=Z,Z=o)):(K=Z,Z=o)):(K=Z,Z=o),Z}function fi(){var Z,re;return Z=K,re=Ue(),re===o&&(re=Rt()),re!==o&&(re=le(re)),Z=re,Z}function Ri(){var Z,re,Se,ue;return Z=K,re=K,Se=Ie(),Se===o&&(Se=null),Se!==o?(ue=Ue(),ue!==o?(Se=[Se,ue],re=Se):(K=re,re=o)):(K=re,re=o),re===o&&(re=K,Se=Ie(),Se===o&&(Se=null),Se!==o?(ue=Rt(),ue!==o?(Se=[Se,ue],re=Se):(K=re,re=o)):(K=re,re=o)),re!==o&&(re=_e(re)),Z=re,Z}function Pi(){var Z,re;return Z=K,be.test(s.charAt(K))?(re=s.charAt(K),K++):(re=o,ye(we)),re!==o&&(re=Me(re)),Z=re,Z}function li(){var Z,re,Se,ue,Pe;if(Z=K,re=[],Se=wt(),Se!==o)for(;Se!==o;)re.push(Se),Se=wt();else re=o;if(re!==o)if(Se=oe(),Se===o&&(Se=null),Se!==o){for(ue=[],Pe=wt();Pe!==o;)ue.push(Pe),Pe=wt();ue!==o?(re=[re,Se,ue],Z=re):(K=Z,Z=o)}else K=Z,Z=o;else K=Z,Z=o;if(Z===o){if(Z=K,re=K,Se=oe(),Se!==o){for(ue=[],Pe=wt();Pe!==o;)ue.push(Pe),Pe=wt();ue!==o?(Se=[Se,ue],re=Se):(K=re,re=o)}else K=re,re=o;re!==o&&(re=Ne()),Z=re}return Z}function oe(){var Z;return s.charCodeAt(K)===44?(Z=Ge,K++):(Z=o,ye(We)),Z}function Ue(){var Z,re,Se,ue;return Z=K,re=K,Se=nt(),Se!==o?(ue=Ze(),ue===o&&(ue=null),ue!==o?(Se=[Se,ue],re=Se):(K=re,re=o)):(K=re,re=o),re===o&&(re=K,Se=Rt(),Se!==o?(ue=Ze(),ue!==o?(Se=[Se,ue],re=Se):(K=re,re=o)):(K=re,re=o)),re!==o&&(re=ae(re)),Z=re,Z}function nt(){var Z,re,Se,ue,Pe;return Z=K,re=K,Se=Rt(),Se===o&&(Se=null),Se!==o?(s.charCodeAt(K)===46?(ue=He,K++):(ue=o,ye(Ke)),ue!==o?(Pe=Rt(),Pe!==o?(Se=[Se,ue,Pe],re=Se):(K=re,re=o)):(K=re,re=o)):(K=re,re=o),re===o&&(re=K,Se=Rt(),Se!==o?(s.charCodeAt(K)===46?(ue=He,K++):(ue=o,ye(Ke)),ue!==o?(Se=[Se,ue],re=Se):(K=re,re=o)):(K=re,re=o)),re!==o&&(re=ae(re)),Z=re,Z}function Ze(){var Z,re,Se,ue,Pe;return Z=K,re=K,je.test(s.charAt(K))?(Se=s.charAt(K),K++):(Se=o,ye(Oe)),Se!==o?(ue=Ie(),ue===o&&(ue=null),ue!==o?(Pe=Rt(),Pe!==o?(Se=[Se,ue,Pe],re=Se):(K=re,re=o)):(K=re,re=o)):(K=re,re=o),re!==o&&(re=ae(re)),Z=re,Z}function Ie(){var Z;return Qe.test(s.charAt(K))?(Z=s.charAt(K),K++):(Z=o,ye($e)),Z}function Rt(){var Z,re,Se;if(Z=K,re=[],gt.test(s.charAt(K))?(Se=s.charAt(K),K++):(Se=o,ye(pe)),Se!==o)for(;Se!==o;)re.push(Se),gt.test(s.charAt(K))?(Se=s.charAt(K),K++):(Se=o,ye(pe));else re=o;return re!==o&&(re=k(re)),Z=re,Z}function wt(){var Z,re;return Z=K,Q.test(s.charAt(K))?(re=s.charAt(K),K++):(re=o,ye(xe)),re!==o&&(re=Ne()),Z=re,Z}function Nt(Z,re){if(!re)return[Z];for(var Se=[Z],ue=0,Pe=re.length;ue<Pe;ue++)Se[ue+1]=re[ue][1];return Se}var Ht={m:"moveto",l:"lineto",h:"horizontal lineto",v:"vertical lineto",c:"curveto",s:"smooth curveto",q:"quadratic curveto",t:"smooth quadratic curveto",a:"elliptical arc",z:"closepath"};for(var ai in Ht)Ht[ai.toUpperCase()]=Ht[ai];function $t(Z,re){re||(re=[{}]);for(var Se=re.length;Se--;){var ue={code:Z,command:Ht[Z]};Z==Z.toLowerCase()&&(ue.relative=!0);for(var Pe in re[Se])ue[Pe]=re[Se][Pe];re[Se]=ue}return re}if(Be=c(),Be!==o&&K===s.length)return Be;throw Be!==o&&K<s.length&&ye(Xe()),Ve(st,Le<s.length?s.charAt(Le):null,Le<s.length?_t(Le,Le+1):_t(Le,Le))}t.exports={SyntaxError:n,parse:r}}),BJ=q0((e,t)=>{var i=h1e().parse;i.parseSVG=i,i.makeAbsolute=n,t.exports=i;function n(r){var s,a={x:0,y:0},o={x:"x0",y:"y0",x1:"x0",y1:"y0",x2:"x0",y2:"y0"};return r.forEach(function(l){l.command==="moveto"&&(s=l),l.x0=a.x,l.y0=a.y;for(var c in o)c in l&&(l[c]+=l.relative?l[o[c]]:0);"x"in l||(l.x=a.x),"y"in l||(l.y=a.y),l.relative=!1,l.code=l.code.toUpperCase(),l.command=="closepath"&&(l.x=s.x,l.y=s.y),a=l}),r}}),d1e=q0((e,t)=>{t.exports=function(i,n){for(var r=i.split("."),s=n.split("."),a=0;a<3;a++){var o=Number(r[a]),l=Number(s[a]);if(o>l)return 1;if(l>o)return-1;if(!isNaN(o)&&isNaN(l))return 1;if(isNaN(o)&&!isNaN(l))return-1}return 0}}),Tb="149",Tc={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},f1e=0,W6=1,p1e=2,T4=1,m1e=2,aA=3,Zu=0,va=1,yo=2,Rs=0,x0=1,X6=2,q6=3,Y6=4,g1e=5,Zx=100,v1e=101,y1e=102,Q6=103,K6=104,x1e=200,b1e=201,S1e=202,_1e=203,IJ=204,LJ=205,A1e=206,w1e=207,M1e=208,E1e=209,T1e=210,C1e=0,D1e=1,R1e=2,NU=3,P1e=4,O1e=5,B1e=6,I1e=7,UJ=0,L1e=1,U1e=2,md=0,N1e=1,z1e=2,F1e=3,V1e=4,H1e=5,NJ=300,B0=301,I0=302,zU=303,FU=304,rM=306,zf=1e3,Ar=1001,VU=1002,rn=1003,J6=1004,BB=1005,Yi=1006,G1e=1007,$1=1008,bo=1009,k1e=1010,j1e=1011,zJ=1012,W1e=1013,Ff=1014,Zn=1015,ip=1016,X1e=1017,q1e=1018,b0=1020,Y1e=1021,Rr=1023,Q1e=1024,K1e=1025,S0=1026,L0=1027,OC=1028,J1e=1029,QD=1030,Z1e=1031,FJ=1033,IB=33776,LB=33777,UB=33778,NB=33779,Z6=35840,$6=35841,e8=35842,t8=35843,$1e=36196,i8=37492,n8=37496,r8=37808,s8=37809,a8=37810,o8=37811,l8=37812,c8=37813,u8=37814,h8=37815,d8=37816,f8=37817,p8=37818,m8=37819,g8=37820,v8=37821,zB=36492,ebe=36283,y8=36284,x8=36285,b8=36286,VJ=2200,HJ=2201,C4=2202,KD=2300,JD=2301,FB=2302,f1=2400,p1=2401,ZD=2402,D4=2500,tbe=2501,$u=3e3,Gi=3001,cp=3200,GJ=3201,ibe=0,nbe=1,td="srgb",$D="srgb-linear",VB=7680,rbe=519,HU=35044,sbe=35048,GU="300 es",kU=1035,Ka=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});let i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;let i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;let i=this._listeners[e];if(i!==void 0){let n=i.indexOf(t);n!==-1&&i.splice(n,1)}}dispatchEvent(e){if(this._listeners===void 0)return;let t=this._listeners[e.type];if(t!==void 0){e.target=this;let i=t.slice(0);for(let n=0,r=i.length;n<r;n++)i[n].call(this,e);e.target=null}}},co=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],S8=1234567,PA=Math.PI/180,fw=180/Math.PI;function qc(){let e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(co[e&255]+co[e>>8&255]+co[e>>16&255]+co[e>>24&255]+"-"+co[t&255]+co[t>>8&255]+"-"+co[t>>16&15|64]+co[t>>24&255]+"-"+co[i&63|128]+co[i>>8&255]+"-"+co[i>>16&255]+co[i>>24&255]+co[n&255]+co[n>>8&255]+co[n>>16&255]+co[n>>24&255]).toLowerCase()}function Es(e,t,i){return Math.max(t,Math.min(i,e))}function R4(e,t){return(e%t+t)%t}function abe(e,t,i,n,r){return n+(e-t)*(r-n)/(i-t)}function obe(e,t,i){return e!==t?(i-e)/(t-e):0}function OA(e,t,i){return(1-i)*e+i*t}function lbe(e,t,i,n){return OA(e,t,1-Math.exp(-i*n))}function cbe(e,t=1){return t-Math.abs(R4(e,t*2)-t)}function ube(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*(3-2*e))}function hbe(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*e*(e*(e*6-15)+10))}function dbe(e,t){return e+Math.floor(Math.random()*(t-e+1))}function fbe(e,t){return e+Math.random()*(t-e)}function pbe(e){return e*(.5-Math.random())}function mbe(e){e!==void 0&&(S8=e);let t=S8+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function gbe(e){return e*PA}function vbe(e){return e*fw}function jU(e){return(e&e-1)===0&&e!==0}function kJ(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function e3(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function ybe(e,t,i,n,r){let s=Math.cos,a=Math.sin,o=s(i/2),l=a(i/2),c=s((t+n)/2),u=a((t+n)/2),h=s((t-n)/2),d=a((t-n)/2),p=s((n-t)/2),g=a((n-t)/2);switch(r){case"XYX":e.set(o*u,l*h,l*d,o*c);break;case"YZY":e.set(l*d,o*u,l*h,o*c);break;case"ZXZ":e.set(l*h,l*d,o*u,o*c);break;case"XZX":e.set(o*u,l*g,l*p,o*c);break;case"YXY":e.set(l*p,o*u,l*g,o*c);break;case"ZYZ":e.set(l*g,l*p,o*u,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function Vf(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function dr(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(e*65535);case Uint8Array:return Math.round(e*255);case Int16Array:return Math.round(e*32767);case Int8Array:return Math.round(e*127);default:throw new Error("Invalid component type.")}}var qt=Object.freeze({__proto__:null,DEG2RAD:PA,RAD2DEG:fw,ceilPowerOfTwo:kJ,clamp:Es,damp:lbe,degToRad:gbe,denormalize:Vf,euclideanModulo:R4,floorPowerOfTwo:e3,generateUUID:qc,inverseLerp:obe,isPowerOfTwo:jU,lerp:OA,mapLinear:abe,normalize:dr,pingpong:cbe,radToDeg:vbe,randFloat:fbe,randFloatSpread:pbe,randInt:dbe,seededRandom:mbe,setQuaternionFromProperEuler:ybe,smootherstep:hbe,smoothstep:ube}),Ae=class{constructor(e=0,t=0){Ae.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){let t=this.x,i=this.y,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6],this.y=n[1]*t+n[4]*i+n[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){let i=Math.cos(t),n=Math.sin(t),r=this.x-e.x,s=this.y-e.y;return this.x=r*i-s*n+e.x,this.y=r*n+s*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},Cs=class{constructor(){Cs.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,i,n,r,s,a,o,l){let c=this.elements;return c[0]=e,c[1]=n,c[2]=a,c[3]=t,c[4]=r,c[5]=o,c[6]=i,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){let t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){let t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let i=e.elements,n=t.elements,r=this.elements,s=i[0],a=i[3],o=i[6],l=i[1],c=i[4],u=i[7],h=i[2],d=i[5],p=i[8],g=n[0],x=n[3],y=n[6],b=n[1],A=n[4],w=n[7],E=n[2],D=n[5],T=n[8];return r[0]=s*g+a*b+o*E,r[3]=s*x+a*A+o*D,r[6]=s*y+a*w+o*T,r[1]=l*g+c*b+u*E,r[4]=l*x+c*A+u*D,r[7]=l*y+c*w+u*T,r[2]=h*g+d*b+p*E,r[5]=h*x+d*A+p*D,r[8]=h*y+d*w+p*T,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){let e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8];return t*s*c-t*a*l-i*r*c+i*a*o+n*r*l-n*s*o}invert(){let e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8],u=c*s-a*l,h=a*o-c*r,d=l*r-s*o,p=t*u+i*h+n*d;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);let g=1/p;return e[0]=u*g,e[1]=(n*l-c*i)*g,e[2]=(a*i-n*s)*g,e[3]=h*g,e[4]=(c*t-n*o)*g,e[5]=(n*r-a*t)*g,e[6]=d*g,e[7]=(i*o-l*t)*g,e[8]=(s*t-i*r)*g,this}transpose(){let e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){let t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,n,r,s,a){let o=Math.cos(r),l=Math.sin(r);return this.set(i*o,i*l,-i*(o*s+l*a)+s+e,-n*l,n*o,-n*(-l*s+o*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(HB.makeScale(e,t)),this}rotate(e){return this.premultiply(HB.makeRotation(-e)),this}translate(e,t){return this.premultiply(HB.makeTranslation(e,t)),this}makeTranslation(e,t){return this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){let t=this.elements,i=e.elements;for(let n=0;n<9;n++)if(t[n]!==i[n])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){let i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}},HB=new Cs;function jJ(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}var xbe={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function J2(e,t){return new xbe[e](t)}function pw(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function bbe(e,t,i){return new Promise(function(n,r){function s(){switch(e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0)){case e.WAIT_FAILED:r();break;case e.TIMEOUT_EXPIRED:setTimeout(s,i);break;default:n()}}setTimeout(s,i)})}function _0(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function BC(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}var GB={[td]:{[$D]:_0},[$D]:{[td]:BC}},Vo={legacyMode:!0,get workingColorSpace(){return $D},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,i){if(this.legacyMode||t===i||!t||!i)return e;if(GB[t]&&GB[t][i]!==void 0){let n=GB[t][i];return e.r=n(e.r),e.g=n(e.g),e.b=n(e.b),e}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}},WJ={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Gs={r:0,g:0,b:0},Du={h:0,s:0,l:0},Z2={h:0,s:0,l:0};function kB(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+(t-e)*6*i:i<1/2?t:i<2/3?e+(t-e)*6*(2/3-i):e}function $2(e,t){return t.r=e.r,t.g=e.g,t.b=e.b,t}var gi=class{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,t===void 0&&i===void 0?this.set(e):this.setRGB(e,t,i)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=td){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Vo.toWorkingColorSpace(this,t),this}setRGB(e,t,i,n=Vo.workingColorSpace){return this.r=e,this.g=t,this.b=i,Vo.toWorkingColorSpace(this,n),this}setHSL(e,t,i,n=Vo.workingColorSpace){if(e=R4(e,1),t=Es(t,0,1),i=Es(i,0,1),t===0)this.r=this.g=this.b=i;else{let r=i<=.5?i*(1+t):i+t-i*t,s=2*i-r;this.r=kB(s,r,e+1/3),this.g=kB(s,r,e),this.b=kB(s,r,e-1/3)}return Vo.toWorkingColorSpace(this,n),this}setStyle(e,t=td){function i(r){r!==void 0&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let r,s=n[1],a=n[2];switch(s){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,Vo.toWorkingColorSpace(this,t),i(r[4]),this;if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,Vo.toWorkingColorSpace(this,t),i(r[4]),this;break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a)){let o=parseFloat(r[1])/360,l=parseFloat(r[2])/100,c=parseFloat(r[3])/100;return i(r[4]),this.setHSL(o,l,c,t)}break}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){let r=n[1],s=r.length;if(s===3)return this.r=parseInt(r.charAt(0)+r.charAt(0),16)/255,this.g=parseInt(r.charAt(1)+r.charAt(1),16)/255,this.b=parseInt(r.charAt(2)+r.charAt(2),16)/255,Vo.toWorkingColorSpace(this,t),this;if(s===6)return this.r=parseInt(r.charAt(0)+r.charAt(1),16)/255,this.g=parseInt(r.charAt(2)+r.charAt(3),16)/255,this.b=parseInt(r.charAt(4)+r.charAt(5),16)/255,Vo.toWorkingColorSpace(this,t),this}return e&&e.length>0?this.setColorName(e,t):this}setColorName(e,t=td){let i=WJ[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=_0(e.r),this.g=_0(e.g),this.b=_0(e.b),this}copyLinearToSRGB(e){return this.r=BC(e.r),this.g=BC(e.g),this.b=BC(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=td){return Vo.fromWorkingColorSpace($2(this,Gs),e),Es(Gs.r*255,0,255)<<16^Es(Gs.g*255,0,255)<<8^Es(Gs.b*255,0,255)<<0}getHexString(e=td){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Vo.workingColorSpace){Vo.fromWorkingColorSpace($2(this,Gs),t);let i=Gs.r,n=Gs.g,r=Gs.b,s=Math.max(i,n,r),a=Math.min(i,n,r),o,l,c=(a+s)/2;if(a===s)o=0,l=0;else{let u=s-a;switch(l=c<=.5?u/(s+a):u/(2-s-a),s){case i:o=(n-r)/u+(n<r?6:0);break;case n:o=(r-i)/u+2;break;case r:o=(i-n)/u+4;break}o/=6}return e.h=o,e.s=l,e.l=c,e}getRGB(e,t=Vo.workingColorSpace){return Vo.fromWorkingColorSpace($2(this,Gs),t),e.r=Gs.r,e.g=Gs.g,e.b=Gs.b,e}getStyle(e=td){return Vo.fromWorkingColorSpace($2(this,Gs),e),e!==td?`color(${e} ${Gs.r} ${Gs.g} ${Gs.b})`:`rgb(${Gs.r*255|0},${Gs.g*255|0},${Gs.b*255|0})`}offsetHSL(e,t,i){return this.getHSL(Du),Du.h+=e,Du.s+=t,Du.l+=i,this.setHSL(Du.h,Du.s,Du.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(Du),e.getHSL(Z2);let i=OA(Du.h,Z2.h,t),n=OA(Du.s,Z2.s,t),r=OA(Du.l,Z2.l,t);return this.setHSL(i,n,r),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};gi.NAMES=WJ;var Sx,XJ=class{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{Sx===void 0&&(Sx=pw("canvas")),Sx.width=e.width,Sx.height=e.height;let i=Sx.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=Sx}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){let t=pw("canvas");t.width=e.width,t.height=e.height;let i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);let n=i.getImageData(0,0,e.width,e.height),r=n.data;for(let s=0;s<r.length;s++)r[s]=_0(r[s]/255)*255;return i.putImageData(n,0,0),t}else if(e.data){let t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(_0(t[i]/255)*255):t[i]=_0(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}},qJ=class{constructor(e=null){this.isSource=!0,this.uuid=qc(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){let t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];let i={uuid:this.uuid,url:""},n=this.data;if(n!==null){let r;if(Array.isArray(n)){r=[];for(let s=0,a=n.length;s<a;s++)n[s].isDataTexture?r.push(jB(n[s].image)):r.push(jB(n[s]))}else r=jB(n);i.url=r}return t||(e.images[this.uuid]=i),i}};function jB(e){return typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap?XJ.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var Sbe=0,Hr=class extends Ka{constructor(e=Hr.DEFAULT_IMAGE,t=Hr.DEFAULT_MAPPING,i=Ar,n=Ar,r=Yi,s=$1,a=Rr,o=bo,l=Hr.DEFAULT_ANISOTROPY,c=$u){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Sbe++}),this.uuid=qc(),this.name="",this.source=new qJ(e),this.mipmaps=[],this.mapping=t,this.wrapS=i,this.wrapT=n,this.magFilter=r,this.minFilter=s,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=o,this.offset=new Ae(0,0),this.repeat=new Ae(1,1),this.center=new Ae(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Cs,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){let t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];let i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==NJ)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case zf:e.x=e.x-Math.floor(e.x);break;case Ar:e.x=e.x<0?0:1;break;case VU:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case zf:e.y=e.y-Math.floor(e.y);break;case Ar:e.y=e.y<0?0:1;break;case VU:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}};Hr.DEFAULT_IMAGE=null;Hr.DEFAULT_MAPPING=NJ;Hr.DEFAULT_ANISOTROPY=1;var Di=class{constructor(e=0,t=0,i=0,n=1){Di.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=n}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){let t=this.x,i=this.y,n=this.z,r=this.w,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*n+s[12]*r,this.y=s[1]*t+s[5]*i+s[9]*n+s[13]*r,this.z=s[2]*t+s[6]*i+s[10]*n+s[14]*r,this.w=s[3]*t+s[7]*i+s[11]*n+s[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);let t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,n,r,s=e.elements,a=s[0],o=s[4],l=s[8],c=s[1],u=s[5],h=s[9],d=s[2],p=s[6],g=s[10];if(Math.abs(o-c)<.01&&Math.abs(l-d)<.01&&Math.abs(h-p)<.01){if(Math.abs(o+c)<.1&&Math.abs(l+d)<.1&&Math.abs(h+p)<.1&&Math.abs(a+u+g-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;let y=(a+1)/2,b=(u+1)/2,A=(g+1)/2,w=(o+c)/4,E=(l+d)/4,D=(h+p)/4;return y>b&&y>A?y<.01?(i=0,n=.707106781,r=.707106781):(i=Math.sqrt(y),n=w/i,r=E/i):b>A?b<.01?(i=.707106781,n=0,r=.707106781):(n=Math.sqrt(b),i=w/n,r=D/n):A<.01?(i=.707106781,n=.707106781,r=0):(r=Math.sqrt(A),i=E/r,n=D/r),this.set(i,n,r,t),this}let x=Math.sqrt((p-h)*(p-h)+(l-d)*(l-d)+(c-o)*(c-o));return Math.abs(x)<.001&&(x=1),this.x=(p-h)/x,this.y=(l-d)/x,this.z=(c-o)/x,this.w=Math.acos((a+u+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},mn=class extends Ka{constructor(e=1,t=1,i={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Di(0,0,e,t),this.scissorTest=!1,this.viewport=new Di(0,0,e,t);let n={width:e,height:t,depth:1};this.texture=new Hr(n,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.internalFormat=i.internalFormat!==void 0?i.internalFormat:null,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:Yi,this.depthBuffer=i.depthBuffer!==void 0?i.depthBuffer:!0,this.stencilBuffer=i.stencilBuffer!==void 0?i.stencilBuffer:!1,this.depthTexture=i.depthTexture!==void 0?i.depthTexture:null,this.samples=i.samples!==void 0?i.samples:0}setSize(e,t,i=1){(this.width!==e||this.height!==t||this.depth!==i)&&(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;let t=Object.assign({},e.texture.image);return this.texture.source=new qJ(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}},YJ=class extends Hr{constructor(e=null,t=1,i=1,n=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:n},this.magFilter=rn,this.minFilter=rn,this.wrapR=Ar,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},_be=class extends Hr{constructor(e=null,t=1,i=1,n=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:n},this.magFilter=rn,this.minFilter=rn,this.wrapR=Ar,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},QJ=class extends mn{constructor(e=1,t=1,i=1,n={}){super(e,t,n),this.isWebGLMultipleRenderTargets=!0;let r=this.texture;this.texture=[];for(let s=0;s<i;s++)this.texture[s]=r.clone(),this.texture[s].isRenderTargetTexture=!0}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let n=0,r=this.texture.length;n<r;n++)this.texture[n].image.width=e,this.texture[n].image.height=t,this.texture[n].image.depth=i;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,i=e.texture.length;t<i;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}},Ei=class{constructor(e=0,t=0,i=0,n=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=n}static slerpFlat(e,t,i,n,r,s,a){let o=i[n+0],l=i[n+1],c=i[n+2],u=i[n+3],h=r[s+0],d=r[s+1],p=r[s+2],g=r[s+3];if(a===0){e[t+0]=o,e[t+1]=l,e[t+2]=c,e[t+3]=u;return}if(a===1){e[t+0]=h,e[t+1]=d,e[t+2]=p,e[t+3]=g;return}if(u!==g||o!==h||l!==d||c!==p){let x=1-a,y=o*h+l*d+c*p+u*g,b=y>=0?1:-1,A=1-y*y;if(A>Number.EPSILON){let E=Math.sqrt(A),D=Math.atan2(E,y*b);x=Math.sin(x*D)/E,a=Math.sin(a*D)/E}let w=a*b;if(o=o*x+h*w,l=l*x+d*w,c=c*x+p*w,u=u*x+g*w,x===1-a){let E=1/Math.sqrt(o*o+l*l+c*c+u*u);o*=E,l*=E,c*=E,u*=E}}e[t]=o,e[t+1]=l,e[t+2]=c,e[t+3]=u}static multiplyQuaternionsFlat(e,t,i,n,r,s){let a=i[n],o=i[n+1],l=i[n+2],c=i[n+3],u=r[s],h=r[s+1],d=r[s+2],p=r[s+3];return e[t]=a*p+c*u+o*d-l*h,e[t+1]=o*p+c*h+l*u-a*d,e[t+2]=l*p+c*d+a*h-o*u,e[t+3]=c*p-a*u-o*h-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){let i=e._x,n=e._y,r=e._z,s=e._order,a=Math.cos,o=Math.sin,l=a(i/2),c=a(n/2),u=a(r/2),h=o(i/2),d=o(n/2),p=o(r/2);switch(s){case"XYZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"YXZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"ZXY":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"ZYX":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"YZX":this._x=h*c*u+l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u-h*d*p;break;case"XZY":this._x=h*c*u-l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u+h*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){let i=t/2,n=Math.sin(i);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){let t=e.elements,i=t[0],n=t[4],r=t[8],s=t[1],a=t[5],o=t[9],l=t[2],c=t[6],u=t[10],h=i+a+u;if(h>0){let d=.5/Math.sqrt(h+1);this._w=.25/d,this._x=(c-o)*d,this._y=(r-l)*d,this._z=(s-n)*d}else if(i>a&&i>u){let d=2*Math.sqrt(1+i-a-u);this._w=(c-o)/d,this._x=.25*d,this._y=(n+s)/d,this._z=(r+l)/d}else if(a>u){let d=2*Math.sqrt(1+a-i-u);this._w=(r-l)/d,this._x=(n+s)/d,this._y=.25*d,this._z=(o+c)/d}else{let d=2*Math.sqrt(1+u-i-a);this._w=(s-n)/d,this._x=(r+l)/d,this._y=(o+c)/d,this._z=.25*d}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Es(this.dot(e),-1,1)))}rotateTowards(e,t){let i=this.angleTo(e);if(i===0)return this;let n=Math.min(1,t/i);return this.slerp(e,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){let i=e._x,n=e._y,r=e._z,s=e._w,a=t._x,o=t._y,l=t._z,c=t._w;return this._x=i*c+s*a+n*l-r*o,this._y=n*c+s*o+r*a-i*l,this._z=r*c+s*l+i*o-n*a,this._w=s*c-i*a-n*o-r*l,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);let i=this._x,n=this._y,r=this._z,s=this._w,a=s*e._w+i*e._x+n*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=s,this._x=i,this._y=n,this._z=r,this;let o=1-a*a;if(o<=Number.EPSILON){let d=1-t;return this._w=d*s+t*this._w,this._x=d*i+t*this._x,this._y=d*n+t*this._y,this._z=d*r+t*this._z,this.normalize(),this._onChangeCallback(),this}let l=Math.sqrt(o),c=Math.atan2(l,a),u=Math.sin((1-t)*c)/l,h=Math.sin(t*c)/l;return this._w=s*u+this._w*h,this._x=i*u+this._x*h,this._y=n*u+this._y*h,this._z=r*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){let e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),n=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(t*Math.cos(n),i*Math.sin(r),i*Math.cos(r),t*Math.sin(n))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},G=class{constructor(e=0,t=0,i=0){G.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(_8.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(_8.setFromAxisAngle(e,t))}applyMatrix3(e){let t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6]*n,this.y=r[1]*t+r[4]*i+r[7]*n,this.z=r[2]*t+r[5]*i+r[8]*n,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){let t=this.x,i=this.y,n=this.z,r=e.elements,s=1/(r[3]*t+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*t+r[4]*i+r[8]*n+r[12])*s,this.y=(r[1]*t+r[5]*i+r[9]*n+r[13])*s,this.z=(r[2]*t+r[6]*i+r[10]*n+r[14])*s,this}applyQuaternion(e){let t=this.x,i=this.y,n=this.z,r=e.x,s=e.y,a=e.z,o=e.w,l=o*t+s*n-a*i,c=o*i+a*t-r*n,u=o*n+r*i-s*t,h=-r*t-s*i-a*n;return this.x=l*o+h*-r+c*-a-u*-s,this.y=c*o+h*-s+u*-r-l*-a,this.z=u*o+h*-a+l*-s-c*-r,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){let t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*n,this.y=r[1]*t+r[5]*i+r[9]*n,this.z=r[2]*t+r[6]*i+r[10]*n,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){let i=e.x,n=e.y,r=e.z,s=t.x,a=t.y,o=t.z;return this.x=n*o-r*a,this.y=r*s-i*o,this.z=i*a-n*s,this}projectOnVector(e){let t=e.lengthSq();if(t===0)return this.set(0,0,0);let i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return WB.copy(this).projectOnVector(e),this.sub(WB)}reflect(e){return this.sub(WB.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){let t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;let i=this.dot(e)/t;return Math.acos(Es(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,i=this.y-e.y,n=this.z-e.z;return t*t+i*i+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){let n=Math.sin(t)*e;return this.x=n*Math.sin(i),this.y=Math.cos(t)*e,this.z=n*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){let t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){let t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=n,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}},WB=new G,_8=new Ei,ps=class{constructor(e=new G(1/0,1/0,1/0),t=new G(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,a=-1/0;for(let o=0,l=e.length;o<l;o+=3){let c=e[o],u=e[o+1],h=e[o+2];c<t&&(t=c),u<i&&(i=u),h<n&&(n=h),c>r&&(r=c),u>s&&(s=u),h>a&&(a=h)}return this.min.set(t,i,n),this.max.set(r,s,a),this}setFromBufferAttribute(e){let t=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,a=-1/0;for(let o=0,l=e.count;o<l;o++){let c=e.getX(o),u=e.getY(o),h=e.getZ(o);c<t&&(t=c),u<i&&(i=u),h<n&&(n=h),c>r&&(r=c),u>s&&(s=u),h>a&&(a=h)}return this.min.set(t,i,n),this.max.set(r,s,a),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let i=Ev.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);let i=e.geometry;if(i!==void 0)if(t&&i.attributes!=null&&i.attributes.position!==void 0){let r=i.attributes.position;for(let s=0,a=r.count;s<a;s++)Ev.fromBufferAttribute(r,s).applyMatrix4(e.matrixWorld),this.expandByPoint(Ev)}else i.boundingBox===null&&i.computeBoundingBox(),XB.copy(i.boundingBox),XB.applyMatrix4(e.matrixWorld),this.union(XB);let n=e.children;for(let r=0,s=n.length;r<s;r++)this.expandByObject(n[r],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Ev),Ev.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(w_),eT.subVectors(this.max,w_),_x.subVectors(e.a,w_),Ax.subVectors(e.b,w_),wx.subVectors(e.c,w_),um.subVectors(Ax,_x),hm.subVectors(wx,Ax),Tv.subVectors(_x,wx);let t=[0,-um.z,um.y,0,-hm.z,hm.y,0,-Tv.z,Tv.y,um.z,0,-um.x,hm.z,0,-hm.x,Tv.z,0,-Tv.x,-um.y,um.x,0,-hm.y,hm.x,0,-Tv.y,Tv.x,0];return!qB(t,_x,Ax,wx,eT)||(t=[1,0,0,0,1,0,0,0,1],!qB(t,_x,Ax,wx,eT))?!1:(tT.crossVectors(um,hm),t=[tT.x,tT.y,tT.z],qB(t,_x,Ax,wx,eT))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Ev.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=this.getSize(Ev).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(cf[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),cf[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),cf[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),cf[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),cf[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),cf[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),cf[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),cf[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(cf),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},cf=[new G,new G,new G,new G,new G,new G,new G,new G],Ev=new G,XB=new ps,_x=new G,Ax=new G,wx=new G,um=new G,hm=new G,Tv=new G,w_=new G,eT=new G,tT=new G,Cv=new G;function qB(e,t,i,n,r){for(let s=0,a=e.length-3;s<=a;s+=3){Cv.fromArray(e,s);let o=r.x*Math.abs(Cv.x)+r.y*Math.abs(Cv.y)+r.z*Math.abs(Cv.z),l=t.dot(Cv),c=i.dot(Cv),u=n.dot(Cv);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>o)return!1}return!0}var Abe=new ps,M_=new G,YB=new G,Ol=class{constructor(e=new G,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){let i=this.center;t!==void 0?i.copy(t):Abe.setFromPoints(e).getCenter(i);let n=0;for(let r=0,s=e.length;r<s;r++)n=Math.max(n,i.distanceToSquared(e[r]));return this.radius=Math.sqrt(n),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){let t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){let i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;M_.subVectors(e,this.center);let t=M_.lengthSq();if(t>this.radius*this.radius){let i=Math.sqrt(t),n=(i-this.radius)*.5;this.center.addScaledVector(M_,n/i),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(YB.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(M_.copy(e.center).add(YB)),this.expandByPoint(M_.copy(e.center).sub(YB))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}},uf=new G,QB=new G,iT=new G,dm=new G,KB=new G,nT=new G,JB=new G,Cb=class{constructor(e=new G,t=new G(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,uf)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);let i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){let t=uf.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(uf.copy(this.direction).multiplyScalar(t).add(this.origin),uf.distanceToSquared(e))}distanceSqToSegment(e,t,i,n){QB.copy(e).add(t).multiplyScalar(.5),iT.copy(t).sub(e).normalize(),dm.copy(this.origin).sub(QB);let r=e.distanceTo(t)*.5,s=-this.direction.dot(iT),a=dm.dot(this.direction),o=-dm.dot(iT),l=dm.lengthSq(),c=Math.abs(1-s*s),u,h,d,p;if(c>0)if(u=s*o-a,h=s*a-o,p=r*c,u>=0)if(h>=-p)if(h<=p){let g=1/c;u*=g,h*=g,d=u*(u+s*h+2*a)+h*(s*u+h+2*o)+l}else h=r,u=Math.max(0,-(s*h+a)),d=-u*u+h*(h+2*o)+l;else h=-r,u=Math.max(0,-(s*h+a)),d=-u*u+h*(h+2*o)+l;else h<=-p?(u=Math.max(0,-(-s*r+a)),h=u>0?-r:Math.min(Math.max(-r,-o),r),d=-u*u+h*(h+2*o)+l):h<=p?(u=0,h=Math.min(Math.max(-r,-o),r),d=h*(h+2*o)+l):(u=Math.max(0,-(s*r+a)),h=u>0?r:Math.min(Math.max(-r,-o),r),d=-u*u+h*(h+2*o)+l);else h=s>0?-r:r,u=Math.max(0,-(s*h+a)),d=-u*u+h*(h+2*o)+l;return i&&i.copy(this.direction).multiplyScalar(u).add(this.origin),n&&n.copy(iT).multiplyScalar(h).add(QB),d}intersectSphere(e,t){uf.subVectors(e.center,this.origin);let i=uf.dot(this.direction),n=uf.dot(uf)-i*i,r=e.radius*e.radius;if(n>r)return null;let s=Math.sqrt(r-n),a=i-s,o=i+s;return a<0&&o<0?null:a<0?this.at(o,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){let t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;let i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){let i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){let t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,n,r,s,a,o,l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(i=(e.min.x-h.x)*l,n=(e.max.x-h.x)*l):(i=(e.max.x-h.x)*l,n=(e.min.x-h.x)*l),c>=0?(r=(e.min.y-h.y)*c,s=(e.max.y-h.y)*c):(r=(e.max.y-h.y)*c,s=(e.min.y-h.y)*c),i>s||r>n||((r>i||isNaN(i))&&(i=r),(s<n||isNaN(n))&&(n=s),u>=0?(a=(e.min.z-h.z)*u,o=(e.max.z-h.z)*u):(a=(e.max.z-h.z)*u,o=(e.min.z-h.z)*u),i>o||a>n)||((a>i||i!==i)&&(i=a),(o<n||n!==n)&&(n=o),n<0)?null:this.at(i>=0?i:n,t)}intersectsBox(e){return this.intersectBox(e,uf)!==null}intersectTriangle(e,t,i,n,r){KB.subVectors(t,e),nT.subVectors(i,e),JB.crossVectors(KB,nT);let s=this.direction.dot(JB),a;if(s>0){if(n)return null;a=1}else if(s<0)a=-1,s=-s;else return null;dm.subVectors(this.origin,e);let o=a*this.direction.dot(nT.crossVectors(dm,nT));if(o<0)return null;let l=a*this.direction.dot(KB.cross(dm));if(l<0||o+l>s)return null;let c=-a*dm.dot(JB);return c<0?null:this.at(c/s,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},Bt=class{constructor(){Bt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,i,n,r,s,a,o,l,c,u,h,d,p,g,x){let y=this.elements;return y[0]=e,y[4]=t,y[8]=i,y[12]=n,y[1]=r,y[5]=s,y[9]=a,y[13]=o,y[2]=l,y[6]=c,y[10]=u,y[14]=h,y[3]=d,y[7]=p,y[11]=g,y[15]=x,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Bt().fromArray(this.elements)}copy(e){let t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){let t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){let t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){let t=this.elements,i=e.elements,n=1/Mx.setFromMatrixColumn(e,0).length(),r=1/Mx.setFromMatrixColumn(e,1).length(),s=1/Mx.setFromMatrixColumn(e,2).length();return t[0]=i[0]*n,t[1]=i[1]*n,t[2]=i[2]*n,t[3]=0,t[4]=i[4]*r,t[5]=i[5]*r,t[6]=i[6]*r,t[7]=0,t[8]=i[8]*s,t[9]=i[9]*s,t[10]=i[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){let t=this.elements,i=e.x,n=e.y,r=e.z,s=Math.cos(i),a=Math.sin(i),o=Math.cos(n),l=Math.sin(n),c=Math.cos(r),u=Math.sin(r);if(e.order==="XYZ"){let h=s*c,d=s*u,p=a*c,g=a*u;t[0]=o*c,t[4]=-o*u,t[8]=l,t[1]=d+p*l,t[5]=h-g*l,t[9]=-a*o,t[2]=g-h*l,t[6]=p+d*l,t[10]=s*o}else if(e.order==="YXZ"){let h=o*c,d=o*u,p=l*c,g=l*u;t[0]=h+g*a,t[4]=p*a-d,t[8]=s*l,t[1]=s*u,t[5]=s*c,t[9]=-a,t[2]=d*a-p,t[6]=g+h*a,t[10]=s*o}else if(e.order==="ZXY"){let h=o*c,d=o*u,p=l*c,g=l*u;t[0]=h-g*a,t[4]=-s*u,t[8]=p+d*a,t[1]=d+p*a,t[5]=s*c,t[9]=g-h*a,t[2]=-s*l,t[6]=a,t[10]=s*o}else if(e.order==="ZYX"){let h=s*c,d=s*u,p=a*c,g=a*u;t[0]=o*c,t[4]=p*l-d,t[8]=h*l+g,t[1]=o*u,t[5]=g*l+h,t[9]=d*l-p,t[2]=-l,t[6]=a*o,t[10]=s*o}else if(e.order==="YZX"){let h=s*o,d=s*l,p=a*o,g=a*l;t[0]=o*c,t[4]=g-h*u,t[8]=p*u+d,t[1]=u,t[5]=s*c,t[9]=-a*c,t[2]=-l*c,t[6]=d*u+p,t[10]=h-g*u}else if(e.order==="XZY"){let h=s*o,d=s*l,p=a*o,g=a*l;t[0]=o*c,t[4]=-u,t[8]=l*c,t[1]=h*u+g,t[5]=s*c,t[9]=d*u-p,t[2]=p*u-d,t[6]=a*c,t[10]=g*u+h}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(wbe,e,Mbe)}lookAt(e,t,i){let n=this.elements;return Yl.subVectors(e,t),Yl.lengthSq()===0&&(Yl.z=1),Yl.normalize(),fm.crossVectors(i,Yl),fm.lengthSq()===0&&(Math.abs(i.z)===1?Yl.x+=1e-4:Yl.z+=1e-4,Yl.normalize(),fm.crossVectors(i,Yl)),fm.normalize(),rT.crossVectors(Yl,fm),n[0]=fm.x,n[4]=rT.x,n[8]=Yl.x,n[1]=fm.y,n[5]=rT.y,n[9]=Yl.y,n[2]=fm.z,n[6]=rT.z,n[10]=Yl.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let i=e.elements,n=t.elements,r=this.elements,s=i[0],a=i[4],o=i[8],l=i[12],c=i[1],u=i[5],h=i[9],d=i[13],p=i[2],g=i[6],x=i[10],y=i[14],b=i[3],A=i[7],w=i[11],E=i[15],D=n[0],T=n[4],I=n[8],R=n[12],O=n[1],P=n[5],U=n[9],H=n[13],V=n[2],j=n[6],J=n[10],F=n[14],X=n[3],W=n[7],ne=n[11],Y=n[15];return r[0]=s*D+a*O+o*V+l*X,r[4]=s*T+a*P+o*j+l*W,r[8]=s*I+a*U+o*J+l*ne,r[12]=s*R+a*H+o*F+l*Y,r[1]=c*D+u*O+h*V+d*X,r[5]=c*T+u*P+h*j+d*W,r[9]=c*I+u*U+h*J+d*ne,r[13]=c*R+u*H+h*F+d*Y,r[2]=p*D+g*O+x*V+y*X,r[6]=p*T+g*P+x*j+y*W,r[10]=p*I+g*U+x*J+y*ne,r[14]=p*R+g*H+x*F+y*Y,r[3]=b*D+A*O+w*V+E*X,r[7]=b*T+A*P+w*j+E*W,r[11]=b*I+A*U+w*J+E*ne,r[15]=b*R+A*H+w*F+E*Y,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){let e=this.elements,t=e[0],i=e[4],n=e[8],r=e[12],s=e[1],a=e[5],o=e[9],l=e[13],c=e[2],u=e[6],h=e[10],d=e[14],p=e[3],g=e[7],x=e[11],y=e[15];return p*(+r*o*u-n*l*u-r*a*h+i*l*h+n*a*d-i*o*d)+g*(+t*o*d-t*l*h+r*s*h-n*s*d+n*l*c-r*o*c)+x*(+t*l*u-t*a*d-r*s*u+i*s*d+r*a*c-i*l*c)+y*(-n*a*c-t*o*u+t*a*h+n*s*u-i*s*h+i*o*c)}transpose(){let e=this.elements,t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){let n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=t,n[14]=i),this}invert(){let e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],p=e[12],g=e[13],x=e[14],y=e[15],b=u*x*l-g*h*l+g*o*d-a*x*d-u*o*y+a*h*y,A=p*h*l-c*x*l-p*o*d+s*x*d+c*o*y-s*h*y,w=c*g*l-p*u*l+p*a*d-s*g*d-c*a*y+s*u*y,E=p*u*o-c*g*o-p*a*h+s*g*h+c*a*x-s*u*x,D=t*b+i*A+n*w+r*E;if(D===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let T=1/D;return e[0]=b*T,e[1]=(g*h*r-u*x*r-g*n*d+i*x*d+u*n*y-i*h*y)*T,e[2]=(a*x*r-g*o*r+g*n*l-i*x*l-a*n*y+i*o*y)*T,e[3]=(u*o*r-a*h*r-u*n*l+i*h*l+a*n*d-i*o*d)*T,e[4]=A*T,e[5]=(c*x*r-p*h*r+p*n*d-t*x*d-c*n*y+t*h*y)*T,e[6]=(p*o*r-s*x*r-p*n*l+t*x*l+s*n*y-t*o*y)*T,e[7]=(s*h*r-c*o*r+c*n*l-t*h*l-s*n*d+t*o*d)*T,e[8]=w*T,e[9]=(p*u*r-c*g*r-p*i*d+t*g*d+c*i*y-t*u*y)*T,e[10]=(s*g*r-p*a*r+p*i*l-t*g*l-s*i*y+t*a*y)*T,e[11]=(c*a*r-s*u*r-c*i*l+t*u*l+s*i*d-t*a*d)*T,e[12]=E*T,e[13]=(c*g*n-p*u*n+p*i*h-t*g*h-c*i*x+t*u*x)*T,e[14]=(p*a*n-s*g*n-p*i*o+t*g*o+s*i*x-t*a*x)*T,e[15]=(s*u*n-c*a*n+c*i*o-t*u*o-s*i*h+t*a*h)*T,this}scale(e){let t=this.elements,i=e.x,n=e.y,r=e.z;return t[0]*=i,t[4]*=n,t[8]*=r,t[1]*=i,t[5]*=n,t[9]*=r,t[2]*=i,t[6]*=n,t[10]*=r,t[3]*=i,t[7]*=n,t[11]*=r,this}getMaxScaleOnAxis(){let e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,n))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){let t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){let i=Math.cos(t),n=Math.sin(t),r=1-i,s=e.x,a=e.y,o=e.z,l=r*s,c=r*a;return this.set(l*s+i,l*a-n*o,l*o+n*a,0,l*a+n*o,c*a+i,c*o-n*s,0,l*o-n*a,c*o+n*s,r*o*o+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,n,r,s){return this.set(1,i,r,0,e,1,s,0,t,n,1,0,0,0,0,1),this}compose(e,t,i){let n=this.elements,r=t._x,s=t._y,a=t._z,o=t._w,l=r+r,c=s+s,u=a+a,h=r*l,d=r*c,p=r*u,g=s*c,x=s*u,y=a*u,b=o*l,A=o*c,w=o*u,E=i.x,D=i.y,T=i.z;return n[0]=(1-(g+y))*E,n[1]=(d+w)*E,n[2]=(p-A)*E,n[3]=0,n[4]=(d-w)*D,n[5]=(1-(h+y))*D,n[6]=(x+b)*D,n[7]=0,n[8]=(p+A)*T,n[9]=(x-b)*T,n[10]=(1-(h+g))*T,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}decompose(e,t,i){let n=this.elements,r=Mx.set(n[0],n[1],n[2]).length(),s=Mx.set(n[4],n[5],n[6]).length(),a=Mx.set(n[8],n[9],n[10]).length();this.determinant()<0&&(r=-r),e.x=n[12],e.y=n[13],e.z=n[14],Ru.copy(this);let o=1/r,l=1/s,c=1/a;return Ru.elements[0]*=o,Ru.elements[1]*=o,Ru.elements[2]*=o,Ru.elements[4]*=l,Ru.elements[5]*=l,Ru.elements[6]*=l,Ru.elements[8]*=c,Ru.elements[9]*=c,Ru.elements[10]*=c,t.setFromRotationMatrix(Ru),i.x=r,i.y=s,i.z=a,this}makePerspective(e,t,i,n,r,s){let a=this.elements,o=2*r/(t-e),l=2*r/(i-n),c=(t+e)/(t-e),u=(i+n)/(i-n),h=-(s+r)/(s-r),d=-2*s*r/(s-r);return a[0]=o,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=l,a[9]=u,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=d,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,i,n,r,s){let a=this.elements,o=1/(t-e),l=1/(i-n),c=1/(s-r),u=(t+e)*o,h=(i+n)*l,d=(s+r)*c;return a[0]=2*o,a[4]=0,a[8]=0,a[12]=-u,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*c,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){let t=this.elements,i=e.elements;for(let n=0;n<16;n++)if(t[n]!==i[n])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){let i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}},Mx=new G,Ru=new Bt,wbe=new G(0,0,0),Mbe=new G(1,1,1),fm=new G,rT=new G,Yl=new G,A8=new Bt,w8=new Ei,qs=class{constructor(e=0,t=0,i=0,n=qs.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=n}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,n=this._order){return this._x=e,this._y=t,this._z=i,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){let n=e.elements,r=n[0],s=n[4],a=n[8],o=n[1],l=n[5],c=n[9],u=n[2],h=n[6],d=n[10];switch(t){case"XYZ":this._y=Math.asin(Es(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Es(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-u,r),this._z=0);break;case"ZXY":this._x=Math.asin(Es(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(o,r));break;case"ZYX":this._y=Math.asin(-Es(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(o,r)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(Es(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,r)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-Es(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return A8.makeRotationFromQuaternion(e),this.setFromRotationMatrix(A8,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return w8.setFromEuler(this),this.setFromQuaternion(w8,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};qs.DEFAULT_ORDER="XYZ";var P4=class{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}},Ebe=0,M8=new G,Ex=new Ei,hf=new Bt,sT=new G,E_=new G,Tbe=new G,Cbe=new Ei,E8=new G(1,0,0),T8=new G(0,1,0),C8=new G(0,0,1),Dbe={type:"added"},D8={type:"removed"},kn=class extends Ka{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Ebe++}),this.uuid=qc(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=kn.DEFAULT_UP.clone();let e=new G,t=new qs,i=new Ei,n=new G(1,1,1);function r(){i.setFromEuler(t,!1)}function s(){t.setFromQuaternion(i,void 0,!1)}t._onChange(r),i._onChange(s),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new Bt},normalMatrix:{value:new Cs}}),this.matrix=new Bt,this.matrixWorld=new Bt,this.matrixAutoUpdate=kn.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=kn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new P4,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Ex.setFromAxisAngle(e,t),this.quaternion.multiply(Ex),this}rotateOnWorldAxis(e,t){return Ex.setFromAxisAngle(e,t),this.quaternion.premultiply(Ex),this}rotateX(e){return this.rotateOnAxis(E8,e)}rotateY(e){return this.rotateOnAxis(T8,e)}rotateZ(e){return this.rotateOnAxis(C8,e)}translateOnAxis(e,t){return M8.copy(e).applyQuaternion(this.quaternion),this.position.add(M8.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(E8,e)}translateY(e){return this.translateOnAxis(T8,e)}translateZ(e){return this.translateOnAxis(C8,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(hf.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?sT.copy(e):sT.set(e,t,i);let n=this.parent;this.updateWorldMatrix(!0,!1),E_.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?hf.lookAt(E_,sT,this.up):hf.lookAt(sT,E_,this.up),this.quaternion.setFromRotationMatrix(hf),n&&(hf.extractRotation(n.matrixWorld),Ex.setFromRotationMatrix(hf),this.quaternion.premultiply(Ex.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Dbe)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}let t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(D8)),this}removeFromParent(){let e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){let t=this.children[e];t.parent=null,t.dispatchEvent(D8)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),hf.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),hf.multiply(e.parent.matrixWorld)),e.applyMatrix4(hf),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,n=this.children.length;i<n;i++){let r=this.children[i].getObjectByProperty(e,t);if(r!==void 0)return r}}getObjectsByProperty(e,t){let i=[];this[e]===t&&i.push(this);for(let n=0,r=this.children.length;n<r;n++){let s=this.children[n].getObjectsByProperty(e,t);s.length>0&&(i=i.concat(s))}return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(E_,e,Tbe),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(E_,Cbe,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);let t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);let t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverseVisible(e)}traverseAncestors(e){let t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);let t=this.children;for(let i=0,n=t.length;i<n;i++){let r=t[i];(r.matrixWorldAutoUpdate===!0||e===!0)&&r.updateMatrixWorld(e)}}updateWorldMatrix(e,t){let i=this.parent;if(e===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){let n=this.children;for(let r=0,s=n.length;r<s;r++){let a=n[r];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(e){let t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});let n={};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.castShadow===!0&&(n.castShadow=!0),this.receiveShadow===!0&&(n.receiveShadow=!0),this.visible===!1&&(n.visible=!1),this.frustumCulled===!1&&(n.frustumCulled=!1),this.renderOrder!==0&&(n.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(n.instanceColor=this.instanceColor.toJSON()));function r(a,o){return a[o.uuid]===void 0&&(a[o.uuid]=o.toJSON(e)),o.uuid}if(this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(n.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=r(e.geometries,this.geometry);let a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){let o=a.shapes;if(Array.isArray(o))for(let l=0,c=o.length;l<c;l++){let u=o[l];r(e.shapes,u)}else r(e.shapes,o)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(e.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){let a=[];for(let o=0,l=this.material.length;o<l;o++)a.push(r(e.materials,this.material[o]));n.material=a}else n.material=r(e.materials,this.material);if(this.children.length>0){n.children=[];for(let a=0;a<this.children.length;a++)n.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){n.animations=[];for(let a=0;a<this.animations.length;a++){let o=this.animations[a];n.animations.push(r(e.animations,o))}}if(t){let a=s(e.geometries),o=s(e.materials),l=s(e.textures),c=s(e.images),u=s(e.shapes),h=s(e.skeletons),d=s(e.animations),p=s(e.nodes);a.length>0&&(i.geometries=a),o.length>0&&(i.materials=o),l.length>0&&(i.textures=l),c.length>0&&(i.images=c),u.length>0&&(i.shapes=u),h.length>0&&(i.skeletons=h),d.length>0&&(i.animations=d),p.length>0&&(i.nodes=p)}return i.object=n,i;function s(a){let o=[];for(let l in a){let c=a[l];delete c.metadata,o.push(c)}return o}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){let n=e.children[i];this.add(n.clone())}return this}};kn.DEFAULT_UP=new G(0,1,0);kn.DEFAULT_MATRIX_AUTO_UPDATE=!0;kn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;var Pu=new G,df=new G,ZB=new G,ff=new G,Tx=new G,Cx=new G,R8=new G,$B=new G,eI=new G,tI=new G,ka=class{constructor(e=new G,t=new G,i=new G){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,n){n.subVectors(i,t),Pu.subVectors(e,t),n.cross(Pu);let r=n.lengthSq();return r>0?n.multiplyScalar(1/Math.sqrt(r)):n.set(0,0,0)}static getBarycoord(e,t,i,n,r){Pu.subVectors(n,t),df.subVectors(i,t),ZB.subVectors(e,t);let s=Pu.dot(Pu),a=Pu.dot(df),o=Pu.dot(ZB),l=df.dot(df),c=df.dot(ZB),u=s*l-a*a;if(u===0)return r.set(-2,-1,-1);let h=1/u,d=(l*o-a*c)*h,p=(s*c-a*o)*h;return r.set(1-d-p,p,d)}static containsPoint(e,t,i,n){return this.getBarycoord(e,t,i,n,ff),ff.x>=0&&ff.y>=0&&ff.x+ff.y<=1}static getUV(e,t,i,n,r,s,a,o){return this.getBarycoord(e,t,i,n,ff),o.set(0,0),o.addScaledVector(r,ff.x),o.addScaledVector(s,ff.y),o.addScaledVector(a,ff.z),o}static isFrontFacing(e,t,i,n){return Pu.subVectors(i,t),df.subVectors(e,t),Pu.cross(df).dot(n)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,n){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[n]),this}setFromAttributeAndIndices(e,t,i,n){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Pu.subVectors(this.c,this.b),df.subVectors(this.a,this.b),Pu.cross(df).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return ka.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return ka.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,n,r){return ka.getUV(e,this.a,this.b,this.c,t,i,n,r)}containsPoint(e){return ka.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return ka.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){let i=this.a,n=this.b,r=this.c,s,a;Tx.subVectors(n,i),Cx.subVectors(r,i),$B.subVectors(e,i);let o=Tx.dot($B),l=Cx.dot($B);if(o<=0&&l<=0)return t.copy(i);eI.subVectors(e,n);let c=Tx.dot(eI),u=Cx.dot(eI);if(c>=0&&u<=c)return t.copy(n);let h=o*u-c*l;if(h<=0&&o>=0&&c<=0)return s=o/(o-c),t.copy(i).addScaledVector(Tx,s);tI.subVectors(e,r);let d=Tx.dot(tI),p=Cx.dot(tI);if(p>=0&&d<=p)return t.copy(r);let g=d*l-o*p;if(g<=0&&l>=0&&p<=0)return a=l/(l-p),t.copy(i).addScaledVector(Cx,a);let x=c*p-d*u;if(x<=0&&u-c>=0&&d-p>=0)return R8.subVectors(r,n),a=(u-c)/(u-c+(d-p)),t.copy(n).addScaledVector(R8,a);let y=1/(x+g+h);return s=g*y,a=h*y,t.copy(i).addScaledVector(Tx,s).addScaledVector(Cx,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}},Rbe=0,sM=class extends Ka{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Rbe++}),this.uuid=qc(),this.name="",this.type="Material",this.blending=x0,this.side=Zu,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=IJ,this.blendDst=LJ,this.blendEquation=Zx,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=NU,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=rbe,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=VB,this.stencilZFail=VB,this.stencilZPass=VB,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(let t in e){let i=e[t];if(i===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}let n=this[t];if(n===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[t]=i}}toJSON(e){let t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});let i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==x0&&(i.blending=this.blending),this.side!==Zu&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(i.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(i.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=this.flatShading),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function n(r){let s=[];for(let a in r){let o=r[a];delete o.metadata,s.push(o)}return s}if(t){let r=n(e.textures),s=n(e.images);r.length>0&&(i.textures=r),s.length>0&&(i.images=s)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;let t=e.clippingPlanes,i=null;if(t!==null){let n=t.length;i=new Array(n);for(let r=0;r!==n;++r)i[r]=t[r].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}},np=class extends sM{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new gi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=UJ,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}},ws=new G,aT=new Ae,vi=class{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=HU,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let n=0,r=this.itemSize;n<r;n++)this.array[e+n]=t.array[i+n];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)aT.fromBufferAttribute(this,t),aT.applyMatrix3(e),this.setXY(t,aT.x,aT.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)ws.fromBufferAttribute(this,t),ws.applyMatrix3(e),this.setXYZ(t,ws.x,ws.y,ws.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)ws.fromBufferAttribute(this,t),ws.applyMatrix4(e),this.setXYZ(t,ws.x,ws.y,ws.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)ws.fromBufferAttribute(this,t),ws.applyNormalMatrix(e),this.setXYZ(t,ws.x,ws.y,ws.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)ws.fromBufferAttribute(this,t),ws.transformDirection(e),this.setXYZ(t,ws.x,ws.y,ws.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Vf(t,this.array)),t}setX(e,t){return this.normalized&&(t=dr(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Vf(t,this.array)),t}setY(e,t){return this.normalized&&(t=dr(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Vf(t,this.array)),t}setZ(e,t){return this.normalized&&(t=dr(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Vf(t,this.array)),t}setW(e,t){return this.normalized&&(t=dr(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=dr(t,this.array),i=dr(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,n){return e*=this.itemSize,this.normalized&&(t=dr(t,this.array),i=dr(i,this.array),n=dr(n,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this}setXYZW(e,t,i,n,r){return e*=this.itemSize,this.normalized&&(t=dr(t,this.array),i=dr(i,this.array),n=dr(n,this.array),r=dr(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==HU&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}},KJ=class extends vi{constructor(e,t,i){super(new Uint16Array(e),t,i)}},M1=class extends vi{constructor(e,t,i){super(new Uint32Array(e),t,i)}},Gt=class extends vi{constructor(e,t,i){super(new Float32Array(e),t,i)}},Pbe=0,Cc=new Bt,iI=new kn,Dx=new G,Ql=new ps,T_=new ps,ca=new G,ii=class extends Ka{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Pbe++}),this.uuid=qc(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(jJ(e)?M1:KJ)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){let t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);let i=this.attributes.normal;if(i!==void 0){let r=new Cs().getNormalMatrix(e);i.applyNormalMatrix(r),i.needsUpdate=!0}let n=this.attributes.tangent;return n!==void 0&&(n.transformDirection(e),n.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Cc.makeRotationFromQuaternion(e),this.applyMatrix4(Cc),this}rotateX(e){return Cc.makeRotationX(e),this.applyMatrix4(Cc),this}rotateY(e){return Cc.makeRotationY(e),this.applyMatrix4(Cc),this}rotateZ(e){return Cc.makeRotationZ(e),this.applyMatrix4(Cc),this}translate(e,t,i){return Cc.makeTranslation(e,t,i),this.applyMatrix4(Cc),this}scale(e,t,i){return Cc.makeScale(e,t,i),this.applyMatrix4(Cc),this}lookAt(e){return iI.lookAt(e),iI.updateMatrix(),this.applyMatrix4(iI.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Dx).negate(),this.translate(Dx.x,Dx.y,Dx.z),this}setFromPoints(e){let t=[];for(let i=0,n=e.length;i<n;i++){let r=e[i];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new Gt(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ps);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new G(-1/0,-1/0,-1/0),new G(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,n=t.length;i<n;i++){let r=t[i];Ql.setFromBufferAttribute(r),this.morphTargetsRelative?(ca.addVectors(this.boundingBox.min,Ql.min),this.boundingBox.expandByPoint(ca),ca.addVectors(this.boundingBox.max,Ql.max),this.boundingBox.expandByPoint(ca)):(this.boundingBox.expandByPoint(Ql.min),this.boundingBox.expandByPoint(Ql.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ol);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new G,1/0);return}if(e){let i=this.boundingSphere.center;if(Ql.setFromBufferAttribute(e),t)for(let r=0,s=t.length;r<s;r++){let a=t[r];T_.setFromBufferAttribute(a),this.morphTargetsRelative?(ca.addVectors(Ql.min,T_.min),Ql.expandByPoint(ca),ca.addVectors(Ql.max,T_.max),Ql.expandByPoint(ca)):(Ql.expandByPoint(T_.min),Ql.expandByPoint(T_.max))}Ql.getCenter(i);let n=0;for(let r=0,s=e.count;r<s;r++)ca.fromBufferAttribute(e,r),n=Math.max(n,i.distanceToSquared(ca));if(t)for(let r=0,s=t.length;r<s;r++){let a=t[r],o=this.morphTargetsRelative;for(let l=0,c=a.count;l<c;l++)ca.fromBufferAttribute(a,l),o&&(Dx.fromBufferAttribute(e,l),ca.add(Dx)),n=Math.max(n,i.distanceToSquared(ca))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let i=e.array,n=t.position.array,r=t.normal.array,s=t.uv.array,a=n.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new vi(new Float32Array(4*a),4));let o=this.getAttribute("tangent").array,l=[],c=[];for(let O=0;O<a;O++)l[O]=new G,c[O]=new G;let u=new G,h=new G,d=new G,p=new Ae,g=new Ae,x=new Ae,y=new G,b=new G;function A(O,P,U){u.fromArray(n,O*3),h.fromArray(n,P*3),d.fromArray(n,U*3),p.fromArray(s,O*2),g.fromArray(s,P*2),x.fromArray(s,U*2),h.sub(u),d.sub(u),g.sub(p),x.sub(p);let H=1/(g.x*x.y-x.x*g.y);!isFinite(H)||(y.copy(h).multiplyScalar(x.y).addScaledVector(d,-g.y).multiplyScalar(H),b.copy(d).multiplyScalar(g.x).addScaledVector(h,-x.x).multiplyScalar(H),l[O].add(y),l[P].add(y),l[U].add(y),c[O].add(b),c[P].add(b),c[U].add(b))}let w=this.groups;w.length===0&&(w=[{start:0,count:i.length}]);for(let O=0,P=w.length;O<P;++O){let U=w[O],H=U.start,V=U.count;for(let j=H,J=H+V;j<J;j+=3)A(i[j+0],i[j+1],i[j+2])}let E=new G,D=new G,T=new G,I=new G;function R(O){T.fromArray(r,O*3),I.copy(T);let P=l[O];E.copy(P),E.sub(T.multiplyScalar(T.dot(P))).normalize(),D.crossVectors(I,P);let U=D.dot(c[O])<0?-1:1;o[O*4]=E.x,o[O*4+1]=E.y,o[O*4+2]=E.z,o[O*4+3]=U}for(let O=0,P=w.length;O<P;++O){let U=w[O],H=U.start,V=U.count;for(let j=H,J=H+V;j<J;j+=3)R(i[j+0]),R(i[j+1]),R(i[j+2])}}computeVertexNormals(){let e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new vi(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let h=0,d=i.count;h<d;h++)i.setXYZ(h,0,0,0);let n=new G,r=new G,s=new G,a=new G,o=new G,l=new G,c=new G,u=new G;if(e)for(let h=0,d=e.count;h<d;h+=3){let p=e.getX(h+0),g=e.getX(h+1),x=e.getX(h+2);n.fromBufferAttribute(t,p),r.fromBufferAttribute(t,g),s.fromBufferAttribute(t,x),c.subVectors(s,r),u.subVectors(n,r),c.cross(u),a.fromBufferAttribute(i,p),o.fromBufferAttribute(i,g),l.fromBufferAttribute(i,x),a.add(c),o.add(c),l.add(c),i.setXYZ(p,a.x,a.y,a.z),i.setXYZ(g,o.x,o.y,o.z),i.setXYZ(x,l.x,l.y,l.z)}else for(let h=0,d=t.count;h<d;h+=3)n.fromBufferAttribute(t,h+0),r.fromBufferAttribute(t,h+1),s.fromBufferAttribute(t,h+2),c.subVectors(s,r),u.subVectors(n,r),c.cross(u),i.setXYZ(h+0,c.x,c.y,c.z),i.setXYZ(h+1,c.x,c.y,c.z),i.setXYZ(h+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){let e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)ca.fromBufferAttribute(e,t),ca.normalize(),e.setXYZ(t,ca.x,ca.y,ca.z)}toNonIndexed(){function e(a,o){let l=a.array,c=a.itemSize,u=a.normalized,h=new l.constructor(o.length*c),d=0,p=0;for(let g=0,x=o.length;g<x;g++){a.isInterleavedBufferAttribute?d=o[g]*a.data.stride+a.offset:d=o[g]*c;for(let y=0;y<c;y++)h[p++]=l[d++]}return new vi(h,c,u)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let t=new ii,i=this.index.array,n=this.attributes;for(let a in n){let o=n[a],l=e(o,i);t.setAttribute(a,l)}let r=this.morphAttributes;for(let a in r){let o=[],l=r[a];for(let c=0,u=l.length;c<u;c++){let h=l[c],d=e(h,i);o.push(d)}t.morphAttributes[a]=o}t.morphTargetsRelative=this.morphTargetsRelative;let s=this.groups;for(let a=0,o=s.length;a<o;a++){let l=s[a];t.addGroup(l.start,l.count,l.materialIndex)}return t}toJSON(){let e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){let o=this.parameters;for(let l in o)o[l]!==void 0&&(e[l]=o[l]);return e}e.data={attributes:{}};let t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});let i=this.attributes;for(let o in i){let l=i[o];e.data.attributes[o]=l.toJSON(e.data)}let n={},r=!1;for(let o in this.morphAttributes){let l=this.morphAttributes[o],c=[];for(let u=0,h=l.length;u<h;u++){let d=l[u];c.push(d.toJSON(e.data))}c.length>0&&(n[o]=c,r=!0)}r&&(e.data.morphAttributes=n,e.data.morphTargetsRelative=this.morphTargetsRelative);let s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));let a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let t={};this.name=e.name;let i=e.index;i!==null&&this.setIndex(i.clone(t));let n=e.attributes;for(let l in n){let c=n[l];this.setAttribute(l,c.clone(t))}let r=e.morphAttributes;for(let l in r){let c=[],u=r[l];for(let h=0,d=u.length;h<d;h++)c.push(u[h].clone(t));this.morphAttributes[l]=c}this.morphTargetsRelative=e.morphTargetsRelative;let s=e.groups;for(let l=0,c=s.length;l<c;l++){let u=s[l];this.addGroup(u.start,u.count,u.materialIndex)}let a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());let o=e.boundingSphere;return o!==null&&(this.boundingSphere=o.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,e.parameters!==void 0&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}},P8=new Bt,Rx=new Cb,nI=new Ol,C_=new G,D_=new G,R_=new G,rI=new G,oT=new G,lT=new Ae,cT=new Ae,uT=new Ae,sI=new G,hT=new G,fr=class extends kn{constructor(e=new ii,t=new np){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let i=e[t[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let n=0,r=i.length;n<r;n++){let s=i[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=n}}}}getVertexPosition(e,t){let i=this.geometry,n=i.attributes.position,r=i.morphAttributes.position,s=i.morphTargetsRelative;t.fromBufferAttribute(n,e);let a=this.morphTargetInfluences;if(r&&a){oT.set(0,0,0);for(let o=0,l=r.length;o<l;o++){let c=a[o],u=r[o];c!==0&&(rI.fromBufferAttribute(u,e),s?oT.addScaledVector(rI,c):oT.addScaledVector(rI.sub(t),c))}t.add(oT)}return this.isSkinnedMesh&&this.boneTransform(e,t),t}raycast(e,t){let i=this.geometry,n=this.material,r=this.matrixWorld;if(n===void 0||(i.boundingSphere===null&&i.computeBoundingSphere(),nI.copy(i.boundingSphere),nI.applyMatrix4(r),e.ray.intersectsSphere(nI)===!1)||(P8.copy(r).invert(),Rx.copy(e.ray).applyMatrix4(P8),i.boundingBox!==null&&Rx.intersectsBox(i.boundingBox)===!1))return;let s,a=i.index,o=i.attributes.position,l=i.attributes.uv,c=i.attributes.uv2,u=i.groups,h=i.drawRange;if(a!==null)if(Array.isArray(n))for(let d=0,p=u.length;d<p;d++){let g=u[d],x=n[g.materialIndex],y=Math.max(g.start,h.start),b=Math.min(a.count,Math.min(g.start+g.count,h.start+h.count));for(let A=y,w=b;A<w;A+=3){let E=a.getX(A),D=a.getX(A+1),T=a.getX(A+2);s=dT(this,x,e,Rx,l,c,E,D,T),s&&(s.faceIndex=Math.floor(A/3),s.face.materialIndex=g.materialIndex,t.push(s))}}else{let d=Math.max(0,h.start),p=Math.min(a.count,h.start+h.count);for(let g=d,x=p;g<x;g+=3){let y=a.getX(g),b=a.getX(g+1),A=a.getX(g+2);s=dT(this,n,e,Rx,l,c,y,b,A),s&&(s.faceIndex=Math.floor(g/3),t.push(s))}}else if(o!==void 0)if(Array.isArray(n))for(let d=0,p=u.length;d<p;d++){let g=u[d],x=n[g.materialIndex],y=Math.max(g.start,h.start),b=Math.min(o.count,Math.min(g.start+g.count,h.start+h.count));for(let A=y,w=b;A<w;A+=3){let E=A,D=A+1,T=A+2;s=dT(this,x,e,Rx,l,c,E,D,T),s&&(s.faceIndex=Math.floor(A/3),s.face.materialIndex=g.materialIndex,t.push(s))}}else{let d=Math.max(0,h.start),p=Math.min(o.count,h.start+h.count);for(let g=d,x=p;g<x;g+=3){let y=g,b=g+1,A=g+2;s=dT(this,n,e,Rx,l,c,y,b,A),s&&(s.faceIndex=Math.floor(g/3),t.push(s))}}}};function Obe(e,t,i,n,r,s,a,o){let l;if(t.side===va?l=n.intersectTriangle(a,s,r,!0,o):l=n.intersectTriangle(r,s,a,t.side===Zu,o),l===null)return null;hT.copy(o),hT.applyMatrix4(e.matrixWorld);let c=i.ray.origin.distanceTo(hT);return c<i.near||c>i.far?null:{distance:c,point:hT.clone(),object:e}}function dT(e,t,i,n,r,s,a,o,l){e.getVertexPosition(a,C_),e.getVertexPosition(o,D_),e.getVertexPosition(l,R_);let c=Obe(e,t,i,n,C_,D_,R_,sI);if(c){r&&(lT.fromBufferAttribute(r,a),cT.fromBufferAttribute(r,o),uT.fromBufferAttribute(r,l),c.uv=ka.getUV(sI,C_,D_,R_,lT,cT,uT,new Ae)),s&&(lT.fromBufferAttribute(s,a),cT.fromBufferAttribute(s,o),uT.fromBufferAttribute(s,l),c.uv2=ka.getUV(sI,C_,D_,R_,lT,cT,uT,new Ae));let u={a,b:o,c:l,normal:new G,materialIndex:0};ka.getNormal(C_,D_,R_,u.normal),c.face=u}return c}var eh=class extends ii{constructor(e=1,t=1,i=1,n=1,r=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:n,heightSegments:r,depthSegments:s};let a=this;n=Math.floor(n),r=Math.floor(r),s=Math.floor(s);let o=[],l=[],c=[],u=[],h=0,d=0;p("z","y","x",-1,-1,i,t,e,s,r,0),p("z","y","x",1,-1,i,t,-e,s,r,1),p("x","z","y",1,1,e,i,t,n,s,2),p("x","z","y",1,-1,e,i,-t,n,s,3),p("x","y","z",1,-1,e,t,i,n,r,4),p("x","y","z",-1,-1,e,t,-i,n,r,5),this.setIndex(o),this.setAttribute("position",new Gt(l,3)),this.setAttribute("normal",new Gt(c,3)),this.setAttribute("uv",new Gt(u,2));function p(g,x,y,b,A,w,E,D,T,I,R){let O=w/T,P=E/I,U=w/2,H=E/2,V=D/2,j=T+1,J=I+1,F=0,X=0,W=new G;for(let ne=0;ne<J;ne++){let Y=ne*P-H;for(let $=0;$<j;$++){let se=$*O-U;W[g]=se*b,W[x]=Y*A,W[y]=V,l.push(W.x,W.y,W.z),W[g]=0,W[x]=0,W[y]=D>0?1:-1,c.push(W.x,W.y,W.z),u.push($/T),u.push(1-ne/I),F+=1}}for(let ne=0;ne<I;ne++)for(let Y=0;Y<T;Y++){let $=h+Y+j*ne,se=h+Y+j*(ne+1),fe=h+(Y+1)+j*(ne+1),te=h+(Y+1)+j*ne;o.push($,se,te),o.push(se,fe,te),X+=6}a.addGroup(d,X,R),d+=X,h+=F}}static fromJSON(e){return new eh(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}};function eb(e){let t={};for(let i in e){t[i]={};for(let n in e[i]){let r=e[i][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?t[i][n]=r.clone():Array.isArray(r)?t[i][n]=r.slice():t[i][n]=r}}return t}function Wo(e){let t={};for(let i=0;i<e.length;i++){let n=eb(e[i]);for(let r in n)t[r]=n[r]}return t}function Bbe(e){let t=[];for(let i=0;i<e.length;i++)t.push(e[i].clone());return t}function JJ(e){return e.getRenderTarget()===null&&e.outputEncoding===Gi?td:$D}var Db={clone:eb,merge:Wo},Ibe=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Lbe=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,vn=class extends sM{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=Ibe,this.fragmentShader=Lbe,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=eb(e.uniforms),this.uniformsGroups=Bbe(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){let t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(let n in this.uniforms){let r=this.uniforms[n].value;r&&r.isTexture?t.uniforms[n]={type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?t.uniforms[n]={type:"c",value:r.getHex()}:r&&r.isVector2?t.uniforms[n]={type:"v2",value:r.toArray()}:r&&r.isVector3?t.uniforms[n]={type:"v3",value:r.toArray()}:r&&r.isVector4?t.uniforms[n]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?t.uniforms[n]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?t.uniforms[n]={type:"m4",value:r.toArray()}:t.uniforms[n]={value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;let i={};for(let n in this.extensions)this.extensions[n]===!0&&(i[n]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}},mg=class extends kn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Bt,this.projectionMatrix=new Bt,this.projectionMatrixInverse=new Bt}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}},po=class extends mg{constructor(e=50,t=1,i=.1,n=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){let t=.5*this.getFilmHeight()/e;this.fov=fw*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){let e=Math.tan(PA*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return fw*2*Math.atan(Math.tan(PA*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,n,r,s){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=this.near,t=e*Math.tan(PA*.5*this.fov)/this.zoom,i=2*t,n=this.aspect*i,r=-.5*n,s=this.view;if(this.view!==null&&this.view.enabled){let o=s.fullWidth,l=s.fullHeight;r+=s.offsetX*n/o,t-=s.offsetY*i/l,n*=s.width/o,i*=s.height/l}let a=this.filmOffset;a!==0&&(r+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+n,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}},Px=-90,Ox=1,Ube=class extends kn{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i;let n=new po(Px,Ox,e,t);n.layers=this.layers,n.up.set(0,1,0),n.lookAt(1,0,0),this.add(n);let r=new po(Px,Ox,e,t);r.layers=this.layers,r.up.set(0,1,0),r.lookAt(-1,0,0),this.add(r);let s=new po(Px,Ox,e,t);s.layers=this.layers,s.up.set(0,0,-1),s.lookAt(0,1,0),this.add(s);let a=new po(Px,Ox,e,t);a.layers=this.layers,a.up.set(0,0,1),a.lookAt(0,-1,0),this.add(a);let o=new po(Px,Ox,e,t);o.layers=this.layers,o.up.set(0,1,0),o.lookAt(0,0,1),this.add(o);let l=new po(Px,Ox,e,t);l.layers=this.layers,l.up.set(0,1,0),l.lookAt(0,0,-1),this.add(l)}update(e,t){this.parent===null&&this.updateMatrixWorld();let i=this.renderTarget,[n,r,s,a,o,l]=this.children,c=e.getRenderTarget(),u=e.toneMapping,h=e.xr.enabled;e.toneMapping=md,e.xr.enabled=!1;let d=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,n),e.setRenderTarget(i,1),e.render(t,r),e.setRenderTarget(i,2),e.render(t,s),e.setRenderTarget(i,3),e.render(t,a),e.setRenderTarget(i,4),e.render(t,o),i.texture.generateMipmaps=d,e.setRenderTarget(i,5),e.render(t,l),e.setRenderTarget(c),e.toneMapping=u,e.xr.enabled=h,i.texture.needsPMREMUpdate=!0}},O4=class extends Hr{constructor(e,t,i,n,r,s,a,o,l,c){e=e!==void 0?e:[],t=t!==void 0?t:B0,super(e,t,i,n,r,s,a,o,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}},Nbe=class extends mn{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;let i={width:e,height:e,depth:1},n=[i,i,i,i,i,i];this.texture=new O4(n,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Yi}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;let i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},n=new eh(5,5,5),r=new vn({name:"CubemapFromEquirect",uniforms:eb(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:va,blending:Rs});r.uniforms.tEquirect.value=t;let s=new fr(n,r),a=t.minFilter;return t.minFilter===$1&&(t.minFilter=Yi),new Ube(1,10,this).update(e,s),t.minFilter=a,s.geometry.dispose(),s.material.dispose(),this}clear(e,t,i,n){let r=e.getRenderTarget();for(let s=0;s<6;s++)e.setRenderTarget(this,s),e.clear(t,i,n);e.setRenderTarget(r)}},aI=new G,zbe=new G,Fbe=new Cs,_l=class{constructor(e=new G(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,n){return this.normal.set(e,t,i),this.constant=n,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){let n=aI.subVectors(i,t).cross(zbe.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(n,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){let e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){let i=e.delta(aI),n=this.normal.dot(i);if(n===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;let r=-(e.start.dot(this.normal)+this.constant)/n;return r<0||r>1?null:t.copy(i).multiplyScalar(r).add(e.start)}intersectsLine(e){let t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){let i=t||Fbe.getNormalMatrix(e),n=this.coplanarPoint(aI).applyMatrix4(e),r=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}},Bx=new Ol,fT=new G,B4=class{constructor(e=new _l,t=new _l,i=new _l,n=new _l,r=new _l,s=new _l){this.planes=[e,t,i,n,r,s]}set(e,t,i,n,r,s){let a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(n),a[4].copy(r),a[5].copy(s),this}copy(e){let t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){let t=this.planes,i=e.elements,n=i[0],r=i[1],s=i[2],a=i[3],o=i[4],l=i[5],c=i[6],u=i[7],h=i[8],d=i[9],p=i[10],g=i[11],x=i[12],y=i[13],b=i[14],A=i[15];return t[0].setComponents(a-n,u-o,g-h,A-x).normalize(),t[1].setComponents(a+n,u+o,g+h,A+x).normalize(),t[2].setComponents(a+r,u+l,g+d,A+y).normalize(),t[3].setComponents(a-r,u-l,g-d,A-y).normalize(),t[4].setComponents(a-s,u-c,g-p,A-b).normalize(),t[5].setComponents(a+s,u+c,g+p,A+b).normalize(),this}intersectsObject(e){let t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),Bx.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Bx)}intersectsSprite(e){return Bx.center.set(0,0,0),Bx.radius=.7071067811865476,Bx.applyMatrix4(e.matrixWorld),this.intersectsSphere(Bx)}intersectsSphere(e){let t=this.planes,i=e.center,n=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(i)<n)return!1;return!0}intersectsBox(e){let t=this.planes;for(let i=0;i<6;i++){let n=t[i];if(fT.x=n.normal.x>0?e.max.x:e.min.x,fT.y=n.normal.y>0?e.max.y:e.min.y,fT.z=n.normal.z>0?e.max.z:e.min.z,n.distanceToPoint(fT)<0)return!1}return!0}containsPoint(e){let t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}};function ZJ(){let e=null,t=!1,i=null,n=null;function r(s,a){i(s,a),n=e.requestAnimationFrame(r)}return{start:function(){t!==!0&&i!==null&&(n=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(n),t=!1},setAnimationLoop:function(s){i=s},setContext:function(s){e=s}}}function Vbe(e,t){let i=t.isWebGL2,n=new WeakMap;function r(c,u){let h=c.array,d=c.usage,p=e.createBuffer();e.bindBuffer(u,p),e.bufferData(u,h,d),c.onUploadCallback();let g;if(h instanceof Float32Array)g=5126;else if(h instanceof Uint16Array)if(c.isFloat16BufferAttribute)if(i)g=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else g=5123;else if(h instanceof Int16Array)g=5122;else if(h instanceof Uint32Array)g=5125;else if(h instanceof Int32Array)g=5124;else if(h instanceof Int8Array)g=5120;else if(h instanceof Uint8Array)g=5121;else if(h instanceof Uint8ClampedArray)g=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+h);return{buffer:p,type:g,bytesPerElement:h.BYTES_PER_ELEMENT,version:c.version}}function s(c,u,h){let d=u.array,p=u.updateRange;e.bindBuffer(h,c),p.count===-1?e.bufferSubData(h,0,d):(i?e.bufferSubData(h,p.offset*d.BYTES_PER_ELEMENT,d,p.offset,p.count):e.bufferSubData(h,p.offset*d.BYTES_PER_ELEMENT,d.subarray(p.offset,p.offset+p.count)),p.count=-1),u.onUploadCallback()}function a(c){return c.isInterleavedBufferAttribute&&(c=c.data),n.get(c)}function o(c){c.isInterleavedBufferAttribute&&(c=c.data);let u=n.get(c);u&&(e.deleteBuffer(u.buffer),n.delete(c))}function l(c,u){if(c.isGLBufferAttribute){let d=n.get(c);(!d||d.version<c.version)&&n.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);let h=n.get(c);h===void 0?n.set(c,r(c,u)):h.version<c.version&&(s(h.buffer,c,u),h.version=c.version)}return{get:a,remove:o,update:l}}var Ad=class extends ii{constructor(e=1,t=1,i=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:n};let r=e/2,s=t/2,a=Math.floor(i),o=Math.floor(n),l=a+1,c=o+1,u=e/a,h=t/o,d=[],p=[],g=[],x=[];for(let y=0;y<c;y++){let b=y*h-s;for(let A=0;A<l;A++){let w=A*u-r;p.push(w,-b,0),g.push(0,0,1),x.push(A/a),x.push(1-y/o)}}for(let y=0;y<o;y++)for(let b=0;b<a;b++){let A=b+l*y,w=b+l*(y+1),E=b+1+l*(y+1),D=b+1+l*y;d.push(A,w,D),d.push(w,E,D)}this.setIndex(d),this.setAttribute("position",new Gt(p,3)),this.setAttribute("normal",new Gt(g,3)),this.setAttribute("uv",new Gt(x,2))}static fromJSON(e){return new Ad(e.width,e.height,e.widthSegments,e.heightSegments)}},Hbe=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,Gbe=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,kbe=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,jbe=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,Wbe=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,Xbe=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,qbe="vec3 transformed = vec3( position );",Ybe=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,Qbe=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,Kbe=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,Jbe=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,Zbe=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,$be=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,eSe=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,tSe=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,iSe=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,nSe=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,rSe=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,sSe=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,aSe=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,oSe=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,lSe=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,cSe=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,uSe=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,hSe=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,dSe=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,fSe="gl_FragColor = linearToOutputTexel( gl_FragColor );",pSe=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,mSe=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,gSe=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,vSe=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,ySe=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,xSe=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,bSe=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,SSe=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,_Se=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,ASe=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,wSe=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,MSe=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,ESe=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,TSe=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,CSe=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,DSe=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,RSe=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,PSe=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,OSe=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,BSe=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,ISe=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,LSe=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,USe=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,NSe=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,zSe=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,FSe=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,VSe=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,HSe=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,GSe=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,kSe=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,jSe=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,WSe=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,XSe=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,qSe=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,YSe=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,QSe=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,KSe=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,JSe=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,ZSe=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,$Se=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,e_e=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,t_e=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,i_e=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,n_e=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,r_e=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,s_e=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,a_e=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,o_e=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,l_e=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,c_e=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,u_e=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,h_e=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,d_e=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,f_e=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,p_e=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,m_e=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,g_e=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,v_e=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,y_e=`#if NUM_SPOT_LIGHT_COORDS > 0
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,x_e=`#if NUM_SPOT_LIGHT_COORDS > 0
  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,b_e=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,S_e=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,__e=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,A_e=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,w_e=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,M_e=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,E_e=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,T_e=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,C_e=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,D_e=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,R_e=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,P_e=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,O_e=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,B_e=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,I_e=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,L_e=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,U_e=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,N_e=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,z_e=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,F_e=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,V_e=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,H_e=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,G_e=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,k_e=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,j_e=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,W_e=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,X_e=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,q_e=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,Y_e=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,Q_e=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,K_e=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,J_e=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Z_e=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,$_e=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,eAe=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,tAe=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,iAe=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,nAe=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,rAe=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,sAe=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,aAe=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,oAe=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,lAe=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,cAe=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,uAe=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,hAe=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,dAe=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,fAe=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,pAe=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,mAe=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,gAe=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,vAe=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,yAe=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,Xi={alphamap_fragment:Hbe,alphamap_pars_fragment:Gbe,alphatest_fragment:kbe,alphatest_pars_fragment:jbe,aomap_fragment:Wbe,aomap_pars_fragment:Xbe,begin_vertex:qbe,beginnormal_vertex:Ybe,bsdfs:Qbe,iridescence_fragment:Kbe,bumpmap_pars_fragment:Jbe,clipping_planes_fragment:Zbe,clipping_planes_pars_fragment:$be,clipping_planes_pars_vertex:eSe,clipping_planes_vertex:tSe,color_fragment:iSe,color_pars_fragment:nSe,color_pars_vertex:rSe,color_vertex:sSe,common:aSe,cube_uv_reflection_fragment:oSe,defaultnormal_vertex:lSe,displacementmap_pars_vertex:cSe,displacementmap_vertex:uSe,emissivemap_fragment:hSe,emissivemap_pars_fragment:dSe,encodings_fragment:fSe,encodings_pars_fragment:pSe,envmap_fragment:mSe,envmap_common_pars_fragment:gSe,envmap_pars_fragment:vSe,envmap_pars_vertex:ySe,envmap_physical_pars_fragment:RSe,envmap_vertex:xSe,fog_vertex:bSe,fog_pars_vertex:SSe,fog_fragment:_Se,fog_pars_fragment:ASe,gradientmap_pars_fragment:wSe,lightmap_fragment:MSe,lightmap_pars_fragment:ESe,lights_lambert_fragment:TSe,lights_lambert_pars_fragment:CSe,lights_pars_begin:DSe,lights_toon_fragment:PSe,lights_toon_pars_fragment:OSe,lights_phong_fragment:BSe,lights_phong_pars_fragment:ISe,lights_physical_fragment:LSe,lights_physical_pars_fragment:USe,lights_fragment_begin:NSe,lights_fragment_maps:zSe,lights_fragment_end:FSe,logdepthbuf_fragment:VSe,logdepthbuf_pars_fragment:HSe,logdepthbuf_pars_vertex:GSe,logdepthbuf_vertex:kSe,map_fragment:jSe,map_pars_fragment:WSe,map_particle_fragment:XSe,map_particle_pars_fragment:qSe,metalnessmap_fragment:YSe,metalnessmap_pars_fragment:QSe,morphcolor_vertex:KSe,morphnormal_vertex:JSe,morphtarget_pars_vertex:ZSe,morphtarget_vertex:$Se,normal_fragment_begin:e_e,normal_fragment_maps:t_e,normal_pars_fragment:i_e,normal_pars_vertex:n_e,normal_vertex:r_e,normalmap_pars_fragment:s_e,clearcoat_normal_fragment_begin:a_e,clearcoat_normal_fragment_maps:o_e,clearcoat_pars_fragment:l_e,iridescence_pars_fragment:c_e,output_fragment:u_e,packing:h_e,premultiplied_alpha_fragment:d_e,project_vertex:f_e,dithering_fragment:p_e,dithering_pars_fragment:m_e,roughnessmap_fragment:g_e,roughnessmap_pars_fragment:v_e,shadowmap_pars_fragment:y_e,shadowmap_pars_vertex:x_e,shadowmap_vertex:b_e,shadowmask_pars_fragment:S_e,skinbase_vertex:__e,skinning_pars_vertex:A_e,skinning_vertex:w_e,skinnormal_vertex:M_e,specularmap_fragment:E_e,specularmap_pars_fragment:T_e,tonemapping_fragment:C_e,tonemapping_pars_fragment:D_e,transmission_fragment:R_e,transmission_pars_fragment:P_e,uv_pars_fragment:O_e,uv_pars_vertex:B_e,uv_vertex:I_e,uv2_pars_fragment:L_e,uv2_pars_vertex:U_e,uv2_vertex:N_e,worldpos_vertex:z_e,background_vert:F_e,background_frag:V_e,backgroundCube_vert:H_e,backgroundCube_frag:G_e,cube_vert:k_e,cube_frag:j_e,depth_vert:W_e,depth_frag:X_e,distanceRGBA_vert:q_e,distanceRGBA_frag:Y_e,equirect_vert:Q_e,equirect_frag:K_e,linedashed_vert:J_e,linedashed_frag:Z_e,meshbasic_vert:$_e,meshbasic_frag:eAe,meshlambert_vert:tAe,meshlambert_frag:iAe,meshmatcap_vert:nAe,meshmatcap_frag:rAe,meshnormal_vert:sAe,meshnormal_frag:aAe,meshphong_vert:oAe,meshphong_frag:lAe,meshphysical_vert:cAe,meshphysical_frag:uAe,meshtoon_vert:hAe,meshtoon_frag:dAe,points_vert:fAe,points_frag:pAe,shadow_vert:mAe,shadow_frag:gAe,sprite_vert:vAe,sprite_frag:yAe},zt={common:{diffuse:{value:new gi(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Cs},uv2Transform:{value:new Cs},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Ae(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new gi(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new gi(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Cs}},sprite:{diffuse:{value:new gi(16777215)},opacity:{value:1},center:{value:new Ae(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Cs}}},nd={basic:{uniforms:Wo([zt.common,zt.specularmap,zt.envmap,zt.aomap,zt.lightmap,zt.fog]),vertexShader:Xi.meshbasic_vert,fragmentShader:Xi.meshbasic_frag},lambert:{uniforms:Wo([zt.common,zt.specularmap,zt.envmap,zt.aomap,zt.lightmap,zt.emissivemap,zt.bumpmap,zt.normalmap,zt.displacementmap,zt.fog,zt.lights,{emissive:{value:new gi(0)}}]),vertexShader:Xi.meshlambert_vert,fragmentShader:Xi.meshlambert_frag},phong:{uniforms:Wo([zt.common,zt.specularmap,zt.envmap,zt.aomap,zt.lightmap,zt.emissivemap,zt.bumpmap,zt.normalmap,zt.displacementmap,zt.fog,zt.lights,{emissive:{value:new gi(0)},specular:{value:new gi(1118481)},shininess:{value:30}}]),vertexShader:Xi.meshphong_vert,fragmentShader:Xi.meshphong_frag},standard:{uniforms:Wo([zt.common,zt.envmap,zt.aomap,zt.lightmap,zt.emissivemap,zt.bumpmap,zt.normalmap,zt.displacementmap,zt.roughnessmap,zt.metalnessmap,zt.fog,zt.lights,{emissive:{value:new gi(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Xi.meshphysical_vert,fragmentShader:Xi.meshphysical_frag},toon:{uniforms:Wo([zt.common,zt.aomap,zt.lightmap,zt.emissivemap,zt.bumpmap,zt.normalmap,zt.displacementmap,zt.gradientmap,zt.fog,zt.lights,{emissive:{value:new gi(0)}}]),vertexShader:Xi.meshtoon_vert,fragmentShader:Xi.meshtoon_frag},matcap:{uniforms:Wo([zt.common,zt.bumpmap,zt.normalmap,zt.displacementmap,zt.fog,{matcap:{value:null}}]),vertexShader:Xi.meshmatcap_vert,fragmentShader:Xi.meshmatcap_frag},points:{uniforms:Wo([zt.points,zt.fog]),vertexShader:Xi.points_vert,fragmentShader:Xi.points_frag},dashed:{uniforms:Wo([zt.common,zt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Xi.linedashed_vert,fragmentShader:Xi.linedashed_frag},depth:{uniforms:Wo([zt.common,zt.displacementmap]),vertexShader:Xi.depth_vert,fragmentShader:Xi.depth_frag},normal:{uniforms:Wo([zt.common,zt.bumpmap,zt.normalmap,zt.displacementmap,{opacity:{value:1}}]),vertexShader:Xi.meshnormal_vert,fragmentShader:Xi.meshnormal_frag},sprite:{uniforms:Wo([zt.sprite,zt.fog]),vertexShader:Xi.sprite_vert,fragmentShader:Xi.sprite_frag},background:{uniforms:{uvTransform:{value:new Cs},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Xi.background_vert,fragmentShader:Xi.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:Xi.backgroundCube_vert,fragmentShader:Xi.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Xi.cube_vert,fragmentShader:Xi.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Xi.equirect_vert,fragmentShader:Xi.equirect_frag},distanceRGBA:{uniforms:Wo([zt.common,zt.displacementmap,{referencePosition:{value:new G},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Xi.distanceRGBA_vert,fragmentShader:Xi.distanceRGBA_frag},shadow:{uniforms:Wo([zt.lights,zt.fog,{color:{value:new gi(0)},opacity:{value:1}}]),vertexShader:Xi.shadow_vert,fragmentShader:Xi.shadow_frag}};nd.physical={uniforms:Wo([nd.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Ae(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new gi(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Ae},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new gi(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new gi(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Xi.meshphysical_vert,fragmentShader:Xi.meshphysical_frag};var pT={r:0,b:0,g:0};function xAe(e,t,i,n,r,s,a){let o=new gi(0),l=s===!0?0:1,c,u,h=null,d=0,p=null;function g(y,b){let A=!1,w=b.isScene===!0?b.background:null;w&&w.isTexture&&(w=(b.backgroundBlurriness>0?i:t).get(w));let E=e.xr,D=E.getSession&&E.getSession();D&&D.environmentBlendMode==="additive"&&(w=null),w===null?x(o,l):w&&w.isColor&&(x(w,1),A=!0),(e.autoClear||A)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),w&&(w.isCubeTexture||w.mapping===rM)?(u===void 0&&(u=new fr(new eh(1,1,1),new vn({name:"BackgroundCubeMaterial",uniforms:eb(nd.backgroundCube.uniforms),vertexShader:nd.backgroundCube.vertexShader,fragmentShader:nd.backgroundCube.fragmentShader,side:va,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(T,I,R){this.matrixWorld.copyPosition(R.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(u)),u.material.uniforms.envMap.value=w,u.material.uniforms.flipEnvMap.value=w.isCubeTexture&&w.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=b.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=b.backgroundIntensity,u.material.toneMapped=w.encoding!==Gi,(h!==w||d!==w.version||p!==e.toneMapping)&&(u.material.needsUpdate=!0,h=w,d=w.version,p=e.toneMapping),u.layers.enableAll(),y.unshift(u,u.geometry,u.material,0,0,null)):w&&w.isTexture&&(c===void 0&&(c=new fr(new Ad(2,2),new vn({name:"BackgroundMaterial",uniforms:eb(nd.background.uniforms),vertexShader:nd.background.vertexShader,fragmentShader:nd.background.fragmentShader,side:Zu,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(c)),c.material.uniforms.t2D.value=w,c.material.uniforms.backgroundIntensity.value=b.backgroundIntensity,c.material.toneMapped=w.encoding!==Gi,w.matrixAutoUpdate===!0&&w.updateMatrix(),c.material.uniforms.uvTransform.value.copy(w.matrix),(h!==w||d!==w.version||p!==e.toneMapping)&&(c.material.needsUpdate=!0,h=w,d=w.version,p=e.toneMapping),c.layers.enableAll(),y.unshift(c,c.geometry,c.material,0,0,null))}function x(y,b){y.getRGB(pT,JJ(e)),n.buffers.color.setClear(pT.r,pT.g,pT.b,b,a)}return{getClearColor:function(){return o},setClearColor:function(y,b=1){o.set(y),l=b,x(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(y){l=y,x(o,l)},render:g}}function bAe(e,t,i,n){let r=e.getParameter(34921),s=n.isWebGL2?null:t.get("OES_vertex_array_object"),a=n.isWebGL2||s!==null,o={},l=y(null),c=l,u=!1;function h(j,J,F,X,W){let ne=!1;if(a){let Y=x(X,F,J);c!==Y&&(c=Y,p(c.object)),ne=b(j,X,F,W),ne&&A(j,X,F,W)}else{let Y=J.wireframe===!0;(c.geometry!==X.id||c.program!==F.id||c.wireframe!==Y)&&(c.geometry=X.id,c.program=F.id,c.wireframe=Y,ne=!0)}W!==null&&i.update(W,34963),(ne||u)&&(u=!1,R(j,J,F,X),W!==null&&e.bindBuffer(34963,i.get(W).buffer))}function d(){return n.isWebGL2?e.createVertexArray():s.createVertexArrayOES()}function p(j){return n.isWebGL2?e.bindVertexArray(j):s.bindVertexArrayOES(j)}function g(j){return n.isWebGL2?e.deleteVertexArray(j):s.deleteVertexArrayOES(j)}function x(j,J,F){let X=F.wireframe===!0,W=o[j.id];W===void 0&&(W={},o[j.id]=W);let ne=W[J.id];ne===void 0&&(ne={},W[J.id]=ne);let Y=ne[X];return Y===void 0&&(Y=y(d()),ne[X]=Y),Y}function y(j){let J=[],F=[],X=[];for(let W=0;W<r;W++)J[W]=0,F[W]=0,X[W]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:J,enabledAttributes:F,attributeDivisors:X,object:j,attributes:{},index:null}}function b(j,J,F,X){let W=c.attributes,ne=J.attributes,Y=0,$=F.getAttributes();for(let se in $)if($[se].location>=0){let fe=W[se],te=ne[se];if(te===void 0&&(se==="instanceMatrix"&&j.instanceMatrix&&(te=j.instanceMatrix),se==="instanceColor"&&j.instanceColor&&(te=j.instanceColor)),fe===void 0||fe.attribute!==te||te&&fe.data!==te.data)return!0;Y++}return c.attributesNum!==Y||c.index!==X}function A(j,J,F,X){let W={},ne=J.attributes,Y=0,$=F.getAttributes();for(let se in $)if($[se].location>=0){let fe=ne[se];fe===void 0&&(se==="instanceMatrix"&&j.instanceMatrix&&(fe=j.instanceMatrix),se==="instanceColor"&&j.instanceColor&&(fe=j.instanceColor));let te={};te.attribute=fe,fe&&fe.data&&(te.data=fe.data),W[se]=te,Y++}c.attributes=W,c.attributesNum=Y,c.index=X}function w(){let j=c.newAttributes;for(let J=0,F=j.length;J<F;J++)j[J]=0}function E(j){D(j,0)}function D(j,J){let F=c.newAttributes,X=c.enabledAttributes,W=c.attributeDivisors;F[j]=1,X[j]===0&&(e.enableVertexAttribArray(j),X[j]=1),W[j]!==J&&((n.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](j,J),W[j]=J)}function T(){let j=c.newAttributes,J=c.enabledAttributes;for(let F=0,X=J.length;F<X;F++)J[F]!==j[F]&&(e.disableVertexAttribArray(F),J[F]=0)}function I(j,J,F,X,W,ne){n.isWebGL2===!0&&(F===5124||F===5125)?e.vertexAttribIPointer(j,J,F,W,ne):e.vertexAttribPointer(j,J,F,X,W,ne)}function R(j,J,F,X){if(n.isWebGL2===!1&&(j.isInstancedMesh||X.isInstancedBufferGeometry)&&t.get("ANGLE_instanced_arrays")===null)return;w();let W=X.attributes,ne=F.getAttributes(),Y=J.defaultAttributeValues;for(let $ in ne){let se=ne[$];if(se.location>=0){let fe=W[$];if(fe===void 0&&($==="instanceMatrix"&&j.instanceMatrix&&(fe=j.instanceMatrix),$==="instanceColor"&&j.instanceColor&&(fe=j.instanceColor)),fe!==void 0){let te=fe.normalized,de=fe.itemSize,le=i.get(fe);if(le===void 0)continue;let _e=le.buffer,be=le.type,we=le.bytesPerElement;if(fe.isInterleavedBufferAttribute){let Me=fe.data,Ne=Me.stride,Ge=fe.offset;if(Me.isInstancedInterleavedBuffer){for(let We=0;We<se.locationSize;We++)D(se.location+We,Me.meshPerAttribute);j.isInstancedMesh!==!0&&X._maxInstanceCount===void 0&&(X._maxInstanceCount=Me.meshPerAttribute*Me.count)}else for(let We=0;We<se.locationSize;We++)E(se.location+We);e.bindBuffer(34962,_e);for(let We=0;We<se.locationSize;We++)I(se.location+We,de/se.locationSize,be,te,Ne*we,(Ge+de/se.locationSize*We)*we)}else{if(fe.isInstancedBufferAttribute){for(let Me=0;Me<se.locationSize;Me++)D(se.location+Me,fe.meshPerAttribute);j.isInstancedMesh!==!0&&X._maxInstanceCount===void 0&&(X._maxInstanceCount=fe.meshPerAttribute*fe.count)}else for(let Me=0;Me<se.locationSize;Me++)E(se.location+Me);e.bindBuffer(34962,_e);for(let Me=0;Me<se.locationSize;Me++)I(se.location+Me,de/se.locationSize,be,te,de*we,de/se.locationSize*Me*we)}}else if(Y!==void 0){let te=Y[$];if(te!==void 0)switch(te.length){case 2:e.vertexAttrib2fv(se.location,te);break;case 3:e.vertexAttrib3fv(se.location,te);break;case 4:e.vertexAttrib4fv(se.location,te);break;default:e.vertexAttrib1fv(se.location,te)}}}}T()}function O(){H();for(let j in o){let J=o[j];for(let F in J){let X=J[F];for(let W in X)g(X[W].object),delete X[W];delete J[F]}delete o[j]}}function P(j){if(o[j.id]===void 0)return;let J=o[j.id];for(let F in J){let X=J[F];for(let W in X)g(X[W].object),delete X[W];delete J[F]}delete o[j.id]}function U(j){for(let J in o){let F=o[J];if(F[j.id]===void 0)continue;let X=F[j.id];for(let W in X)g(X[W].object),delete X[W];delete F[j.id]}}function H(){V(),u=!0,c!==l&&(c=l,p(c.object))}function V(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:h,reset:H,resetDefaultState:V,dispose:O,releaseStatesOfGeometry:P,releaseStatesOfProgram:U,initAttributes:w,enableAttribute:E,disableUnusedAttributes:T}}function SAe(e,t,i,n){let r=n.isWebGL2,s;function a(c){s=c}function o(c,u){e.drawArrays(s,c,u),i.update(u,s,1)}function l(c,u,h){if(h===0)return;let d,p;if(r)d=e,p="drawArraysInstanced";else if(d=t.get("ANGLE_instanced_arrays"),p="drawArraysInstancedANGLE",d===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}d[p](s,c,u,h),i.update(u,s,h)}this.setMode=a,this.render=o,this.renderInstances=l}function _Ae(e,t,i){let n;function r(){if(n!==void 0)return n;if(t.has("EXT_texture_filter_anisotropic")===!0){let I=t.get("EXT_texture_filter_anisotropic");n=e.getParameter(I.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n}function s(I){if(I==="highp"){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";I="mediump"}return I==="mediump"&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}let a=typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext,o=i.precision!==void 0?i.precision:"highp",l=s(o);l!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",l,"instead."),o=l);let c=a||t.has("WEBGL_draw_buffers"),u=i.logarithmicDepthBuffer===!0,h=e.getParameter(34930),d=e.getParameter(35660),p=e.getParameter(3379),g=e.getParameter(34076),x=e.getParameter(34921),y=e.getParameter(36347),b=e.getParameter(36348),A=e.getParameter(36349),w=d>0,E=a||t.has("OES_texture_float"),D=w&&E,T=a?e.getParameter(36183):0;return{isWebGL2:a,drawBuffers:c,getMaxAnisotropy:r,getMaxPrecision:s,precision:o,logarithmicDepthBuffer:u,maxTextures:h,maxVertexTextures:d,maxTextureSize:p,maxCubemapSize:g,maxAttributes:x,maxVertexUniforms:y,maxVaryings:b,maxFragmentUniforms:A,vertexTextures:w,floatFragmentTextures:E,floatVertexTextures:D,maxSamples:T}}function AAe(e){let t=this,i=null,n=0,r=!1,s=!1,a=new _l,o=new Cs,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(h,d){let p=h.length!==0||d||n!==0||r;return r=d,n=h.length,p},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(h,d){i=u(h,d,0)},this.setState=function(h,d,p){let g=h.clippingPlanes,x=h.clipIntersection,y=h.clipShadows,b=e.get(h);if(!r||g===null||g.length===0||s&&!y)s?u(null):c();else{let A=s?0:n,w=A*4,E=b.clippingState||null;l.value=E,E=u(g,d,w,p);for(let D=0;D!==w;++D)E[D]=i[D];b.clippingState=E,this.numIntersection=x?this.numPlanes:0,this.numPlanes+=A}};function c(){l.value!==i&&(l.value=i,l.needsUpdate=n>0),t.numPlanes=n,t.numIntersection=0}function u(h,d,p,g){let x=h!==null?h.length:0,y=null;if(x!==0){if(y=l.value,g!==!0||y===null){let b=p+x*4,A=d.matrixWorldInverse;o.getNormalMatrix(A),(y===null||y.length<b)&&(y=new Float32Array(b));for(let w=0,E=p;w!==x;++w,E+=4)a.copy(h[w]).applyMatrix4(A,o),a.normal.toArray(y,E),y[E+3]=a.constant}l.value=y,l.needsUpdate=!0}return t.numPlanes=x,t.numIntersection=0,y}}function wAe(e){let t=new WeakMap;function i(a,o){return o===zU?a.mapping=B0:o===FU&&(a.mapping=I0),a}function n(a){if(a&&a.isTexture&&a.isRenderTargetTexture===!1){let o=a.mapping;if(o===zU||o===FU)if(t.has(a)){let l=t.get(a).texture;return i(l,a.mapping)}else{let l=a.image;if(l&&l.height>0){let c=new Nbe(l.height/2);return c.fromEquirectangularTexture(e,a),t.set(a,c),a.addEventListener("dispose",r),i(c.texture,a.mapping)}else return null}}return a}function r(a){let o=a.target;o.removeEventListener("dispose",r);let l=t.get(o);l!==void 0&&(t.delete(o),l.dispose())}function s(){t=new WeakMap}return{get:n,dispose:s}}var kR=class extends mg{constructor(e=-1,t=1,i=1,n=-1,r=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=n,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,n,r,s){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2,r=i-e,s=i+e,a=n+t,o=n-t;if(this.view!==null&&this.view.enabled){let l=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=l*this.view.offsetX,s=r+l*this.view.width,a-=c*this.view.offsetY,o=a-c*this.view.height}this.projectionMatrix.makeOrthographic(r,s,a,o,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}},m1=4,O8=[.125,.215,.35,.446,.526,.582],Wv=20,oI=new kR,B8=new gi,lI=null,Vv=(1+Math.sqrt(5))/2,Ix=1/Vv,I8=[new G(1,1,1),new G(-1,1,1),new G(1,1,-1),new G(-1,1,-1),new G(0,Vv,Ix),new G(0,Vv,-Ix),new G(Ix,0,Vv),new G(-Ix,0,Vv),new G(Vv,Ix,0),new G(-Vv,Ix,0)],L8=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,n=100){lI=this._renderer.getRenderTarget(),this._setSize(256);let r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,i,n,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=z8(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=N8(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(lI),e.scissorTest=!1,mT(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===B0||e.mapping===I0?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),lI=this._renderer.getRenderTarget();let i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){let e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:Yi,minFilter:Yi,generateMipmaps:!1,type:ip,format:Rr,encoding:$u,depthBuffer:!1},n=U8(e,t,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=U8(e,t,i);let{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=MAe(r)),this._blurMaterial=EAe(r,e,t)}return n}_compileMaterial(e){let t=new fr(this._lodPlanes[0],e);this._renderer.compile(t,oI)}_sceneToCubeUV(e,t,i,n){let r=new po(90,1,t,i),s=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],o=this._renderer,l=o.autoClear,c=o.toneMapping;o.getClearColor(B8),o.toneMapping=md,o.autoClear=!1;let u=new np({name:"PMREM.Background",side:va,depthWrite:!1,depthTest:!1}),h=new fr(new eh,u),d=!1,p=e.background;p?p.isColor&&(u.color.copy(p),e.background=null,d=!0):(u.color.copy(B8),d=!0);for(let g=0;g<6;g++){let x=g%3;x===0?(r.up.set(0,s[g],0),r.lookAt(a[g],0,0)):x===1?(r.up.set(0,0,s[g]),r.lookAt(0,a[g],0)):(r.up.set(0,s[g],0),r.lookAt(0,0,a[g]));let y=this._cubeSize;mT(n,x*y,g>2?y:0,y,y),o.setRenderTarget(n),d&&o.render(h,r),o.render(e,r)}h.geometry.dispose(),h.material.dispose(),o.toneMapping=c,o.autoClear=l,e.background=p}_textureToCubeUV(e,t){let i=this._renderer,n=e.mapping===B0||e.mapping===I0;n?(this._cubemapMaterial===null&&(this._cubemapMaterial=z8()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=N8());let r=n?this._cubemapMaterial:this._equirectMaterial,s=new fr(this._lodPlanes[0],r),a=r.uniforms;a.envMap.value=e;let o=this._cubeSize;mT(t,0,0,3*o,2*o),i.setRenderTarget(t),i.render(s,oI)}_applyPMREM(e){let t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let n=1;n<this._lodPlanes.length;n++){let r=Math.sqrt(this._sigmas[n]*this._sigmas[n]-this._sigmas[n-1]*this._sigmas[n-1]),s=I8[(n-1)%I8.length];this._blur(e,n-1,n,r,s)}t.autoClear=i}_blur(e,t,i,n,r){let s=this._pingPongRenderTarget;this._halfBlur(e,s,t,i,n,"latitudinal",r),this._halfBlur(s,e,i,i,n,"longitudinal",r)}_halfBlur(e,t,i,n,r,s,a){let o=this._renderer,l=this._blurMaterial;s!=="latitudinal"&&s!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");let c=3,u=new fr(this._lodPlanes[n],l),h=l.uniforms,d=this._sizeLods[i]-1,p=isFinite(r)?Math.PI/(2*d):2*Math.PI/(2*Wv-1),g=r/p,x=isFinite(r)?1+Math.floor(c*g):Wv;x>Wv&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${x} samples when the maximum is set to ${Wv}`);let y=[],b=0;for(let T=0;T<Wv;++T){let I=T/g,R=Math.exp(-I*I/2);y.push(R),T===0?b+=R:T<x&&(b+=2*R)}for(let T=0;T<y.length;T++)y[T]=y[T]/b;h.envMap.value=e.texture,h.samples.value=x,h.weights.value=y,h.latitudinal.value=s==="latitudinal",a&&(h.poleAxis.value=a);let{_lodMax:A}=this;h.dTheta.value=p,h.mipInt.value=A-i;let w=this._sizeLods[n],E=3*w*(n>A-m1?n-A+m1:0),D=4*(this._cubeSize-w);mT(t,E,D,3*w,2*w),o.setRenderTarget(t),o.render(u,oI)}};function MAe(e){let t=[],i=[],n=[],r=e,s=e-m1+1+O8.length;for(let a=0;a<s;a++){let o=Math.pow(2,r);i.push(o);let l=1/o;a>e-m1?l=O8[a-e+m1-1]:a===0&&(l=0),n.push(l);let c=1/(o-2),u=-c,h=1+c,d=[u,u,h,u,h,h,u,u,h,h,u,h],p=6,g=6,x=3,y=2,b=1,A=new Float32Array(x*g*p),w=new Float32Array(y*g*p),E=new Float32Array(b*g*p);for(let T=0;T<p;T++){let I=T%3*2/3-1,R=T>2?0:-1,O=[I,R,0,I+2/3,R,0,I+2/3,R+1,0,I,R,0,I+2/3,R+1,0,I,R+1,0];A.set(O,x*g*T),w.set(d,y*g*T);let P=[T,T,T,T,T,T];E.set(P,b*g*T)}let D=new ii;D.setAttribute("position",new vi(A,x)),D.setAttribute("uv",new vi(w,y)),D.setAttribute("faceIndex",new vi(E,b)),t.push(D),r>m1&&r--}return{lodPlanes:t,sizeLods:i,sigmas:n}}function U8(e,t,i){let n=new mn(e,t,i);return n.texture.mapping=rM,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function mT(e,t,i,n,r){e.viewport.set(t,i,n,r),e.scissor.set(t,i,n,r)}function EAe(e,t,i){let n=new Float32Array(Wv),r=new G(0,1,0);return new vn({name:"SphericalGaussianBlur",defines:{n:Wv,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:I4(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Rs,depthTest:!1,depthWrite:!1})}function N8(){return new vn({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:I4(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Rs,depthTest:!1,depthWrite:!1})}function z8(){return new vn({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:I4(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Rs,depthTest:!1,depthWrite:!1})}function I4(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function TAe(e){let t=new WeakMap,i=null;function n(o){if(o&&o.isTexture){let l=o.mapping,c=l===zU||l===FU,u=l===B0||l===I0;if(c||u)if(o.isRenderTargetTexture&&o.needsPMREMUpdate===!0){o.needsPMREMUpdate=!1;let h=t.get(o);return i===null&&(i=new L8(e)),h=c?i.fromEquirectangular(o,h):i.fromCubemap(o,h),t.set(o,h),h.texture}else{if(t.has(o))return t.get(o).texture;{let h=o.image;if(c&&h&&h.height>0||u&&h&&r(h)){i===null&&(i=new L8(e));let d=c?i.fromEquirectangular(o):i.fromCubemap(o);return t.set(o,d),o.addEventListener("dispose",s),d.texture}else return null}}}return o}function r(o){let l=0,c=6;for(let u=0;u<c;u++)o[u]!==void 0&&l++;return l===c}function s(o){let l=o.target;l.removeEventListener("dispose",s);let c=t.get(l);c!==void 0&&(t.delete(l),c.dispose())}function a(){t=new WeakMap,i!==null&&(i.dispose(),i=null)}return{get:n,dispose:a}}function CAe(e){let t={};function i(n){if(t[n]!==void 0)return t[n];let r;switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return t[n]=r,r}return{has:function(n){return i(n)!==null},init:function(n){n.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(n){let r=i(n);return r===null&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),r}}}function DAe(e,t,i,n){let r={},s=new WeakMap;function a(h){let d=h.target;d.index!==null&&t.remove(d.index);for(let g in d.attributes)t.remove(d.attributes[g]);d.removeEventListener("dispose",a),delete r[d.id];let p=s.get(d);p&&(t.remove(p),s.delete(d)),n.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,i.memory.geometries--}function o(h,d){return r[d.id]===!0||(d.addEventListener("dispose",a),r[d.id]=!0,i.memory.geometries++),d}function l(h){let d=h.attributes;for(let g in d)t.update(d[g],34962);let p=h.morphAttributes;for(let g in p){let x=p[g];for(let y=0,b=x.length;y<b;y++)t.update(x[y],34962)}}function c(h){let d=[],p=h.index,g=h.attributes.position,x=0;if(p!==null){let A=p.array;x=p.version;for(let w=0,E=A.length;w<E;w+=3){let D=A[w+0],T=A[w+1],I=A[w+2];d.push(D,T,T,I,I,D)}}else{let A=g.array;x=g.version;for(let w=0,E=A.length/3-1;w<E;w+=3){let D=w+0,T=w+1,I=w+2;d.push(D,T,T,I,I,D)}}let y=new(jJ(d)?M1:KJ)(d,1);y.version=x;let b=s.get(h);b&&t.remove(b),s.set(h,y)}function u(h){let d=s.get(h);if(d){let p=h.index;p!==null&&d.version<p.version&&c(h)}else c(h);return s.get(h)}return{get:o,update:l,getWireframeAttribute:u}}function RAe(e,t,i,n){let r=n.isWebGL2,s;function a(d){s=d}let o,l;function c(d){o=d.type,l=d.bytesPerElement}function u(d,p){e.drawElements(s,p,o,d*l),i.update(p,s,1)}function h(d,p,g){if(g===0)return;let x,y;if(r)x=e,y="drawElementsInstanced";else if(x=t.get("ANGLE_instanced_arrays"),y="drawElementsInstancedANGLE",x===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}x[y](s,p,o,d*l,g),i.update(p,s,g)}this.setMode=a,this.setIndex=c,this.render=u,this.renderInstances=h}function PAe(e){let t={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function n(s,a,o){switch(i.calls++,a){case 4:i.triangles+=o*(s/3);break;case 1:i.lines+=o*(s/2);break;case 3:i.lines+=o*(s-1);break;case 2:i.lines+=o*s;break;case 0:i.points+=o*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function r(){i.frame++,i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:t,render:i,programs:null,autoReset:!0,reset:r,update:n}}function OAe(e,t){return e[0]-t[0]}function BAe(e,t){return Math.abs(t[1])-Math.abs(e[1])}function IAe(e,t,i){let n={},r=new Float32Array(8),s=new WeakMap,a=new Di,o=[];for(let c=0;c<8;c++)o[c]=[c,0];function l(c,u,h,d){let p=c.morphTargetInfluences;if(t.isWebGL2===!0){let g=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,x=g!==void 0?g.length:0,y=s.get(u);if(y===void 0||y.count!==x){let w=function(){j.dispose(),s.delete(u),u.removeEventListener("dispose",w)};y!==void 0&&y.texture.dispose();let E=u.morphAttributes.position!==void 0,D=u.morphAttributes.normal!==void 0,T=u.morphAttributes.color!==void 0,I=u.morphAttributes.position||[],R=u.morphAttributes.normal||[],O=u.morphAttributes.color||[],P=0;E===!0&&(P=1),D===!0&&(P=2),T===!0&&(P=3);let U=u.attributes.position.count*P,H=1;U>t.maxTextureSize&&(H=Math.ceil(U/t.maxTextureSize),U=t.maxTextureSize);let V=new Float32Array(U*H*4*x),j=new YJ(V,U,H,x);j.type=Zn,j.needsUpdate=!0;let J=P*4;for(let F=0;F<x;F++){let X=I[F],W=R[F],ne=O[F],Y=U*H*4*F;for(let $=0;$<X.count;$++){let se=$*J;E===!0&&(a.fromBufferAttribute(X,$),V[Y+se+0]=a.x,V[Y+se+1]=a.y,V[Y+se+2]=a.z,V[Y+se+3]=0),D===!0&&(a.fromBufferAttribute(W,$),V[Y+se+4]=a.x,V[Y+se+5]=a.y,V[Y+se+6]=a.z,V[Y+se+7]=0),T===!0&&(a.fromBufferAttribute(ne,$),V[Y+se+8]=a.x,V[Y+se+9]=a.y,V[Y+se+10]=a.z,V[Y+se+11]=ne.itemSize===4?a.w:1)}}y={count:x,texture:j,size:new Ae(U,H)},s.set(u,y),u.addEventListener("dispose",w)}let b=0;for(let w=0;w<p.length;w++)b+=p[w];let A=u.morphTargetsRelative?1:1-b;d.getUniforms().setValue(e,"morphTargetBaseInfluence",A),d.getUniforms().setValue(e,"morphTargetInfluences",p),d.getUniforms().setValue(e,"morphTargetsTexture",y.texture,i),d.getUniforms().setValue(e,"morphTargetsTextureSize",y.size)}else{let g=p===void 0?0:p.length,x=n[u.id];if(x===void 0||x.length!==g){x=[];for(let E=0;E<g;E++)x[E]=[E,0];n[u.id]=x}for(let E=0;E<g;E++){let D=x[E];D[0]=E,D[1]=p[E]}x.sort(BAe);for(let E=0;E<8;E++)E<g&&x[E][1]?(o[E][0]=x[E][0],o[E][1]=x[E][1]):(o[E][0]=Number.MAX_SAFE_INTEGER,o[E][1]=0);o.sort(OAe);let y=u.morphAttributes.position,b=u.morphAttributes.normal,A=0;for(let E=0;E<8;E++){let D=o[E],T=D[0],I=D[1];T!==Number.MAX_SAFE_INTEGER&&I?(y&&u.getAttribute("morphTarget"+E)!==y[T]&&u.setAttribute("morphTarget"+E,y[T]),b&&u.getAttribute("morphNormal"+E)!==b[T]&&u.setAttribute("morphNormal"+E,b[T]),r[E]=I,A+=I):(y&&u.hasAttribute("morphTarget"+E)===!0&&u.deleteAttribute("morphTarget"+E),b&&u.hasAttribute("morphNormal"+E)===!0&&u.deleteAttribute("morphNormal"+E),r[E]=0)}let w=u.morphTargetsRelative?1:1-A;d.getUniforms().setValue(e,"morphTargetBaseInfluence",w),d.getUniforms().setValue(e,"morphTargetInfluences",r)}}return{update:l}}function LAe(e,t,i,n){let r=new WeakMap;function s(l){let c=n.render.frame,u=l.geometry,h=t.get(l,u);return r.get(h)!==c&&(t.update(h),r.set(h,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",o)===!1&&l.addEventListener("dispose",o),i.update(l.instanceMatrix,34962),l.instanceColor!==null&&i.update(l.instanceColor,34962)),h}function a(){r=new WeakMap}function o(l){let c=l.target;c.removeEventListener("dispose",o),i.remove(c.instanceMatrix),c.instanceColor!==null&&i.remove(c.instanceColor)}return{update:s,dispose:a}}var $J=new Hr,eZ=new YJ,tZ=new _be,iZ=new O4,F8=[],V8=[],H8=new Float32Array(16),G8=new Float32Array(9),k8=new Float32Array(4);function Rb(e,t,i){let n=e[0];if(n==null||n<=0||n>0)return e;let r=t*i,s=F8[r];if(s===void 0&&(s=new Float32Array(r),F8[r]=s),t!==0){n.toArray(s,0);for(let a=1,o=0;a!==t;++a)o+=i,e[a].toArray(s,o)}return s}function ea(e,t){if(e.length!==t.length)return!1;for(let i=0,n=e.length;i<n;i++)if(e[i]!==t[i])return!1;return!0}function ta(e,t){for(let i=0,n=t.length;i<n;i++)e[i]=t[i]}function jR(e,t){let i=V8[t];i===void 0&&(i=new Int32Array(t),V8[t]=i);for(let n=0;n!==t;++n)i[n]=e.allocateTextureUnit();return i}function UAe(e,t){let i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function NAe(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(ea(i,t))return;e.uniform2fv(this.addr,t),ta(i,t)}}function zAe(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(t.r!==void 0)(i[0]!==t.r||i[1]!==t.g||i[2]!==t.b)&&(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(ea(i,t))return;e.uniform3fv(this.addr,t),ta(i,t)}}function FAe(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(ea(i,t))return;e.uniform4fv(this.addr,t),ta(i,t)}}function VAe(e,t){let i=this.cache,n=t.elements;if(n===void 0){if(ea(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),ta(i,t)}else{if(ea(i,n))return;k8.set(n),e.uniformMatrix2fv(this.addr,!1,k8),ta(i,n)}}function HAe(e,t){let i=this.cache,n=t.elements;if(n===void 0){if(ea(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),ta(i,t)}else{if(ea(i,n))return;G8.set(n),e.uniformMatrix3fv(this.addr,!1,G8),ta(i,n)}}function GAe(e,t){let i=this.cache,n=t.elements;if(n===void 0){if(ea(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),ta(i,t)}else{if(ea(i,n))return;H8.set(n),e.uniformMatrix4fv(this.addr,!1,H8),ta(i,n)}}function kAe(e,t){let i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function jAe(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2i(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(ea(i,t))return;e.uniform2iv(this.addr,t),ta(i,t)}}function WAe(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3i(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(ea(i,t))return;e.uniform3iv(this.addr,t),ta(i,t)}}function XAe(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(ea(i,t))return;e.uniform4iv(this.addr,t),ta(i,t)}}function qAe(e,t){let i=this.cache;i[0]!==t&&(e.uniform1ui(this.addr,t),i[0]=t)}function YAe(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2ui(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(ea(i,t))return;e.uniform2uiv(this.addr,t),ta(i,t)}}function QAe(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3ui(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(ea(i,t))return;e.uniform3uiv(this.addr,t),ta(i,t)}}function KAe(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(ea(i,t))return;e.uniform4uiv(this.addr,t),ta(i,t)}}function JAe(e,t,i){let n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTexture2D(t||$J,r)}function ZAe(e,t,i){let n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTexture3D(t||tZ,r)}function $Ae(e,t,i){let n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTextureCube(t||iZ,r)}function ewe(e,t,i){let n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTexture2DArray(t||eZ,r)}function twe(e){switch(e){case 5126:return UAe;case 35664:return NAe;case 35665:return zAe;case 35666:return FAe;case 35674:return VAe;case 35675:return HAe;case 35676:return GAe;case 5124:case 35670:return kAe;case 35667:case 35671:return jAe;case 35668:case 35672:return WAe;case 35669:case 35673:return XAe;case 5125:return qAe;case 36294:return YAe;case 36295:return QAe;case 36296:return KAe;case 35678:case 36198:case 36298:case 36306:case 35682:return JAe;case 35679:case 36299:case 36307:return ZAe;case 35680:case 36300:case 36308:case 36293:return $Ae;case 36289:case 36303:case 36311:case 36292:return ewe}}function iwe(e,t){e.uniform1fv(this.addr,t)}function nwe(e,t){let i=Rb(t,this.size,2);e.uniform2fv(this.addr,i)}function rwe(e,t){let i=Rb(t,this.size,3);e.uniform3fv(this.addr,i)}function swe(e,t){let i=Rb(t,this.size,4);e.uniform4fv(this.addr,i)}function awe(e,t){let i=Rb(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function owe(e,t){let i=Rb(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function lwe(e,t){let i=Rb(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function cwe(e,t){e.uniform1iv(this.addr,t)}function uwe(e,t){e.uniform2iv(this.addr,t)}function hwe(e,t){e.uniform3iv(this.addr,t)}function dwe(e,t){e.uniform4iv(this.addr,t)}function fwe(e,t){e.uniform1uiv(this.addr,t)}function pwe(e,t){e.uniform2uiv(this.addr,t)}function mwe(e,t){e.uniform3uiv(this.addr,t)}function gwe(e,t){e.uniform4uiv(this.addr,t)}function vwe(e,t,i){let n=this.cache,r=t.length,s=jR(i,r);ea(n,s)||(e.uniform1iv(this.addr,s),ta(n,s));for(let a=0;a!==r;++a)i.setTexture2D(t[a]||$J,s[a])}function ywe(e,t,i){let n=this.cache,r=t.length,s=jR(i,r);ea(n,s)||(e.uniform1iv(this.addr,s),ta(n,s));for(let a=0;a!==r;++a)i.setTexture3D(t[a]||tZ,s[a])}function xwe(e,t,i){let n=this.cache,r=t.length,s=jR(i,r);ea(n,s)||(e.uniform1iv(this.addr,s),ta(n,s));for(let a=0;a!==r;++a)i.setTextureCube(t[a]||iZ,s[a])}function bwe(e,t,i){let n=this.cache,r=t.length,s=jR(i,r);ea(n,s)||(e.uniform1iv(this.addr,s),ta(n,s));for(let a=0;a!==r;++a)i.setTexture2DArray(t[a]||eZ,s[a])}function Swe(e){switch(e){case 5126:return iwe;case 35664:return nwe;case 35665:return rwe;case 35666:return swe;case 35674:return awe;case 35675:return owe;case 35676:return lwe;case 5124:case 35670:return cwe;case 35667:case 35671:return uwe;case 35668:case 35672:return hwe;case 35669:case 35673:return dwe;case 5125:return fwe;case 36294:return pwe;case 36295:return mwe;case 36296:return gwe;case 35678:case 36198:case 36298:case 36306:case 35682:return vwe;case 35679:case 36299:case 36307:return ywe;case 35680:case 36300:case 36308:case 36293:return xwe;case 36289:case 36303:case 36311:case 36292:return bwe}}var _we=class{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=twe(t.type)}},Awe=class{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=Swe(t.type)}},wwe=class{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){if(t===void 0)return;let n=this.seq;for(let r=0,s=n.length;r!==s;++r){let a=n[r];a.setValue(e,t[a.id],i)}}},cI=/(\w+)(\])?(\[|\.)?/g;function j8(e,t){e.seq.push(t),e.map[t.id]=t}function Mwe(e,t,i){let n=e.name,r=n.length;for(cI.lastIndex=0;;){let s=cI.exec(n),a=cI.lastIndex,o=s[1],l=s[2]==="]",c=s[3];if(l&&(o=o|0),c===void 0||c==="["&&a+2===r){j8(i,c===void 0?new _we(o,e,t):new Awe(o,e,t));break}else{let u=i.map[o];u===void 0&&(u=new wwe(o),j8(i,u)),i=u}}}var IC=class{constructor(e,t){this.seq=[],this.map={};let i=e.getProgramParameter(t,35718);for(let n=0;n<i;++n){let r=e.getActiveUniform(t,n),s=e.getUniformLocation(t,r.name);Mwe(r,s,this)}}setValue(e,t,i,n){let r=this.map[t];r!==void 0&&r.setValue(e,i,n)}setOptional(e,t,i){let n=t[i];n!==void 0&&this.setValue(e,i,n)}static upload(e,t,i,n){for(let r=0,s=t.length;r!==s;++r){let a=t[r],o=i[a.id];o.needsUpdate!==!1&&a.setValue(e,o.value,n)}}static seqWithValue(e,t){let i=[];for(let n=0,r=e.length;n!==r;++n){let s=e[n];s.id in t&&i.push(s)}return i}};function W8(e,t,i){let n=e.createShader(t);return e.shaderSource(n,i),e.compileShader(n),n}var Ewe=0;function Twe(e,t){let i=e.split(`
`),n=[],r=Math.max(t-6,0),s=Math.min(t+6,i.length);for(let a=r;a<s;a++){let o=a+1;n.push(`${o===t?">":" "} ${o}: ${i[a]}`)}return n.join(`
`)}function Cwe(e){switch(e){case $u:return["Linear","( value )"];case Gi:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function X8(e,t,i){let n=e.getShaderParameter(t,35713),r=e.getShaderInfoLog(t).trim();if(n&&r==="")return"";let s=/ERROR: 0:(\d+)/.exec(r);if(s){let a=parseInt(s[1]);return i.toUpperCase()+`

`+r+`

`+Twe(e.getShaderSource(t),a)}else return r}function Dwe(e,t){let i=Cwe(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function Rwe(e,t){let i;switch(t){case N1e:i="Linear";break;case z1e:i="Reinhard";break;case F1e:i="OptimizedCineon";break;case V1e:i="ACESFilmic";break;case H1e:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),i="Linear"}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function Pwe(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||e.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(oA).join(`
`)}function Owe(e){let t=[];for(let i in e){let n=e[i];n!==!1&&t.push("#define "+i+" "+n)}return t.join(`
`)}function Bwe(e,t){let i={},n=e.getProgramParameter(t,35721);for(let r=0;r<n;r++){let s=e.getActiveAttrib(t,r),a=s.name,o=1;s.type===35674&&(o=2),s.type===35675&&(o=3),s.type===35676&&(o=4),i[a]={type:s.type,location:e.getAttribLocation(t,a),locationSize:o}}return i}function oA(e){return e!==""}function q8(e,t){let i=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Y8(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var Iwe=/^[ \t]*#include +<([\w\d./]+)>/gm;function WU(e){return e.replace(Iwe,Lwe)}function Lwe(e,t){let i=Xi[t];if(i===void 0)throw new Error("Can not resolve #include <"+t+">");return WU(i)}var Uwe=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Q8(e){return e.replace(Uwe,Nwe)}function Nwe(e,t,i,n){let r="";for(let s=parseInt(t);s<parseInt(i);s++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function K8(e){let t="precision "+e.precision+` float;
precision `+e.precision+" int;";return e.precision==="highp"?t+=`
#define HIGH_PRECISION`:e.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:e.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function zwe(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===T4?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===m1e?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===aA&&(t="SHADOWMAP_TYPE_VSM"),t}function Fwe(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case B0:case I0:t="ENVMAP_TYPE_CUBE";break;case rM:t="ENVMAP_TYPE_CUBE_UV";break}return t}function Vwe(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case I0:t="ENVMAP_MODE_REFRACTION";break}return t}function Hwe(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case UJ:t="ENVMAP_BLENDING_MULTIPLY";break;case L1e:t="ENVMAP_BLENDING_MIX";break;case U1e:t="ENVMAP_BLENDING_ADD";break}return t}function Gwe(e){let t=e.envMapCubeUVHeight;if(t===null)return null;let i=Math.log2(t)-2,n=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,i),7*16)),texelHeight:n,maxMip:i}}function kwe(e,t,i,n){let r=e.getContext(),s=i.defines,a=i.vertexShader,o=i.fragmentShader,l=zwe(i),c=Fwe(i),u=Vwe(i),h=Hwe(i),d=Gwe(i),p=i.isWebGL2?"":Pwe(i),g=Owe(s),x=r.createProgram(),y,b,A=i.glslVersion?"#version "+i.glslVersion+`
`:"";i.isRawShaderMaterial?(y=[g].filter(oA).join(`
`),y.length>0&&(y+=`
`),b=[p,g].filter(oA).join(`
`),b.length>0&&(b+=`
`)):(y=[K8(i),"#define SHADER_NAME "+i.shaderName,g,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+u:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(oA).join(`
`),b=[p,K8(i),"#define SHADER_NAME "+i.shaderName,g,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.envMap?"#define "+u:"",i.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==md?"#define TONE_MAPPING":"",i.toneMapping!==md?Xi.tonemapping_pars_fragment:"",i.toneMapping!==md?Rwe("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",Xi.encodings_pars_fragment,Dwe("linearToOutputTexel",i.outputEncoding),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(oA).join(`
`)),a=WU(a),a=q8(a,i),a=Y8(a,i),o=WU(o),o=q8(o,i),o=Y8(o,i),a=Q8(a),o=Q8(o),i.isWebGL2&&i.isRawShaderMaterial!==!0&&(A=`#version 300 es
`,y=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+y,b=["#define varying in",i.glslVersion===GU?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===GU?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+b);let w=A+y+a,E=A+b+o,D=W8(r,35633,w),T=W8(r,35632,E);if(r.attachShader(x,D),r.attachShader(x,T),i.index0AttributeName!==void 0?r.bindAttribLocation(x,0,i.index0AttributeName):i.morphTargets===!0&&r.bindAttribLocation(x,0,"position"),r.linkProgram(x),e.debug.checkShaderErrors){let O=r.getProgramInfoLog(x).trim(),P=r.getShaderInfoLog(D).trim(),U=r.getShaderInfoLog(T).trim(),H=!0,V=!0;if(r.getProgramParameter(x,35714)===!1){H=!1;let j=X8(r,D,"vertex"),J=X8(r,T,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(x,35715)+`

Program Info Log: `+O+`
`+j+`
`+J)}else O!==""?console.warn("THREE.WebGLProgram: Program Info Log:",O):(P===""||U==="")&&(V=!1);V&&(this.diagnostics={runnable:H,programLog:O,vertexShader:{log:P,prefix:y},fragmentShader:{log:U,prefix:b}})}r.deleteShader(D),r.deleteShader(T);let I;this.getUniforms=function(){return I===void 0&&(I=new IC(r,x)),I};let R;return this.getAttributes=function(){return R===void 0&&(R=Bwe(r,x)),R},this.destroy=function(){n.releaseStatesOfProgram(this),r.deleteProgram(x),this.program=void 0},this.name=i.shaderName,this.id=Ewe++,this.cacheKey=t,this.usedTimes=1,this.program=x,this.vertexShader=D,this.fragmentShader=T,this}var jwe=0,Wwe=class{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){let t=e.vertexShader,i=e.fragmentShader,n=this._getShaderStage(t),r=this._getShaderStage(i),s=this._getShaderCacheForMaterial(e);return s.has(n)===!1&&(s.add(n),n.usedTimes++),s.has(r)===!1&&(s.add(r),r.usedTimes++),this}remove(e){let t=this.materialCache.get(e);for(let i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){let t=this.materialCache,i=t.get(e);return i===void 0&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){let t=this.shaderCache,i=t.get(e);return i===void 0&&(i=new Xwe(e),t.set(e,i)),i}},Xwe=class{constructor(e){this.id=jwe++,this.code=e,this.usedTimes=0}};function qwe(e,t,i,n,r,s,a){let o=new P4,l=new Wwe,c=[],u=r.isWebGL2,h=r.logarithmicDepthBuffer,d=r.vertexTextures,p=r.precision,g={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function x(R,O,P,U,H){let V=U.fog,j=H.geometry,J=R.isMeshStandardMaterial?U.environment:null,F=(R.isMeshStandardMaterial?i:t).get(R.envMap||J),X=F&&F.mapping===rM?F.image.height:null,W=g[R.type];R.precision!==null&&(p=r.getMaxPrecision(R.precision),p!==R.precision&&console.warn("THREE.WebGLProgram.getParameters:",R.precision,"not supported, using",p,"instead."));let ne=j.morphAttributes.position||j.morphAttributes.normal||j.morphAttributes.color,Y=ne!==void 0?ne.length:0,$=0;j.morphAttributes.position!==void 0&&($=1),j.morphAttributes.normal!==void 0&&($=2),j.morphAttributes.color!==void 0&&($=3);let se,fe,te,de;if(W){let Me=nd[W];se=Me.vertexShader,fe=Me.fragmentShader}else se=R.vertexShader,fe=R.fragmentShader,l.update(R),te=l.getVertexShaderID(R),de=l.getFragmentShaderID(R);let le=e.getRenderTarget(),_e=R.alphaTest>0,be=R.clearcoat>0,we=R.iridescence>0;return{isWebGL2:u,shaderID:W,shaderName:R.type,vertexShader:se,fragmentShader:fe,defines:R.defines,customVertexShaderID:te,customFragmentShaderID:de,isRawShaderMaterial:R.isRawShaderMaterial===!0,glslVersion:R.glslVersion,precision:p,instancing:H.isInstancedMesh===!0,instancingColor:H.isInstancedMesh===!0&&H.instanceColor!==null,supportsVertexTextures:d,outputEncoding:le===null?e.outputEncoding:le.isXRRenderTarget===!0?le.texture.encoding:$u,map:!!R.map,matcap:!!R.matcap,envMap:!!F,envMapMode:F&&F.mapping,envMapCubeUVHeight:X,lightMap:!!R.lightMap,aoMap:!!R.aoMap,emissiveMap:!!R.emissiveMap,bumpMap:!!R.bumpMap,normalMap:!!R.normalMap,objectSpaceNormalMap:R.normalMapType===nbe,tangentSpaceNormalMap:R.normalMapType===ibe,decodeVideoTexture:!!R.map&&R.map.isVideoTexture===!0&&R.map.encoding===Gi,clearcoat:be,clearcoatMap:be&&!!R.clearcoatMap,clearcoatRoughnessMap:be&&!!R.clearcoatRoughnessMap,clearcoatNormalMap:be&&!!R.clearcoatNormalMap,iridescence:we,iridescenceMap:we&&!!R.iridescenceMap,iridescenceThicknessMap:we&&!!R.iridescenceThicknessMap,displacementMap:!!R.displacementMap,roughnessMap:!!R.roughnessMap,metalnessMap:!!R.metalnessMap,specularMap:!!R.specularMap,specularIntensityMap:!!R.specularIntensityMap,specularColorMap:!!R.specularColorMap,opaque:R.transparent===!1&&R.blending===x0,alphaMap:!!R.alphaMap,alphaTest:_e,gradientMap:!!R.gradientMap,sheen:R.sheen>0,sheenColorMap:!!R.sheenColorMap,sheenRoughnessMap:!!R.sheenRoughnessMap,transmission:R.transmission>0,transmissionMap:!!R.transmissionMap,thicknessMap:!!R.thicknessMap,combine:R.combine,vertexTangents:!!R.normalMap&&!!j.attributes.tangent,vertexColors:R.vertexColors,vertexAlphas:R.vertexColors===!0&&!!j.attributes.color&&j.attributes.color.itemSize===4,vertexUvs:!!R.map||!!R.bumpMap||!!R.normalMap||!!R.specularMap||!!R.alphaMap||!!R.emissiveMap||!!R.roughnessMap||!!R.metalnessMap||!!R.clearcoatMap||!!R.clearcoatRoughnessMap||!!R.clearcoatNormalMap||!!R.iridescenceMap||!!R.iridescenceThicknessMap||!!R.displacementMap||!!R.transmissionMap||!!R.thicknessMap||!!R.specularIntensityMap||!!R.specularColorMap||!!R.sheenColorMap||!!R.sheenRoughnessMap,uvsVertexOnly:!(R.map||R.bumpMap||R.normalMap||R.specularMap||R.alphaMap||R.emissiveMap||R.roughnessMap||R.metalnessMap||R.clearcoatNormalMap||R.iridescenceMap||R.iridescenceThicknessMap||R.transmission>0||R.transmissionMap||R.thicknessMap||R.specularIntensityMap||R.specularColorMap||R.sheen>0||R.sheenColorMap||R.sheenRoughnessMap)&&!!R.displacementMap,fog:!!V,useFog:R.fog===!0,fogExp2:V&&V.isFogExp2,flatShading:!!R.flatShading,sizeAttenuation:R.sizeAttenuation,logarithmicDepthBuffer:h,skinning:H.isSkinnedMesh===!0,morphTargets:j.morphAttributes.position!==void 0,morphNormals:j.morphAttributes.normal!==void 0,morphColors:j.morphAttributes.color!==void 0,morphTargetsCount:Y,morphTextureStride:$,numDirLights:O.directional.length,numPointLights:O.point.length,numSpotLights:O.spot.length,numSpotLightMaps:O.spotLightMap.length,numRectAreaLights:O.rectArea.length,numHemiLights:O.hemi.length,numDirLightShadows:O.directionalShadowMap.length,numPointLightShadows:O.pointShadowMap.length,numSpotLightShadows:O.spotShadowMap.length,numSpotLightShadowsWithMaps:O.numSpotLightShadowsWithMaps,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:R.dithering,shadowMapEnabled:e.shadowMap.enabled&&P.length>0,shadowMapType:e.shadowMap.type,toneMapping:R.toneMapped?e.toneMapping:md,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:R.premultipliedAlpha,doubleSided:R.side===yo,flipSided:R.side===va,useDepthPacking:!!R.depthPacking,depthPacking:R.depthPacking||0,index0AttributeName:R.index0AttributeName,extensionDerivatives:R.extensions&&R.extensions.derivatives,extensionFragDepth:R.extensions&&R.extensions.fragDepth,extensionDrawBuffers:R.extensions&&R.extensions.drawBuffers,extensionShaderTextureLOD:R.extensions&&R.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||n.has("EXT_shader_texture_lod"),customProgramCacheKey:R.customProgramCacheKey()}}function y(R){let O=[];if(R.shaderID?O.push(R.shaderID):(O.push(R.customVertexShaderID),O.push(R.customFragmentShaderID)),R.defines!==void 0)for(let P in R.defines)O.push(P),O.push(R.defines[P]);return R.isRawShaderMaterial===!1&&(b(O,R),A(O,R),O.push(e.outputEncoding)),O.push(R.customProgramCacheKey),O.join()}function b(R,O){R.push(O.precision),R.push(O.outputEncoding),R.push(O.envMapMode),R.push(O.envMapCubeUVHeight),R.push(O.combine),R.push(O.vertexUvs),R.push(O.fogExp2),R.push(O.sizeAttenuation),R.push(O.morphTargetsCount),R.push(O.morphAttributeCount),R.push(O.numDirLights),R.push(O.numPointLights),R.push(O.numSpotLights),R.push(O.numSpotLightMaps),R.push(O.numHemiLights),R.push(O.numRectAreaLights),R.push(O.numDirLightShadows),R.push(O.numPointLightShadows),R.push(O.numSpotLightShadows),R.push(O.numSpotLightShadowsWithMaps),R.push(O.shadowMapType),R.push(O.toneMapping),R.push(O.numClippingPlanes),R.push(O.numClipIntersection),R.push(O.depthPacking)}function A(R,O){o.disableAll(),O.isWebGL2&&o.enable(0),O.supportsVertexTextures&&o.enable(1),O.instancing&&o.enable(2),O.instancingColor&&o.enable(3),O.map&&o.enable(4),O.matcap&&o.enable(5),O.envMap&&o.enable(6),O.lightMap&&o.enable(7),O.aoMap&&o.enable(8),O.emissiveMap&&o.enable(9),O.bumpMap&&o.enable(10),O.normalMap&&o.enable(11),O.objectSpaceNormalMap&&o.enable(12),O.tangentSpaceNormalMap&&o.enable(13),O.clearcoat&&o.enable(14),O.clearcoatMap&&o.enable(15),O.clearcoatRoughnessMap&&o.enable(16),O.clearcoatNormalMap&&o.enable(17),O.iridescence&&o.enable(18),O.iridescenceMap&&o.enable(19),O.iridescenceThicknessMap&&o.enable(20),O.displacementMap&&o.enable(21),O.specularMap&&o.enable(22),O.roughnessMap&&o.enable(23),O.metalnessMap&&o.enable(24),O.gradientMap&&o.enable(25),O.alphaMap&&o.enable(26),O.alphaTest&&o.enable(27),O.vertexColors&&o.enable(28),O.vertexAlphas&&o.enable(29),O.vertexUvs&&o.enable(30),O.vertexTangents&&o.enable(31),O.uvsVertexOnly&&o.enable(32),R.push(o.mask),o.disableAll(),O.fog&&o.enable(0),O.useFog&&o.enable(1),O.flatShading&&o.enable(2),O.logarithmicDepthBuffer&&o.enable(3),O.skinning&&o.enable(4),O.morphTargets&&o.enable(5),O.morphNormals&&o.enable(6),O.morphColors&&o.enable(7),O.premultipliedAlpha&&o.enable(8),O.shadowMapEnabled&&o.enable(9),O.physicallyCorrectLights&&o.enable(10),O.doubleSided&&o.enable(11),O.flipSided&&o.enable(12),O.useDepthPacking&&o.enable(13),O.dithering&&o.enable(14),O.specularIntensityMap&&o.enable(15),O.specularColorMap&&o.enable(16),O.transmission&&o.enable(17),O.transmissionMap&&o.enable(18),O.thicknessMap&&o.enable(19),O.sheen&&o.enable(20),O.sheenColorMap&&o.enable(21),O.sheenRoughnessMap&&o.enable(22),O.decodeVideoTexture&&o.enable(23),O.opaque&&o.enable(24),R.push(o.mask)}function w(R){let O=g[R.type],P;if(O){let U=nd[O];P=Db.clone(U.uniforms)}else P=R.uniforms;return P}function E(R,O){let P;for(let U=0,H=c.length;U<H;U++){let V=c[U];if(V.cacheKey===O){P=V,++P.usedTimes;break}}return P===void 0&&(P=new kwe(e,O,R,s),c.push(P)),P}function D(R){if(--R.usedTimes===0){let O=c.indexOf(R);c[O]=c[c.length-1],c.pop(),R.destroy()}}function T(R){l.remove(R)}function I(){l.dispose()}return{getParameters:x,getProgramCacheKey:y,getUniforms:w,acquireProgram:E,releaseProgram:D,releaseShaderCache:T,programs:c,dispose:I}}function Ywe(){let e=new WeakMap;function t(s){let a=e.get(s);return a===void 0&&(a={},e.set(s,a)),a}function i(s){e.delete(s)}function n(s,a,o){e.get(s)[a]=o}function r(){e=new WeakMap}return{get:t,remove:i,update:n,dispose:r}}function Qwe(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function J8(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Z8(){let e=[],t=0,i=[],n=[],r=[];function s(){t=0,i.length=0,n.length=0,r.length=0}function a(h,d,p,g,x,y){let b=e[t];return b===void 0?(b={id:h.id,object:h,geometry:d,material:p,groupOrder:g,renderOrder:h.renderOrder,z:x,group:y},e[t]=b):(b.id=h.id,b.object=h,b.geometry=d,b.material=p,b.groupOrder=g,b.renderOrder=h.renderOrder,b.z=x,b.group=y),t++,b}function o(h,d,p,g,x,y){let b=a(h,d,p,g,x,y);p.transmission>0?n.push(b):p.transparent===!0?r.push(b):i.push(b)}function l(h,d,p,g,x,y){let b=a(h,d,p,g,x,y);p.transmission>0?n.unshift(b):p.transparent===!0?r.unshift(b):i.unshift(b)}function c(h,d){i.length>1&&i.sort(h||Qwe),n.length>1&&n.sort(d||J8),r.length>1&&r.sort(d||J8)}function u(){for(let h=t,d=e.length;h<d;h++){let p=e[h];if(p.id===null)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.group=null}}return{opaque:i,transmissive:n,transparent:r,init:s,push:o,unshift:l,finish:u,sort:c}}function Kwe(){let e=new WeakMap;function t(n,r){let s=e.get(n),a;return s===void 0?(a=new Z8,e.set(n,[a])):r>=s.length?(a=new Z8,s.push(a)):a=s[r],a}function i(){e=new WeakMap}return{get:t,dispose:i}}function Jwe(){let e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let i;switch(t.type){case"DirectionalLight":i={direction:new G,color:new gi};break;case"SpotLight":i={position:new G,direction:new G,color:new gi,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new G,color:new gi,distance:0,decay:0};break;case"HemisphereLight":i={direction:new G,skyColor:new gi,groundColor:new gi};break;case"RectAreaLight":i={color:new gi,position:new G,halfWidth:new G,halfHeight:new G};break}return e[t.id]=i,i}}}function Zwe(){let e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let i;switch(t.type){case"DirectionalLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ae};break;case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ae};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ae,shadowCameraNear:1,shadowCameraFar:1e3};break}return e[t.id]=i,i}}}var $we=0;function eMe(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function tMe(e,t){let i=new Jwe,n=Zwe(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let u=0;u<9;u++)r.probe.push(new G);let s=new G,a=new Bt,o=new Bt;function l(u,h){let d=0,p=0,g=0;for(let U=0;U<9;U++)r.probe[U].set(0,0,0);let x=0,y=0,b=0,A=0,w=0,E=0,D=0,T=0,I=0,R=0;u.sort(eMe);let O=h!==!0?Math.PI:1;for(let U=0,H=u.length;U<H;U++){let V=u[U],j=V.color,J=V.intensity,F=V.distance,X=V.shadow&&V.shadow.map?V.shadow.map.texture:null;if(V.isAmbientLight)d+=j.r*J*O,p+=j.g*J*O,g+=j.b*J*O;else if(V.isLightProbe)for(let W=0;W<9;W++)r.probe[W].addScaledVector(V.sh.coefficients[W],J);else if(V.isDirectionalLight){let W=i.get(V);if(W.color.copy(V.color).multiplyScalar(V.intensity*O),V.castShadow){let ne=V.shadow,Y=n.get(V);Y.shadowBias=ne.bias,Y.shadowNormalBias=ne.normalBias,Y.shadowRadius=ne.radius,Y.shadowMapSize=ne.mapSize,r.directionalShadow[x]=Y,r.directionalShadowMap[x]=X,r.directionalShadowMatrix[x]=V.shadow.matrix,E++}r.directional[x]=W,x++}else if(V.isSpotLight){let W=i.get(V);W.position.setFromMatrixPosition(V.matrixWorld),W.color.copy(j).multiplyScalar(J*O),W.distance=F,W.coneCos=Math.cos(V.angle),W.penumbraCos=Math.cos(V.angle*(1-V.penumbra)),W.decay=V.decay,r.spot[b]=W;let ne=V.shadow;if(V.map&&(r.spotLightMap[I]=V.map,I++,ne.updateMatrices(V),V.castShadow&&R++),r.spotLightMatrix[b]=ne.matrix,V.castShadow){let Y=n.get(V);Y.shadowBias=ne.bias,Y.shadowNormalBias=ne.normalBias,Y.shadowRadius=ne.radius,Y.shadowMapSize=ne.mapSize,r.spotShadow[b]=Y,r.spotShadowMap[b]=X,T++}b++}else if(V.isRectAreaLight){let W=i.get(V);W.color.copy(j).multiplyScalar(J),W.halfWidth.set(V.width*.5,0,0),W.halfHeight.set(0,V.height*.5,0),r.rectArea[A]=W,A++}else if(V.isPointLight){let W=i.get(V);if(W.color.copy(V.color).multiplyScalar(V.intensity*O),W.distance=V.distance,W.decay=V.decay,V.castShadow){let ne=V.shadow,Y=n.get(V);Y.shadowBias=ne.bias,Y.shadowNormalBias=ne.normalBias,Y.shadowRadius=ne.radius,Y.shadowMapSize=ne.mapSize,Y.shadowCameraNear=ne.camera.near,Y.shadowCameraFar=ne.camera.far,r.pointShadow[y]=Y,r.pointShadowMap[y]=X,r.pointShadowMatrix[y]=V.shadow.matrix,D++}r.point[y]=W,y++}else if(V.isHemisphereLight){let W=i.get(V);W.skyColor.copy(V.color).multiplyScalar(J*O),W.groundColor.copy(V.groundColor).multiplyScalar(J*O),r.hemi[w]=W,w++}}A>0&&(t.isWebGL2||e.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=zt.LTC_FLOAT_1,r.rectAreaLTC2=zt.LTC_FLOAT_2):e.has("OES_texture_half_float_linear")===!0?(r.rectAreaLTC1=zt.LTC_HALF_1,r.rectAreaLTC2=zt.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=d,r.ambient[1]=p,r.ambient[2]=g;let P=r.hash;(P.directionalLength!==x||P.pointLength!==y||P.spotLength!==b||P.rectAreaLength!==A||P.hemiLength!==w||P.numDirectionalShadows!==E||P.numPointShadows!==D||P.numSpotShadows!==T||P.numSpotMaps!==I)&&(r.directional.length=x,r.spot.length=b,r.rectArea.length=A,r.point.length=y,r.hemi.length=w,r.directionalShadow.length=E,r.directionalShadowMap.length=E,r.pointShadow.length=D,r.pointShadowMap.length=D,r.spotShadow.length=T,r.spotShadowMap.length=T,r.directionalShadowMatrix.length=E,r.pointShadowMatrix.length=D,r.spotLightMatrix.length=T+I-R,r.spotLightMap.length=I,r.numSpotLightShadowsWithMaps=R,P.directionalLength=x,P.pointLength=y,P.spotLength=b,P.rectAreaLength=A,P.hemiLength=w,P.numDirectionalShadows=E,P.numPointShadows=D,P.numSpotShadows=T,P.numSpotMaps=I,r.version=$we++)}function c(u,h){let d=0,p=0,g=0,x=0,y=0,b=h.matrixWorldInverse;for(let A=0,w=u.length;A<w;A++){let E=u[A];if(E.isDirectionalLight){let D=r.directional[d];D.direction.setFromMatrixPosition(E.matrixWorld),s.setFromMatrixPosition(E.target.matrixWorld),D.direction.sub(s),D.direction.transformDirection(b),d++}else if(E.isSpotLight){let D=r.spot[g];D.position.setFromMatrixPosition(E.matrixWorld),D.position.applyMatrix4(b),D.direction.setFromMatrixPosition(E.matrixWorld),s.setFromMatrixPosition(E.target.matrixWorld),D.direction.sub(s),D.direction.transformDirection(b),g++}else if(E.isRectAreaLight){let D=r.rectArea[x];D.position.setFromMatrixPosition(E.matrixWorld),D.position.applyMatrix4(b),o.identity(),a.copy(E.matrixWorld),a.premultiply(b),o.extractRotation(a),D.halfWidth.set(E.width*.5,0,0),D.halfHeight.set(0,E.height*.5,0),D.halfWidth.applyMatrix4(o),D.halfHeight.applyMatrix4(o),x++}else if(E.isPointLight){let D=r.point[p];D.position.setFromMatrixPosition(E.matrixWorld),D.position.applyMatrix4(b),p++}else if(E.isHemisphereLight){let D=r.hemi[y];D.direction.setFromMatrixPosition(E.matrixWorld),D.direction.transformDirection(b),y++}}}return{setup:l,setupView:c,state:r}}function $8(e,t){let i=new tMe(e,t),n=[],r=[];function s(){n.length=0,r.length=0}function a(u){n.push(u)}function o(u){r.push(u)}function l(u){i.setup(n,u)}function c(u){i.setupView(n,u)}return{init:s,state:{lightsArray:n,shadowsArray:r,lights:i},setupLights:l,setupLightsView:c,pushLight:a,pushShadow:o}}function iMe(e,t){let i=new WeakMap;function n(s,a=0){let o=i.get(s),l;return o===void 0?(l=new $8(e,t),i.set(s,[l])):a>=o.length?(l=new $8(e,t),o.push(l)):l=o[a],l}function r(){i=new WeakMap}return{get:n,dispose:r}}var nZ=class extends sM{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=cp,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}},nMe=class extends sM{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new G,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}},rMe=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,sMe=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function aMe(e,t,i){let n=new B4,r=new Ae,s=new Ae,a=new Di,o=new nZ({depthPacking:GJ}),l=new nMe,c={},u=i.maxTextureSize,h={[Zu]:va,[va]:Zu,[yo]:yo},d=new vn({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Ae},radius:{value:4}},vertexShader:rMe,fragmentShader:sMe}),p=d.clone();p.defines.HORIZONTAL_PASS=1;let g=new ii;g.setAttribute("position",new vi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let x=new fr(g,d),y=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=T4,this.render=function(E,D,T){if(y.enabled===!1||y.autoUpdate===!1&&y.needsUpdate===!1||E.length===0)return;let I=e.getRenderTarget(),R=e.getActiveCubeFace(),O=e.getActiveMipmapLevel(),P=e.state;P.setBlending(Rs),P.buffers.color.setClear(1,1,1,1),P.buffers.depth.setTest(!0),P.setScissorTest(!1);for(let U=0,H=E.length;U<H;U++){let V=E[U],j=V.shadow;if(j===void 0){console.warn("THREE.WebGLShadowMap:",V,"has no shadow.");continue}if(j.autoUpdate===!1&&j.needsUpdate===!1)continue;r.copy(j.mapSize);let J=j.getFrameExtents();if(r.multiply(J),s.copy(j.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(s.x=Math.floor(u/J.x),r.x=s.x*J.x,j.mapSize.x=s.x),r.y>u&&(s.y=Math.floor(u/J.y),r.y=s.y*J.y,j.mapSize.y=s.y)),j.map===null){let X=this.type!==aA?{minFilter:rn,magFilter:rn}:{};j.map=new mn(r.x,r.y,X),j.map.texture.name=V.name+".shadowMap",j.camera.updateProjectionMatrix()}e.setRenderTarget(j.map),e.clear();let F=j.getViewportCount();for(let X=0;X<F;X++){let W=j.getViewport(X);a.set(s.x*W.x,s.y*W.y,s.x*W.z,s.y*W.w),P.viewport(a),j.updateMatrices(V,X),n=j.getFrustum(),w(D,T,j.camera,V,this.type)}j.isPointLightShadow!==!0&&this.type===aA&&b(j,T),j.needsUpdate=!1}y.needsUpdate=!1,e.setRenderTarget(I,R,O)};function b(E,D){let T=t.update(x);d.defines.VSM_SAMPLES!==E.blurSamples&&(d.defines.VSM_SAMPLES=E.blurSamples,p.defines.VSM_SAMPLES=E.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),E.mapPass===null&&(E.mapPass=new mn(r.x,r.y)),d.uniforms.shadow_pass.value=E.map.texture,d.uniforms.resolution.value=E.mapSize,d.uniforms.radius.value=E.radius,e.setRenderTarget(E.mapPass),e.clear(),e.renderBufferDirect(D,null,T,d,x,null),p.uniforms.shadow_pass.value=E.mapPass.texture,p.uniforms.resolution.value=E.mapSize,p.uniforms.radius.value=E.radius,e.setRenderTarget(E.map),e.clear(),e.renderBufferDirect(D,null,T,p,x,null)}function A(E,D,T,I,R,O){let P=null,U=T.isPointLight===!0?E.customDistanceMaterial:E.customDepthMaterial;if(U!==void 0)P=U;else if(P=T.isPointLight===!0?l:o,e.localClippingEnabled&&D.clipShadows===!0&&Array.isArray(D.clippingPlanes)&&D.clippingPlanes.length!==0||D.displacementMap&&D.displacementScale!==0||D.alphaMap&&D.alphaTest>0||D.map&&D.alphaTest>0){let H=P.uuid,V=D.uuid,j=c[H];j===void 0&&(j={},c[H]=j);let J=j[V];J===void 0&&(J=P.clone(),j[V]=J),P=J}return P.visible=D.visible,P.wireframe=D.wireframe,O===aA?P.side=D.shadowSide!==null?D.shadowSide:D.side:P.side=D.shadowSide!==null?D.shadowSide:h[D.side],P.alphaMap=D.alphaMap,P.alphaTest=D.alphaTest,P.map=D.map,P.clipShadows=D.clipShadows,P.clippingPlanes=D.clippingPlanes,P.clipIntersection=D.clipIntersection,P.displacementMap=D.displacementMap,P.displacementScale=D.displacementScale,P.displacementBias=D.displacementBias,P.wireframeLinewidth=D.wireframeLinewidth,P.linewidth=D.linewidth,T.isPointLight===!0&&P.isMeshDistanceMaterial===!0&&(P.referencePosition.setFromMatrixPosition(T.matrixWorld),P.nearDistance=I,P.farDistance=R),P}function w(E,D,T,I,R){if(E.visible===!1)return;if(E.layers.test(D.layers)&&(E.isMesh||E.isLine||E.isPoints)&&(E.castShadow||E.receiveShadow&&R===aA)&&(!E.frustumCulled||n.intersectsObject(E))){E.modelViewMatrix.multiplyMatrices(T.matrixWorldInverse,E.matrixWorld);let P=t.update(E),U=E.material;if(Array.isArray(U)){let H=P.groups;for(let V=0,j=H.length;V<j;V++){let J=H[V],F=U[J.materialIndex];if(F&&F.visible){let X=A(E,F,I,T.near,T.far,R);e.renderBufferDirect(T,null,P,X,E,J)}}}else if(U.visible){let H=A(E,U,I,T.near,T.far,R);e.renderBufferDirect(T,null,P,H,E,null)}}let O=E.children;for(let P=0,U=O.length;P<U;P++)w(O[P],D,T,I,R)}}function oMe(e,t,i){let n=i.isWebGL2;function r(){let ie=!1,Ce=new Di,De=null,at=new Di(0,0,0,0);return{setMask:function(ut){De!==ut&&!ie&&(e.colorMask(ut,ut,ut,ut),De=ut)},setLocked:function(ut){ie=ut},setClear:function(ut,lt,It,Vt,_i){_i===!0&&(ut*=Vt,lt*=Vt,It*=Vt),Ce.set(ut,lt,It,Vt),at.equals(Ce)===!1&&(e.clearColor(ut,lt,It,Vt),at.copy(Ce))},reset:function(){ie=!1,De=null,at.set(-1,0,0,0)}}}function s(){let ie=!1,Ce=null,De=null,at=null;return{setTest:function(ut){ut?_e(2929):be(2929)},setMask:function(ut){Ce!==ut&&!ie&&(e.depthMask(ut),Ce=ut)},setFunc:function(ut){if(De!==ut){switch(ut){case C1e:e.depthFunc(512);break;case D1e:e.depthFunc(519);break;case R1e:e.depthFunc(513);break;case NU:e.depthFunc(515);break;case P1e:e.depthFunc(514);break;case O1e:e.depthFunc(518);break;case B1e:e.depthFunc(516);break;case I1e:e.depthFunc(517);break;default:e.depthFunc(515)}De=ut}},setLocked:function(ut){ie=ut},setClear:function(ut){at!==ut&&(e.clearDepth(ut),at=ut)},reset:function(){ie=!1,Ce=null,De=null,at=null}}}function a(){let ie=!1,Ce=null,De=null,at=null,ut=null,lt=null,It=null,Vt=null,_i=null;return{setTest:function(Jt){ie||(Jt?_e(2960):be(2960))},setMask:function(Jt){Ce!==Jt&&!ie&&(e.stencilMask(Jt),Ce=Jt)},setFunc:function(Jt,An,$i){(De!==Jt||at!==An||ut!==$i)&&(e.stencilFunc(Jt,An,$i),De=Jt,at=An,ut=$i)},setOp:function(Jt,An,$i){(lt!==Jt||It!==An||Vt!==$i)&&(e.stencilOp(Jt,An,$i),lt=Jt,It=An,Vt=$i)},setLocked:function(Jt){ie=Jt},setClear:function(Jt){_i!==Jt&&(e.clearStencil(Jt),_i=Jt)},reset:function(){ie=!1,Ce=null,De=null,at=null,ut=null,lt=null,It=null,Vt=null,_i=null}}}let o=new r,l=new s,c=new a,u=new WeakMap,h=new WeakMap,d={},p={},g=new WeakMap,x=[],y=null,b=!1,A=null,w=null,E=null,D=null,T=null,I=null,R=null,O=!1,P=null,U=null,H=null,V=null,j=null,J=e.getParameter(35661),F=!1,X=0,W=e.getParameter(7938);W.indexOf("WebGL")!==-1?(X=parseFloat(/^WebGL (\d)/.exec(W)[1]),F=X>=1):W.indexOf("OpenGL ES")!==-1&&(X=parseFloat(/^OpenGL ES (\d)/.exec(W)[1]),F=X>=2);let ne=null,Y={},$=e.getParameter(3088),se=e.getParameter(2978),fe=new Di().fromArray($),te=new Di().fromArray(se);function de(ie,Ce,De){let at=new Uint8Array(4),ut=e.createTexture();e.bindTexture(ie,ut),e.texParameteri(ie,10241,9728),e.texParameteri(ie,10240,9728);for(let lt=0;lt<De;lt++)e.texImage2D(Ce+lt,0,6408,1,1,0,6408,5121,at);return ut}let le={};le[3553]=de(3553,3553,1),le[34067]=de(34067,34069,6),o.setClear(0,0,0,1),l.setClear(1),c.setClear(0),_e(2929),l.setFunc(NU),Ke(!1),je(W6),_e(2884),ae(Rs);function _e(ie){d[ie]!==!0&&(e.enable(ie),d[ie]=!0)}function be(ie){d[ie]!==!1&&(e.disable(ie),d[ie]=!1)}function we(ie,Ce){return p[ie]!==Ce?(e.bindFramebuffer(ie,Ce),p[ie]=Ce,n&&(ie===36009&&(p[36160]=Ce),ie===36160&&(p[36009]=Ce)),!0):!1}function Me(ie,Ce){let De=x,at=!1;if(ie)if(De=g.get(Ce),De===void 0&&(De=[],g.set(Ce,De)),ie.isWebGLMultipleRenderTargets){let ut=ie.texture;if(De.length!==ut.length||De[0]!==36064){for(let lt=0,It=ut.length;lt<It;lt++)De[lt]=36064+lt;De.length=ut.length,at=!0}}else De[0]!==36064&&(De[0]=36064,at=!0);else De[0]!==1029&&(De[0]=1029,at=!0);at&&(i.isWebGL2?e.drawBuffers(De):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(De))}function Ne(ie){return y!==ie?(e.useProgram(ie),y=ie,!0):!1}let Ge={[Zx]:32774,[v1e]:32778,[y1e]:32779};if(n)Ge[Q6]=32775,Ge[K6]=32776;else{let ie=t.get("EXT_blend_minmax");ie!==null&&(Ge[Q6]=ie.MIN_EXT,Ge[K6]=ie.MAX_EXT)}let We={[x1e]:0,[b1e]:1,[S1e]:768,[IJ]:770,[T1e]:776,[M1e]:774,[A1e]:772,[_1e]:769,[LJ]:771,[E1e]:775,[w1e]:773};function ae(ie,Ce,De,at,ut,lt,It,Vt){if(ie===Rs){b===!0&&(be(3042),b=!1);return}if(b===!1&&(_e(3042),b=!0),ie!==g1e){if(ie!==A||Vt!==O){if((w!==Zx||T!==Zx)&&(e.blendEquation(32774),w=Zx,T=Zx),Vt)switch(ie){case x0:e.blendFuncSeparate(1,771,1,771);break;case X6:e.blendFunc(1,1);break;case q6:e.blendFuncSeparate(0,769,0,1);break;case Y6:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",ie);break}else switch(ie){case x0:e.blendFuncSeparate(770,771,1,771);break;case X6:e.blendFunc(770,1);break;case q6:e.blendFuncSeparate(0,769,0,1);break;case Y6:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",ie);break}E=null,D=null,I=null,R=null,A=ie,O=Vt}return}ut=ut||Ce,lt=lt||De,It=It||at,(Ce!==w||ut!==T)&&(e.blendEquationSeparate(Ge[Ce],Ge[ut]),w=Ce,T=ut),(De!==E||at!==D||lt!==I||It!==R)&&(e.blendFuncSeparate(We[De],We[at],We[lt],We[It]),E=De,D=at,I=lt,R=It),A=ie,O=!1}function He(ie,Ce){ie.side===yo?be(2884):_e(2884);let De=ie.side===va;Ce&&(De=!De),Ke(De),ie.blending===x0&&ie.transparent===!1?ae(Rs):ae(ie.blending,ie.blendEquation,ie.blendSrc,ie.blendDst,ie.blendEquationAlpha,ie.blendSrcAlpha,ie.blendDstAlpha,ie.premultipliedAlpha),l.setFunc(ie.depthFunc),l.setTest(ie.depthTest),l.setMask(ie.depthWrite),o.setMask(ie.colorWrite);let at=ie.stencilWrite;c.setTest(at),at&&(c.setMask(ie.stencilWriteMask),c.setFunc(ie.stencilFunc,ie.stencilRef,ie.stencilFuncMask),c.setOp(ie.stencilFail,ie.stencilZFail,ie.stencilZPass)),Qe(ie.polygonOffset,ie.polygonOffsetFactor,ie.polygonOffsetUnits),ie.alphaToCoverage===!0?_e(32926):be(32926)}function Ke(ie){P!==ie&&(ie?e.frontFace(2304):e.frontFace(2305),P=ie)}function je(ie){ie!==f1e?(_e(2884),ie!==U&&(ie===W6?e.cullFace(1029):ie===p1e?e.cullFace(1028):e.cullFace(1032))):be(2884),U=ie}function Oe(ie){ie!==H&&(F&&e.lineWidth(ie),H=ie)}function Qe(ie,Ce,De){ie?(_e(32823),(V!==Ce||j!==De)&&(e.polygonOffset(Ce,De),V=Ce,j=De)):be(32823)}function $e(ie){ie?_e(3089):be(3089)}function gt(ie){ie===void 0&&(ie=33984+J-1),ne!==ie&&(e.activeTexture(ie),ne=ie)}function pe(ie,Ce,De){De===void 0&&(ne===null?De=33984+J-1:De=ne);let at=Y[De];at===void 0&&(at={type:void 0,texture:void 0},Y[De]=at),(at.type!==ie||at.texture!==Ce)&&(ne!==De&&(e.activeTexture(De),ne=De),e.bindTexture(ie,Ce||le[ie]),at.type=ie,at.texture=Ce)}function k(){let ie=Y[ne];ie!==void 0&&ie.type!==void 0&&(e.bindTexture(ie.type,null),ie.type=void 0,ie.texture=void 0)}function Q(){try{e.compressedTexImage2D.apply(e,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function xe(){try{e.compressedTexImage3D.apply(e,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function K(){try{e.texSubImage2D.apply(e,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function Re(){try{e.texSubImage3D.apply(e,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function Le(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function st(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function Be(){try{e.texStorage2D.apply(e,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function bt(){try{e.texStorage3D.apply(e,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function vt(){try{e.texImage2D.apply(e,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function Xe(){try{e.texImage3D.apply(e,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function xt(ie){fe.equals(ie)===!1&&(e.scissor(ie.x,ie.y,ie.z,ie.w),fe.copy(ie))}function _t(ie){te.equals(ie)===!1&&(e.viewport(ie.x,ie.y,ie.z,ie.w),te.copy(ie))}function ye(ie,Ce){let De=h.get(Ce);De===void 0&&(De=new WeakMap,h.set(Ce,De));let at=De.get(ie);at===void 0&&(at=e.getUniformBlockIndex(Ce,ie.name),De.set(ie,at))}function Ve(ie,Ce){let De=h.get(Ce).get(ie);u.get(Ce)!==De&&(e.uniformBlockBinding(Ce,De,ie.__bindingPointIndex),u.set(Ce,De))}function At(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),n===!0&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),d={},ne=null,Y={},p={},g=new WeakMap,x=[],y=null,b=!1,A=null,w=null,E=null,D=null,T=null,I=null,R=null,O=!1,P=null,U=null,H=null,V=null,j=null,fe.set(0,0,e.canvas.width,e.canvas.height),te.set(0,0,e.canvas.width,e.canvas.height),o.reset(),l.reset(),c.reset()}return{buffers:{color:o,depth:l,stencil:c},enable:_e,disable:be,bindFramebuffer:we,drawBuffers:Me,useProgram:Ne,setBlending:ae,setMaterial:He,setFlipSided:Ke,setCullFace:je,setLineWidth:Oe,setPolygonOffset:Qe,setScissorTest:$e,activeTexture:gt,bindTexture:pe,unbindTexture:k,compressedTexImage2D:Q,compressedTexImage3D:xe,texImage2D:vt,texImage3D:Xe,updateUBOMapping:ye,uniformBlockBinding:Ve,texStorage2D:Be,texStorage3D:bt,texSubImage2D:K,texSubImage3D:Re,compressedTexSubImage2D:Le,compressedTexSubImage3D:st,scissor:xt,viewport:_t,reset:At}}function lMe(e,t,i,n,r,s,a){let o=r.isWebGL2,l=r.maxTextures,c=r.maxCubemapSize,u=r.maxTextureSize,h=r.maxSamples,d=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,p=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),g=new WeakMap,x,y=new WeakMap,b=!1;try{b=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function A(pe,k){return b?new OffscreenCanvas(pe,k):pw("canvas")}function w(pe,k,Q,xe){let K=1;if((pe.width>xe||pe.height>xe)&&(K=xe/Math.max(pe.width,pe.height)),K<1||k===!0)if(typeof HTMLImageElement<"u"&&pe instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&pe instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&pe instanceof ImageBitmap){let Re=k?e3:Math.floor,Le=Re(K*pe.width),st=Re(K*pe.height);x===void 0&&(x=A(Le,st));let Be=Q?A(Le,st):x;return Be.width=Le,Be.height=st,Be.getContext("2d").drawImage(pe,0,0,Le,st),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+pe.width+"x"+pe.height+") to ("+Le+"x"+st+")."),Be}else return"data"in pe&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+pe.width+"x"+pe.height+")."),pe;return pe}function E(pe){return jU(pe.width)&&jU(pe.height)}function D(pe){return o?!1:pe.wrapS!==Ar||pe.wrapT!==Ar||pe.minFilter!==rn&&pe.minFilter!==Yi}function T(pe,k){return pe.generateMipmaps&&k&&pe.minFilter!==rn&&pe.minFilter!==Yi}function I(pe){e.generateMipmap(pe)}function R(pe,k,Q,xe,K=!1){if(o===!1)return k;if(pe!==null){if(e[pe]!==void 0)return e[pe];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+pe+"'")}let Re=k;return k===6403&&(Q===5126&&(Re=33326),Q===5131&&(Re=33325),Q===5121&&(Re=33321)),k===33319&&(Q===5126&&(Re=33328),Q===5131&&(Re=33327),Q===5121&&(Re=33323)),k===6408&&(Q===5126&&(Re=34836),Q===5131&&(Re=34842),Q===5121&&(Re=xe===Gi&&K===!1?35907:32856),Q===32819&&(Re=32854),Q===32820&&(Re=32855)),(Re===33325||Re===33326||Re===33327||Re===33328||Re===34842||Re===34836)&&t.get("EXT_color_buffer_float"),Re}function O(pe,k,Q){return T(pe,Q)===!0||pe.isFramebufferTexture&&pe.minFilter!==rn&&pe.minFilter!==Yi?Math.log2(Math.max(k.width,k.height))+1:pe.mipmaps!==void 0&&pe.mipmaps.length>0?pe.mipmaps.length:pe.isCompressedTexture&&Array.isArray(pe.image)?k.mipmaps.length:1}function P(pe){return pe===rn||pe===J6||pe===BB?9728:9729}function U(pe){let k=pe.target;k.removeEventListener("dispose",U),V(k),k.isVideoTexture&&g.delete(k)}function H(pe){let k=pe.target;k.removeEventListener("dispose",H),J(k)}function V(pe){let k=n.get(pe);if(k.__webglInit===void 0)return;let Q=pe.source,xe=y.get(Q);if(xe){let K=xe[k.__cacheKey];K.usedTimes--,K.usedTimes===0&&j(pe),Object.keys(xe).length===0&&y.delete(Q)}n.remove(pe)}function j(pe){let k=n.get(pe);e.deleteTexture(k.__webglTexture);let Q=pe.source,xe=y.get(Q);delete xe[k.__cacheKey],a.memory.textures--}function J(pe){let k=pe.texture,Q=n.get(pe),xe=n.get(k);if(xe.__webglTexture!==void 0&&(e.deleteTexture(xe.__webglTexture),a.memory.textures--),pe.depthTexture&&pe.depthTexture.dispose(),pe.isWebGLCubeRenderTarget)for(let K=0;K<6;K++)e.deleteFramebuffer(Q.__webglFramebuffer[K]),Q.__webglDepthbuffer&&e.deleteRenderbuffer(Q.__webglDepthbuffer[K]);else{if(e.deleteFramebuffer(Q.__webglFramebuffer),Q.__webglDepthbuffer&&e.deleteRenderbuffer(Q.__webglDepthbuffer),Q.__webglMultisampledFramebuffer&&e.deleteFramebuffer(Q.__webglMultisampledFramebuffer),Q.__webglColorRenderbuffer)for(let K=0;K<Q.__webglColorRenderbuffer.length;K++)Q.__webglColorRenderbuffer[K]&&e.deleteRenderbuffer(Q.__webglColorRenderbuffer[K]);Q.__webglDepthRenderbuffer&&e.deleteRenderbuffer(Q.__webglDepthRenderbuffer)}if(pe.isWebGLMultipleRenderTargets)for(let K=0,Re=k.length;K<Re;K++){let Le=n.get(k[K]);Le.__webglTexture&&(e.deleteTexture(Le.__webglTexture),a.memory.textures--),n.remove(k[K])}n.remove(k),n.remove(pe)}let F=0;function X(){F=0}function W(){let pe=F;return pe>=l&&console.warn("THREE.WebGLTextures: Trying to use "+pe+" texture units while this GPU supports only "+l),F+=1,pe}function ne(pe){let k=[];return k.push(pe.wrapS),k.push(pe.wrapT),k.push(pe.wrapR||0),k.push(pe.magFilter),k.push(pe.minFilter),k.push(pe.anisotropy),k.push(pe.internalFormat),k.push(pe.format),k.push(pe.type),k.push(pe.generateMipmaps),k.push(pe.premultiplyAlpha),k.push(pe.flipY),k.push(pe.unpackAlignment),k.push(pe.encoding),k.join()}function Y(pe,k){let Q=n.get(pe);if(pe.isVideoTexture&&$e(pe),pe.isRenderTargetTexture===!1&&pe.version>0&&Q.__version!==pe.version){let xe=pe.image;if(xe===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(xe.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{be(Q,pe,k);return}}i.bindTexture(3553,Q.__webglTexture,33984+k)}function $(pe,k){let Q=n.get(pe);if(pe.version>0&&Q.__version!==pe.version){be(Q,pe,k);return}i.bindTexture(35866,Q.__webglTexture,33984+k)}function se(pe,k){let Q=n.get(pe);if(pe.version>0&&Q.__version!==pe.version){be(Q,pe,k);return}i.bindTexture(32879,Q.__webglTexture,33984+k)}function fe(pe,k){let Q=n.get(pe);if(pe.version>0&&Q.__version!==pe.version){we(Q,pe,k);return}i.bindTexture(34067,Q.__webglTexture,33984+k)}let te={[zf]:10497,[Ar]:33071,[VU]:33648},de={[rn]:9728,[J6]:9984,[BB]:9986,[Yi]:9729,[G1e]:9985,[$1]:9987};function le(pe,k,Q){if(Q?(e.texParameteri(pe,10242,te[k.wrapS]),e.texParameteri(pe,10243,te[k.wrapT]),(pe===32879||pe===35866)&&e.texParameteri(pe,32882,te[k.wrapR]),e.texParameteri(pe,10240,de[k.magFilter]),e.texParameteri(pe,10241,de[k.minFilter])):(e.texParameteri(pe,10242,33071),e.texParameteri(pe,10243,33071),(pe===32879||pe===35866)&&e.texParameteri(pe,32882,33071),(k.wrapS!==Ar||k.wrapT!==Ar)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(pe,10240,P(k.magFilter)),e.texParameteri(pe,10241,P(k.minFilter)),k.minFilter!==rn&&k.minFilter!==Yi&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),t.has("EXT_texture_filter_anisotropic")===!0){let xe=t.get("EXT_texture_filter_anisotropic");if(k.magFilter===rn||k.minFilter!==BB&&k.minFilter!==$1||k.type===Zn&&t.has("OES_texture_float_linear")===!1||o===!1&&k.type===ip&&t.has("OES_texture_half_float_linear")===!1)return;(k.anisotropy>1||n.get(k).__currentAnisotropy)&&(e.texParameterf(pe,xe.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(k.anisotropy,r.getMaxAnisotropy())),n.get(k).__currentAnisotropy=k.anisotropy)}}function _e(pe,k){let Q=!1;pe.__webglInit===void 0&&(pe.__webglInit=!0,k.addEventListener("dispose",U));let xe=k.source,K=y.get(xe);K===void 0&&(K={},y.set(xe,K));let Re=ne(k);if(Re!==pe.__cacheKey){K[Re]===void 0&&(K[Re]={texture:e.createTexture(),usedTimes:0},a.memory.textures++,Q=!0),K[Re].usedTimes++;let Le=K[pe.__cacheKey];Le!==void 0&&(K[pe.__cacheKey].usedTimes--,Le.usedTimes===0&&j(k)),pe.__cacheKey=Re,pe.__webglTexture=K[Re].texture}return Q}function be(pe,k,Q){let xe=3553;(k.isDataArrayTexture||k.isCompressedArrayTexture)&&(xe=35866),k.isData3DTexture&&(xe=32879);let K=_e(pe,k),Re=k.source;i.bindTexture(xe,pe.__webglTexture,33984+Q);let Le=n.get(Re);if(Re.version!==Le.__version||K===!0){i.activeTexture(33984+Q),e.pixelStorei(37440,k.flipY),e.pixelStorei(37441,k.premultiplyAlpha),e.pixelStorei(3317,k.unpackAlignment),e.pixelStorei(37443,0);let st=D(k)&&E(k.image)===!1,Be=w(k.image,st,!1,u);Be=gt(k,Be);let bt=E(Be)||o,vt=s.convert(k.format,k.encoding),Xe=s.convert(k.type),xt=R(k.internalFormat,vt,Xe,k.encoding,k.isVideoTexture);le(xe,k,bt);let _t,ye=k.mipmaps,Ve=o&&k.isVideoTexture!==!0,At=Le.__version===void 0||K===!0,ie=O(k,Be,bt);if(k.isDepthTexture)xt=6402,o?k.type===Zn?xt=36012:k.type===Ff?xt=33190:k.type===b0?xt=35056:xt=33189:k.type===Zn&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),k.format===S0&&xt===6402&&k.type!==zJ&&k.type!==Ff&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),k.type=Ff,Xe=s.convert(k.type)),k.format===L0&&xt===6402&&(xt=34041,k.type!==b0&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),k.type=b0,Xe=s.convert(k.type))),At&&(Ve?i.texStorage2D(3553,1,xt,Be.width,Be.height):i.texImage2D(3553,0,xt,Be.width,Be.height,0,vt,Xe,null));else if(k.isDataTexture)if(ye.length>0&&bt){Ve&&At&&i.texStorage2D(3553,ie,xt,ye[0].width,ye[0].height);for(let Ce=0,De=ye.length;Ce<De;Ce++)_t=ye[Ce],Ve?i.texSubImage2D(3553,Ce,0,0,_t.width,_t.height,vt,Xe,_t.data):i.texImage2D(3553,Ce,xt,_t.width,_t.height,0,vt,Xe,_t.data);k.generateMipmaps=!1}else Ve?(At&&i.texStorage2D(3553,ie,xt,Be.width,Be.height),i.texSubImage2D(3553,0,0,0,Be.width,Be.height,vt,Xe,Be.data)):i.texImage2D(3553,0,xt,Be.width,Be.height,0,vt,Xe,Be.data);else if(k.isCompressedTexture)if(k.isCompressedArrayTexture){Ve&&At&&i.texStorage3D(35866,ie,xt,ye[0].width,ye[0].height,Be.depth);for(let Ce=0,De=ye.length;Ce<De;Ce++)_t=ye[Ce],k.format!==Rr?vt!==null?Ve?i.compressedTexSubImage3D(35866,Ce,0,0,0,_t.width,_t.height,Be.depth,vt,_t.data,0,0):i.compressedTexImage3D(35866,Ce,xt,_t.width,_t.height,Be.depth,0,_t.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ve?i.texSubImage3D(35866,Ce,0,0,0,_t.width,_t.height,Be.depth,vt,Xe,_t.data):i.texImage3D(35866,Ce,xt,_t.width,_t.height,Be.depth,0,vt,Xe,_t.data)}else{Ve&&At&&i.texStorage2D(3553,ie,xt,ye[0].width,ye[0].height);for(let Ce=0,De=ye.length;Ce<De;Ce++)_t=ye[Ce],k.format!==Rr?vt!==null?Ve?i.compressedTexSubImage2D(3553,Ce,0,0,_t.width,_t.height,vt,_t.data):i.compressedTexImage2D(3553,Ce,xt,_t.width,_t.height,0,_t.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ve?i.texSubImage2D(3553,Ce,0,0,_t.width,_t.height,vt,Xe,_t.data):i.texImage2D(3553,Ce,xt,_t.width,_t.height,0,vt,Xe,_t.data)}else if(k.isDataArrayTexture)Ve?(At&&i.texStorage3D(35866,ie,xt,Be.width,Be.height,Be.depth),i.texSubImage3D(35866,0,0,0,0,Be.width,Be.height,Be.depth,vt,Xe,Be.data)):i.texImage3D(35866,0,xt,Be.width,Be.height,Be.depth,0,vt,Xe,Be.data);else if(k.isData3DTexture)Ve?(At&&i.texStorage3D(32879,ie,xt,Be.width,Be.height,Be.depth),i.texSubImage3D(32879,0,0,0,0,Be.width,Be.height,Be.depth,vt,Xe,Be.data)):i.texImage3D(32879,0,xt,Be.width,Be.height,Be.depth,0,vt,Xe,Be.data);else if(k.isFramebufferTexture){if(At)if(Ve)i.texStorage2D(3553,ie,xt,Be.width,Be.height);else{let Ce=Be.width,De=Be.height;for(let at=0;at<ie;at++)i.texImage2D(3553,at,xt,Ce,De,0,vt,Xe,null),Ce>>=1,De>>=1}}else if(ye.length>0&&bt){Ve&&At&&i.texStorage2D(3553,ie,xt,ye[0].width,ye[0].height);for(let Ce=0,De=ye.length;Ce<De;Ce++)_t=ye[Ce],Ve?i.texSubImage2D(3553,Ce,0,0,vt,Xe,_t):i.texImage2D(3553,Ce,xt,vt,Xe,_t);k.generateMipmaps=!1}else Ve?(At&&i.texStorage2D(3553,ie,xt,Be.width,Be.height),i.texSubImage2D(3553,0,0,0,vt,Xe,Be)):i.texImage2D(3553,0,xt,vt,Xe,Be);T(k,bt)&&I(xe),Le.__version=Re.version,k.onUpdate&&k.onUpdate(k)}pe.__version=k.version}function we(pe,k,Q){if(k.image.length!==6)return;let xe=_e(pe,k),K=k.source;i.bindTexture(34067,pe.__webglTexture,33984+Q);let Re=n.get(K);if(K.version!==Re.__version||xe===!0){i.activeTexture(33984+Q),e.pixelStorei(37440,k.flipY),e.pixelStorei(37441,k.premultiplyAlpha),e.pixelStorei(3317,k.unpackAlignment),e.pixelStorei(37443,0);let Le=k.isCompressedTexture||k.image[0].isCompressedTexture,st=k.image[0]&&k.image[0].isDataTexture,Be=[];for(let Ce=0;Ce<6;Ce++)!Le&&!st?Be[Ce]=w(k.image[Ce],!1,!0,c):Be[Ce]=st?k.image[Ce].image:k.image[Ce],Be[Ce]=gt(k,Be[Ce]);let bt=Be[0],vt=E(bt)||o,Xe=s.convert(k.format,k.encoding),xt=s.convert(k.type),_t=R(k.internalFormat,Xe,xt,k.encoding),ye=o&&k.isVideoTexture!==!0,Ve=Re.__version===void 0||xe===!0,At=O(k,bt,vt);le(34067,k,vt);let ie;if(Le){ye&&Ve&&i.texStorage2D(34067,At,_t,bt.width,bt.height);for(let Ce=0;Ce<6;Ce++){ie=Be[Ce].mipmaps;for(let De=0;De<ie.length;De++){let at=ie[De];k.format!==Rr?Xe!==null?ye?i.compressedTexSubImage2D(34069+Ce,De,0,0,at.width,at.height,Xe,at.data):i.compressedTexImage2D(34069+Ce,De,_t,at.width,at.height,0,at.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):ye?i.texSubImage2D(34069+Ce,De,0,0,at.width,at.height,Xe,xt,at.data):i.texImage2D(34069+Ce,De,_t,at.width,at.height,0,Xe,xt,at.data)}}}else{ie=k.mipmaps,ye&&Ve&&(ie.length>0&&At++,i.texStorage2D(34067,At,_t,Be[0].width,Be[0].height));for(let Ce=0;Ce<6;Ce++)if(st){ye?i.texSubImage2D(34069+Ce,0,0,0,Be[Ce].width,Be[Ce].height,Xe,xt,Be[Ce].data):i.texImage2D(34069+Ce,0,_t,Be[Ce].width,Be[Ce].height,0,Xe,xt,Be[Ce].data);for(let De=0;De<ie.length;De++){let at=ie[De].image[Ce].image;ye?i.texSubImage2D(34069+Ce,De+1,0,0,at.width,at.height,Xe,xt,at.data):i.texImage2D(34069+Ce,De+1,_t,at.width,at.height,0,Xe,xt,at.data)}}else{ye?i.texSubImage2D(34069+Ce,0,0,0,Xe,xt,Be[Ce]):i.texImage2D(34069+Ce,0,_t,Xe,xt,Be[Ce]);for(let De=0;De<ie.length;De++){let at=ie[De];ye?i.texSubImage2D(34069+Ce,De+1,0,0,Xe,xt,at.image[Ce]):i.texImage2D(34069+Ce,De+1,_t,Xe,xt,at.image[Ce])}}}T(k,vt)&&I(34067),Re.__version=K.version,k.onUpdate&&k.onUpdate(k)}pe.__version=k.version}function Me(pe,k,Q,xe,K){let Re=s.convert(Q.format,Q.encoding),Le=s.convert(Q.type),st=R(Q.internalFormat,Re,Le,Q.encoding);n.get(k).__hasExternalTextures||(K===32879||K===35866?i.texImage3D(K,0,st,k.width,k.height,k.depth,0,Re,Le,null):i.texImage2D(K,0,st,k.width,k.height,0,Re,Le,null)),i.bindFramebuffer(36160,pe),Qe(k)?d.framebufferTexture2DMultisampleEXT(36160,xe,K,n.get(Q).__webglTexture,0,Oe(k)):(K===3553||K>=34069&&K<=34074)&&e.framebufferTexture2D(36160,xe,K,n.get(Q).__webglTexture,0),i.bindFramebuffer(36160,null)}function Ne(pe,k,Q){if(e.bindRenderbuffer(36161,pe),k.depthBuffer&&!k.stencilBuffer){let xe=33189;if(Q||Qe(k)){let K=k.depthTexture;K&&K.isDepthTexture&&(K.type===Zn?xe=36012:K.type===Ff&&(xe=33190));let Re=Oe(k);Qe(k)?d.renderbufferStorageMultisampleEXT(36161,Re,xe,k.width,k.height):e.renderbufferStorageMultisample(36161,Re,xe,k.width,k.height)}else e.renderbufferStorage(36161,xe,k.width,k.height);e.framebufferRenderbuffer(36160,36096,36161,pe)}else if(k.depthBuffer&&k.stencilBuffer){let xe=Oe(k);Q&&Qe(k)===!1?e.renderbufferStorageMultisample(36161,xe,35056,k.width,k.height):Qe(k)?d.renderbufferStorageMultisampleEXT(36161,xe,35056,k.width,k.height):e.renderbufferStorage(36161,34041,k.width,k.height),e.framebufferRenderbuffer(36160,33306,36161,pe)}else{let xe=k.isWebGLMultipleRenderTargets===!0?k.texture:[k.texture];for(let K=0;K<xe.length;K++){let Re=xe[K],Le=s.convert(Re.format,Re.encoding),st=s.convert(Re.type),Be=R(Re.internalFormat,Le,st,Re.encoding),bt=Oe(k);Q&&Qe(k)===!1?e.renderbufferStorageMultisample(36161,bt,Be,k.width,k.height):Qe(k)?d.renderbufferStorageMultisampleEXT(36161,bt,Be,k.width,k.height):e.renderbufferStorage(36161,Be,k.width,k.height)}}e.bindRenderbuffer(36161,null)}function Ge(pe,k){if(k&&k.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,pe),!(k.depthTexture&&k.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(k.depthTexture).__webglTexture||k.depthTexture.image.width!==k.width||k.depthTexture.image.height!==k.height)&&(k.depthTexture.image.width=k.width,k.depthTexture.image.height=k.height,k.depthTexture.needsUpdate=!0),Y(k.depthTexture,0);let Q=n.get(k.depthTexture).__webglTexture,xe=Oe(k);if(k.depthTexture.format===S0)Qe(k)?d.framebufferTexture2DMultisampleEXT(36160,36096,3553,Q,0,xe):e.framebufferTexture2D(36160,36096,3553,Q,0);else if(k.depthTexture.format===L0)Qe(k)?d.framebufferTexture2DMultisampleEXT(36160,33306,3553,Q,0,xe):e.framebufferTexture2D(36160,33306,3553,Q,0);else throw new Error("Unknown depthTexture format")}function We(pe){let k=n.get(pe),Q=pe.isWebGLCubeRenderTarget===!0;if(pe.depthTexture&&!k.__autoAllocateDepthBuffer){if(Q)throw new Error("target.depthTexture not supported in Cube render targets");Ge(k.__webglFramebuffer,pe)}else if(Q){k.__webglDepthbuffer=[];for(let xe=0;xe<6;xe++)i.bindFramebuffer(36160,k.__webglFramebuffer[xe]),k.__webglDepthbuffer[xe]=e.createRenderbuffer(),Ne(k.__webglDepthbuffer[xe],pe,!1)}else i.bindFramebuffer(36160,k.__webglFramebuffer),k.__webglDepthbuffer=e.createRenderbuffer(),Ne(k.__webglDepthbuffer,pe,!1);i.bindFramebuffer(36160,null)}function ae(pe,k,Q){let xe=n.get(pe);k!==void 0&&Me(xe.__webglFramebuffer,pe,pe.texture,36064,3553),Q!==void 0&&We(pe)}function He(pe){let k=pe.texture,Q=n.get(pe),xe=n.get(k);pe.addEventListener("dispose",H),pe.isWebGLMultipleRenderTargets!==!0&&(xe.__webglTexture===void 0&&(xe.__webglTexture=e.createTexture()),xe.__version=k.version,a.memory.textures++);let K=pe.isWebGLCubeRenderTarget===!0,Re=pe.isWebGLMultipleRenderTargets===!0,Le=E(pe)||o;if(K){Q.__webglFramebuffer=[];for(let st=0;st<6;st++)Q.__webglFramebuffer[st]=e.createFramebuffer()}else{if(Q.__webglFramebuffer=e.createFramebuffer(),Re)if(r.drawBuffers){let st=pe.texture;for(let Be=0,bt=st.length;Be<bt;Be++){let vt=n.get(st[Be]);vt.__webglTexture===void 0&&(vt.__webglTexture=e.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(o&&pe.samples>0&&Qe(pe)===!1){let st=Re?k:[k];Q.__webglMultisampledFramebuffer=e.createFramebuffer(),Q.__webglColorRenderbuffer=[],i.bindFramebuffer(36160,Q.__webglMultisampledFramebuffer);for(let Be=0;Be<st.length;Be++){let bt=st[Be];Q.__webglColorRenderbuffer[Be]=e.createRenderbuffer(),e.bindRenderbuffer(36161,Q.__webglColorRenderbuffer[Be]);let vt=s.convert(bt.format,bt.encoding),Xe=s.convert(bt.type),xt=R(bt.internalFormat,vt,Xe,bt.encoding,pe.isXRRenderTarget===!0),_t=Oe(pe);e.renderbufferStorageMultisample(36161,_t,xt,pe.width,pe.height),e.framebufferRenderbuffer(36160,36064+Be,36161,Q.__webglColorRenderbuffer[Be])}e.bindRenderbuffer(36161,null),pe.depthBuffer&&(Q.__webglDepthRenderbuffer=e.createRenderbuffer(),Ne(Q.__webglDepthRenderbuffer,pe,!0)),i.bindFramebuffer(36160,null)}}if(K){i.bindTexture(34067,xe.__webglTexture),le(34067,k,Le);for(let st=0;st<6;st++)Me(Q.__webglFramebuffer[st],pe,k,36064,34069+st);T(k,Le)&&I(34067),i.unbindTexture()}else if(Re){let st=pe.texture;for(let Be=0,bt=st.length;Be<bt;Be++){let vt=st[Be],Xe=n.get(vt);i.bindTexture(3553,Xe.__webglTexture),le(3553,vt,Le),Me(Q.__webglFramebuffer,pe,vt,36064+Be,3553),T(vt,Le)&&I(3553)}i.unbindTexture()}else{let st=3553;(pe.isWebGL3DRenderTarget||pe.isWebGLArrayRenderTarget)&&(o?st=pe.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(st,xe.__webglTexture),le(st,k,Le),Me(Q.__webglFramebuffer,pe,k,36064,st),T(k,Le)&&I(st),i.unbindTexture()}pe.depthBuffer&&We(pe)}function Ke(pe){let k=E(pe)||o,Q=pe.isWebGLMultipleRenderTargets===!0?pe.texture:[pe.texture];for(let xe=0,K=Q.length;xe<K;xe++){let Re=Q[xe];if(T(Re,k)){let Le=pe.isWebGLCubeRenderTarget?34067:3553,st=n.get(Re).__webglTexture;i.bindTexture(Le,st),I(Le),i.unbindTexture()}}}function je(pe){if(o&&pe.samples>0&&Qe(pe)===!1){let k=pe.isWebGLMultipleRenderTargets?pe.texture:[pe.texture],Q=pe.width,xe=pe.height,K=16384,Re=[],Le=pe.stencilBuffer?33306:36096,st=n.get(pe),Be=pe.isWebGLMultipleRenderTargets===!0;if(Be)for(let bt=0;bt<k.length;bt++)i.bindFramebuffer(36160,st.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+bt,36161,null),i.bindFramebuffer(36160,st.__webglFramebuffer),e.framebufferTexture2D(36009,36064+bt,3553,null,0);i.bindFramebuffer(36008,st.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,st.__webglFramebuffer);for(let bt=0;bt<k.length;bt++){Re.push(36064+bt),pe.depthBuffer&&Re.push(Le);let vt=st.__ignoreDepthValues!==void 0?st.__ignoreDepthValues:!1;if(vt===!1&&(pe.depthBuffer&&(K|=256),pe.stencilBuffer&&(K|=1024)),Be&&e.framebufferRenderbuffer(36008,36064,36161,st.__webglColorRenderbuffer[bt]),vt===!0&&(e.invalidateFramebuffer(36008,[Le]),e.invalidateFramebuffer(36009,[Le])),Be){let Xe=n.get(k[bt]).__webglTexture;e.framebufferTexture2D(36009,36064,3553,Xe,0)}e.blitFramebuffer(0,0,Q,xe,0,0,Q,xe,K,9728),p&&e.invalidateFramebuffer(36008,Re)}if(i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,null),Be)for(let bt=0;bt<k.length;bt++){i.bindFramebuffer(36160,st.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+bt,36161,st.__webglColorRenderbuffer[bt]);let vt=n.get(k[bt]).__webglTexture;i.bindFramebuffer(36160,st.__webglFramebuffer),e.framebufferTexture2D(36009,36064+bt,3553,vt,0)}i.bindFramebuffer(36009,st.__webglMultisampledFramebuffer)}}function Oe(pe){return Math.min(h,pe.samples)}function Qe(pe){let k=n.get(pe);return o&&pe.samples>0&&t.has("WEBGL_multisampled_render_to_texture")===!0&&k.__useRenderToTexture!==!1}function $e(pe){let k=a.render.frame;g.get(pe)!==k&&(g.set(pe,k),pe.update())}function gt(pe,k){let Q=pe.encoding,xe=pe.format,K=pe.type;return pe.isCompressedTexture===!0||pe.isVideoTexture===!0||pe.format===kU||Q!==$u&&(Q===Gi?o===!1?t.has("EXT_sRGB")===!0&&xe===Rr?(pe.format=kU,pe.minFilter=Yi,pe.generateMipmaps=!1):k=XJ.sRGBToLinear(k):(xe!==Rr||K!==bo)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",Q)),k}this.allocateTextureUnit=W,this.resetTextureUnits=X,this.setTexture2D=Y,this.setTexture2DArray=$,this.setTexture3D=se,this.setTextureCube=fe,this.rebindTextures=ae,this.setupRenderTarget=He,this.updateRenderTargetMipmap=Ke,this.updateMultisampleRenderTarget=je,this.setupDepthRenderbuffer=We,this.setupFrameBufferTexture=Me,this.useMultisampledRTT=Qe}function cMe(e,t,i){let n=i.isWebGL2;function r(s,a=null){let o;if(s===bo)return 5121;if(s===X1e)return 32819;if(s===q1e)return 32820;if(s===k1e)return 5120;if(s===j1e)return 5122;if(s===zJ)return 5123;if(s===W1e)return 5124;if(s===Ff)return 5125;if(s===Zn)return 5126;if(s===ip)return n?5131:(o=t.get("OES_texture_half_float"),o!==null?o.HALF_FLOAT_OES:null);if(s===Y1e)return 6406;if(s===Rr)return 6408;if(s===Q1e)return 6409;if(s===K1e)return 6410;if(s===S0)return 6402;if(s===L0)return 34041;if(s===kU)return o=t.get("EXT_sRGB"),o!==null?o.SRGB_ALPHA_EXT:null;if(s===OC)return 6403;if(s===J1e)return 36244;if(s===QD)return 33319;if(s===Z1e)return 33320;if(s===FJ)return 36249;if(s===IB||s===LB||s===UB||s===NB)if(a===Gi)if(o=t.get("WEBGL_compressed_texture_s3tc_srgb"),o!==null){if(s===IB)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(s===LB)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(s===UB)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(s===NB)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(o=t.get("WEBGL_compressed_texture_s3tc"),o!==null){if(s===IB)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===LB)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===UB)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===NB)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===Z6||s===$6||s===e8||s===t8)if(o=t.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(s===Z6)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===$6)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===e8)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===t8)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===$1e)return o=t.get("WEBGL_compressed_texture_etc1"),o!==null?o.COMPRESSED_RGB_ETC1_WEBGL:null;if(s===i8||s===n8)if(o=t.get("WEBGL_compressed_texture_etc"),o!==null){if(s===i8)return a===Gi?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(s===n8)return a===Gi?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(s===r8||s===s8||s===a8||s===o8||s===l8||s===c8||s===u8||s===h8||s===d8||s===f8||s===p8||s===m8||s===g8||s===v8)if(o=t.get("WEBGL_compressed_texture_astc"),o!==null){if(s===r8)return a===Gi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(s===s8)return a===Gi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(s===a8)return a===Gi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(s===o8)return a===Gi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(s===l8)return a===Gi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(s===c8)return a===Gi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(s===u8)return a===Gi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(s===h8)return a===Gi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(s===d8)return a===Gi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(s===f8)return a===Gi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(s===p8)return a===Gi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(s===m8)return a===Gi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(s===g8)return a===Gi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(s===v8)return a===Gi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(s===zB)if(o=t.get("EXT_texture_compression_bptc"),o!==null){if(s===zB)return a===Gi?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(s===ebe||s===y8||s===x8||s===b8)if(o=t.get("EXT_texture_compression_rgtc"),o!==null){if(s===zB)return o.COMPRESSED_RED_RGTC1_EXT;if(s===y8)return o.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(s===x8)return o.COMPRESSED_RED_GREEN_RGTC2_EXT;if(s===b8)return o.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return s===b0?n?34042:(o=t.get("WEBGL_depth_texture"),o!==null?o.UNSIGNED_INT_24_8_WEBGL:null):e[s]!==void 0?e[s]:null}return{convert:r}}var uMe=class extends po{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}},Hf=class extends kn{constructor(){super(),this.isGroup=!0,this.type="Group"}},hMe={type:"move"},uI=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Hf,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Hf,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new G,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new G),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Hf,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new G,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new G),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){let t=this._hand;if(t)for(let i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let n=null,r=null,s=null,a=this._targetRay,o=this._grip,l=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(l&&e.hand){s=!0;for(let g of e.hand.values()){let x=t.getJointPose(g,i),y=this._getHandJoint(l,g);x!==null&&(y.matrix.fromArray(x.transform.matrix),y.matrix.decompose(y.position,y.rotation,y.scale),y.jointRadius=x.radius),y.visible=x!==null}let c=l.joints["index-finger-tip"],u=l.joints["thumb-tip"],h=c.position.distanceTo(u.position),d=.02,p=.005;l.inputState.pinching&&h>d+p?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&h<=d-p&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else o!==null&&e.gripSpace&&(r=t.getPose(e.gripSpace,i),r!==null&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1));a!==null&&(n=t.getPose(e.targetRaySpace,i),n===null&&r!==null&&(n=r),n!==null&&(a.matrix.fromArray(n.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),n.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(n.linearVelocity)):a.hasLinearVelocity=!1,n.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(n.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(hMe)))}return a!==null&&(a.visible=n!==null),o!==null&&(o.visible=r!==null),l!==null&&(l.visible=s!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){let i=new Hf;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}},tb=class extends Hr{constructor(e,t,i,n,r,s,a,o,l,c){if(c=c!==void 0?c:S0,c!==S0&&c!==L0)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&c===S0&&(i=Ff),i===void 0&&c===L0&&(i=b0),super(null,n,r,s,a,o,c,i,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:rn,this.minFilter=o!==void 0?o:rn,this.flipY=!1,this.generateMipmaps=!1}},dMe=class extends Ka{constructor(e,t){super();let i=this,n=null,r=1,s=null,a="local-floor",o=1,l=null,c=null,u=null,h=null,d=null,p=null,g=t.getContextAttributes(),x=null,y=null,b=[],A=[],w=new Set,E=new Map,D=new po;D.layers.enable(1),D.viewport=new Di;let T=new po;T.layers.enable(2),T.viewport=new Di;let I=[D,T],R=new uMe;R.layers.enable(1),R.layers.enable(2);let O=null,P=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function($){let se=b[$];return se===void 0&&(se=new uI,b[$]=se),se.getTargetRaySpace()},this.getControllerGrip=function($){let se=b[$];return se===void 0&&(se=new uI,b[$]=se),se.getGripSpace()},this.getHand=function($){let se=b[$];return se===void 0&&(se=new uI,b[$]=se),se.getHandSpace()};function U($){let se=A.indexOf($.inputSource);if(se===-1)return;let fe=b[se];fe!==void 0&&fe.dispatchEvent({type:$.type,data:$.inputSource})}function H(){n.removeEventListener("select",U),n.removeEventListener("selectstart",U),n.removeEventListener("selectend",U),n.removeEventListener("squeeze",U),n.removeEventListener("squeezestart",U),n.removeEventListener("squeezeend",U),n.removeEventListener("end",H),n.removeEventListener("inputsourceschange",V);for(let $=0;$<b.length;$++){let se=A[$];se!==null&&(A[$]=null,b[$].disconnect(se))}O=null,P=null,e.setRenderTarget(x),d=null,h=null,u=null,n=null,y=null,Y.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function($){r=$,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function($){a=$,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||s},this.setReferenceSpace=function($){l=$},this.getBaseLayer=function(){return h!==null?h:d},this.getBinding=function(){return u},this.getFrame=function(){return p},this.getSession=function(){return n},this.setSession=async function($){if(n=$,n!==null){if(x=e.getRenderTarget(),n.addEventListener("select",U),n.addEventListener("selectstart",U),n.addEventListener("selectend",U),n.addEventListener("squeeze",U),n.addEventListener("squeezestart",U),n.addEventListener("squeezeend",U),n.addEventListener("end",H),n.addEventListener("inputsourceschange",V),g.xrCompatible!==!0&&await t.makeXRCompatible(),n.renderState.layers===void 0||e.capabilities.isWebGL2===!1){let se={antialias:n.renderState.layers===void 0?g.antialias:!0,alpha:g.alpha,depth:g.depth,stencil:g.stencil,framebufferScaleFactor:r};d=new XRWebGLLayer(n,t,se),n.updateRenderState({baseLayer:d}),y=new mn(d.framebufferWidth,d.framebufferHeight,{format:Rr,type:bo,encoding:e.outputEncoding,stencilBuffer:g.stencil})}else{let se=null,fe=null,te=null;g.depth&&(te=g.stencil?35056:33190,se=g.stencil?L0:S0,fe=g.stencil?b0:Ff);let de={colorFormat:32856,depthFormat:te,scaleFactor:r};u=new XRWebGLBinding(n,t),h=u.createProjectionLayer(de),n.updateRenderState({layers:[h]}),y=new mn(h.textureWidth,h.textureHeight,{format:Rr,type:bo,depthTexture:new tb(h.textureWidth,h.textureHeight,fe,void 0,void 0,void 0,void 0,void 0,void 0,se),stencilBuffer:g.stencil,encoding:e.outputEncoding,samples:g.antialias?4:0});let le=e.properties.get(y);le.__ignoreDepthValues=h.ignoreDepthValues}y.isXRRenderTarget=!0,this.setFoveation(o),l=null,s=await n.requestReferenceSpace(a),Y.setContext(n),Y.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};function V($){for(let se=0;se<$.removed.length;se++){let fe=$.removed[se],te=A.indexOf(fe);te>=0&&(A[te]=null,b[te].disconnect(fe))}for(let se=0;se<$.added.length;se++){let fe=$.added[se],te=A.indexOf(fe);if(te===-1){for(let le=0;le<b.length;le++)if(le>=A.length){A.push(fe),te=le;break}else if(A[le]===null){A[le]=fe,te=le;break}if(te===-1)break}let de=b[te];de&&de.connect(fe)}}let j=new G,J=new G;function F($,se,fe){j.setFromMatrixPosition(se.matrixWorld),J.setFromMatrixPosition(fe.matrixWorld);let te=j.distanceTo(J),de=se.projectionMatrix.elements,le=fe.projectionMatrix.elements,_e=de[14]/(de[10]-1),be=de[14]/(de[10]+1),we=(de[9]+1)/de[5],Me=(de[9]-1)/de[5],Ne=(de[8]-1)/de[0],Ge=(le[8]+1)/le[0],We=_e*Ne,ae=_e*Ge,He=te/(-Ne+Ge),Ke=He*-Ne;se.matrixWorld.decompose($.position,$.quaternion,$.scale),$.translateX(Ke),$.translateZ(He),$.matrixWorld.compose($.position,$.quaternion,$.scale),$.matrixWorldInverse.copy($.matrixWorld).invert();let je=_e+He,Oe=be+He,Qe=We-Ke,$e=ae+(te-Ke),gt=we*be/Oe*je,pe=Me*be/Oe*je;$.projectionMatrix.makePerspective(Qe,$e,gt,pe,je,Oe)}function X($,se){se===null?$.matrixWorld.copy($.matrix):$.matrixWorld.multiplyMatrices(se.matrixWorld,$.matrix),$.matrixWorldInverse.copy($.matrixWorld).invert()}this.updateCamera=function($){if(n===null)return;R.near=T.near=D.near=$.near,R.far=T.far=D.far=$.far,(O!==R.near||P!==R.far)&&(n.updateRenderState({depthNear:R.near,depthFar:R.far}),O=R.near,P=R.far);let se=$.parent,fe=R.cameras;X(R,se);for(let de=0;de<fe.length;de++)X(fe[de],se);R.matrixWorld.decompose(R.position,R.quaternion,R.scale),$.matrix.copy(R.matrix),$.matrix.decompose($.position,$.quaternion,$.scale);let te=$.children;for(let de=0,le=te.length;de<le;de++)te[de].updateMatrixWorld(!0);fe.length===2?F(R,D,T):R.projectionMatrix.copy(D.projectionMatrix)},this.getCamera=function(){return R},this.getFoveation=function(){if(!(h===null&&d===null))return o},this.setFoveation=function($){o=$,h!==null&&(h.fixedFoveation=$),d!==null&&d.fixedFoveation!==void 0&&(d.fixedFoveation=$)},this.getPlanes=function(){return w};let W=null;function ne($,se){if(c=se.getViewerPose(l||s),p=se,c!==null){let fe=c.views;d!==null&&(e.setRenderTargetFramebuffer(y,d.framebuffer),e.setRenderTarget(y));let te=!1;fe.length!==R.cameras.length&&(R.cameras.length=0,te=!0);for(let de=0;de<fe.length;de++){let le=fe[de],_e=null;if(d!==null)_e=d.getViewport(le);else{let we=u.getViewSubImage(h,le);_e=we.viewport,de===0&&(e.setRenderTargetTextures(y,we.colorTexture,h.ignoreDepthValues?void 0:we.depthStencilTexture),e.setRenderTarget(y))}let be=I[de];be===void 0&&(be=new po,be.layers.enable(de),be.viewport=new Di,I[de]=be),be.matrix.fromArray(le.transform.matrix),be.projectionMatrix.fromArray(le.projectionMatrix),be.viewport.set(_e.x,_e.y,_e.width,_e.height),de===0&&R.matrix.copy(be.matrix),te===!0&&R.cameras.push(be)}}for(let fe=0;fe<b.length;fe++){let te=A[fe],de=b[fe];te!==null&&de!==void 0&&de.update(te,se,l||s)}if(W&&W($,se),se.detectedPlanes){i.dispatchEvent({type:"planesdetected",data:se.detectedPlanes});let fe=null;for(let te of w)se.detectedPlanes.has(te)||(fe===null&&(fe=[]),fe.push(te));if(fe!==null)for(let te of fe)w.delete(te),E.delete(te),i.dispatchEvent({type:"planeremoved",data:te});for(let te of se.detectedPlanes)if(!w.has(te))w.add(te),E.set(te,se.lastChangedTime),i.dispatchEvent({type:"planeadded",data:te});else{let de=E.get(te);te.lastChangedTime>de&&(E.set(te,te.lastChangedTime),i.dispatchEvent({type:"planechanged",data:te}))}}p=null}let Y=new ZJ;Y.setAnimationLoop(ne),this.setAnimationLoop=function($){W=$},this.dispose=function(){}}};function fMe(e,t){function i(x,y){y.color.getRGB(x.fogColor.value,JJ(e)),y.isFog?(x.fogNear.value=y.near,x.fogFar.value=y.far):y.isFogExp2&&(x.fogDensity.value=y.density)}function n(x,y,b,A,w){y.isMeshBasicMaterial||y.isMeshLambertMaterial?r(x,y):y.isMeshToonMaterial?(r(x,y),u(x,y)):y.isMeshPhongMaterial?(r(x,y),c(x,y)):y.isMeshStandardMaterial?(r(x,y),h(x,y),y.isMeshPhysicalMaterial&&d(x,y,w)):y.isMeshMatcapMaterial?(r(x,y),p(x,y)):y.isMeshDepthMaterial?r(x,y):y.isMeshDistanceMaterial?(r(x,y),g(x,y)):y.isMeshNormalMaterial?r(x,y):y.isLineBasicMaterial?(s(x,y),y.isLineDashedMaterial&&a(x,y)):y.isPointsMaterial?o(x,y,b,A):y.isSpriteMaterial?l(x,y):y.isShadowMaterial?(x.color.value.copy(y.color),x.opacity.value=y.opacity):y.isShaderMaterial&&(y.uniformsNeedUpdate=!1)}function r(x,y){x.opacity.value=y.opacity,y.color&&x.diffuse.value.copy(y.color),y.emissive&&x.emissive.value.copy(y.emissive).multiplyScalar(y.emissiveIntensity),y.map&&(x.map.value=y.map),y.alphaMap&&(x.alphaMap.value=y.alphaMap),y.bumpMap&&(x.bumpMap.value=y.bumpMap,x.bumpScale.value=y.bumpScale,y.side===va&&(x.bumpScale.value*=-1)),y.displacementMap&&(x.displacementMap.value=y.displacementMap,x.displacementScale.value=y.displacementScale,x.displacementBias.value=y.displacementBias),y.emissiveMap&&(x.emissiveMap.value=y.emissiveMap),y.normalMap&&(x.normalMap.value=y.normalMap,x.normalScale.value.copy(y.normalScale),y.side===va&&x.normalScale.value.negate()),y.specularMap&&(x.specularMap.value=y.specularMap),y.alphaTest>0&&(x.alphaTest.value=y.alphaTest);let b=t.get(y).envMap;if(b&&(x.envMap.value=b,x.flipEnvMap.value=b.isCubeTexture&&b.isRenderTargetTexture===!1?-1:1,x.reflectivity.value=y.reflectivity,x.ior.value=y.ior,x.refractionRatio.value=y.refractionRatio),y.lightMap){x.lightMap.value=y.lightMap;let E=e.physicallyCorrectLights!==!0?Math.PI:1;x.lightMapIntensity.value=y.lightMapIntensity*E}y.aoMap&&(x.aoMap.value=y.aoMap,x.aoMapIntensity.value=y.aoMapIntensity);let A;y.map?A=y.map:y.specularMap?A=y.specularMap:y.displacementMap?A=y.displacementMap:y.normalMap?A=y.normalMap:y.bumpMap?A=y.bumpMap:y.roughnessMap?A=y.roughnessMap:y.metalnessMap?A=y.metalnessMap:y.alphaMap?A=y.alphaMap:y.emissiveMap?A=y.emissiveMap:y.clearcoatMap?A=y.clearcoatMap:y.clearcoatNormalMap?A=y.clearcoatNormalMap:y.clearcoatRoughnessMap?A=y.clearcoatRoughnessMap:y.iridescenceMap?A=y.iridescenceMap:y.iridescenceThicknessMap?A=y.iridescenceThicknessMap:y.specularIntensityMap?A=y.specularIntensityMap:y.specularColorMap?A=y.specularColorMap:y.transmissionMap?A=y.transmissionMap:y.thicknessMap?A=y.thicknessMap:y.sheenColorMap?A=y.sheenColorMap:y.sheenRoughnessMap&&(A=y.sheenRoughnessMap),A!==void 0&&(A.isWebGLRenderTarget&&(A=A.texture),A.matrixAutoUpdate===!0&&A.updateMatrix(),x.uvTransform.value.copy(A.matrix));let w;y.aoMap?w=y.aoMap:y.lightMap&&(w=y.lightMap),w!==void 0&&(w.isWebGLRenderTarget&&(w=w.texture),w.matrixAutoUpdate===!0&&w.updateMatrix(),x.uv2Transform.value.copy(w.matrix))}function s(x,y){x.diffuse.value.copy(y.color),x.opacity.value=y.opacity}function a(x,y){x.dashSize.value=y.dashSize,x.totalSize.value=y.dashSize+y.gapSize,x.scale.value=y.scale}function o(x,y,b,A){x.diffuse.value.copy(y.color),x.opacity.value=y.opacity,x.size.value=y.size*b,x.scale.value=A*.5,y.map&&(x.map.value=y.map),y.alphaMap&&(x.alphaMap.value=y.alphaMap),y.alphaTest>0&&(x.alphaTest.value=y.alphaTest);let w;y.map?w=y.map:y.alphaMap&&(w=y.alphaMap),w!==void 0&&(w.matrixAutoUpdate===!0&&w.updateMatrix(),x.uvTransform.value.copy(w.matrix))}function l(x,y){x.diffuse.value.copy(y.color),x.opacity.value=y.opacity,x.rotation.value=y.rotation,y.map&&(x.map.value=y.map),y.alphaMap&&(x.alphaMap.value=y.alphaMap),y.alphaTest>0&&(x.alphaTest.value=y.alphaTest);let b;y.map?b=y.map:y.alphaMap&&(b=y.alphaMap),b!==void 0&&(b.matrixAutoUpdate===!0&&b.updateMatrix(),x.uvTransform.value.copy(b.matrix))}function c(x,y){x.specular.value.copy(y.specular),x.shininess.value=Math.max(y.shininess,1e-4)}function u(x,y){y.gradientMap&&(x.gradientMap.value=y.gradientMap)}function h(x,y){x.roughness.value=y.roughness,x.metalness.value=y.metalness,y.roughnessMap&&(x.roughnessMap.value=y.roughnessMap),y.metalnessMap&&(x.metalnessMap.value=y.metalnessMap),t.get(y).envMap&&(x.envMapIntensity.value=y.envMapIntensity)}function d(x,y,b){x.ior.value=y.ior,y.sheen>0&&(x.sheenColor.value.copy(y.sheenColor).multiplyScalar(y.sheen),x.sheenRoughness.value=y.sheenRoughness,y.sheenColorMap&&(x.sheenColorMap.value=y.sheenColorMap),y.sheenRoughnessMap&&(x.sheenRoughnessMap.value=y.sheenRoughnessMap)),y.clearcoat>0&&(x.clearcoat.value=y.clearcoat,x.clearcoatRoughness.value=y.clearcoatRoughness,y.clearcoatMap&&(x.clearcoatMap.value=y.clearcoatMap),y.clearcoatRoughnessMap&&(x.clearcoatRoughnessMap.value=y.clearcoatRoughnessMap),y.clearcoatNormalMap&&(x.clearcoatNormalScale.value.copy(y.clearcoatNormalScale),x.clearcoatNormalMap.value=y.clearcoatNormalMap,y.side===va&&x.clearcoatNormalScale.value.negate())),y.iridescence>0&&(x.iridescence.value=y.iridescence,x.iridescenceIOR.value=y.iridescenceIOR,x.iridescenceThicknessMinimum.value=y.iridescenceThicknessRange[0],x.iridescenceThicknessMaximum.value=y.iridescenceThicknessRange[1],y.iridescenceMap&&(x.iridescenceMap.value=y.iridescenceMap),y.iridescenceThicknessMap&&(x.iridescenceThicknessMap.value=y.iridescenceThicknessMap)),y.transmission>0&&(x.transmission.value=y.transmission,x.transmissionSamplerMap.value=b.texture,x.transmissionSamplerSize.value.set(b.width,b.height),y.transmissionMap&&(x.transmissionMap.value=y.transmissionMap),x.thickness.value=y.thickness,y.thicknessMap&&(x.thicknessMap.value=y.thicknessMap),x.attenuationDistance.value=y.attenuationDistance,x.attenuationColor.value.copy(y.attenuationColor)),x.specularIntensity.value=y.specularIntensity,x.specularColor.value.copy(y.specularColor),y.specularIntensityMap&&(x.specularIntensityMap.value=y.specularIntensityMap),y.specularColorMap&&(x.specularColorMap.value=y.specularColorMap)}function p(x,y){y.matcap&&(x.matcap.value=y.matcap)}function g(x,y){x.referencePosition.value.copy(y.referencePosition),x.nearDistance.value=y.nearDistance,x.farDistance.value=y.farDistance}return{refreshFogUniforms:i,refreshMaterialUniforms:n}}function pMe(e,t,i,n){let r={},s={},a=[],o=i.isWebGL2?e.getParameter(35375):0;function l(A,w){let E=w.program;n.uniformBlockBinding(A,E)}function c(A,w){let E=r[A.id];E===void 0&&(g(A),E=u(A),r[A.id]=E,A.addEventListener("dispose",y));let D=w.program;n.updateUBOMapping(A,D);let T=t.render.frame;s[A.id]!==T&&(d(A),s[A.id]=T)}function u(A){let w=h();A.__bindingPointIndex=w;let E=e.createBuffer(),D=A.__size,T=A.usage;return e.bindBuffer(35345,E),e.bufferData(35345,D,T),e.bindBuffer(35345,null),e.bindBufferBase(35345,w,E),E}function h(){for(let A=0;A<o;A++)if(a.indexOf(A)===-1)return a.push(A),A;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(A){let w=r[A.id],E=A.uniforms,D=A.__cache;e.bindBuffer(35345,w);for(let T=0,I=E.length;T<I;T++){let R=E[T];if(p(R,T,D)===!0){let O=R.__offset,P=Array.isArray(R.value)?R.value:[R.value],U=0;for(let H=0;H<P.length;H++){let V=P[H],j=x(V);typeof V=="number"?(R.__data[0]=V,e.bufferSubData(35345,O+U,R.__data)):V.isMatrix3?(R.__data[0]=V.elements[0],R.__data[1]=V.elements[1],R.__data[2]=V.elements[2],R.__data[3]=V.elements[0],R.__data[4]=V.elements[3],R.__data[5]=V.elements[4],R.__data[6]=V.elements[5],R.__data[7]=V.elements[0],R.__data[8]=V.elements[6],R.__data[9]=V.elements[7],R.__data[10]=V.elements[8],R.__data[11]=V.elements[0]):(V.toArray(R.__data,U),U+=j.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(35345,O,R.__data)}}e.bindBuffer(35345,null)}function p(A,w,E){let D=A.value;if(E[w]===void 0){if(typeof D=="number")E[w]=D;else{let T=Array.isArray(D)?D:[D],I=[];for(let R=0;R<T.length;R++)I.push(T[R].clone());E[w]=I}return!0}else if(typeof D=="number"){if(E[w]!==D)return E[w]=D,!0}else{let T=Array.isArray(E[w])?E[w]:[E[w]],I=Array.isArray(D)?D:[D];for(let R=0;R<T.length;R++){let O=T[R];if(O.equals(I[R])===!1)return O.copy(I[R]),!0}}return!1}function g(A){let w=A.uniforms,E=0,D=16,T=0;for(let I=0,R=w.length;I<R;I++){let O=w[I],P={boundary:0,storage:0},U=Array.isArray(O.value)?O.value:[O.value];for(let H=0,V=U.length;H<V;H++){let j=U[H],J=x(j);P.boundary+=J.boundary,P.storage+=J.storage}if(O.__data=new Float32Array(P.storage/Float32Array.BYTES_PER_ELEMENT),O.__offset=E,I>0){T=E%D;let H=D-T;T!==0&&H-P.boundary<0&&(E+=D-T,O.__offset=E)}E+=P.storage}return T=E%D,T>0&&(E+=D-T),A.__size=E,A.__cache={},this}function x(A){let w={boundary:0,storage:0};return typeof A=="number"?(w.boundary=4,w.storage=4):A.isVector2?(w.boundary=8,w.storage=8):A.isVector3||A.isColor?(w.boundary=16,w.storage=12):A.isVector4?(w.boundary=16,w.storage=16):A.isMatrix3?(w.boundary=48,w.storage=48):A.isMatrix4?(w.boundary=64,w.storage=64):A.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",A),w}function y(A){let w=A.target;w.removeEventListener("dispose",y);let E=a.indexOf(w.__bindingPointIndex);a.splice(E,1),e.deleteBuffer(r[w.id]),delete r[w.id],delete s[w.id]}function b(){for(let A in r)e.deleteBuffer(r[A]);a=[],r={},s={}}return{bind:l,update:c,dispose:b}}function mMe(){let e=pw("canvas");return e.style.display="block",e}function rZ(e={}){this.isWebGLRenderer=!0;let t=e.canvas!==void 0?e.canvas:mMe(),i=e.context!==void 0?e.context:null,n=e.depth!==void 0?e.depth:!0,r=e.stencil!==void 0?e.stencil:!0,s=e.antialias!==void 0?e.antialias:!1,a=e.premultipliedAlpha!==void 0?e.premultipliedAlpha:!0,o=e.preserveDrawingBuffer!==void 0?e.preserveDrawingBuffer:!1,l=e.powerPreference!==void 0?e.powerPreference:"default",c=e.failIfMajorPerformanceCaveat!==void 0?e.failIfMajorPerformanceCaveat:!1,u;i!==null?u=i.getContextAttributes().alpha:u=e.alpha!==void 0?e.alpha:!1;let h=null,d=null,p=[],g=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=$u,this.physicallyCorrectLights=!1,this.toneMapping=md,this.toneMappingExposure=1;let x=this,y=!1,b=0,A=0,w=null,E=-1,D=null,T=new Di,I=new Di,R=null,O=t.width,P=t.height,U=1,H=null,V=null,j=new Di(0,0,O,P),J=new Di(0,0,O,P),F=!1,X=new B4,W=!1,ne=!1,Y=null,$=new Bt,se=new Ae,fe=new G,te={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function de(){return w===null?U:1}let le=i;function _e(ve,et){for(let ft=0;ft<ve.length;ft++){let Ye=ve[ft],ot=t.getContext(Ye,et);if(ot!==null)return ot}return null}try{let ve={alpha:!0,depth:n,stencil:r,antialias:s,premultipliedAlpha:a,preserveDrawingBuffer:o,powerPreference:l,failIfMajorPerformanceCaveat:c};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${Tb}`),t.addEventListener("webglcontextlost",xt,!1),t.addEventListener("webglcontextrestored",_t,!1),t.addEventListener("webglcontextcreationerror",ye,!1),le===null){let et=["webgl2","webgl","experimental-webgl"];if(x.isWebGL1Renderer===!0&&et.shift(),le=_e(et,ve),le===null)throw _e(et)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}le.getShaderPrecisionFormat===void 0&&(le.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(ve){throw console.error("THREE.WebGLRenderer: "+ve.message),ve}let be,we,Me,Ne,Ge,We,ae,He,Ke,je,Oe,Qe,$e,gt,pe,k,Q,xe,K,Re,Le,st,Be,bt;function vt(){be=new CAe(le),we=new _Ae(le,be,e),be.init(we),st=new cMe(le,be,we),Me=new oMe(le,be,we),Ne=new PAe,Ge=new Ywe,We=new lMe(le,be,Me,Ge,we,st,Ne),ae=new wAe(x),He=new TAe(x),Ke=new Vbe(le,we),Be=new bAe(le,be,Ke,we),je=new DAe(le,Ke,Ne,Be),Oe=new LAe(le,je,Ke,Ne),K=new IAe(le,we,We),k=new AAe(Ge),Qe=new qwe(x,ae,He,be,we,Be,k),$e=new fMe(x,Ge),gt=new Kwe,pe=new iMe(be,we),xe=new xAe(x,ae,He,Me,Oe,u,a),Q=new aMe(x,Oe,we),bt=new pMe(le,Ne,we,Me),Re=new SAe(le,be,Ne,we),Le=new RAe(le,be,Ne,we),Ne.programs=Qe.programs,x.capabilities=we,x.extensions=be,x.properties=Ge,x.renderLists=gt,x.shadowMap=Q,x.state=Me,x.info=Ne}vt();let Xe=new dMe(x,le);this.xr=Xe,this.getContext=function(){return le},this.getContextAttributes=function(){return le.getContextAttributes()},this.forceContextLoss=function(){let ve=be.get("WEBGL_lose_context");ve&&ve.loseContext()},this.forceContextRestore=function(){let ve=be.get("WEBGL_lose_context");ve&&ve.restoreContext()},this.getPixelRatio=function(){return U},this.setPixelRatio=function(ve){ve!==void 0&&(U=ve,this.setSize(O,P,!1))},this.getSize=function(ve){return ve.set(O,P)},this.setSize=function(ve,et,ft){if(Xe.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}O=ve,P=et,t.width=Math.floor(ve*U),t.height=Math.floor(et*U),ft!==!1&&(t.style.width=ve+"px",t.style.height=et+"px"),this.setViewport(0,0,ve,et)},this.getDrawingBufferSize=function(ve){return ve.set(O*U,P*U).floor()},this.setDrawingBufferSize=function(ve,et,ft){O=ve,P=et,U=ft,t.width=Math.floor(ve*ft),t.height=Math.floor(et*ft),this.setViewport(0,0,ve,et)},this.getCurrentViewport=function(ve){return ve.copy(T)},this.getViewport=function(ve){return ve.copy(j)},this.setViewport=function(ve,et,ft,Ye){ve.isVector4?j.set(ve.x,ve.y,ve.z,ve.w):j.set(ve,et,ft,Ye),Me.viewport(T.copy(j).multiplyScalar(U).floor())},this.getScissor=function(ve){return ve.copy(J)},this.setScissor=function(ve,et,ft,Ye){ve.isVector4?J.set(ve.x,ve.y,ve.z,ve.w):J.set(ve,et,ft,Ye),Me.scissor(I.copy(J).multiplyScalar(U).floor())},this.getScissorTest=function(){return F},this.setScissorTest=function(ve){Me.setScissorTest(F=ve)},this.setOpaqueSort=function(ve){H=ve},this.setTransparentSort=function(ve){V=ve},this.getClearColor=function(ve){return ve.copy(xe.getClearColor())},this.setClearColor=function(){xe.setClearColor.apply(xe,arguments)},this.getClearAlpha=function(){return xe.getClearAlpha()},this.setClearAlpha=function(){xe.setClearAlpha.apply(xe,arguments)},this.clear=function(ve=!0,et=!0,ft=!0){let Ye=0;ve&&(Ye|=16384),et&&(Ye|=256),ft&&(Ye|=1024),le.clear(Ye)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",xt,!1),t.removeEventListener("webglcontextrestored",_t,!1),t.removeEventListener("webglcontextcreationerror",ye,!1),gt.dispose(),pe.dispose(),Ge.dispose(),ae.dispose(),He.dispose(),Oe.dispose(),Be.dispose(),bt.dispose(),Qe.dispose(),Xe.dispose(),Xe.removeEventListener("sessionstart",at),Xe.removeEventListener("sessionend",ut),Y&&(Y.dispose(),Y=null),lt.stop()};function xt(ve){ve.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),y=!0}function _t(){console.log("THREE.WebGLRenderer: Context Restored."),y=!1;let ve=Ne.autoReset,et=Q.enabled,ft=Q.autoUpdate,Ye=Q.needsUpdate,ot=Q.type;vt(),Ne.autoReset=ve,Q.enabled=et,Q.autoUpdate=ft,Q.needsUpdate=Ye,Q.type=ot}function ye(ve){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",ve.statusMessage)}function Ve(ve){let et=ve.target;et.removeEventListener("dispose",Ve),At(et)}function At(ve){ie(ve),Ge.remove(ve)}function ie(ve){let et=Ge.get(ve).programs;et!==void 0&&(et.forEach(function(ft){Qe.releaseProgram(ft)}),ve.isShaderMaterial&&Qe.releaseShaderCache(ve))}this.renderBufferDirect=function(ve,et,ft,Ye,ot,kt){et===null&&(et=te);let si=ot.isMesh&&ot.matrixWorld.determinant()<0,oi=xr(ve,et,ft,Ye,ot);Me.setMaterial(Ye,si);let Zt=ft.index,fi=1;Ye.wireframe===!0&&(Zt=je.getWireframeAttribute(ft),fi=2);let Ri=ft.drawRange,Pi=ft.attributes.position,li=Ri.start*fi,oe=(Ri.start+Ri.count)*fi;kt!==null&&(li=Math.max(li,kt.start*fi),oe=Math.min(oe,(kt.start+kt.count)*fi)),Zt!==null?(li=Math.max(li,0),oe=Math.min(oe,Zt.count)):Pi!=null&&(li=Math.max(li,0),oe=Math.min(oe,Pi.count));let Ue=oe-li;if(Ue<0||Ue===1/0)return;Be.setup(ot,Ye,oi,ft,Zt);let nt,Ze=Re;if(Zt!==null&&(nt=Ke.get(Zt),Ze=Le,Ze.setIndex(nt)),ot.isMesh)Ye.wireframe===!0?(Me.setLineWidth(Ye.wireframeLinewidth*de()),Ze.setMode(1)):Ze.setMode(4);else if(ot.isLine){let Ie=Ye.linewidth;Ie===void 0&&(Ie=1),Me.setLineWidth(Ie*de()),ot.isLineSegments?Ze.setMode(1):ot.isLineLoop?Ze.setMode(2):Ze.setMode(3)}else ot.isPoints?Ze.setMode(0):ot.isSprite&&Ze.setMode(4);if(ot.isInstancedMesh)Ze.renderInstances(li,Ue,ot.count);else if(ft.isInstancedBufferGeometry){let Ie=ft._maxInstanceCount!==void 0?ft._maxInstanceCount:1/0,Rt=Math.min(ft.instanceCount,Ie);Ze.renderInstances(li,Ue,Rt)}else Ze.render(li,Ue)},this.compile=function(ve,et){function ft(Ye,ot,kt){Ye.transparent===!0&&Ye.side===yo&&Ye.forceSinglePass===!1?(Ye.side=va,Ye.needsUpdate=!0,$i(Ye,ot,kt),Ye.side=Zu,Ye.needsUpdate=!0,$i(Ye,ot,kt),Ye.side=yo):$i(Ye,ot,kt)}d=pe.get(ve),d.init(),g.push(d),ve.traverseVisible(function(Ye){Ye.isLight&&Ye.layers.test(et.layers)&&(d.pushLight(Ye),Ye.castShadow&&d.pushShadow(Ye))}),d.setupLights(x.physicallyCorrectLights),ve.traverse(function(Ye){let ot=Ye.material;if(ot)if(Array.isArray(ot))for(let kt=0;kt<ot.length;kt++){let si=ot[kt];ft(si,ve,Ye)}else ft(ot,ve,Ye)}),g.pop(),d=null};let Ce=null;function De(ve){Ce&&Ce(ve)}function at(){lt.stop()}function ut(){lt.start()}let lt=new ZJ;lt.setAnimationLoop(De),typeof self<"u"&&lt.setContext(self),this.setAnimationLoop=function(ve){Ce=ve,Xe.setAnimationLoop(ve),ve===null?lt.stop():lt.start()},Xe.addEventListener("sessionstart",at),Xe.addEventListener("sessionend",ut),this.render=function(ve,et){if(et!==void 0&&et.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(y===!0)return;ve.matrixWorldAutoUpdate===!0&&ve.updateMatrixWorld(),et.parent===null&&et.matrixWorldAutoUpdate===!0&&et.updateMatrixWorld(),Xe.enabled===!0&&Xe.isPresenting===!0&&(Xe.cameraAutoUpdate===!0&&Xe.updateCamera(et),et=Xe.getCamera()),ve.isScene===!0&&ve.onBeforeRender(x,ve,et,w),d=pe.get(ve,g.length),d.init(),g.push(d),$.multiplyMatrices(et.projectionMatrix,et.matrixWorldInverse),X.setFromProjectionMatrix($),ne=this.localClippingEnabled,W=k.init(this.clippingPlanes,ne),h=gt.get(ve,p.length),h.init(),p.push(h),It(ve,et,0,x.sortObjects),h.finish(),x.sortObjects===!0&&h.sort(H,V),W===!0&&k.beginShadows();let ft=d.state.shadowsArray;if(Q.render(ft,ve,et),W===!0&&k.endShadows(),this.info.autoReset===!0&&this.info.reset(),xe.render(h,ve),d.setupLights(x.physicallyCorrectLights),et.isArrayCamera){let Ye=et.cameras;for(let ot=0,kt=Ye.length;ot<kt;ot++){let si=Ye[ot];Vt(h,ve,si,si.viewport)}}else Vt(h,ve,et);w!==null&&(We.updateMultisampleRenderTarget(w),We.updateRenderTargetMipmap(w)),ve.isScene===!0&&ve.onAfterRender(x,ve,et),Be.resetDefaultState(),E=-1,D=null,g.pop(),g.length>0?d=g[g.length-1]:d=null,p.pop(),p.length>0?h=p[p.length-1]:h=null};function It(ve,et,ft,Ye){if(ve.visible===!1)return;if(ve.layers.test(et.layers)){if(ve.isGroup)ft=ve.renderOrder;else if(ve.isLOD)ve.autoUpdate===!0&&ve.update(et);else if(ve.isLight)d.pushLight(ve),ve.castShadow&&d.pushShadow(ve);else if(ve.isSprite){if(!ve.frustumCulled||X.intersectsSprite(ve)){Ye&&fe.setFromMatrixPosition(ve.matrixWorld).applyMatrix4($);let kt=Oe.update(ve),si=ve.material;si.visible&&h.push(ve,kt,si,ft,fe.z,null)}}else if((ve.isMesh||ve.isLine||ve.isPoints)&&(ve.isSkinnedMesh&&ve.skeleton.frame!==Ne.render.frame&&(ve.skeleton.update(),ve.skeleton.frame=Ne.render.frame),!ve.frustumCulled||X.intersectsObject(ve))){Ye&&fe.setFromMatrixPosition(ve.matrixWorld).applyMatrix4($);let kt=Oe.update(ve),si=ve.material;if(Array.isArray(si)){let oi=kt.groups;for(let Zt=0,fi=oi.length;Zt<fi;Zt++){let Ri=oi[Zt],Pi=si[Ri.materialIndex];Pi&&Pi.visible&&h.push(ve,kt,Pi,ft,fe.z,Ri)}}else si.visible&&h.push(ve,kt,si,ft,fe.z,null)}}let ot=ve.children;for(let kt=0,si=ot.length;kt<si;kt++)It(ot[kt],et,ft,Ye)}function Vt(ve,et,ft,Ye){let ot=ve.opaque,kt=ve.transmissive,si=ve.transparent;d.setupLightsView(ft),W===!0&&k.setGlobalState(x.clippingPlanes,ft),kt.length>0&&_i(ot,et,ft),Ye&&Me.viewport(T.copy(Ye)),ot.length>0&&Jt(ot,et,ft),kt.length>0&&Jt(kt,et,ft),si.length>0&&Jt(si,et,ft),Me.buffers.depth.setTest(!0),Me.buffers.depth.setMask(!0),Me.buffers.color.setMask(!0),Me.setPolygonOffset(!1)}function _i(ve,et,ft){let Ye=we.isWebGL2;Y===null&&(Y=new mn(1,1,{generateMipmaps:!0,type:be.has("EXT_color_buffer_half_float")?ip:bo,minFilter:$1,samples:Ye&&s===!0?4:0})),x.getDrawingBufferSize(se),Ye?Y.setSize(se.x,se.y):Y.setSize(e3(se.x),e3(se.y));let ot=x.getRenderTarget();x.setRenderTarget(Y),x.clear();let kt=x.toneMapping;x.toneMapping=md,Jt(ve,et,ft),x.toneMapping=kt,We.updateMultisampleRenderTarget(Y),We.updateRenderTargetMipmap(Y),x.setRenderTarget(ot)}function Jt(ve,et,ft){let Ye=et.isScene===!0?et.overrideMaterial:null;for(let ot=0,kt=ve.length;ot<kt;ot++){let si=ve[ot],oi=si.object,Zt=si.geometry,fi=Ye===null?si.material:Ye,Ri=si.group;oi.layers.test(ft.layers)&&An(oi,et,ft,Zt,fi,Ri)}}function An(ve,et,ft,Ye,ot,kt){ve.onBeforeRender(x,et,ft,Ye,ot,kt),ve.modelViewMatrix.multiplyMatrices(ft.matrixWorldInverse,ve.matrixWorld),ve.normalMatrix.getNormalMatrix(ve.modelViewMatrix),ot.onBeforeRender(x,et,ft,Ye,ve,kt),ot.transparent===!0&&ot.side===yo&&ot.forceSinglePass===!1?(ot.side=va,ot.needsUpdate=!0,x.renderBufferDirect(ft,et,Ye,ot,ve,kt),ot.side=Zu,ot.needsUpdate=!0,x.renderBufferDirect(ft,et,Ye,ot,ve,kt),ot.side=yo):x.renderBufferDirect(ft,et,Ye,ot,ve,kt),ve.onAfterRender(x,et,ft,Ye,ot,kt)}function $i(ve,et,ft){et.isScene!==!0&&(et=te);let Ye=Ge.get(ve),ot=d.state.lights,kt=d.state.shadowsArray,si=ot.state.version,oi=Qe.getParameters(ve,ot.state,kt,et,ft),Zt=Qe.getProgramCacheKey(oi),fi=Ye.programs;Ye.environment=ve.isMeshStandardMaterial?et.environment:null,Ye.fog=et.fog,Ye.envMap=(ve.isMeshStandardMaterial?He:ae).get(ve.envMap||Ye.environment),fi===void 0&&(ve.addEventListener("dispose",Ve),fi=new Map,Ye.programs=fi);let Ri=fi.get(Zt);if(Ri!==void 0){if(Ye.currentProgram===Ri&&Ye.lightsStateVersion===si)return jn(ve,oi),Ri}else oi.uniforms=Qe.getUniforms(ve),ve.onBuild(ft,oi,x),ve.onBeforeCompile(oi,x),Ri=Qe.acquireProgram(oi,Zt),fi.set(Zt,Ri),Ye.uniforms=oi.uniforms;let Pi=Ye.uniforms;(!ve.isShaderMaterial&&!ve.isRawShaderMaterial||ve.clipping===!0)&&(Pi.clippingPlanes=k.uniform),jn(ve,oi),Ye.needsLights=kr(ve),Ye.lightsStateVersion=si,Ye.needsLights&&(Pi.ambientLightColor.value=ot.state.ambient,Pi.lightProbe.value=ot.state.probe,Pi.directionalLights.value=ot.state.directional,Pi.directionalLightShadows.value=ot.state.directionalShadow,Pi.spotLights.value=ot.state.spot,Pi.spotLightShadows.value=ot.state.spotShadow,Pi.rectAreaLights.value=ot.state.rectArea,Pi.ltc_1.value=ot.state.rectAreaLTC1,Pi.ltc_2.value=ot.state.rectAreaLTC2,Pi.pointLights.value=ot.state.point,Pi.pointLightShadows.value=ot.state.pointShadow,Pi.hemisphereLights.value=ot.state.hemi,Pi.directionalShadowMap.value=ot.state.directionalShadowMap,Pi.directionalShadowMatrix.value=ot.state.directionalShadowMatrix,Pi.spotShadowMap.value=ot.state.spotShadowMap,Pi.spotLightMatrix.value=ot.state.spotLightMatrix,Pi.spotLightMap.value=ot.state.spotLightMap,Pi.pointShadowMap.value=ot.state.pointShadowMap,Pi.pointShadowMatrix.value=ot.state.pointShadowMatrix);let li=Ri.getUniforms(),oe=IC.seqWithValue(li.seq,Pi);return Ye.currentProgram=Ri,Ye.uniformsList=oe,Ri}function jn(ve,et){let ft=Ge.get(ve);ft.outputEncoding=et.outputEncoding,ft.instancing=et.instancing,ft.skinning=et.skinning,ft.morphTargets=et.morphTargets,ft.morphNormals=et.morphNormals,ft.morphColors=et.morphColors,ft.morphTargetsCount=et.morphTargetsCount,ft.numClippingPlanes=et.numClippingPlanes,ft.numIntersection=et.numClipIntersection,ft.vertexAlphas=et.vertexAlphas,ft.vertexTangents=et.vertexTangents,ft.toneMapping=et.toneMapping}function xr(ve,et,ft,Ye,ot){et.isScene!==!0&&(et=te),We.resetTextureUnits();let kt=et.fog,si=Ye.isMeshStandardMaterial?et.environment:null,oi=w===null?x.outputEncoding:w.isXRRenderTarget===!0?w.texture.encoding:$u,Zt=(Ye.isMeshStandardMaterial?He:ae).get(Ye.envMap||si),fi=Ye.vertexColors===!0&&!!ft.attributes.color&&ft.attributes.color.itemSize===4,Ri=!!Ye.normalMap&&!!ft.attributes.tangent,Pi=!!ft.morphAttributes.position,li=!!ft.morphAttributes.normal,oe=!!ft.morphAttributes.color,Ue=Ye.toneMapped?x.toneMapping:md,nt=ft.morphAttributes.position||ft.morphAttributes.normal||ft.morphAttributes.color,Ze=nt!==void 0?nt.length:0,Ie=Ge.get(Ye),Rt=d.state.lights;if(W===!0&&(ne===!0||ve!==D)){let ue=ve===D&&Ye.id===E;k.setState(Ye,ve,ue)}let wt=!1;Ye.version===Ie.__version?(Ie.needsLights&&Ie.lightsStateVersion!==Rt.state.version||Ie.outputEncoding!==oi||ot.isInstancedMesh&&Ie.instancing===!1||!ot.isInstancedMesh&&Ie.instancing===!0||ot.isSkinnedMesh&&Ie.skinning===!1||!ot.isSkinnedMesh&&Ie.skinning===!0||Ie.envMap!==Zt||Ye.fog===!0&&Ie.fog!==kt||Ie.numClippingPlanes!==void 0&&(Ie.numClippingPlanes!==k.numPlanes||Ie.numIntersection!==k.numIntersection)||Ie.vertexAlphas!==fi||Ie.vertexTangents!==Ri||Ie.morphTargets!==Pi||Ie.morphNormals!==li||Ie.morphColors!==oe||Ie.toneMapping!==Ue||we.isWebGL2===!0&&Ie.morphTargetsCount!==Ze)&&(wt=!0):(wt=!0,Ie.__version=Ye.version);let Nt=Ie.currentProgram;wt===!0&&(Nt=$i(Ye,et,ot));let Ht=!1,ai=!1,$t=!1,Z=Nt.getUniforms(),re=Ie.uniforms;if(Me.useProgram(Nt.program)&&(Ht=!0,ai=!0,$t=!0),Ye.id!==E&&(E=Ye.id,ai=!0),Ht||D!==ve){if(Z.setValue(le,"projectionMatrix",ve.projectionMatrix),we.logarithmicDepthBuffer&&Z.setValue(le,"logDepthBufFC",2/(Math.log(ve.far+1)/Math.LN2)),D!==ve&&(D=ve,ai=!0,$t=!0),Ye.isShaderMaterial||Ye.isMeshPhongMaterial||Ye.isMeshToonMaterial||Ye.isMeshStandardMaterial||Ye.envMap){let ue=Z.map.cameraPosition;ue!==void 0&&ue.setValue(le,fe.setFromMatrixPosition(ve.matrixWorld))}(Ye.isMeshPhongMaterial||Ye.isMeshToonMaterial||Ye.isMeshLambertMaterial||Ye.isMeshBasicMaterial||Ye.isMeshStandardMaterial||Ye.isShaderMaterial)&&Z.setValue(le,"isOrthographic",ve.isOrthographicCamera===!0),(Ye.isMeshPhongMaterial||Ye.isMeshToonMaterial||Ye.isMeshLambertMaterial||Ye.isMeshBasicMaterial||Ye.isMeshStandardMaterial||Ye.isShaderMaterial||Ye.isShadowMaterial||ot.isSkinnedMesh)&&Z.setValue(le,"viewMatrix",ve.matrixWorldInverse)}if(ot.isSkinnedMesh){Z.setOptional(le,ot,"bindMatrix"),Z.setOptional(le,ot,"bindMatrixInverse");let ue=ot.skeleton;ue&&(we.floatVertexTextures?(ue.boneTexture===null&&ue.computeBoneTexture(),Z.setValue(le,"boneTexture",ue.boneTexture,We),Z.setValue(le,"boneTextureSize",ue.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}let Se=ft.morphAttributes;if((Se.position!==void 0||Se.normal!==void 0||Se.color!==void 0&&we.isWebGL2===!0)&&K.update(ot,ft,Ye,Nt),(ai||Ie.receiveShadow!==ot.receiveShadow)&&(Ie.receiveShadow=ot.receiveShadow,Z.setValue(le,"receiveShadow",ot.receiveShadow)),Ye.isMeshGouraudMaterial&&Ye.envMap!==null&&(re.envMap.value=Zt,re.flipEnvMap.value=Zt.isCubeTexture&&Zt.isRenderTargetTexture===!1?-1:1),ai&&(Z.setValue(le,"toneMappingExposure",x.toneMappingExposure),Ie.needsLights&&Gr(re,$t),kt&&Ye.fog===!0&&$e.refreshFogUniforms(re,kt),$e.refreshMaterialUniforms(re,Ye,U,P,Y),IC.upload(le,Ie.uniformsList,re,We)),Ye.isShaderMaterial&&Ye.uniformsNeedUpdate===!0&&(IC.upload(le,Ie.uniformsList,re,We),Ye.uniformsNeedUpdate=!1),Ye.isSpriteMaterial&&Z.setValue(le,"center",ot.center),Z.setValue(le,"modelViewMatrix",ot.modelViewMatrix),Z.setValue(le,"normalMatrix",ot.normalMatrix),Z.setValue(le,"modelMatrix",ot.matrixWorld),ot.previousModelViewMatrix&&Z.setValue(le,"previousModelViewMatrix",ot.previousModelViewMatrix),ve.previousProjectionMatrix&&Z.setValue(le,"previousProjectionMatrix",ve.previousProjectionMatrix),Ye.isShaderMaterial||Ye.isRawShaderMaterial){let ue=Ye.uniformsGroups;for(let Pe=0,yt=ue.length;Pe<yt;Pe++)if(we.isWebGL2){let ti=ue[Pe];bt.update(ti,Nt),bt.bind(ti,Nt)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Nt}function Gr(ve,et){ve.ambientLightColor.needsUpdate=et,ve.lightProbe.needsUpdate=et,ve.directionalLights.needsUpdate=et,ve.directionalLightShadows.needsUpdate=et,ve.pointLights.needsUpdate=et,ve.pointLightShadows.needsUpdate=et,ve.spotLights.needsUpdate=et,ve.spotLightShadows.needsUpdate=et,ve.rectAreaLights.needsUpdate=et,ve.hemisphereLights.needsUpdate=et}function kr(ve){return ve.isMeshLambertMaterial||ve.isMeshToonMaterial||ve.isMeshPhongMaterial||ve.isMeshStandardMaterial||ve.isShadowMaterial||ve.isShaderMaterial&&ve.lights===!0}this.getActiveCubeFace=function(){return b},this.getActiveMipmapLevel=function(){return A},this.getRenderTarget=function(){return w},this.setRenderTargetTextures=function(ve,et,ft){Ge.get(ve.texture).__webglTexture=et,Ge.get(ve.depthTexture).__webglTexture=ft;let Ye=Ge.get(ve);Ye.__hasExternalTextures=!0,Ye.__hasExternalTextures&&(Ye.__autoAllocateDepthBuffer=ft===void 0,Ye.__autoAllocateDepthBuffer||be.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Ye.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(ve,et){let ft=Ge.get(ve);ft.__webglFramebuffer=et,ft.__useDefaultFramebuffer=et===void 0},this.setRenderTarget=function(ve,et=0,ft=0){w=ve,b=et,A=ft;let Ye=!0,ot=null,kt=!1,si=!1;if(ve){let oi=Ge.get(ve);oi.__useDefaultFramebuffer!==void 0?(Me.bindFramebuffer(36160,null),Ye=!1):oi.__webglFramebuffer===void 0?We.setupRenderTarget(ve):oi.__hasExternalTextures&&We.rebindTextures(ve,Ge.get(ve.texture).__webglTexture,Ge.get(ve.depthTexture).__webglTexture);let Zt=ve.texture;(Zt.isData3DTexture||Zt.isDataArrayTexture||Zt.isCompressedArrayTexture)&&(si=!0);let fi=Ge.get(ve).__webglFramebuffer;ve.isWebGLCubeRenderTarget?(ot=fi[et],kt=!0):we.isWebGL2&&ve.samples>0&&We.useMultisampledRTT(ve)===!1?ot=Ge.get(ve).__webglMultisampledFramebuffer:ot=fi,T.copy(ve.viewport),I.copy(ve.scissor),R=ve.scissorTest}else T.copy(j).multiplyScalar(U).floor(),I.copy(J).multiplyScalar(U).floor(),R=F;if(Me.bindFramebuffer(36160,ot)&&we.drawBuffers&&Ye&&Me.drawBuffers(ve,ot),Me.viewport(T),Me.scissor(I),Me.setScissorTest(R),kt){let oi=Ge.get(ve.texture);le.framebufferTexture2D(36160,36064,34069+et,oi.__webglTexture,ft)}else if(si){let oi=Ge.get(ve.texture),Zt=et||0;le.framebufferTextureLayer(36160,36064,oi.__webglTexture,ft||0,Zt)}E=-1},this.readRenderTargetPixels=function(ve,et,ft,Ye,ot,kt,si){if(!(ve&&ve.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let oi=Ge.get(ve).__webglFramebuffer;if(ve.isWebGLCubeRenderTarget&&si!==void 0&&(oi=oi[si]),oi){Me.bindFramebuffer(36160,oi);try{let Zt=ve.texture,fi=Zt.format,Ri=Zt.type;if(fi!==Rr&&st.convert(fi)!==le.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}let Pi=Ri===ip&&(be.has("EXT_color_buffer_half_float")||we.isWebGL2&&be.has("EXT_color_buffer_float"));if(Ri!==bo&&st.convert(Ri)!==le.getParameter(35738)&&!(Ri===Zn&&(we.isWebGL2||be.has("OES_texture_float")||be.has("WEBGL_color_buffer_float")))&&!Pi){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}et>=0&&et<=ve.width-Ye&&ft>=0&&ft<=ve.height-ot&&le.readPixels(et,ft,Ye,ot,st.convert(fi),st.convert(Ri),kt)}finally{let Zt=w!==null?Ge.get(w).__webglFramebuffer:null;Me.bindFramebuffer(36160,Zt)}}},this.readRenderTargetPixelsAsync=async function(ve,et,ft,Ye,ot,kt,si){if(!(ve&&ve.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let oi=Ge.get(ve).__webglFramebuffer;if(ve.isWebGLCubeRenderTarget&&si!==void 0&&(oi=oi[si]),oi){let Zt=ve.texture,fi=Zt.format,Ri=Zt.type;if(et>=0&&et<=ve.width-Ye&&ft>=0&&ft<=ve.height-ot){Me.bindFramebuffer(le.FRAMEBUFFER,oi);let Pi=le.createBuffer();le.bindBuffer(le.PIXEL_PACK_BUFFER,Pi),le.bufferData(le.PIXEL_PACK_BUFFER,kt.byteLength,le.STREAM_READ),le.readPixels(et,ft,Ye,ot,st.convert(fi),st.convert(Ri),0);let li=w!==null?Ge.get(w).__webglFramebuffer:null;Me.bindFramebuffer(le.FRAMEBUFFER,li);let oe=le.fenceSync(le.SYNC_GPU_COMMANDS_COMPLETE,0);return le.flush(),await bbe(le,oe,4),le.bindBuffer(le.PIXEL_PACK_BUFFER,Pi),le.getBufferSubData(le.PIXEL_PACK_BUFFER,0,kt),le.deleteBuffer(Pi),le.deleteSync(oe),kt}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(ve,et,ft=0){let Ye=Math.pow(2,-ft),ot=Math.floor(et.image.width*Ye),kt=Math.floor(et.image.height*Ye);We.setTexture2D(et,0),le.copyTexSubImage2D(3553,ft,0,0,ve.x,ve.y,ot,kt),Me.unbindTexture()},this.copyTextureToTexture=function(ve,et,ft,Ye=0){let ot=et.image.width,kt=et.image.height,si=st.convert(ft.format),oi=st.convert(ft.type);We.setTexture2D(ft,0),le.pixelStorei(37440,ft.flipY),le.pixelStorei(37441,ft.premultiplyAlpha),le.pixelStorei(3317,ft.unpackAlignment),et.isDataTexture?le.texSubImage2D(3553,Ye,ve.x,ve.y,ot,kt,si,oi,et.image.data):et.isCompressedTexture?le.compressedTexSubImage2D(3553,Ye,ve.x,ve.y,et.mipmaps[0].width,et.mipmaps[0].height,si,et.mipmaps[0].data):le.texSubImage2D(3553,Ye,ve.x,ve.y,si,oi,et.image),Ye===0&&ft.generateMipmaps&&le.generateMipmap(3553),Me.unbindTexture()},this.copyTextureToTexture3D=function(ve,et,ft,Ye,ot=0){if(x.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}let kt=ve.max.x-ve.min.x+1,si=ve.max.y-ve.min.y+1,oi=ve.max.z-ve.min.z+1,Zt=st.convert(Ye.format),fi=st.convert(Ye.type),Ri;if(Ye.isData3DTexture)We.setTexture3D(Ye,0),Ri=32879;else if(Ye.isDataArrayTexture)We.setTexture2DArray(Ye,0),Ri=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}le.pixelStorei(37440,Ye.flipY),le.pixelStorei(37441,Ye.premultiplyAlpha),le.pixelStorei(3317,Ye.unpackAlignment);let Pi=le.getParameter(3314),li=le.getParameter(32878),oe=le.getParameter(3316),Ue=le.getParameter(3315),nt=le.getParameter(32877),Ze=ft.isCompressedTexture?ft.mipmaps[0]:ft.image;le.pixelStorei(3314,Ze.width),le.pixelStorei(32878,Ze.height),le.pixelStorei(3316,ve.min.x),le.pixelStorei(3315,ve.min.y),le.pixelStorei(32877,ve.min.z),ft.isDataTexture||ft.isData3DTexture?le.texSubImage3D(Ri,ot,et.x,et.y,et.z,kt,si,oi,Zt,fi,Ze.data):ft.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),le.compressedTexSubImage3D(Ri,ot,et.x,et.y,et.z,kt,si,oi,Zt,Ze.data)):le.texSubImage3D(Ri,ot,et.x,et.y,et.z,kt,si,oi,Zt,fi,Ze),le.pixelStorei(3314,Pi),le.pixelStorei(32878,li),le.pixelStorei(3316,oe),le.pixelStorei(3315,Ue),le.pixelStorei(32877,nt),ot===0&&Ye.generateMipmaps&&le.generateMipmap(Ri),Me.unbindTexture()},this.initRenderTarget=function(ve){Ge.get(ve).__webglFramebuffer===void 0&&We.setupRenderTarget(ve)},this.initTexture=function(ve){ve.isCubeTexture?We.setTextureCube(ve,0):ve.isData3DTexture?We.setTexture3D(ve,0):ve.isDataArrayTexture||ve.isCompressedArrayTexture?We.setTexture2DArray(ve,0):We.setTexture2D(ve,0),Me.unbindTexture()},this.resetState=function(){b=0,A=0,w=null,Me.reset(),Be.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}var gMe=class extends rZ{};gMe.prototype.isWebGL1Renderer=!0;var sZ=class{constructor(e,t=1,i=1e3){this.isFog=!0,this.name="",this.color=new gi(e),this.near=t,this.far=i}clone(){return new sZ(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}},Pl=class extends kn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){let t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}},vMe=class{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=HU,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=qc()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let n=0,r=this.stride;n<r;n++)this.array[e+n]=t.array[i+n];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=qc()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=qc()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}},Ho=new G,XU=class{constructor(e,t,i,n=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)Ho.fromBufferAttribute(this,t),Ho.applyMatrix4(e),this.setXYZ(t,Ho.x,Ho.y,Ho.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Ho.fromBufferAttribute(this,t),Ho.applyNormalMatrix(e),this.setXYZ(t,Ho.x,Ho.y,Ho.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Ho.fromBufferAttribute(this,t),Ho.transformDirection(e),this.setXYZ(t,Ho.x,Ho.y,Ho.z);return this}setX(e,t){return this.normalized&&(t=dr(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=dr(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=dr(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=dr(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Vf(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Vf(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Vf(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Vf(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=dr(t,this.array),i=dr(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=dr(t,this.array),i=dr(i,this.array),n=dr(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this}setXYZW(e,t,i,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=dr(t,this.array),i=dr(i,this.array),n=dr(n,this.array),r=dr(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this.data.array[e+3]=r,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");let t=[];for(let i=0;i<this.count;i++){let n=i*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[n+r])}return new vi(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new XU(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");let t=[];for(let i=0;i<this.count;i++){let n=i*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[n+r])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}},aZ=class extends kn{constructor(){super(),this.isBone=!0,this.type="Bone"}},Zo=class extends Hr{constructor(e=null,t=1,i=1,n,r,s,a,o,l=rn,c=rn,u,h){super(null,s,a,o,l,c,n,r,u,h),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},ej=new Bt,yMe=new Bt,L4=class{constructor(e=[],t=[]){this.uuid=qc(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){let e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,n=this.bones.length;i<n;i++)this.boneInverses.push(new Bt)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){let i=new Bt;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){let i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){let i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){let e=this.bones,t=this.boneInverses,i=this.boneMatrices,n=this.boneTexture;for(let r=0,s=e.length;r<s;r++){let a=e[r]?e[r].matrixWorld:yMe;ej.multiplyMatrices(a,t[r]),ej.toArray(i,r*16)}n!==null&&(n.needsUpdate=!0)}clone(){return new L4(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=kJ(e),e=Math.max(e,4);let t=new Float32Array(e*e*4);t.set(this.boneMatrices);let i=new Zo(t,e,e,Rr,Zn);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){let n=this.bones[t];if(n.name===e)return n}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,n=e.bones.length;i<n;i++){let r=e.bones[i],s=t[r];s===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),s=new aZ),this.bones.push(s),this.boneInverses.push(new Bt().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){let e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;let t=this.bones,i=this.boneInverses;for(let n=0,r=t.length;n<r;n++){let s=t[n];e.bones.push(s.uuid);let a=i[n];e.boneInverses.push(a.toArray())}return e}},mw=class extends vi{constructor(e,t,i,n=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){let e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}},tj=new Bt,ij=new Bt,gT=[],xMe=new Bt,P_=new fr,bMe=class extends fr{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new mw(new Float32Array(i*16),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1;for(let n=0;n<i;n++)this.setMatrixAt(n,xMe)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){let i=this.matrixWorld,n=this.count;if(P_.geometry=this.geometry,P_.material=this.material,P_.material!==void 0)for(let r=0;r<n;r++){this.getMatrixAt(r,tj),ij.multiplyMatrices(i,tj),P_.matrixWorld=ij,P_.raycast(e,gT);for(let s=0,a=gT.length;s<a;s++){let o=gT[s];o.instanceId=r,o.object=this,t.push(o)}gT.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new mw(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}},gg=class extends sM{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new gi(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}},nj=new G,rj=new G,sj=new Bt,hI=new Cb,vT=new Ol,t3=class extends kn{constructor(e=new ii,t=new gg){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){let e=this.geometry;if(e.index===null){let t=e.attributes.position,i=[0];for(let n=1,r=t.count;n<r;n++)nj.fromBufferAttribute(t,n-1),rj.fromBufferAttribute(t,n),i[n]=i[n-1],i[n]+=nj.distanceTo(rj);e.setAttribute("lineDistance",new Gt(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){let i=this.geometry,n=this.matrixWorld,r=e.params.Line.threshold,s=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),vT.copy(i.boundingSphere),vT.applyMatrix4(n),vT.radius+=r,e.ray.intersectsSphere(vT)===!1)return;sj.copy(n).invert(),hI.copy(e.ray).applyMatrix4(sj);let a=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=new G,c=new G,u=new G,h=new G,d=this.isLineSegments?2:1,p=i.index,g=i.attributes.position;if(p!==null){let x=Math.max(0,s.start),y=Math.min(p.count,s.start+s.count);for(let b=x,A=y-1;b<A;b+=d){let w=p.getX(b),E=p.getX(b+1);if(l.fromBufferAttribute(g,w),c.fromBufferAttribute(g,E),hI.distanceSqToSegment(l,c,h,u)>o)continue;h.applyMatrix4(this.matrixWorld);let D=e.ray.origin.distanceTo(h);D<e.near||D>e.far||t.push({distance:D,point:u.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this})}}else{let x=Math.max(0,s.start),y=Math.min(g.count,s.start+s.count);for(let b=x,A=y-1;b<A;b+=d){if(l.fromBufferAttribute(g,b),c.fromBufferAttribute(g,b+1),hI.distanceSqToSegment(l,c,h,u)>o)continue;h.applyMatrix4(this.matrixWorld);let w=e.ray.origin.distanceTo(h);w<e.near||w>e.far||t.push({distance:w,point:u.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let i=e[t[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let n=0,r=i.length;n<r;n++){let s=i[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=n}}}}},aj=new G,oj=new G,aM=class extends t3{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){let e=this.geometry;if(e.index===null){let t=e.attributes.position,i=[];for(let n=0,r=t.count;n<r;n+=2)aj.fromBufferAttribute(t,n),oj.fromBufferAttribute(t,n+1),i[n]=n===0?0:i[n-1],i[n+1]=i[n]+aj.distanceTo(oj);e.setAttribute("lineDistance",new Gt(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}},SMe=class extends Hr{constructor(e,t,i,n,r,s,a,o,l){super(e,t,i,n,r,s,a,o,l),this.isVideoTexture=!0,this.minFilter=s!==void 0?s:Yi,this.magFilter=r!==void 0?r:Yi,this.generateMipmaps=!1;let c=this;function u(){c.needsUpdate=!0,e.requestVideoFrameCallback(u)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(u)}clone(){return new this.constructor(this.image).copy(this)}update(){let e=this.image;!("requestVideoFrameCallback"in e)&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}},_Me=class extends Hr{constructor(e,t,i,n,r,s,a,o,l){super(e,t,i,n,r,s,a,o,l),this.isCanvasTexture=!0,this.needsUpdate=!0}},Dd=class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){let i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){let t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){let t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){let e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let t=[],i,n=this.getPoint(0),r=0;t.push(0);for(let s=1;s<=e;s++)i=this.getPoint(s/e),r+=i.distanceTo(n),t.push(r),n=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){let i=this.getLengths(),n=0,r=i.length,s;t?s=t:s=e*i[r-1];let a=0,o=r-1,l;for(;a<=o;)if(n=Math.floor(a+(o-a)/2),l=i[n]-s,l<0)a=n+1;else if(l>0)o=n-1;else{o=n;break}if(n=o,i[n]===s)return n/(r-1);let c=i[n],u=i[n+1]-c,h=(s-c)/u;return(n+h)/(r-1)}getTangent(e,t){let i=e-1e-4,n=e+1e-4;i<0&&(i=0),n>1&&(n=1);let r=this.getPoint(i),s=this.getPoint(n),a=t||(r.isVector2?new Ae:new G);return a.copy(s).sub(r).normalize(),a}getTangentAt(e,t){let i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){let i=new G,n=[],r=[],s=[],a=new G,o=new Bt;for(let d=0;d<=e;d++){let p=d/e;n[d]=this.getTangentAt(p,new G)}r[0]=new G,s[0]=new G;let l=Number.MAX_VALUE,c=Math.abs(n[0].x),u=Math.abs(n[0].y),h=Math.abs(n[0].z);c<=l&&(l=c,i.set(1,0,0)),u<=l&&(l=u,i.set(0,1,0)),h<=l&&i.set(0,0,1),a.crossVectors(n[0],i).normalize(),r[0].crossVectors(n[0],a),s[0].crossVectors(n[0],r[0]);for(let d=1;d<=e;d++){if(r[d]=r[d-1].clone(),s[d]=s[d-1].clone(),a.crossVectors(n[d-1],n[d]),a.length()>Number.EPSILON){a.normalize();let p=Math.acos(Es(n[d-1].dot(n[d]),-1,1));r[d].applyMatrix4(o.makeRotationAxis(a,p))}s[d].crossVectors(n[d],r[d])}if(t===!0){let d=Math.acos(Es(r[0].dot(r[e]),-1,1));d/=e,n[0].dot(a.crossVectors(r[0],r[e]))>0&&(d=-d);for(let p=1;p<=e;p++)r[p].applyMatrix4(o.makeRotationAxis(n[p],d*p)),s[p].crossVectors(n[p],r[p])}return{tangents:n,normals:r,binormals:s}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){let e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}},WR=class extends Dd{constructor(e=0,t=0,i=1,n=1,r=0,s=Math.PI*2,a=!1,o=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=n,this.aStartAngle=r,this.aEndAngle=s,this.aClockwise=a,this.aRotation=o}getPoint(e,t){let i=t||new Ae,n=Math.PI*2,r=this.aEndAngle-this.aStartAngle,s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=n;for(;r>n;)r-=n;r<Number.EPSILON&&(s?r=0:r=n),this.aClockwise===!0&&!s&&(r===n?r=-n:r=r-n);let a=this.aStartAngle+e*r,o=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){let c=Math.cos(this.aRotation),u=Math.sin(this.aRotation),h=o-this.aX,d=l-this.aY;o=h*c-d*u+this.aX,l=h*u+d*c+this.aY}return i.set(o,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){let e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}},AMe=class extends WR{constructor(e,t,i,n,r,s){super(e,t,i,i,n,r,s),this.isArcCurve=!0,this.type="ArcCurve"}};function U4(){let e=0,t=0,i=0,n=0;function r(s,a,o,l){e=s,t=o,i=-3*s+3*a-2*o-l,n=2*s-2*a+o+l}return{initCatmullRom:function(s,a,o,l,c){r(a,o,c*(o-s),c*(l-a))},initNonuniformCatmullRom:function(s,a,o,l,c,u,h){let d=(a-s)/c-(o-s)/(c+u)+(o-a)/u,p=(o-a)/u-(l-a)/(u+h)+(l-o)/h;d*=u,p*=u,r(a,o,d,p)},calc:function(s){let a=s*s,o=a*s;return e+t*s+i*a+n*o}}}var yT=new G,dI=new U4,fI=new U4,pI=new U4,wMe=class extends Dd{constructor(e=[],t=!1,i="centripetal",n=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=n}getPoint(e,t=new G){let i=t,n=this.points,r=n.length,s=(r-(this.closed?0:1))*e,a=Math.floor(s),o=s-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/r)+1)*r:o===0&&a===r-1&&(a=r-2,o=1);let l,c;this.closed||a>0?l=n[(a-1)%r]:(yT.subVectors(n[0],n[1]).add(n[0]),l=yT);let u=n[a%r],h=n[(a+1)%r];if(this.closed||a+2<r?c=n[(a+2)%r]:(yT.subVectors(n[r-1],n[r-2]).add(n[r-1]),c=yT),this.curveType==="centripetal"||this.curveType==="chordal"){let d=this.curveType==="chordal"?.5:.25,p=Math.pow(l.distanceToSquared(u),d),g=Math.pow(u.distanceToSquared(h),d),x=Math.pow(h.distanceToSquared(c),d);g<1e-4&&(g=1),p<1e-4&&(p=g),x<1e-4&&(x=g),dI.initNonuniformCatmullRom(l.x,u.x,h.x,c.x,p,g,x),fI.initNonuniformCatmullRom(l.y,u.y,h.y,c.y,p,g,x),pI.initNonuniformCatmullRom(l.z,u.z,h.z,c.z,p,g,x)}else this.curveType==="catmullrom"&&(dI.initCatmullRom(l.x,u.x,h.x,c.x,this.tension),fI.initCatmullRom(l.y,u.y,h.y,c.y,this.tension),pI.initCatmullRom(l.z,u.z,h.z,c.z,this.tension));return i.set(dI.calc(o),fI.calc(o),pI.calc(o)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){let n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let n=e.points[t];this.points.push(new G().fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}};function lj(e,t,i,n,r){let s=(n-t)*.5,a=(r-i)*.5,o=e*e,l=e*o;return(2*i-2*n+s+a)*l+(-3*i+3*n-2*s-a)*o+s*e+i}function MMe(e,t){let i=1-e;return i*i*t}function EMe(e,t){return 2*(1-e)*e*t}function TMe(e,t){return e*e*t}function BA(e,t,i,n){return MMe(e,t)+EMe(e,i)+TMe(e,n)}function CMe(e,t){let i=1-e;return i*i*i*t}function DMe(e,t){let i=1-e;return 3*i*i*e*t}function RMe(e,t){return 3*(1-e)*e*e*t}function PMe(e,t){return e*e*e*t}function IA(e,t,i,n,r){return CMe(e,t)+DMe(e,i)+RMe(e,n)+PMe(e,r)}var Xu=class extends Dd{constructor(e=new Ae,t=new Ae,i=new Ae,n=new Ae){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=n}getPoint(e,t=new Ae){let i=t,n=this.v0,r=this.v1,s=this.v2,a=this.v3;return i.set(IA(e,n.x,r.x,s.x,a.x),IA(e,n.y,r.y,s.y,a.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},LC=class extends Dd{constructor(e=new G,t=new G,i=new G,n=new G){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=n}getPoint(e,t=new G){let i=t,n=this.v0,r=this.v1,s=this.v2,a=this.v3;return i.set(IA(e,n.x,r.x,s.x,a.x),IA(e,n.y,r.y,s.y,a.y),IA(e,n.z,r.z,s.z,a.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},Ku=class extends Dd{constructor(e=new Ae,t=new Ae){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Ae){let i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){let i=t||new Ae;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},oZ=class extends Dd{constructor(e=new G,t=new G){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new G){let i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},ng=class extends Dd{constructor(e=new Ae,t=new Ae,i=new Ae){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new Ae){let i=t,n=this.v0,r=this.v1,s=this.v2;return i.set(BA(e,n.x,r.x,s.x),BA(e,n.y,r.y,s.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},OMe=class extends Dd{constructor(e=new G,t=new G,i=new G){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new G){let i=t,n=this.v0,r=this.v1,s=this.v2;return i.set(BA(e,n.x,r.x,s.x),BA(e,n.y,r.y,s.y),BA(e,n.z,r.z,s.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},N4=class extends Dd{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new Ae){let i=t,n=this.points,r=(n.length-1)*e,s=Math.floor(r),a=r-s,o=n[s===0?s:s-1],l=n[s],c=n[s>n.length-2?n.length-1:s+1],u=n[s>n.length-3?n.length-1:s+2];return i.set(lj(a,o.x,l.x,c.x,u.x),lj(a,o.y,l.y,c.y,u.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let n=e.points[t];this.points.push(n.clone())}return this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){let n=this.points[t];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let n=e.points[t];this.points.push(new Ae().fromArray(n))}return this}},BMe=Object.freeze({__proto__:null,ArcCurve:AMe,CatmullRomCurve3:wMe,CubicBezierCurve:Xu,CubicBezierCurve3:LC,EllipseCurve:WR,LineCurve:Ku,LineCurve3:oZ,QuadraticBezierCurve:ng,QuadraticBezierCurve3:OMe,SplineCurve:N4}),lZ=class extends Dd{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){let e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Ku(t,e))}getPoint(e,t){let i=e*this.getLength(),n=this.getCurveLengths(),r=0;for(;r<n.length;){if(n[r]>=i){let s=n[r]-i,a=this.curves[r],o=a.getLength(),l=o===0?0:1-s/o;return a.getPointAt(l,t)}r++}return null}getLength(){let e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let e=[],t=0;for(let i=0,n=this.curves.length;i<n;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){let t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){let t=[],i;for(let n=0,r=this.curves;n<r.length;n++){let s=r[n],a=s.isEllipseCurve?e*2:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?e*s.points.length:e,o=s.getPoints(a);for(let l=0;l<o.length;l++){let c=o[l];i&&i.equals(c)||(t.push(c),i=c)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){let n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){let e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){let n=this.curves[t];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){let n=e.curves[t];this.curves.push(new BMe[n.type]().fromJSON(n))}return this}},i3=class extends lZ{constructor(e){super(),this.type="Path",this.currentPoint=new Ae,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){let i=new Ku(this.currentPoint.clone(),new Ae(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,n){let r=new ng(this.currentPoint.clone(),new Ae(e,t),new Ae(i,n));return this.curves.push(r),this.currentPoint.set(i,n),this}bezierCurveTo(e,t,i,n,r,s){let a=new Xu(this.currentPoint.clone(),new Ae(e,t),new Ae(i,n),new Ae(r,s));return this.curves.push(a),this.currentPoint.set(r,s),this}splineThru(e){let t=[this.currentPoint.clone()].concat(e),i=new N4(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,n,r,s){let a=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(e+a,t+o,i,n,r,s),this}absarc(e,t,i,n,r,s){return this.absellipse(e,t,i,i,n,r,s),this}ellipse(e,t,i,n,r,s,a,o){let l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,i,n,r,s,a,o),this}absellipse(e,t,i,n,r,s,a,o){let l=new WR(e,t,i,n,r,s,a,o);if(this.curves.length>0){let u=l.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(l);let c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){let e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}},cZ=class extends ii{constructor(e=[new Ae(0,-.5),new Ae(.5,0),new Ae(0,.5)],t=12,i=0,n=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:n},t=Math.floor(t),n=Es(n,0,Math.PI*2);let r=[],s=[],a=[],o=[],l=[],c=1/t,u=new G,h=new Ae,d=new G,p=new G,g=new G,x=0,y=0;for(let b=0;b<=e.length-1;b++)switch(b){case 0:x=e[b+1].x-e[b].x,y=e[b+1].y-e[b].y,d.x=y*1,d.y=-x,d.z=y*0,g.copy(d),d.normalize(),o.push(d.x,d.y,d.z);break;case e.length-1:o.push(g.x,g.y,g.z);break;default:x=e[b+1].x-e[b].x,y=e[b+1].y-e[b].y,d.x=y*1,d.y=-x,d.z=y*0,p.copy(d),d.x+=g.x,d.y+=g.y,d.z+=g.z,d.normalize(),o.push(d.x,d.y,d.z),g.copy(p)}for(let b=0;b<=t;b++){let A=i+b*c*n,w=Math.sin(A),E=Math.cos(A);for(let D=0;D<=e.length-1;D++){u.x=e[D].x*w,u.y=e[D].y,u.z=e[D].x*E,s.push(u.x,u.y,u.z),h.x=b/t,h.y=D/(e.length-1),a.push(h.x,h.y);let T=o[3*D+0]*w,I=o[3*D+1],R=o[3*D+0]*E;l.push(T,I,R)}}for(let b=0;b<t;b++)for(let A=0;A<e.length-1;A++){let w=A+b*e.length,E=w,D=w+e.length,T=w+e.length+1,I=w+1;r.push(E,D,I),r.push(T,I,D)}this.setIndex(r),this.setAttribute("position",new Gt(s,3)),this.setAttribute("uv",new Gt(a,2)),this.setAttribute("normal",new Gt(l,3))}static fromJSON(e){return new cZ(e.points,e.segments,e.phiStart,e.phiLength)}},z4=class extends ii{constructor(e=1,t=1,i=1,n=32,r=1,s=!1,a=0,o=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:n,heightSegments:r,openEnded:s,thetaStart:a,thetaLength:o};let l=this;n=Math.floor(n),r=Math.floor(r);let c=[],u=[],h=[],d=[],p=0,g=[],x=i/2,y=0;b(),s===!1&&(e>0&&A(!0),t>0&&A(!1)),this.setIndex(c),this.setAttribute("position",new Gt(u,3)),this.setAttribute("normal",new Gt(h,3)),this.setAttribute("uv",new Gt(d,2));function b(){let w=new G,E=new G,D=0,T=(t-e)/i;for(let I=0;I<=r;I++){let R=[],O=I/r,P=O*(t-e)+e;for(let U=0;U<=n;U++){let H=U/n,V=H*o+a,j=Math.sin(V),J=Math.cos(V);E.x=P*j,E.y=-O*i+x,E.z=P*J,u.push(E.x,E.y,E.z),w.set(j,T,J).normalize(),h.push(w.x,w.y,w.z),d.push(H,1-O),R.push(p++)}g.push(R)}for(let I=0;I<n;I++)for(let R=0;R<r;R++){let O=g[R][I],P=g[R+1][I],U=g[R+1][I+1],H=g[R][I+1];c.push(O,P,H),c.push(P,U,H),D+=6}l.addGroup(y,D,0),y+=D}function A(w){let E=p,D=new Ae,T=new G,I=0,R=w===!0?e:t,O=w===!0?1:-1;for(let U=1;U<=n;U++)u.push(0,x*O,0),h.push(0,O,0),d.push(.5,.5),p++;let P=p;for(let U=0;U<=n;U++){let H=U/n*o+a,V=Math.cos(H),j=Math.sin(H);T.x=R*j,T.y=x*O,T.z=R*V,u.push(T.x,T.y,T.z),h.push(0,O,0),D.x=V*.5+.5,D.y=j*.5*O+.5,d.push(D.x,D.y),p++}for(let U=0;U<n;U++){let H=E+U,V=P+U;w===!0?c.push(V,V+1,H):c.push(V+1,V,H),I+=3}l.addGroup(y,I,w===!0?1:2),y+=I}}static fromJSON(e){return new z4(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},F4=class extends z4{constructor(e=1,t=1,i=32,n=1,r=!1,s=0,a=Math.PI*2){super(0,e,t,i,n,r,s,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:s,thetaLength:a}}static fromJSON(e){return new F4(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},V4=class extends ii{constructor(e=[],t=[],i=1,n=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:n};let r=[],s=[];a(n),l(i),c(),this.setAttribute("position",new Gt(r,3)),this.setAttribute("normal",new Gt(r.slice(),3)),this.setAttribute("uv",new Gt(s,2)),n===0?this.computeVertexNormals():this.normalizeNormals();function a(b){let A=new G,w=new G,E=new G;for(let D=0;D<t.length;D+=3)d(t[D+0],A),d(t[D+1],w),d(t[D+2],E),o(A,w,E,b)}function o(b,A,w,E){let D=E+1,T=[];for(let I=0;I<=D;I++){T[I]=[];let R=b.clone().lerp(w,I/D),O=A.clone().lerp(w,I/D),P=D-I;for(let U=0;U<=P;U++)U===0&&I===D?T[I][U]=R:T[I][U]=R.clone().lerp(O,U/P)}for(let I=0;I<D;I++)for(let R=0;R<2*(D-I)-1;R++){let O=Math.floor(R/2);R%2===0?(h(T[I][O+1]),h(T[I+1][O]),h(T[I][O])):(h(T[I][O+1]),h(T[I+1][O+1]),h(T[I+1][O]))}}function l(b){let A=new G;for(let w=0;w<r.length;w+=3)A.x=r[w+0],A.y=r[w+1],A.z=r[w+2],A.normalize().multiplyScalar(b),r[w+0]=A.x,r[w+1]=A.y,r[w+2]=A.z}function c(){let b=new G;for(let A=0;A<r.length;A+=3){b.x=r[A+0],b.y=r[A+1],b.z=r[A+2];let w=x(b)/2/Math.PI+.5,E=y(b)/Math.PI+.5;s.push(w,1-E)}p(),u()}function u(){for(let b=0;b<s.length;b+=6){let A=s[b+0],w=s[b+2],E=s[b+4],D=Math.max(A,w,E),T=Math.min(A,w,E);D>.9&&T<.1&&(A<.2&&(s[b+0]+=1),w<.2&&(s[b+2]+=1),E<.2&&(s[b+4]+=1))}}function h(b){r.push(b.x,b.y,b.z)}function d(b,A){let w=b*3;A.x=e[w+0],A.y=e[w+1],A.z=e[w+2]}function p(){let b=new G,A=new G,w=new G,E=new G,D=new Ae,T=new Ae,I=new Ae;for(let R=0,O=0;R<r.length;R+=9,O+=6){b.set(r[R+0],r[R+1],r[R+2]),A.set(r[R+3],r[R+4],r[R+5]),w.set(r[R+6],r[R+7],r[R+8]),D.set(s[O+0],s[O+1]),T.set(s[O+2],s[O+3]),I.set(s[O+4],s[O+5]),E.copy(b).add(A).add(w).divideScalar(3);let P=x(E);g(D,O+0,b,P),g(T,O+2,A,P),g(I,O+4,w,P)}}function g(b,A,w,E){E<0&&b.x===1&&(s[A]=b.x-1),w.x===0&&w.z===0&&(s[A]=E/2/Math.PI+.5)}function x(b){return Math.atan2(b.z,-b.x)}function y(b){return Math.atan2(-b.y,Math.sqrt(b.x*b.x+b.z*b.z))}}static fromJSON(e){return new V4(e.vertices,e.indices,e.radius,e.details)}},uZ=class extends V4{constructor(e=1,t=0){let i=(1+Math.sqrt(5))/2,n=1/i,r=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-i,0,-n,i,0,n,-i,0,n,i,-n,-i,0,-n,i,0,n,-i,0,n,i,0,-i,0,-n,i,0,-n,-i,0,n,i,0,n],s=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(r,s,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new uZ(e.radius,e.detail)}},n3=class extends i3{constructor(e){super(e),this.uuid=qc(),this.type="Shape",this.holes=[]}getPointsHoles(e){let t=[];for(let i=0,n=this.holes.length;i<n;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){let n=e.holes[t];this.holes.push(n.clone())}return this}toJSON(){let e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){let n=this.holes[t];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){let n=e.holes[t];this.holes.push(new i3().fromJSON(n))}return this}},IMe={triangulate:function(e,t,i=2){let n=t&&t.length,r=n?t[0]*i:e.length,s=hZ(e,0,r,i,!0),a=[];if(!s||s.next===s.prev)return a;let o,l,c,u,h,d,p;if(n&&(s=FMe(e,t,s,i)),e.length>80*i){o=c=e[0],l=u=e[1];for(let g=i;g<r;g+=i)h=e[g],d=e[g+1],h<o&&(o=h),d<l&&(l=d),h>c&&(c=h),d>u&&(u=d);p=Math.max(c-o,u-l),p=p!==0?32767/p:0}return gw(s,a,i,o,l,p,0),a}};function hZ(e,t,i,n,r){let s,a;if(r===KMe(e,t,i,n)>0)for(s=t;s<i;s+=n)a=cj(s,e[s],e[s+1],a);else for(s=i-n;s>=t;s-=n)a=cj(s,e[s],e[s+1],a);return a&&XR(a,a.next)&&(yw(a),a=a.next),a}function U0(e,t){if(!e)return e;t||(t=e);let i=e,n;do if(n=!1,!i.steiner&&(XR(i,i.next)||Fr(i.prev,i,i.next)===0)){if(yw(i),i=t=i.prev,i===i.next)break;n=!0}else i=i.next;while(n||i!==t);return t}function gw(e,t,i,n,r,s,a){if(!e)return;!a&&s&&jMe(e,n,r,s);let o=e,l,c;for(;e.prev!==e.next;){if(l=e.prev,c=e.next,s?UMe(e,n,r,s):LMe(e)){t.push(l.i/i|0),t.push(e.i/i|0),t.push(c.i/i|0),yw(e),e=c.next,o=c.next;continue}if(e=c,e===o){a?a===1?(e=NMe(U0(e),t,i),gw(e,t,i,n,r,s,2)):a===2&&zMe(e,t,i,n,r,s):gw(U0(e),t,i,n,r,s,1);break}}}function LMe(e){let t=e.prev,i=e,n=e.next;if(Fr(t,i,n)>=0)return!1;let r=t.x,s=i.x,a=n.x,o=t.y,l=i.y,c=n.y,u=r<s?r<a?r:a:s<a?s:a,h=o<l?o<c?o:c:l<c?l:c,d=r>s?r>a?r:a:s>a?s:a,p=o>l?o>c?o:c:l>c?l:c,g=n.next;for(;g!==t;){if(g.x>=u&&g.x<=d&&g.y>=h&&g.y<=p&&g1(r,o,s,l,a,c,g.x,g.y)&&Fr(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function UMe(e,t,i,n){let r=e.prev,s=e,a=e.next;if(Fr(r,s,a)>=0)return!1;let o=r.x,l=s.x,c=a.x,u=r.y,h=s.y,d=a.y,p=o<l?o<c?o:c:l<c?l:c,g=u<h?u<d?u:d:h<d?h:d,x=o>l?o>c?o:c:l>c?l:c,y=u>h?u>d?u:d:h>d?h:d,b=qU(p,g,t,i,n),A=qU(x,y,t,i,n),w=e.prevZ,E=e.nextZ;for(;w&&w.z>=b&&E&&E.z<=A;){if(w.x>=p&&w.x<=x&&w.y>=g&&w.y<=y&&w!==r&&w!==a&&g1(o,u,l,h,c,d,w.x,w.y)&&Fr(w.prev,w,w.next)>=0||(w=w.prevZ,E.x>=p&&E.x<=x&&E.y>=g&&E.y<=y&&E!==r&&E!==a&&g1(o,u,l,h,c,d,E.x,E.y)&&Fr(E.prev,E,E.next)>=0))return!1;E=E.nextZ}for(;w&&w.z>=b;){if(w.x>=p&&w.x<=x&&w.y>=g&&w.y<=y&&w!==r&&w!==a&&g1(o,u,l,h,c,d,w.x,w.y)&&Fr(w.prev,w,w.next)>=0)return!1;w=w.prevZ}for(;E&&E.z<=A;){if(E.x>=p&&E.x<=x&&E.y>=g&&E.y<=y&&E!==r&&E!==a&&g1(o,u,l,h,c,d,E.x,E.y)&&Fr(E.prev,E,E.next)>=0)return!1;E=E.nextZ}return!0}function NMe(e,t,i){let n=e;do{let r=n.prev,s=n.next.next;!XR(r,s)&&dZ(r,n,n.next,s)&&vw(r,s)&&vw(s,r)&&(t.push(r.i/i|0),t.push(n.i/i|0),t.push(s.i/i|0),yw(n),yw(n.next),n=e=s),n=n.next}while(n!==e);return U0(n)}function zMe(e,t,i,n,r,s){let a=e;do{let o=a.next.next;for(;o!==a.prev;){if(a.i!==o.i&&qMe(a,o)){let l=fZ(a,o);a=U0(a,a.next),l=U0(l,l.next),gw(a,t,i,n,r,s,0),gw(l,t,i,n,r,s,0);return}o=o.next}a=a.next}while(a!==e)}function FMe(e,t,i,n){let r=[],s,a,o,l,c;for(s=0,a=t.length;s<a;s++)o=t[s]*n,l=s<a-1?t[s+1]*n:e.length,c=hZ(e,o,l,n,!1),c===c.next&&(c.steiner=!0),r.push(XMe(c));for(r.sort(VMe),s=0;s<r.length;s++)i=HMe(r[s],i);return i}function VMe(e,t){return e.x-t.x}function HMe(e,t){let i=GMe(e,t);if(!i)return t;let n=fZ(i,e);return U0(n,n.next),U0(i,i.next)}function GMe(e,t){let i=t,n=-1/0,r,s=e.x,a=e.y;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){let d=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(d<=s&&d>n&&(n=d,r=i.x<i.next.x?i:i.next,d===s))return r}i=i.next}while(i!==t);if(!r)return null;let o=r,l=r.x,c=r.y,u=1/0,h;i=r;do s>=i.x&&i.x>=l&&s!==i.x&&g1(a<c?s:n,a,l,c,a<c?n:s,a,i.x,i.y)&&(h=Math.abs(a-i.y)/(s-i.x),vw(i,e)&&(h<u||h===u&&(i.x>r.x||i.x===r.x&&kMe(r,i)))&&(r=i,u=h)),i=i.next;while(i!==o);return r}function kMe(e,t){return Fr(e.prev,e,t.prev)<0&&Fr(t.next,e,e.next)<0}function jMe(e,t,i,n){let r=e;do r.z===0&&(r.z=qU(r.x,r.y,t,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,WMe(r)}function WMe(e){let t,i,n,r,s,a,o,l,c=1;do{for(i=e,e=null,s=null,a=0;i;){for(a++,n=i,o=0,t=0;t<c&&(o++,n=n.nextZ,!!n);t++);for(l=c;o>0||l>0&&n;)o!==0&&(l===0||!n||i.z<=n.z)?(r=i,i=i.nextZ,o--):(r=n,n=n.nextZ,l--),s?s.nextZ=r:e=r,r.prevZ=s,s=r;i=n}s.nextZ=null,c*=2}while(a>1);return e}function qU(e,t,i,n,r){return e=(e-i)*r|0,t=(t-n)*r|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function XMe(e){let t=e,i=e;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==e);return i}function g1(e,t,i,n,r,s,a,o){return(r-a)*(t-o)>=(e-a)*(s-o)&&(e-a)*(n-o)>=(i-a)*(t-o)&&(i-a)*(s-o)>=(r-a)*(n-o)}function qMe(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!YMe(e,t)&&(vw(e,t)&&vw(t,e)&&QMe(e,t)&&(Fr(e.prev,e,t.prev)||Fr(e,t.prev,t))||XR(e,t)&&Fr(e.prev,e,e.next)>0&&Fr(t.prev,t,t.next)>0)}function Fr(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function XR(e,t){return e.x===t.x&&e.y===t.y}function dZ(e,t,i,n){let r=bT(Fr(e,t,i)),s=bT(Fr(e,t,n)),a=bT(Fr(i,n,e)),o=bT(Fr(i,n,t));return!!(r!==s&&a!==o||r===0&&xT(e,i,t)||s===0&&xT(e,n,t)||a===0&&xT(i,e,n)||o===0&&xT(i,t,n))}function xT(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function bT(e){return e>0?1:e<0?-1:0}function YMe(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&dZ(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}function vw(e,t){return Fr(e.prev,e,e.next)<0?Fr(e,t,e.next)>=0&&Fr(e,e.prev,t)>=0:Fr(e,t,e.prev)<0||Fr(e,e.next,t)<0}function QMe(e,t){let i=e,n=!1,r=(e.x+t.x)/2,s=(e.y+t.y)/2;do i.y>s!=i.next.y>s&&i.next.y!==i.y&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next;while(i!==e);return n}function fZ(e,t){let i=new YU(e.i,e.x,e.y),n=new YU(t.i,t.x,t.y),r=e.next,s=t.prev;return e.next=t,t.prev=e,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}function cj(e,t,i,n){let r=new YU(e,t,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function yw(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function YU(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function KMe(e,t,i,n){let r=0;for(let s=t,a=i-n;s<i;s+=n)r+=(e[a]-e[s])*(e[s+1]+e[a+1]),a=s;return r}var pZ=class{static area(e){let t=e.length,i=0;for(let n=t-1,r=0;r<t;n=r++)i+=e[n].x*e[r].y-e[r].x*e[n].y;return i*.5}static isClockWise(e){return pZ.area(e)<0}static triangulateShape(e,t){let i=[],n=[],r=[];uj(e),hj(i,e);let s=e.length;t.forEach(uj);for(let o=0;o<t.length;o++)n.push(s),s+=t[o].length,hj(i,t[o]);let a=IMe.triangulate(i,n);for(let o=0;o<a.length;o+=3)r.push(a.slice(o,o+3));return r}};function uj(e){let t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function hj(e,t){for(let i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}var mZ=class extends V4{constructor(e=1,t=0){let i=(1+Math.sqrt(5))/2,n=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],r=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(n,r,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new mZ(e.radius,e.detail)}},E1=class extends ii{constructor(e=1,t=32,i=16,n=0,r=Math.PI*2,s=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:n,phiLength:r,thetaStart:s,thetaLength:a},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));let o=Math.min(s+a,Math.PI),l=0,c=[],u=new G,h=new G,d=[],p=[],g=[],x=[];for(let y=0;y<=i;y++){let b=[],A=y/i,w=0;y==0&&s==0?w=.5/t:y==i&&o==Math.PI&&(w=-.5/t);for(let E=0;E<=t;E++){let D=E/t;u.x=-e*Math.cos(n+D*r)*Math.sin(s+A*a),u.y=e*Math.cos(s+A*a),u.z=e*Math.sin(n+D*r)*Math.sin(s+A*a),p.push(u.x,u.y,u.z),h.copy(u).normalize(),g.push(h.x,h.y,h.z),x.push(D+w,1-A),b.push(l++)}c.push(b)}for(let y=0;y<i;y++)for(let b=0;b<t;b++){let A=c[y][b+1],w=c[y][b],E=c[y+1][b],D=c[y+1][b+1];(y!==0||s>0)&&d.push(A,w,D),(y!==i-1||o<Math.PI)&&d.push(w,E,D)}this.setIndex(d),this.setAttribute("position",new Gt(p,3)),this.setAttribute("normal",new Gt(g,3)),this.setAttribute("uv",new Gt(x,2))}static fromJSON(e){return new E1(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}},gZ=class extends ii{constructor(e=1,t=.4,i=12,n=48,r=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:n,arc:r},i=Math.floor(i),n=Math.floor(n);let s=[],a=[],o=[],l=[],c=new G,u=new G,h=new G;for(let d=0;d<=i;d++)for(let p=0;p<=n;p++){let g=p/n*r,x=d/i*Math.PI*2;u.x=(e+t*Math.cos(x))*Math.cos(g),u.y=(e+t*Math.cos(x))*Math.sin(g),u.z=t*Math.sin(x),a.push(u.x,u.y,u.z),c.x=e*Math.cos(g),c.y=e*Math.sin(g),h.subVectors(u,c).normalize(),o.push(h.x,h.y,h.z),l.push(p/n),l.push(d/i)}for(let d=1;d<=i;d++)for(let p=1;p<=n;p++){let g=(n+1)*d+p-1,x=(n+1)*(d-1)+p-1,y=(n+1)*(d-1)+p,b=(n+1)*d+p;s.push(g,x,b),s.push(x,y,b)}this.setIndex(s),this.setAttribute("position",new Gt(a,3)),this.setAttribute("normal",new Gt(o,3)),this.setAttribute("uv",new Gt(l,2))}static fromJSON(e){return new gZ(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}},vZ=class extends ii{constructor(e=1,t=.4,i=64,n=8,r=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:n,p:r,q:s},i=Math.floor(i),n=Math.floor(n);let a=[],o=[],l=[],c=[],u=new G,h=new G,d=new G,p=new G,g=new G,x=new G,y=new G;for(let A=0;A<=i;++A){let w=A/i*r*Math.PI*2;b(w,r,s,e,d),b(w+.01,r,s,e,p),x.subVectors(p,d),y.addVectors(p,d),g.crossVectors(x,y),y.crossVectors(g,x),g.normalize(),y.normalize();for(let E=0;E<=n;++E){let D=E/n*Math.PI*2,T=-t*Math.cos(D),I=t*Math.sin(D);u.x=d.x+(T*y.x+I*g.x),u.y=d.y+(T*y.y+I*g.y),u.z=d.z+(T*y.z+I*g.z),o.push(u.x,u.y,u.z),h.subVectors(u,d).normalize(),l.push(h.x,h.y,h.z),c.push(A/i),c.push(E/n)}}for(let A=1;A<=i;A++)for(let w=1;w<=n;w++){let E=(n+1)*(A-1)+(w-1),D=(n+1)*A+(w-1),T=(n+1)*A+w,I=(n+1)*(A-1)+w;a.push(E,D,I),a.push(D,T,I)}this.setIndex(a),this.setAttribute("position",new Gt(o,3)),this.setAttribute("normal",new Gt(l,3)),this.setAttribute("uv",new Gt(c,2));function b(A,w,E,D,T){let I=Math.cos(A),R=Math.sin(A),O=E/w*A,P=Math.cos(O);T.x=D*(2+P)*.5*I,T.y=D*(2+P)*R*.5,T.z=D*Math.sin(O)*.5}}static fromJSON(e){return new vZ(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}},JMe=class extends vn{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}};function pm(e,t,i){return yZ(e)?new e.constructor(e.subarray(t,i!==void 0?i:e.length)):e.slice(t,i)}function ST(e,t,i){return!e||e.constructor===t?e:typeof t.BYTES_PER_ELEMENT=="number"?new t(e):Array.prototype.slice.call(e)}function yZ(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function ZMe(e){function t(r,s){return e[r]-e[s]}let i=e.length,n=new Array(i);for(let r=0;r!==i;++r)n[r]=r;return n.sort(t),n}function dj(e,t,i){let n=e.length,r=new e.constructor(n);for(let s=0,a=0;a!==n;++s){let o=i[s]*t;for(let l=0;l!==t;++l)r[a++]=e[o+l]}return r}function xZ(e,t,i,n){let r=1,s=e[0];for(;s!==void 0&&s[n]===void 0;)s=e[r++];if(s===void 0)return;let a=s[n];if(a!==void 0)if(Array.isArray(a))do a=s[n],a!==void 0&&(t.push(s.time),i.push.apply(i,a)),s=e[r++];while(s!==void 0);else if(a.toArray!==void 0)do a=s[n],a!==void 0&&(t.push(s.time),a.toArray(i,i.length)),s=e[r++];while(s!==void 0);else do a=s[n],a!==void 0&&(t.push(s.time),i.push(a)),s=e[r++];while(s!==void 0)}var qR=class{constructor(e,t,i,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=n!==void 0?n:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){let t=this.parameterPositions,i=this._cachedIndex,n=t[i],r=t[i-1];e:{t:{let s;i:{n:if(!(e<n)){for(let a=i+2;;){if(n===void 0){if(e<r)break n;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(r=n,n=t[++i],e<n)break t}s=t.length;break i}if(!(e>=r)){let a=t[1];e<a&&(i=2,r=a);for(let o=i-2;;){if(r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===o)break;if(n=r,r=t[--i-1],e>=r)break t}s=i,i=0;break i}break e}for(;i<s;){let a=i+s>>>1;e<t[a]?s=a:i=a+1}if(n=t[i],r=t[i-1],r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===void 0)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,r,n)}return this.interpolate_(i,r,e,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){let t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=e*n;for(let s=0;s!==n;++s)t[s]=i[r+s];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}},$Me=class extends qR{constructor(e,t,i,n){super(e,t,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:f1,endingEnd:f1}}intervalChanged_(e,t,i){let n=this.parameterPositions,r=e-2,s=e+1,a=n[r],o=n[s];if(a===void 0)switch(this.getSettings_().endingStart){case p1:r=e,a=2*t-i;break;case ZD:r=n.length-2,a=t+n[r]-n[r+1];break;default:r=e,a=i}if(o===void 0)switch(this.getSettings_().endingEnd){case p1:s=e,o=2*i-t;break;case ZD:s=1,o=i+n[1]-n[0];break;default:s=e-1,o=t}let l=(i-t)*.5,c=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(o-i),this._offsetPrev=r*c,this._offsetNext=s*c}interpolate_(e,t,i,n){let r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(i-t)/(n-t),g=p*p,x=g*p,y=-h*x+2*h*g-h*p,b=(1+h)*x+(-1.5-2*h)*g+(-.5+h)*p+1,A=(-1-d)*x+(1.5+d)*g+.5*p,w=d*x-d*g;for(let E=0;E!==a;++E)r[E]=y*s[c+E]+b*s[l+E]+A*s[o+E]+w*s[u+E];return r}},bZ=class extends qR{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e,t,i,n){let r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,c=(i-t)/(n-t),u=1-c;for(let h=0;h!==a;++h)r[h]=s[l+h]*u+s[o+h]*c;return r}},eEe=class extends qR{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e){return this.copySampleValue_(e-1)}},Rd=class{constructor(e,t,i,n){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=ST(t,this.TimeBufferType),this.values=ST(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(e){let t=e.constructor,i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:ST(e.times,Array),values:ST(e.values,Array)};let n=e.getInterpolation();n!==e.DefaultInterpolation&&(i.interpolation=n)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new eEe(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new bZ(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new $Me(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case KD:t=this.InterpolantFactoryMethodDiscrete;break;case JD:t=this.InterpolantFactoryMethodLinear;break;case FB:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){let i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return KD;case this.InterpolantFactoryMethodLinear:return JD;case this.InterpolantFactoryMethodSmooth:return FB}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){let t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]+=e}return this}scale(e){if(e!==1){let t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]*=e}return this}trim(e,t){let i=this.times,n=i.length,r=0,s=n-1;for(;r!==n&&i[r]<e;)++r;for(;s!==-1&&i[s]>t;)--s;if(++s,r!==0||s!==n){r>=s&&(s=Math.max(s,1),r=s-1);let a=this.getValueSize();this.times=pm(i,r,s),this.values=pm(this.values,r*a,s*a)}return this}validate(){let e=!0,t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);let i=this.times,n=this.values,r=i.length;r===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let s=null;for(let a=0;a!==r;a++){let o=i[a];if(typeof o=="number"&&isNaN(o)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,o),e=!1;break}if(s!==null&&s>o){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,o,s),e=!1;break}s=o}if(n!==void 0&&yZ(n))for(let a=0,o=n.length;a!==o;++a){let l=n[a];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,l),e=!1;break}}return e}optimize(){let e=pm(this.times),t=pm(this.values),i=this.getValueSize(),n=this.getInterpolation()===FB,r=e.length-1,s=1;for(let a=1;a<r;++a){let o=!1,l=e[a],c=e[a+1];if(l!==c&&(a!==1||l!==e[0]))if(n)o=!0;else{let u=a*i,h=u-i,d=u+i;for(let p=0;p!==i;++p){let g=t[u+p];if(g!==t[h+p]||g!==t[d+p]){o=!0;break}}}if(o){if(a!==s){e[s]=e[a];let u=a*i,h=s*i;for(let d=0;d!==i;++d)t[h+d]=t[u+d]}++s}}if(r>0){e[s]=e[r];for(let a=r*i,o=s*i,l=0;l!==i;++l)t[o+l]=t[a+l];++s}return s!==e.length?(this.times=pm(e,0,s),this.values=pm(t,0,s*i)):(this.times=e,this.values=t),this}clone(){let e=pm(this.times,0),t=pm(this.values,0),i=this.constructor,n=new i(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}};Rd.prototype.TimeBufferType=Float32Array;Rd.prototype.ValueBufferType=Float32Array;Rd.prototype.DefaultInterpolation=JD;var Pb=class extends Rd{};Pb.prototype.ValueTypeName="bool";Pb.prototype.ValueBufferType=Array;Pb.prototype.DefaultInterpolation=KD;Pb.prototype.InterpolantFactoryMethodLinear=void 0;Pb.prototype.InterpolantFactoryMethodSmooth=void 0;var SZ=class extends Rd{};SZ.prototype.ValueTypeName="color";var r3=class extends Rd{};r3.prototype.ValueTypeName="number";var tEe=class extends qR{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e,t,i,n){let r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=(i-t)/(n-t),l=e*a;for(let c=l+a;l!==c;l+=4)Ei.slerpFlat(r,0,s,l-a,s,l,o);return r}},oM=class extends Rd{InterpolantFactoryMethodLinear(e){return new tEe(this.times,this.values,this.getValueSize(),e)}};oM.prototype.ValueTypeName="quaternion";oM.prototype.DefaultInterpolation=JD;oM.prototype.InterpolantFactoryMethodSmooth=void 0;var Ob=class extends Rd{};Ob.prototype.ValueTypeName="string";Ob.prototype.ValueBufferType=Array;Ob.prototype.DefaultInterpolation=KD;Ob.prototype.InterpolantFactoryMethodLinear=void 0;Ob.prototype.InterpolantFactoryMethodSmooth=void 0;var s3=class extends Rd{};s3.prototype.ValueTypeName="vector";var QU=class{constructor(e,t=-1,i,n=D4){this.name=e,this.tracks=i,this.duration=t,this.blendMode=n,this.uuid=qc(),this.duration<0&&this.resetDuration()}static parse(e){let t=[],i=e.tracks,n=1/(e.fps||1);for(let s=0,a=i.length;s!==a;++s)t.push(nEe(i[s]).scale(n));let r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){let t=[],i=e.tracks,n={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let r=0,s=i.length;r!==s;++r)t.push(Rd.toJSON(i[r]));return n}static CreateFromMorphTargetSequence(e,t,i,n){let r=t.length,s=[];for(let a=0;a<r;a++){let o=[],l=[];o.push((a+r-1)%r,a,(a+1)%r),l.push(0,1,0);let c=ZMe(o);o=dj(o,1,c),l=dj(l,1,c),!n&&o[0]===0&&(o.push(r),l.push(l[0])),s.push(new r3(".morphTargetInfluences["+t[a].name+"]",o,l).scale(1/i))}return new this(e,-1,s)}static findByName(e,t){let i=e;if(!Array.isArray(e)){let n=e;i=n.geometry&&n.geometry.animations||n.animations}for(let n=0;n<i.length;n++)if(i[n].name===t)return i[n];return null}static CreateClipsFromMorphTargetSequences(e,t,i){let n={},r=/^([\w-]*?)([\d]+)$/;for(let a=0,o=e.length;a<o;a++){let l=e[a],c=l.name.match(r);if(c&&c.length>1){let u=c[1],h=n[u];h||(n[u]=h=[]),h.push(l)}}let s=[];for(let a in n)s.push(this.CreateFromMorphTargetSequence(a,n[a],t,i));return s}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let i=function(c,u,h,d,p){if(h.length!==0){let g=[],x=[];xZ(h,g,x,d),g.length!==0&&p.push(new c(u,g,x))}},n=[],r=e.name||"default",s=e.fps||30,a=e.blendMode,o=e.length||-1,l=e.hierarchy||[];for(let c=0;c<l.length;c++){let u=l[c].keys;if(!(!u||u.length===0))if(u[0].morphTargets){let h={},d;for(d=0;d<u.length;d++)if(u[d].morphTargets)for(let p=0;p<u[d].morphTargets.length;p++)h[u[d].morphTargets[p]]=-1;for(let p in h){let g=[],x=[];for(let y=0;y!==u[d].morphTargets.length;++y){let b=u[d];g.push(b.time),x.push(b.morphTarget===p?1:0)}n.push(new r3(".morphTargetInfluence["+p+"]",g,x))}o=h.length*s}else{let h=".bones["+t[c].name+"]";i(s3,h+".position",u,"pos",n),i(oM,h+".quaternion",u,"rot",n),i(s3,h+".scale",u,"scl",n)}}return n.length===0?null:new this(r,o,n,a)}resetDuration(){let e=this.tracks,t=0;for(let i=0,n=e.length;i!==n;++i){let r=this.tracks[i];t=Math.max(t,r.times[r.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){let e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}};function iEe(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return r3;case"vector":case"vector2":case"vector3":case"vector4":return s3;case"color":return SZ;case"quaternion":return oM;case"bool":case"boolean":return Pb;case"string":return Ob}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}function nEe(e){if(e.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");let t=iEe(e.type);if(e.times===void 0){let i=[],n=[];xZ(e.keys,i,n,"value"),e.times=i,e.values=n}return t.parse!==void 0?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}var a3={enabled:!1,files:{},add:function(e,t){this.enabled!==!1&&(this.files[e]=t)},get:function(e){if(this.enabled!==!1)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},_Z=class{constructor(e,t,i){let n=this,r=!1,s=0,a=0,o,l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(c){a++,r===!1&&n.onStart!==void 0&&n.onStart(c,s,a),r=!0},this.itemEnd=function(c){s++,n.onProgress!==void 0&&n.onProgress(c,s,a),s===a&&(r=!1,n.onLoad!==void 0&&n.onLoad())},this.itemError=function(c){n.onError!==void 0&&n.onError(c)},this.resolveURL=function(c){return o?o(c):c},this.setURLModifier=function(c){return o=c,this},this.addHandler=function(c,u){return l.push(c,u),this},this.removeHandler=function(c){let u=l.indexOf(c);return u!==-1&&l.splice(u,2),this},this.getHandler=function(c){for(let u=0,h=l.length;u<h;u+=2){let d=l[u],p=l[u+1];if(d.global&&(d.lastIndex=0),d.test(c))return p}return null}}},rEe=new _Z,lM=class{constructor(e){this.manager=e!==void 0?e:rEe,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){let i=this;return new Promise(function(n,r){i.load(e,n,t,r)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}},pf={},sEe=class extends Error{constructor(e,t){super(e),this.response=t}},KU=class extends lM{constructor(e){super(e)}load(e,t,i,n){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let r=a3.get(e);if(r!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(r),this.manager.itemEnd(e)},0),r;if(pf[e]!==void 0){pf[e].push({onLoad:t,onProgress:i,onError:n});return}pf[e]=[],pf[e].push({onLoad:t,onProgress:i,onError:n});let s=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,o=this.responseType;fetch(s).then(l=>{if(l.status===200||l.status===0){if(l.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||l.body===void 0||l.body.getReader===void 0)return l;let c=pf[e],u=l.body.getReader(),h=l.headers.get("Content-Length")||l.headers.get("X-File-Size"),d=h?parseInt(h):0,p=d!==0,g=0,x=new ReadableStream({start(y){b();function b(){u.read().then(({done:A,value:w})=>{if(A)y.close();else{g+=w.byteLength;let E=new ProgressEvent("progress",{lengthComputable:p,loaded:g,total:d});for(let D=0,T=c.length;D<T;D++){let I=c[D];I.onProgress&&I.onProgress(E)}y.enqueue(w),b()}})}}});return new Response(x)}else throw new sEe(`fetch for "${l.url}" responded with ${l.status}: ${l.statusText}`,l)}).then(l=>{switch(o){case"arraybuffer":return l.arrayBuffer();case"blob":return l.blob();case"document":return l.text().then(c=>new DOMParser().parseFromString(c,a));case"json":return l.json();default:if(a===void 0)return l.text();{let c=/charset="?([^;"\s]*)"?/i.exec(a),u=c&&c[1]?c[1].toLowerCase():void 0,h=new TextDecoder(u);return l.arrayBuffer().then(d=>h.decode(d))}}}).then(l=>{a3.add(e,l);let c=pf[e];delete pf[e];for(let u=0,h=c.length;u<h;u++){let d=c[u];d.onLoad&&d.onLoad(l)}}).catch(l=>{let c=pf[e];if(c===void 0)throw this.manager.itemError(e),l;delete pf[e];for(let u=0,h=c.length;u<h;u++){let d=c[u];d.onError&&d.onError(l)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}},aEe=class extends lM{constructor(e){super(e)}load(e,t,i,n){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let r=this,s=a3.get(e);if(s!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(s),r.manager.itemEnd(e)},0),s;let a=pw("img");function o(){c(),a3.add(e,this),t&&t(this),r.manager.itemEnd(e)}function l(u){c(),n&&n(u),r.manager.itemError(e),r.manager.itemEnd(e)}function c(){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",o,!1),a.addEventListener("error",l,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(e),a.src=e,a}},oEe=class extends lM{constructor(e){super(e)}load(e,t,i,n){let r=new Hr,s=new aEe(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(e,function(a){r.image=a,r.needsUpdate=!0,t!==void 0&&t(r)},i,n),r}},cM=class extends kn{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new gi(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){let t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}},lEe=class extends cM{constructor(e,t,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(kn.DEFAULT_UP),this.updateMatrix(),this.groundColor=new gi(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}},mI=new Bt,fj=new G,pj=new G,H4=class{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Ae(512,512),this.map=null,this.mapPass=null,this.matrix=new Bt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new B4,this._frameExtents=new Ae(1,1),this._viewportCount=1,this._viewports=[new Di(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){let t=this.camera,i=this.matrix;fj.setFromMatrixPosition(e.matrixWorld),t.position.copy(fj),pj.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(pj),t.updateMatrixWorld(),mI.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(mI),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(mI)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){let e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}},cEe=class extends H4{constructor(){super(new po(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){let t=this.camera,i=fw*2*e.angle*this.focus,n=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;(i!==t.fov||n!==t.aspect||r!==t.far)&&(t.fov=i,t.aspect=n,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}},uEe=class extends cM{constructor(e,t,i=0,n=Math.PI/3,r=0,s=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(kn.DEFAULT_UP),this.updateMatrix(),this.target=new kn,this.distance=i,this.angle=n,this.penumbra=r,this.decay=s,this.map=null,this.shadow=new cEe}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},mj=new Bt,O_=new G,gI=new G,hEe=class extends H4{constructor(){super(new po(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Ae(4,2),this._viewportCount=6,this._viewports=[new Di(2,1,1,1),new Di(0,1,1,1),new Di(3,1,1,1),new Di(1,1,1,1),new Di(3,0,1,1),new Di(1,0,1,1)],this._cubeDirections=[new G(1,0,0),new G(-1,0,0),new G(0,0,1),new G(0,0,-1),new G(0,1,0),new G(0,-1,0)],this._cubeUps=[new G(0,1,0),new G(0,1,0),new G(0,1,0),new G(0,1,0),new G(0,0,1),new G(0,0,-1)]}updateMatrices(e,t=0){let i=this.camera,n=this.matrix,r=e.distance||i.far;r!==i.far&&(i.far=r,i.updateProjectionMatrix()),O_.setFromMatrixPosition(e.matrixWorld),i.position.copy(O_),gI.copy(i.position),gI.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(gI),i.updateMatrixWorld(),n.makeTranslation(-O_.x,-O_.y,-O_.z),mj.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(mj)}},dEe=class extends cM{constructor(e,t,i=0,n=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=n,this.shadow=new hEe}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}},fEe=class extends H4{constructor(){super(new kR(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}},pEe=class extends cM{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(kn.DEFAULT_UP),this.updateMatrix(),this.target=new kn,this.shadow=new fEe}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},AZ=class extends ii{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){let e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}},wZ=class extends lM{constructor(e){super(e)}load(e,t,i,n){let r=this,s=new KU(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(e,function(a){try{t(r.parse(JSON.parse(a)))}catch(o){n?n(o):console.error(o),r.manager.itemError(e)}},i,n)}parse(e){let t={},i={};function n(h,d){if(t[d]!==void 0)return t[d];let p=h.interleavedBuffers[d],g=r(h,p.buffer),x=J2(p.type,g),y=new vMe(x,p.stride);return y.uuid=p.uuid,t[d]=y,y}function r(h,d){if(i[d]!==void 0)return i[d];let p=h.arrayBuffers[d],g=new Uint32Array(p).buffer;return i[d]=g,g}let s=e.isInstancedBufferGeometry?new AZ:new ii,a=e.data.index;if(a!==void 0){let h=J2(a.type,a.array);s.setIndex(new vi(h,1))}let o=e.data.attributes;for(let h in o){let d=o[h],p;if(d.isInterleavedBufferAttribute){let g=n(e.data,d.data);p=new XU(g,d.itemSize,d.offset,d.normalized)}else{let g=J2(d.type,d.array),x=d.isInstancedBufferAttribute?mw:vi;p=new x(g,d.itemSize,d.normalized)}d.name!==void 0&&(p.name=d.name),d.usage!==void 0&&p.setUsage(d.usage),d.updateRange!==void 0&&(p.updateRange.offset=d.updateRange.offset,p.updateRange.count=d.updateRange.count),s.setAttribute(h,p)}let l=e.data.morphAttributes;if(l)for(let h in l){let d=l[h],p=[];for(let g=0,x=d.length;g<x;g++){let y=d[g],b;if(y.isInterleavedBufferAttribute){let A=n(e.data,y.data);b=new XU(A,y.itemSize,y.offset,y.normalized)}else{let A=J2(y.type,y.array);b=new vi(A,y.itemSize,y.normalized)}y.name!==void 0&&(b.name=y.name),p.push(b)}s.morphAttributes[h]=p}e.data.morphTargetsRelative&&(s.morphTargetsRelative=!0);let c=e.data.groups||e.data.drawcalls||e.data.offsets;if(c!==void 0)for(let h=0,d=c.length;h!==d;++h){let p=c[h];s.addGroup(p.start,p.count,p.materialIndex)}let u=e.data.boundingSphere;if(u!==void 0){let h=new G;u.center!==void 0&&h.fromArray(u.center),s.boundingSphere=new Ol(h,u.radius)}return e.name&&(s.name=e.name),e.userData&&(s.userData=e.userData),s}},mEe=class{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=gj(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let t=gj();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}};function gj(){return(typeof performance>"u"?Date:performance).now()}var gEe=class{constructor(e,t,i){this.binding=e,this.valueSize=i;let n,r,s;switch(t){case"quaternion":n=this._slerp,r=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":n=this._select,r=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:n=this._lerp,r=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=r,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){let i=this.buffer,n=this.valueSize,r=e*n+n,s=this.cumulativeWeight;if(s===0){for(let a=0;a!==n;++a)i[r+a]=i[a];s=t}else{s+=t;let a=t/s;this._mixBufferRegion(i,r,0,a,n)}this.cumulativeWeight=s}accumulateAdditive(e){let t=this.buffer,i=this.valueSize,n=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,n,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){let t=this.valueSize,i=this.buffer,n=e*t+t,r=this.cumulativeWeight,s=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){let o=t*this._origIndex;this._mixBufferRegion(i,n,o,1-r,t)}s>0&&this._mixBufferRegionAdditive(i,n,this._addIndex*t,1,t);for(let o=t,l=t+t;o!==l;++o)if(i[o]!==i[o+t]){a.setValue(i,n);break}}saveOriginalState(){let e=this.binding,t=this.buffer,i=this.valueSize,n=i*this._origIndex;e.getValue(t,n);for(let r=i,s=n;r!==s;++r)t[r]=t[n+r%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){let e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){let e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){let e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,n,r){if(n>=.5)for(let s=0;s!==r;++s)e[t+s]=e[i+s]}_slerp(e,t,i,n){Ei.slerpFlat(e,t,e,t,e,i,n)}_slerpAdditive(e,t,i,n,r){let s=this._workIndex*r;Ei.multiplyQuaternionsFlat(e,s,e,t,e,i),Ei.slerpFlat(e,t,e,t,e,s,n)}_lerp(e,t,i,n,r){let s=1-n;for(let a=0;a!==r;++a){let o=t+a;e[o]=e[o]*s+e[i+a]*n}}_lerpAdditive(e,t,i,n,r){for(let s=0;s!==r;++s){let a=t+s;e[a]=e[a]+e[i+s]*n}}},G4="\\[\\]\\.:\\/",vEe=new RegExp("["+G4+"]","g"),k4="[^"+G4+"]",yEe="[^"+G4.replace("\\.","")+"]",xEe=/((?:WC+[\/:])*)/.source.replace("WC",k4),bEe=/(WCOD+)?/.source.replace("WCOD",yEe),SEe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",k4),_Ee=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",k4),AEe=new RegExp("^"+xEe+bEe+SEe+_Ee+"$"),wEe=["material","materials","bones","map"],MEe=class{constructor(e,t,i){let n=i||or.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,n)}getValue(e,t){this.bind();let i=this._targetGroup.nCachedObjects_,n=this._bindings[i];n!==void 0&&n.getValue(e,t)}setValue(e,t){let i=this._bindings;for(let n=this._targetGroup.nCachedObjects_,r=i.length;n!==r;++n)i[n].setValue(e,t)}bind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}},or=class{constructor(e,t,i){this.path=t,this.parsedPath=i||or.parseTrackName(t),this.node=or.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new or.Composite(e,t,i):new or(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(vEe,"")}static parseTrackName(e){let t=AEe.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);let i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(n!==void 0&&n!==-1){let r=i.nodeName.substring(n+1);wEe.indexOf(r)!==-1&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=r)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){let i=e.skeleton.getBoneByName(t);if(i!==void 0)return i}if(e.children){let i=function(r){for(let s=0;s<r.length;s++){let a=r[s];if(a.name===t||a.uuid===t)return a;let o=i(a.children);if(o)return o}return null},n=i(e.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){let i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)e[t++]=i[n]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){let i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++]}_setValue_array_setNeedsUpdate(e,t){let i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){let i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node,t=this.parsedPath,i=t.objectName,n=t.propertyName,r=t.propertyIndex;if(e||(e=or.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(i){let l=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let c=0;c<e.length;c++)if(e[c].name===l){l=c;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(l!==void 0){if(e[l]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[l]}}let s=e[n];if(s===void 0){let l=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+l+"."+n+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(r!==void 0){if(n==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[r]!==void 0&&(r=e.morphTargetDictionary[r])}o=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else s.fromArray!==void 0&&s.toArray!==void 0?(o=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(o=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=n;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};or.Composite=MEe;or.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};or.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};or.prototype.GetterByBindingType=[or.prototype._getValue_direct,or.prototype._getValue_array,or.prototype._getValue_arrayElement,or.prototype._getValue_toArray];or.prototype.SetterByBindingTypeAndVersioning=[[or.prototype._setValue_direct,or.prototype._setValue_direct_setNeedsUpdate,or.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[or.prototype._setValue_array,or.prototype._setValue_array_setNeedsUpdate,or.prototype._setValue_array_setMatrixWorldNeedsUpdate],[or.prototype._setValue_arrayElement,or.prototype._setValue_arrayElement_setNeedsUpdate,or.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[or.prototype._setValue_fromArray,or.prototype._setValue_fromArray_setNeedsUpdate,or.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var EEe=class{constructor(e,t,i=null,n=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=n;let r=t.tracks,s=r.length,a=new Array(s),o={endingStart:f1,endingEnd:f1};for(let l=0;l!==s;++l){let c=r[l].createInterpolant(null);a[l]=c,c.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=HJ,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){let n=this._clip.duration,r=e._clip.duration,s=r/n,a=n/r;e.warp(1,s,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){let e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){let n=this._mixer,r=n.time,s=this.timeScale,a=this._timeScaleInterpolant;a===null&&(a=n._lendControlInterpolant(),this._timeScaleInterpolant=a);let o=a.parameterPositions,l=a.sampleValues;return o[0]=r,o[1]=r+i,l[0]=e/s,l[1]=t/s,this}stopWarping(){let e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,n){if(!this.enabled){this._updateWeight(e);return}let r=this._startTime;if(r!==null){let o=(e-r)*i;o<0||i===0?t=0:(this._startTime=null,t=i*o)}t*=this._updateTimeScale(e);let s=this._updateTime(t),a=this._updateWeight(e);if(a>0){let o=this._interpolants,l=this._propertyBindings;switch(this.blendMode){case tbe:for(let c=0,u=o.length;c!==u;++c)o[c].evaluate(s),l[c].accumulateAdditive(a);break;case D4:default:for(let c=0,u=o.length;c!==u;++c)o[c].evaluate(s),l[c].accumulate(n,a)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;let i=this._weightInterpolant;if(i!==null){let n=i.evaluate(e)[0];t*=n,e>i.parameterPositions[1]&&(this.stopFading(),n===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;let i=this._timeScaleInterpolant;if(i!==null){let n=i.evaluate(e)[0];t*=n,e>i.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){let t=this._clip.duration,i=this.loop,n=this.time+e,r=this._loopCount,s=i===C4;if(e===0)return r===-1?n:s&&(r&1)===1?t-n:n;if(i===VJ){r===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(n>=t)n=t;else if(n<0)n=0;else{this.time=n;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(r===-1&&(e>=0?(r=0,this._setEndings(!0,this.repetitions===0,s)):this._setEndings(this.repetitions===0,!0,s)),n>=t||n<0){let a=Math.floor(n/t);n-=t*a,r+=Math.abs(a);let o=this.repetitions-r;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=e>0?t:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(o===1){let l=e<0;this._setEndings(l,!l,s)}else this._setEndings(!1,!1,s);this._loopCount=r,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=n;if(s&&(r&1)===1)return t-n}return n}_setEndings(e,t,i){let n=this._interpolantSettings;i?(n.endingStart=p1,n.endingEnd=p1):(e?n.endingStart=this.zeroSlopeAtStart?p1:f1:n.endingStart=ZD,t?n.endingEnd=this.zeroSlopeAtEnd?p1:f1:n.endingEnd=ZD)}_scheduleFading(e,t,i){let n=this._mixer,r=n.time,s=this._weightInterpolant;s===null&&(s=n._lendControlInterpolant(),this._weightInterpolant=s);let a=s.parameterPositions,o=s.sampleValues;return a[0]=r,o[0]=t,a[1]=r+e,o[1]=i,this}},TEe=new Float32Array(1),CEe=class extends Ka{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){let i=e._localRoot||this._root,n=e._clip.tracks,r=n.length,s=e._propertyBindings,a=e._interpolants,o=i.uuid,l=this._bindingsByRootAndName,c=l[o];c===void 0&&(c={},l[o]=c);for(let u=0;u!==r;++u){let h=n[u],d=h.name,p=c[d];if(p!==void 0)++p.referenceCount,s[u]=p;else{if(p=s[u],p!==void 0){p._cacheIndex===null&&(++p.referenceCount,this._addInactiveBinding(p,o,d));continue}let g=t&&t._propertyBindings[u].binding.parsedPath;p=new gEe(or.create(i,d,g),h.ValueTypeName,h.getValueSize()),++p.referenceCount,this._addInactiveBinding(p,o,d),s[u]=p}a[u].resultBuffer=p.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){let i=(e._localRoot||this._root).uuid,n=e._clip.uuid,r=this._actionsByClip[n];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,n,i)}let t=e._propertyBindings;for(let i=0,n=t.length;i!==n;++i){let r=t[i];r.useCount++===0&&(this._lendBinding(r),r.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){let t=e._propertyBindings;for(let i=0,n=t.length;i!==n;++i){let r=t[i];--r.useCount===0&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;let e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){let t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,i){let n=this._actions,r=this._actionsByClip,s=r[t];if(s===void 0)s={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=s;else{let a=s.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=n.length,n.push(e),s.actionByRoot[i]=e}_removeInactiveAction(e){let t=this._actions,i=t[t.length-1],n=e._cacheIndex;i._cacheIndex=n,t[n]=i,t.pop(),e._cacheIndex=null;let r=e._clip.uuid,s=this._actionsByClip,a=s[r],o=a.knownActions,l=o[o.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,o[c]=l,o.pop(),e._byClipCacheIndex=null;let u=a.actionByRoot,h=(e._localRoot||this._root).uuid;delete u[h],o.length===0&&delete s[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){let t=e._propertyBindings;for(let i=0,n=t.length;i!==n;++i){let r=t[i];--r.referenceCount===0&&this._removeInactiveBinding(r)}}_lendAction(e){let t=this._actions,i=e._cacheIndex,n=this._nActiveActions++,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_takeBackAction(e){let t=this._actions,i=e._cacheIndex,n=--this._nActiveActions,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_addInactiveBinding(e,t,i){let n=this._bindingsByRootAndName,r=this._bindings,s=n[t];s===void 0&&(s={},n[t]=s),s[i]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){let t=this._bindings,i=e.binding,n=i.rootNode.uuid,r=i.path,s=this._bindingsByRootAndName,a=s[n],o=t[t.length-1],l=e._cacheIndex;o._cacheIndex=l,t[l]=o,t.pop(),delete a[r],Object.keys(a).length===0&&delete s[n]}_lendBinding(e){let t=this._bindings,i=e._cacheIndex,n=this._nActiveBindings++,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_takeBackBinding(e){let t=this._bindings,i=e._cacheIndex,n=--this._nActiveBindings,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_lendControlInterpolant(){let e=this._controlInterpolants,t=this._nActiveControlInterpolants++,i=e[t];return i===void 0&&(i=new bZ(new Float32Array(2),new Float32Array(2),1,TEe),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){let t=this._controlInterpolants,i=e.__cacheIndex,n=--this._nActiveControlInterpolants,r=t[n];e.__cacheIndex=n,t[n]=e,r.__cacheIndex=i,t[i]=r}clipAction(e,t,i){let n=t||this._root,r=n.uuid,s=typeof e=="string"?QU.findByName(n,e):e,a=s!==null?s.uuid:e,o=this._actionsByClip[a],l=null;if(i===void 0&&(s!==null?i=s.blendMode:i=D4),o!==void 0){let u=o.actionByRoot[r];if(u!==void 0&&u.blendMode===i)return u;l=o.knownActions[0],s===null&&(s=l._clip)}if(s===null)return null;let c=new EEe(this,s,t,i);return this._bindAction(c,l),this._addInactiveAction(c,a,r),c}existingAction(e,t){let i=t||this._root,n=i.uuid,r=typeof e=="string"?QU.findByName(i,e):e,s=r?r.uuid:e,a=this._actionsByClip[s];return a!==void 0&&a.actionByRoot[n]||null}stopAllAction(){let e=this._actions,t=this._nActiveActions;for(let i=t-1;i>=0;--i)e[i].stop();return this}update(e){e*=this.timeScale;let t=this._actions,i=this._nActiveActions,n=this.time+=e,r=Math.sign(e),s=this._accuIndex^=1;for(let l=0;l!==i;++l)t[l]._update(n,e,r,s);let a=this._bindings,o=this._nActiveBindings;for(let l=0;l!==o;++l)a[l].apply(s);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){let t=this._actions,i=e.uuid,n=this._actionsByClip,r=n[i];if(r!==void 0){let s=r.knownActions;for(let a=0,o=s.length;a!==o;++a){let l=s[a];this._deactivateAction(l);let c=l._cacheIndex,u=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,u._cacheIndex=c,t[c]=u,t.pop(),this._removeInactiveBindingsForAction(l)}delete n[i]}}uncacheRoot(e){let t=e.uuid,i=this._actionsByClip;for(let s in i){let a=i[s].actionByRoot,o=a[t];o!==void 0&&(this._deactivateAction(o),this._removeInactiveAction(o))}let n=this._bindingsByRootAndName,r=n[t];if(r!==void 0)for(let s in r){let a=r[s];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(e,t){let i=this.existingAction(e,t);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}},Ct=class{constructor(e){this.value=e}clone(){return new Ct(this.value.clone===void 0?this.value:this.value.clone())}},MZ=class{constructor(e,t,i=0,n=1/0){this.ray=new Cb(e,t),this.near=i,this.far=n,this.camera=null,this.layers=new P4,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,i=[]){return JU(e,this,i,t),i.sort(vj),i}intersectObjects(e,t=!0,i=[]){for(let n=0,r=e.length;n<r;n++)JU(e[n],this,i,t);return i.sort(vj),i}};function vj(e,t){return e.distance-t.distance}function JU(e,t,i,n){if(e.layers.test(t.layers)&&e.raycast(t,i),n===!0){let r=e.children;for(let s=0,a=r.length;s<a;s++)JU(r[s],t,i,!0)}}var yj=class{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(Es(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}},xj=new Ae,j4=class{constructor(e=new Ae(1/0,1/0),t=new Ae(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let i=xj.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return xj.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},bj=new G,_T=new G,Yc=class{constructor(e=new G,t=new G){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){bj.subVectors(e,this.start),_T.subVectors(this.end,this.start);let i=_T.dot(_T),n=_T.dot(bj)/i;return t&&(n=Es(n,0,1)),n}closestPointToPoint(e,t,i){let n=this.closestPointToPointParameter(e,t);return this.delta(i).multiplyScalar(n).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}},Sj=new G,DEe=class extends kn{constructor(e,t){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";let i=new ii,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let s=0,a=1,o=32;s<o;s++,a++){let l=s/o*Math.PI*2,c=a/o*Math.PI*2;n.push(Math.cos(l),Math.sin(l),1,Math.cos(c),Math.sin(c),1)}i.setAttribute("position",new Gt(n,3));let r=new gg({fog:!1,toneMapped:!1});this.cone=new aM(i,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);let e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),Sj.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Sj),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},REe=class extends fr{constructor(e,t,i){let n=new E1(t,4,2),r=new np({wireframe:!0,fog:!1,toneMapped:!1});super(n,r),this.light=e,this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},_j=new G,AT=new G,Aj=new G,PEe=class extends kn{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="DirectionalLightHelper",t===void 0&&(t=1);let n=new ii;n.setAttribute("position",new Gt([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));let r=new gg({fog:!1,toneMapped:!1});this.lightPlane=new t3(n,r),this.add(this.lightPlane),n=new ii,n.setAttribute("position",new Gt([0,0,0,0,0,1],3)),this.targetLine=new t3(n,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),_j.setFromMatrixPosition(this.light.matrixWorld),AT.setFromMatrixPosition(this.light.target.matrixWorld),Aj.subVectors(AT,_j),this.lightPlane.lookAt(AT),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(AT),this.targetLine.scale.z=Aj.length()}},wT=new G,Qr=new mg,o3=class extends aM{constructor(e){let t=new ii,i=new gg({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],r=[],s={};a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4");function a(p,g){o(p),o(g)}function o(p){n.push(0,0,0),r.push(0,0,0),s[p]===void 0&&(s[p]=[]),s[p].push(n.length/3-1)}t.setAttribute("position",new Gt(n,3)),t.setAttribute("color",new Gt(r,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update();let l=new gi(16755200),c=new gi(16711680),u=new gi(43775),h=new gi(16777215),d=new gi(3355443);this.setColors(l,c,u,h,d)}setColors(e,t,i,n,r){let s=this.geometry.getAttribute("color");s.setXYZ(0,e.r,e.g,e.b),s.setXYZ(1,e.r,e.g,e.b),s.setXYZ(2,e.r,e.g,e.b),s.setXYZ(3,e.r,e.g,e.b),s.setXYZ(4,e.r,e.g,e.b),s.setXYZ(5,e.r,e.g,e.b),s.setXYZ(6,e.r,e.g,e.b),s.setXYZ(7,e.r,e.g,e.b),s.setXYZ(8,e.r,e.g,e.b),s.setXYZ(9,e.r,e.g,e.b),s.setXYZ(10,e.r,e.g,e.b),s.setXYZ(11,e.r,e.g,e.b),s.setXYZ(12,e.r,e.g,e.b),s.setXYZ(13,e.r,e.g,e.b),s.setXYZ(14,e.r,e.g,e.b),s.setXYZ(15,e.r,e.g,e.b),s.setXYZ(16,e.r,e.g,e.b),s.setXYZ(17,e.r,e.g,e.b),s.setXYZ(18,e.r,e.g,e.b),s.setXYZ(19,e.r,e.g,e.b),s.setXYZ(20,e.r,e.g,e.b),s.setXYZ(21,e.r,e.g,e.b),s.setXYZ(22,e.r,e.g,e.b),s.setXYZ(23,e.r,e.g,e.b),s.setXYZ(24,t.r,t.g,t.b),s.setXYZ(25,t.r,t.g,t.b),s.setXYZ(26,t.r,t.g,t.b),s.setXYZ(27,t.r,t.g,t.b),s.setXYZ(28,t.r,t.g,t.b),s.setXYZ(29,t.r,t.g,t.b),s.setXYZ(30,t.r,t.g,t.b),s.setXYZ(31,t.r,t.g,t.b),s.setXYZ(32,i.r,i.g,i.b),s.setXYZ(33,i.r,i.g,i.b),s.setXYZ(34,i.r,i.g,i.b),s.setXYZ(35,i.r,i.g,i.b),s.setXYZ(36,i.r,i.g,i.b),s.setXYZ(37,i.r,i.g,i.b),s.setXYZ(38,n.r,n.g,n.b),s.setXYZ(39,n.r,n.g,n.b),s.setXYZ(40,r.r,r.g,r.b),s.setXYZ(41,r.r,r.g,r.b),s.setXYZ(42,r.r,r.g,r.b),s.setXYZ(43,r.r,r.g,r.b),s.setXYZ(44,r.r,r.g,r.b),s.setXYZ(45,r.r,r.g,r.b),s.setXYZ(46,r.r,r.g,r.b),s.setXYZ(47,r.r,r.g,r.b),s.setXYZ(48,r.r,r.g,r.b),s.setXYZ(49,r.r,r.g,r.b),s.needsUpdate=!0}update(){let e=this.geometry,t=this.pointMap,i=1,n=1;Qr.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),os("c",t,e,Qr,0,0,-1),os("t",t,e,Qr,0,0,1),os("n1",t,e,Qr,-1,-1,-1),os("n2",t,e,Qr,i,-1,-1),os("n3",t,e,Qr,-1,n,-1),os("n4",t,e,Qr,i,n,-1),os("f1",t,e,Qr,-1,-1,1),os("f2",t,e,Qr,i,-1,1),os("f3",t,e,Qr,-1,n,1),os("f4",t,e,Qr,i,n,1),os("u1",t,e,Qr,i*.7,n*1.1,-1),os("u2",t,e,Qr,-1*.7,n*1.1,-1),os("u3",t,e,Qr,0,n*2,-1),os("cf1",t,e,Qr,-1,0,1),os("cf2",t,e,Qr,i,0,1),os("cf3",t,e,Qr,0,-1,1),os("cf4",t,e,Qr,0,n,1),os("cn1",t,e,Qr,-1,0,-1),os("cn2",t,e,Qr,i,0,-1),os("cn3",t,e,Qr,0,-1,-1),os("cn4",t,e,Qr,0,n,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function os(e,t,i,n,r,s,a){wT.set(r,s,a).unproject(n);let o=t[e];if(o!==void 0){let l=i.getAttribute("position");for(let c=0,u=o.length;c<u;c++)l.setXYZ(o[c],wT.x,wT.y,wT.z)}}var l3=class extends aM{constructor(e,t=16776960){let i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],r=new ii;r.setIndex(new vi(i,1)),r.setAttribute("position",new Gt(n,3)),super(r,new gg({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){let t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}},OEe=class extends aM{constructor(e=1){let t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],n=new ii;n.setAttribute("position",new Gt(t,3)),n.setAttribute("color",new Gt(i,3));let r=new gg({vertexColors:!0,toneMapped:!1});super(n,r),this.type="AxesHelper"}setColors(e,t,i){let n=new gi,r=this.geometry.attributes.color.array;return n.set(e),n.toArray(r,0),n.toArray(r,3),n.set(t),n.toArray(r,6),n.toArray(r,9),n.set(i),n.toArray(r,12),n.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}},If=BEe();function BEe(){let e=new ArrayBuffer(4),t=new Float32Array(e),i=new Uint32Array(e),n=new Uint32Array(512),r=new Uint32Array(512);for(let l=0;l<256;++l){let c=l-127;c<-27?(n[l]=0,n[l|256]=32768,r[l]=24,r[l|256]=24):c<-14?(n[l]=1024>>-c-14,n[l|256]=1024>>-c-14|32768,r[l]=-c-1,r[l|256]=-c-1):c<=15?(n[l]=c+15<<10,n[l|256]=c+15<<10|32768,r[l]=13,r[l|256]=13):c<128?(n[l]=31744,n[l|256]=64512,r[l]=24,r[l|256]=24):(n[l]=31744,n[l|256]=64512,r[l]=13,r[l|256]=13)}let s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let c=l<<13,u=0;for(;(c&8388608)===0;)c<<=1,u-=8388608;c&=-8388609,u+=947912704,s[l]=c|u}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)a[l]=l<<23;a[31]=1199570944,a[32]=2147483648;for(let l=33;l<63;++l)a[l]=2147483648+(l-32<<23);a[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(o[l]=1024);return{floatView:t,uint32View:i,baseTable:n,shiftTable:r,mantissaTable:s,exponentTable:a,offsetTable:o}}function IEe(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=Es(e,-65504,65504),If.floatView[0]=e;let t=If.uint32View[0],i=t>>23&511;return If.baseTable[i]+((t&8388607)>>If.shiftTable[i])}function LEe(e){let t=e>>10;return If.uint32View[0]=If.mantissaTable[If.offsetTable[t]+(e&1023)]+If.exponentTable[t],If.floatView[0]}var UEe=Object.freeze({__proto__:null,fromHalfFloat:LEe,toHalfFloat:IEe});typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Tb}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Tb);var B_=".",W4=Symbol("target"),EZ=Symbol("unsubscribe");function ZU(e){return e instanceof Date||e instanceof Set||e instanceof Map||e instanceof WeakSet||e instanceof WeakMap||ArrayBuffer.isView(e)}function NEe(e){return(typeof e=="object"?e===null:typeof e!="function")||e instanceof RegExp}var sd=Array.isArray;function X4(e){return typeof e=="symbol"}var zEe={after:(e,t)=>sd(e)?e.slice(t.length):t===""?e:e.slice(t.length+1),concat:(e,t)=>sd(e)?(e=[...e],t&&e.push(t),e):t&&t.toString!==void 0?(e!==""&&(e+=B_),X4(t)?e+t.toString():e+t):e,initial:e=>{if(sd(e))return e.slice(0,-1);if(e==="")return e;let t=e.lastIndexOf(B_);return t===-1?"":e.slice(0,t)},last:e=>{if(sd(e))return e[e.length-1]||"";if(e==="")return e;let t=e.lastIndexOf(B_);return t===-1?e:e.slice(t+1)},walk:(e,t)=>{if(sd(e))for(let i of e)t(i);else if(e!==""){let i=0,n=e.indexOf(B_);if(n===-1)t(e);else for(;i<e.length;)n===-1&&(n=e.length),t(e.slice(i,n)),i=n+1,n=e.indexOf(B_,i)}},get(e,t){return this.walk(t,i=>{e&&(e=e[i])}),e}},Uc=zEe;function FEe(e){return typeof e=="object"&&typeof e.next=="function"}function VEe(e,t,i,n,r){let s=e.next;if(t.name==="entries")e.next=function(){let a=s.call(this);return a.done===!1&&(a.value[0]=r(a.value[0],t,a.value[0],n),a.value[1]=r(a.value[1],t,a.value[0],n)),a};else if(t.name==="values"){let a=i[W4].keys();e.next=function(){let o=s.call(this);return o.done===!1&&(o.value=r(o.value,t,a.next().value,n)),o}}else e.next=function(){let a=s.call(this);return a.done===!1&&(a.value=r(a.value,t,a.value,n)),a};return e}function wj(e,t,i){return e.isUnsubscribed||t.ignoreSymbols&&X4(i)||t.ignoreUnderscores&&i.charAt(0)==="_"||"ignoreKeys"in t&&t.ignoreKeys.includes(i)}var HEe=class{constructor(e){this._equals=e,this._proxyCache=new WeakMap,this._pathCache=new WeakMap,this.isUnsubscribed=!1}_getDescriptorCache(){return this._descriptorCache===void 0&&(this._descriptorCache=new WeakMap),this._descriptorCache}_getProperties(e){let t=this._getDescriptorCache(),i=t.get(e);return i===void 0&&(i={},t.set(e,i)),i}_getOwnPropertyDescriptor(e,t){if(this.isUnsubscribed)return Reflect.getOwnPropertyDescriptor(e,t);let i=this._getProperties(e),n=i[t];return n===void 0&&(n=Reflect.getOwnPropertyDescriptor(e,t),i[t]=n),n}getProxy(e,t,i,n){if(this.isUnsubscribed)return e;let r=e[n],s=r||e;this._pathCache.set(s,t);let a=this._proxyCache.get(s);return a===void 0&&(a=r===void 0?new Proxy(e,i):e,this._proxyCache.set(s,a)),a}getPath(e){return this.isUnsubscribed?void 0:this._pathCache.get(e)}isDetached(e,t){return!Object.is(e,Uc.get(t,this.getPath(e)))}defineProperty(e,t,i){return Reflect.defineProperty(e,t,i)?(this.isUnsubscribed||(this._getProperties(e)[t]=i),!0):!1}setProperty(e,t,i,n,r){if(!this._equals(r,i)||!(t in e)){let s=this._getOwnPropertyDescriptor(e,t);return s!==void 0&&"set"in s?Reflect.set(e,t,i,n):Reflect.set(e,t,i)}return!0}deleteProperty(e,t,i){if(Reflect.deleteProperty(e,t)){if(!this.isUnsubscribed){let n=this._getDescriptorCache().get(e);n&&(delete n[t],this._pathCache.delete(i))}return!0}return!1}isSameDescriptor(e,t,i){let n=this._getOwnPropertyDescriptor(t,i);return e!==void 0&&n!==void 0&&Object.is(e.value,n.value)&&(e.writable||!1)===(n.writable||!1)&&(e.enumerable||!1)===(n.enumerable||!1)&&(e.configurable||!1)===(n.configurable||!1)&&e.get===n.get&&e.set===n.set}isGetInvariant(e,t){let i=this._getOwnPropertyDescriptor(e,t);return i!==void 0&&i.configurable!==!0&&i.writable!==!0}unsubscribe(){this._descriptorCache=null,this._pathCache=null,this._proxyCache=null,this.isUnsubscribed=!0}};function $U(e){return toString.call(e)==="[object Object]"}function MT(){return!0}function Lx(e,t){return e.length!==t.length||e.some((i,n)=>t[n]!==i)}var TZ=new Set(["hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),GEe=new Set(["concat","includes","indexOf","join","keys","lastIndexOf"]),CZ={push:MT,pop:MT,shift:MT,unshift:MT,copyWithin:Lx,reverse:Lx,sort:Lx,splice:Lx,flat:Lx,fill:Lx},kEe=new Set([...TZ,...GEe,...Object.keys(CZ)]);function ET(e,t){if(e.size!==t.size)return!0;for(let i of e)if(!t.has(i))return!0;return!1}var DZ=["keys","values","entries"],RZ=new Set(["has","toString"]),PZ={add:ET,clear:ET,delete:ET,forEach:ET},jEe=new Set([...RZ,...Object.keys(PZ),...DZ]);function TT(e,t){if(e.size!==t.size)return!0;let i;for(let[n,r]of e)if(i=t.get(n),i!==r||i===void 0&&!t.has(n))return!0;return!1}var WEe=new Set([...RZ,"get"]),OZ={set:TT,clear:TT,delete:TT,forEach:TT},XEe=new Set([...WEe,...Object.keys(OZ),...DZ]),rg=class{constructor(e,t,i,n){this._path=t,this._isChanged=!1,this._clonedCache=new Set,this._hasOnValidate=n,this._changes=n?[]:null,this.clone=t===void 0?e:this._shallowClone(e)}static isHandledMethod(e){return TZ.has(e)}_shallowClone(e){let t=e;if($U(e))t={...e};else if(sd(e))t=[...e];else if(e instanceof Date)t=new Date(e);else if(e instanceof Set)t=new Set([...e].map(i=>this._shallowClone(i)));else if(e instanceof Map){t=new Map;for(let[i,n]of e.entries())t.set(i,this._shallowClone(n))}return this._clonedCache.add(t),t}preferredThisArg(e,t,i,n){return e?(sd(n)?this._onIsChanged=CZ[t]:n instanceof Set?this._onIsChanged=PZ[t]:n instanceof Map&&(this._onIsChanged=OZ[t]),n):i}update(e,t,i){let n=Uc.after(e,this._path);if(t!=="length"){let r=this.clone;Uc.walk(n,s=>{r&&r[s]&&(this._clonedCache.has(r[s])||(r[s]=this._shallowClone(r[s])),r=r[s])}),this._hasOnValidate&&this._changes.push({path:n,property:t,previous:i}),r&&r[t]&&(r[t]=i)}this._isChanged=!0}undo(e){let t;for(let i=this._changes.length-1;i!==-1;i--)t=this._changes[i],Uc.get(e,t.path)[t.property]=t.previous}isChanged(e){return this._onIsChanged===void 0?this._isChanged:this._onIsChanged(this.clone,e)}},Mj=class extends rg{static isHandledMethod(e){return kEe.has(e)}},qEe=class extends rg{undo(e){e.setTime(this.clone.getTime())}isChanged(e,t){return!t(this.clone.valueOf(),e.valueOf())}},Ej=class extends rg{static isHandledMethod(e){return jEe.has(e)}undo(e){for(let t of this.clone)e.add(t);for(let t of e)this.clone.has(t)||e.delete(t)}},Tj=class extends rg{static isHandledMethod(e){return XEe.has(e)}undo(e){for(let[t,i]of this.clone.entries())e.set(t,i);for(let t of e.keys())this.clone.has(t)||e.delete(t)}},YEe=class extends rg{constructor(e,t,i,n){super(void 0,t,i,n),this._arg1=i[0],this._weakValue=e.has(this._arg1)}isChanged(e){return this._weakValue!==e.has(this._arg1)}undo(e){this._weakValue&&!e.has(this._arg1)?e.add(this._arg1):e.delete(this._arg1)}},QEe=class extends rg{constructor(e,t,i,n){super(void 0,t,i,n),this._weakKey=i[0],this._weakHas=e.has(this._weakKey),this._weakValue=e.get(this._weakKey)}isChanged(e){return this._weakValue!==e.get(this._weakKey)}undo(e){let t=e.has(this._weakKey);this._weakHas&&!t?e.set(this._weakKey,this._weakValue):!this._weakHas&&t?e.delete(this._weakKey):this._weakValue!==e.get(this._weakKey)&&e.set(this._weakKey,this._weakValue)}},$x=class{constructor(e){this._stack=[],this._hasOnValidate=e}static isHandledType(e){return $U(e)||sd(e)||ZU(e)}static isHandledMethod(e,t){return $U(e)?rg.isHandledMethod(t):sd(e)?Mj.isHandledMethod(t):e instanceof Set?Ej.isHandledMethod(t):e instanceof Map?Tj.isHandledMethod(t):ZU(e)}get isCloning(){return this._stack.length>0}start(e,t,i){let n=rg;sd(e)?n=Mj:e instanceof Date?n=qEe:e instanceof Set?n=Ej:e instanceof Map?n=Tj:e instanceof WeakSet?n=YEe:e instanceof WeakMap&&(n=QEe),this._stack.push(new n(e,t,i,this._hasOnValidate))}update(e,t,i){this._stack[this._stack.length-1].update(e,t,i)}preferredThisArg(e,t,i){let{name:n}=e,r=$x.isHandledMethod(i,n);return this._stack[this._stack.length-1].preferredThisArg(r,n,t,i)}isChanged(e,t,i){return this._stack[this._stack.length-1].isChanged(e,t,i)}undo(e){this._previousClone!==void 0&&this._previousClone.undo(e)}stop(){return this._previousClone=this._stack.pop(),this._previousClone.clone}},KEe={equals:Object.is,isShallow:!1,pathAsArray:!1,ignoreSymbols:!1,ignoreUnderscores:!1,ignoreDetached:!1,details:!1},q4=(e,t,i={})=>{i={...KEe,...i};let n=Symbol("ProxyTarget"),{equals:r,isShallow:s,ignoreDetached:a,details:o}=i,l=new HEe(r),c=typeof i.onValidate=="function",u=new $x(c),h=(A,w,E,D,T)=>!c||u.isCloning||i.onValidate(Uc.concat(l.getPath(A),w),E,D,T)===!0,d=(A,w,E,D)=>{!wj(l,i,w)&&!(a&&l.isDetached(A,e))&&p(l.getPath(A),w,E,D)},p=(A,w,E,D,T)=>{u.isCloning?u.update(A,w,D):t(Uc.concat(A,w),E,D,T)},g=A=>A&&(A[n]||A),x=(A,w,E,D)=>NEe(A)||E==="constructor"||s&&!$x.isHandledMethod(w,E)||wj(l,i,E)||l.isGetInvariant(w,E)||a&&l.isDetached(w,e)?A:(D===void 0&&(D=l.getPath(w)),l.getProxy(A,Uc.concat(D,E),y,n)),y={get(A,w,E){if(X4(w)){if(w===n||w===W4)return A;if(w===EZ&&!l.isUnsubscribed&&l.getPath(A).length===0)return l.unsubscribe(),A}let D=ZU(A)?Reflect.get(A,w):Reflect.get(A,w,E);return x(D,A,w)},set(A,w,E,D){E=g(E);let T=A[n]||A,I=T[w];if(r(I,E)&&w in A)return!0;let R=h(A,w,E,I);return R&&l.setProperty(T,w,E,D,I)?(d(A,w,A[w],I),!0):!R},defineProperty(A,w,E){if(!l.isSameDescriptor(E,A,w)){let D=A[w];h(A,w,E.value,D)&&l.defineProperty(A,w,E,D)&&d(A,w,E.value,D)}return!0},deleteProperty(A,w){if(!Reflect.has(A,w))return!0;let E=Reflect.get(A,w),D=h(A,w,void 0,E);return D&&l.deleteProperty(A,w,E)?(d(A,w,void 0,E),!0):!D},apply(A,w,E){let D=w[n]||w;if(l.isUnsubscribed)return Reflect.apply(A,D,E);if((o===!1||o!==!0&&!o.includes(A.name))&&$x.isHandledType(D)){let T=Uc.initial(l.getPath(A)),I=$x.isHandledMethod(D,A.name);u.start(D,T,E);let R=Reflect.apply(A,u.preferredThisArg(A,w,D),I?E.map(U=>g(U)):E),O=u.isChanged(D,r),P=u.stop();if($x.isHandledType(R)&&I&&(w instanceof Map&&A.name==="get"&&(T=Uc.concat(T,E[0])),R=l.getProxy(R,T,y)),O){let U={name:A.name,args:E,result:R},H=u.isCloning?Uc.initial(T):T,V=u.isCloning?Uc.last(T):"";h(Uc.get(e,H),V,D,P,U)?p(H,V,D,P,U):u.undo(D)}return(w instanceof Map||w instanceof Set)&&FEe(R)?VEe(R,A,w,T,x):R}return Reflect.apply(A,w,E)}},b=l.getProxy(e,i.pathAsArray?[]:"",y);return t=t.bind(b),c&&(i.onValidate=i.onValidate.bind(b)),b};q4.target=e=>e&&e[W4]||e;q4.unsubscribe=e=>e[EZ]||e;var Cj=q4,JEe=typeof global=="object"&&global&&global.Object===Object&&global,BZ=JEe,ZEe=typeof self=="object"&&self&&self.Object===Object&&self,$Ee=BZ||ZEe||Function("return this")(),rh=$Ee,e2e=rh.Symbol,Zc=e2e,IZ=Object.prototype,t2e=IZ.hasOwnProperty,i2e=IZ.toString,I_=Zc?Zc.toStringTag:void 0;function n2e(e){var t=t2e.call(e,I_),i=e[I_];try{e[I_]=void 0;var n=!0}catch{}var r=i2e.call(e);return n&&(t?e[I_]=i:delete e[I_]),r}var r2e=n2e,s2e=Object.prototype,a2e=s2e.toString;function o2e(e){return a2e.call(e)}var l2e=o2e,c2e="[object Null]",u2e="[object Undefined]",Dj=Zc?Zc.toStringTag:void 0;function h2e(e){return e==null?e===void 0?u2e:c2e:Dj&&Dj in Object(e)?r2e(e):l2e(e)}var Y0=h2e;function d2e(e){return e!=null&&typeof e=="object"}var rp=d2e,f2e="[object Symbol]";function p2e(e){return typeof e=="symbol"||rp(e)&&Y0(e)==f2e}var uM=p2e;function m2e(e,t){for(var i=-1,n=e==null?0:e.length,r=Array(n);++i<n;)r[i]=t(e[i],i,e);return r}var LZ=m2e,g2e=Array.isArray,wd=g2e,Rj=Zc?Zc.prototype:void 0,Pj=Rj?Rj.toString:void 0;function UZ(e){if(typeof e=="string")return e;if(wd(e))return LZ(e,UZ)+"";if(uM(e))return Pj?Pj.call(e):"";var t=e+"";return t=="0"&&1/e==-1/0?"-0":t}var v2e=UZ,y2e=/\s/;function x2e(e){for(var t=e.length;t--&&y2e.test(e.charAt(t)););return t}var b2e=x2e,S2e=/^\s+/;function _2e(e){return e&&e.slice(0,b2e(e)+1).replace(S2e,"")}var A2e=_2e;function w2e(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var th=w2e,Oj=NaN,M2e=/^[-+]0x[0-9a-f]+$/i,E2e=/^0b[01]+$/i,T2e=/^0o[0-7]+$/i,C2e=parseInt;function D2e(e){if(typeof e=="number")return e;if(uM(e))return Oj;if(th(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=th(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=A2e(e);var i=E2e.test(e);return i||T2e.test(e)?C2e(e.slice(2),i?2:8):M2e.test(e)?Oj:+e}var Bj=D2e;function R2e(e){return e}var NZ=R2e,P2e="[object AsyncFunction]",O2e="[object Function]",B2e="[object GeneratorFunction]",I2e="[object Proxy]";function L2e(e){if(!th(e))return!1;var t=Y0(e);return t==O2e||t==B2e||t==P2e||t==I2e}var zZ=L2e,U2e=rh["__core-js_shared__"],vI=U2e,Ij=function(){var e=/[^.]+$/.exec(vI&&vI.keys&&vI.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function N2e(e){return!!Ij&&Ij in e}var z2e=N2e,F2e=Function.prototype,V2e=F2e.toString;function H2e(e){if(e!=null){try{return V2e.call(e)}catch{}try{return e+""}catch{}}return""}var Q0=H2e,G2e=/[\\^$.*+?()[\]{}|]/g,k2e=/^\[object .+?Constructor\]$/,j2e=Function.prototype,W2e=Object.prototype,X2e=j2e.toString,q2e=W2e.hasOwnProperty,Y2e=RegExp("^"+X2e.call(q2e).replace(G2e,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Q2e(e){if(!th(e)||z2e(e))return!1;var t=zZ(e)?Y2e:k2e;return t.test(Q0(e))}var K2e=Q2e;function J2e(e,t){return e==null?void 0:e[t]}var Z2e=J2e;function $2e(e,t){var i=Z2e(e,t);return K2e(i)?i:void 0}var K0=$2e,eTe=K0(rh,"WeakMap"),eN=eTe,Lj=Object.create,tTe=function(){function e(){}return function(t){if(!th(t))return{};if(Lj)return Lj(t);e.prototype=t;var i=new e;return e.prototype=void 0,i}}(),iTe=tTe;function nTe(e,t,i){switch(i.length){case 0:return e.call(t);case 1:return e.call(t,i[0]);case 2:return e.call(t,i[0],i[1]);case 3:return e.call(t,i[0],i[1],i[2])}return e.apply(t,i)}var rTe=nTe;function sTe(e,t){var i=-1,n=e.length;for(t||(t=Array(n));++i<n;)t[i]=e[i];return t}var aTe=sTe,oTe=800,lTe=16,cTe=Date.now;function uTe(e){var t=0,i=0;return function(){var n=cTe(),r=lTe-(n-i);if(i=n,r>0){if(++t>=oTe)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var hTe=uTe;function dTe(e){return function(){return e}}var fTe=dTe,pTe=function(){try{var e=K0(Object,"defineProperty");return e({},"",{}),e}catch{}}(),c3=pTe,mTe=c3?function(e,t){return c3(e,"toString",{configurable:!0,enumerable:!1,value:fTe(t),writable:!0})}:NZ,gTe=mTe,vTe=hTe(gTe),yTe=vTe;function xTe(e,t){for(var i=-1,n=e==null?0:e.length;++i<n&&t(e[i],i,e)!==!1;);return e}var bTe=xTe,STe=9007199254740991,_Te=/^(?:0|[1-9]\d*)$/;function ATe(e,t){var i=typeof e;return t=t??STe,!!t&&(i=="number"||i!="symbol"&&_Te.test(e))&&e>-1&&e%1==0&&e<t}var Y4=ATe;function wTe(e,t,i){t=="__proto__"&&c3?c3(e,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[t]=i}var FZ=wTe;function MTe(e,t){return e===t||e!==e&&t!==t}var Q4=MTe,ETe=Object.prototype,TTe=ETe.hasOwnProperty;function CTe(e,t,i){var n=e[t];(!(TTe.call(e,t)&&Q4(n,i))||i===void 0&&!(t in e))&&FZ(e,t,i)}var K4=CTe;function DTe(e,t,i,n){var r=!i;i||(i={});for(var s=-1,a=t.length;++s<a;){var o=t[s],l=n?n(i[o],e[o],o,i,e):void 0;l===void 0&&(l=e[o]),r?FZ(i,o,l):K4(i,o,l)}return i}var hM=DTe,Uj=Math.max;function RTe(e,t,i){return t=Uj(t===void 0?e.length-1:t,0),function(){for(var n=arguments,r=-1,s=Uj(n.length-t,0),a=Array(s);++r<s;)a[r]=n[t+r];r=-1;for(var o=Array(t+1);++r<t;)o[r]=n[r];return o[t]=i(a),rTe(e,this,o)}}var PTe=RTe,OTe=9007199254740991;function BTe(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=OTe}var J4=BTe;function ITe(e){return e!=null&&J4(e.length)&&!zZ(e)}var VZ=ITe,LTe=Object.prototype;function UTe(e){var t=e&&e.constructor,i=typeof t=="function"&&t.prototype||LTe;return e===i}var Z4=UTe;function NTe(e,t){for(var i=-1,n=Array(e);++i<e;)n[i]=t(i);return n}var zTe=NTe,FTe="[object Arguments]";function VTe(e){return rp(e)&&Y0(e)==FTe}var Nj=VTe,HZ=Object.prototype,HTe=HZ.hasOwnProperty,GTe=HZ.propertyIsEnumerable,kTe=Nj(function(){return arguments}())?Nj:function(e){return rp(e)&&HTe.call(e,"callee")&&!GTe.call(e,"callee")},$4=kTe;function jTe(){return!1}var WTe=jTe,GZ=typeof exports=="object"&&exports&&!exports.nodeType&&exports,zj=GZ&&typeof module=="object"&&module&&!module.nodeType&&module,XTe=zj&&zj.exports===GZ,Fj=XTe?rh.Buffer:void 0,qTe=Fj?Fj.isBuffer:void 0,YTe=qTe||WTe,u3=YTe,QTe="[object Arguments]",KTe="[object Array]",JTe="[object Boolean]",ZTe="[object Date]",$Te="[object Error]",eCe="[object Function]",tCe="[object Map]",iCe="[object Number]",nCe="[object Object]",rCe="[object RegExp]",sCe="[object Set]",aCe="[object String]",oCe="[object WeakMap]",lCe="[object ArrayBuffer]",cCe="[object DataView]",uCe="[object Float32Array]",hCe="[object Float64Array]",dCe="[object Int8Array]",fCe="[object Int16Array]",pCe="[object Int32Array]",mCe="[object Uint8Array]",gCe="[object Uint8ClampedArray]",vCe="[object Uint16Array]",yCe="[object Uint32Array]",_r={};_r[uCe]=_r[hCe]=_r[dCe]=_r[fCe]=_r[pCe]=_r[mCe]=_r[gCe]=_r[vCe]=_r[yCe]=!0;_r[QTe]=_r[KTe]=_r[lCe]=_r[JTe]=_r[cCe]=_r[ZTe]=_r[$Te]=_r[eCe]=_r[tCe]=_r[iCe]=_r[nCe]=_r[rCe]=_r[sCe]=_r[aCe]=_r[oCe]=!1;function xCe(e){return rp(e)&&J4(e.length)&&!!_r[Y0(e)]}var bCe=xCe;function SCe(e){return function(t){return e(t)}}var e5=SCe,kZ=typeof exports=="object"&&exports&&!exports.nodeType&&exports,LA=kZ&&typeof module=="object"&&module&&!module.nodeType&&module,_Ce=LA&&LA.exports===kZ,yI=_Ce&&BZ.process,ACe=function(){try{var e=LA&&LA.require&&LA.require("util").types;return e||yI&&yI.binding&&yI.binding("util")}catch{}}(),ib=ACe,Vj=ib&&ib.isTypedArray,wCe=Vj?e5(Vj):bCe,jZ=wCe,MCe=Object.prototype,ECe=MCe.hasOwnProperty;function TCe(e,t){var i=wd(e),n=!i&&$4(e),r=!i&&!n&&u3(e),s=!i&&!n&&!r&&jZ(e),a=i||n||r||s,o=a?zTe(e.length,String):[],l=o.length;for(var c in e)(t||ECe.call(e,c))&&!(a&&(c=="length"||r&&(c=="offset"||c=="parent")||s&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||Y4(c,l)))&&o.push(c);return o}var WZ=TCe;function CCe(e,t){return function(i){return e(t(i))}}var XZ=CCe,DCe=XZ(Object.keys,Object),RCe=DCe,PCe=Object.prototype,OCe=PCe.hasOwnProperty;function BCe(e){if(!Z4(e))return RCe(e);var t=[];for(var i in Object(e))OCe.call(e,i)&&i!="constructor"&&t.push(i);return t}var ICe=BCe;function LCe(e){return VZ(e)?WZ(e):ICe(e)}var t5=LCe;function UCe(e){var t=[];if(e!=null)for(var i in Object(e))t.push(i);return t}var NCe=UCe,zCe=Object.prototype,FCe=zCe.hasOwnProperty;function VCe(e){if(!th(e))return NCe(e);var t=Z4(e),i=[];for(var n in e)n=="constructor"&&(t||!FCe.call(e,n))||i.push(n);return i}var HCe=VCe;function GCe(e){return VZ(e)?WZ(e,!0):HCe(e)}var s0=GCe,kCe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,jCe=/^\w*$/;function WCe(e,t){if(wd(e))return!1;var i=typeof e;return i=="number"||i=="symbol"||i=="boolean"||e==null||uM(e)?!0:jCe.test(e)||!kCe.test(e)||t!=null&&e in Object(t)}var XCe=WCe,qCe=K0(Object,"create"),xw=qCe;function YCe(){this.__data__=xw?xw(null):{},this.size=0}var QCe=YCe;function KCe(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var JCe=KCe,ZCe="__lodash_hash_undefined__",$Ce=Object.prototype,eDe=$Ce.hasOwnProperty;function tDe(e){var t=this.__data__;if(xw){var i=t[e];return i===ZCe?void 0:i}return eDe.call(t,e)?t[e]:void 0}var iDe=tDe,nDe=Object.prototype,rDe=nDe.hasOwnProperty;function sDe(e){var t=this.__data__;return xw?t[e]!==void 0:rDe.call(t,e)}var aDe=sDe,oDe="__lodash_hash_undefined__";function lDe(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=xw&&t===void 0?oDe:t,this}var cDe=lDe;function Bb(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}Bb.prototype.clear=QCe;Bb.prototype.delete=JCe;Bb.prototype.get=iDe;Bb.prototype.has=aDe;Bb.prototype.set=cDe;var Hj=Bb;function uDe(){this.__data__=[],this.size=0}var hDe=uDe;function dDe(e,t){for(var i=e.length;i--;)if(Q4(e[i][0],t))return i;return-1}var YR=dDe,fDe=Array.prototype,pDe=fDe.splice;function mDe(e){var t=this.__data__,i=YR(t,e);if(i<0)return!1;var n=t.length-1;return i==n?t.pop():pDe.call(t,i,1),--this.size,!0}var gDe=mDe;function vDe(e){var t=this.__data__,i=YR(t,e);return i<0?void 0:t[i][1]}var yDe=vDe;function xDe(e){return YR(this.__data__,e)>-1}var bDe=xDe;function SDe(e,t){var i=this.__data__,n=YR(i,e);return n<0?(++this.size,i.push([e,t])):i[n][1]=t,this}var _De=SDe;function Ib(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}Ib.prototype.clear=hDe;Ib.prototype.delete=gDe;Ib.prototype.get=yDe;Ib.prototype.has=bDe;Ib.prototype.set=_De;var QR=Ib,ADe=K0(rh,"Map"),bw=ADe;function wDe(){this.size=0,this.__data__={hash:new Hj,map:new(bw||QR),string:new Hj}}var MDe=wDe;function EDe(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var TDe=EDe;function CDe(e,t){var i=e.__data__;return TDe(t)?i[typeof t=="string"?"string":"hash"]:i.map}var KR=CDe;function DDe(e){var t=KR(this,e).delete(e);return this.size-=t?1:0,t}var RDe=DDe;function PDe(e){return KR(this,e).get(e)}var ODe=PDe;function BDe(e){return KR(this,e).has(e)}var IDe=BDe;function LDe(e,t){var i=KR(this,e),n=i.size;return i.set(e,t),this.size+=i.size==n?0:1,this}var UDe=LDe;function Lb(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}Lb.prototype.clear=MDe;Lb.prototype.delete=RDe;Lb.prototype.get=ODe;Lb.prototype.has=IDe;Lb.prototype.set=UDe;var JR=Lb,NDe="Expected a function";function i5(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(NDe);var i=function(){var n=arguments,r=t?t.apply(this,n):n[0],s=i.cache;if(s.has(r))return s.get(r);var a=e.apply(this,n);return i.cache=s.set(r,a)||s,a};return i.cache=new(i5.Cache||JR),i}i5.Cache=JR;var zDe=i5,FDe=500;function VDe(e){var t=zDe(e,function(n){return i.size===FDe&&i.clear(),n}),i=t.cache;return t}var HDe=VDe,GDe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,kDe=/\\(\\)?/g,jDe=HDe(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(GDe,function(i,n,r,s){t.push(r?s.replace(kDe,"$1"):n||i)}),t}),WDe=jDe;function XDe(e){return e==null?"":v2e(e)}var qDe=XDe;function YDe(e,t){return wd(e)?e:XCe(e,t)?[e]:WDe(qDe(e))}var Ub=YDe;function QDe(e){if(typeof e=="string"||uM(e))return e;var t=e+"";return t=="0"&&1/e==-1/0?"-0":t}var ZR=QDe;function KDe(e,t){t=Ub(t,e);for(var i=0,n=t.length;e!=null&&i<n;)e=e[ZR(t[i++])];return i&&i==n?e:void 0}var qZ=KDe;function JDe(e,t){for(var i=-1,n=t.length,r=e.length;++i<n;)e[r+i]=t[i];return e}var n5=JDe,Gj=Zc?Zc.isConcatSpreadable:void 0;function ZDe(e){return wd(e)||$4(e)||!!(Gj&&e&&e[Gj])}var $De=ZDe;function YZ(e,t,i,n,r){var s=-1,a=e.length;for(i||(i=$De),r||(r=[]);++s<a;){var o=e[s];t>0&&i(o)?t>1?YZ(o,t-1,i,n,r):n5(r,o):n||(r[r.length]=o)}return r}var e3e=YZ;function t3e(e){var t=e==null?0:e.length;return t?e3e(e,1):[]}var i3e=t3e;function n3e(e){return yTe(PTe(e,void 0,i3e),e+"")}var QZ=n3e,r3e=XZ(Object.getPrototypeOf,Object),r5=r3e,s3e="[object Object]",a3e=Function.prototype,o3e=Object.prototype,KZ=a3e.toString,l3e=o3e.hasOwnProperty,c3e=KZ.call(Object);function u3e(e){if(!rp(e)||Y0(e)!=s3e)return!1;var t=r5(e);if(t===null)return!0;var i=l3e.call(t,"constructor")&&t.constructor;return typeof i=="function"&&i instanceof i&&KZ.call(i)==c3e}var h3e=u3e;function d3e(e,t,i){var n=-1,r=e.length;t<0&&(t=-t>r?0:r+t),i=i>r?r:i,i<0&&(i+=r),r=t>i?0:i-t>>>0,t>>>=0;for(var s=Array(r);++n<r;)s[n]=e[n+t];return s}var f3e=d3e;function p3e(){this.__data__=new QR,this.size=0}var m3e=p3e;function g3e(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i}var v3e=g3e;function y3e(e){return this.__data__.get(e)}var x3e=y3e;function b3e(e){return this.__data__.has(e)}var S3e=b3e,_3e=200;function A3e(e,t){var i=this.__data__;if(i instanceof QR){var n=i.__data__;if(!bw||n.length<_3e-1)return n.push([e,t]),this.size=++i.size,this;i=this.__data__=new JR(n)}return i.set(e,t),this.size=i.size,this}var w3e=A3e;function Nb(e){var t=this.__data__=new QR(e);this.size=t.size}Nb.prototype.clear=m3e;Nb.prototype.delete=v3e;Nb.prototype.get=x3e;Nb.prototype.has=S3e;Nb.prototype.set=w3e;var UC=Nb;function M3e(e,t){return e&&hM(t,t5(t),e)}var E3e=M3e;function T3e(e,t){return e&&hM(t,s0(t),e)}var C3e=T3e,JZ=typeof exports=="object"&&exports&&!exports.nodeType&&exports,kj=JZ&&typeof module=="object"&&module&&!module.nodeType&&module,D3e=kj&&kj.exports===JZ,jj=D3e?rh.Buffer:void 0,Wj=jj?jj.allocUnsafe:void 0;function R3e(e,t){if(t)return e.slice();var i=e.length,n=Wj?Wj(i):new e.constructor(i);return e.copy(n),n}var P3e=R3e;function O3e(e,t){for(var i=-1,n=e==null?0:e.length,r=0,s=[];++i<n;){var a=e[i];t(a,i,e)&&(s[r++]=a)}return s}var B3e=O3e;function I3e(){return[]}var ZZ=I3e,L3e=Object.prototype,U3e=L3e.propertyIsEnumerable,Xj=Object.getOwnPropertySymbols,N3e=Xj?function(e){return e==null?[]:(e=Object(e),B3e(Xj(e),function(t){return U3e.call(e,t)}))}:ZZ,s5=N3e;function z3e(e,t){return hM(e,s5(e),t)}var F3e=z3e,V3e=Object.getOwnPropertySymbols,H3e=V3e?function(e){for(var t=[];e;)n5(t,s5(e)),e=r5(e);return t}:ZZ,$Z=H3e;function G3e(e,t){return hM(e,$Z(e),t)}var k3e=G3e;function j3e(e,t,i){var n=t(e);return wd(e)?n:n5(n,i(e))}var e$=j3e;function W3e(e){return e$(e,t5,s5)}var tN=W3e;function X3e(e){return e$(e,s0,$Z)}var t$=X3e,q3e=K0(rh,"DataView"),iN=q3e,Y3e=K0(rh,"Promise"),nN=Y3e,Q3e=K0(rh,"Set"),rN=Q3e,qj="[object Map]",K3e="[object Object]",Yj="[object Promise]",Qj="[object Set]",Kj="[object WeakMap]",Jj="[object DataView]",J3e=Q0(iN),Z3e=Q0(bw),$3e=Q0(nN),eRe=Q0(rN),tRe=Q0(eN),Hv=Y0;(iN&&Hv(new iN(new ArrayBuffer(1)))!=Jj||bw&&Hv(new bw)!=qj||nN&&Hv(nN.resolve())!=Yj||rN&&Hv(new rN)!=Qj||eN&&Hv(new eN)!=Kj)&&(Hv=function(e){var t=Y0(e),i=t==K3e?e.constructor:void 0,n=i?Q0(i):"";if(n)switch(n){case J3e:return Jj;case Z3e:return qj;case $3e:return Yj;case eRe:return Qj;case tRe:return Kj}return t});var Sw=Hv,iRe=Object.prototype,nRe=iRe.hasOwnProperty;function rRe(e){var t=e.length,i=new e.constructor(t);return t&&typeof e[0]=="string"&&nRe.call(e,"index")&&(i.index=e.index,i.input=e.input),i}var sRe=rRe,aRe=rh.Uint8Array,h3=aRe;function oRe(e){var t=new e.constructor(e.byteLength);return new h3(t).set(new h3(e)),t}var a5=oRe;function lRe(e,t){var i=t?a5(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.byteLength)}var cRe=lRe,uRe=/\w*$/;function hRe(e){var t=new e.constructor(e.source,uRe.exec(e));return t.lastIndex=e.lastIndex,t}var dRe=hRe,Zj=Zc?Zc.prototype:void 0,$j=Zj?Zj.valueOf:void 0;function fRe(e){return $j?Object($j.call(e)):{}}var pRe=fRe;function mRe(e,t){var i=t?a5(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.length)}var gRe=mRe,vRe="[object Boolean]",yRe="[object Date]",xRe="[object Map]",bRe="[object Number]",SRe="[object RegExp]",_Re="[object Set]",ARe="[object String]",wRe="[object Symbol]",MRe="[object ArrayBuffer]",ERe="[object DataView]",TRe="[object Float32Array]",CRe="[object Float64Array]",DRe="[object Int8Array]",RRe="[object Int16Array]",PRe="[object Int32Array]",ORe="[object Uint8Array]",BRe="[object Uint8ClampedArray]",IRe="[object Uint16Array]",LRe="[object Uint32Array]";function URe(e,t,i){var n=e.constructor;switch(t){case MRe:return a5(e);case vRe:case yRe:return new n(+e);case ERe:return cRe(e,i);case TRe:case CRe:case DRe:case RRe:case PRe:case ORe:case BRe:case IRe:case LRe:return gRe(e,i);case xRe:return new n;case bRe:case ARe:return new n(e);case SRe:return dRe(e);case _Re:return new n;case wRe:return pRe(e)}}var NRe=URe;function zRe(e){return typeof e.constructor=="function"&&!Z4(e)?iTe(r5(e)):{}}var FRe=zRe,VRe="[object Map]";function HRe(e){return rp(e)&&Sw(e)==VRe}var GRe=HRe,e9=ib&&ib.isMap,kRe=e9?e5(e9):GRe,jRe=kRe,WRe="[object Set]";function XRe(e){return rp(e)&&Sw(e)==WRe}var qRe=XRe,t9=ib&&ib.isSet,YRe=t9?e5(t9):qRe,QRe=YRe,KRe=1,JRe=2,ZRe=4,i$="[object Arguments]",$Re="[object Array]",ePe="[object Boolean]",tPe="[object Date]",iPe="[object Error]",n$="[object Function]",nPe="[object GeneratorFunction]",rPe="[object Map]",sPe="[object Number]",r$="[object Object]",aPe="[object RegExp]",oPe="[object Set]",lPe="[object String]",cPe="[object Symbol]",uPe="[object WeakMap]",hPe="[object ArrayBuffer]",dPe="[object DataView]",fPe="[object Float32Array]",pPe="[object Float64Array]",mPe="[object Int8Array]",gPe="[object Int16Array]",vPe="[object Int32Array]",yPe="[object Uint8Array]",xPe="[object Uint8ClampedArray]",bPe="[object Uint16Array]",SPe="[object Uint32Array]",mr={};mr[i$]=mr[$Re]=mr[hPe]=mr[dPe]=mr[ePe]=mr[tPe]=mr[fPe]=mr[pPe]=mr[mPe]=mr[gPe]=mr[vPe]=mr[rPe]=mr[sPe]=mr[r$]=mr[aPe]=mr[oPe]=mr[lPe]=mr[cPe]=mr[yPe]=mr[xPe]=mr[bPe]=mr[SPe]=!0;mr[iPe]=mr[n$]=mr[uPe]=!1;function NC(e,t,i,n,r,s){var a,o=t&KRe,l=t&JRe,c=t&ZRe;if(i&&(a=r?i(e,n,r,s):i(e)),a!==void 0)return a;if(!th(e))return e;var u=wd(e);if(u){if(a=sRe(e),!o)return aTe(e,a)}else{var h=Sw(e),d=h==n$||h==nPe;if(u3(e))return P3e(e,o);if(h==r$||h==i$||d&&!r){if(a=l||d?{}:FRe(e),!o)return l?k3e(e,C3e(a,e)):F3e(e,E3e(a,e))}else{if(!mr[h])return r?e:{};a=NRe(e,h,o)}}s||(s=new UC);var p=s.get(e);if(p)return p;s.set(e,a),QRe(e)?e.forEach(function(y){a.add(NC(y,t,i,y,e,s))}):jRe(e)&&e.forEach(function(y,b){a.set(b,NC(y,t,i,b,e,s))});var g=c?l?t$:tN:l?s0:t5,x=u?void 0:g(e);return bTe(x||e,function(y,b){x&&(b=y,y=e[b]),K4(a,b,NC(y,t,i,b,e,s))}),a}var s$=NC,_Pe=1,APe=4;function wPe(e){return s$(e,_Pe|APe)}var $R=wPe,MPe="__lodash_hash_undefined__";function EPe(e){return this.__data__.set(e,MPe),this}var TPe=EPe;function CPe(e){return this.__data__.has(e)}var DPe=CPe;function d3(e){var t=-1,i=e==null?0:e.length;for(this.__data__=new JR;++t<i;)this.add(e[t])}d3.prototype.add=d3.prototype.push=TPe;d3.prototype.has=DPe;var RPe=d3;function PPe(e,t){for(var i=-1,n=e==null?0:e.length;++i<n;)if(t(e[i],i,e))return!0;return!1}var OPe=PPe;function BPe(e,t){return e.has(t)}var IPe=BPe,LPe=1,UPe=2;function NPe(e,t,i,n,r,s){var a=i&LPe,o=e.length,l=t.length;if(o!=l&&!(a&&l>o))return!1;var c=s.get(e),u=s.get(t);if(c&&u)return c==t&&u==e;var h=-1,d=!0,p=i&UPe?new RPe:void 0;for(s.set(e,t),s.set(t,e);++h<o;){var g=e[h],x=t[h];if(n)var y=a?n(x,g,h,t,e,s):n(g,x,h,e,t,s);if(y!==void 0){if(y)continue;d=!1;break}if(p){if(!OPe(t,function(b,A){if(!IPe(p,A)&&(g===b||r(g,b,i,n,s)))return p.push(A)})){d=!1;break}}else if(!(g===x||r(g,x,i,n,s))){d=!1;break}}return s.delete(e),s.delete(t),d}var a$=NPe;function zPe(e){var t=-1,i=Array(e.size);return e.forEach(function(n,r){i[++t]=[r,n]}),i}var FPe=zPe;function VPe(e){var t=-1,i=Array(e.size);return e.forEach(function(n){i[++t]=n}),i}var HPe=VPe,GPe=1,kPe=2,jPe="[object Boolean]",WPe="[object Date]",XPe="[object Error]",qPe="[object Map]",YPe="[object Number]",QPe="[object RegExp]",KPe="[object Set]",JPe="[object String]",ZPe="[object Symbol]",$Pe="[object ArrayBuffer]",eOe="[object DataView]",i9=Zc?Zc.prototype:void 0,xI=i9?i9.valueOf:void 0;function tOe(e,t,i,n,r,s,a){switch(i){case eOe:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case $Pe:return!(e.byteLength!=t.byteLength||!s(new h3(e),new h3(t)));case jPe:case WPe:case YPe:return Q4(+e,+t);case XPe:return e.name==t.name&&e.message==t.message;case QPe:case JPe:return e==t+"";case qPe:var o=FPe;case KPe:var l=n&GPe;if(o||(o=HPe),e.size!=t.size&&!l)return!1;var c=a.get(e);if(c)return c==t;n|=kPe,a.set(e,t);var u=a$(o(e),o(t),n,r,s,a);return a.delete(e),u;case ZPe:if(xI)return xI.call(e)==xI.call(t)}return!1}var iOe=tOe,nOe=1,rOe=Object.prototype,sOe=rOe.hasOwnProperty;function aOe(e,t,i,n,r,s){var a=i&nOe,o=tN(e),l=o.length,c=tN(t),u=c.length;if(l!=u&&!a)return!1;for(var h=l;h--;){var d=o[h];if(!(a?d in t:sOe.call(t,d)))return!1}var p=s.get(e),g=s.get(t);if(p&&g)return p==t&&g==e;var x=!0;s.set(e,t),s.set(t,e);for(var y=a;++h<l;){d=o[h];var b=e[d],A=t[d];if(n)var w=a?n(A,b,d,t,e,s):n(b,A,d,e,t,s);if(!(w===void 0?b===A||r(b,A,i,n,s):w)){x=!1;break}y||(y=d=="constructor")}if(x&&!y){var E=e.constructor,D=t.constructor;E!=D&&"constructor"in e&&"constructor"in t&&!(typeof E=="function"&&E instanceof E&&typeof D=="function"&&D instanceof D)&&(x=!1)}return s.delete(e),s.delete(t),x}var oOe=aOe,lOe=1,n9="[object Arguments]",r9="[object Array]",CT="[object Object]",cOe=Object.prototype,s9=cOe.hasOwnProperty;function uOe(e,t,i,n,r,s){var a=wd(e),o=wd(t),l=a?r9:Sw(e),c=o?r9:Sw(t);l=l==n9?CT:l,c=c==n9?CT:c;var u=l==CT,h=c==CT,d=l==c;if(d&&u3(e)){if(!u3(t))return!1;a=!0,u=!1}if(d&&!u)return s||(s=new UC),a||jZ(e)?a$(e,t,i,n,r,s):iOe(e,t,l,i,n,r,s);if(!(i&lOe)){var p=u&&s9.call(e,"__wrapped__"),g=h&&s9.call(t,"__wrapped__");if(p||g){var x=p?e.value():e,y=g?t.value():t;return s||(s=new UC),r(x,y,i,n,s)}}return d?(s||(s=new UC),oOe(e,t,i,n,r,s)):!1}var hOe=uOe;function o$(e,t,i,n,r){return e===t?!0:e==null||t==null||!rp(e)&&!rp(t)?e!==e&&t!==t:hOe(e,t,i,n,o$,r)}var dOe=o$;function fOe(e,t){return e!=null&&t in Object(e)}var pOe=fOe;function mOe(e,t,i){t=Ub(t,e);for(var n=-1,r=t.length,s=!1;++n<r;){var a=ZR(t[n]);if(!(s=e!=null&&i(e,a)))break;e=e[a]}return s||++n!=r?s:(r=e==null?0:e.length,!!r&&J4(r)&&Y4(a,r)&&(wd(e)||$4(e)))}var gOe=mOe;function vOe(e,t){return e!=null&&gOe(e,t,pOe)}var yOe=vOe,xOe=function(){return rh.Date.now()},bI=xOe,bOe="Expected a function",SOe=Math.max,_Oe=Math.min;function AOe(e,t,i){var n,r,s,a,o,l,c=0,u=!1,h=!1,d=!0;if(typeof e!="function")throw new TypeError(bOe);t=Bj(t)||0,th(i)&&(u=!!i.leading,h="maxWait"in i,s=h?SOe(Bj(i.maxWait)||0,t):s,d="trailing"in i?!!i.trailing:d);function p(T){var I=n,R=r;return n=r=void 0,c=T,a=e.apply(R,I),a}function g(T){return c=T,o=setTimeout(b,t),u?p(T):a}function x(T){var I=T-l,R=T-c,O=t-I;return h?_Oe(O,s-R):O}function y(T){var I=T-l,R=T-c;return l===void 0||I>=t||I<0||h&&R>=s}function b(){var T=bI();if(y(T))return A(T);o=setTimeout(b,x(T))}function A(T){return o=void 0,d&&n?p(T):(n=r=void 0,a)}function w(){o!==void 0&&clearTimeout(o),c=0,n=l=r=o=void 0}function E(){return o===void 0?a:A(bI())}function D(){var T=bI(),I=y(T);if(n=arguments,r=this,l=T,I){if(o===void 0)return g(l);if(h)return clearTimeout(o),o=setTimeout(b,t),p(l)}return o===void 0&&(o=setTimeout(b,t)),a}return D.cancel=w,D.flush=E,D}var _w=AOe;function wOe(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}var MOe=wOe;function EOe(e,t){return e>t}var TOe=EOe;function COe(e,t){return t.length<2?e:qZ(e,f3e(t,0,-1))}var DOe=COe;function ROe(e,t){return dOe(e,t)}var o5=ROe;function POe(e,t,i){for(var n=-1,r=e.length;++n<r;){var s=e[n],a=t(s);if(a!=null&&(o===void 0?a===a&&!uM(a):i(a,o)))var o=a,l=s}return l}var OOe=POe;function BOe(e){return e&&e.length?OOe(e,NZ,TOe):void 0}var IOe=BOe;function LOe(e,t){return t=Ub(t,e),e=DOe(e,t),e==null||delete e[ZR(MOe(t))]}var UOe=LOe;function NOe(e){return h3e(e)?void 0:e}var zOe=NOe,FOe=1,VOe=2,HOe=4,GOe=QZ(function(e,t){var i={};if(e==null)return i;var n=!1;t=LZ(t,function(s){return s=Ub(s,e),n||(n=s.length>1),s}),hM(e,t$(e),i),n&&(i=s$(i,FOe|VOe|HOe,zOe));for(var r=t.length;r--;)UOe(i,t[r]);return i}),sN=GOe;function kOe(e,t,i,n){if(!th(e))return e;t=Ub(t,e);for(var r=-1,s=t.length,a=s-1,o=e;o!=null&&++r<s;){var l=ZR(t[r]),c=i;if(l==="__proto__"||l==="constructor"||l==="prototype")return e;if(r!=a){var u=o[l];c=n?n(u,l,o):void 0,c===void 0&&(c=th(u)?u:Y4(t[r+1])?[]:{})}K4(o,l,c),o=o[l]}return e}var jOe=kOe;function WOe(e,t,i){for(var n=-1,r=t.length,s={};++n<r;){var a=t[n],o=qZ(e,a);i(o,a)&&jOe(s,Ub(a,e),o)}return s}var XOe=WOe;function qOe(e,t){return XOe(e,t,function(i,n){return yOe(e,n)})}var YOe=qOe,QOe=QZ(function(e,t){return e==null?{}:YOe(e,t)}),gd=QOe,KOe="Expected a function";function JOe(e,t,i){var n=!0,r=!0;if(typeof e!="function")throw new TypeError(KOe);return th(i)&&(n="leading"in i?!!i.leading:n,r="trailing"in i?!!i.trailing:r),_w(e,t,{leading:n,maxWait:t,trailing:r})}var ZOe=JOe;function l$(e){for(let t of Object.keys(e))e[t]===void 0&&delete e[t];return e}function $c(e,t){return Object.setPrototypeOf(e,t),e}var $Oe=()=>typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().includes(" electron/"),eBe=()=>typeof window>"u"?!1:window.navigator.platform.toUpperCase().includes("MAC"),tBe=()=>typeof window>"u"?!1:/iPad|iPhone|iPod/.test(window.navigator.userAgent)||eP&&"ontouchend"in document,iBe=()=>typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1,nBe=()=>typeof window>"u"?!1:"ontouchstart"in window||navigator.maxTouchPoints>0,rBe=()=>{if(typeof window>"u")return!1;let e=navigator.userAgent,t=navigator.vendor;return/Safari/i.test(e)&&/Apple Computer/.test(t)},sBe=()=>{if(typeof window>"u")return null;let e=navigator.userAgent.match(/Version\/(\d+\.\d)/);return e&&e[1]},aBe=()=>{if(typeof window>"u")return;let e=new URLSearchParams(window.location.search).get("desktop-app-version");return e?(window.localStorage.setItem("desktop-app-version",e),e):window.localStorage.getItem("desktop-app-version")??"0.0.6"},c$=$Oe();c$&&aBe();var eP=eBe(),dM=tBe(),oBe=iBe(),ec=nBe(),a9=rBe(),lBe=Number(sBe());function u$(e){return Array.isArray(e)?e:[e]}function h$(e,t){let i=0;for(;i<e.length&&i<t.length;){if(e[i]<t[i])return-1;if(e[i]>t[i])return 1;i+=1}return i!==t.length?-1:i!==e.length?1:0}function DT(e){return eP?e.metaKey:e.ctrlKey}function cBe(e){return e.wheelDeltaY===0||e.deltaY===0?eP&&e.shiftKey&&Math.abs(e.wheelDeltaX)>=120?!1:e.wheelDeltaX?e.wheelDeltaX===-3*e.deltaX||e.wheelDeltaX===-3*window.devicePixelRatio*e.deltaX:e.deltaMode===0:e.wheelDeltaY?e.wheelDeltaY===-3*e.deltaY||e.wheelDeltaY===-3*window.devicePixelRatio*e.deltaY:e.deltaMode===0}var Si=[],f3={},lA={},zC={};function d$(e){Si.includes(e)||Si.push(e)}function T1(e){delete f3[e.pointerId];for(let t=0;t<Si.length;t++)if(Si[t].pointerId===e.pointerId){Si.splice(t,1);break}}function uBe(){Si.splice(0,Si.length)}function p3(e){if(e.pointerType!=="touch")return;let t=f3[e.pointerId];t===void 0&&(t={x:0,y:0},f3[e.pointerId]=t),t.x=e.pageX,t.y=e.pageY}function SI(e){let t=e.pointerId===Si[0].pointerId?Si[1]:Si[0];return f3[t.pointerId]}function f$(e){lA[e.key]=!0,zC[e.key]=zC[e.key]===void 0?1:zC[e.key]+1}function p$(e){if(eP&&lA.Meta)for(let t in lA)lA[t]=!1;else lA[e.key]=!1;zC={}}function hBe(e){e.addEventListener("pointerdown",d$,!0),e.addEventListener("pointerdown",p3,!0),e.addEventListener("pointermove",p3,!0),e.addEventListener("pointerup",T1,!0),e.addEventListener("pointercancel",T1,!0),e.addEventListener("pointerleave",T1,!0),window.addEventListener("keydown",f$,!0),window.addEventListener("keyup",p$,!0)}function dBe(e){e.removeEventListener("pointerdown",d$,!0),e.removeEventListener("pointerdown",p3,!0),e.removeEventListener("pointermove",p3,!0),e.removeEventListener("pointerup",T1,!0),e.removeEventListener("pointercancel",T1,!0),e.removeEventListener("pointerleave",T1,!0),window.removeEventListener("keydown",f$,!0),window.removeEventListener("keyup",p$,!0)}var m$,fBe=new Promise(e=>{m$=e}),RT;function pBe(){if(RT)return RT;async function e(){let t="https://unpkg.com/@splinetool/navmesh-wasm@1.10.2/build",i=dg(()=>import("./navmesh-BFd9Mv4x.js"),[]),[n,r]=await Promise.all([i,fetch(`${t}/navmesh.wasm`).then(o=>o.arrayBuffer())]),s=n.default,a=await s({wasmBinary:r});m$(a)}return RT=e(),RT}var g$,mBe=new Promise(e=>{g$=e}),PT;function gBe(){if(PT)return PT;async function e(){let t=await dg(()=>import("./physics-BM4kW-A5.js"),[]);await t.init(),g$(t)}return PT=e(),PT}var mi=class{modifyById(e,t){let i=this;if(i[e]===void 0)throw new Error("not expected");{let n={...i,[e]:t};return Object.setPrototypeOf(n,mi.prototype),n}}add(e,t){var i;return((i=this.runOp({type:1,id:e,data:t}))==null?void 0:i.data)??this}runOp(e){let t=this;if(e.type===1){let i=t[e.id],n;i===void 0?n={type:2,id:e.id}:n={type:1,id:e.id,data:i};let{id:r,data:s}=e,a={...t,[r]:s};return Object.setPrototypeOf(a,mi.prototype),{data:a,actual:e,reverse:n}}else if(e.type===2){let{id:i}=e,n=t[i];if(n===void 0)return null;{let r={...t};return Object.setPrototypeOf(r,mi.prototype),delete r[i],{data:r,actual:e,reverse:{type:1,id:i,data:n}}}}return null}};function l5(e){if(e.deepFreeze!==void 0){e.deepFreeze(e);return}let t=Object.getOwnPropertyNames(e);for(let i of t){let n=e[i];n&&typeof n=="object"&&l5(n)}return Object.freeze(e)}function vBe(e,t){let i=0;for(;i<e.length&&i<t.length;){if(e[i]<t[i])return-1;if(e[i]>t[i])return 1;i+=1}return i!==t.length?-1:i!==e.length?1:0}var v$=class extends Error{};function _I(e){let t={...e};return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}function Um(e,t,i){if(e===void 0?t===void 0?(e=0,t=10):e=t-10:t===void 0&&(t=e+10),e>t){let s=e;e=t,t=s}let n=[],r=1/(i+1);for(let s=0;s<i;s++){let a=e+(t-e)*(s+.75+Math.random()*.5)*r;n.push(a)}return n}function c5(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array}function yBe(){return typeof process<"u"}function y$(e,t){for(let i of e)t(i.id,i.data)!==!0&&y$(i.children,t)}function x$(e,t){if(t(e.id,e.data)!==!0)for(let i of e.children)x$(i,t)}var Wa=class extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,Wa.prototype)}deepFreeze(){let e=0;for(;e<this.length;)l5(this[e]),e++}fillCaches0(e,t){this.objCaches.set(e.id,e),this.parentCaches.set(e.id,t);for(let i of e.children)this.fillCaches0(i,e.id)}fillCaches(){if(this.objCaches===void 0){this.objCaches=new Map,this.parentCaches=new Map;for(let e of this)this.fillCaches0(e,null)}}randomId(){this.fillCaches();let e=Array.from(this.objCaches.keys());if(e.length!==0)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}nonExistOrDescendantOf(e,t){if(!this.has(e))return!0;for(;e;){let i=this.parent(e);if(i===t)return!0;e=i}return!1}rootAcestor(e){for(;e;){let t=this.parent(e);if(t)e=t;else return e}return e}isDescendantOf(e,t){for(;e;){let i=this.parent(e);if(i===t)return!0;e=i}return!1}data(e){var t;return(t=this.get(e))==null?void 0:t.data}has(e){return this.childrenOf(e)!==void 0}get(e){return this.fillCaches(),this.objCaches.get(e)}childrenOf(e){var t;return e===null?this:(t=this.get(e))==null?void 0:t.children}traverseFrom(e,t){if(e===null)this.traverse(t);else{let i=this.get(e);i&&x$(i,t)}}traverse(e){y$(this,e)}totalSize(){return this.fillCaches(),this.objCaches.size}parent(e){return this.fillCaches(),this.parentCaches.get(e)}childrenArray(e){return e===null?this:this.get(e).children}modifyById(e,t){if(this.get(e)===void 0)throw new Error("not expected");{let i=this.parent(e),n=this.childrenArray(i),r=n.findIndex(a=>a.id===e);if(r<0)throw new Error("not expected");let s=n[r];return n=[...n],n[r]={...s,data:t},this.modifyArrayBy(i,n)}}modifyArrayBy(e,t){let i=e,n=t;for(;i!==null;){let s=n,a=i;if(i=this.parent(i),i===void 0)throw new Error;n=this.childrenArray(i);let o=n.findIndex(l=>l.id===a);if(o<0)throw new Error;n=[...n],n[o]={...n[o],children:s}}Object.setPrototypeOf(n,Wa.prototype);let r=n;return r.fillCaches(),r}runOp(e){switch(e.type){case 7:return this.addOp(e);case 8:return this.deleteOp(e);case 9:return this.moveOp(e)}return null}checkDuplicatedIdRec({id:e,children:t}){if(this.get(e)!==void 0)return!0;for(let i of t)if(this.checkDuplicatedIdRec(i))return!0;return!1}addOp(e){let{parent:t,fi:i,id:n,data:r,children:s}=e;if(t!==null&&this.get(t)===void 0||this.checkDuplicatedIdRec(e))return null;{let a=t,o=this.childrenArray(a),l={fi:i,id:n,data:r,children:s};return o=[...o,l],o.sort((c,u)=>c.fi-u.fi),e.localIndex=o.indexOf(l),{data:this.modifyArrayBy(a,o),actual:e,reverse:{type:8,id:n}}}}deleteOp(e){let{id:t}=e;if(this.get(t)===null)return null;{let i=this.parent(t);if(i===void 0)return null;let n=this.childrenArray(i),r=n.findIndex(a=>a.id===t);e.localIndex=r,n=[...n];let s=n.splice(r,1)[0];return{data:this.modifyArrayBy(i,n),actual:e,reverse:{type:7,...s,parent:i}}}}moveOp(e){let{parent:t,fi:i,id:n}=e;if(t!==null&&this.get(t)===void 0)return this.deleteOp({type:8,id:n});if(t!==null){let h=t;for(;h!==null;){if(h===void 0)throw new Error;if(h===n)throw new v$("cyclic tree");h=this.parent(h)}}let r=this.parent(n);if(r===void 0)return null;let s=r,a=this.childrenArray(r),o=a.findIndex(h=>h.id===n);a=[...a];let l=a.splice(o,1)[0],c=this.modifyArrayBy(r,a);r=t,a=c.childrenArray(r);let u=l.fi;return l={...l,fi:i},a=[...a,l],a.sort((h,d)=>h.fi-d.fi),e.localIndex=a.indexOf(l),c=c.modifyArrayBy(r,a),{data:c,actual:e,reverse:{type:9,parent:s,fi:u,id:n}}}previous(e,t){if(t===null){let n=this.childrenArray(e);return n.length===0?null:n[n.length-1].id}let i=null;for(let n of this.childrenArray(e)){if(n.id===t)return i;i=n.id}return null}traverseSortNext(e){let t=this.parent(e);if(t!==void 0){let i=this.childrenArray(t),n=i.findIndex(r=>r.id===e)+1;if(n<i.length)return i[n].id;if(t)return this.traverseSortNext(t)}}sortNext(e){let t=this.childrenArray(e);return t.length>0?t[0].id:this.traverseSortNext(e)}traverseSortPrevious(e){let t=this.childrenArray(e);return t.length>0?this.traverseSortPrevious(t[t.length-1].id):e}sortPrevious(e){let t=this.parent(e);if(t!==void 0){let i=this.childrenArray(t),n=i.findIndex(r=>r.id===e)-1;return n>=0?this.traverseSortPrevious(i[n].id):t}}getAllSorted(e){let t=[];for(let i of e){let n=this.getWithSortKey(i.id);n!==void 0&&t.push({...i,...n})}t.sort((i,n)=>vBe(i.sortKey,n.sortKey));for(let i of t)delete i.sortKey;return t}getWithSortKey(e){var t=e;let i=[],n=this.get(t),r=n;if(n!==void 0){for(;t;)i.splice(0,0,n.fi),t=this.parent(t),t!==null&&(n=this.get(t));return{...r,sortKey:i}}}insertBeforeHelper(e,t,i){return this.insertAfterHelper(e,this.previous(e,t),i)}insertAfterHelper(e,t,i){let n=this.childrenArray(e);if(t===null){if(n.length===0)return Um(0,i,i);{let r=n[0].fi;return Um(r-i,r,i)}}else{let r=this.get(t);if(r===void 0||this.parent(t)!==e)throw new Error("illegal args");let s=n.find(a=>a.fi>r.fi);if(s===void 0){let a=n[n.length-1].fi;return Um(a,a+i,i)}else return Um(r.fi,s.fi,i)}}},m3;(e=>{function t(i,n){if(n.type!==0)return null;if(Array.isArray(i)){let r=n.props,s={},a=[...i],o=!1;if(r)for(let l of Object.keys(r)){let c=parseInt(l);if(isNaN(c))throw new Error("wrong index");s[l]=a[c],a[c]=r[l],o=!0}return o?{data:a,actual:n,reverse:{type:0,props:s}}:null}else{let r=n.props,s={},a={...i},o=!1;if(r)for(let l of Object.keys(r)){s[l]=a[l];let c=r[l];c===void 0?delete a[l]:a[l]=c,o=!0}return o?{data:a,actual:n,reverse:{type:0,props:s}}:null}}e.runOp=t})(m3||(m3={}));var ri=class extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,ri.prototype)}deepFreeze(){let e=0;for(;e<this.length;)l5(this[e]),e++}fillCaches0(e){this.objCaches.set(e.id,e)}fillCaches(){if(this.objCaches===void 0){this.objCaches=new Map,Object.getOwnPropertyDescriptor(this,"objCaches").enumerable=!1;for(let e of this)this.fillCaches0(e)}}randomId(){this.fillCaches();let e=Array.from(this.objCaches.keys());if(e.length!==0)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}data(e){var t;return(t=this.get(e))==null?void 0:t.data}get(e){return this.fillCaches(),this.objCaches.get(e)}modifyById(e,t){if(this.get(e)===void 0)throw new Error("not expected");{let i=this,n=i.findIndex(s=>s.id===e);if(n<0)throw new Error("not expected");let r=i[n];return i=[...i],i[n]={...r,data:t},this.modifyArrayBy(i)}}modifyArrayBy(e){Object.setPrototypeOf(e,ri.prototype);let t=e;return yBe()||t.fillCaches(),t}runOp(e){switch(e.type){case 4:return this.addOp(e);case 5:return this.deleteOp(e);case 6:return this.moveOp(e)}return null}addOp(e){let{fi:t,id:i,data:n}=e,r=this,s={fi:t,id:i,data:n};return r=[...r,s],r.sort((a,o)=>a.fi-o.fi),e.localIndex=r.indexOf(s),{data:this.modifyArrayBy(r),actual:e,reverse:{type:5,id:i}}}deleteOp(e){let{id:t}=e,i=this,n=i.findIndex(s=>s.id===t);if(n===-1)return null;e.localIndex=n,i=[...i];let r=i.splice(n,1)[0];return{data:this.modifyArrayBy(i),actual:e,reverse:{type:4,...r}}}moveOp(e){let{fi:t,id:i}=e,n=this;n=[...n];let r=n.findIndex(o=>o.id===i);if(r===-1)return null;let s=n[r].fi,a={...n[r],fi:t};return n[r]=a,n.sort((o,l)=>o.fi-l.fi),e.localIndex=n.indexOf(a),{data:this.modifyArrayBy(n),actual:e,reverse:{type:6,fi:s,id:i}}}previous(e){if(e===null)return this.length===0?null:this[this.length-1].id;let t=null;for(let i of this){if(i.id===e)return t;t=i.id}return null}insertBeforeHelper(e,t){return this.insertAfterHelper(this.previous(e),t)}insertAfterHelper(e,t){let i=this;if(e===null){if(i.length===0)return Um(0,t,t);{let n=i[0].fi;return Um(n-t,n,t)}}else{let n=this.get(e);if(n===void 0)throw new Error("illegal args");let r=i.find(s=>s.fi>n.fi);if(r===void 0){let s=i[i.length-1].fi;return Um(s,s+t,t)}else return Um(n.fi,r.fi,t)}}};function nb(e){return e&&typeof e=="object"&&e instanceof Ps}var Ps=class{unusedFunOverridesTable(e){}runOp(e){let t=[],i=this,n=0,r={};for(;n<e.path.length;){if(t.push(i),i=i===void 0?void 0:i[e.path[n]],i!==void 0&&!nb(i))return null;n+=1}i=i?_I(i):new Ps;for(let[o,l]of Object.entries(e.props)){let c=i[o];r[o]=c,l===void 0?delete i[o]:i[o]=l}for(;n>0;){if(Object.keys(i).length===0){let o=t[n-1];o&&(i=_I(o),delete i[e.path[n-1]])}else{let o=t[n-1];if(o){let l=_I(o);l[e.path[n-1]]=i,i=l}else{let l=new Ps;l[e.path[n-1]]=i,i=l}}n-=1}let s=Object.setPrototypeOf(i,Ps.prototype),a={...e,props:r};return{data:s,actual:e,reverse:a}}},Xm;(e=>{function t(r,s){return Aw(r,s)??r}e.apply=t;function i(r,s){return h5(r,s)}e.merge=i;function n(r,s){let a=0,o=s.path,l=r;for(;a<o.length&&l!==void 0;){if(l=Ys.zoomOnce(l,o[a]),l===void 0)return s;if(!nb(l))return;a+=1}if(l===void 0)return s;if(nb(l))if(s.type===0){let c={...s.props};for(let u of Object.keys(l))delete c[u];return{...s,props:c}}else if(s.type===1||s.type===4||s.type===7){let c=u5([s],l);return c?(console.log(c),c):s}else return s}e.filterOp=n})(Xm||(Xm={}));function u5(e,t){if(t===void 0)return;let i=!1,n=e.map(r=>{let s=r.id,a=Aw(r.data,t[s]);if(i=i||a!==void 0,a===void 0&&(a=r.data),r.children){let o=u5(r.children,t);return o!==void 0?i=!0:o=r.children,{...r,id:s,data:a,children:o}}else return{...r,id:s,data:a}});if(i)return n}function xBe(e,t){if(t===void 0)return;let i=!1,n=e.map(r=>{let s=r.id,a=Aw(r.data,t[s]);return i=i||a!==void 0,a===void 0&&(a=r.data),{...r,id:s,data:a}});if(i)return Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n}function Aw(e,t){if(!nb(t))return t;if(e instanceof Wa){let i=u5(e,t);return i!==void 0&&Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i}else{if(e instanceof ri)return xBe(e,t);if(Array.isArray(e)){let i=!1,n=e.map((r,s)=>{let a=Aw(r,t[s]);return i=i||a!==void 0,a===void 0&&(a=r),a});return i?(Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n):void 0}else{if(e instanceof Ps)return h5(e,t);if(e&&typeof e=="object"){let i={},n=!1;for(let[r,s]of Object.entries(e)){let a=Aw(s,t[r]);n=n||a!==void 0,a===void 0&&(a=s),i[r]=a}return n?(Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i):void 0}}}}function h5(e,t){if(e===void 0)return t;if(t===void 0)return e;if(!nb(t))return t;if(!nb(e))return Xm.apply(e,t);let i=new Set;for(let r of Object.keys(e))i.add(r);for(let r of Object.keys(t))i.add(r);let n=new Ps;for(let r of i){let s=h5(e===void 0?void 0:e[r],t===void 0?void 0:t[r]);n[r]=s}return n}function bBe(e,t){let i={cur:[],result:[],len:0};return e=ww(e,t,i)??e,[e,i.result]}function g3(e,t){return e===null?null:(e.cur[e.len]=t,e.len+=1,e)}function v3(e){e&&(e.len-=1)}function SBe(e){if(e===null)return null;e.result.push(e.cur.slice(0,e.len))}function b$(e,t,i){let n=!1,r=e.map(s=>{let a=s.id,o=t[a];if(o!==void 0&&typeof o=="string"&&(n=!0,a=o,i!==null))throw new Error("not supported");let l=ww(s.data,t,g3(i,a));v3(i),n=n||l!==void 0,l===void 0&&(l=s.data);let c=b$(s.children,t,i);return c!==void 0?n=!0:c=s.children,{...s,id:a,data:l,children:c}});if(n)return r}function _Be(e,t,i){let n=!1,r=e.map(s=>{let a=s.id,o=t[a];if(o!==void 0&&typeof o=="string"&&(n=!0,a=o,i!==null))throw new Error("not supported");let l=ww(s.data,t,g3(i,a));return v3(i),n=n||l!==void 0,l===void 0&&(l=s.data),{...s,id:a,data:l}});if(n)return Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r}function ww(e,t,i){if(e instanceof Wa){let n=b$(e,t,i);return n!==void 0&&Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n}else{if(e instanceof ri)return _Be(e,t,i);if(Array.isArray(e)){let n=!1,r=e.map((s,a)=>{let o=ww(s,t,g3(i,a));return v3(i),n=n||o!==void 0,o===void 0&&(o=s),o});return n?(Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r):void 0}else if(e&&typeof e=="object"&&!c5(e)){let n={},r=!1;for(let[s,a]of Object.entries(e))if(s!=="name"&&s!=="variableId"){let o=t[s];if(typeof o=="string"){if(i!==null)throw new Error("not supported");r=!0,s=o}let l=ww(a,t,g3(i,s));v3(i),r=r||l!==void 0,l===void 0&&(l=a),n[s]=l}else n[s]=a;return r?(Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n):void 0}else if(typeof e=="string"){let n=t[e];return n!==void 0&&SBe(i),n}else return}}var y3;(e=>{function t(i,n){let r=Ys.zoom(n,i.path);if(typeof r=="object"){let s={};for(let a of Object.keys(i.props))s[a]=r[a];return{...i,props:s}}else return{...i,props:{}}}e.replaceProps=t})(y3||(y3={}));var ma;(e=>{function t(l,c){return{...l,path:l.path.slice(c)}}e.drop=t;function i(l,c){var u;return((u=n(l,c))==null?void 0:u.data)??l}e.applySimple=i;function n(l,c){var d,p;let u=c.path;for(var h=[];;){let g;if(l instanceof Ps&&c.type===0&&(g=l.runOp({...c,path:u.slice(h.length)}),g===null&&(g=void 0)),g===void 0&&h.length===u.length&&(l instanceof Wa||l instanceof ri||l instanceof mi?g=l.runOp(c):g=m3.runOp(l,c)),g!==void 0)if(g!==null){let b=g.data;for(let A=h.length-1;A>=0;A--){let w=u[A],E=h[A];if(E instanceof Wa){if(typeof w=="number")throw new Error("illegal arg");b=E.modifyById(w,b)}else if(E instanceof ri){if(typeof w=="number")throw new Error("illegal arg");b=E.modifyById(w,b)}else if(E instanceof mi){if(typeof w=="number")throw new Error("illegal arg");b=E.modifyById(w,b)}else if(E instanceof Ps){let D={...E,[w]:b};b=Object.setPrototypeOf(D,Ps.prototype)}else if(typeof E=="object")if(Array.isArray(E)){if(typeof w=="string"&&(w=parseInt(w),isNaN(w)))throw new Error("Invalid path");let D=b;b=[...E],b[w]=D}else b={...E,[w]:b};else return null}return{data:b,actual:{...g.actual,path:u},reverse:{...g.reverse,path:u}}}else return null;let x=u[h.length],y;if(l instanceof Wa){if(typeof x=="number")throw new Error("");y=(d=l.get(x))==null?void 0:d.data}else if(l instanceof ri){if(typeof x=="number")throw new Error("");y=(p=l.get(x))==null?void 0:p.data}else l!==null&&(y=l[x]);if(y!==void 0)h.push(l),l=y;else return null}}e.apply=n;function r(l,c){for(let u=0;u<l.length&&u<c.length;u++)if(l[u]!==c[u])return!0;return!1}e.pathDisjoint=r;function s(l,c){if(l.length!==c.length)return!1;for(let u=0;u<l.length;u++)if(l[u]!==c[u])return!1;return!0}e.pathEq=s;function a(l,c){return r(l.path,c.path)}e.commutative=a;function o(l,c){return l.type===0&&c.type===0&&s(l.path,c.path)?Object.keys(l.props).every(u=>c.props[u]!==void 0):!1}e.subsumed=o})(ma||(ma={}));var aN;(e=>{function t(){return[]}e.empty=t;function i(c,u){let h=[];for(let d of c){let[p,...g]=d.path;p===u&&h.push({...d,path:g})}return h}e.removePrefix=i;function n(c,u){return c.map(h=>({...h,path:[u,...h.path]}))}e.addPrefix=n;function r(c,u){return[...c,...u]}e.concat=r;function s(c,u){return[...c.filter(h=>!u.some(d=>ma.subsumed(h,d))),...u]}e.compress=s;function a(c,u){return c.every(h=>u.every(d=>ma.commutative(h,d)))}e.commutative=a;function o(c,u){for(let h of u){let d=l(c,h);d!==null&&(c=d.data)}return c}e.applyAll=o;function l(c,u){var h=c;let d=[],p=[];for(let g of u)try{if(g.type===3||g.type===5&&g.path[g.path.length-1]==="variables"){let x,y,b;if(g.type===3?(x=Ys.zoom(h,[...g.path,g.id]),b=ma.apply(h,{...g,type:2})):(x=Ys.zoom(h,[...g.path,g.id,"value"]),b=ma.apply(h,g)),b!==null){h=b.data;let[A,w]=bBe(h,{[g.id]:x});h=A;for(let E=0;E<w.length;E++){let D=w[E],T=D.pop();if(typeof T=="number"){let I=[T];for(let O=E+1;O<w.length;O++){let P=w[O],U=P[P.length-1];if(typeof U=="number"&&Ys.equal(D,P.slice(0,P.length-1)))I.push(U),w.splice(O,1);else break}let R=Ys.zoom(h,D);y=R.map((O,P)=>I.includes(P)?g.id:O),x=R,T=D.pop()}else{if(T==="alphaOverride"||T==="alpha"){x/=100;let I=x,R=Ys.zoom(h,D.slice(0,D.length-2)),O=R.layers.map(P=>P.id===D[D.length-1]?{...P,data:{...P.data,[T]:I}}:P);Object.setPrototypeOf(O,Object.getPrototypeOf(R.layers)),R.layers=O}y=g.id}d.push({type:0,path:D,props:{[T]:x}}),p.push({type:0,path:D,props:{[T]:y}})}p.push(b.reverse),d.push(b.actual)}}else{let x=ma.apply(h,g);x!==null&&(d.push(x.actual),h=x.data,p.push(x.reverse))}}catch(x){if(x instanceof v$)return null;throw x}return{data:h,actual:d,reverse:p.reverse()}}e.apply=l})(aN||(aN={}));var S$=Symbol(),ABe=Symbol(),tP=Symbol(),fM=class{reportOp(e,t,i=[]){let n=this;if(t===null)return;n._current=t.data;let r=i;for(;!(n instanceof A$);){let s=n._path,a=n._current;if(s!==""&&r.splice(0,0,s),n=n._parent,n===null)return;n.update(s,a)}n.push(r,e,t.actual,t.reverse)}deleteChildren(e){if(this._children){let t=this._children[e];if(t){let i=t[tP];i&&i(),delete this._children[e]}}}},wBe=class extends fM{constructor(e,t,i){super(),this._parent=e,this._path=t,this._current=i}update(e,t){if(Array.isArray(this._current)){if(typeof e=="string"&&(e=parseInt(e),isNaN(e)))throw new Error("Invalid path");this._current=[...this._current],this._current[e]=t}else this._current={...this._current,[e]:t}}runOp(e){this.reportOp(e,m3.runOp(this._current,e),e.path)}},MBe=class extends fM{constructor(e,t,i){super(),this._parent=e,this._path=t,this._current=i}update(e,t){this._current={...this._current,[e]:t},Object.setPrototypeOf(this._current,mi.prototype)}runOp(e){this.reportOp(e,this._current.runOp(e))}},_$={get(e,t){if(t===tP)return()=>{e._parent=null};if(t===S$)return e._current;if(t===ABe)return e;let{_current:i,_children:n}=e;if(t==="push"&&Array.isArray(i))throw new Error("not supported to expand array");let r=n===void 0?void 0:n[t];if(r!==void 0)return r;let s=i[t],a=iP(e,t,s);return a!==s?(n===void 0&&(n={},e._children=n),n[t]=a,a):s},has(e,t){return t in e._current},ownKeys(e){return Reflect.ownKeys(e._current)},defineProperty(){throw Error("not supported")},getPrototypeOf(e){return Object.getPrototypeOf(e._current)},setPrototypeOf(){throw Error("not supported")},getOwnPropertyDescriptor(e,t){let i=e._current,n=Reflect.getOwnPropertyDescriptor(i,t);return n&&{writable:!0,configurable:!0,enumerable:n.enumerable,value:i[t]}}},EBe={..._$,set(e,t,i){let n={type:0,props:{[t]:ds(i)??i}};return e.deleteChildren(t),e.runOp(n),!0},deleteProperty(e,t){let i={type:0,props:{[t]:void 0}};return e.deleteChildren(t),e.runOp(i),!0}},TBe={..._$,set(e,t,i){return i===void 0?this.deleteProperty(e,t):(e.deleteChildren(t),e.runOp({type:1,id:t,data:i})),!0},deleteProperty(e,t){return e.runOp({type:2,id:t}),!0}},d5=class extends fM{constructor(e,t,i){super(),this._children={},this._parent=e,this._path=t,this._current=i,this[tP]=()=>{this._parent=null}}unproxy(){return this._current}update(e,t){this._current=this._current.modifyById(e,t)}runOp(e){this.reportOp(e,this._current.runOp(e))}randomId(){return this._current.randomId()}isDescendantOf(e,t){return this._current.isDescendantOf(e,t)}childrenOf(e){return this._current.childrenOf(e)}traverse(e){return this._current.traverse(e)}get(e){return this._current.get(e)}parent(e){return this._current.parent(e)}traverse(e){this._current.traverse((t,i)=>{e(t,this.data(t))})}data(e){var a;let{_current:t,_children:i}=this,n=i===void 0?void 0:i[e];if(n!==void 0)return n;let r=(a=t.get(e))==null?void 0:a.data,s=iP(this,e,r);return s!==r?(i===void 0&&(i={},this._children=i),i[e]=s,s):r}add(e,t,i,n,r){this.runOp({type:7,parent:e,fi:t,id:i,data:n,children:r})}move(e,t,i){this.runOp({type:9,parent:e,fi:t,id:i})}insertAfter(e,t,i){let n=this._current.insertAfterHelper(e,t,i.length);for(let r=0;r<i.length;r++){let s=i[r];this.add(e,n[r],s.id,s.data,s.children)}}insertBefore(e,t,i){let n=this._current.insertBeforeHelper(e,t,i.length);for(let r=0;r<i.length;r++){let s=i[r];this.add(e,n[r],s.id,s.data,s.children)}}moveAfter(e,t,i){let n=this._current.insertAfterHelper(e,t,i.length);for(let r=0;r<i.length;r++){let s=i[r];this.move(e,n[r],s)}}moveBefore(e,t,i){let n=this._current.insertBeforeHelper(e,t,i.length);for(let r=0;r<i.length;r++){let s=i[r];this.move(e,n[r],s)}}delete(e){this.deleteChildren(e),this.runOp({type:8,id:e})}sortNext(e){return this._current.sortNext(e)}sortPrevious(e){return this._current.sortPrevious(e)}getAllSorted(e){return this._current.getAllSorted(e)}},f5=class extends fM{constructor(e,t,i){super(),this._children={},this._parent=e,this._path=t,this._current=i,this[tP]=()=>{this._parent=null}}unproxy(){return this._current}get length(){return this._current.length}forEach(e){let t=this.length;for(let i=0;i<t;i++){let n=this._current[i].id,r=this._current[i].fi;e(this.data(this._current[i].id),n,r)}}find(e){let t=this.length;for(let i=0;i<t;i++){let n=this._current[i].id;if(e(this.data(n),n))return this.get(n)}}update(e,t){this._current=this._current.modifyById(e,t)}randomId(){return this._current.randomId()}get(e){return{...this._current.get(e),data:this.data(e)}}data(e){var a;let{_current:t,_children:i}=this,n=i===void 0?void 0:i[e];if(n!==void 0)return n;let r=(a=t.get(e))==null?void 0:a.data,s=iP(this,e,r);return s!==r?(i===void 0&&(i={},this._children=i),i[e]=s,s):r}runOp(e){this.reportOp(e,this._current.runOp(e))}add(e,t,i){this.runOp({type:4,fi:e,id:t,data:i})}move(e,t){this.runOp({type:6,fi:e,id:t})}insertAfter(e,t){let i=this._current.insertAfterHelper(e,t.length);for(let n=0;n<t.length;n++){let r=t[n];this.add(i[n],r.id,r.data)}}insertBefore(e,t){let i=this._current.insertBeforeHelper(e,t.length);for(let n=0;n<t.length;n++){let r=t[n];this.add(i[n],r.id,r.data)}}moveAfter(e,t){let i=this._current.insertAfterHelper(e,t.length);for(let n=0;n<t.length;n++){let r=t[n];this.move(i[n],r)}}moveBefore(e,t){let i=this._current.insertBeforeHelper(e,t.length);for(let n=0;n<t.length;n++){let r=t[n];this.move(i[n],r)}}delete(e){this.deleteChildren(e),this.runOp({type:5,id:e})}};function AI(e,t,i){if(e.length>0){let n=e[e.length-1];if(n.type===0&&t.type===0&&Ys.equal(n.path,i)){Object.assign(n.props,t.props);return}}e.push({...t,path:i})}var A$=class extends fM{constructor(e){super(),this.ts=[],this.actual=[],this.reverse=[],this._current=e}update(e,t){if(e!=="")throw new Error("");this._current=t}push(e,t,i,n){AI(this.ts,t,e),AI(this.actual,i,e),AI(this.reverse,n,e)}result(){return{data:this._current,ts:this.ts,actual:this.actual,reverse:this.reverse.reverse()}}};function iP(e,t,i){return i instanceof Wa?new d5(e,t,i):i instanceof ri?new f5(e,t,i):i instanceof mi?new Proxy(new MBe(e,t,i),TBe):i!==null&&typeof i=="object"?c5(i)?i:new Proxy(new wBe(e,t,i),EBe):i}function w$(e){let t=new A$(e);return[iP(t,"",e),t]}function Mw(e,t){let[i,n]=w$(e);return t(i),n.result()}function ds(e){return e instanceof d5||e instanceof f5?e._current:e!==null&&typeof e=="object"?e[S$]:e}var Ys;(e=>{function t(s,a){if(a.length===s.length)for(var o=0;o<s.length;){if(s[o]!==a[o])return!1;o+=1}else return!1;return!0}e.equal=t;function i(s,a,o){let l=r(o,s);if(l!==void 0&&typeof l=="object"&&l!==null){let c={...a};return Object.keys(l).forEach(u=>{delete c[u]}),c}else return a}e.removeOverridden=i;function n(s,a){if((s instanceof Wa||s instanceof d5)&&typeof a=="string"||(s instanceof ri||s instanceof f5)&&typeof a=="string")return s.data(a);if(typeof a=="number"&&Array.isArray(s)||typeof a=="string"&&typeof s=="object"&&s!==null)return s[a]}e.zoomOnce=n;function r(s,a,o=0){for(;o<a.length&&s!==void 0;)s=n(s,a[o]),o+=1;return s}e.zoom=r})(Ys||(Ys={}));function CBe(e,t){let i=[];if(t.length===e.length)for(var n=0;n<e.length;){if(t[n]==="*")i.push(e[n]);else if(e[n]!==t[n])return null;n+=1}else return null;return i}function cr(e,t){let i=[];if(t.length<=e.length)for(var n=0;n<t.length;){if(t[n]==="*")i.push(e[n]);else if(e[n]!==t[n])return null;n+=1}else return null;return i}var M$=class{},o9=class extends M${constructor(e){super(),this.id=e}},l9=class extends M${constructor(e){super(),this.data=e}},oN;try{oN=new TextDecoder}catch{}var Kt,qm,it=0,Ml={},Un,Nm,Nc=0,ad=0,Jl,Yf,il=[],Gn,c9={useRecords:!1,mapsAsObjects:!0},E$=class{},T$=new E$;T$.name="MessagePack 0xC1";var rb=!1,x3=class{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0)),Object.assign(this,e)}unpack(e,t){if(Kt)return B$(()=>(cN(),this?this.unpack(e,t):x3.prototype.unpack.call(c9,e,t)));qm=t>-1?t:e.length,it=0,ad=0,Nm=null,Jl=null,Kt=e;try{Gn=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(i){throw Kt=null,e instanceof Uint8Array?i:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof x3){if(Ml=this,this.structures)return Un=this.structures,OT();(!Un||Un.length>0)&&(Un=[])}else Ml=c9,(!Un||Un.length>0)&&(Un=[]);return OT()}unpackMultiple(e,t){let i,n=0;try{rb=!0;let r=e.length,s=this?this.unpack(e,r):rP.unpack(e,r);if(t){for(t(s);it<r;)if(n=it,t(OT())===!1)return}else{for(i=[s];it<r;)n=it,i.push(OT());return i}}catch(r){throw r.lastPosition=n,r.values=i,r}finally{rb=!1,cN()}}_mergeStructures(e,t){e=e||[];for(let i=0,n=e.length;i<n;i++){let r=e[i];r&&(r.isShared=!0,i>=32&&(r.highByte=i-32>>5))}e.sharedLength=e.length;for(let i in t||[])if(i>=0){let n=e[i],r=t[i];r&&(n&&((e.restoreStructures||(e.restoreStructures=[]))[i]=n),e[i]=r)}return this.structures=e}decode(e,t){return this.unpack(e,t)}};function OT(){try{if(!Ml.trusted&&!rb){let t=Un.sharedLength||0;t<Un.length&&(Un.length=t)}let e=Zr();if(it==qm)Un.restoreStructures&&u9(),Un=null,Kt=null,Yf&&(Yf=null);else if(it>qm){let t=new Error("Unexpected end of MessagePack data");throw t.incomplete=!0,t}else if(!rb)throw new Error("Data read, but end of buffer not reached");return e}catch(e){throw Un.restoreStructures&&u9(),cN(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer"))&&(e.incomplete=!0),e}}function u9(){for(let e in Un.restoreStructures)Un[e]=Un.restoreStructures[e];Un.restoreStructures=null}function Zr(){let e=Kt[it++];if(e<160)if(e<128){if(e<64)return e;{let t=Un[e&63]||Ml.getStructures&&C$()[e&63];return t?(t.read||(t.read=p5(t,e&63)),t.read()):e}}else if(e<144)if(e-=128,Ml.mapsAsObjects){let t={};for(let i=0;i<e;i++)t[R$()]=Zr();return t}else{let t=new Map;for(let i=0;i<e;i++)t.set(Zr(),Zr());return t}else{e-=144;let t=new Array(e);for(let i=0;i<e;i++)t[i]=Zr();return t}else if(e<192){let t=e-160;if(ad>=it)return Nm.slice(it-Nc,(it+=t)-Nc);if(ad==0&&qm<140){let i=t<16?m5(t):D$(t);if(i!=null)return i}return lN(t)}else{let t;switch(e){case 192:return null;case 193:return Jl?(t=Zr(),t>0?Jl[1].slice(Jl.position1,Jl.position1+=t):Jl[0].slice(Jl.position0,Jl.position0-=t)):T$;case 194:return!1;case 195:return!0;case 196:return wI(Kt[it++]);case 197:return t=Gn.getUint16(it),it+=2,wI(t);case 198:return t=Gn.getUint32(it),it+=4,wI(t);case 199:return Dv(Kt[it++]);case 200:return t=Gn.getUint16(it),it+=2,Dv(t);case 201:return t=Gn.getUint32(it),it+=4,Dv(t);case 202:if(t=Gn.getFloat32(it),Ml.useFloat32>2){let i=g5[(Kt[it]&127)<<1|Kt[it+1]>>7];return it+=4,(i*t+(t>0?.5:-.5)>>0)/i}return it+=4,t;case 203:return t=Gn.getFloat64(it),it+=8,t;case 204:return Kt[it++];case 205:return t=Gn.getUint16(it),it+=2,t;case 206:return t=Gn.getUint32(it),it+=4,t;case 207:return Ml.int64AsNumber?(t=Gn.getUint32(it)*4294967296,t+=Gn.getUint32(it+4)):t=Gn.getBigUint64(it),it+=8,t;case 208:return Gn.getInt8(it++);case 209:return t=Gn.getInt16(it),it+=2,t;case 210:return t=Gn.getInt32(it),it+=4,t;case 211:return Ml.int64AsNumber?(t=Gn.getInt32(it)*4294967296,t+=Gn.getUint32(it+4)):t=Gn.getBigInt64(it),it+=8,t;case 212:if(t=Kt[it++],t==114)return m9(Kt[it++]&63);{let i=il[t];if(i)return i.read?(it++,i.read(Zr())):i.noBuffer?(it++,i()):i(Kt.subarray(it,++it));throw new Error("Unknown extension "+t)}case 213:return t=Kt[it],t==114?(it++,m9(Kt[it++]&63,Kt[it++])):Dv(2);case 214:return Dv(4);case 215:return Dv(8);case 216:return Dv(16);case 217:return t=Kt[it++],ad>=it?Nm.slice(it-Nc,(it+=t)-Nc):RBe(t);case 218:return t=Gn.getUint16(it),it+=2,ad>=it?Nm.slice(it-Nc,(it+=t)-Nc):PBe(t);case 219:return t=Gn.getUint32(it),it+=4,ad>=it?Nm.slice(it-Nc,(it+=t)-Nc):OBe(t);case 220:return t=Gn.getUint16(it),it+=2,d9(t);case 221:return t=Gn.getUint32(it),it+=4,d9(t);case 222:return t=Gn.getUint16(it),it+=2,f9(t);case 223:return t=Gn.getUint32(it),it+=4,f9(t);default:if(e>=224)return e-256;if(e===void 0){let i=new Error("Unexpected end of MessagePack data");throw i.incomplete=!0,i}throw new Error("Unknown MessagePack token "+e)}}}var DBe=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function p5(e,t){function i(){if(i.count++>2){let r=e.read=new Function("r","return function(){return {"+e.map(s=>DBe.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"}}")(Zr);return e.highByte===0&&(e.read=h9(t,e.read)),r()}let n={};for(let r=0,s=e.length;r<s;r++){let a=e[r];n[a]=Zr()}return n}return i.count=0,e.highByte===0?h9(t,i):i}var h9=(e,t)=>function(){let i=Kt[it++];if(i===0)return t();let n=e<32?-(e+(i<<5)):e+(i<<5),r=Un[n]||C$()[n];if(!r)throw new Error("Record id is not defined for "+n);return r.read||(r.read=p5(r,e)),r.read()};function C$(){let e=B$(()=>(Kt=null,Ml.getStructures()));return Un=Ml._mergeStructures(e,Un)}var lN=nP,RBe=nP,PBe=nP,OBe=nP;function nP(e){let t;if(e<16&&(t=m5(e)))return t;if(e>64&&oN)return oN.decode(Kt.subarray(it,it+=e));let i=it+e,n=[];for(t="";it<i;){let r=Kt[it++];if((r&128)===0)n.push(r);else if((r&224)===192){let s=Kt[it++]&63;n.push((r&31)<<6|s)}else if((r&240)===224){let s=Kt[it++]&63,a=Kt[it++]&63;n.push((r&31)<<12|s<<6|a)}else if((r&248)===240){let s=Kt[it++]&63,a=Kt[it++]&63,o=Kt[it++]&63,l=(r&7)<<18|s<<12|a<<6|o;l>65535&&(l-=65536,n.push(l>>>10&1023|55296),l=56320|l&1023),n.push(l)}else n.push(r);n.length>=4096&&(t+=ha.apply(String,n),n.length=0)}return n.length>0&&(t+=ha.apply(String,n)),t}function d9(e){let t=new Array(e);for(let i=0;i<e;i++)t[i]=Zr();return t}function f9(e){if(Ml.mapsAsObjects){let t={};for(let i=0;i<e;i++)t[R$()]=Zr();return t}else{let t=new Map;for(let i=0;i<e;i++)t.set(Zr(),Zr());return t}}var ha=String.fromCharCode;function D$(e){let t=it,i=new Array(e);for(let n=0;n<e;n++){let r=Kt[it++];if((r&128)>0){it=t;return}i[n]=r}return ha.apply(String,i)}function m5(e){if(e<4)if(e<2){if(e===0)return"";{let t=Kt[it++];if((t&128)>1){it-=1;return}return ha(t)}}else{let t=Kt[it++],i=Kt[it++];if((t&128)>0||(i&128)>0){it-=2;return}if(e<3)return ha(t,i);let n=Kt[it++];if((n&128)>0){it-=3;return}return ha(t,i,n)}else{let t=Kt[it++],i=Kt[it++],n=Kt[it++],r=Kt[it++];if((t&128)>0||(i&128)>0||(n&128)>0||(r&128)>0){it-=4;return}if(e<6){if(e===4)return ha(t,i,n,r);{let s=Kt[it++];if((s&128)>0){it-=5;return}return ha(t,i,n,r,s)}}else if(e<8){let s=Kt[it++],a=Kt[it++];if((s&128)>0||(a&128)>0){it-=6;return}if(e<7)return ha(t,i,n,r,s,a);let o=Kt[it++];if((o&128)>0){it-=7;return}return ha(t,i,n,r,s,a,o)}else{let s=Kt[it++],a=Kt[it++],o=Kt[it++],l=Kt[it++];if((s&128)>0||(a&128)>0||(o&128)>0||(l&128)>0){it-=8;return}if(e<10){if(e===8)return ha(t,i,n,r,s,a,o,l);{let c=Kt[it++];if((c&128)>0){it-=9;return}return ha(t,i,n,r,s,a,o,l,c)}}else if(e<12){let c=Kt[it++],u=Kt[it++];if((c&128)>0||(u&128)>0){it-=10;return}if(e<11)return ha(t,i,n,r,s,a,o,l,c,u);let h=Kt[it++];if((h&128)>0){it-=11;return}return ha(t,i,n,r,s,a,o,l,c,u,h)}else{let c=Kt[it++],u=Kt[it++],h=Kt[it++],d=Kt[it++];if((c&128)>0||(u&128)>0||(h&128)>0||(d&128)>0){it-=12;return}if(e<14){if(e===12)return ha(t,i,n,r,s,a,o,l,c,u,h,d);{let p=Kt[it++];if((p&128)>0){it-=13;return}return ha(t,i,n,r,s,a,o,l,c,u,h,d,p)}}else{let p=Kt[it++],g=Kt[it++];if((p&128)>0||(g&128)>0){it-=14;return}if(e<15)return ha(t,i,n,r,s,a,o,l,c,u,h,d,p,g);let x=Kt[it++];if((x&128)>0){it-=15;return}return ha(t,i,n,r,s,a,o,l,c,u,h,d,p,g,x)}}}}}function wI(e){return Ml.copyBuffers?Uint8Array.prototype.slice.call(Kt,it,it+=e):Kt.subarray(it,it+=e)}function Dv(e){let t=Kt[it++];if(il[t])return il[t](Kt.subarray(it,it+=e));throw new Error("Unknown extension type "+t)}var p9=new Array(4096);function R$(){let e=Kt[it++];if(e>=160&&e<192){if(e=e-160,ad>=it)return Nm.slice(it-Nc,(it+=e)-Nc);if(!(ad==0&&qm<180))return lN(e)}else return it--,Zr();let t=(e<<5^(e>1?Gn.getUint16(it):e>0?Kt[it]:0))&4095,i=p9[t],n=it,r=it+e-3,s,a=0;if(i&&i.bytes==e){for(;n<r;){if(s=Gn.getUint32(n),s!=i[a++]){n=1879048192;break}n+=4}for(r+=3;n<r;)if(s=Kt[n++],s!=i[a++]){n=1879048192;break}if(n===r)return it=n,i.string;r-=3,n=it}for(i=[],p9[t]=i,i.bytes=e;n<r;)s=Gn.getUint32(n),i.push(s),n+=4;for(r+=3;n<r;)s=Kt[n++],i.push(s);let o=e<16?m5(e):D$(e);return o!=null?i.string=o:i.string=lN(e)}var m9=(e,t)=>{var i=Zr();let n=e;t!==void 0&&(e=e<32?-((t<<5)+e):(t<<5)+e,i.highByte=t);let r=Un[e];return r&&r.isShared&&((Un.restoreStructures||(Un.restoreStructures=[]))[e]=r),Un[e]=i,i.read=p5(i,n),i.read()},P$=typeof self=="object"?self:global;il[0]=()=>{};il[0].noBuffer=!0;il[101]=()=>{let e=Zr();return(P$[e[0]]||Error)(e[1])};il[105]=e=>{let t=Gn.getUint32(it-4);Yf||(Yf=new Map);let i=Kt[it],n;i>=144&&i<160||i==220||i==221?n=[]:n={};let r={target:n};Yf.set(t,r);let s=Zr();return r.used?Object.assign(n,s):(r.target=s,s)};il[112]=e=>{let t=Gn.getUint32(it-4),i=Yf.get(t);return i.used=!0,i.target};il[115]=()=>new Set(Zr());var O$=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");il[116]=e=>{let t=e[0],i=O$[t];if(!i)throw new Error("Could not find typed array for code "+t);return new P$[i](Uint8Array.prototype.slice.call(e,1).buffer)};il[120]=()=>{let e=Zr();return new RegExp(e[0],e[1])};il[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],i=it;it+=t-4,Jl=[Zr(),Zr()],Jl.position0=0,Jl.position1=0;let n=it;it=i;try{return Zr()}finally{it=n}};il[255]=e=>e.length==4?new Date((e[0]*16777216+(e[1]<<16)+(e[2]<<8)+e[3])*1e3):e.length==8?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+((e[3]&3)*4294967296+e[4]*16777216+(e[5]<<16)+(e[6]<<8)+e[7])*1e3):e.length==12?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+((e[4]&128?-281474976710656:0)+e[6]*1099511627776+e[7]*4294967296+e[8]*16777216+(e[9]<<16)+(e[10]<<8)+e[11])*1e3):new Date("invalid");function B$(e){let t=qm,i=it,n=Nc,r=ad,s=Nm,a=Yf,o=Jl,l=new Uint8Array(Kt.slice(0,qm)),c=Un,u=Un.slice(0,Un.length),h=Ml,d=rb,p=e();return qm=t,it=i,Nc=n,ad=r,Nm=s,Yf=a,Jl=o,Kt=l,rb=d,Un=c,Un.splice(0,Un.length,...u),Ml=h,Gn=new DataView(Kt.buffer,Kt.byteOffset,Kt.byteLength),p}function cN(){Kt=null,Yf=null,Un=null}function BBe(e){e.unpack?il[e.type]=e.unpack:il[e.type]=e}var g5=new Array(147);for(let e=0;e<256;e++)g5[e]=+("1e"+Math.floor(45.15-e*.30103));var rP=new x3({useRecords:!1});rP.unpack;rP.unpackMultiple;rP.unpack;var IBe=new Float32Array(1);new Uint8Array(IBe.buffer,0,4);var FC;try{FC=new TextEncoder}catch{}var b3,v5,sP=typeof Buffer<"u",MI=sP?Buffer.allocUnsafeSlow:Uint8Array,I$=sP?Buffer:Uint8Array,g9=sP?4294967296:2144337920,Dt,ls,mt=0,Gh,kh=null,LBe=/[\u0080-\uFFFF]/,L_=Symbol("record-id"),L$=class extends x3{constructor(e){super(e),this.offset=0;let t,i,n,r,s,a=0,o=I$.prototype.utf8Write?function(T,I,R){return Dt.utf8Write(T,I,R)}:FC&&FC.encodeInto?function(T,I){return FC.encodeInto(T,Dt.subarray(I)).written}:!1,l=this;e||(e={});let c=e&&e.sequential,u=e.structures||e.saveStructures,h=e.maxSharedStructures;if(h==null&&(h=u?32:0),h>8160)throw new Error("Maximum maxSharedStructure is 8160");let d=e.maxOwnStructures;d==null&&(d=u?32:64),c&&!e.saveStructures&&(this.structures=[]);let p=h>32||d+h>64,g=h+64,x=h+d+64;if(x>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let y=[],b=0,A=0;this.pack=this.encode=function(T,I){if(Dt||(Dt=new MI(8192),ls=new DataView(Dt.buffer,0,8192),mt=0),Gh=Dt.length-10,Gh-mt<2048?(Dt=new MI(Dt.length),ls=new DataView(Dt.buffer,0,Dt.length),Gh=Dt.length-10,mt=0):mt=mt+7&2147483640,t=mt,s=l.structuredClone?new Map:null,l.bundleStrings?(kh=["",""],Dt[mt++]=214,Dt[mt++]=98,kh.position=mt-t,mt+=4):kh=null,i=l.structures,i){i.uninitialized&&(i=l._mergeStructures(l.getStructures()));let R=i.sharedLength||0;if(R>h)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let O=0;O<R;O++){let P=i[O];if(!P)continue;let U,H=i.transitions;for(let V=0,j=P.length;V<j;V++){let J=P[V];U=H[J],U||(U=H[J]=Object.create(null)),H=U}H[L_]=O+64}a=R}c||(i.nextId=R+64)}n&&(n=!1),r=i||[];try{if(w(T),kh){ls.setUint32(kh.position+t,mt-kh.position-t);let R=kh;kh=null,w(R[0]),w(R[1])}if(l.offset=mt,s&&s.idsToInsert){mt+=s.idsToInsert.length*6,mt>Gh&&D(mt),l.offset=mt;let R=NBe(Dt.subarray(t,mt),s.idsToInsert);return s=null,R}return I&zBe?(Dt.start=t,Dt.end=mt,Dt):Dt.subarray(t,mt)}finally{if(i){if(A<10&&A++,b>1e4)i.transitions=null,A=0,b=0,y.length>0&&(y=[]);else if(y.length>0&&!c){for(let R=0,O=y.length;R<O;R++)y[R][L_]=0;y=[]}if(n&&l.saveStructures){let R=i.sharedLength||h;i.length>R&&(i=i.slice(0,R));let O=Dt.subarray(t,mt);return l.saveStructures(i,a)===!1?(l._mergeStructures(l.getStructures()),l.pack(T)):(a=R,O)}}I&FBe&&(mt=t)}};let w=T=>{mt>Gh&&(Dt=D(mt));var I=typeof T,R;if(I==="string"){let O=T.length;if(kh&&O>=8&&O<4096){let H=LBe.test(T);kh[H?0:1]+=T,Dt[mt++]=193,w(H?-O:O);return}let P;O<32?P=1:O<256?P=2:O<65536?P=3:P=5;let U=O*3;if(mt+U>Gh&&(Dt=D(mt+U)),O<64||!o){let H,V,j,J=mt+P;for(H=0;H<O;H++)V=T.charCodeAt(H),V<128?Dt[J++]=V:V<2048?(Dt[J++]=V>>6|192,Dt[J++]=V&63|128):(V&64512)===55296&&((j=T.charCodeAt(H+1))&64512)===56320?(V=65536+((V&1023)<<10)+(j&1023),H++,Dt[J++]=V>>18|240,Dt[J++]=V>>12&63|128,Dt[J++]=V>>6&63|128,Dt[J++]=V&63|128):(Dt[J++]=V>>12|224,Dt[J++]=V>>6&63|128,Dt[J++]=V&63|128);R=J-mt-P}else R=o(T,mt+P,U);R<32?Dt[mt++]=160|R:R<256?(P<2&&Dt.copyWithin(mt+2,mt+1,mt+1+R),Dt[mt++]=217,Dt[mt++]=R):R<65536?(P<3&&Dt.copyWithin(mt+3,mt+2,mt+2+R),Dt[mt++]=218,Dt[mt++]=R>>8,Dt[mt++]=R&255):(P<5&&Dt.copyWithin(mt+5,mt+3,mt+3+R),Dt[mt++]=219,ls.setUint32(mt,R),mt+=4),mt+=R}else if(I==="number")if(T>>>0===T)T<64?Dt[mt++]=T:T<256?(Dt[mt++]=204,Dt[mt++]=T):T<65536?(Dt[mt++]=205,Dt[mt++]=T>>8,Dt[mt++]=T&255):(Dt[mt++]=206,ls.setUint32(mt,T),mt+=4);else if(T>>0===T)T>=-32?Dt[mt++]=256+T:T>=-128?(Dt[mt++]=208,Dt[mt++]=T+256):T>=-32768?(Dt[mt++]=209,ls.setInt16(mt,T),mt+=2):(Dt[mt++]=210,ls.setInt32(mt,T),mt+=4);else{let O;if((O=this.useFloat32)>0&&T<4294967296&&T>=-2147483648){Dt[mt++]=202,ls.setFloat32(mt,T);let P;if(O<4||(P=T*g5[(Dt[mt]&127)<<1|Dt[mt+1]>>7])>>0===P){mt+=4;return}else mt--}Dt[mt++]=203,ls.setFloat64(mt,T),mt+=8}else if(I==="object")if(!T)Dt[mt++]=192;else{if(s){let P=s.get(T);if(P){if(!P.id){let U=s.idsToInsert||(s.idsToInsert=[]);P.id=U.push(P)}Dt[mt++]=214,Dt[mt++]=112,ls.setUint32(mt,P.id),mt+=4;return}else s.set(T,{offset:mt-t})}let O=T.constructor;if(O===Object)E(T,!0);else if(O===Array){R=T.length,R<16?Dt[mt++]=144|R:R<65536?(Dt[mt++]=220,Dt[mt++]=R>>8,Dt[mt++]=R&255):(Dt[mt++]=221,ls.setUint32(mt,R),mt+=4);for(let P=0;P<R;P++)w(T[P])}else if(O===Map){R=T.size,R<16?Dt[mt++]=128|R:R<65536?(Dt[mt++]=222,Dt[mt++]=R>>8,Dt[mt++]=R&255):(Dt[mt++]=223,ls.setUint32(mt,R),mt+=4);for(let[P,U]of T)w(P),w(U)}else{for(let P=0,U=b3.length;P<U;P++){let H=v5[P];if(T instanceof H){let V=b3[P];if(V.write){V.type&&(Dt[mt++]=212,Dt[mt++]=V.type,Dt[mt++]=0),w(V.write.call(this,T));return}let j=Dt,J=ls,F=mt;Dt=null;let X;try{X=V.pack.call(this,T,W=>(Dt=j,j=null,mt+=W,mt>Gh&&D(mt),{target:Dt,targetView:ls,position:mt-W}),w)}finally{j&&(Dt=j,ls=J,mt=F,Gh=Dt.length-10)}X&&(X.length+mt>Gh&&D(X.length+mt),mt=UBe(X,Dt,mt,V.type));return}}E(T,!T.hasOwnProperty)}}else if(I==="boolean")Dt[mt++]=T?195:194;else if(I==="bigint"){if(T<BigInt(1)<<BigInt(63)&&T>=-(BigInt(1)<<BigInt(63)))Dt[mt++]=211,ls.setBigInt64(mt,T);else if(T<BigInt(1)<<BigInt(64)&&T>0)Dt[mt++]=207,ls.setBigUint64(mt,T);else if(this.largeBigIntToFloat)Dt[mt++]=203,ls.setFloat64(mt,Number(T));else throw new RangeError(T+" was too large to fit in MessagePack 64-bit integer format, set largeBigIntToFloat to convert to float-64");mt+=8}else if(I==="undefined")this.encodeUndefinedAsNil?Dt[mt++]=192:(Dt[mt++]=212,Dt[mt++]=0,Dt[mt++]=0);else if(I==="function")w(this.writeFunction&&this.writeFunction());else throw new Error("Unknown type: "+I)},E=this.useRecords===!1?this.variableMapSize?T=>{let I=Object.keys(T),R=I.length;R<16?Dt[mt++]=128|R:R<65536?(Dt[mt++]=222,Dt[mt++]=R>>8,Dt[mt++]=R&255):(Dt[mt++]=223,ls.setUint32(mt,R),mt+=4);let O;for(let P=0;P<R;P++)w(O=I[P]),w(T[O])}:(T,I)=>{Dt[mt++]=222;let R=mt-t;mt+=2;let O=0;for(let P in T)(I||T.hasOwnProperty(P))&&(w(P),w(T[P]),O++);Dt[R+++t]=O>>8,Dt[R+t]=O&255}:T=>{let I=Object.keys(T),R,O=r.transitions||(r.transitions=Object.create(null)),P=0;for(let H=0,V=I.length;H<V;H++){let j=I[H];R=O[j],R||(R=O[j]=Object.create(null),P++),O=R}let U=O[L_];if(U)U>=96&&p?(Dt[mt++]=((U-=96)&31)+96,Dt[mt++]=U>>5):Dt[mt++]=U;else{U=r.nextId,U||(U=64),U<g&&this.shouldShareStructure&&!this.shouldShareStructure(I)?(U=r.nextOwnId,U<x||(U=g),r.nextOwnId=U+1):(U>=x&&(U=g),r.nextId=U+1);let H=I.highByte=U>=96&&p?U-96>>5:-1;O[L_]=U,r[U-64]=I,U<g?(I.isShared=!0,r.sharedLength=U-63,n=!0,H>=0?(Dt[mt++]=(U&31)+96,Dt[mt++]=H):Dt[mt++]=U):(H>=0?(Dt[mt++]=213,Dt[mt++]=114,Dt[mt++]=(U&31)+96,Dt[mt++]=H):(Dt[mt++]=212,Dt[mt++]=114,Dt[mt++]=U),P&&(b+=A*P),y.length>=d&&(y.shift()[L_]=0),y.push(O),w(I))}for(let H=0,V=I.length;H<V;H++)w(T[I[H]])},D=T=>{let I;if(T>16777216){if(T-t>g9)throw new Error("Packed buffer would be larger than maximum buffer size");I=Math.min(g9,Math.round(Math.max((T-t)*(T>67108864?1.25:2),4194304)/4096)*4096)}else I=(Math.max(T-t<<2,Dt.length-1)>>12)+1<<12;let R=new MI(I);return ls=new DataView(R.buffer,0,I),Dt.copy?Dt.copy(R,0,t,T):R.set(Dt.slice(t,T)),mt-=t,t=0,Gh=R.length-10,Dt=R}}useBuffer(e){Dt=e,ls=new DataView(Dt.buffer,Dt.byteOffset,Dt.byteLength),mt=0}};v5=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,E$];b3=[{pack(e,t,i){let n=e.getTime()/1e3;if((this.useTimestamp32||e.getMilliseconds()===0)&&n>=0&&n<4294967296){let{target:r,targetView:s,position:a}=t(6);r[a++]=214,r[a++]=255,s.setUint32(a,n)}else if(n>0&&n<17179869184){let{target:r,targetView:s,position:a}=t(10);r[a++]=215,r[a++]=255,s.setUint32(a,e.getMilliseconds()*4e6+(n/1e3/4294967296>>0)),s.setUint32(a+4,n)}else if(isNaN(n)){if(this.onInvalidDate)return t(0),i(this.onInvalidDate());let{target:r,targetView:s,position:a}=t(3);r[a++]=212,r[a++]=255,r[a++]=255}else{let{target:r,targetView:s,position:a}=t(15);r[a++]=199,r[a++]=12,r[a++]=255,s.setUint32(a,e.getMilliseconds()*1e6),s.setBigInt64(a+4,BigInt(Math.floor(n)))}}},{pack(e,t,i){let n=Array.from(e),{target:r,position:s}=t(this.structuredClone?3:0);this.structuredClone&&(r[s++]=212,r[s++]=115,r[s++]=0),i(n)}},{pack(e,t,i){let{target:n,position:r}=t(this.structuredClone?3:0);this.structuredClone&&(n[r++]=212,n[r++]=101,n[r++]=0),i([e.name,e.message])}},{pack(e,t,i){let{target:n,position:r}=t(this.structuredClone?3:0);this.structuredClone&&(n[r++]=212,n[r++]=120,n[r++]=0),i([e.source,e.flags])}},{pack(e,t){this.structuredClone?v9(e,16,t):y9(sP?Buffer.from(e):new Uint8Array(e),t)}},{pack(e,t){let i=e.constructor;i!==I$&&this.structuredClone?v9(e,O$.indexOf(i.name),t):y9(e,t)}},{pack(e,t){let{target:i,position:n}=t(1);i[n]=193}}];function v9(e,t,i,n){let r=e.byteLength;if(r+1<256){var{target:s,position:a}=i(4+r);s[a++]=199,s[a++]=r+1}else if(r+1<65536){var{target:s,position:a}=i(5+r);s[a++]=200,s[a++]=r+1>>8,s[a++]=r+1&255}else{var{target:s,position:a,targetView:o}=i(7+r);s[a++]=201,o.setUint32(a,r+1),a+=4}s[a++]=116,s[a++]=t,s.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),a)}function y9(e,t){let i=e.byteLength;var n,r;if(i<256){var{target:n,position:r}=t(i+2);n[r++]=196,n[r++]=i}else if(i<65536){var{target:n,position:r}=t(i+3);n[r++]=197,n[r++]=i>>8,n[r++]=i&255}else{var{target:n,position:r,targetView:s}=t(i+5);n[r++]=198,s.setUint32(r,i),r+=4}n.set(e,r)}function UBe(e,t,i,n){let r=e.length;switch(r){case 1:t[i++]=212;break;case 2:t[i++]=213;break;case 4:t[i++]=214;break;case 8:t[i++]=215;break;case 16:t[i++]=216;break;default:r<256?(t[i++]=199,t[i++]=r):r<65536?(t[i++]=200,t[i++]=r>>8,t[i++]=r&255):(t[i++]=201,t[i++]=r>>24,t[i++]=r>>16&255,t[i++]=r>>8&255,t[i++]=r&255)}return t[i++]=n,t.set(e,i),i+=r,i}function NBe(e,t){let i,n=t.length*6,r=e.length-n;for(t.sort((s,a)=>s.offset>a.offset?1:-1);i=t.pop();){let s=i.offset,a=i.id;e.copyWithin(s+n,s,r),n-=6;let o=s+n;e[o++]=214,e[o++]=105,e[o++]=a>>24,e[o++]=a>>16&255,e[o++]=a>>8&255,e[o++]=a&255,r=s}return e}function zb(e){if(e.Class){if(!e.pack&&!e.write)throw new Error("Extension has no pack or write function");if(e.pack&&!e.type)throw new Error("Extension has no type (numeric code to identify the extension)");v5.unshift(e.Class),b3.unshift(e)}BBe(e)}var U$=new L$({useRecords:!1});U$.pack;U$.pack;var zBe=512,FBe=1024,x9=new L$({structuredClone:!0});zb({Class:mi.prototype.constructor,type:1,write(e){return{...e}},read(e){return Object.setPrototypeOf(e,mi.prototype),e}});zb({Class:ri.prototype.constructor,type:2,write(e){return[...e]},read(e){return Object.setPrototypeOf(e,ri.prototype),e}});zb({Class:Wa.prototype.constructor,type:3,write(e){return[...e]},read(e){return Object.setPrototypeOf(e,Wa.prototype),e}});zb({Class:o9.prototype.constructor,type:4,write(e){return e.id},read(e){return new o9(e)}});zb({Class:l9.prototype.constructor,type:5,write(e){return e.data},read(e){return new l9(e)}});zb({Class:Ps.prototype.constructor,type:6,write(e){return{...e}},read(e){return Object.setPrototypeOf(e,Ps.prototype),e}});function VBe(e){var t=0;if(e.length===0)return t;for(let i=0;i<e.length;i++){let n=e[i];t=(t<<5)-t+n,t=t&t}return t}function uN(e){if(c5(e))return e;if(Array.isArray(e))return e.map(uN);if(typeof e=="object"&&e!==null){let t={};for(let i of Object.keys(e).sort())t[i]=uN(e[i]);return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}else return e}var hN;(e=>{function t(r){return x9.pack(r)}e.serialize=t;function i(r){return x9.unpack(r)}e.deserialize=i;function n(r){return VBe(t(uN(r))).toString()}e.checksum=n})(hN||(hN={}));var b9;(e=>{function t(n){return n.type==="Conditional"?n.condition.type==="Distance"?"Distance":"StateChange":n.type}e.toEventUIType=t;function i(n){return n==="Distance"||n==="StateChange"?"Conditional":n}e.fromEventUIType=i})(b9||(b9={}));function S9(e){return e==="MouseDown"||e==="MouseUp"||e==="KeyDown"||e==="KeyUp"||e==="Collision"||e==="Trigger"}var uo={LookAt:[],Follow:["Create"],DragDrop:["Transition","Animation","Audio","Particles","Create","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseHover:["Transition","Animation","Particles","Create","Destroy","SwitchCamera","SceneTransition","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Scroll:["Transition","Animation","Create","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Start:["Transition","Animation","Audio","Particles","Video","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Conditional:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseDown:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseUp:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MousePress:["Transition","Animation","Audio","Particles","Video","Link","Create","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyDown:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyUp:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyPress:["Transition","Animation","Audio","Particles","Video","Link","Create","SwitchCamera","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],GameControl:["Transition","Animation","Audio","Particles","Create","Conditional"],Collision:["Transition","Animation","Audio","Particles","Video","Create","Destroy","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Trigger:["Transition","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Resize:["Transition","Animation","Audio","Particles","Video","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],VariableChange:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],API:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],WEBHOOK:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],AIAssistantListener:["SetVariable"],AIAssistantTrigger:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"]},_9;(e=>{function t(n){return n.type==="MouseDown"||n.type==="MouseUp"||n.type==="MousePress"||n.type==="KeyDown"||n.type==="KeyUp"||n.type==="KeyPress"}e.is=t;function i(n){return n==="MouseDown"||n==="MouseUp"||n==="MousePress"?{type:n,mode:"Object",disabled:!1,actions:new ri}:{type:n,disabled:!1,key:void 0,actions:new ri}}e.defaultData=i})(_9||(_9={}));var S3;(e=>{function t(i){return{type:"Property",value:[i??null,"position","x"]}}e.propertyDefaultData=t,e.valueDefaultData={type:"Literal",value:0}})(S3||(S3={}));var dN;(e=>{function t(r){return{type:"Comparison",operator:"==",lOperand:S3.propertyDefaultData(r),rOperand:{...S3.valueDefaultData}}}e.comparisonDefaultData=t;function i(r){return{type:"Distance",toObject:r??null,fromObject:r??null,distance:200}}e.distanceDefaultData=i;function n(r,s){return{type:"State",object:r??null,state:s??null}}e.stateDefaultData=n})(dN||(dN={}));var A9;(e=>{function t(i){return i.find(n=>n==="ifActions"||n==="elseActions")!==void 0}e.isConditionalSubActions=t})(A9||(A9={}));var w9;(e=>{function t(n){return n.type==="Conditional"}e.is=t;function i(n){return{type:"Conditional",disabled:!1,inActions:new ri,outActions:new ri,condition:dN.distanceDefaultData(n)}}e.defaultData=i})(w9||(w9={}));var M9;(e=>e.defaultData={type:"DragDrop",cursor:"hand",disabled:!1,dampingFactor:1,objects:[],snapTo:"center",snapSurfaceMode:"bbox",snapSurfaceOffset:0,dropOn:"all",autoOrient:!0,dropDestinations:[],plane:"adaptive",planeMode:"locked",referenceFrame:"global",limits:[-1/0,1/0,-1/0,1/0,-1/0,1/0],drop:!1,resetOnSnapFail:!1,snapSpeed:20,resetSpeed:20,dragDropActions:{drag:new ri,drop:new ri}})(M9||(M9={}));var fN;(e=>e.defaultData={type:"Follow",disabled:!1,maxDelta:0,dampingFactor:1,target:"cursor",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledTranslation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5,actions:new ri})(fN||(fN={}));var pN;(e=>e.defaultData={type:"LookAt",disabled:!1,distance:1e3,dampingFactor:1,target:"cursor",tilt:"up",axis:"z",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledRotation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5})(pN||(pN={}));var E9;(e=>{function t(n){return n.type==="MouseHover"}e.is=t;function i(){return{type:"MouseHover",disabled:!1,actions:new ri}}e.defaultData=i})(E9||(E9={}));var T9;(e=>{function t(n){return n.type==="Scroll"}e.is=t;function i(){return{type:"Scroll",disabled:!1,steps:100,trigger:"load",startFrom:"enter",enterAnchor:"top",startOffset:0,endAfter:400,actions:new ri}}e.defaultData=i})(T9||(T9={}));var C9;(e=>{function t(n){return n.type==="Start"}e.is=t;function i(){return{type:"Start",disabled:!1,actions:new ri}}e.defaultData=i})(C9||(C9={}));var D9;(e=>{function t(n){return n.type==="Collision"}e.is=t;function i(){return{type:"Collision",disabled:!1,target:"character",actions:new ri}}e.defaultData=i})(D9||(D9={}));var R9;(e=>{function t(n){return n.type==="Trigger"}e.is=t;function i(n,r){return{type:"Trigger",disabled:!1,target:"all",triggeringObjects:[],actions:new ri,triggerZone:"box",position:r.toArray(),rotation:[0,0,0],size:n.toArray(),radius:n.length()/2,helperVisible:!0}}e.defaultData=i})(R9||(R9={}));var mN;(e=>{e.defaultSizes={mobile:[480,480],tablet:[768,768],desktop:[1200,1200],custom:[769,1200]};function t(a){return a.type==="Resize"}e.is=t;function i(a){return typeof a=="string"?a:"custom"}e.sizeToDevice=i;function n(a){return typeof a=="string"?[...e.defaultSizes[a]]:[...a]}e.deviceToSize=n;function r(){let a={size:"mobile",operator:"<",actions:new ri},o={size:"tablet",operator:"<",actions:new ri},l={size:[...e.defaultSizes.custom],operator:"<>",actions:new ri},c=new ri;return c.push({id:qt.generateUUID(),fi:0,data:a},{id:qt.generateUUID(),fi:1,data:o},{id:qt.generateUUID(),fi:2,data:l}),{type:"Resize",disabled:!1,orientation:"horizontal",breakpoints:c}}e.defaultData=r;function s(){return{size:[...e.defaultSizes.custom],operator:"<>",actions:new ri}}e.defaultBreakpointData=s})(mN||(mN={}));var gN;(e=>{e.propertyPaths={Position:["position"],"Position X":["position","x"],"Position Y":["position","y"],"Position Z":["position","z"],Rotation:["rotation"],"Rotation X":["rotation","x"],"Rotation Y":["rotation","y"],"Rotation Z":["rotation","z"],Scale:["scale"],"Scale X":["scale","x"],"Scale Y":["scale","y"],"Scale Z":["scale","z"],Width:["width"],Height:["height"],Depth:["depth"],"Mouse Position X":["mouse","x"],"Mouse Position Y":["mouse","y"],"Mouse Pressed":["mouse","pressed"],"Screen Width":["mouse","width"],"Screen Height":["mouse","height"],"Hit Position X":["raycast","x"],"Hit Position Y":["raycast","y"],"Hit Position Z":["raycast","z"],"Hit Object Position X":["raycast","objX"],"Hit Object Position Y":["raycast","objY"],"Hit Object Position Z":["raycast","objZ"]};function t(n){return n.type==="VariableChange"}e.is=t;function i(){return{disabled:!1,type:"VariableChange",actions:new ri,variableId:"",objectId:null,property:"Position X"}}e.defaultData=i})(gN||(gN={}));var P9;(e=>{function t(n){return n.type==="API"}e.is=t;function i(){return{disabled:!1,type:"API",successActions:new ri,errorActions:new ri,userAPIId:""}}e.defaultData=i})(P9||(P9={}));var O9;(e=>{function t(n){return n.type==="WEBHOOK"}e.is=t;function i(){return{disabled:!1,type:"WEBHOOK",actions:new ri,userWebhookId:""}}e.defaultData=i})(O9||(O9={}));var B9;(e=>{function t(n){return n.type==="AIAssistantListener"}e.is=t;function i(){return{disabled:!1,type:"AIAssistantListener",actions:new ri,analysis:"average",analysisRange:[0,71],analysisSingle:0}}e.defaultData=i})(B9||(B9={}));var I9;(e=>{function t(n){return n.type==="AIAssistantTrigger"}e.is=t;function i(){return{disabled:!1,description:"",type:"AIAssistantTrigger",actions:new ri}}e.defaultData=i})(I9||(I9={}));var Fb="personal camera",UA="a218fcc3-276b-49b9-b485-49037fd14f5f",HBe=2960946,nc=5526619,Gf;(e=>{function t(g,x){return g[0]===x[0]&&g[1]===x[1]}e.isEqual=t;function i(g,x,y){return[g[0]+(x[0]-g[0])*y,g[1]+(x[1]-g[1])*y]}e.lerp=i;function n(g,x){return[g[0]+x[0],g[1]+x[1]]}e.add=n;function r(g,x){return[g[0]-x[0],g[1]-x[1]]}e.sub=r;function s(g,x){return[g[0]*x[0],g[1]*x[1]]}e.multiply=s;function a(g,x){return[g[0]/x[0],g[1]/x[1]]}e.divide=a;function o(g,x){return Math.pow(x[0]-g[0],2)+Math.pow(x[1]-g[1],2)}e.distanceSquared=o;function l(g,x){return Math.sqrt(o(g,x))}e.distance=l;function c(g,x){return g[0]*x[0]+g[1]*x[1]}e.dot=c;function u(g,x){return[g[0]*x,g[1]*x]}e.scalarMultiply=u;function h(g,x,y){let b=e.sub(x,g),A=e.sub(y,g),w=e.dot(b,A)/e.dot(b,b),E=e.scalarMultiply(b,w);return e.add(g,E)}e.projectionOnto=h;function d(g,x,y){return l(g,h(g,x,y))}e.projectionOntoDistance=d;function p(g,x){return[(g[0]+x[0])*.5,(g[1]+x[1])*.5]}e.center=p})(Gf||(Gf={}));var A0;(e=>{function t(l,c){return l[0]===c[0]&&l[1]===c[1]&&l[2]===c[2]}e.isEqual=t;function i(l,c){return[l[0]+c[0],l[1]+c[1],l[2]+c[2]]}e.add=i;function n(l,c){return[l[0]-c[0],l[1]-c[1],l[2]-c[2]]}e.sub=n;function r(l,c){return[l[0]/c[0],l[1]/c[1],l[2]/c[2]]}e.div=r;function s(l,c){return[l[0]*c[0],l[1]*c[1],l[2]*c[2]]}e.mul=s;function a(l,c){return Math.hypot(l[0]-c[0],l[1]-c[1],l[2]-c[2])}e.dist=a;function o(l,c,u){return[l[0]+(c[0]-l[0])*u,l[1]+(c[1]-l[1])*u,l[2]+(c[2]-l[2])*u]}e.lerp=o})(A0||(A0={}));var _3;(e=>{function t(n,r){return n[0]===r[0]&&n[1]===r[1]&&n[2]===r[2]&&n[3]===r[3]}e.isEqual=t;function i(n,r,s){return[n[0]+(r[0]-n[0])*s,n[1]+(r[1]-n[1])*s,n[2]+(r[2]-n[2])*s,n[3]+(r[3]-n[3])*s]}e.lerp=i})(_3||(_3={}));var L9;(e=>{let t=180/Math.PI,i=Math.PI/180;function n(o){return typeof o=="number"?o*t:o}function r(o){return typeof o=="number"?o*i:o}function s(o){return[n(o[0]),n(o[1]),n(o[2])]}e.radToDeg=s;function a(o){return[r(o[0]),r(o[1]),r(o[2])]}e.degToRad=a})(L9||(L9={}));var sb;(e=>{e.identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function t(r,s){for(let a=0;a<16;a++)if(r[a]!==s[a])return!1;return!0}e.isEqual=t;function i(r){return r??e.identity}e.simplify=i;function n(r,s){let a=s.slice(0);for(var o=0,l=s.length;o<l;o+=3){let c=r[3]*s[o]+r[7]*s[o+1]+r[11]*s[o+2]+r[15];a[o]=(r[0]*s[o]+r[4]*s[o+1]+r[8]*s[o+2]+r[12])/c,a[o+1]=(r[1]*s[o]+r[5]*s[o+1]+r[9]*s[o+2]+r[13])/c,a[o+2]=(r[2]*s[o]+r[6]*s[o+1]+r[10]*s[o+2]+r[14])/c}return a}e.applyMatrix4=n})(sb||(sb={}));var Ha;(e=>{function t(c){return typeof c=="object"&&typeof c.r=="number"&&typeof c.g=="number"&&typeof c.b=="number"}e.isRGB=t,e.white={r:1,g:1,b:1},e.red={r:1,g:0,b:0},e.black={r:0,g:0,b:0};function i(c){return{r:Math.round(c.r*255),g:Math.round(c.g*255),b:Math.round(c.b*255),a:1}}e.toRgb255a1=i;function n(c){return{r:c.r,g:c.g,b:c.b}}e.clone=n;function r(c){return c=Math.floor(c),{r:(c>>16&255)/255,g:(c>>8&255)/255,b:(c&255)/255}}e.fromHex=r;function s(c){return Math.round(c.r*255)*65536+Math.round(c.g*255)*256+Math.round(c.b*255)}e.toHex=s;function a(c,u){return c.r===u.r&&c.g===u.g&&c.b===u.b}e.equals=a;function o(c,u){return c.r.toFixed(2)===u.r.toFixed(2)&&c.g.toFixed(2)===u.g.toFixed(2)&&c.b.toFixed(2)===u.b.toFixed(2)}e.equalsFixed=o;function l(c,u,h){return{r:c.r+(u.r-c.r)*h,g:c.g+(u.g-c.g)*h,b:c.b+(u.b-c.b)*h}}e.lerp=l})(Ha||(Ha={}));var er;(e=>{e.white={...Ha.white,a:1},e.transparent={...Ha.white,a:0};function t(l){return{r:l[0],g:l[1],b:l[2],a:l[3]}}e.from0to1=t;function i(l,c){return{...Ha.fromHex(l),a:c}}e.fromHexAndA=i;function n(l){return{r:Math.round(l.r*255),g:Math.round(l.g*255),b:Math.round(l.b*255),a:l.a}}e.toRgb255a1=n;function r(l,c){return Ha.equals(l,c)&&l.a===c.a}e.equals=r;function s(l,c){return Ha.equalsFixed(l,c)&&l.a.toFixed(2)===c.a.toFixed(2)}e.equalsFixed=s;function a(l,c,u){return{r:l.r+(c.r-l.r)*u,g:l.g+(c.g-l.g)*u,b:l.b+(c.b-l.b)*u,a:l.a+(c.a-l.a)*u}}e.lerp=a;function o({r:l,g:c,b:u,a:h}=e.white){return`rgba(${l*255}, ${c*255}, ${u*255}, ${h})`}e.toStyle=o})(er||(er={}));var vN;(e=>e.identity={position:[0,0,0],rotation:[0,0,0],scale:[1,1,1]})(vN||(vN={}));var U9;(e=>e.defaultData={mass:1,stiffness:80,damping:10,velocity:0})(U9||(U9={}));var N9;(e=>e.defaultData={control1:[.5,0],control2:[.5,1]})(N9||(N9={}));var Em;(e=>(e.linear=[0,0,1,1],e.ease=[.25,.1,.25,1],e.easeIn=[.42,0,1,1],e.easeOut=[0,0,.58,1],e.easeInOut=[.42,0,.58,1]))(Em||(Em={}));function z9(e){return typeof e=="string"&&e.length===36?/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e):!1}var N0;(e=>{e.all=["PerspectiveCamera","OrthographicCamera"];function t(i){return e.all.includes(i)}e.is=t})(N0||(N0={}));var ab;(e=>{e.DefaultUp=[0,1,0],e.DefaultTargetOffset=1e3,e.defaultData={far:1e5,type:"OrthographicCamera",perspective:{near:70,fov:45,zoom:1},orthographic:{near:-1e5,zoom:1},up:e.DefaultUp,isUpVectorFlipped:!1,targetOffset:e.DefaultTargetOffset};function t(i){var n,r;return i.type==="PerspectiveCamera"?((n=i.perspective)==null?void 0:n.zoom)??1:((r=i.orthographic)==null?void 0:r.zoom)??1}e.getZoom=t})(ab||(ab={}));var zm;(e=>{function t(n,r=.1){return{disabled:!1,type:"linear",hideBase:!1,count:3,radial:{radius:Math.max(n[0],n[1])*2,start:0,end:360,alignment:!1,axis:"y",scale:[1,1,1],rotation:[0,0,0],position:[0,0,0]},toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},linear:{scale:[1,1,1],rotation:[0,0,0],position:[n[0]+n[0]*r,0,0]},grid:{count:[2,2,2],size:n.map(s=>s*(1+r)),useCenter:!0},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}}}e.defaultData=t;function i(n,r){let s={...n};if(N$.forEach(a=>{Object.assign(s,{[a]:r[a]??n[a]})}),s.radial={...n.radial},r.radial){let a=n.radial,o=r.radial;z$.forEach(l=>{Object.assign(s.radial,{[l]:o[l]??a[l]})})}if(s.linear={...n.linear},r.linear){let a=n.linear,o=r.linear;F$.forEach(l=>{Object.assign(s.linear,{[l]:o[l]??a[l]})})}if(s.grid={...n.grid},r.grid){let a=n.grid,o=r.grid;V$.forEach(l=>{Object.assign(s.grid,{[l]:o[l]??a[l]})})}if(s.toObject={...n.toObject},r.toObject){let a=n.toObject,o=r.toObject;H$.forEach(l=>{Object.assign(s.toObject,{[l]:o[l]??a[l]})})}if(s.randomnessObject={...n.randomnessObject},r.randomnessObject){let a=n.randomnessObject,o=r.randomnessObject;G$.forEach(l=>{Object.assign(s.randomnessObject,{[l]:o[l]??a[l]})})}return s}e.merge=i})(zm||(zm={}));var yN;(e=>{e.defaultData={radial:{},linear:{},grid:{},toObject:{},randomnessObject:{}};let t=["radial","linear","grid","toObject","randomnessObject"];function i(n,r){let s=[];n.count!==void 0&&s.push({type:0,path:r,props:{count:n.count}});for(let a of t){let o=n[a];o&&Object.keys(o).length>0&&s.push({type:0,path:[...r,a],props:o})}return s}e.toOps=i})(yN||(yN={}));var N$=["count"],z$=["radius","start","end","position","scale","rotation"],F$=["position","scale","rotation"],V$=["count","size"],H$=["count","position","scale","rotation"],G$=["strength","scale","rotation","position","movement","seed","freqScale"],xN;(e=>{e.all=["PointLight","SpotLight","DirectionalLight","HemisphereLight"];function t(i){return e.all.includes(i)}e.is=t})(xN||(xN={}));var bN;(e=>{function t(n){return i(n)}e.defaultData=t;function i(n){if(n==="PointLight")return{type:n,color:er.white,intensity:1,distance:2e3,decay:1,shadows:!0,shadowResolution:1024,shadowRadius:1,penumbraSize:.5,depth:1e5};if(n==="SpotLight")return{type:n,color:er.white,intensity:1,distance:2e3,decay:1,shadows:!0,penumbra:0,angle:30/180*Math.PI,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};if(n==="DirectionalLight")return{type:n,color:er.white,intensity:1,shadows:!0,size:2e3,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};throw new Error("not implemented")}})(bN||(bN={}));var A3;(e=>(e.defaultShapeData={type:"PlaneEmitterShape",size:[100,100,100]},e.defaultCollisionData={colliderEntityId:null,collisionBounce:.75},e.defaultData={renderMaterial:{type:"particleMaterial",color:{r:1,g:.2,b:.545,a:1},color2:{r:.945,g:.714,b:.184,a:1},coloring:"gradient",ease:"linearFadeOut",easeSize:"linearFadeOut",transparent:!0,size:[40,40],texture:"pt_default_particle",spriteRotation:[0,0]},birthRatePerSec:50,gravity:1,noiseStrength:0,noiseScale:0,noiseSeed:1,noiseType:"curl",randomRotation:0,randomScale:.2,randomMass:.5,rootObjectType:"instancedMesh",life:1,direction:[0,0,0],directionMode:"axis",speed:10,shape:e.defaultShapeData,autoPlay:!0,emitTimeDelay:0,emitTimeCycle:"infinity",emitTimeDuration:1,...e.defaultCollisionData}))(A3||(A3={}));var ob;(e=>e.defaultData={enabled:"visibility",fusedBody:!0,rigidBody:"positioned",density:1,pointMass:0,gravityScale:1,friction:.5,damping:0,restitution:.2,colliderType:"convex",enabledRotation:[!0,!0,!0],enabledTranslation:[!0,!0,!0]})(ob||(ob={}));var SN;(e=>{e.defaultData={castShadow:!0,receiveShadow:!0};function t(i,n){return i.castShadow===n.castShadow&&i.receiveShadow===n.receiveShadow}e.equals=t})(SN||(SN={}));var _N;(e=>{e.defaultData={flatShading:!1,wireframe:!1,side:0};function t(i,n){return i.flatShading===n.flatShading&&i.side===n.side&&i.wireframe===n.wireframe}e.equals=t})(_N||(_N={}));var AN;(e=>e.defaultData={..._N.defaultData,...SN.defaultData})(AN||(AN={}));var F9;(e=>{function t(i,n){var s,a;let r=[];if("material"in i){let o=typeof i.material=="string"?n.materials[i.material]??((s=n.lib.materials[i.material])==null?void 0:s.asset):i.material;o&&r.push(o)}else if("materials"in i)for(let o of i.materials){let l=typeof o=="string"?n.materials[o]??((a=n.lib.materials[o])==null?void 0:a.asset):o;l&&r.push(l)}return r}e.getMaterialData=t})(F9||(F9={}));var w3;(e=>(e.defaultVideo={data:"",thumb:"/_assets/_videos/catThumb.png",type:"video",name:"Cat video"},e.maxSize=3e7))(w3||(w3={}));var V9;(e=>{function t(i){return i==="texture"||i==="video"||i==="color"||i==="depth"||i==="normal"||i==="gradient"||i==="noise"||i==="fresnel"||i==="rainbow"||i==="toon"||i==="outline"||i==="particle"||i==="transmission"||i==="matcap"||i==="displace"||i==="pattern"||i==="light"}e.is=t})(V9||(V9={}));function GBe(e){return e.type!=="displace"}var H9;(e=>{function t(i){return i==="phong"||i==="toon"||i==="lambert"||i==="physical"}e.is=t})(H9||(H9={}));var k$=["mode","gradientType","noiseType","displacementType","projection","cnormal","crop","axis","side"],kBe=["wrapping","image","video","name","minFilter","magFilter"],da;(e=>{function t(s,a){let{texture:o,...l}=a;if(Object.assign(s,l),o){let c=s.texture;c&&Object.assign(c,o)}}e.patch=t;function i(s,a){return s==="light"&&a?n(a):r(s)}e.defaultData=i;function n(s){let a={mode:0,isMask:!1,visible:!0,bumpMap:void 0,bumpMapIntensity:5,roughnessMap:void 0,alphaOverride:1};switch(s){case"phong":return{...a,category:"phong",specular:{r:.2,g:.2,b:.2},shininess:5,type:"light",visible:!0,mode:0,occlusion:!0,alpha:.6};case"toon":return{...a,category:"toon",specular:{r:.2,g:.2,b:.2},shininess:10,type:"light",alpha:1};case"lambert":return{...a,category:"lambert",emissive:{r:0,g:0,b:0},type:"light",alpha:1,visible:!0,mode:0,occlusion:!0};case"physical":return{...a,category:"physical",roughness:.2,metalness:.2,reflectivity:.2,type:"light",alpha:1,visible:!0,mode:0,occlusion:!0}}}function r(s){let a={alpha:1,mode:0,isMask:!1,visible:!0};switch(s){case"texture":return{...a,type:"texture",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{image:"image_0",wrapping:1e3,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006},crop:!1};case"video":return{...a,type:"video",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{video:w3.defaultVideo,wrapping:1001,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006},crop:!1};case"color":return{...a,type:"color",color:Ha.fromHex(nc)};case"depth":return{...a,type:"depth",gradientType:1,smooth:!1,isVector:!0,isWorldSpace:!1,origin:[0,0,0],direction:[1,0,0],colors:[[1,1,1,1],[0,0,0,1]],steps:[0,1],near:50,far:200};case"normal":return{...a,type:"normal",cnormal:[1,1,1]};case"gradient":return{...a,type:"gradient",gradientType:0,smooth:!1,colors:[[0,0,0,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,1,1,1,1,1,1,1,1,1],num:2,angle:0,offset:[0,0],morph:[0,0]};case"noise":return{...a,type:"noise",size:[100,100,100],noiseType:0,scale:1,move:1,colorA:{...Ha.fromHex(6710886),a:1},colorB:{...Ha.fromHex(6710886),a:1},colorC:{...Ha.fromHex(16777215),a:1},colorD:{...Ha.fromHex(16777215),a:1},distortion:[1,1],fA:[1.7,9.2],fB:[8.3,2.8],voronoiStyle:0,highCut:1,lowCut:0,smoothness:.3,seed:0,quality:1};case"fresnel":return{...a,type:"fresnel",color:er.fromHexAndA(16777215,1),bias:.1,scale:1,intensity:2,factor:1};case"rainbow":return{...a,type:"rainbow",filmThickness:30,movement:0,wavelengths:[0,0,0],noiseStrength:0,noiseScale:1,offset:[0,0,0]};case"toon":return{...a,type:"toon",positioning:2,colors:[[0,0,0,1],[.5,.5,.5,1],[.5,.5,.5,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,.475,.525,1,1,1,1,1,1,1],num:4,source:[0,1e3,0],isWorldSpace:!0,noiseStrength:0,noiseScale:1,shadowColor:er.fromHexAndA(0,0),offset:[0,0,0]};case"outline":return{...a,type:"outline",outlineColor:er.fromHexAndA(0,1),contourColor:er.fromHexAndA(0,1),outlineWidth:2,contourWidth:5,outlineThreshold:.4,contourThreshold:0,outlineSmoothing:0,contourFrequency:10,contourDirection:[0,1,0],positionalLines:!1,compensation:!0};case"matcap":return{...a,type:"matcap",texture:{image:"matcap_0",wrapping:1001,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006}};case"transmission":return{...a,type:"transmission",thickness:10,ior:1.5,roughness:1};case"displace":return{visible:!0,type:"displace",displacementType:"noise",noiseType:0,scale:10,movement:1,offset:[0,0,0],intensity:8,voronoiStyle:0,smoothness:.3,seed:0,highCut:1,lowCut:0,quality:1};case"pattern":return{...a,type:"pattern",style:0,projection:0,axis:"y",blending:0,offset:[0,0],colorA:{...Ha.fromHex(0),a:1},colorB:{...Ha.fromHex(16777215),a:1},frequency:[10,10],size:.5,variation:0,smoothness:.5,zigzag:0,rotation:0,vertical:[0,1],horizontal:[0,1],sides:6}}}})(da||(da={}));var ga;(e=>{function t(u){return!u.layers.some(h=>h.data.type==="texture"&&h.data.projection!==0||h.data.type==="depth"&&!h.data.isWorldSpace||h.data.type==="noise"||h.data.type==="displace")}e.isMergable=t;function i(u){let h="";return u.layers.forEach(d=>{Object.entries(d.data).forEach(([p,g])=>{h+=`${p}${g}`,Array.isArray(g)?g.forEach(x=>h+=`${x}`):typeof g=="object"?Object.values(g).forEach(x=>{typeof x=="number"?h+=`${x.toFixed(4)}`:h+=`${x}`}):h+=`${g}`})}),h}e.getHash=i;function n(){return{layers:new ri}}e.defaultEmptyData=n;function r(u="layer1",h="layer2"){return a("phong",u,h)}e.defaultData=r;function s(u,h){return{...u,name:h}}e.withName=s;function a(u,h="layer1",d="layer2"){let p=new ri;return p.push({fi:0,data:da.defaultData("light",u),id:h}),p.push({fi:1,data:da.defaultData("color"),id:d}),{layers:p}}e.defaultTwoLayerData=a;function o(u){let h=da.defaultData("texture");u&&Object.assign(h.texture,{image:u});let d=new ri;return d.push({fi:0,data:h,id:"layer1"}),d.push({fi:1,data:{...da.defaultData("transmission"),alpha:1},id:"layer2"}),d.push({fi:2,data:{...da.defaultData("light","lambert"),alpha:0},id:"layer3"}),{layers:d}}e.defaultUIObjectMaterial=o;function l(u,h="phong",d="layer1",p="layer2"){let g=da.defaultData("texture");Object.assign(g.texture,{image:u});let x=new ri;return x.push({fi:0,data:g,id:d}),x.push({fi:1,data:da.defaultData("light",h),id:p}),{layers:x}}e.defaultTwoLayerTextureData=l;function c(u,h="phong",d="layer1",p="layer2"){let g=da.defaultData("video");Object.assign(g.texture,{video:u});let x=new ri;return x.push({fi:0,data:g,id:d}),x.push({fi:1,data:da.defaultData("light",h),id:p}),{layers:x}}e.defaultTwoLayerVideoTextureData=c})(ga||(ga={}));var M3;(e=>{function t(){return{points:new ri,roundness:0,shapeHoles:[],isClosed:!1}}e.defaultData=t})(M3||(M3={}));var E3;(e=>{function t(){return{points:new ri,lastInsertionPlane:null,subdivisions:12,isClosed:!1}}e.defaultData=t})(E3||(E3={}));var j$={type:"Ellipse",width:50,height:50,spikes:16,angle:360,innerRadius:0},wN;(e=>{function t(i,n){let r={...i};return X$.forEach(s=>{Object.assign(r,{[s]:n[s]??i[s]})}),r}e.merge=t})(wN||(wN={}));var W$={shape:j$,depth:1,offset:0,bevel:50,bevelSides:6,angle:0,twist:0,startScale:1,endScale:1,capType:"flat"},X$=["depth","offset","angle","twist","startScale","endScale"],T3;(e=>{function t(n){return n==="PolygonGeometry"||n==="RectangleGeometry"||n==="StarGeometry"||n==="TriangleGeometry"||n==="EllipseGeometry"||n==="UIGeometry"}e.is2DParametricMesh=t;function i(n){return n==="PolygonGeometry"||n==="PolygonGeometry"||n==="RectangleGeometry"||n==="StarGeometry"||n==="TriangleGeometry"||n==="EllipseGeometry"||n==="PathGeometry"||n==="VectorGeometry"||n==="ConeGeometry"||n==="CubeGeometry"||n==="CylinderGeometry"||n==="DodecahedronGeometry"||n==="HelixGeometry"||n==="IcosahedronGeometry"||n==="LatheGeometry"||n==="PyramidGeometry"||n==="SphereGeometry"||n==="PlaneGeometry"||n==="BackdropGeometry"||n==="TorusGeometry"||n==="TorusKnotGeometry"||n==="BooleanGeometry"||n==="TextGeometry"||n==="InputGeometry"}e.isParametricMesh=i})(T3||(T3={}));var MN;(e=>{function t(i,n){let r={...i};return Object.assign(r,n),r.type==="PathGeometry"&&"extrusion"in n&&n.extrusion&&(r.extrusion={...i.extrusion},Object.assign(r.extrusion,wN.merge(r.extrusion,n.extrusion))),r}e.merge=t})(MN||(MN={}));var Dm;(e=>{function t(i){if(i==="RectangleGeometry")return{width:320,height:320,type:i,cornerRadius:[0,0,0,0],cornerType:0,depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="UIGeometry")return{type:i,frame:"",cornerRadius:[0,0,0,0],cornerType:0,width:1,height:1};if(i==="PathGeometry")return{type:i,width:1,height:1,depth:1,path:E3.defaultData(),extrusion:W$};if(i==="VectorGeometry")return{width:1,height:1,type:i,subdivisions:12,shape:M3.defaultData(),depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="BooleanGeometry")return{type:i,operation:2,width:0,height:0,depth:0,phongAngle:35};if(i==="ShapeBlendGeometry")return{type:i,width:0,height:0,depth:0,resolutionLevel:6,blendRange:100,useChildrenColors:!1};if(i==="TextGeometry")return{type:i,width:100,height:100,depth:0,horizontalAlign:1,verticalAlign:1,fontSize:16,lineHeight:1.2,letterSpacing:0,text:{textValue:""},textTransform:1,font:"Roboto_regular",editable:!1,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="InputGeometry")return{...e.defaultData("TextGeometry"),type:i,editable:!0};if(i==="SphereGeometry")return{type:"SphereGeometry",width:100,height:100,depth:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180};throw new Error("not implemented")}e.defaultData=t})(Dm||(Dm={}));var EI=["width","height","depth"],EN;(e=>e.defaultData={enabled:!1,useBackgroundColor:!1,color:Ha.white,near:.1,far:2e3})(EN||(EN={}));var C3;(e=>{let t={opacity:1,blendFunction:13,enabled:!1};e.defaultData={enabled:!1,pixelation:{...t,blendFunction:16,granularity:15},bloom:{...t,blendFunction:16,intensity:1,blurScale:1,luminanceThreshold:.25,luminanceSmoothing:.025,kernelSize:3},chromaticAberration:{...t,offset:[2,2]},vignette:{...t,darkness:1,offset:0},hueSaturation:{...t,hue:3,saturation:0},brightnessContrast:{...t,brightness:.25,contrast:0},depthOfField:{...t,focusDistance:100,focalLength:20,bokehScale:5},noise:{...t,blendFunction:16}}})(C3||(C3={}));var TN;(e=>e.defaultData={softShadowQuality:"low"})(TN||(TN={}));var CN;(e=>e.defaultData={enabled:!0,color:{r:.8274509803921568,g:.8274509803921568,b:.8274509803921568},intensity:.75})(CN||(CN={}));var DN;(e=>e.defaultData={occlusion:!1,aoFullRes:!1,radius:256,bias:.5,aoColor:{r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}})(DN||(DN={}));var lb;(e=>e.defaultData={usePhysics:!1,gravity:-10})(lb||(lb={}));var RN;(e=>e.defaultData={playCamera:Fb,gameControlObject:null})(RN||(RN={}));var PN;(e=>e.defaultData={backgroundColor:er.fromHexAndA(HBe,1),postprocessing:C3.defaultData,fog:EN.defaultData,globalPhysics:lb.defaultData,ambient:CN.defaultData,ao:DN.defaultData,shadow:TN.defaultData,publish:RN.defaultData})(PN||(PN={}));var ON;(e=>e.defaultData={colliderType:"box",size:[100,100,100],colliderHelperVisible:!0,forceType:"collider",forceRange:"global",forceIntensity:.5,forceDambing:.95})(ON||(ON={}));var G9;(e=>{function t(n){return n==="Component"||n==="Instance"}e.isComponentRelated=t;function i(n){return n==="Empty"||n==="Instance"}e.isEmptyOrComponent=i})(G9||(G9={}));var cb;(e=>{e.identity={...vN.identity,hiddenMatrix:sb.identity};function t(r){return{position:r.position,rotation:r.rotation,scale:r.scale,hiddenMatrix:r.hiddenMatrix}}e.fromObject=t;function i(r,s){return{position:(s==null?void 0:s.position)||r.position,rotation:(s==null?void 0:s.rotation)||r.rotation,scale:(s==null?void 0:s.scale)||r.scale,hiddenMatrix:(s==null?void 0:s.hiddenMatrix)||r.hiddenMatrix}}e.merge=i;function n(r,s){return l$({position:A0.isEqual(r.position,s.position)?void 0:s.position,rotation:A0.isEqual(r.rotation,s.rotation)?void 0:s.rotation,scale:A0.isEqual(r.scale,s.scale)?null:s.scale,hiddenMatrix:sb.isEqual(r.hiddenMatrix,s.hiddenMatrix)?void 0:s.hiddenMatrix})}e.diff=n})(cb||(cb={}));var Qs;(e=>e.defaultData={states:new ri,events:new ri,visible:!0,raycastLock:!1,physics:ob.defaultData,pathSnapping:{pathId:null,slide:0,offset:0,orientation:"tangential"},...cb.identity,cloner:null})(Qs||(Qs={}));var BN;(e=>e.defaultData={type:"Empty",...Qs.defaultData})(BN||(BN={}));var k9;(e=>e.defaultData={type:"ParticleCollider",...ON.defaultData,...Qs.defaultData})(k9||(k9={}));var j9;(e=>e.defaultData={type:"Component",...Qs.defaultData})(j9||(j9={}));var W9;(e=>e.defaultData={type:"Particle",...Qs.defaultData,...A3.defaultData})(W9||(W9={}));var Rm;(e=>e.defaultData={type:"Mesh",...Qs.defaultData,...AN.defaultData})(Rm||(Rm={}));var Ew;(e=>e.defaultData={...Qs.defaultData,...cb.identity,position:[0,0,ab.DefaultTargetOffset],...ab.defaultData})(Ew||(Ew={}));var IN;(e=>{function t(i){return{...Qs.defaultData,...bN.defaultData(i)}}e.defaultData=t,e.defaultDirectionalLightData={...e.defaultData("DirectionalLight"),position:[200,300,300],name:"Directional Light",intensity:.7}})(IN||(IN={}));var D3;(e=>{function t(n,r,s=0){for(;s<r.length;){let a=n?n[r[s]]:void 0;if(r.length===s+1)return a;if(a)n=a.descendants,s+=1;else return}}e.resolveWithDes=t;function i(n,r,s=0){let a=t(n,r,s);if(a){let o=Object.keys(a);if(o.length===1&&o[0]==="descendants")return}return a}e.resolve=i})(D3||(D3={}));var Fm;(e=>{e.rootOverrideProps=["physics","events"],e.compositeNonOptionalOverrideProps=["geometry"],e.compositeEntireOverrideOverrideProps=["material"];function t(n,r){return{...Qs.defaultData,...r,component:n,overrides:new Ps,physics:void 0,events:void 0,type:"Instance"}}e.ofComponent=t;function i(n){let r=cb.fromObject(n.data);return t(n.id,r)}e.fromComponentData=i})(Fm||(Fm={}));var ub;(e=>{e.defaultData={type:"Page",...Qs.defaultData,physics:{...ob.defaultData,fusedBody:!1},...PN.defaultData,camera:Ew.defaultData};function t(i){return i.uiScene!==void 0}e.isUIPage=t})(ub||(ub={}));var LN;(e=>(e.defaultCamera={position:[0,0,1e3],scale:[1,1,1],rotation:[0,0,0],hiddenMatrix:sb.identity,name:"Play Camera",visible:!0,raycastLock:!1,physics:ob.defaultData,states:new ri,events:new ri,cloner:null,pathSnapping:{pathId:null,orientation:"tangential",slide:0,offset:0},...ab.defaultData},e.KeysByResetCategory={States:["states"],Events:["events"],Material:["material","materials"],Geometry:["geometry"],Position:["position"],Rotation:["rotation"],Scale:["scale"],Transform:["position","scale","rotation","hiddenMatrix"],Name:["name"],Visibility:["visible","raycastLock","flatShading","wireframe","side"],Shadows:["castShadow","receiveShadow"],Cloner:["cloner"],Physics:["physics"]},e.defaultMeshObject={name:"Rectangle",...Qs.defaultData,...Rm.defaultData,geometry:Dm.defaultData("RectangleGeometry"),material:ga.defaultTwoLayerData("phong","layer1","layer2")},e.defaultBooleanObject={name:"Boolean",...Qs.defaultData,...Rm.defaultData,geometry:Dm.defaultData("BooleanGeometry"),material:ga.defaultTwoLayerData("phong","layer1","layer2")},e.defaultShapeBlendObject={name:"Shape Blend",...Qs.defaultData,...Rm.defaultData,geometry:Dm.defaultData("ShapeBlendGeometry"),material:ga.defaultTwoLayerData("phong","layer1","layer2")},e.defaultTextObject={name:"Text",...Qs.defaultData,...Rm.defaultData,geometry:Dm.defaultData("TextGeometry"),material:ga.defaultTwoLayerData("phong","layer1","layer2")},e.defaultInputObject={name:"Input",...Qs.defaultData,...Rm.defaultData,geometry:Dm.defaultData("InputGeometry"),material:ga.defaultTwoLayerData("phong","layer1","layer2")}))(LN||(LN={}));var a0;(e=>{function t(s,a){let o={name:a};return s.type==="Mesh"?(o.geometry={},"material"in s&&(o.material={layers:new Ps}),"materials"in s&&(o.materials=s.materials.map(l=>({layers:new Ps})))):N0.is(s.type)&&(o.perspective={},o.orthographic={}),o}e.newEmpty=t;function i(s,a){if(a===void 0)return s;let o={...s};return"material"in o&&"material"in a&&a.material&&(o.material=Mw(o.material,l=>{if(typeof l!="string")for(let[c,u]of Object.entries(a.material.layers)){let h=l.layers.data(c);h&&da.patch(h,u)}}).data),o.materials&&a.materials&&(o.materials=Mw(o.materials,l=>{var c,u;for(let h=0;h<o.materials.length;h++){let d=a.materials[h];if(typeof d!="string")for(let[p,g]of Object.entries(d.layers)){let x=(u=(c=l[h])==null?void 0:c.layers)==null?void 0:u.data(p);x&&da.patch(x,g)}}}).data),o}function n(s,a){let o,l=[],c={orthographic:0,perspective:0,geometry:0};function u(h,d){for(let[p,g]of Object.entries(d.layers)){let{texture:x,...y}=g;if(x!==void 0&&Object.keys(x).length>0){let b={path:[...h,"layers",p,"texture"],props:x,type:0};l.push(b)}if(Object.keys(y).length>0){let b={path:[...h,"layers",p],props:y,type:0};l.push(b)}}}for(let[h,d]of Object.entries(a))if(h!=="name")if(h==="cloner")l.push(...yN.toOps(d,["cloner"]));else if(h==="pathSnapping")l.push({path:[h],props:{slide:d.slide,offset:d.offset},type:0});else if(h==="material")u(["material"],d);else if(h==="materials")for(let[p,g]of Object.entries(d))u(["materials",p],g);else if(c[h]===0){if(h==="geometry"&&d.extrusion!==void 0){let p={path:[h,"extrusion"],props:d.extrusion,type:0};l.push(p),d={...d},delete d.extrusion}if(Object.keys(d).length>0){let p={path:[h],props:d,type:0};l.push(p)}}else o===void 0&&(o={path:[],props:{},type:0},l.push(o)),o.props[h]=d;return l}e.toOps=n;function r(s,a){var l,c,u,h,d,p;if(a===void 0)return s;let o={...s};if(Object.assign(o,cb.merge(o,a)),Object.assign(o,{pathSnapping:Object.assign({},o.pathSnapping,{slide:((l=a.pathSnapping)==null?void 0:l.slide)??((c=o.pathSnapping)==null?void 0:c.slide)??0,offset:((u=a.pathSnapping)==null?void 0:u.offset)??((h=o.pathSnapping)==null?void 0:h.offset)??0})}),N0.is(s.type)){o.orthographic={...o.orthographic},o.perspective={...o.perspective};let g=a;((d=g.orthographic)==null?void 0:d.zoom)!==void 0&&(o.orthographic.zoom=g.orthographic.zoom),((p=g.perspective)==null?void 0:p.zoom)!==void 0&&(o.perspective.zoom=g.perspective.zoom),g.isUpVectorFlipped!==void 0&&(o.isUpVectorFlipped=g.isUpVectorFlipped),g.targetOffset!==void 0&&(o.targetOffset=g.targetOffset)}else if(s.type==="Mesh")"geometry"in a&&Object.assign(o,{geometry:MN.merge(o.geometry,a.geometry)}),(a.material||a.materials)&&(o=i(o,a)),o.cloner&&"cloner"in a&&Object.assign(o,{cloner:zm.merge(o.cloner,a.cloner)});else if(s.type==="Empty")o.cloner&&"cloner"in a&&Object.assign(o,{cloner:zm.merge(o.cloner,a.cloner)});else if(xN.is(s.type)){let g=a;g.intensity!==void 0&&(o.intensity=g.intensity),g.color!==void 0&&(typeof g.color=="string"?o.color=g.color:o.color=Ha.clone(g.color))}return o}e.patch=r})(a0||(a0={}));var R3;(e=>e.defaultData={enablePan:!0,enableZoom:!0,enableRotate:!0,enableDamping:!0,rotationLimitsMode:0,rotationVerticalOffset:{min:Math.PI/4,max:Math.PI/4},rotationHorizontalOffset:{min:Math.PI/4,max:Math.PI/4},rotationSoftLimit:2,panLimitsMode:0,panVerticalOffset:{min:250,max:250},panHorizontalOffset:{min:250,max:250},panSoftLimit:2,zoomLimitsEnabled:!1,zoomLimits:{min:.1,max:2},autoRotate:!1,autoRotateSpeed:2,autoRotateClockwise:!0,hoverRotatePanMode:0,hoverRotatePanStrength:20,hoverRotateDamping:.125,isTouchZoom:!0,orbitTouches:2,panTouches:3,resetHoverEffectOnPointerLeave:!0})(R3||(R3={}));var Vm;(e=>e.defaultData={orbitControls:R3.defaultData,playPage:UA,withBackground:!0,preventScroll:!1,preventTouchScroll:!1,hideCursor:!1,mouseEventTarget:"canvas",joystickSizeAndXYOffset:Array(12).fill(0).map((t,i)=>{let n=0,r=0;return i<5?r=-30:i<10&&(r=30),i===0||i===10||i===5?n=30:(i===4||i===11||i===9)&&(n=-30),[120,[n,r],"show"]}),settings:{image:{format:"jpg",ratio:1},video:{format:"mp4",imageFormat:"jpg",fps:30,mbps:80,ratio:Math.max(1,typeof window<"u"?Math.floor(window.devicePixelRatio):1),stopMode:"manual",duration:5e3},web:{logo:!0,compress:!0,preset:1,preload:!0,hint:!1,imageQuality:70}},stopRaycast:!0,hdTransmission:!1})(Vm||(Vm={}));var UN;(e=>e.defaultData={id:"basic",label:"Basic",style:"None",prompt:""})(UN||(UN={}));var NN;(e=>e.defaultData={weather:0,shadows:0,lightOrigin:0,temperature:0,sun:0,camera:0,environment:0,particles:0,nature:0,floor:0})(NN||(NN={}));var o0;(e=>(e.defaultData=()=>({mode:"line-art-both",prompt:"",negativePrompt:"",style:{...UN.defaultData},isRandomSeed:!0,seed:e.generateSeed(),guessMode:!1,advanced:!1,steps:20,guidanceScale:7.5,controlNetScale:1,modifiers:NN.defaultData}),e.generateSeed=()=>Math.round(Math.random()*1e5)))(o0||(o0={}));var Tw;(e=>{function t(n){return n.find(r=>r.data.type==="Page"&&r.data.globalPhysics.usePhysics)!==void 0}e.physicsEnabled=t;function i(n,r,s){n.scene.objects.traverseFrom(r,(a,o)=>{var l;if(o.type==="Instance"){let c=(l=B3.getComponentData(n,o.component))==null?void 0:l.data;c&&s(a,o,c.events)}else s(a,o,o.events)})}e.traverseModuleInstances=i})(Tw||(Tw={}));var l0;(e=>{e.TRASH_CAN_ID="830a2708-8ed9-49cf-a68e-085299892222",e.defaultLight={fi:-1,data:IN.defaultDirectionalLightData,id:"830a2708-8ed9-49cf-a68e-085299899103",children:[]};function t(r=!0,s=[]){let a=[],o=LN.defaultMeshObject;r&&(a.push({...e.defaultLight}),a.push({fi:1,id:"7ba78968-2a55-48f2-b14c-5191da3e075e",data:o,children:[]})),a.push(...s);let l=new Wa;return l.push({fi:1,id:UA,data:{...ub.defaultData,name:"Scene 1"},children:a}),l}e.createDefaultObjectTreeWithPage=t,e.defaultData={objects:t(),publish:Vm.defaultData,styles:o0.defaultData()},e.emptyDataWithoutPage=function(){return{objects:new Wa,publish:Vm.defaultData,styles:o0.defaultData()}},e.emptyDataWithPage=function(r=!0){return{objects:t(r),publish:Vm.defaultData,styles:o0.defaultData()}},e.emptyData=function(){return{objects:new Wa,publish:{...Vm.defaultData},styles:o0.defaultData()}};function i(r){return{...e.defaultData,objects:$c(r,Wa.prototype)}}e.withObjs=i;function n(r,s){return i([{id:r,data:s,children:[],fi:0}])}e.withObj=n})(l0||(l0={}));var NA;(e=>e.defaultData={preset:"fullscreen",allowResponsive:!1,size:[512,512],coords:[0,0],sceneScale:1,color:{r:0,g:0,b:0,a:.5}})(NA||(NA={}));var zN;(e=>(e.defaultData=t=>({url:t,name:"New Webhook",parametersSchemas:new ri}),e.defaultParameterValueByType=t=>t==="number"?0:t==="boolean"?!1:""))(zN||(zN={}));var X9;(e=>e.defaultData=(t,i="GET")=>({url:t,method:i,name:"New API",headers:new ri,queries:new ri,autoStart:!0}))(X9||(X9={}));var Xa;(e=>{function t(a){return a.textValue!==void 0}e.isTextValue=t;function i(a){return typeof a=="number"}e.isNumber=i;function n(a){return typeof a=="boolean"}e.isBoolean=n;function r(a){return t(a)?"string":n(a)?"boolean":"number"}e.typeOfVariable=r;function s(a){return e.isTextValue(a)?Array.isArray(a.textValue)?a.textValue.map(o=>o.toString().padStart(a.padding??2,"0")).join(a.deliminator??":")+(a.suffix!==void 0?" "+a.suffix:""):a.textValue.toString():e.isBoolean(a)?a?"True":"False":e.isNumber(a)?parseFloat(a.toFixed(3)).toString():a.toString()}e.getDisplayedValue=s})(Xa||(Xa={}));var FN;(e=>e.all=["images","videos","colors","audios","particles","fonts","materials","variables"])(FN||(FN={}));var q9;(e=>e.all=[...FN.all,"components"])(q9||(q9={}));var Y9;(e=>{function t(){return{images:new mi,videos:new mi,colors:new mi,audios:new mi,particles:new mi,fonts:new mi,materials:new mi,components:new mi,variables:new mi,userAPIs:new mi,userWebhooks:new mi}}e.defaultData=t})(Y9||(Y9={}));var sp;(e=>{function t(){return{images:new mi,videos:new mi,colors:new mi,audios:new mi,particles:new mi,fonts:new mi,materials:new mi,components:new mi,variables:new mi,userAPIs:new mi,userWebhooks:new mi}}e.defaultData=t})(sp||(sp={}));var zc;(e=>{function t(){let a={};return a["89b10010-844c-11ec-a8a3-0242ac120002"]={r:.5,g:.5,b:.5,a:1,name:"Default Color"},$c(a,mi.prototype)}e.defaultColors=t;function i(){return $c({},mi.prototype)}e.defaultImages=i;function n(){return{catelogs:new mi,materials:new mi,images:new mi,videos:new mi,colors:new mi,audios:new mi,particles:new mi,fonts:new mi,variables:new ri,userAPIs:new mi,userWebhooks:new mi,lib:sp.defaultData()}}e.emptyData=n;function r(a){switch(a){case"number":return{value:0,name:"Number"};case"boolean":return{value:!1,name:"Boolean"};case"string":return{value:{textValue:"String value"},name:"String"};case"time":let o=[0,0,0];return{name:"Time",value:{textValue:o,deliminator:":",padding:2,suffix:"AM"},dynamicVariableType:"time",format:"HH:mm:ss",format12h24h:"12ampm",timeZone:null,hasEnd:!1,endValue:{textValue:o,deliminator:":",padding:2,suffix:"AM"},autoStart:!0,repeat:!1};case"counter":return{name:"Counter",value:0,dynamicVariableType:"counter",updateInterval:1e3,increment:1,autoStart:!0,hasEnd:!0,endValue:60,repeat:!0,randomStart:!1,range:[0,100],decimals:0};case"random":return{name:"Random",value:0,dynamicVariableType:"random",updateInterval:1e3,increment:1,autoStart:!0,isStatic:!1,hasEnd:!0,endValue:60,repeat:!0,min:0,max:100,decimals:0};default:console.error("Unknown variable type",a)}}e.defaultVariables=r;function s(a,o){if(o.format==="HH:mm:ss"){let l=Math.floor(a/3600),c=Math.floor((a-l*3600)/60),u=Math.round(a-l*3600-c*60);return{textValue:[l,c,u]}}else if(o.format==="mm:ss"){let l=Math.floor(a/60),c=Math.round(a-l*60);return{textValue:[l,c]}}else return o.format==="number"?a=Math.round(a):a=Math.round(a*1e3)/1e3,a}e.getFormattedTimerTime=s})(zc||(zc={}));var P3;(e=>e.list=["idle","move","jump","run"])(P3||(P3={}));var O3;(e=>(e.defaultColliderData={type:"capsule",height:200,radius:50,position:[0,0,0],rotation:[0,0,0]},e.defaultDataThirdPerson={moveMode:"walk",forwardDirection:"+z",speedTranslate:1e3,speedRotate:100,runMultiplier:2,rotationMode:"normal",rotBy:"keys",rotByTouch:"drag",delayPos:[.3,.3],delayRot:[.3,.3],keyAssignments:[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX",""],["rotPosY",""],["rotNegX",""],["rotNegY",""],["jump","Space"],["run",""],["none","Ctrl"]],touchControl:!0,joystickPosLoc:5,joystickRotLoc:11,jumpTouchButtonLoc:9,collider:e.defaultColliderData,colliderHelperVisible:!0,collisionEnabled:!0,jumpPower:100,resetYPosition:3e3,alignToGround:!1,autoOrientMove:!0,orientWith:"camera",orientMode:"radial",delayPosCamera:.3,delayRotCamera:.3,camera:"",cameraXAxis:"Limit",cameraYAxis:"Free",cameraRotXLimits:[0,Math.PI/2],cameraRotYLimits:[-Math.PI/2,Math.PI/2],gameActions:{idle:new ri,move:new ri,jump:new ri,run:new ri},navmesh:{enabled:!1,ch:6,cs:6,walkableClimb:5,walkableHeight:1,walkableRadius:0,zones:"all",objects:[],helperVisible:!0,destinationHelperRadius:0,destinationHelperColor:er.fromHexAndA(3728051,1)}}))(O3||(O3={}));function Q9(e){e.layers.forEach(t=>{if(t.type==="depth"&&t.colorA!==void 0){let i=t.colorA,n=t.colorB,r=[[i.r,i.g,i.b,i.a],[n.r,n.g,n.b,n.a]],s=[0,1];for(let o=2;o<10;o++)r.push(r[1]),s.push(1);let a={...gd(ds(t),"type","visible","isVector","isWorldSpace","origin","alpha","mode"),near:Math.max(0,t.near),far:Math.max(0,t.far),colors:r,steps:s,num:2,direction:[1,0,0],smooth:!1,gradientType:1};Object.assign(t,a)}else if(t.type==="depth"&&t.gradientType===1&&(t.near<0||t.far<0)){let i={...ds(t),near:Math.max(t.near,0),far:Math.max(t.far,0)};Object.assign(t,i)}})}function Pm(e,t){Object.values(e.shared.materials).forEach(i=>t(i))}function Om(e,t){e.scene.objects.traverse((i,n)=>{"materials"in n?n.materials.forEach((r,s)=>{r===void 0&&(n.materials[s]=ga.defaultData(),r=n.materials[s]),typeof r!="string"&&t(r)}):"material"in n?typeof n.material!="string"&&(n.material===void 0&&(n.material=ga.defaultData()),t(n.material)):n.type==="Mesh"&&(n.material===void 0&&(n.material=ga.defaultData()),t(n.material)),"overrides"in n&&Object.values(n.overrides).forEach(r=>{r.material&&typeof r.material!="string"&&Object.getPrototypeOf(r.material)!==Ps.prototype&&t(r.material)})})}function jBe(e){Object.assign(e.scene.publish,{orbitControls:{...R3.defaultData,...ds(e.scene.publish.orbitControls)}})}function WBe(e){Object.assign(e.scene.publish.settings,{video:{...Vm.defaultData.settings.video,...ds(e.scene.publish.settings.video)}})}function XBe(e){function t(i){if(i.layers){for(let n of Object.values(i.layers))if(n){for(let[r,s]of Object.entries(n))if((k$.includes(r)||typeof s=="boolean")&&delete n[r],r==="texture")for(let[a,o]of Object.entries(s))(kBe.includes(a)||typeof o=="boolean")&&delete s[a]}}}e.scene.objects.traverse((i,n)=>{n.states.forEach(r=>{let s=r;s.material?t(s.material):s.materials&&s.materials.forEach(a=>{t(a)})})})}function qBe(e){e.scene.publish.withBackground=!0}function YBe(e){e.scene.publish.settings.web={compress:!0,preload:!0,preset:1,logo:!0,hint:!1}}function QBe(e){e.scene.objects.traverse((t,i)=>{let n=i.cloner;n&&(n.radial.scale=n.radial.scale.map(r=>r+1),n.linear.scale=n.linear.scale.map(r=>r+1))})}function KBe(e){e.scene.objects.traverse((t,i)=>{let n=i.geometry;n&&(n.type==="DodecahedronGeometry"||n.type==="IcosahedronGeometry")&&(n.detail=Math.round(n.detail))})}function JBe(e){e.scene.objects.traverse((t,i)=>{let n=e.scene.objects.unproxy().parent(t);if(n){let r=ds(e.scene.objects.data(n));r&&r.type==="Mesh"&&r.geometry.type==="BooleanGeometry"&&i.type==="Mesh"&&(i.visible=ds(i).booleanExclude!==!0)}})}function ZBe(e){e.scene.objects.traverse((t,i)=>{if(i.type==="Mesh"){let n=i;i.geometry.type==="NonParametricGeometry"?n.material!==void 0&&delete n.material:n.materials!==void 0&&delete n.materials}})}function $Be(e){function t(n){Object.setPrototypeOf(n,Ps.prototype),n.texture&&Object.setPrototypeOf(n.texture,Ps.prototype)}function i(n){Object.setPrototypeOf(n,Ps.prototype);for(let r in n)t(n[r])}e.scene.objects.traverse((n,r)=>{r.states.forEach(s=>{let a=s;if(a.material){let o=ds(a.material).layers;i(o),a.material.layers=o}if(a.materials)for(let o=0;o<a.materials.length;o++){let l=a.materials[o],c=ds(l).layers;i(c),l.layers=c}})})}function K9(e){e.layers===void 0&&Object.assign(e,ga.defaultTwoLayerData("lambert"))}function TI(e){!e.layers||e.layers.forEach(t=>{if(t.type==="depth"&&t.colors.length===10){let i=[...t.colors];i.push(t.colors[9]);let n=[...t.steps];n.push(t.steps[9]);let r={...ds(t),colors:i,steps:n};Object.assign(t,r)}})}function eIe(e){e.scene.objects.traverse((t,i)=>{i.type==="Mesh"&&(i.geometry.type==="BooleanGeometry"||i.geometry.type==="SubdivGeometry")&&(i.geometry.phongAngle=35)})}function J9(e){e.scene.objects.traverse((t,i)=>{"materials"in i?i.materials.forEach(n=>{typeof n!="string"&&TI(n)}):"material"in i&&typeof i.material!="string"&&TI(i.material)}),Object.values(e.shared.materials).forEach(t=>TI(t))}function tIe(e){e.scene.environment.ambientLight.softShadows=!1,e.scene.environment.ambientLight.softShadowQuality="low",e.scene.objects.traverse((t,i)=>{(i.type==="DirectionalLight"||i.type==="SpotLight")&&(i.shadowResolution=1024,i.shadowRadius=1,i.depth=1e5)}),e.shared.penumbraSize=new Array(5).fill(.5)}function iIe(e){e.shared.audios=$c({},mi.prototype)}function nIe(e){e.shared.videos=$c({},mi.prototype)}function rIe(e){let t=e.shared.materials;Object.entries(t).forEach(([i,n])=>{if(!n.layers){let r={name:"Untitled Material",layers:[{fi:0,data:{type:"light",category:"phong",alpha:.6,visible:!0,mode:0,specular:{r:.2,g:.2,b:.2},shininess:5},id:"layer1"},{fi:1,data:{type:"color",alpha:1,visible:!0,mode:0,color:{r:.2823529411764706,g:.2823529411764706,b:.30196078431372547}},id:"layer2"}]};Object.assign(t,{[i]:r})}})}function sIe(e){Object.entries(ds(e.shared.images)).filter(t=>t[1].asset===!1).map(t=>t[0]).forEach(t=>{delete e.shared.images[t]}),Object.entries(ds(e.shared.audios)).filter(t=>t[1].asset===!1).map(t=>t[0]).forEach(t=>{delete e.shared.audios[t]})}function aIe(e){e.scene.publish.settings.web.preload=!1}function Z9(e){e.layers&&e.layers.forEach(t=>{t.type==="depth"&&t.num!==void 0&&(t.colors=t.colors.slice(0,t.num),t.steps=t.steps.slice(0,t.num),delete t.num)})}function $9(e){e.layers&&e.layers.forEach(t=>{GBe(t)&&t.isMask===void 0&&(t.isMask=!1),(t.type==="texture"||t.type==="video")&&t.blending===void 0&&(t.blending=0),(t.type==="noise"||t.type==="displace"&&t.displacementType==="noise")&&(t.voronoiStyle===void 0&&(t.voronoiStyle=0),t.highCut===void 0&&(t.highCut=1),t.lowCut===void 0&&(t.lowCut=0),t.smoothness===void 0&&(t.smoothness=.3),t.seed===void 0&&(t.seed=0),t.quality===void 0&&(t.quality=1))})}function oIe(e){e.shared.fonts=$c({},mi.prototype)}function lIe(e){return e.replace(".typeface","").replace(/optimer/gi,"open sans").replace("space_mono","space mono").replace(/alma_mono/gi,"varela round").replace(/droid_sans_mono/gi,"noto sans mono").replace(/droid_sans|gentilis|gnomon_(simple|foreground)|helvetiker/gi,"roboto").replace(/droid_serif/gi,"roboto slab").replace("_sans"," sans").replace("crimson_text","crimson text").replace("medium_medium","medium").replace("fatface_fatface","fatface").replace("100hairline","thin").replace("200thin","extralight").replace("300light","light").replace("500medium","medium").replace("600semi","semibold").replace("800heavy","extrabold").replace("900black","black").replace(/bodoni_(11|16|24|36|48|72|96)([^_])/gi,"bodoni_$1_$2").replace(/bodoni_(11|16|24|36|48|72|96)/gi,"bodoni moda").replace(/(thin|hairline)(_regular)?/gi,"100").replace(/(extra|ultra)light(_regular)?/gi,"200").replace(/light(_regular)?/gi,"300").replace(/_book|_normal|_roman/gi,"_regular").replace(/medium(_regular)?/gi,"500").replace(/(semi|demi)bold(_regular)?/gi,"600").replace(/(extra|ultra)bold(_regular)?/gi,"800").replace(/bold(_regular)?/gi,"700").replace(/(black|heavy|fatface)(_regular)?/gi,"900").replace(/([1-9]00)_italic/gi,"$1italic").replace(/regularitalic/gi,"italic").replace(/regularitalic/gi,"italic").split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}function cIe(e){let t=[];e.scene.objects.traverse((i,n)=>{let r=n;if(r.type==="TextFrame"){let s=ga.defaultTwoLayerData("phong"),a=typeof r.color=="string"?e.shared.colors[r.color]:r.color;s.layers[1].data.color={r:a.r,g:a.g,b:a.b},s.layers[1].data.alpha=r.alpha;let o=lIe(r.font);e.shared.fonts[o]===void 0&&(e.shared.fonts[o]={name:o});let l={name:r.name,...Qs.defaultData,...Rm.defaultData,flatShading:!1,wireframe:!1,geometry:{...Dm.defaultData("TextGeometry"),width:r.width,height:r.height,font:o,depth:0,horizontalAlign:r.horizontalAlign,verticalAlign:r.verticalAlign,fontSize:r.fontSize*1.40625,lineHeight:r.lineHeight/1.40625,letterSpacing:r.letterSpacing-1,text:r.text,textTransform:r.textTransform,extrudeBevelSize:0,extrudeBevelSegments:1},material:s,states:ds(r.states),events:ds(r.events),visible:r.visible,raycastLock:r.raycastLock,position:r.position,rotation:r.rotation,scale:r.scale,hiddenMatrix:r.hiddenMatrix},c=ds(e.scene.objects).parent(i);e.scene.objects.insertAfter(c??null,i,[{id:i+"new",data:l,children:[]}]),t.push(i)}}),t.forEach(i=>{e.scene.objects.delete(i)})}function uIe(e){let t={0:"MouseDown",1:"MouseUp",2:"MouseHover",5:"KeyDown",6:"KeyUp",7:"Start",9:"LookAt",10:"Follow",11:"Scroll",12:"Audio",13:"GameControl"};e.scene.objects.traverse((i,n)=>{n.events.forEach(r=>{if(t[Number(r.type)])if(Object.assign(r,{type:t[Number(r.type)]}),r.type==="Audio"&&"audioEvent"in r&&(Object.assign(r,{playAudio:r.audioEvent}),delete r.audioEvent),r.type==="GameControl")Object.assign(r,{gameActions:{idle:new ri,move:new ri,jump:new ri}});else{let s=new ri;Object.assign(r,{actions:s}),(r.type==="MouseDown"||r.type==="MouseUp"||r.type==="KeyDown"||r.type==="KeyUp")&&"url"in r&&s.push({fi:0,id:qt.generateUUID(),data:{type:"Link",url:r.url,delay:0}}),"targets"in r&&(r.targets.forEach((a,o,l)=>{let c={state:void 0,repeat:0,delay:0,delayDirection:void 0,direction:"normal",duration:0,easing:4},u={easing:a.easing,duration:a.duration};a.easing===6?Object.assign(u,gd(a,"mass","stiffness","damping","velocity")):a.easing===5&&Object.assign(u,{control1:{...a.control1},control2:{...a.control2}});let h={repeat:a.repeat?-1:0,delay:a.delay,delayDirection:a.delayDirection,direction:a.cycle&&a.rewind?"pingpong-rewind":a.cycle?"pingpong":"normal"},d={state:a.state,...h,...u},p={allowSlerp:!0,type:"Transition",object:a.object,repeat:0,delay:0,delayDirection:void 0,direction:"normal",tweens:new ri({fi:0,id:qt.generateUUID(),data:c},{fi:1,id:qt.generateUUID(),data:d})};s.push({fi:l,id:o,data:p})}),delete r.targets)}})})}function hIe(e){e.scene.objects.traverse((t,i)=>{function n(r,s){var l;let a=new ri,o=[];if(i.events.forEach((c,u,h)=>{if(c.type==="Audio"&&c.trigger===s){let d;o.push(u),c.interaction==="play"?d={...gd(c,"interaction","audio","delay","volume","loop"),triggerAfter:"after"in c?c.after:void 0,toggle:"after"in c?c.toggle:void 0,type:"Audio"}:(c.interaction==="pause"||c.interaction==="stop")&&(d={...gd(c,"interaction","delay","object","playAudio"),type:"Audio"}),d&&a.push({fi:h,id:u,data:d})}}),o.forEach(c=>i.events.delete(c)),a.length){let c=(l=i.events.find(u=>u.type===r))==null?void 0:l.data;c?"actions"in c&&c.actions.insertBefore(null,a):i.events.insertBefore(null,[{id:qt.generateUUID(),data:{type:r,actions:a}}])}}n("Start","start"),n("MouseDown","mouseDown"),n("MouseUp","mouseUp"),n("KeyDown","keyDown"),n("KeyUp","keyUp")})}function eW(e){var i;let t=(i=e.layers.find(n=>n.type==="light"))==null?void 0:i.data;if((t==null?void 0:t.category)==="basic"){let n=da.defaultData("light","phong"),r=t;Object.assign(r,n),r.visible=!1}}function tW(e){Pm(e,eW),Om(e,eW)}function dIe(e){e.scene.objects.traverse((t,i)=>{i.type==="Mesh"&&i.geometry.type==="SubdivGeometry"&&(i.geometry.scaleBaked||(i.geometry.scaleBaked=[1,1,1]))})}function fIe(e){e.scene.objects.traverse((t,i)=>{(i.type==="Empty"||i.type==="Mesh")&&i.cloner&&!i.cloner.randomnessObject&&!i.cloner.toObject&&!i.cloner.randomness&&(i.cloner={...i.cloner,toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}})})}function pIe(e){e.scene.objects.traverse((t,i)=>{i.type==="Mesh"&&i.geometry.type==="NonParametricGeometry"&&!("material"in i)&&!("materials"in i)&&(i.material=ga.defaultTwoLayerData("phong"))})}function mIe(e){e.scene.publish.orbitControls.autoZoom===void 0&&(e.scene.publish.orbitControls.autoZoom=!1),e.scene.objects.traverse((t,i)=>{(i.type==="OrthographicCamera"||i.type==="PerspectiveCamera")&&(i.orthographic.autoZoom===void 0&&(i.orthographic.autoZoom=!1),i.orthographic.autoZoomFrustumSize===void 0&&(i.orthographic.autoZoomFrustumSize=790))})}function gIe(e){e.scene.objects.traverse((t,i)=>{i.pathSnapping===void 0&&(i.pathSnapping={pathId:null,slide:0,offset:0,orientation:"tangential"}),i.pathSnapping.offset===void 0&&(i.pathSnapping.offset=0)})}function vIe(e){e.scene.publish.mouseEventTarget===void 0&&(e.scene.publish.mouseEventTarget="canvas"),e.scene.publish.settings.web.hint===void 0&&(e.scene.publish.settings.web.hint=!1)}function yIe(e){let{video:t}=e.scene.publish.settings;t.format==="gif"&&t.fps>48&&(t.fps=15)}function xIe(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(n=>{n.type==="GameControl"&&(n.resetYPosition=Math.abs(n.resetYPosition-i.position[1]))})})}function bIe(e){let t=e.scene.environment.usePhysics;e.scene.objects.traverse((i,n)=>{t&&n.physics===null?n.collision=!1:n.collision="visibility"})}function SIe(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(n=>{n.type==="GameControl"&&(n.navmesh=O3.defaultDataThirdPerson.navmesh)})})}function _Ie(e){e.scene.styles||(e.scene.styles=o0.defaultData())}function iW(e){e.layers.forEach(t=>{t.type==="light"&&t.category!=="toon"&&t.occlusion===void 0&&(t.occlusion=!0)})}function AIe(e){e.scene.environment.ambientLight.occlusion===void 0&&(e.scene.environment.ambientLight.occlusion=!1),e.scene.environment.ambientLight.aoFullRes===void 0&&(e.scene.environment.ambientLight.aoFullRes=!1),e.scene.environment.ambientLight.radius===void 0&&(e.scene.environment.ambientLight.radius=256),e.scene.environment.ambientLight.bias===void 0&&(e.scene.environment.ambientLight.bias=.5),e.scene.environment.ambientLight.aoColor===void 0&&(e.scene.environment.ambientLight.aoColor={r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}),Om(e,iW),Pm(e,iW)}function wIe(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(n=>{n.type==="GameControl"&&Object.assign(n.gameActions,{run:new ri})})})}function MIe(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(n=>{n.type==="GameControl"&&(n.keyAssignments=[...n.keyAssignments,["run",""],["none","Ctrl"]])})})}function nW(e){e.layers&&e.layers.forEach(t=>{t.type==="light"&&t.bumpMapIntensity===void 0&&(t.bumpMapIntensity=5)})}function EIe(e,t){if(t<1&&(Om(e,Q9),Pm(e,Q9),e.schema=1),t<2&&(jBe(e),e.schema=2),t<3&&(XBe(e),e.schema=3),t<4&&(qBe(e),e.schema=4),t<5&&(YBe(e),e.schema=5),t<6&&(QBe(e),e.schema=6),t<7&&(KBe(e),e.schema=7),t<8&&(e.schema=8),t<9&&(J9(e),e.schema=9),t<10&&(eIe(e),e.schema=10),t<11&&(tIe(e),e.schema=11),t<12&&(J9(e),e.schema=12),t<13&&(iIe(e),e.schema=13),t<14&&(rIe(e),e.schema=14),t<15&&(sIe(e),e.schema=15),t<16&&(aIe(e),e.schema=16),t<17&&(Om(e,Z9),Pm(e,Z9),e.schema=17),t<18&&(Om(e,K9),Pm(e,K9),e.schema=18),t<19&&(WBe(e),e.schema=19),t<20&&(oIe(e),cIe(e),e.schema=20),t<21&&(uIe(e),hIe(e),e.schema=21),t<22&&(tW(e),e.schema=22),t<23&&(dIe(e),e.schema=23),t<24&&(fIe(e),e.schema=24),(t<25||e.shared.videos===void 0)&&(nIe(e),t<25&&(e.schema=25)),t<26&&(JBe(e),e.schema=26),t<27&&(ZBe(e),e.schema=27),t<28&&(tW(e),e.schema=28),t<29&&($Be(e),e.schema=29),t<30&&(pIe(e),e.schema=30),t<31&&(mIe(e),e.schema=31),t<33&&(gIe(e),e.schema=33),t<34&&(vIe(e),e.schema=34),t<35&&(yIe(e),e.schema=35),t<36&&(xIe(e),e.schema=36),t<37&&(bIe(e),e.schema=37),t<38&&(Om(e,$9),Pm(e,$9),e.schema=38),t<39&&(SIe(e),e.schema=39),t<40&&(_Ie(e),e.schema=40),t<41&&(AIe(e),e.schema=41),t<42&&(wIe(e),e.schema=42),t<43&&(MIe(e),e.schema=43),t<99){Om(e,nW),Pm(e,nW),e.scene.publish.playCamera===null&&(e.scene.publish.playCamera=Fb);let i=ds(e.scene.objects),n=e.scene.objects;e.scene.publish.playPage=UA,n.insertBefore(null,null,[{id:UA,data:{...ub.defaultData,backgroundColor:e.scene.backgroundColor,fog:e.scene.fog,postprocessing:e.scene.postprocessing,ao:gd(e.scene.environment.ambientLight,"occlusion","aoFullRes","radius","bias","aoColor"),publish:{playCamera:e.scene.publish.playCamera,gameControlObject:e.scene.publish.gameControlObject},shadow:gd(e.scene.environment.ambientLight,"softShadowQuality"),globalPhysics:{...lb.defaultData,...gd(e.scene.environment,"usePhysics","gravity")},camera:ds(e.scene.ownerCamera)??ub.defaultData.camera,name:"Scene"},children:[]}]);for(let a of i)a.id!==l0.TRASH_CAN_ID&&n.move(UA,a.fi,a.id);let r=0,s=0;e.shared.penumbraSize&&e.scene.objects.traverse((a,o)=>{o.type==="DirectionalLight"?(o.penumbraSize=e.shared.penumbraSize[Math.min(r,2)],r+=1):o.type==="SpotLight"&&(o.penumbraSize=e.shared.penumbraSize[3+Math.min(s,1)],s+=1),(o.physics===void 0||o.physics===null)&&o.type!=="Instance"&&(o.physics={},Object.assign(o.physics,ob.defaultData)),o.physics!==void 0&&o.physics!==null&&(o.physics.enabled=o.collision??"visibility",delete o.collision)}),e.schema=99}}function rW(e){e.layers&&e.layers.forEach(t=>{t.type==="light"&&t.alphaOverride===void 0&&(t.alphaOverride=1)})}function TIe(e){e.scene.objects.traverse((t,i)=>{let n=i.geometry;n&&n.type==="PathGeometry"&&(n.extrusion.capType="flat",n.extrusion.bevel=50,n.extrusion.bevelSides=6,n.extrusion.shape.type==="Custom"&&(n.extrusion.shape.shapeQuality="low"))})}function CIe(e){var t;Array.isArray(ds(e.events))&&((t=e.events)==null||t.forEach(i=>{"disabled"in i||(i.disabled=!1),(i.type==="MouseDown"||i.type==="MouseUp"||i.type==="MousePress")&&(i.mode=i.mode||"Object")}))}var e1=180/Math.PI;function sW(e){e.rotation=e.rotation.slice(0,3).map(t=>t*e1)}function q$(e){var i,n;sW(e),e.type==="Page"&&sW(e.camera),(i=e.states)==null||i.forEach(r=>{r.rotation===void 0||r.rotation===null||(r.rotation=r.rotation.slice(0,3).map(s=>s*e1))});let t=e.geometry;t&&t.type==="SphereGeometry"&&(t.thetaLength=(t.thetaLength??180)*e1),t&&t.type==="TorusGeometry"&&(t.arc=t.arc*e1),t&&t.type==="PathGeometry"&&(t.extrusion.angle*=e1,t.extrusion.twist*=e1),e.type==="Mesh"&&e.geometry.type==="TextGeometry"&&(e.geometry.text={textValue:e.geometry.text}),Array.isArray(ds(e.events))&&((n=e.events)==null||n.forEach(r=>{(r.type==="MouseDown"||r.type==="MouseUp"||r.type==="MousePress"||r.type==="KeyDown"||r.type==="KeyUp"||r.type==="KeyPress"||r.type==="Collision"||r.type==="Trigger")&&(r.runMode=r.toggle?"Toggle":"Repeat")}))}function DIe(e){e.shared.variables=$c({},mi.prototype)}function RIe(e){let t=ds(e.shared.variables);e.shared.variables=$c(Object.entries(t??{}).map(([i,n],r)=>({fi:r,id:i,data:n})),ri.prototype)}var Tf=115;function Y$(e,t){t(e.data);for(let i of e.children)Y$(i,t)}function PIe(e){let t=e.schema??104;t!==Tf&&t<105&&(Y$(e.asset,q$),e.schema=105)}function OIe(e){e.shared.particles=$c({},mi.prototype),e.shared.lib&&(e.shared.lib.particles=sp.defaultData().particles)}function BIe(e){e.scene.objects.traverse((t,i)=>{i.type==="Particle"&&typeof i.renderMaterial.size=="number"&&Object.assign(i.renderMaterial,{size:[i.renderMaterial.size,i.renderMaterial.size]})})}function IIe(e){e.scene.objects.traverse((t,i)=>{i.type==="Page"&&(i.postprocessing.depthOfField.focusDistance=100,i.postprocessing.depthOfField.focalLength=20,i.postprocessing.depthOfField.bokehScale=5)})}function LIe(e){e.scene.objects.traverse((t,i)=>{var n;Array.isArray(ds(i.events))!==!1&&((n=i.events)==null||n.forEach(r=>{var a,o,l,c,u,h,d,p,g,x,y;let s=r.runMode;r.type==="MouseDown"||r.type==="MouseUp"||r.type==="KeyDown"||r.type==="KeyUp"||r.type==="Collision"||r.type==="Trigger"?(a=r.actions)==null||a.forEach(b=>{b.type==="Transition"&&(b.runMode=s??"Repeat"),(b.type==="Animation"||b.type==="SwitchCamera")&&(b.runMode=s==="Toggle"?"Toggle":"Normal")}):r.type==="MouseHover"||r.type==="MousePress"||r.type==="KeyPress"?(o=r.actions)==null||o.forEach(b=>{(b.type==="Transition"||b.type==="Animation"||b.type==="SwitchCamera")&&(b.runMode="Toggle")}):r.type==="GameControl"?(delete r.actions,Object.keys(r.gameActions).forEach(b=>{var A;(A=r.gameActions[b])==null||A.forEach(w=>{w.type==="Transition"&&(w.runMode="Repeat"),w.type==="Animation"&&(w.runMode="Normal")})})):r.type==="DragDrop"?(delete r.actions,(c=(l=r.dragDropActions)==null?void 0:l.drag)==null||c.forEach(b=>{(b.type==="Transition"||b.type==="Animation"||b.type==="SwitchCamera")&&(b.runMode="Toggle")}),(h=(u=r.dragDropActions)==null?void 0:u.drop)==null||h.forEach(b=>{(b.type==="Transition"||b.type==="Animation"||b.type==="SwitchCamera")&&(b.runMode="Toggle")})):r.type==="Resize"?(delete r.actions,(d=r.breakpoints)==null||d.forEach(b=>{var A;(A=b.actions)==null||A.forEach(w=>{(w.type==="Transition"||w.type==="Animation"||w.type==="SwitchCamera")&&(w.runMode="Toggle")})})):r.type==="Start"?(p=r.actions)==null||p.forEach(b=>{b.type==="Transition"&&(b.runMode="Once"),(b.type==="Animation"||b.type==="SwitchCamera")&&(b.runMode="Normal")}):r.type==="VariableChange"||r.type==="Scroll"?(g=r.actions)==null||g.forEach(b=>{b.type==="Transition"&&(b.runMode="Repeat"),(b.type==="Animation"||b.type==="SwitchCamera")&&(b.runMode="Normal")}):r.type==="Conditional"&&(delete r.actions,(x=r.inActions)==null||x.forEach(b=>{b.type==="Transition"&&(b.runMode="Repeat"),(b.type==="Animation"||b.type==="SwitchCamera")&&(b.runMode="Normal")}),(y=r.outActions)==null||y.forEach(b=>{b.type==="Transition"&&(b.runMode="Repeat"),(b.type==="Animation"||b.type==="SwitchCamera")&&(b.runMode="Normal")}))}))})}function UIe(e){e.shared.userAPIs=$c({},mi.prototype),e.shared.userWebhooks=$c({},mi.prototype),e.shared.lib&&(e.shared.lib.userAPIs=sp.defaultData().userAPIs,e.shared.lib.userWebhooks=sp.defaultData().userWebhooks)}function Q$(e){let t=e.schema??0;if(t!==Tf){console.warn("updating from ",t,"to ",Tf),EIe(e,t),t<100&&(e.scene.publish.joystickSizeAndXYOffset===void 0&&(e.scene.publish.joystickSizeAndXYOffset=Vm.defaultData.joystickSizeAndXYOffset),e.schema=100),t<101&&(Om(e,rW),Pm(e,rW),e.schema=101),t<102&&(TIe(e),e.schema=102),t<104&&(e.shared.catelogs=new mi,e.shared.lib=sp.defaultData(),e.schema=104),t<105&&(DIe(e),e.scene.objects.traverse((i,n)=>{q$(n)}),e.schema=105);for(let i of Object.values(e.shared.lib.components))PIe(i);t<106&&(RIe(e),e.schema=106),t<107&&(e.shared.lib.variables=sp.defaultData().variables,e.schema=107),t<109&&(OIe(e),e.schema=109),t<110&&(BIe(e),e.schema=110),t<111&&(e.scene.objects.traverse((i,n)=>{CIe(n)}),e.schema=111),t<112&&(IIe(e),e.schema=112),t<113&&(LIe(e),e.schema=113),t<114&&(e.scene.publish.settings.web.imageQuality===void 0&&(e.scene.publish.settings.web.imageQuality=70),e.schema=114),t<115&&(UIe(e),e.schema=115)}}var B3;(e=>{e.defaultData={schema:Tf,scene:l0.defaultData,frames:new mi().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",NA.defaultData),shared:{...zc.emptyData(),colors:zc.defaultColors()}},e.emptyDataForImports=function(){let s=l0.emptyDataWithPage();return{schema:Tf,scene:s,frames:new mi().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",NA.defaultData),shared:{...zc.emptyData(),colors:zc.defaultColors(),images:zc.defaultImages()}}},e.emptyData=function(){return{schema:Tf,scene:l0.emptyDataWithPage(),frames:new mi().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",NA.defaultData),shared:zc.emptyData()}},e.clipboard2dData=function(){return{schema:Tf,scene:l0.emptyData(),frames:new mi,shared:zc.emptyData()}},e.collabHelper={...aN,updateSchema(s){return(s.schema??0)<Tf?Mw(s,Q$):(s.schema??0)-Tf}};function t(s){let a=e.collabHelper.updateSchema(s);return typeof a=="number"?a===0?s:null:a.data}e.updateSchemaDirectly=t;function i(s){return{...s,shared:{...s.shared,lib:sp.defaultData()}}}e.withoutLib=i;function n(s,a){let o=s.scene.objects.get(a);if(o&&o.data.type==="Component")return o;{let l=s.shared.lib.components[a];if(l)return l.asset}}e.getComponentData=n;function r(s){let a=Object.values(s.shared.userAPIs);for(let o of a){let l=o.headers;for(let c of l)if(c.data.key.toLowerCase()==="authorization"&&c.data.value!=="")return!0}return!1}e.hasSensitiveData=r})(B3||(B3={}));var VN;(e=>e.emptyImage={data:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=",name:"empty"})(VN||(VN={}));var aW;(e=>{function t(i){return!0}e.is=t})(aW||(aW={}));var I3;(e=>{e.defaultData={position:[0,0],scale:[1,1],rotation:0,shear:[0,0]};function t(n,r){return{position:(r==null?void 0:r.position)??n.position,rotation:(r==null?void 0:r.rotation)??n.rotation,scale:(r==null?void 0:r.scale)??n.scale,shear:(r==null?void 0:r.shear)??n.shear}}e.merge=t;function i(n,r){return l$({position:Gf.isEqual(n.position,r.position)?void 0:r.position,rotation:n.rotation===r.rotation?void 0:r.rotation,scale:Gf.isEqual(n.scale,r.scale)?void 0:r.scale,shear:n.shear&&r.shear&&Gf.isEqual(n.shear,r.shear)?void 0:r.shear})}e.diff=i})(I3||(I3={}));var HN;(e=>e.defaultData={horizontalConstraint:0,verticalConstraint:0})(HN||(HN={}));var oW;(e=>e.defaultData={direction:"row",wrap:"unwrap",align:"top-left",gap:10,rowGap:10,autoGap:!1,autoRowGap:!1,leftPadding:8,rightPadding:8,topPadding:8,bottomPadding:8})(oW||(oW={}));var L3;(e=>e.defaultData={opacity:1,fill:{color:er.fromHexAndA(nc,1),enabled:!0},stroke:{color:er.from0to1([0,0,0,1]),thickness:1,enabled:!1,mode:"inside"},layerBlur:{radius:2,enabled:!1},backgroundBlur:{radius:2,enabled:!1},dropShadow:{offset:[10,10],blurRadius:10,color:er.from0to1([0,0,0,1]),enabled:!1,spread:0},innerShadow:{offset:[10,10],blurRadius:10,color:er.from0to1([0,0,0,1]),enabled:!1,spread:0}})(L3||(L3={}));var c0;(e=>{function t(a,o){return{name:o}}e.newEmpty=t;function i(a,o){if(o===void 0)return a;let l={...a},c=["width","height","cornerRadius"];for(let u of c)u in l&&u in o&&o[u]!==void 0&&Object.assign(l,{[u]:o[u]});return l}function n(a,o){if(o===void 0)return a;let l={...a};return"fill"in l&&"fill"in o&&o.fill!==void 0&&Object.assign(l,{fill:{...l.fill,...o.fill}}),"stroke"in l&&"stroke"in o&&o.stroke!==void 0&&Object.assign(l,{stroke:{...l.stroke,...o.stroke}}),"layerBlur"in l&&"layerBlur"in o&&o.layerBlur!==void 0&&Object.assign(l,{layerBlur:{...l.layerBlur,...o.layerBlur}}),"backgroundBlur"in l&&"backgroundBlur"in o&&o.backgroundBlur!==void 0&&Object.assign(l,{backgroundBlur:{...l.backgroundBlur,...o.backgroundBlur}}),"dropShadow"in l&&"dropShadow"in o&&o.dropShadow!==void 0&&Object.assign(l,{dropShadow:{...l.dropShadow,...o.dropShadow}}),"innerShadow"in l&&"innerShadow"in o&&o.innerShadow!==void 0&&Object.assign(l,{innerShadow:{...l.innerShadow,...o.innerShadow}}),l}function r(a,o){if(o===void 0)return a;let l={...a};return Object.assign(l,I3.merge(l,o)),l=i(l,o),l=n(l,o),l}e.patch=r;function s(a,o){let l,c=[];for(let[u,h]of Object.entries(o))u!=="name"&&(l===void 0&&(l={path:[],props:{},type:0},c.push(l)),l.props[u]=h);return c}e.toOps=s})(c0||(c0={}));var Cw;(e=>e.defaultData={...I3.defaultData,...HN.defaultData,states:new ri,events:new ri,visible:!0,raycastLock:!1})(Cw||(Cw={}));var hb;(e=>e.defaultData={...Cw.defaultData,...L3.defaultData})(hb||(hb={}));var U3;(e=>e.defaultData={cornerRadius:[0,0,0,0]})(U3||(U3={}));var GN;(e=>e.defaultData={...hb.defaultData,type:"ellipse2d",width:100,height:100,name:"Ellipse"})(GN||(GN={}));var Dw;(e=>e.defaultData={...hb.defaultData,...U3.defaultData,type:"rectangle2d",width:100,height:100,name:"Rectangle"})(Dw||(Dw={}));var kN;(e=>e.defaultData={...hb.defaultData,type:"text2d",width:100,height:100,fontSize:12,lineHeight:1.2,letterSpacing:0,text:{textValue:"Hello world"},horizontalAlign:1,verticalAlign:1,textTransform:1,font:"Roboto_regular",name:"Text"})(kN||(kN={}));var jN;(e=>e.defaultData={...hb.defaultData,type:"path2d",path:"",name:"Path"})(jN||(jN={}));var lW;(e=>{function t(i){return i.type==="ellipse2d"||i.type==="rectangle2d"||i.type==="text2d"||i.type==="vector2d"||i.type==="path2d"}e.is=t})(lW||(lW={}));var N3;(e=>e.defaultData={...Cw.defaultData,name:"Group",type:"group2d"})(N3||(N3={}));var WN;(e=>e.defaultData=()=>({...Cw.defaultData,...U3.defaultData,...L3.defaultData,name:"Frame",type:"frame2d",clipped:!0,width:200,height:200,fill:{color:er.fromHexAndA(4737101,1),enabled:!0},stroke:{color:er.fromHexAndA(0,1),thickness:1,enabled:!1,mode:"inside"},backgroundBlur:{radius:2,enabled:!1},layerBlur:{radius:2,enabled:!1}}))(WN||(WN={}));var w0;(e=>{function t(a){switch(a){case"rectangle2d":return{...Dw.defaultData};case"ellipse2d":return{...GN.defaultData};case"text2d":return{...kN.defaultData};case"vector2d":return{...Dw.defaultData};case"path2d":return{...jN.defaultData};case"frame2d":return{...WN.defaultData()};case"group2d":return{...N3.defaultData}}}e.defaultData=t;function i(a){return"width"in a&&"height"in a?[typeof a.width=="number"?a.width*.5:0,typeof a.height=="number"?a.height*.5:0]:[0,0]}e.getPivot=i;function n(a){return a.type==="rectangle2d"||a.type==="ellipse2d"||a.type==="text2d"||a.type==="frame2d"}e.isResizeable=n;function r(a){return a.type==="frame2d"&&a.autoLayout!==void 0}e.isAutoLayoutable=r;function s(a){return a.type==="rectangle2d"||a.type==="frame2d"}e.hasCorners=s})(w0||(w0={}));var XN;(e=>(e.defaultData={name:"UI",type:"scene2d",objects:new Wa},e.emptyData=function(){return{type:"scene2d",objects:new Wa}}))(XN||(XN={}));function u0(e,t=!1){let i=e[0].index!==null,n=new Set(Object.keys(e[0].attributes)),r=new Set(Object.keys(e[0].morphAttributes)),s={},a={},o=e[0].morphTargetsRelative,l=new ii,c=0;for(let u=0;u<e.length;++u){let h=e[u],d=0;if(i!==(h.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(let p in h.attributes){if(!n.has(p))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+'. All geometries must have compatible attributes; make sure "'+p+'" attribute exists among all geometries, or in none of them.'),null;s[p]===void 0&&(s[p]=[]),s[p].push(h.attributes[p]),d++}if(d!==n.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". Make sure all geometries have the same number of attributes."),null;if(o!==h.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(let p in h.morphAttributes){if(!r.has(p))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+".  .morphAttributes must be consistent throughout all geometries."),null;a[p]===void 0&&(a[p]=[]),a[p].push(h.morphAttributes[p])}if(t){let p;if(i)p=h.index.count;else if(h.attributes.position!==void 0)p=h.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". The geometry must have either an index or a position attribute"),null;l.addGroup(c,p,u),c+=p}}if(i){let u=0,h=[];for(let d=0;d<e.length;++d){let p=e[d].index;for(let g=0;g<p.count;++g)h.push(p.getX(g)+u);u+=e[d].attributes.position.count}l.setIndex(h)}for(let u in s){let h=cW(s[u]);if(!h)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+u+" attribute."),null;l.setAttribute(u,h)}for(let u in a){let h=a[u][0].length;if(h===0)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[u]=[];for(let d=0;d<h;++d){let p=[];for(let x=0;x<a[u].length;++x)p.push(a[u][x][d]);let g=cW(p);if(!g)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+u+" morphAttribute."),null;l.morphAttributes[u].push(g)}}return l}function cW(e){let t,i,n,r=0;for(let o=0;o<e.length;++o){let l=e[o];if(l.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(t===void 0&&(t=l.array.constructor),t!==l.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(i===void 0&&(i=l.itemSize),i!==l.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(n===void 0&&(n=l.normalized),n!==l.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;r+=l.array.length}let s=new t(r),a=0;for(let o=0;o<e.length;++o)s.set(e[o].array,a),a+=e[o].array.length;return new vi(s,i,n)}var NIe=Math.pow(2,-24),BT=class{constructor(){}};function od(e,t,i){return i.min.x=t[e],i.min.y=t[e+1],i.min.z=t[e+2],i.max.x=t[e+3],i.max.y=t[e+4],i.max.z=t[e+5],i}function uW(e){let t=-1,i=-1/0;for(let n=0;n<3;n++){let r=e[n+3]-e[n];r>i&&(i=r,t=n)}return t}function hW(e,t){t.set(e)}function dW(e,t,i){let n,r;for(let s=0;s<3;s++){let a=s+3;n=e[s],r=t[s],i[s]=n<r?n:r,n=e[a],r=t[a],i[a]=n>r?n:r}}function IT(e,t,i){for(let n=0;n<3;n++){let r=t[e+2*n],s=t[e+2*n+1],a=r-s,o=r+s;a<i[n]&&(i[n]=a),o>i[n+3]&&(i[n+3]=o)}}function U_(e){let t=e[3]-e[0],i=e[4]-e[1],n=e[5]-e[2];return 2*(t*i+i*n+n*t)}function zIe(e,t){if(!e.index){let i=e.attributes.position.count,n=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,r;i>65535?r=new Uint32Array(new n(4*i)):r=new Uint16Array(new n(2*i)),e.setIndex(new vi(r,1));for(let s=0;s<i;s++)r[s]=s}}function FIe(e){if(!e.groups||!e.groups.length)return[{offset:0,count:e.index.count/3}];let t=[],i=new Set;for(let r of e.groups)i.add(r.start),i.add(r.start+r.count);let n=Array.from(i.values()).sort((r,s)=>r-s);for(let r=0;r<n.length-1;r++){let s=n[r],a=n[r+1];t.push({offset:s/3,count:(a-s)/3})}return t}function CI(e,t,i,n,r=null){let s=1/0,a=1/0,o=1/0,l=-1/0,c=-1/0,u=-1/0,h=1/0,d=1/0,p=1/0,g=-1/0,x=-1/0,y=-1/0,b=r!==null;for(let A=t*6,w=(t+i)*6;A<w;A+=6){let E=e[A+0],D=e[A+1],T=E-D,I=E+D;T<s&&(s=T),I>l&&(l=I),b&&E<h&&(h=E),b&&E>g&&(g=E);let R=e[A+2],O=e[A+3],P=R-O,U=R+O;P<a&&(a=P),U>c&&(c=U),b&&R<d&&(d=R),b&&R>x&&(x=R);let H=e[A+4],V=e[A+5],j=H-V,J=H+V;j<o&&(o=j),J>u&&(u=J),b&&H<p&&(p=H),b&&H>y&&(y=H)}n[0]=s,n[1]=a,n[2]=o,n[3]=l,n[4]=c,n[5]=u,b&&(r[0]=h,r[1]=d,r[2]=p,r[3]=g,r[4]=x,r[5]=y)}function VIe(e,t,i,n){let r=1/0,s=1/0,a=1/0,o=-1/0,l=-1/0,c=-1/0;for(let u=t*6,h=(t+i)*6;u<h;u+=6){let d=e[u+0];d<r&&(r=d),d>o&&(o=d);let p=e[u+2];p<s&&(s=p),p>l&&(l=p);let g=e[u+4];g<a&&(a=g),g>c&&(c=g)}n[0]=r,n[1]=s,n[2]=a,n[3]=o,n[4]=l,n[5]=c}function HIe(e,t,i,n,r){let s=i,a=i+n-1,o=r.pos,l=r.axis*2;for(;;){for(;s<=a&&t[s*6+l]<o;)s++;for(;s<=a&&t[a*6+l]>=o;)a--;if(s<a){for(let c=0;c<3;c++){let u=e[s*3+c];e[s*3+c]=e[a*3+c],e[a*3+c]=u;let h=t[s*6+c*2+0];t[s*6+c*2+0]=t[a*6+c*2+0],t[a*6+c*2+0]=h;let d=t[s*6+c*2+1];t[s*6+c*2+1]=t[a*6+c*2+1],t[a*6+c*2+1]=d}s++,a--}else return s}}var bf=32,GIe=(e,t)=>e.candidate-t.candidate,mm=new Array(bf).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),LT=new Float32Array(6);function kIe(e,t,i,n,r,s){let a=-1,o=0;if(s===0)a=uW(t),a!==-1&&(o=(t[a]+t[a+3])/2);else if(s===1)a=uW(e),a!==-1&&(o=jIe(i,n,r,a));else if(s===2){let l=U_(e),c=1.25*r,u=n*6,h=(n+r)*6;for(let d=0;d<3;d++){let p=t[d],g=(t[d+3]-p)/bf;if(r<bf/4){let x=[...mm];x.length=r;let y=0;for(let A=u;A<h;A+=6,y++){let w=x[y];w.candidate=i[A+2*d],w.count=0;let{bounds:E,leftCacheBounds:D,rightCacheBounds:T}=w;for(let I=0;I<3;I++)T[I]=1/0,T[I+3]=-1/0,D[I]=1/0,D[I+3]=-1/0,E[I]=1/0,E[I+3]=-1/0;IT(A,i,E)}x.sort(GIe);let b=r;for(let A=0;A<b;A++){let w=x[A];for(;A+1<b&&x[A+1].candidate===w.candidate;)x.splice(A+1,1),b--}for(let A=u;A<h;A+=6){let w=i[A+2*d];for(let E=0;E<b;E++){let D=x[E];w>=D.candidate?IT(A,i,D.rightCacheBounds):(IT(A,i,D.leftCacheBounds),D.count++)}}for(let A=0;A<b;A++){let w=x[A],E=w.count,D=r-w.count,T=w.leftCacheBounds,I=w.rightCacheBounds,R=0;E!==0&&(R=U_(T)/l);let O=0;D!==0&&(O=U_(I)/l);let P=1+1.25*(R*E+O*D);P<c&&(a=d,c=P,o=w.candidate)}}else{for(let b=0;b<bf;b++){let A=mm[b];A.count=0,A.candidate=p+g+b*g;let w=A.bounds;for(let E=0;E<3;E++)w[E]=1/0,w[E+3]=-1/0}for(let b=u;b<h;b+=6){let A=~~((i[b+2*d]-p)/g);A>=bf&&(A=bf-1);let w=mm[A];w.count++,IT(b,i,w.bounds)}let x=mm[bf-1];hW(x.bounds,x.rightCacheBounds);for(let b=bf-2;b>=0;b--){let A=mm[b],w=mm[b+1];dW(A.bounds,w.rightCacheBounds,A.rightCacheBounds)}let y=0;for(let b=0;b<bf-1;b++){let A=mm[b],w=A.count,E=A.bounds,D=mm[b+1].rightCacheBounds;w!==0&&(y===0?hW(E,LT):dW(E,LT,LT)),y+=w;let T=0,I=0;y!==0&&(T=U_(LT)/l);let R=r-y;R!==0&&(I=U_(D)/l);let O=1+1.25*(T*y+I*R);O<c&&(a=d,c=O,o=A.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${s} used.`);return{axis:a,pos:o}}function jIe(e,t,i,n){let r=0;for(let s=t,a=t+i;s<a;s++)r+=e[s*6+n*2];return r/i}function WIe(e,t){let i=e.attributes.position,n=e.index.array,r=n.length/3,s=new Float32Array(r*6),a=i.normalized,o=i.array,l=i.offset||0,c=3;i.isInterleavedBufferAttribute&&(c=i.data.stride);let u=["getX","getY","getZ"];for(let h=0;h<r;h++){let d=h*3,p=h*6,g,x,y;a?(g=n[d+0],x=n[d+1],y=n[d+2]):(g=n[d+0]*c+l,x=n[d+1]*c+l,y=n[d+2]*c+l);for(let b=0;b<3;b++){let A,w,E;a?(A=i[u[b]](g),w=i[u[b]](x),E=i[u[b]](y)):(A=o[g+b],w=o[x+b],E=o[y+b]);let D=A;w<D&&(D=w),E<D&&(D=E);let T=A;w>T&&(T=w),E>T&&(T=E);let I=(T-D)/2,R=b*2;s[p+R+0]=D+I,s[p+R+1]=I+(Math.abs(D)+I)*NIe,D<t[b]&&(t[b]=D),T>t[b+3]&&(t[b+3]=T)}}return s}function XIe(e,t){function i(b){d&&d(b/p)}function n(b,A,w,E=null,D=0){if(!g&&D>=l&&(g=!0,c&&(console.warn(`MeshBVH: Max depth of ${l} reached when generating BVH. Consider increasing maxDepth.`),console.warn(e))),w<=u||D>=l)return i(A+w),b.offset=A,b.count=w,b;let T=kIe(b.boundingData,E,a,A,w,h);if(T.axis===-1)return i(A+w),b.offset=A,b.count=w,b;let I=HIe(o,a,A,w,T);if(I===A||I===A+w)i(A+w),b.offset=A,b.count=w;else{b.splitAxis=T.axis;let R=new BT,O=A,P=I-A;b.left=R,R.boundingData=new Float32Array(6),CI(a,O,P,R.boundingData,s),n(R,O,P,s,D+1);let U=new BT,H=I,V=w-P;b.right=U,U.boundingData=new Float32Array(6),CI(a,H,V,U.boundingData,s),n(U,H,V,s,D+1)}return b}zIe(e,t);let r=new Float32Array(6),s=new Float32Array(6),a=WIe(e,r),o=e.index.array,l=t.maxDepth,c=t.verbose,u=t.maxLeafTris,h=t.strategy,d=t.onProgress,p=e.index.count/3,g=!1,x=[],y=FIe(e);if(y.length===1){let b=y[0],A=new BT;A.boundingData=r,VIe(a,b.offset,b.count,s),n(A,b.offset,b.count,s),x.push(A)}else for(let b of y){let A=new BT;A.boundingData=new Float32Array(6),CI(a,b.offset,b.count,A.boundingData,s),n(A,b.offset,b.count,s),x.push(A)}return x}function qIe(e,t){let i=XIe(e,t),n,r,s,a=[],o=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let u=0;u<i.length;u++){let h=i[u],d=l(h),p=new o(32*d);n=new Float32Array(p),r=new Uint32Array(p),s=new Uint16Array(p),c(0,h),a.push(p)}return a;function l(u){return u.count?1:1+l(u.left)+l(u.right)}function c(u,h){let d=u/4,p=u/2,g=!!h.count,x=h.boundingData;for(let y=0;y<6;y++)n[d+y]=x[y];if(g){let y=h.offset,b=h.count;return r[d+6]=y,s[p+14]=b,s[p+15]=65535,u+32}else{let y=h.left,b=h.right,A=h.splitAxis,w;if(w=c(u+32,y),w/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return r[d+6]=w/4,w=c(w,b),r[d+7]=A,w}}}var ap=class{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let i=1/0,n=-1/0;for(let r=0,s=e.length;r<s;r++){let a=e[r][t];i=a<i?a:i,n=a>n?a:n}this.min=i,this.max=n}setFromPoints(e,t){let i=1/0,n=-1/0;for(let r=0,s=t.length;r<s;r++){let a=t[r],o=e.dot(a);i=o<i?o:i,n=o>n?o:n}this.min=i,this.max=n}isSeparated(e){return this.min>e.max||e.min>this.max}};ap.prototype.setFromBox=function(){let e=new G;return function(t,i){let n=i.min,r=i.max,s=1/0,a=-1/0;for(let o=0;o<=1;o++)for(let l=0;l<=1;l++)for(let c=0;c<=1;c++){e.x=n.x*o+r.x*(1-o),e.y=n.y*l+r.y*(1-l),e.z=n.z*c+r.z*(1-c);let u=t.dot(e);s=Math.min(u,s),a=Math.max(u,a)}this.min=s,this.max=a}}();var YIe=function(){let e=new G,t=new G,i=new G;return function(n,r,s){let a=n.start,o=e,l=r.start,c=t;i.subVectors(a,l),e.subVectors(n.end,n.start),t.subVectors(r.end,r.start);let u=i.dot(c),h=c.dot(o),d=c.dot(c),p=i.dot(o),g=o.dot(o)*d-h*h,x,y;g!==0?x=(u*h-p*d)/g:x=0,y=(u+x*h)/d,s.x=x,s.y=y}}(),y5=function(){let e=new Ae,t=new G,i=new G;return function(n,r,s,a){YIe(n,r,e);let o=e.x,l=e.y;if(o>=0&&o<=1&&l>=0&&l<=1){n.at(o,s),r.at(l,a);return}else if(o>=0&&o<=1){l<0?r.at(0,a):r.at(1,a),n.closestPointToPoint(a,!0,s);return}else if(l>=0&&l<=1){o<0?n.at(0,s):n.at(1,s),r.closestPointToPoint(s,!0,a);return}else{let c;o<0?c=n.start:c=n.end;let u;l<0?u=r.start:u=r.end;let h=t,d=i;if(n.closestPointToPoint(u,!0,t),r.closestPointToPoint(c,!0,i),h.distanceToSquared(u)<=d.distanceToSquared(c)){s.copy(h),a.copy(u);return}else{s.copy(c),a.copy(d);return}}}}(),QIe=function(){let e=new G,t=new G,i=new _l,n=new Yc;return function(r,s){let{radius:a,center:o}=r,{a:l,b:c,c:u}=s;if(n.start=l,n.end=c,n.closestPointToPoint(o,!0,e).distanceTo(o)<=a||(n.start=l,n.end=u,n.closestPointToPoint(o,!0,e).distanceTo(o)<=a)||(n.start=c,n.end=u,n.closestPointToPoint(o,!0,e).distanceTo(o)<=a))return!0;let h=s.getPlane(i);if(Math.abs(h.distanceToPoint(o))<=a){let d=h.projectPoint(o,t);if(s.containsPoint(d))return!0}return!1}}(),KIe=1e-15;function Ux(e){return Math.abs(e)<KIe}var op=class extends ka{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new G),this.satBounds=new Array(4).fill().map(()=>new ap),this.points=[this.a,this.b,this.c],this.sphere=new Ol,this.plane=new _l,this.needsUpdate=!0}intersectsSphere(e){return QIe(e,this)}update(){let e=this.a,t=this.b,i=this.c,n=this.points,r=this.satAxes,s=this.satBounds,a=r[0],o=s[0];this.getNormal(a),o.setFromPoints(a,n);let l=r[1],c=s[1];l.subVectors(e,t),c.setFromPoints(l,n);let u=r[2],h=s[2];u.subVectors(t,i),h.setFromPoints(u,n);let d=r[3],p=s[3];d.subVectors(i,e),p.setFromPoints(d,n),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(a,e),this.needsUpdate=!1}};op.prototype.closestPointToSegment=function(){let e=new G,t=new G,i=new Yc;return function(n,r=null,s=null){let{start:a,end:o}=n,l=this.points,c,u=1/0;for(let h=0;h<3;h++){let d=(h+1)%3;i.start.copy(l[h]),i.end.copy(l[d]),y5(i,n,e,t),c=e.distanceToSquared(t),c<u&&(u=c,r&&r.copy(e),s&&s.copy(t))}return this.closestPointToPoint(a,e),c=a.distanceToSquared(e),c<u&&(u=c,r&&r.copy(e),s&&s.copy(a)),this.closestPointToPoint(o,e),c=o.distanceToSquared(e),c<u&&(u=c,r&&r.copy(e),s&&s.copy(o)),Math.sqrt(u)}}();op.prototype.intersectsTriangle=function(){let e=new op,t=new Array(3),i=new Array(3),n=new ap,r=new ap,s=new G,a=new G,o=new G,l=new G,c=new Yc,u=new Yc,h=new Yc;return function(d,p=null,g=!1){this.needsUpdate&&this.update(),d.isExtendedTriangle?d.needsUpdate&&d.update():(e.copy(d),e.update(),d=e);let x=this.plane,y=d.plane;if(Math.abs(x.normal.dot(y.normal))>1-1e-10){let b=this.satBounds,A=this.satAxes;i[0]=d.a,i[1]=d.b,i[2]=d.c;for(let D=0;D<4;D++){let T=b[D],I=A[D];if(n.setFromPoints(I,i),T.isSeparated(n))return!1}let w=d.satBounds,E=d.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let D=0;D<4;D++){let T=w[D],I=E[D];if(n.setFromPoints(I,t),T.isSeparated(n))return!1}for(let D=0;D<4;D++){let T=A[D];for(let I=0;I<4;I++){let R=E[I];if(s.crossVectors(T,R),n.setFromPoints(s,t),r.setFromPoints(s,i),n.isSeparated(r))return!1}}return p&&(g||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),p.start.set(0,0,0),p.end.set(0,0,0)),!0}else{let b=this.points,A=!1,w=0;for(let V=0;V<3;V++){let j=b[V],J=b[(V+1)%3];c.start.copy(j),c.end.copy(J),c.delta(a);let F=A?u.start:u.end,X=Ux(y.distanceToPoint(j));if(Ux(y.normal.dot(a))&&X){u.copy(c),w=2;break}if((y.intersectLine(c,F)||X)&&!Ux(F.distanceTo(J))){if(w++,A)break;A=!0}}if(w===1&&d.containsPoint(u.end))return p&&(p.start.copy(u.end),p.end.copy(u.end)),!0;if(w!==2)return!1;let E=d.points,D=!1,T=0;for(let V=0;V<3;V++){let j=E[V],J=E[(V+1)%3];c.start.copy(j),c.end.copy(J),c.delta(o);let F=D?h.start:h.end,X=Ux(x.distanceToPoint(j));if(Ux(x.normal.dot(o))&&X){h.copy(c),T=2;break}if((x.intersectLine(c,F)||X)&&!Ux(F.distanceTo(J))){if(T++,D)break;D=!0}}if(T===1&&this.containsPoint(h.end))return p&&(p.start.copy(h.end),p.end.copy(h.end)),!0;if(T!==2)return!1;if(u.delta(a),h.delta(o),a.dot(o)<0){let V=h.start;h.start=h.end,h.end=V}let I=u.start.dot(a),R=u.end.dot(a),O=h.start.dot(a),P=h.end.dot(a),U=R<O,H=I<P;return I!==P&&O!==R&&U===H?!1:(p&&(l.subVectors(u.start,h.start),l.dot(a)>0?p.start.copy(u.start):p.start.copy(h.start),l.subVectors(u.end,h.end),l.dot(a)<0?p.end.copy(u.end):p.end.copy(h.end)),!0)}}}();op.prototype.distanceToPoint=function(){let e=new G;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}();op.prototype.distanceToTriangle=function(){let e=new G,t=new G,i=["a","b","c"],n=new Yc,r=new Yc;return function(s,a=null,o=null){let l=a||o?n:null;if(this.intersectsTriangle(s,l))return(a||o)&&(a&&l.getCenter(a),o&&l.getCenter(o)),0;let c=1/0;for(let u=0;u<3;u++){let h,d=i[u],p=s[d];this.closestPointToPoint(p,e),h=p.distanceToSquared(e),h<c&&(c=h,a&&a.copy(e),o&&o.copy(p));let g=this[d];s.closestPointToPoint(g,e),h=g.distanceToSquared(e),h<c&&(c=h,a&&a.copy(g),o&&o.copy(e))}for(let u=0;u<3;u++){let h=i[u],d=i[(u+1)%3];n.set(this[h],this[d]);for(let p=0;p<3;p++){let g=i[p],x=i[(p+1)%3];r.set(s[g],s[x]),y5(n,r,e,t);let y=e.distanceToSquared(t);y<c&&(c=y,a&&a.copy(e),o&&o.copy(t))}}return Math.sqrt(c)}}();var Md=class{constructor(e,t,i){this.isOrientedBox=!0,this.min=new G,this.max=new G,this.matrix=new Bt,this.invMatrix=new Bt,this.points=new Array(8).fill().map(()=>new G),this.satAxes=new Array(3).fill().map(()=>new G),this.satBounds=new Array(3).fill().map(()=>new ap),this.alignedSatBounds=new Array(3).fill().map(()=>new ap),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),i&&this.matrix.copy(i)}set(e,t,i){this.min.copy(e),this.max.copy(t),this.matrix.copy(i),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}};Md.prototype.update=function(){return function(){let e=this.matrix,t=this.min,i=this.max,n=this.points;for(let l=0;l<=1;l++)for(let c=0;c<=1;c++)for(let u=0;u<=1;u++){let h=1*l|2*c|4*u,d=n[h];d.x=l?i.x:t.x,d.y=c?i.y:t.y,d.z=u?i.z:t.z,d.applyMatrix4(e)}let r=this.satBounds,s=this.satAxes,a=n[0];for(let l=0;l<3;l++){let c=s[l],u=r[l],h=1<<l,d=n[h];c.subVectors(a,d),u.setFromPoints(c,n)}let o=this.alignedSatBounds;o[0].setFromPointsField(n,"x"),o[1].setFromPointsField(n,"y"),o[2].setFromPointsField(n,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();Md.prototype.intersectsBox=function(){let e=new ap;return function(t){this.needsUpdate&&this.update();let i=t.min,n=t.max,r=this.satBounds,s=this.satAxes,a=this.alignedSatBounds;if(e.min=i.x,e.max=n.x,a[0].isSeparated(e)||(e.min=i.y,e.max=n.y,a[1].isSeparated(e))||(e.min=i.z,e.max=n.z,a[2].isSeparated(e)))return!1;for(let o=0;o<3;o++){let l=s[o],c=r[o];if(e.setFromBox(l,t),c.isSeparated(e))return!1}return!0}}();Md.prototype.intersectsTriangle=function(){let e=new op,t=new Array(3),i=new ap,n=new ap,r=new G;return function(s){this.needsUpdate&&this.update(),s.isExtendedTriangle?s.needsUpdate&&s.update():(e.copy(s),e.update(),s=e);let a=this.satBounds,o=this.satAxes;t[0]=s.a,t[1]=s.b,t[2]=s.c;for(let h=0;h<3;h++){let d=a[h],p=o[h];if(i.setFromPoints(p,t),d.isSeparated(i))return!1}let l=s.satBounds,c=s.satAxes,u=this.points;for(let h=0;h<3;h++){let d=l[h],p=c[h];if(i.setFromPoints(p,u),d.isSeparated(i))return!1}for(let h=0;h<3;h++){let d=o[h];for(let p=0;p<4;p++){let g=c[p];if(r.crossVectors(d,g),i.setFromPoints(r,t),n.setFromPoints(r,u),i.isSeparated(n))return!1}}return!0}}();Md.prototype.closestPointToPoint=function(){return function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t}}();Md.prototype.distanceToPoint=function(){let e=new G;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}();Md.prototype.distanceToBox=function(){let e=["x","y","z"],t=new Array(12).fill().map(()=>new Yc),i=new Array(12).fill().map(()=>new Yc),n=new G,r=new G;return function(s,a=0,o=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(s))return(o||l)&&(s.getCenter(r),this.closestPointToPoint(r,n),s.closestPointToPoint(n,r),o&&o.copy(n),l&&l.copy(r)),0;let c=a*a,u=s.min,h=s.max,d=this.points,p=1/0;for(let x=0;x<8;x++){let y=d[x];r.copy(y).clamp(u,h);let b=y.distanceToSquared(r);if(b<p&&(p=b,o&&o.copy(y),l&&l.copy(r),b<c))return Math.sqrt(b)}let g=0;for(let x=0;x<3;x++)for(let y=0;y<=1;y++)for(let b=0;b<=1;b++){let A=(x+1)%3,w=(x+2)%3,E=y<<A|b<<w,D=1<<x|y<<A|b<<w,T=d[E],I=d[D];t[g].set(T,I);let R=e[x],O=e[A],P=e[w],U=i[g],H=U.start,V=U.end;H[R]=u[R],H[O]=y?u[O]:h[O],H[P]=b?u[P]:h[O],V[R]=h[R],V[O]=y?u[O]:h[O],V[P]=b?u[P]:h[O],g++}for(let x=0;x<=1;x++)for(let y=0;y<=1;y++)for(let b=0;b<=1;b++){r.x=x?h.x:u.x,r.y=y?h.y:u.y,r.z=b?h.z:u.z,this.closestPointToPoint(r,n);let A=r.distanceToSquared(n);if(A<p&&(p=A,o&&o.copy(n),l&&l.copy(r),A<c))return Math.sqrt(A)}for(let x=0;x<12;x++){let y=t[x];for(let b=0;b<12;b++){let A=i[b];y5(y,A,n,r);let w=n.distanceToSquared(r);if(w<p&&(p=w,o&&o.copy(n),l&&l.copy(r),w<c))return Math.sqrt(w)}}return Math.sqrt(p)}}();var Nx=new G,zx=new G,Fx=new G,UT=new Ae,NT=new Ae,zT=new Ae,fW=new G,pW=new G,mW=new G,FT=new G;function JIe(e,t,i,n,r,s){let a;return s===va?a=e.intersectTriangle(n,i,t,!0,r):a=e.intersectTriangle(t,i,n,s!==yo,r),a===null?null:{distance:e.origin.distanceTo(r),point:r.clone()}}function ZIe(e,t,i,n,r,s,a,o,l){Nx.fromBufferAttribute(t,s),zx.fromBufferAttribute(t,a),Fx.fromBufferAttribute(t,o);let c=JIe(e,Nx,zx,Fx,FT,l);if(c){n&&(UT.fromBufferAttribute(n,s),NT.fromBufferAttribute(n,a),zT.fromBufferAttribute(n,o),c.uv=ka.getInterpolation(FT,Nx,zx,Fx,UT,NT,zT,new Ae)),r&&(UT.fromBufferAttribute(r,s),NT.fromBufferAttribute(r,a),zT.fromBufferAttribute(r,o),c.uv1=ka.getInterpolation(FT,Nx,zx,Fx,UT,NT,zT,new Ae)),i&&(fW.fromBufferAttribute(i,s),pW.fromBufferAttribute(i,a),mW.fromBufferAttribute(i,o),c.normal=ka.getInterpolation(FT,Nx,zx,Fx,fW,pW,mW,new G),c.normal.dot(e.direction)>0&&c.normal.multiplyScalar(-1));let u={a:s,b:a,c:o,normal:new G,materialIndex:0};ka.getNormal(Nx,zx,Fx,u.normal),c.face=u,c.faceIndex=s}return c}function K$(e,t,i,n,r){let s=n*3,a=e.index.getX(s),o=e.index.getX(s+1),l=e.index.getX(s+2),{position:c,normal:u,uv:h,uv1:d}=e.attributes,p=ZIe(i,c,u,h,d,a,o,l,t);return p?(p.faceIndex=n,r&&r.push(p),p):null}function $Ie(e,t,i,n,r,s){for(let a=n,o=n+r;a<o;a++)K$(e,t,i,a,s)}function eLe(e,t,i,n,r){let s=1/0,a=null;for(let o=n,l=n+r;o<l;o++){let c=K$(e,t,i,o);c&&c.distance<s&&(a=c,s=c.distance)}return a}function rd(e,t,i,n){let r=e.a,s=e.b,a=e.c,o=t,l=t+1,c=t+2;i&&(o=i.getX(t),l=i.getX(t+1),c=i.getX(t+2)),r.x=n.getX(o),r.y=n.getY(o),r.z=n.getZ(o),s.x=n.getX(l),s.y=n.getY(l),s.z=n.getZ(l),a.x=n.getX(c),a.y=n.getY(c),a.z=n.getZ(c)}function gW(e,t,i,n,r,s,a){let o=i.index,l=i.attributes.position;for(let c=e,u=t+e;c<u;c++)if(rd(a,c*3,o,l),a.needsUpdate=!0,n(a,c,r,s))return!0;return!1}var J$=class{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){let e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}};function Bm(e,t){return t[e+15]===65535}function C1(e,t){return t[e+6]}function Rw(e,t){return t[e+14]}function Pw(e){return e+8}function Ow(e,t){return t[e+6]}function tLe(e,t){return t[e+7]}var v1=new ps,z3=new G,iLe=["x","y","z"];function qN(e,t,i,n,r){let s=e*2,a=Vb,o=Ym,l=Qm;if(Bm(s,o)){let c=C1(e,l),u=Rw(s,o);$Ie(t,i,n,c,u,r)}else{let c=Pw(e);F3(c,a,n,z3)&&qN(c,t,i,n,r);let u=Ow(e,l);F3(u,a,n,z3)&&qN(u,t,i,n,r)}}function YN(e,t,i,n){let r=e*2,s=Vb,a=Ym,o=Qm;if(Bm(r,a)){let l=C1(e,o),c=Rw(r,a);return eLe(t,i,n,l,c)}else{let l=tLe(e,o),c=iLe[l],u=n.direction[c]>=0,h,d;u?(h=Pw(e),d=Ow(e,o)):(h=Ow(e,o),d=Pw(e));let p=F3(h,s,n,z3)?YN(h,t,i,n):null;if(p){let x=p.point[c];if(u?x<=s[d+l]:x>=s[d+l+3])return p}let g=F3(d,s,n,z3)?YN(d,t,i,n):null;return p&&g?p.distance<=g.distance?p:g:p||g||null}}var nLe=function(){let e,t,i=[],n=new J$(()=>new ps);return function(...s){e=n.getPrimitive(),t=n.getPrimitive(),i.push(e,t);let a=r(...s);n.releasePrimitive(e),n.releasePrimitive(t),i.pop(),i.pop();let o=i.length;return o>0&&(t=i[o-1],e=i[o-2]),a};function r(s,a,o,l,c=null,u=0,h=0){function d(A){let w=A*2,E=Ym,D=Qm;for(;!Bm(w,E);)A=Pw(A),w=A*2;return C1(A,D)}function p(A){let w=A*2,E=Ym,D=Qm;for(;!Bm(w,E);)A=Ow(A,D),w=A*2;return C1(A,D)+Rw(w,E)}let g=s*2,x=Vb,y=Ym,b=Qm;if(Bm(g,y)){let A=C1(s,b),w=Rw(g,y);return od(s,x,e),l(A,w,!1,h,u+s,e)}else{let A=Pw(s),w=Ow(s,b),E=A,D=w,T,I,R,O;if(c&&(R=e,O=t,od(E,x,R),od(D,x,O),T=c(R),I=c(O),I<T)){E=w,D=A;let F=T;T=I,I=F,R=O}R||(R=e,od(E,x,R));let P=Bm(E*2,y),U=o(R,P,T,h+1,u+E),H;if(U===2){let F=d(E),X=p(E)-F;H=l(F,X,!0,h+1,u+E,R)}else H=U&&r(E,a,o,l,c,u,h+1);if(H)return!0;O=t,od(D,x,O);let V=Bm(D*2,y),j=o(O,V,I,h+1,u+D),J;if(j===2){let F=d(D),X=p(D)-F;J=l(F,X,!0,h+1,u+D,O)}else J=j&&r(D,a,o,l,c,u,h+1);return!!J}}}(),rLe=function(){let e=new op,t=new op,i=new Bt,n=new Md,r=new Md;return function s(a,o,l,c,u=null){let h=a*2,d=Vb,p=Ym,g=Qm;if(u===null&&(l.boundingBox||l.computeBoundingBox(),n.set(l.boundingBox.min,l.boundingBox.max,c),u=n),Bm(h,p)){let x=o,y=x.index,b=x.attributes.position,A=l.index,w=l.attributes.position,E=C1(a,g),D=Rw(h,p);if(i.copy(c).invert(),l.boundsTree)return od(a,d,r),r.matrix.copy(i),r.needsUpdate=!0,l.boundsTree.shapecast({intersectsBounds:T=>r.intersectsBox(T),intersectsTriangle:T=>{T.a.applyMatrix4(c),T.b.applyMatrix4(c),T.c.applyMatrix4(c),T.needsUpdate=!0;for(let I=E*3,R=(D+E)*3;I<R;I+=3)if(rd(t,I,y,b),t.needsUpdate=!0,T.intersectsTriangle(t))return!0;return!1}});for(let T=E*3,I=D+E*3;T<I;T+=3){rd(e,T,y,b),e.a.applyMatrix4(i),e.b.applyMatrix4(i),e.c.applyMatrix4(i),e.needsUpdate=!0;for(let R=0,O=A.count;R<O;R+=3)if(rd(t,R,A,w),t.needsUpdate=!0,e.intersectsTriangle(t))return!0}}else{let x=a+8,y=g[a+6];return od(x,d,v1),!!(u.intersectsBox(v1)&&s(x,o,l,c,u)||(od(y,d,v1),u.intersectsBox(v1)&&s(y,o,l,c,u)))}}}();function F3(e,t,i,n){return od(e,t,v1),i.intersectBox(v1,n)}var QN=[],VC,Vb,Ym,Qm;function cA(e){VC&&QN.push(VC),VC=e,Vb=new Float32Array(e),Ym=new Uint16Array(e),Qm=new Uint32Array(e)}function VT(){VC=null,Vb=null,Ym=null,Qm=null,QN.length&&cA(QN.pop())}var DI=Symbol("skip tree generation"),RI=new ps,PI=new ps,Vx=new Bt,Rv=new Md,N_=new Md,z_=new G,HT=new G,sLe=new G,aLe=new G,oLe=new G,vW=new ps,jh=new J$(()=>new op),zA=class{static serialize(e,t={}){if(t.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),zA.serialize(arguments[0],{cloneBuffers:arguments[2]===void 0?!0:arguments[2]});t={cloneBuffers:!0,...t};let i=e.geometry,n=e._roots,r=i.getIndex(),s;return t.cloneBuffers?s={roots:n.map(a=>a.slice()),index:r.array.slice()}:s={roots:n,index:r.array},s}static deserialize(e,t,i={}){if(typeof i=="boolean")return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),zA.deserialize(arguments[0],arguments[1],{setIndex:arguments[2]===void 0?!0:arguments[2]});i={setIndex:!0,...i};let{index:n,roots:r}=e,s=new zA(t,{...i,[DI]:!0});if(s._roots=r,i.setIndex){let a=t.getIndex();if(a===null){let o=new vi(e.index,1,!1);t.setIndex(o)}else a.array!==n&&(a.array.set(n),a.needsUpdate=!0)}return s}constructor(e,t={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[DI]:!1},t),t.useSharedArrayBuffer&&typeof SharedArrayBuffer>"u")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,t[DI]||(this._roots=qIe(e,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new ps))),this.geometry=e}refit(e=null){e&&Array.isArray(e)&&(e=new Set(e));let t=this.geometry,i=t.index.array,n=t.attributes.position,r,s,a,o,l=0,c=this._roots;for(let h=0,d=c.length;h<d;h++)r=c[h],s=new Uint32Array(r),a=new Uint16Array(r),o=new Float32Array(r),u(0,l),l+=r.byteLength;function u(h,d,p=!1){let g=h*2;if(a[g+15]===65535){let x=s[h+6],y=a[g+14],b=1/0,A=1/0,w=1/0,E=-1/0,D=-1/0,T=-1/0;for(let I=3*x,R=3*(x+y);I<R;I++){let O=i[I],P=n.getX(O),U=n.getY(O),H=n.getZ(O);P<b&&(b=P),P>E&&(E=P),U<A&&(A=U),U>D&&(D=U),H<w&&(w=H),H>T&&(T=H)}return o[h+0]!==b||o[h+1]!==A||o[h+2]!==w||o[h+3]!==E||o[h+4]!==D||o[h+5]!==T?(o[h+0]=b,o[h+1]=A,o[h+2]=w,o[h+3]=E,o[h+4]=D,o[h+5]=T,!0):!1}else{let x=h+8,y=s[h+6],b=x+d,A=y+d,w=p,E=!1,D=!1;e?w||(E=e.has(b),D=e.has(A),w=!E&&!D):(E=!0,D=!0);let T=w||E,I=w||D,R=!1;T&&(R=u(x,d,w));let O=!1;I&&(O=u(y,d,w));let P=R||O;if(P)for(let U=0;U<3;U++){let H=x+U,V=y+U,j=o[H],J=o[H+3],F=o[V],X=o[V+3];o[h+U]=j<F?j:F,o[h+U+3]=J>X?J:X}return P}}}traverse(e,t=0){let i=this._roots[t],n=new Uint32Array(i),r=new Uint16Array(i);s(0);function s(a,o=0){let l=a*2,c=r[l+15]===65535;if(c){let u=n[a+6],h=r[l+14];e(o,c,new Float32Array(i,a*4,6),u,h)}else{let u=a+8,h=n[a+6],d=n[a+7];e(o,c,new Float32Array(i,a*4,6),d)||(s(u,o+1),s(h,o+1))}}}raycast(e,t=Zu){let i=this._roots,n=this.geometry,r=[],s=t.isMaterial,a=Array.isArray(t),o=n.groups,l=s?t.side:t;for(let c=0,u=i.length;c<u;c++){let h=a?t[o[c].materialIndex].side:l,d=r.length;if(cA(i[c]),qN(0,n,h,e,r),VT(),a){let p=o[c].materialIndex;for(let g=d,x=r.length;g<x;g++)r[g].face.materialIndex=p}}return r}raycastFirst(e,t=Zu){let i=this._roots,n=this.geometry,r=t.isMaterial,s=Array.isArray(t),a=null,o=n.groups,l=r?t.side:t;for(let c=0,u=i.length;c<u;c++){let h=s?t[o[c].materialIndex].side:l;cA(i[c]);let d=YN(0,n,h,e);VT(),d!=null&&(a==null||d.distance<a.distance)&&(a=d,s&&(d.face.materialIndex=o[c].materialIndex))}return a}intersectsGeometry(e,t){let i=this.geometry,n=!1;for(let r of this._roots)if(cA(r),n=rLe(0,i,e,t),VT(),n)break;return n}shapecast(e,t,i){let n=this.geometry;if(e instanceof Function){if(t){let h=t;t=(d,p,g,x)=>{let y=p*3;return h(d,y,y+1,y+2,g,x)}}e={boundsTraverseOrder:i,intersectsBounds:e,intersectsTriangle:t,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}let r=jh.getPrimitive(),{boundsTraverseOrder:s,intersectsBounds:a,intersectsRange:o,intersectsTriangle:l}=e;if(o&&l){let h=o;o=(d,p,g,x,y)=>h(d,p,g,x,y)?!0:gW(d,p,n,l,g,x,r)}else o||(l?o=(h,d,p,g)=>gW(h,d,n,l,p,g,r):o=(h,d,p)=>p);let c=!1,u=0;for(let h of this._roots){if(cA(h),c=nLe(0,n,a,o,s,u),VT(),c)break;u+=h.byteLength}return jh.releasePrimitive(r),c}bvhcast(e,t,i){let{intersectsRanges:n,intersectsTriangles:r}=i,s=this.geometry.index,a=this.geometry.attributes.position,o=e.geometry.index,l=e.geometry.attributes.position;Vx.copy(t).invert();let c=jh.getPrimitive(),u=jh.getPrimitive();if(r){let d=function(p,g,x,y,b,A,w,E){for(let D=x,T=x+y;D<T;D++){rd(u,D*3,o,l),u.a.applyMatrix4(t),u.b.applyMatrix4(t),u.c.applyMatrix4(t),u.needsUpdate=!0;for(let I=p,R=p+g;I<R;I++)if(rd(c,I*3,s,a),c.needsUpdate=!0,r(c,u,I,D,b,A,w,E))return!0}return!1};if(n){let p=n;n=function(g,x,y,b,A,w,E,D){return p(g,x,y,b,A,w,E,D)?!0:d(g,x,y,b,A,w,E,D)}}else n=d}e.getBoundingBox(PI),PI.applyMatrix4(t);let h=this.shapecast({intersectsBounds:d=>PI.intersectsBox(d),intersectsRange:(d,p,g,x,y,b)=>(RI.copy(b),RI.applyMatrix4(Vx),e.shapecast({intersectsBounds:A=>RI.intersectsBox(A),intersectsRange:(A,w,E,D,T)=>n(d,p,A,w,x,y,D,T)}))});return jh.releasePrimitive(c),jh.releasePrimitive(u),h}intersectsBox(e,t){return Rv.set(e.min,e.max,t),Rv.needsUpdate=!0,this.shapecast({intersectsBounds:i=>Rv.intersectsBox(i),intersectsTriangle:i=>Rv.intersectsTriangle(i)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,i={},n={},r=0,s=1/0){e.boundingBox||e.computeBoundingBox(),Rv.set(e.boundingBox.min,e.boundingBox.max,t),Rv.needsUpdate=!0;let a=this.geometry,o=a.attributes.position,l=a.index,c=e.attributes.position,u=e.index,h=jh.getPrimitive(),d=jh.getPrimitive(),p=HT,g=sLe,x=null,y=null;n&&(x=aLe,y=oLe);let b=1/0,A=null,w=null;return Vx.copy(t).invert(),N_.matrix.copy(Vx),this.shapecast({boundsTraverseOrder:E=>Rv.distanceToBox(E),intersectsBounds:(E,D,T)=>T<b&&T<s?(D&&(N_.min.copy(E.min),N_.max.copy(E.max),N_.needsUpdate=!0),!0):!1,intersectsRange:(E,D)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:T=>N_.distanceToBox(T),intersectsBounds:(T,I,R)=>R<b&&R<s,intersectsRange:(T,I)=>{for(let R=T*3,O=(T+I)*3;R<O;R+=3){rd(d,R,u,c),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let P=E*3,U=(E+D)*3;P<U;P+=3){rd(h,P,l,o),h.needsUpdate=!0;let H=h.distanceToTriangle(d,p,x);if(H<b&&(g.copy(p),y&&y.copy(x),b=H,A=P/3,w=R/3),H<r)return!0}}}});{let T=u?u.count:c.count;for(let I=0,R=T;I<R;I+=3){rd(d,I,u,c),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let O=E*3,P=(E+D)*3;O<P;O+=3){rd(h,O,l,o),h.needsUpdate=!0;let U=h.distanceToTriangle(d,p,x);if(U<b&&(g.copy(p),y&&y.copy(x),b=U,A=O/3,w=I/3),U<r)return!0}}}}}),jh.releasePrimitive(h),jh.releasePrimitive(d),b===1/0?null:(i.point?i.point.copy(g):i.point=g.clone(),i.distance=b,i.faceIndex=A,n&&(n.point?n.point.copy(y):n.point=y.clone(),n.point.applyMatrix4(Vx),g.applyMatrix4(Vx),n.distance=g.sub(n.point).length(),n.faceIndex=w),i)}closestPointToPoint(e,t={},i=0,n=1/0){let r=i*i,s=n*n,a=1/0,o=null;if(this.shapecast({boundsTraverseOrder:c=>(z_.copy(e).clamp(c.min,c.max),z_.distanceToSquared(e)),intersectsBounds:(c,u,h)=>h<a&&h<s,intersectsTriangle:(c,u)=>{c.closestPointToPoint(e,z_);let h=e.distanceToSquared(z_);return h<a&&(HT.copy(z_),a=h,o=u),h<r}}),a===1/0)return null;let l=Math.sqrt(a);return t.point?t.point.copy(HT):t.point=HT.clone(),t.distance=l,t.faceIndex=o,t}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(t=>{od(0,new Float32Array(t),vW),e.union(vW)}),e}},KN=pg(l1e()),lLe=.5*(Math.sqrt(3)-1),F_=(3-Math.sqrt(3))/6,cLe=1/3,Wh=1/6,FA=e=>Math.floor(e)|0,yW=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]),OI=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);function uLe(e=Math.random){let t=Z$(e),i=new Float64Array(t).map(r=>yW[r%12*2]),n=new Float64Array(t).map(r=>yW[r%12*2+1]);return function(r,s){let a=0,o=0,l=0,c=(r+s)*lLe,u=FA(r+c),h=FA(s+c),d=(u+h)*F_,p=u-d,g=h-d,x=r-p,y=s-g,b,A;x>y?(b=1,A=0):(b=0,A=1);let w=x-b+F_,E=y-A+F_,D=x-1+2*F_,T=y-1+2*F_,I=u&255,R=h&255,O=.5-x*x-y*y;if(O>=0){let H=I+t[R],V=i[H],j=n[H];O*=O,a=O*O*(V*x+j*y)}let P=.5-w*w-E*E;if(P>=0){let H=I+b+t[R+A],V=i[H],j=n[H];P*=P,o=P*P*(V*w+j*E)}let U=.5-D*D-T*T;if(U>=0){let H=I+1+t[R+1],V=i[H],j=n[H];U*=U,l=U*U*(V*D+j*T)}return 70*(a+o+l)}}function hLe(e=Math.random){let t=Z$(e),i=new Float64Array(t).map(s=>OI[s%12*3]),n=new Float64Array(t).map(s=>OI[s%12*3+1]),r=new Float64Array(t).map(s=>OI[s%12*3+2]);return function(s,a,o){let l,c,u,h,d=(s+a+o)*cLe,p=FA(s+d),g=FA(a+d),x=FA(o+d),y=(p+g+x)*Wh,b=p-y,A=g-y,w=x-y,E=s-b,D=a-A,T=o-w,I,R,O,P,U,H;E>=D?D>=T?(I=1,R=0,O=0,P=1,U=1,H=0):E>=T?(I=1,R=0,O=0,P=1,U=0,H=1):(I=0,R=0,O=1,P=1,U=0,H=1):D<T?(I=0,R=0,O=1,P=0,U=1,H=1):E<T?(I=0,R=1,O=0,P=0,U=1,H=1):(I=0,R=1,O=0,P=1,U=1,H=0);let V=E-I+Wh,j=D-R+Wh,J=T-O+Wh,F=E-P+2*Wh,X=D-U+2*Wh,W=T-H+2*Wh,ne=E-1+3*Wh,Y=D-1+3*Wh,$=T-1+3*Wh,se=p&255,fe=g&255,te=x&255,de=.6-E*E-D*D-T*T;if(de<0)l=0;else{let we=se+t[fe+t[te]];de*=de,l=de*de*(i[we]*E+n[we]*D+r[we]*T)}let le=.6-V*V-j*j-J*J;if(le<0)c=0;else{let we=se+I+t[fe+R+t[te+O]];le*=le,c=le*le*(i[we]*V+n[we]*j+r[we]*J)}let _e=.6-F*F-X*X-W*W;if(_e<0)u=0;else{let we=se+P+t[fe+U+t[te+H]];_e*=_e,u=_e*_e*(i[we]*F+n[we]*X+r[we]*W)}let be=.6-ne*ne-Y*Y-$*$;if(be<0)h=0;else{let we=se+1+t[fe+1+t[te+1]];be*=be,h=be*be*(i[we]*ne+n[we]*Y+r[we]*$)}return 32*(l+c+u+h)}}function Z$(e){let t=new Uint8Array(512);for(let i=0;i<512/2;i++)t[i]=i;for(let i=0;i<512/2-1;i++){let n=i+~~(e()*(256-i)),r=t[i];t[i]=t[n],t[n]=r}for(let i=256;i<512;i++)t[i]=t[i-256];return t}var Ou=new ka,dLe=class{constructor(e){this.weightAttribute=null;let t=e.geometry;if(!t.isBufferGeometry||t.attributes.position.itemSize!==3)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");t.index&&(t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.distribution=null}build(){let e=this.positionAttribute,t=new Float32Array(e.count/3);for(let n=0;n<e.count;n+=3){let r=1;Ou.a.fromBufferAttribute(e,n),Ou.b.fromBufferAttribute(e,n+1),Ou.c.fromBufferAttribute(e,n+2),r*=Ou.getArea(),t[n/3]=r}this.distribution=new Float32Array(e.count/3);let i=0;for(let n=0;n<t.length;n++)i+=t[n],this.distribution[n]=i;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t){if(this.distribution){let i=this.distribution[this.distribution.length-1],n=this.binarySearch(this.randomFunction()*i);return this.sampleFace(n,e,t)}}binarySearch(e){if(!this.distribution)return 0;let t=this.distribution,i=0,n=t.length-1,r=-1;for(;i<=n;){let s=Math.ceil((i+n)/2);if(s===0||t[s-1]<=e&&t[s]>e){r=s;break}else e<t[s]?n=s-1:i=s+1}return r}sampleFace(e,t,i){let n=this.randomFunction(),r=this.randomFunction();return n+r>1&&(n=1-n,r=1-r),Ou.a.fromBufferAttribute(this.positionAttribute,e*3),Ou.b.fromBufferAttribute(this.positionAttribute,e*3+1),Ou.c.fromBufferAttribute(this.positionAttribute,e*3+2),t.set(0,0,0).addScaledVector(Ou.a,n).addScaledVector(Ou.b,r).addScaledVector(Ou.c,1-(n+r)),Ou.getNormal(i),this}},fLe=pg(OJ()),pLe=new Bt,mLe=new Bt,gLe=new Bt,z0;(e=>{function t(i){return i&&i.__isSPEObject}e.is=t})(z0||(z0={}));var x5=e=>class extends e{constructor(){super(...arguments),this.previousModelViewMatrix=new Bt,this.copyPreviousMatrix=!0,this.hiddenMatrix=new Bt,this.matrixWorldRigid=new Bt,this.shearScale=new Bt,this.shearScaleInv=new Bt}get __isSPEObject(){return!0}isDescendantOf(t){t instanceof kn&&(t=t.uuid);let i=this;for(;i.parent;){if(i.parent.uuid===t)return!0;i=i.parent}return!1}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);for(let i of this.children)i.updateMatrixWorld(t)}updateWorldMatrix(t,i){let n=this.parent;if(t&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),i)for(let r of this.children)r.updateWorldMatrix(!1,!0)}traverseChildren(t,i=0){for(let n of this.children)z0.is(n)&&n.traverseObject(t,i+1)}traverseObject(t,i=0){if(t(this,i)!==!0)for(let n of this.children)z0.is(n)&&n.traverseObject(t,i+1)}updateMatrixWorldSVD(){let t=this.matrixWorld.elements,i=[[t[0],t[4],t[8]],[t[1],t[5],t[9]],[t[2],t[6],t[10]]],{u:n,v:r,q:s}=(0,fLe.SVD)(i),a=pLe.set(n[0][0],n[0][1],n[0][2],0,n[1][0],n[1][1],n[1][2],0,n[2][0],n[2][1],n[2][2],0,0,0,0,1),o=mLe.set(r[0][0],r[0][1],r[0][2],0,r[1][0],r[1][1],r[1][2],0,r[2][0],r[2][1],r[2][2],0,0,0,0,1),l=gLe.copy(o).transpose();this.shearScale.makeScale(s[0],s[1],s[2]).multiply(l).premultiply(o),this.shearScaleInv.copy(this.shearScale).invert(),this.matrixWorldRigid.multiplyMatrices(a,l).copyPosition(this.matrixWorld),s.every(c=>Math.abs(s[0]-c)<.01)?this.hasNonUniformScale=!1:this.hasNonUniformScale=!0}attach(t,i){this.updateWorldMatrix(!0,!1);let n=new Bt().copy(this.matrixWorld).invert();return t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),n.multiply(t.parent.matrixWorld)),"hiddenMatrix"in t&&t.hiddenMatrix instanceof Bt?t.hiddenMatrix.premultiply(n):t.applyMatrix4(n),t.updateWorldMatrix(!1,!1),this.add(t),i!==void 0&&(this.children.pop(),this.children.splice(i,0,t)),this}copy(t,i=!1){return super.copy(t,i),this.hasNonUniformScale=t.hasNonUniformScale,this}onAfterRender(t,i,n,r,s,a){this.copyPreviousMatrix&&this.previousModelViewMatrix.copy(this.modelViewMatrix)}},vLe=class extends x5(kn){},yLe=e=>e.type==="Mesh",qa=class extends vLe{constructor(e){super(),this.object=e,this.matrixAutoUpdate=!1,this.hasNonUniformScale=e.hasNonUniformScale}raycast(e,t){}expand(){let e=0,t=this.object.entityChildren(e);for(;t;){let i=this.children[e];(i==null?void 0:i.object)!==t&&(i&&this.remove(i),i=new qa(t),this.add(i),this.children.splice(e,0,this.children.pop()),i.matrixWorldNeedsUpdate=!0,i.matrixAutoUpdate=!1,i.matrix=t.matrix,i.hiddenMatrix=t.hiddenMatrix),i.expand(),e+=1,t=this.object.entityChildren(e)}for(;this.children.length>e;)this.remove(this.children[e])}get visible(){var e;return this.playModeVisible!==void 0?this.playModeVisible:this.object.visible||this.object.dataPatched.visible&&((e=this.object.dataPatched.cloner)==null?void 0:e.hideBase)===!0}set visible(e){}get castShadow(){return this.object.castShadow}set castShadow(e){}get receiveShadow(){return this.object.receiveShadow}set receiveShadow(e){}get isMesh(){return yLe(this.object)}get isLight(){return this.object.isLight}get layers(){return this.object.layers}set layers(e){}get isCamera(){return!1}get geometry(){if(this.object.geometry)return this.object.geometry}get material(){if(this.object.material)return this.object.material}},Xv=new G,qv=new G,D1=new Bt,$$=[new G(-1,1,1),new G(-1,-1,1),new G(1,-1,1),new G(1,1,1),new G(-1,1,-1),new G(-1,-1,-1),new G(1,-1,-1),new G(1,1,-1)],xLe=[[0,3],[1,2],[5,6],[4,7],[0,1],[3,2],[7,6],[4,5],[0,4],[1,5],[2,6],[3,7]],bLe=[[0,2],[7,5],[4,1],[3,6],[4,3],[1,6]],xW=(e,t,i)=>{e.updateEntityBoxSize(Xv,qv),D1.copy(t).multiply(e.matrixWorld),qv.x===0&&qv.y===0&&qv.z===0?i.push(new G(Xv.x,Xv.y,Xv.z).applyMatrix4(D1)):$$.forEach(n=>{i.push(n.clone().multiply(qv).add(Xv).applyMatrix4(D1))})},bW=class extends ps{constructor(){super(...arguments),this.matrix=new Bt,this.vertices=[],this.faces=[],this.edges=[],this.centerEdges=[]}copy(e){return super.copy(e),this.matrix.copy(e.matrix),this.vertices=e.vertices.map(t=>t.clone()),this.faces=e.faces.map(t=>t.clone()),this.edges=e.edges.map(t=>t.clone()),this.centerEdges=e.centerEdges.map(t=>t.clone()),this}setFromObjectSize(e,t=!1){e.updateWorldMatrix(!1,t),this.makeEmpty(),this.matrix.copy(e.matrixWorld);let i=new Bt().copy(e.matrixWorld).invert();return this.expandByObjectSize(e,i,t)}expandByObjectSize(e,t,i=!1){let n=[];return i===!0?e.traverseEntity(r=>{if(r.visible||r.cloner&&r.data.visible){if(!("geometry"in r)){n.push(new G);return}xW(r,t,n)}}):xW(e,t,n),this.setFromPoints(n)}getCenter(e){return e=super.getCenter(e),e.applyMatrix4(this.matrix),e}getPositionToCenter(e){return e=super.getCenter(e),e.applyMatrix4(D1.copy(this.matrix).setPosition(0,0,0)),e}computeVertices(){this.getSize(qv).multiplyScalar(.5),this.getCenter(Xv),D1.copy(this.matrix).setPosition(Xv),this.vertices=$$.map(e=>e.clone().multiply(qv).applyMatrix4(D1))}computeEdges(){this.vertices.length>0&&this.computeVertices(),this.edges=xLe.map(([e,t])=>new Yc(this.vertices[e],this.vertices[t])),this.centerEdges=this.edges.map(e=>e.getCenter(new G))}computeFaces(){this.vertices.length>0&&this.computeVertices(),this.faces=bLe.map(([e,t])=>this.vertices[e].clone().add(this.vertices[t]).multiplyScalar(.5))}},Hm={Cloner:()=>{},changeEntityProptotype:()=>{},createEntity:()=>{}},SLe=class extends lZ{constructor(){super()}getPoints(e=12){let t=[],i,n=this.getCurveLengths(),r=n[n.length-1]/n.length;for(let s=0,a=this.curves;s<a.length;s++){let o=a[s],l=s===0?n[s]:n[s]-n[s-1],c=Math.ceil(e*l/r),u=o.getPoints(c);for(let h=0;h<u.length;h++){let d=u[h];i&&i.equals(d)||(t.push(d),i=d)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}},JN=.001;function ZN(e,t,i){return t.clone().sub(e).cross(t.clone().sub(i)).length()<=JN}function BI(e,t){let i=new G(...e.position),n=new G(...e.controlNext.position),r=new G(...t.controlPrevious.position),s=new G(...t.position);return ZN(i,n,s)&&ZN(i,r,s)}function eee(e){let t=e.points.map(u=>new G(...u.data.position)),i=[e.points[0]],n=new G(...i[0].data.position);for(let u=0;u<e.points.length-1;u++)ZN(n,t[u],t[u+1])||(i.push(e.points[u]),n=t[u]);i.push(e.points[e.points.length-1]);let r=e.isClosed,s=i.length-(r?0:1),a=i.length,o=[];for(let u=0;u<a;u++){let h=i[u].data,d=new G(...h.position),p=new G(...h.controlPrevious.position),g=new G(...h.controlNext.position),x={position:d,baseRoundness:h.roundness,controlPrevious:p,controlNext:g};if(h.roundness===0||!e.isClosed&&(u===0||u===a-1)){o[u]={...x,removedLength:0};continue}let y=r&&u==0?a-1:u-1,b=r&&u==a-1?0:u+1,A=i[y].data,w=i[b].data,E=new G(...A.position),D=new G(...w.position),T=E.clone().sub(d).normalize(),I=D.clone().sub(d).normalize();Object.assign(x,{prevDir:T,nextDir:I});let R=BI(A,h),O=BI(h,w);if(!R||!O)o[u]={...x,removedLength:0};else{let P=T.clone().add(I).normalize(),U=P.clone().cross(T).length()/T.dot(P);o[u]={...x,tan:U,removedLength:h.roundness/U}}}for(let u=0;u<s;u++){let h=u,d=r&&u===a-1?0:u+1,p=o[h],g=o[d];if(p.removedLength!==0||g.removedLength!==0){let x=p.position.distanceTo(g.position);p.removedLength=Math.min(p.removedLength,x/2),g.removedLength=Math.min(g.removedLength,x/2)}}let l=[];for(let u=0;u<s;u++){let h=u,d=r&&u===a-1?0:u+1,p=o[h],g=o[d],x=null;if(!BI(i[h].data,i[d].data))p.position.distanceTo(g.position)>JN&&(x=new LC(p.position,p.controlNext,g.controlPrevious,g.position));else{let y=p.position.clone(),b=g.position.clone();(p.removedLength!==0||g.removedLength!==0)&&(p.nextDir&&y.add(p.nextDir.clone().setLength(p.removedLength)),g.prevDir&&b.add(g.prevDir.clone().setLength(g.removedLength))),y.distanceTo(b)>JN&&(x=new LC(y,y.clone().lerp(b,.3),b.clone().lerp(y,.3),b))}l[2*u+1]=x}for(let u=0;u<a;u++){let h=o[u];if(h.removedLength===0){l[2*u]=null;continue}let d=h.position,p=h.prevDir.clone().multiplyScalar(h.removedLength).add(d),g=h.nextDir.clone().multiplyScalar(h.removedLength).add(d),x=h.tan*h.removedLength,y=h.prevDir.clone().add(h.nextDir).normalize(),b=p.clone().lerp(g,.5),A=p.distanceTo(g)/2,w=y.clone().multiplyScalar(Math.sqrt(Math.pow(x,2)-Math.pow(A,2))).add(b),E=y.clone().multiplyScalar(-x).add(w),D=d.distanceTo(E)/d.distanceTo(b),T=h.prevDir.clone().multiplyScalar(D*d.distanceTo(p)).add(d),I=T.clone().lerp(E,2),R=p.clone().lerp(T,4/3),O=g.clone().lerp(I,4/3);l[2*u]=new LC(p,R,O,g)}let c=new SLe;return l.forEach(u=>{u&&c.add(u)}),c}var dn;(e=>{function t(i){return i&&i.__isEntity}e.is=t})(dn||(dn={}));var Cf=e=>dn.is(e),_Le={type:"completeState",isfromEntity:!0},ALe=["x","y","z"],II=new G,wLe=new G().set(0,1,0),b5=e=>class extends x5(e){constructor(){super(...arguments),this.raycastLock=!1,this.scaleLock=!1,this.disposed=!1,this.stateSelection=null,this.destroyedInAction=!1,this.instances=[],this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this._singleBBox=new bW,this._recursiveBBox=new bW,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this._needApplyPathSnapping=!0,this.attachedPaths=new Set}get __isEntity(){return!0}entityChildren(t){let i=this.children[t];if(dn.is(i))return i}entityChildrenCount(){let t=this.children.length;for(;t--;)if(dn.is(this.children[t]))return t+1;return 0}get isConcreteEntity(){return typeof this.identity=="string"}get isVirtualEntity(){return typeof this.identity!="string"}get isInstanceRoot(){return this.isConcreteEntity&&this.data.type==="Instance"}nearestInstanceSelfOrParent(){let t=this;for(;t.data.type!=="Instance";){let i=t.parent;if(dn.is(i))t=i;else return}return t}forInstancesRec(t){this.instances.forEach(i=>{i.disposed||t(i),i.forInstancesRec(t)})}super_Entity(t,i){typeof t=="string"&&(this.uuid=t),this.identity=t,this.data=i,this.matrixAutoUpdate=!1,this.dataPatched=this.data}changeSelectedState(t,i,n=!1){if(!(this.data.states.length===0&&!n)){for(let r of this.data.states)a0.toOps(this.data,r.data).forEach(s=>{let a=y3.replaceProps(s,this.data);this.dataPatched=this.data,this.updateByPatchedOp(a,this.data,i)});if(t!==null){let r=this.data.states.data(t);r&&(this.dataPatched=a0.patch(this.data,r),a0.toOps(this.data,r).forEach(s=>{this.updateByPatchedOp(s,this.dataPatched,i)}))}n&&this.updateTransformState(this.dataPatched,i),this.stateSelection=t,this.updatePathSnapping(this.dataPatched.pathSnapping)}}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges(),this._singleBBox.computeFaces()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges(),this._recursiveBBox.computeFaces()),this._recursiveBBox}updateEntityBoxSize(t,i){t.setScalar(0),i.setScalar(0)}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors(t=>{Cf(t)&&t.resetBBoxNeedsUpdateSelf()}),this.traverseEntity(t=>{t.resetBBoxNeedsUpdateSelf()})}find(t){let i;return this.traverseEntity(n=>{n.uuid===t&&(i=n)}),i}traverseSortNextHelper(){let t=this.parent;if(t){let i=t.children,n=i.indexOf(this)+1;if(dn.is(i[n]))return i[n];if(dn.is(t))return t.traverseSortNextHelper()}}sortNext(){let t=this.children;return this.children.length>0&&dn.is(this.children[0])?t[0]:this.traverseSortNextHelper()}goUp(t){let i=this;for(;t>0&&i!==null;)i=i.parent,t-=1;return i}hasAnccestorOrSelf(t){return this===t||this.hasAnccestor(t)}hasAnccestor(t){let i=this.parent;for(;i;){if(t===i)return!0;i=i.parent}return!1}countToAccestor(t){let i=0,n=this;for(;n!==t;){if(n===null)return-1;n=n.parent,i+=1}return i}forEachEntity(t){for(let i of this.children)Cf(i)&&t(i)}traverseEntityAncestors(t){this.traverseAncestors(i=>{dn.is(i)&&t(i)})}traverseConcreteEntity(t,i=0){if(t(this,i)!==!0)for(let n of this.children)Cf(n)&&n.isConcreteEntity&&n.traverseEntity(t,i+1)}traverseEntity(t,i=0){if(t(this,i)!==!0)for(let n of this.children)Cf(n)&&n.traverseEntity(t,i+1)}traverseVisibleEntity(t){t(this);for(let i of this.children)Cf(i)&&i.visible&&i.traverseVisibleEntity(t)}updateMatrix(){super.updateMatrix(),this.cloner&&this.cloner.onObjUpdateMatrix(),this.dispatchEvent({type:"updateMatrix"})}updateMatrixWorld(t){super.updateMatrixWorld(t),this.dispatchEvent({type:"updateMatrixWorld"})}copy(t,i=!1){return super.copy(t,i),this.dataPatched=t.dataPatched,this.raycastLock=t.raycastLock,this.scaleLock=t.scaleLock,this.hiddenMatrix.copy(t.hiddenMatrix),this}hasEntityChild(){return this.children.some(t=>Cf(t))}isAncestorOf(t){if(this.uuid===t)return!1;let i=!1;return this.traverseEntity(n=>{n.uuid===t&&(i=!0)}),i}toObjectTransformState(t=[]){this.updateWorldMatrix(!0,!1);let i={position:this.position.toArray(),rotation:[this.rotation.x*qt.RAD2DEG,this.rotation.y*qt.RAD2DEG,this.rotation.z*qt.RAD2DEG],scale:this.scale.toArray(),hiddenMatrix:this.hiddenMatrix.toArray()};return sN(i,t)}getTransformValues(t,i,n){return i[t].map((r,s)=>(n==null?void 0:n.shared.getVariable(r,[this.uuid,t,ALe[s]]))??r)}updateTransformState(t,i){let n=!1;return t.position&&(this.position.fromArray(this.getTransformValues("position",t,i)),n=!0),t.rotation&&(II.fromArray(this.getTransformValues("rotation",t,i)).multiplyScalar(qt.DEG2RAD),this.rotation.setFromVector3(II),n=!0),t.scale&&(this.scale.fromArray(this.getTransformValues("scale",t,i)),n=!0),t.hiddenMatrix!==void 0&&(n=!0,this.hiddenMatrix.fromArray(t.hiddenMatrix??sb.identity)),n&&(this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors(r=>{r.invalidateClonerTransform(this)})),t.position&&t.rotation&&t.scale&&t.hiddenMatrix!==void 0&&this.updateWorldMatrix(!1,!0),n}onVariableUpdate(t=!1){if(t){this.resetBBoxNeedsUpdate();return}this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors(i=>{i.invalidateClonerTransform(this)})}dispose(){this.disposed=!0,this.cloner&&(this.cloner.removeFromParent(),this.cloner=void 0)}disposeChildrenRecursively(){for(let t of this.children)dn.is(t)&&t.disposeRecursively()}disposeRecursively(){this.dispose(),this.children.forEach(t=>{dn.is(t)&&t.disposeRecursively()})}toState(t=[]){let i={name:this.name,visible:this.visible,raycastLock:this.raycastLock,...this.toObjectTransformState(t)};return sN(i,t)}updateByObjUpdateOp(t,i){t!==void 0&&this.updateByOp({type:0,props:t,path:[]},{...this.data,...t},i,!1)}updateByOp(t,i,n,r){let s=this.data;this.data=i;let a=t,o=cr(t.path,["states","*"]);if(o!==null){if(t.type===0){let[l]=o;if((this==null?void 0:this.stateSelection)===l){let c={...t.props};if(delete c.name,Object.values(t.props).some(u=>u===void 0)){let u=this.data;if(u!==void 0){let h=Ys.zoom(u,t.path.slice(2));if(h)for(let d in t.props)t.props[d]===void 0&&d in h&&(c[d]=h[d])}}a={...t,props:c,path:t.path.slice(2)}}}}else if(t.type===0){let l=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(l!==void 0){if(t.props.name!==void 0&&l.name){let{name:u,...h}=l;l=h}if(t.props.material!==void 0&&"material"in l){let{material:u,...h}=l;l=h}let c=Ys.removeOverridden(t.path,t.props,l);a={...t,props:c}}}if(this.updateByPatchedOpBase(a,a0.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),n),cr(t.path,["overrides"])){let l=[],c=[...t.path];for(l.push(c[1]),c.splice(0,2);c.length>0&&c[0]==="descendants";)l.push(c[1]),c.splice(0,2);if(l[l.length-1]===void 0){if(t.type===0)for(let u of Object.keys(t.props)){l[l.length-1]=u;let h=n.scene.findInstance([this.uuid,...l]);h&&(h.overrideData=t.props[u],h.updateState(Xm.apply(h.component.data,h.overrideData),n))}}else{let u=n.scene.findInstance([this.uuid,...l]);if(u){let h=Ys.zoom(u.component.data,c);if(t={...t,path:c},t.type===0){let d=t.props;if(h)for(let[p,g]of Object.entries(t.props))g===void 0&&(d===t.props&&(d={...t.props}),d[p]=h[p]);t={...t,props:d}}u.overrideData=D3.resolve(i.overrides,l),u.updateByOp(t,ma.applySimple(u.data,t),n,!1)}}}else if(this.instances.length>0){let l;if(t.path.length===0&&t.type===0){let c;for(let u of Fm.rootOverrideProps)u in t.props&&(c===void 0&&(c={}),c[u]=t.props[u]);c&&(l={...t,props:c})}else for(let c of Fm.rootOverrideProps)if(cr(t.path,[c])){l=t;break}l!==void 0&&this.instances.forEach(c=>{if(c.isInstanceRoot){let u=Xm.filterOp(c.overrideData,l);u&&c.updateByOp(u,ma.applySimple(c.data,u),n,!0)}}),this.instances.forEach(c=>{if(!c.isInstanceRoot){let u=Xm.filterOp(c.overrideData,t);if(u){let h;s===c.data&&t===u?h=i:h=ma.applySimple(c.data,u),c.updateByOp(u,h,n,!0)}}})}}updateByPatchedOpBase(t,i,n){if(this.dataPatched=i,t.path.length===0&&t.type===0)t.props.type!==void 0&&!N0.is(t.props.type)&&Hm.changeEntityProptotype(this,i,n);else if(t.path.length===1&&t.path[0]==="geometry"&&t.type===0&&"type"in t.props){Hm.changeEntityProptotype(this,i,n);for(let r of this.children)dn.is(r)&&r.updateVisible(n.scene)}this.updateByPatchedOp(t,i,n)}updateByPatchedOp(t,i,n){var r;if(t.path.length===0&&t.type===0?this.updateState(t.props,n):t.type===0&&("resolutionLevel"in t.props||"useChildrenColors"in t.props)&&this.updateState(i,n),t.path[0]==="morphTargetInfluences"&&t.type===0){let s=(r=i.morphTargetInfluences.get(t.path[1]))==null?void 0:r.data.name;s&&this.updateMorphInfluences(s,n.shared.getVariable(t.props.value,[this.uuid,"morphTargetInfluences",s]))}if(cr(t.path,["pathSnapping"])!==null&&this.updatePathSnapping(i.pathSnapping),cr(t.path,["cloner"])!==null){let s=ma.drop(t,1);s.path.length===0&&s.type===0&&s.props.disabled===!0?this.setFromClonerState(null,n):this.cloner?this.cloner.updateState(i.cloner,n.scene):(this.setFromClonerState(i.cloner,n),this.expandCloner(n.scene)),this.updateVisible(n.scene)}}updatePathSnapping(t=this.dataPatched.pathSnapping){this._updatedPathSnapping=t,this._needApplyPathSnapping=!0}get updatedPathSnapping(){return this._updatedPathSnapping}applyPathSnapping(t){var g,x,y,b,A;let i=((g=this._updatedPathSnapping)==null?void 0:g.pathId)??this.dataPatched.pathSnapping.pathId,n=((x=this._updatedPathSnapping)==null?void 0:x.slide)??this.dataPatched.pathSnapping.slide??0,r=((y=this._updatedPathSnapping)==null?void 0:y.offset)??this.dataPatched.pathSnapping.offset??0,s=((b=this._updatedPathSnapping)==null?void 0:b.orientation)??this.dataPatched.pathSnapping.orientation;if(i===null)return;let a=t.find(i);if(!a||this._needApplyPathSnapping===!1)return;this._needApplyPathSnapping=!1;let o=a.data;if(o.geometry.path.points.length<=1)return;let l=eee(o.geometry.path),c=(n+r)%1;n+r===1&&c===0&&(c=1);let u=null;try{u=l.curves.length?l.getPointAt(c):null}catch{}if(u===null)return;let h=this.parent?(A=this.parent)==null?void 0:A.matrixWorld:new Bt;a.updateMatrixWorld();let d=new Bt().multiplyMatrices(h.clone().invert(),a.matrixWorld);u.applyMatrix4(d);let p={position:u.toArray(),rotation:o.rotation};if(s==="tangential"){let w=new Bt().extractRotation(a.matrixWorld),E=l.getTangentAt(c).applyMatrix4(w).add(u),D=new Bt().lookAt(u,E,wLe),T=II.setFromEuler(new qs().setFromRotationMatrix(D)).multiplyScalar(qt.RAD2DEG);p={...p,rotation:T.toArray()}}this.updateTransformState(p),this.traverseEntity(w=>{w._cameraType&&w.dispatchEvent(_Le)})}updateVisible(t){var n;if(this.visible=this.dataPatched.visible&&(!this.dataPatched.cloner||(this.dataPatched.cloner.disabled??!1)||((n=this.dataPatched.cloner)==null?void 0:n.hideBase)!==!0),!t)return;let i=!1;this.traverseEntity(r=>{if(r.data.type==="Splat")return i=!0,!0}),i&&t.reloadSplats()}updateState_Entity(t,i){t.name!==void 0&&(this.name=t.name),t.raycastLock!==void 0&&(this.raycastLock=t.raycastLock),t.visible!==void 0&&(this.updateVisible(i==null?void 0:i.scene),this.resetBBoxNeedsUpdate()),i&&"cloner"in t&&t.cloner!==void 0&&(this.setFromClonerState(t.cloner,i),this.updateVisible(i.scene)),this.updateTransformState(t,i)}get attachedSurfaceCloners(){return this.children.filter(t=>t instanceof Hm.Cloner&&t.parameters.type==="toObject")}setFromClonerState(t,i){this.disposed||(t===null||t.disabled?(this.cloner&&this.cloner.removeFromParent(),this.cloner=void 0):this.cloner===void 0?(this.cloner=new Hm.Cloner(this,t),i.scene.addPendingExpandCloner(this)):this.cloner.updateState(t,i.scene))}expandCloner(t){!this.disposed&&this.cloner&&this.cloner.expandClones(t)}invalidateClonerTransform(t){this.cloner&&this.cloner.invalidateTransform(t)}requestRender(){this.dispatchEvent({type:"requestRender"})}},tee=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var l,c;let i=(l=e.parameters)==null?void 0:l.radiusTop,n=(c=e.parameters)==null?void 0:c.radiusBottom,r=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:64,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadius:8,cornerSegments:8,hollow:0},e.parameters);r.thetaLength=qt.clamp(r.thetaLength,0,360);let s=r.width/2,a=r.radiusTop??s,o=r.radiusBottom??s;if(a===o?(a=s,o=s):a>o?(a=s,o=o*s/a):(a=a*s/o,o=s),r.shapeBlendNode){a=i??s,o=n??s;let u=Math.max(a,o)*2;r.width=u,r.depth=u}return{parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??r.width),radiusTop:a,radiusBottom:o})}}static build(e){let{width:t,depth:i,height:n,radialSegments:r,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:l,radiusTop:c,radiusBottom:u,cornerRadius:h,cornerSegments:d,hollow:p}=e.parameters,g;return l===0?(g=new ii,g.setAttribute("position",new Gt([],3))):h||p?g=new iee(c,u,n,r,s,a,o,l*Math.PI/180,h,h,d,p):g=new z4(c,u,n,r,s,a,o,l*Math.PI/180),g.scale(1,1,i/t),Object.assign(g,{userData:{...e,type:"CylinderGeometry"}})}};function gm(e,t,i){i.x=e.x*t.x,i.y=e.y,i.z=e.x*t.y}function SW(e){return new Ae(e.y,-e.x)}var iee=class extends ii{constructor(e,t,i,n,r,s,a,o,l,c,u,h,d=!1){super(),this.type="RoundedCylinderBufferGeometry",e=e!==void 0?e:1,t=t!==void 0?t:1,i=i||1,n=Math.floor(n)||8,r=Math.floor(r)||1,s=s!==void 0?s:!1,a=a!==void 0?a:0,o=o!==void 0?o:Math.PI*2,s&&(l=0,c=0);let p=[],g=[],x=[],y=[],b=0,A=i/2,w=new G,E=new G;d&&e==0&&(e=l),d&&t==0&&(t=c);let D=new Ae(e,A),T=new Ae(t,-A),I=null,R=null,O=null,P=null,U=D.clone().sub(T),H=0,V=0,j=0;h>0&&(H=Math.min(e,t)*(1-h),V=e-H,j=t-H);let J=D.clone();J.x-=H;let F=Math.PI-U.angle(),X=U.angle(),W=Math.tan(X/2),ne=Math.tan(F/2),Y=W+ne,$=h?Y:ne,se=h?Y:W;if(l=Math.min(l,(e-V)/$,U.length()/Y),c=Math.min(c,(t-j)/se,U.length()/Y),l>0){let be=l/W;I=D.clone().sub(new Ae(be,l)),h&&(O=I.clone(),O.x-=H-Y*l),D.sub(U.clone().setLength(be))}if(c>0){let be=c/ne;R=T.clone().sub(new Ae(be,-c)),T.add(U.clone().setLength(be)),h&&(P=R.clone(),P.x-=H-Y*c,J.sub(U.clone().setLength(be)))}U=D.clone().sub(T);let fe=U.length()<.5,te=[];for(let be=0;be<=n;be++){let we=[],Me=be/n,Ne=Me*o+a,Ge=new Ae(Math.sin(Ne),Math.cos(Ne));P&&R?(de(we,Me,Ge,F,c,P,-1,!0),de(we,Me,Ge,X,c,R,-1,!1)):R?(le(we,Ge,R.x,0,-1),de(we,Me,Ge,X,c,R,-1,!1)):s||le(we,Ge,t,j,-1);let We=SW(U).normalize();if(gm(We,Ge,w),!fe)for(let ae=0;ae<=r;ae++){let He=ae/r,Ke=U.clone().multiplyScalar(He).add(T);gm(Ke,Ge,E),g.push(E.x,E.y,E.z),x.push(w.x,w.y,w.z),y.push(Me,.5+E.y/i),we.push(b++)}if(O&&I?(de(we,Me,Ge,F,l,I,1,!1),de(we,Me,Ge,X,l,O,1,!0)):I?(de(we,Me,Ge,F,l,I,1,!1),le(we,Ge,I.x,0,1)):s||le(we,Ge,e,V,1),h&&!fe){let ae=SW(U).multiplyScalar(-1).normalize();gm(ae,Ge,w);for(let He=0;He<=r;He++){let Ke=He/r,je=U.clone().multiplyScalar(-Ke).add(J);gm(je,Ge,E),g.push(E.x,E.y,E.z),x.push(w.x,w.y,w.z),y.push(Me,.5+E.y/i),we.push(b++)}}h&&!s&&we.push(we[0]),te.push(we)}for(let be=0;be<te.length-1;be++)for(let we=0;we<te[0].length-1;we++){if(s&&h&&we==r)continue;let Me=te[be][we],Ne=te[be+1][we],Ge=te[be+1][we+1],We=te[be][we+1],ae=g[Ge*3+0],He=g[Ge*3+2];p.push(Me,Ne,We),(ae!=0||He!=0)&&p.push(Ne,Ge,We)}o<Math.PI*2&&(_e(-1,te[0],a),_e(1,te[te.length-1],a+o)),this.setIndex(p),this.setAttribute("position",new Gt(g,3)),this.setAttribute("normal",new Gt(x,3)),this.setAttribute("uv",new Gt(y,2));function de(be,we,Me,Ne,Ge,We,ae,He){for(let Ke=0;Ke<u+1;Ke++){let je=Ke/u,Oe=ae<0?je:1-je;He&&(Oe-=1),Oe*=Ne;let Qe=new Ae(Math.sin(Oe),Math.cos(Oe)*ae),$e=Qe.clone().multiplyScalar(Ge).add(We);gm($e,Me,E),g.push(E.x,E.y,E.z),gm(Qe,Me,w),x.push(w.x,w.y,w.z),y.push(we,.5+E.y/i),be.push(b++)}}function le(be,we,Me,Ne,Ge){let We=new G,ae=new Ae,He=[Me,Ne];Ge<0&&He.reverse();for(let Ke of He)ae.set(Ke,A*Ge),gm(ae,we,We),g.push(We.x,We.y,We.z),x.push(0,Ge,0),y.push(.5,.5),be.push(b++)}function _e(be,we,Me){let Ne=new Ae(Math.sin(Me),Math.cos(Me)),Ge=new Ae(-Math.cos(Me),Math.sin(Me)),We=new G,ae=be<0?(je,Oe,Qe)=>p.push(je,Oe,Qe):(je,Oe,Qe)=>p.push(je,Qe,Oe),He=new Ae((e+t+V+j)/4,0);gm(He,Ne,We),g.push(We.x,We.y,We.z),x.push(Ge.x,0,Ge.y),y.push(.5,.5);let Ke=b++;for(let je of we){let Oe=g.slice(je*3,je*3+3);g.push(...Oe),x.push(Ge.x,0,Ge.y);let Qe=y.slice(je*2,je*2+2);y.push(...Qe),b++}for(let je=Ke+1;je<b-1;je++)ae(Ke,je,je+1);ae(Ke,b-1,Ke+1)}}},MLe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:32,heightSegments:8,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadiusTop:8,cornerRadiusBottom:8,cornerSegments:8},e.parameters);return i.thetaLength=qt.clamp(i.thetaLength,0,360),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,depth:i,height:n,radialSegments:r,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:l,cornerRadiusTop:c,cornerRadiusBottom:u,cornerSegments:h}=e.parameters,d;return l===0?(d=new ii,d.setAttribute("position",new Gt([],3))):c>0||u>0||l<360?d=new iee(0,t/2,n,r,s,a,o,l*Math.PI/180,c,u,h,0,!0):d=new F4(t/2,n,r,s,a),d.scale(1,1,i/t),Object.assign(d,{userData:{...e,type:"ConeGeometry"}})}},ELe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,widthSegments:1,heightSegments:1,depthSegments:1,cornerRadius:8,cornerSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:n,widthSegments:r,heightSegments:s,depthSegments:a,cornerRadius:o,cornerSegments:l}=e.parameters,c;return o===0?c=new eh(t,i,n,r,s,a):c=new TLe(t,i,n,r,s,a,o,l),Object.assign(c,{userData:{...e,type:"CubeGeometry"}})}},LI=Math.PI/2,TLe=class extends ii{constructor(e=1,t=1,i=1,n=1,r=1,s=1,a=0,o=4){super(),this.type="BoxGeometry",n=Math.floor(n),r=Math.floor(r),s=Math.floor(s),o=Math.floor(o),a=Math.min(a,e/2,t/2,i/2);let l=[],c=[],u=[],h=[],d=0;p("z","y","x",-1,-1,i,t,e,s,r),p("z","y","x",1,-1,i,t,-e,s,r),p("x","z","y",1,1,e,i,t,n,s),p("x","z","y",1,-1,e,i,-t,n,s),p("x","y","z",1,-1,e,t,i,n,r),p("x","y","z",-1,-1,e,t,-i,n,r),a>0&&(g("z","y","x",-1,-1,1,i,t,e,s),g("z","y","x",1,-1,-1,i,t,e,s),g("z","y","x",-1,1,-1,i,t,e,s),g("z","y","x",1,1,1,i,t,e,s),g("x","y","z",-1,-1,-1,e,t,i,n),g("x","y","z",1,-1,1,e,t,i,n),g("x","y","z",-1,1,1,e,t,i,n),g("x","y","z",1,1,-1,e,t,i,n),g("y","x","z",-1,-1,1,t,e,i,r),g("y","x","z",1,-1,-1,t,e,i,r),g("y","x","z",1,1,1,t,e,i,r),g("y","x","z",-1,1,-1,t,e,i,r),x(1,1,1),x(-1,1,1),x(1,-1,1),x(-1,-1,1),x(1,1,-1),x(-1,1,-1),x(1,-1,-1),x(-1,-1,-1)),this.setIndex(l),this.setAttribute("position",new Gt(c,3)),this.setAttribute("normal",new Gt(u,3)),this.setAttribute("uv",new Gt(h,2));function p(y,b,A,w,E,D,T,I,R,O){let P=(D-2*a)/R,U=(T-2*a)/O,H=D/2-a,V=T/2-a,j=I/2,J=R+1,F=O+1,X=0,W=new G;for(let ne=0;ne<F;ne++){let Y=ne*U-V;for(let $=0;$<J;$++){let se=$*P-H;W[y]=se*w,W[b]=Y*E,W[A]=j,c.push(W.x,W.y,W.z),W[y]=0,W[b]=0,W[A]=I>0?1:-1,u.push(W.x,W.y,W.z),h.push($/R),h.push(1-ne/O),X+=1}}for(let ne=0;ne<O;ne++)for(let Y=0;Y<R;Y++){let $=d+Y+J*ne,se=d+Y+J*(ne+1),fe=d+(Y+1)+J*(ne+1),te=d+(Y+1)+J*ne;l.push($,se,te),l.push(se,fe,te)}d+=X}function g(y,b,A,w,E,D,T,I,R,O){let P=(T-2*a)/O,U=T/2-a,H=I/2-a,V=R/2,j=O+1,J=0,F=new G,X=new G;for(let W=0;W<o+1;W++){let ne=W/o*LI,Y=Math.sin(ne)*a,$=(1-Math.cos(ne))*a,se=Math.sin(ne),fe=Math.cos(ne);F[b]=(H+Y)*E,F[A]=(V-$)*D,X[y]=0,X[b]=se*Math.sign(F[b]),X[A]=fe*Math.sign(F[A]);for(let te=0;te<j;te++){let de=te*P-U;F[y]=de*w,c.push(F.x,F.y,F.z),u.push(X.x,X.y,X.z),h.push(te/O),h.push(0),J+=1}}for(let W=0;W<o;W++)for(let ne=0;ne<O;ne++){let Y=d+ne+j*W,$=d+ne+j*(W+1),se=d+(ne+1)+j*(W+1),fe=d+(ne+1)+j*W;l.push(Y,$,fe),l.push($,se,fe)}d+=J}function x(y,b,A){let w=new G,E=new G(e/2,t/2,i/2);E.subScalar(a);let D=[],T=y*b*A>0?(R,O,P)=>l.push(R,O,P):(R,O,P)=>l.push(R,P,O);for(let R=0;R<=o;R++){let O=[],P=LI*(1-R/o),U=Math.cos(P),H=Math.sin(P),V=0;for(let j=0;j<=R;j++){let J=Math.cos(V),F=Math.sin(V);w.x=U*J,w.y=H,w.z=U*F;let X=E.clone().addScaledVector(w,a);c.push(y*X.x,b*X.y,A*X.z),u.push(y*w.x,b*w.y,A*w.z),h.push(0,0),O.push(d++),V+=LI/R}D.push(O)}let I=D.length-1;for(let R=0;R<I;R++){let O=D[R],P=D[R+1],U=O.length-1;T(O[0],P[1],P[0]);for(let H=1;H<=U;H++)T(O[H-1],O[H],P[H]),T(O[H],P[H+1],P[H])}}}},S5=class extends ii{constructor(e=[],t=[],i="",n=1,r=.2,s=4){super(),this.type="PolyhedronGeometryRound";let a=[],o=[],l=[];c(),u(),this.setAttribute("position",new Gt(a,3)),this.setAttribute("normal",new Gt(l,3)),this.setAttribute("uv",new Gt(o,2));return;function c(){var X;r=Math.min(1-1e-5,r),r==0&&(s=0);let h={IcosahedronGeometry:5,DodecahedronGeometry:3,HexahedronGeometry:3,OctahedronGeometry:4,TetrahedronGeometry:3}[i],d=new G,p=d.clone(),g=new ka,x=r*n,y=n-x,b=s+1,A=new G,w=(W,ne)=>A.subVectors(W,ne).normalize(),E=(W,ne)=>Array(W).fill(void 0).map(ne),D=E(e.length/3,(W,ne)=>new G().fromArray(e,ne*3).setLength(n)),T=[],I=1e6;for(let W=0;W<D.length;W++){let ne=D[W],Y=[],$,se,fe,te=1e10,de=-1;for(;(de=t.indexOf(W,de+1))!=-1;){let we=de-de%3;$=t[we+(de+1)%3],se=t[we+(de+2)%3],fe=ne.distanceToSquared(D[$]),te=Math.min(te,fe),Y.push([$,se,fe])}te+=1e-6;let le=[],_e=0,be=Y.length;for(let we=0;we<be;we++){[$,se,fe]=Y[_e];let Me=((X=T[$])==null?void 0:X.includes(W))==!0;fe<=te&&le.push($+ +Me*I),_e=Y.findIndex(Ne=>Ne[0]==se)}T.push(le)}let R=[];{let W=0,ne=0,Y,$,se=h==3;for(let fe=0;fe<=s;fe++){Y=fe*(fe+1)/2,$=(fe+1)*(fe+2)/2;for(let te=0;te<s-fe;te++)[W,ne]=[Y+te+fe+2,$+te+fe+3],R.push(Y,$,...se?[ne,Y]:[W,$],ne,W),[Y,$]=[W,ne];R.push(Y,$,Y+s+2)}}let O=d.clone(),P=d.clone(),U=d.clone(),H=d.clone(),V=d.clone(),j=[],J=E(D.length,()=>E(h,()=>d.clone()));for(let W=0;W<D.length;W++){d.copy(D[W]).normalize(),O.copy(d).multiplyScalar(y);let ne=T[W];for(let le=0;le<ne.length;le++){let _e=ne[le],be=ne[(le+1)%h];g.setFromPointsAndIndices(D,W,_e%I,be%I),g.b.sub(g.a).setLength(1e10).add(g.a),g.c.sub(g.a).setLength(1e10).add(g.a),g.closestPointToPoint(O,J[W][le])}let Y=[],$=[],se=[],fe=new G;s==0&&[...J[W]].reduce((le,_e)=>le.add(_e),fe).multiplyScalar(1/h);for(let le=0;le<h;le++){let _e=[],be=(le-1+h)%h,we=J[W][be],Me=J[W][le];d.copy(we).sub(O),p.copy(Me).sub(O);let Ne=O.angleTo(d),Ge=d.angleTo(p),We=Math.cos(Ne)*x;s==0?P.copy(fe):P.copy(O).setLength(y+We),$.push(We);let ae=[P,we,Me];for(let He=0;He<2;He++){let Ke=ae[He],je=ae[He+1];H.subVectors(Ke,O),V.subVectors(je,O),U.crossVectors(H,V).normalize();for(let Oe=0;Oe<b;Oe++){let Qe=[Ne,Ge][He]*Oe/b;d.copy(H).applyAxisAngle(U,Qe).add(O),Y.push(d.clone()),He&&(w(d,O),_e.push([Oe==0?Ke:d.clone(),A.clone()]))}He&&(w(je,O),_e.push([je,A.clone()]))}se.push(_e)}j.push(se);let te=2*b,de=2;for(let le=0;le<h;le++){let _e=te*le,be=te*((le+1)%h),we=[Y[_e]];for(let Ne=1;Ne<b;Ne++){H=Y[_e+Ne],V=Y[be+Ne],we.push(H);for(let Ge=1,We=Ne-de+1;Ge<=We;Ge++)d.lerpVectors(H,V,Ge/(We+1)),d.sub(O).setLength($[le]).add(O),we.push(d.clone());we.push(V)}for(let Ne=0;Ne<b;Ne++)we.push(Y[Ne+b+_e]);we.push(Y[be+b]);let Me=R.map(Ne=>we[Ne]);a.push(...Me.map(Ne=>[Ne.x,Ne.y,Ne.z]).flat()),l.push(...Me.map(Ne=>(w(Ne,O),[A.x,A.y,A.z])).flat())}}let F=[];for(let W=0;W<T.length;W++)for(let ne=0;ne<h;ne++){let Y=T[W][ne];if(Y<I){let $=T[Y].findIndex(te=>te%I==W),se=j[W][ne],fe=j[Y][$];for(let te=0;te<b;te++){let de=se[te],le=fe[b-te],_e=se[te+1],be=fe[b-(te+1)];[de,le,_e,_e,le,be].forEach(we=>{a.push(we[0].x,we[0].y,we[0].z),l.push(we[1].x,we[1].y,we[1].z)})}F.push(se[0][0],fe[b][0],se[b][0],fe[0][0])}}for(;F.length;){let W,ne,Y,$;[W,ne]=F.splice(0,2);let se=[W];for(;W!=ne;)se.push(ne),Y=F.indexOf(ne),$=Y%2,ne=F.splice(Y-$,2)[1-$];A.subVectors(se[0],se[1]).cross(d.subVectors(se[0],se[2])).normalize();let fe=A.dot(se[0])<0;fe&&A.negate();for(let te=1;te<=se.length-2;te++)[se[te+ +fe],se[te+1-+fe],se[0]].forEach(de=>{a.push(de.x,de.y,de.z),l.push(A.x,A.y,A.z)})}}function u(){let h=new G;for(let T=0;T<a.length;T+=3){h.x=a[T+0],h.y=a[T+1],h.z=a[T+2];let I=E(h)/2/Math.PI+.5,R=D(h)/Math.PI+.5;o.push(I,1-R)}let d=new G,p=new G,g=new G,x=new G,y=new Ae,b=new Ae,A=new Ae,w=(T,I,R,O)=>{O<0&&T.x===1&&(o[I]=T.x-1),R.x===0&&R.z===0&&(o[I]=O/2/Math.PI+.5)};for(let T=0,I=0;T<a.length;T+=9,I+=6){d.set(a[T+0],a[T+1],a[T+2]),p.set(a[T+3],a[T+4],a[T+5]),g.set(a[T+6],a[T+7],a[T+8]),y.set(o[I+0],o[I+1]),b.set(o[I+2],o[I+3]),A.set(o[I+4],o[I+5]),x.copy(d).add(p).add(g).divideScalar(3);let R=E(x);w(y,I+0,d,R),w(b,I+2,p,R),w(A,I+4,g,R)}for(let T=0;T<o.length;T+=6){let I=o[T+0],R=o[T+2],O=o[T+4],P=Math.max(I,R,O),U=Math.min(I,R,O);P>.9&&U<.1&&(I<.2&&(o[T+0]+=1),R<.2&&(o[T+2]+=1),O<.2&&(o[T+4]+=1))}function E(T){return Math.atan2(T.z,-T.x)}function D(T){return Math.atan2(-T.y,Math.sqrt(T.x*T.x+T.z*T.z))}}}static fromJSON(e){return new S5(e.vertices,e.indices,e.radius,e.corner,e.cornerSides)}},CLe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:n,detail:r,corner:s,cornerSides:a}=e.parameters,o=r===0&&s!==0?new nee(t*.5,s,a):new uZ(t*.5,r);return o.scale(1,i/t,n/t),Object.assign(o,{userData:{...e,type:"DodecahedronGeometry"}})}},nee=class extends S5{constructor(e=1,t=.2,i=4){let n=(1+Math.sqrt(5))/2,r=1/n,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],o="DodecahedronGeometry";super(s,a,o,e,t,i),this.type=o}static fromJSON(e){return new nee(e.radius,e.corner,e.cornerSides)}},V_=1e-12,_5=class{constructor(e){this.position=new Ae,this.startPosition=new Ae,this.uuid=qt.generateUUID(),this.position=e.clone()}start(){this.reset()}reset(){this.startPosition.copy(this.position)}applyOffset(e){this.position.copy(this.startPosition).add(e)}copy(e){return this.position.copy(e.position),this.startPosition.copy(e.startPosition),this}clone(){return new _5(this.position).copy(this)}toJSON(){return[this.position.x,this.position.y]}},$N=class extends _5{constructor(e){super(e.position),this.parent=e}copy(e){return super.copy(e),this}clone(){return new $N(this.parent).copy(this)}},R1=class extends _5{constructor(e,t){super(t),this.controls=[],this.roundness=0,this.areControlsDirectionsMirrored=!0,this.uuid=e,this.controls.push(new $N(this),new $N(this))}static create(e,t){let i=new R1(e,new Ae(...t.position));return i.controls[0].position.set(...t.controlPrevious.position),i.controls[1].position.set(...t.controlNext.position),i.roundness=t.roundness,i.areControlsDirectionsMirrored=t.areControlsDirectionsMirrored,i}getOppositeControl(e){let t=this.controls.indexOf(e);return t===0?this.controls[1]:t===1?this.controls[0]:null}applyOffsetToControls(e,t=1){for(let i=0,n=this.controls.length;i<n;i++){let r=this.controls[i];this.position.distanceTo(r.position)<=t?r.position.copy(this.position):r.applyOffset(e)}}controlsMoved(){return!(this.position.equals(this.controls[0].position)&&this.position.equals(this.controls[1].position))}copy(e){return super.copy(e),this.controls[0].copy(e.controls[0]),this.controls[1].copy(e.controls[1]),this.roundness=e.roundness,this.uuid=e.uuid,this}clone(){return new R1(this.uuid,this.position).copy(this)}toJSON(){return super.toJSON().concat(this.controls[0].toJSON(),this.controls[1].toJSON(),[this.roundness])}computeTangents(){var i,n;let e=(i=this.curveBefore)==null?void 0:i.getTangentAt(1),t=(n=this.curveAfter)==null?void 0:n.getTangentAt(0);return[e,t]}computeNormals(e=new Ae,t=new Ae){let[i,n]=this.computeTangents();return i&&n&&(_W(i,e),_W(n,t)),[e,t]}computeTangent(e=new Ae){let[t,i]=this.computeTangents();return t&&i&&e.copy(t).add(i).normalize(),e}computeNormal(e=new Ae){let[t,i]=this.computeNormals();return e.copy(t).add(i).normalize(),e}};function _W(e,t=new Ae){let i=e.length();return t.set(-e.y/i,e.x/i)}var A5=e=>e,Hb=new Ae,aP=new Ae,DLe=new Ae,RLe=new Ae,PLe=new Ae,OLe=new Ae,ree=new G,see=new G;function BLe(e){let t=new Ae;t.addVectors(e.v0,Hb.subVectors(e.v1,e.v0).multiplyScalar(2/3));let i=new Ae;return i.addVectors(e.v2,aP.subVectors(e.v1,e.v2).multiplyScalar(2/3)),new Xu(e.v0,t,i,e.v2)}function uA(e,t,i=Number.EPSILON){return Math.abs(e-t)<i}function ILe(e,t,i=Number.EPSILON){return e.distanceTo(t)<i}function LLe(e,t,i=Number.EPSILON){return e.distanceTo(t)<i}function aee(e,t,i){let n=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),r=Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)),s=Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2));return Math.acos((r*r+n*n-s*s)/(2*r*n))}function ULe(e,t,i){return wW(e,t)&&wW(t,i)&&ez(e.position,t.position,i.position)}function ez(e,t,i){return Hb.copy(t).sub(e).cross(aP.copy(i).sub(e))===0}function NLe(e,t,i,n,r){let s=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),a=(e.y+t.y)/2,o=(e.x+t.x)/2,l=Math.sqrt(Math.pow(i,2)-Math.pow(s/2,2))*(e.y-t.y)/s,c=Math.sqrt(Math.pow(i,2)-Math.pow(s/2,2))*(t.x-e.x)/s;return n.set(o+l,a+c),r.set(o-l,a-c),[n,r]}function zLe(e,t,i){let n=e.distanceTo(i),r=t.distanceTo(i);return n<r?t:e}function FLe(e,t,i,n,r,s){let a=t.x-e.x,o=t.y-e.y,l=i.x-e.x,c=i.y-e.y,u=Math.sqrt((a+l)*(a+l)+(o+c)*(o+c)),h;return aee(t,e,i)>Math.PI&&(u*=-1),uA(c,o)?h=(o+c)*(n/u-.5)*8/3/(a-l):h=(a+l)*(n/u-.5)*8/3/(c-o),r.set(t.x-h*o,t.y+h*a),s.set(i.x+h*c,i.y-h*l),[r,s]}function AW(e,t){return e.position.equals(e.controls[1].position)&&t.position.equals(t.controls[0].position)}function wW(e,t){return ez(e.position,e.controls[1].position,t.position)&&ez(e.position,t.controls[0].position,t.position)}function VLe(e,t,i,n,r=.5){let s=Hb.subVectors(t,e).multiplyScalar(r).add(e),a=aP.subVectors(i,t).multiplyScalar(r).add(t),o=DLe.subVectors(n,i).multiplyScalar(r).add(i),l=s,c=RLe.subVectors(a,s).multiplyScalar(r).add(s),u=PLe.subVectors(o,a).multiplyScalar(r).add(a),h=o,d=OLe.subVectors(u,c).multiplyScalar(r).add(c);return[e.x,e.y,l.x,l.y,c.x,c.y,d.x,d.y,u.x,u.y,h.x,h.y,n.x,n.y]}function HLe(e,t,i=12,n=!0){let r=see.set(0,0,0),s,a=0;for(let o=0;o<t.length;o++){let l=A5(t[o]),c=Hb,u=M0(l,i);for(let h=0;h<=u;h++)if(l instanceof Xu||l instanceof ng||l instanceof Ku){if(l.getPoint(h/u,c),r.set(c.x,c.y,0),s!==void 0&&LLe(s,r))continue;s===void 0&&(s=ree),s.copy(r),e.setXYZ(a,r.x,r.y,r.z),a++}}return n&&a>1&&!(e.getX(a-1)===e.getX(0)&&e.getY(a-1)===e.getY(0)&&e.getZ(a-1)===e.getZ(0))&&(e.setXYZ(a,e.getX(0),e.getY(0),e.getZ(0)),a++),e}function GLe(e,t,i,n=12,r=!0){let s=see.set(0,0,0),a=0,o=[];for(let l=0;l<t.length;l++){if(i[l]===!1)continue;let c,u=A5(t[l]),h=Hb,d=M0(u,n);o.push(d);for(let p=0;p<=d;p++)if(u instanceof Xu||u instanceof ng||u instanceof Ku){if(u.getPoint(p/d,h),s.set(h.x,h.y,0),c==null?void 0:c.equals(s))continue;c===void 0?c=ree:(e.setXYZ(a,c.x,c.y,c.z),a++,e.setXYZ(a,s.x,s.y,s.z),a++),c.copy(s)}}return r&&a>1&&!(e.getX(a-1)===e.getX(0)&&e.getY(a-1)===e.getY(0)&&e.getZ(a-1)===e.getZ(0))&&(e.setXYZ(a,e.getX(0),e.getY(0),e.getZ(0)),a++),o}function MW(e,t=12,i=!1){let n=[];for(let r=0,s=e.length;r<s;r++){let a=e[r],o=0;if(i&&a.roundedCurveCorner!==void 0){let l=M0(a.roundedCurveCorner,t)*.5;r>0&&(n[r-1]+=l),o+=l}a.curveAfter!==void 0&&(o+=M0(a.curveAfter,t)),n.push(o)}return e.length>0&&i&&e[0].roundedCurveCorner!==void 0&&(n[e.length-1]+=M0(e[0].roundedCurveCorner,t)*.5),n}function M0(e,t=12){return e&&e instanceof WR?t*2:e&&(e instanceof Ku||e instanceof oZ)?1:e&&e instanceof N4?t*e.points.length:t}function kLe(e,t,i=12,n=!0){let r,s=0;for(let a=0;a<t.length;a++){let o=A5(t[a]),l=M0(o,i),c=Hb;for(let u=0;u<=l;u++)if(o instanceof Xu||o instanceof ng||o instanceof Ku){if(o.getPoint(u/l,c),r!==void 0&&ILe(r,c,V_))continue;r===void 0&&(r=aP),r.copy(c),e.push(c.x,c.y),s++}}return uA(e[0],e[e.length-2],V_)&&uA(e[1],e[e.length-1],V_)&&(e.pop(),e.pop()),n&&s>1&&!(uA(e[s-1],e[1],V_)&&uA(e[s-2],e[0],V_))&&(e.push(e[0],e[1]),s++),e}var UI=new Ae,jLe=new Ae,WLe=new Ae,XLe=new Ae,qLe=new Ae,YLe=new Ae,$r=class extends n3{constructor(e=100,t=100){super(),this.points=[],this.shapeHoles=[],this.plane=new _l(new G(0,0,-1)),this.subdivision=0,this.controlSnapDistance=4,this.pointIDs=0,this.isMesh2D=!1,this.isText=!1,this._roundness=0,this.isClosed=!1,this.useCubicForRoundedCorners=!0,this.uuid=qt.generateUUID(),this.needsUpdate=!1,this.roundedCurves=[],this._width=e,this._height=t}static createFromState(e,t,i){let n=new $r;return n.isClosed=e.isClosed,n.points=e.points.map(r=>R1.create(r.id,r.data)),typeof e.roundness=="number"&&(n.roundness=e.roundness),n.shapeHoles=e.shapeHoles.map(r=>$r.createFromState(r)),t!==void 0&&i!==void 0&&n.applySize(t,i),n.update(),n}get width(){return this._width}get height(){return this._height}get roundness(){return this._roundness}set roundness(e){if(this._roundness!==e){this._roundness=e;for(let t=0,i=this.points.length;t<i;t++)this.points[t].roundness=e;this.needsUpdate=!0}}getPointsIndexesByIds(e){return e.map(t=>this.getPointIndexById(t)).filter(t=>t>=0)}getPointIndexById(e){let t=this.points.length,i=this.points.findIndex(n=>n.uuid===e);if(i<0){let n=t;for(let r=0,s=this.shapeHoles.length;r<s;r++){let a=this.shapeHoles[r],o=a.points.length,l=a.getPointIndexById(e);if(l<0)n+=o;else return l+n}}return i}getLineIndexById(e){return this.getPointIndexById(e)}getBezierPoint(e){if(e<=this.points.length-1)return this.points[e];if(this.shapeHoles.length>0){let t=this.points.length;for(let i=0,n=this.shapeHoles.length;i<n;i++){let r=this.shapeHoles[i],s=e-t;if(s<=r.points.length-1)return r.points[s];t+=r.points.length}}throw new Error("This shape does not have a point for this index: "+e)}getBezierPointIndex(e){let t=this.points.indexOf(e);if(t>=0)return t;if(t=this.points.length,this.shapeHoles.length>0)for(let i=0,n=this.shapeHoles.length;i<n;i++){let r=this.shapeHoles[i],s=r.points.indexOf(e);if(s>=0)return t+s;t+=r.points.length}return-1}getAllPoints(){let e=[].concat(...this.shapeHoles.map(t=>t.points));return[...this.points,...e]}applySize(e,t){e===0&&(e=.001),t===0&&(t=.001),this._width=e,this._height=t}applyScale(e,t){let i=UI.set(e,t);for(let n=0,r=this.points.length;n<r;n++){let s=this.points[n];s.position.multiply(i),s.controls[0].position.multiply(i),s.controls[1].position.multiply(i)}for(let n=0,r=this.shapeHoles.length;n<r;n++)this.shapeHoles[n].applyScale(e,t);this._update()}createPoint(e,t=0,i=qt.generateUUID()){let n;e instanceof Ae?n=e:n=new Ae(e,t);let r=new R1(i,n);return r.roundness=this.roundness,r}addPoint(e){this.points.push(e),this.needsUpdate=!0}addPointAt(e,t){this.points.splice(t,0,e),this.needsUpdate=!0}getPointByUuid(e){for(let t=0,i=this.points.length;t<i;t++){let n=this.points[t];if(n.uuid===e)return n}for(let t=0,i=this.shapeHoles.length;t<i;t++){let n=this.shapeHoles[t].getPointByUuid(e);if(n)return n}}getFirstPoint(){return this.points[0]}getLastPoint(){return this.points[this.points.length-1]}removePoint(e){let t=this.points.indexOf(e);t>=0&&this.points.splice(t,1),this.needsUpdate=!0}removePointById(e){let t=this.points.find(i=>i.uuid===e);t&&this.removePoint(t)}update(){for(let e=0,t=this.shapeHoles.length;e<t;e++)this.shapeHoles[e].update();this._update()}extractShapePointsToBuffer(e,t=12,i=!1){this.subdivision=t,this.curveDivisions===void 0&&this.computeCurveDivisions(t);let n=i?this.roundedCurveDivisions:this.curveDivisions;return HLe(e,i?this.roundedCurves:this.curves,t,this.autoClose),n.reduce((r,s)=>r+s,0)+1}computeCurveDivisions(e=12){return this.curveDivisions=MW(this.points,e,!1),this.roundedCurveDivisions=MW(this.points,e,!0),this.curveDivisions}extractFilteredShapePointsToBuffer(e,t,i=12){return GLe(e,this.curves,t,i,this.autoClose).reduce((n,r)=>n+r,0)*2}extractShapePointsToFlatArray(e,t=12){return this.subdivision=t,this.curveDivisions===void 0&&this.computeCurveDivisions(t),kLe(e,this.roundedCurves,t,this.autoClose)}getCurveIndexFromVertexId(e,t=!1){let i=0;this.curveDivisions===void 0&&this.computeCurveDivisions(this.subdivision);let n=t?this.roundedCurveDivisions:this.curveDivisions,r=0;t&&this.points[0].roundedCurveCorner!==void 0&&(r=M0(this.points[0].roundedCurveCorner,this.subdivision)*.5);let s=e-r;s<0&&(s+=n.reduce((a,o)=>a+o,0));for(let a=0,o=n.length;a<o;a++){let l=n[a];if(s<i+l)return[a,(s-i+1)/l];i+=l}return[0,1]}getCurveT(e,t,i){let n=this.points[e],r=this.points[e>=this.points.length-1?0:e+1],s=this.curveDivisions,a=s[e];if(AW(n,r)){let l=n.position.distanceTo(r.position);return n.position.distanceTo(UI.set(i.x,i.y))/l}let o=0;for(let l=0;l<e;l++)o+=s[l];return(t-o)/a}dispose(){}_applyCurveForPoint(e,t){AW(t,e)?this.lineTo(e.position.x,e.position.y):this.bezierCurveTo(t.controls[1].position.x,t.controls[1].position.y,e.controls[0].position.x,e.controls[0].position.y,e.position.x,e.position.y);let i=this.curves[this.curves.length-1];e.curveBefore=i,t.curveAfter=i;let n=i.clone();e.roundedCurveBefore=n,t.roundedCurveAfter=n,e.roundedCurveCorner=void 0,this.roundedCurves.push(n)}_update(){if(this.curves=[],this.roundedCurves=[],!this.points.length)return;for(let t=0,i=this.points.length;t<i;t++){let n=this.points[t];if(t===0)this.moveTo(n.position.x,n.position.y);else{let r=this.points[t-1];this._applyCurveForPoint(n,r)}}let e=this.getLastPoint();if(e!=null&&e.curveAfter&&(e.curveAfter=void 0),this.isClosed){let t=this.points[0],i=this.points[this.points.length-1];this._applyCurveForPoint(t,i)}if(this.points.length>2){let t=0;for(let i=0,n=this.points.length;i<n;i++){let r=this.points[i],s=this.points[i-1]??this.points[this.points.length-1],a=this.points[i+1]??this.points[0],o=r.roundness,l=s&&a&&ULe(s,r,a);if(!r.controlsMoved()&&o>0&&!l){let c=r.curveBefore,u=r.curveAfter;if(c===void 0||u===void 0)continue;let h=r.roundedCurveBefore,d=r.roundedCurveAfter,p=c.getLength(),g=u.getLength(),x=Math.min(o,p*.499),y=Math.min(o,g*.499),b=Math.min(x,y),A=1-b/p,w=b/g,E=c.getPointAt(A,UI),D=u.getPointAt(w,jLe);this._subSplitCurve(c,h,A,E,void 0),this._subSplitCurve(u,d,w,void 0,D);let T;if(this.useCubicForRoundedCorners){let I=aee(E,r.position,D)/2,R=Math.tan(I)*E.distanceTo(r.position),[O,P]=NLe(E,D,R,WLe,XLe),U=zLe(O,P,r.position),[H,V]=FLe(U,E,D,R,qLe,YLe);T=new Xu(E.clone(),H.clone(),V.clone(),D.clone())}else T=new ng(E.clone(),r.position.clone(),D.clone());r.roundedCurveCorner=T,this.roundedCurves.splice(i+t,0,T),t++}}}}_subSplitCurve(e,t,i,n,r){if(e instanceof Ku)n!==void 0&&t.v2.copy(n),r!==void 0&&t.v1.copy(r);else{let s=e,a=t,o=s.getUtoTmapping(i,0),l=VLe(s.v0,s.v1,s.v2,s.v3,o);return n!==void 0&&(a.v0.set(l[0],l[1]),a.v1.set(l[2],l[3]),a.v2.set(l[4],l[5]),a.v3.set(l[6],l[7])),r!==void 0&&(a.v0.set(l[6],l[7]),a.v1.set(l[8],l[9]),a.v2.set(l[10],l[11]),a.v3.set(l[12],l[13])),a}return t}clone(){let e=new $r(this._width,this._height);return e.points=this.points.map(t=>t.clone()),e.isClosed=this.isClosed,e.roundness=this.roundness,e.isMesh2D=this.isMesh2D,e.shapeHoles=this.shapeHoles.map(t=>t.clone()),e}toJSON(){return{points:this.points.reduce((e,t)=>e.concat(t.toJSON()),[]),shapeHoles:this.shapeHoles.map(e=>e.toJSON()),isClosed:this.isClosed,roundness:this.roundness}}fromJSON(e){var i;this.points=[],this.pointIDs=0;let t=e.points.length/7;for(let n=0;n<t;n++){let r=n*7,s=e.points[r+0],a=e.points[r+1],o=e.points[r+2],l=e.points[r+3],c=e.points[r+4],u=e.points[r+5],h=e.points[r+6],d=new R1(qt.generateUUID(),new Ae(s,a));d.controls[0].position.set(o,l),d.controls[1].position.set(c,u),d.roundness=h,this.points.push(d)}return this.shapeHoles=(i=e.shapeHoles)!=null&&i.length?e.shapeHoles.map(n=>{let r=new $r;return r.fromJSON(n),r}):[],this.isClosed=e.isClosed,this._roundness=e.roundness,this._update(),this}fromShape(e,t=!1){this.isText=t;let i=(r,s)=>{s instanceof Xu&&s.v3.equals(r.position)&&r.controls[0].position.copy(s.v2)},n=r=>{let s=[],a,o;for(a=0,o=r.length;a<o;a++)r[a]instanceof ng&&(r[a]=BLe(r[a]));for(a=0,o=r.length;a<o;a++){let u=r[a],h=a>0?r[a-1]:null,d;u instanceof Xu?(d=this.createPoint(u.v0),d.controls[1].position.copy(u.v1)):u instanceof Ku&&(d=this.createPoint(u.v1)),d!==void 0&&(h!==null&&i(d,h),s.push(d))}let l=r[r.length-1],c=!1;return l instanceof Xu?l.v3.equals(s[0].position)&&(s[0].controls[0].position.copy(l.v2),c=!0):l instanceof Ku&&l.v2.equals(s[0].position)&&(c=!0),this.isClosed=c,s};return this.points=n(e.curves),e instanceof n3&&(this.shapeHoles=e.holes.map(r=>{let s=new $r;return s.fromShape(r),s})),this.update(),this}updatePoint(e,t){let i=this.getPointByUuid(e);i&&(t.position!==void 0&&i.position.fromArray(t.position),t.roundness!==void 0&&(i.roundness=t.roundness),t.areControlsDirectionsMirrored!==void 0&&(i.areControlsDirectionsMirrored=t.areControlsDirectionsMirrored),this.needsUpdate=!0)}updatePreviousControl(e,t){var n;let i=(n=this.getPointByUuid(e))==null?void 0:n.controls[0];i&&(t.position&&i.position.fromArray(t.position),this.needsUpdate=!0)}updateNextControl(e,t){var n;let i=(n=this.getPointByUuid(e))==null?void 0:n.controls[1];i&&(t.position&&i.position.fromArray(t.position),this.needsUpdate=!0)}},oee=Math.PI*2;function NI({x:e,y:t},i,n,r,s){return{x:e*i+r,y:t*n+s}}function QLe(e,t){let i=t===1.5707963267948966?.551915024494:t===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(t/4),n=Math.cos(e),r=Math.sin(e),s=Math.cos(e+t),a=Math.sin(e+t);return[{x:n-r*i,y:r+n*i},{x:s+a*i,y:a-s*i},{x:s,y:a}]}function EW(e,t,i,n){let r=e*n-t*i<0?-1:1,s=Math.min(1,Math.max(-1,e*i+t*n));return r*Math.acos(s)}function KLe(e,t,i,n,r,s,a,o,l,c){let u=Math.pow(r,2),h=Math.pow(s,2),d=Math.pow(a,2),p=Math.pow(o,2),g=u*h-u*p-h*d;g<0&&(g=0),g/=u*p+h*d,g=Math.sqrt(g)*(l===c?-1:1);let x=g*r/s*o,y=g*-s/r*a,b=x+(e+i)/2,A=y+(t+n)/2,w=(a-x)/r,E=(o-y)/s,D=(-a-x)/r,T=(-o-y)/s,I=EW(1,0,w,E),R=EW(w,E,D,T);return R<0&&(R+=oee),{centerx:b,centery:A,ang1:I,ang2:R}}function JLe({px:e,py:t,cx:i,cy:n,rx:r,ry:s,largeArcFlag:a,sweepFlag:o}){let l=[];if(r===0||s===0)return[];let c=(e-i)/2,u=(t-n)/2;if(c===0&&u===0)return[];r=Math.abs(r),s=Math.abs(s);let h=Math.pow(c,2)/Math.pow(r,2)+Math.pow(u,2)/Math.pow(s,2);h>1&&(r*=Math.sqrt(h),s*=Math.sqrt(h));let d=KLe(e,t,i,n,r,s,c,u,a,o),{ang1:p,ang2:g}=d,{centerx:x,centery:y}=d,b=Math.abs(g)/(oee/4);Math.abs(1-b)<1e-7&&(b=1);let A=Math.max(Math.ceil(b),1);g/=A;for(let w=0;w<A;w++)l.push(QLe(p,g)),p+=g;return l.map(w=>{let{x:E,y:D}=NI(w[0],r,s,x,y),{x:T,y:I}=NI(w[1],r,s,x,y),{x:R,y:O}=NI(w[2],r,s,x,y);return{x1:E,y1:D,x2:T,y2:I,x:R,y:O}})}var $n;(function(e){e[e.ODD=0]="ODD",e[e.NONZERO=1]="NONZERO",e[e.POSITIVE=2]="POSITIVE",e[e.NEGATIVE=3]="NEGATIVE",e[e.ABS_GEQ_TWO=4]="ABS_GEQ_TWO"})($n||($n={}));var Ts;(function(e){e[e.POLYGONS=0]="POLYGONS",e[e.CONNECTED_POLYGONS=1]="CONNECTED_POLYGONS",e[e.BOUNDARY_CONTOURS=2]="BOUNDARY_CONTOURS"})(Ts||(Ts={}));function Mi(e,t){if(!e)throw t||"Assertion Failed!"}var hi=function(){function e(){}return e.vertEq=function(t,i){return t.s===i.s&&t.t===i.t},e.vertLeq=function(t,i){return t.s<i.s||t.s===i.s&&t.t<=i.t},e.transLeq=function(t,i){return t.t<i.t||t.t===i.t&&t.s<=i.s},e.edgeGoesLeft=function(t){return e.vertLeq(t.Dst,t.Org)},e.edgeGoesRight=function(t){return e.vertLeq(t.Org,t.Dst)},e.vertL1dist=function(t,i){return Math.abs(t.s-i.s)+Math.abs(t.t-i.t)},e.edgeEval=function(t,i,n){Mi(e.vertLeq(t,i)&&e.vertLeq(i,n));var r=i.s-t.s,s=n.s-i.s;return r+s>0?r<s?i.t-t.t+(t.t-n.t)*(r/(r+s)):i.t-n.t+(n.t-t.t)*(s/(r+s)):0},e.edgeSign=function(t,i,n){Mi(e.vertLeq(t,i)&&e.vertLeq(i,n));var r=i.s-t.s,s=n.s-i.s;return r+s>0?(i.t-n.t)*r+(i.t-t.t)*s:0},e.transEval=function(t,i,n){Mi(e.transLeq(t,i)&&e.transLeq(i,n));var r=i.t-t.t,s=n.t-i.t;return r+s>0?r<s?i.s-t.s+(t.s-n.s)*(r/(r+s)):i.s-n.s+(n.s-t.s)*(s/(r+s)):0},e.transSign=function(t,i,n){Mi(e.transLeq(t,i)&&e.transLeq(i,n));var r=i.t-t.t,s=n.t-i.t;return r+s>0?(i.s-n.s)*r+(i.s-t.s)*s:0},e.vertCCW=function(t,i,n){return t.s*(i.t-n.t)+i.s*(n.t-t.t)+n.s*(t.t-i.t)>=0},e.interpolate=function(t,i,n,r){return t=t<0?0:t,n=n<0?0:n,t<=n?n===0?(i+r)/2:i+(r-i)*(t/(t+n)):r+(i-r)*(n/(t+n))},e.intersect=function(t,i,n,r,s){var a,o,l;e.vertLeq(t,i)||(l=t,t=i,i=l),e.vertLeq(n,r)||(l=n,n=r,r=l),e.vertLeq(t,n)||(l=t,t=n,n=l,l=i,i=r,r=l),e.vertLeq(n,i)?e.vertLeq(i,r)?(a=e.edgeEval(t,n,i),o=e.edgeEval(n,i,r),a+o<0&&(a=-a,o=-o),s.s=e.interpolate(a,n.s,o,i.s)):(a=e.edgeSign(t,n,i),o=-e.edgeSign(t,r,i),a+o<0&&(a=-a,o=-o),s.s=e.interpolate(a,n.s,o,r.s)):s.s=(n.s+i.s)/2,e.transLeq(t,i)||(l=t,t=i,i=l),e.transLeq(n,r)||(l=n,n=r,r=l),e.transLeq(t,n)||(l=t,t=n,n=l,l=i,i=r,r=l),e.transLeq(n,i)?e.transLeq(i,r)?(a=e.transEval(t,n,i),o=e.transEval(n,i,r),a+o<0&&(a=-a,o=-o),s.t=e.interpolate(a,n.t,o,i.t)):(a=e.transSign(t,n,i),o=-e.transSign(t,r,i),a+o<0&&(a=-a,o=-o),s.t=e.interpolate(a,n.t,o,r.t)):s.t=(n.t+i.t)/2},e}(),H_=function(){function e(){this.next=null,this.prev=null,this.anEdge=null,this.trail=null,this.n=0,this.marked=!1,this.inside=!1}return e}(),GT=function(){function e(t){this.side=t,this.next=null,this.Org=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Lface=null,this.activeRegion=null,this.winding=0}return Object.defineProperty(e.prototype,"Rface",{get:function(){return this.Sym.Lface},set:function(t){this.Sym.Lface=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dst",{get:function(){return this.Sym.Org},set:function(t){this.Sym.Org=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Oprev",{get:function(){return this.Sym.Lnext},set:function(t){this.Sym.Lnext=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Lprev",{get:function(){return this.Onext.Sym},set:function(t){this.Onext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dprev",{get:function(){return this.Lnext.Sym},set:function(t){this.Lnext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rprev",{get:function(){return this.Sym.Onext},set:function(t){this.Sym.Onext=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dnext",{get:function(){return this.Sym.Onext.Sym},set:function(t){this.Sym.Onext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rnext",{get:function(){return this.Sym.Lnext.Sym},set:function(t){this.Sym.Lnext.Sym=t},enumerable:!0,configurable:!0}),e}(),t1=function(){function e(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0}return e}(),TW=function(){function e(){var t=new t1,i=new H_,n=new GT(0),r=new GT(1);t.next=t.prev=t,t.anEdge=null,i.next=i.prev=i,n.next=n,n.Sym=r,r.next=r,r.Sym=n,this.vHead=t,this.fHead=i,this.eHead=n,this.eHeadSym=r}return e.prototype.makeEdge_=function(t){var i=new GT(0),n=new GT(1);t.Sym.side<t.side&&(t=t.Sym);var r=t.Sym.next;return n.next=r,r.Sym.next=i,i.next=t,t.Sym.next=n,i.Sym=n,i.Onext=i,i.Lnext=n,i.Org=null,i.Lface=null,i.winding=0,i.activeRegion=null,n.Sym=i,n.Onext=n,n.Lnext=i,n.Org=null,n.Lface=null,n.winding=0,n.activeRegion=null,i},e.prototype.splice_=function(t,i){var n=t.Onext,r=i.Onext;n.Sym.Lnext=i,r.Sym.Lnext=t,t.Onext=r,i.Onext=n},e.prototype.makeVertex_=function(t,i,n){var r=t;Mi(r,"Vertex can't be null!");var s=n.prev;r.prev=s,s.next=r,r.next=n,n.prev=r,r.anEdge=i;var a=i;do a.Org=r,a=a.Onext;while(a!==i)},e.prototype.makeFace_=function(t,i,n){var r=t;Mi(r,"Face can't be null");var s=n.prev;r.prev=s,s.next=r,r.next=n,n.prev=r,r.anEdge=i,r.trail=null,r.marked=!1,r.inside=n.inside;var a=i;do a.Lface=r,a=a.Lnext;while(a!==i)},e.prototype.killEdge_=function(t){t.Sym.side<t.side&&(t=t.Sym);var i=t.next,n=t.Sym.next;i.Sym.next=n,n.Sym.next=i},e.prototype.killVertex_=function(t,i){var n=t.anEdge,r=n;do r.Org=i,r=r.Onext;while(r!==n);var s=t.prev,a=t.next;a.prev=s,s.next=a},e.prototype.killFace_=function(t,i){var n=t.anEdge,r=n;do r.Lface=i,r=r.Lnext;while(r!==n);var s=t.prev,a=t.next;a.prev=s,s.next=a},e.prototype.makeEdge=function(){var t=new t1,i=new t1,n=new H_,r=this.makeEdge_(this.eHead);return this.makeVertex_(t,r,this.vHead),this.makeVertex_(i,r.Sym,this.vHead),this.makeFace_(n,r,this.fHead),r},e.prototype.splice=function(t,i){var n=!1,r=!1;if(t!==i){if(i.Org!==t.Org&&(r=!0,this.killVertex_(i.Org,t.Org)),i.Lface!==t.Lface&&(n=!0,this.killFace_(i.Lface,t.Lface)),this.splice_(i,t),!r){var s=new t1;this.makeVertex_(s,i,t.Org),t.Org.anEdge=t}if(!n){var a=new H_;this.makeFace_(a,i,t.Lface),t.Lface.anEdge=t}}},e.prototype.delete=function(t){var i=t.Sym,n=!1;if(t.Lface!==t.Rface&&(n=!0,this.killFace_(t.Lface,t.Rface)),t.Onext===t)this.killVertex_(t.Org,null);else if(t.Rface.anEdge=t.Oprev,t.Org.anEdge=t.Onext,this.splice_(t,t.Oprev),!n){var r=new H_;this.makeFace_(r,t,t.Lface)}i.Onext===i?(this.killVertex_(i.Org,null),this.killFace_(i.Lface,null)):(t.Lface.anEdge=i.Oprev,i.Org.anEdge=i.Onext,this.splice_(i,i.Oprev)),this.killEdge_(t)},e.prototype.addEdgeVertex=function(t){var i=this.makeEdge_(t),n=i.Sym;this.splice_(i,t.Lnext),i.Org=t.Dst;var r=new t1;return this.makeVertex_(r,n,i.Org),i.Lface=n.Lface=t.Lface,i},e.prototype.splitEdge=function(t){var i=this.addEdgeVertex(t),n=i.Sym;return this.splice_(t.Sym,t.Sym.Oprev),this.splice_(t.Sym,n),t.Dst=n.Org,n.Dst.anEdge=n.Sym,n.Rface=t.Rface,n.winding=t.winding,n.Sym.winding=t.Sym.winding,n.idx=t.idx,n.Sym.idx=t.Sym.idx,n},e.prototype.connect=function(t,i){var n=!1,r=this.makeEdge_(t),s=r.Sym;if(i.Lface!==t.Lface&&(n=!0,this.killFace_(i.Lface,t.Lface)),this.splice_(r,t.Lnext),this.splice_(s,i),r.Org=t.Dst,s.Org=i.Org,r.Lface=s.Lface=t.Lface,t.Lface.anEdge=s,!n){var a=new H_;this.makeFace_(a,r,t.Lface)}return r},e.prototype.zapFace=function(t){var i=t.anEdge,n,r,s,a,o;r=i.Lnext;do n=r,r=n.Lnext,n.Lface=null,n.Rface===null&&(n.Onext===n?this.killVertex_(n.Org,null):(n.Org.anEdge=n.Onext,this.splice_(n,n.Oprev)),s=n.Sym,s.Onext===s?this.killVertex_(s.Org,null):(s.Org.anEdge=s.Onext,this.splice_(s,s.Oprev)),this.killEdge_(n));while(n!=i);a=t.prev,o=t.next,o.prev=a,a.next=o},e.prototype.countFaceVerts_=function(t){var i=t.anEdge,n=0;do n++,i=i.Lnext;while(i!==t.anEdge);return n},e.prototype.mergeConvexFaces=function(t){var i,n,r,s,a,o,l;for(i=this.fHead.next;i!==this.fHead;i=i.next)if(i.inside)for(n=i.anEdge,a=n.Org;r=n.Lnext,s=n.Sym,s&&s.Lface&&s.Lface.inside&&(o=this.countFaceVerts_(i),l=this.countFaceVerts_(s.Lface),o+l-2<=t&&hi.vertCCW(n.Lprev.Org,n.Org,s.Lnext.Lnext.Org)&&hi.vertCCW(s.Lprev.Org,s.Org,n.Lnext.Lnext.Org)&&(r=s.Lnext,this.delete(s),n=null,s=null)),!(n&&n.Lnext.Org===a);)n=r;return!0},e.prototype.check=function(){var t=this.fHead,i=this.vHead,n=this.eHead,r,s,a,o,l,c;for(s=t,s=t;(r=s.next)!==t;s=r){Mi(r.prev===s),l=r.anEdge;do Mi(l.Sym!==l),Mi(l.Sym.Sym===l),Mi(l.Lnext.Onext.Sym===l),Mi(l.Onext.Sym.Lnext===l),Mi(l.Lface===r),l=l.Lnext;while(l!==r.anEdge)}for(Mi(r.prev===s&&r.anEdge===null),o=i,o=i;(a=o.next)!==i;o=a){Mi(a.prev===o),l=a.anEdge;do Mi(l.Sym!==l),Mi(l.Sym.Sym===l),Mi(l.Lnext.Onext.Sym===l),Mi(l.Onext.Sym.Lnext===l),Mi(l.Org===a),l=l.Onext;while(l!==a.anEdge)}for(Mi(a.prev===o&&a.anEdge===null),c=n,c=n;(l=c.next)!==n;c=l)Mi(l.Sym.next===c.Sym),Mi(l.Sym!==l),Mi(l.Sym.Sym===l),Mi(l.Org!==null),Mi(l.Dst!==null),Mi(l.Lnext.Onext.Sym===l),Mi(l.Onext.Sym.Lnext===l);Mi(l.Sym.next===c.Sym&&l.Sym===this.eHeadSym&&l.Sym.Sym===l&&l.Org===null&&l.Dst===null&&l.Lface===null&&l.Rface===null)},e}(),CW=function(){function e(){this.handle=null}return e}(),DW=function(){function e(){this.key=null,this.node=0}return e}(),ZLe=function(){function e(t,i){this.leq=i,this.max=0,this.nodes=[],this.handles=[],this.initialized=!1,this.freeList=0,this.size=0,this.max=t,this.nodes=[],this.handles=[];for(var n=0;n<t+1;n++)this.nodes[n]=new CW,this.handles[n]=new DW;this.initialized=!1,this.nodes[1].handle=1,this.handles[1].key=null}return e.prototype.floatDown_=function(t){var i=this.nodes,n=this.handles,r,s,a;for(r=i[t].handle;;){if(a=t<<1,a<this.size&&this.leq(n[i[a+1].handle].key,n[i[a].handle].key)&&++a,Mi(a<=this.max),s=i[a].handle,a>this.size||this.leq(n[r].key,n[s].key)){i[t].handle=r,n[r].node=t;break}i[t].handle=s,n[s].node=t,t=a}},e.prototype.floatUp_=function(t){var i=this.nodes,n=this.handles,r,s,a;for(r=i[t].handle;;){if(a=t>>1,s=i[a].handle,a===0||this.leq(n[s].key,n[r].key)){i[t].handle=r,n[r].node=t;break}i[t].handle=s,n[s].node=t,t=a}},e.prototype.init=function(){for(var t=this.size;t>=1;--t)this.floatDown_(t);this.initialized=!0},e.prototype.min=function(){return this.handles[this.nodes[1].handle].key},e.prototype.insert=function(t){var i,n;if(i=++this.size,i*2>this.max){this.max*=2;var r,s;for(s=this.nodes.length,this.nodes.length=this.max+1,r=s;r<this.nodes.length;r++)this.nodes[r]=new CW;for(s=this.handles.length,this.handles.length=this.max+1,r=s;r<this.handles.length;r++)this.handles[r]=new DW}return this.freeList===0?n=i:(n=this.freeList,this.freeList=this.handles[n].node),this.nodes[i].handle=n,this.handles[n].node=i,this.handles[n].key=t,this.initialized&&this.floatUp_(i),n},e.prototype.extractMin=function(){var t=this.nodes,i=this.handles,n=t[1].handle,r=i[n].key;return this.size>0&&(t[1].handle=t[this.size].handle,i[t[1].handle].node=1,i[n].key=null,i[n].node=this.freeList,this.freeList=n,--this.size,this.size>0&&this.floatDown_(1)),r},e.prototype.delete=function(t){var i=this.nodes,n=this.handles,r;Mi(t>=1&&t<=this.max&&n[t].key!==null),r=n[t].node,i[r].handle=i[this.size].handle,n[i[r].handle].node=r,--this.size,r<=this.size&&(r<=1||this.leq(n[i[r>>1].handle].key,n[i[r].handle].key)?this.floatDown_(r):this.floatUp_(r)),n[t].key=null,n[t].node=this.freeList,this.freeList=t},e}(),zI=function(){function e(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1}return e}(),RW=function(){function e(){this.key=null,this.next=null,this.prev=null}return e}(),$Le=function(){function e(t,i){this.frame=t,this.leq=i,this.head=new RW,this.head.next=this.head,this.head.prev=this.head}return e.prototype.min=function(){return this.head.next},e.prototype.max=function(){return this.head.prev},e.prototype.insert=function(t){return this.insertBefore(this.head,t)},e.prototype.search=function(t){var i=this.head;do i=i.next;while(i.key!==null&&!this.leq(this.frame,t,i.key));return i},e.prototype.insertBefore=function(t,i){do t=t.prev;while(t.key!==null&&!this.leq(this.frame,t.key,i));var n=new RW;return n.key=i,n.next=t.next,t.next.prev=n,n.prev=t,t.next=n,n},e.prototype.delete=function(t){t.next.prev=t.prev,t.prev.next=t.next},e}(),eUe=function(){function e(){}return e.regionBelow=function(t){return t.nodeUp.prev.key},e.regionAbove=function(t){return t.nodeUp.next.key},e.debugEvent=function(t){},e.addWinding=function(t,i){t.winding+=i.winding,t.Sym.winding+=i.Sym.winding},e.edgeLeq=function(t,i,n){var r=t.event,s=i.eUp,a=n.eUp;if(s.Dst===r)return a.Dst===r?hi.vertLeq(s.Org,a.Org)?hi.edgeSign(a.Dst,s.Org,a.Org)<=0:hi.edgeSign(s.Dst,a.Org,s.Org)>=0:hi.edgeSign(a.Dst,r,a.Org)<=0;if(a.Dst===r)return hi.edgeSign(s.Dst,r,s.Org)>=0;var o=hi.edgeEval(s.Dst,r,s.Org),l=hi.edgeEval(a.Dst,r,a.Org);return o>=l},e.deleteRegion=function(t,i){i.fixUpperEdge&&Mi(i.eUp.winding===0),i.eUp.activeRegion=null,t.dict.delete(i.nodeUp)},e.fixUpperEdge=function(t,i,n){Mi(i.fixUpperEdge),t.mesh.delete(i.eUp),i.fixUpperEdge=!1,i.eUp=n,n.activeRegion=i},e.topLeftRegion=function(t,i){var n=i.eUp.Org,r;do i=e.regionAbove(i);while(i.eUp.Org===n);if(i.fixUpperEdge){if(r=t.mesh.connect(e.regionBelow(i).eUp.Sym,i.eUp.Lnext),r===null)return null;e.fixUpperEdge(t,i,r),i=e.regionAbove(i)}return i},e.topRightRegion=function(t){var i=t.eUp.Dst;do t=e.regionAbove(t);while(t.eUp.Dst===i);return t},e.addRegionBelow=function(t,i,n){var r=new zI;return r.eUp=n,r.nodeUp=t.dict.insertBefore(i.nodeUp,r),r.fixUpperEdge=!1,r.sentinel=!1,r.dirty=!1,n.activeRegion=r,r},e.isWindingInside=function(t,i){switch(t.windingRule){case $n.ODD:return(i&1)!==0;case $n.NONZERO:return i!==0;case $n.POSITIVE:return i>0;case $n.NEGATIVE:return i<0;case $n.ABS_GEQ_TWO:return i>=2||i<=-2}throw new Error("Invalid winding rulle")},e.computeWinding=function(t,i){i.windingNumber=e.regionAbove(i).windingNumber+i.eUp.winding,i.inside=e.isWindingInside(t,i.windingNumber)},e.finishRegion=function(t,i){var n=i.eUp,r=n.Lface;r.inside=i.inside,r.anEdge=n,e.deleteRegion(t,i)},e.finishLeftRegions=function(t,i,n){for(var r,s=null,a=i,o=i.eUp;a!==n;){if(a.fixUpperEdge=!1,s=e.regionBelow(a),r=s.eUp,r.Org!=o.Org){if(!s.fixUpperEdge){e.finishRegion(t,a);break}r=t.mesh.connect(o.Lprev,r.Sym),e.fixUpperEdge(t,s,r)}o.Onext!==r&&(t.mesh.splice(r.Oprev,r),t.mesh.splice(o,r)),e.finishRegion(t,a),o=s.eUp,a=s}return o},e.addRightEdges=function(t,i,n,r,s,a){var o,l,c,u,h=!0;c=n;do Mi(hi.vertLeq(c.Org,c.Dst)),e.addRegionBelow(t,i,c.Sym),c=c.Onext;while(c!==r);for(s===null&&(s=e.regionBelow(i).eUp.Rprev),l=i,u=s;o=e.regionBelow(l),c=o.eUp.Sym,c.Org===u.Org;)c.Onext!==u&&(t.mesh.splice(c.Oprev,c),t.mesh.splice(u.Oprev,c)),o.windingNumber=l.windingNumber-c.winding,o.inside=e.isWindingInside(t,o.windingNumber),l.dirty=!0,!h&&e.checkForRightSplice(t,l)&&(e.addWinding(c,u),e.deleteRegion(t,l),t.mesh.delete(u)),h=!1,l=o,u=c;l.dirty=!0,Mi(l.windingNumber-c.winding===o.windingNumber),a&&e.walkDirtyRegions(t,l)},e.spliceMergeVertices=function(t,i,n){t.mesh.splice(i,n)},e.vertexWeights=function(t,i,n){var r=hi.vertL1dist(i,t),s=hi.vertL1dist(n,t),a=.5*s/(r+s),o=.5*r/(r+s);t.coords[0]+=a*i.coords[0]+o*n.coords[0],t.coords[1]+=a*i.coords[1]+o*n.coords[1],t.coords[2]+=a*i.coords[2]+o*n.coords[2]},e.getIntersectData=function(t,i,n,r,s,a){i.coords[0]=i.coords[1]=i.coords[2]=0,i.idx=-1,e.vertexWeights(i,n,r),e.vertexWeights(i,s,a)},e.checkForRightSplice=function(t,i){var n=e.regionBelow(i),r=i.eUp,s=n.eUp;if(hi.vertLeq(r.Org,s.Org)){if(hi.edgeSign(s.Dst,r.Org,s.Org)>0)return!1;hi.vertEq(r.Org,s.Org)?r.Org!==s.Org&&(t.pq.delete(r.Org.pqHandle),e.spliceMergeVertices(t,s.Oprev,r)):(t.mesh.splitEdge(s.Sym),t.mesh.splice(r,s.Oprev),i.dirty=n.dirty=!0)}else{if(hi.edgeSign(r.Dst,s.Org,r.Org)<0)return!1;e.regionAbove(i).dirty=i.dirty=!0,t.mesh.splitEdge(r.Sym),t.mesh.splice(s.Oprev,r)}return!0},e.checkForLeftSplice=function(t,i){var n=e.regionBelow(i),r=i.eUp,s=n.eUp,a;if(Mi(!hi.vertEq(r.Dst,s.Dst)),hi.vertLeq(r.Dst,s.Dst)){if(hi.edgeSign(r.Dst,s.Dst,r.Org)<0)return!1;e.regionAbove(i).dirty=i.dirty=!0,a=t.mesh.splitEdge(r),t.mesh.splice(s.Sym,a),a.Lface.inside=i.inside}else{if(hi.edgeSign(s.Dst,r.Dst,s.Org)>0)return!1;i.dirty=n.dirty=!0,a=t.mesh.splitEdge(s),t.mesh.splice(r.Lnext,s.Sym),a.Rface.inside=i.inside}return!0},e.checkForIntersect=function(t,i){var n=e.regionBelow(i),r=i.eUp,s=n.eUp,a=r.Org,o=s.Org,l=r.Dst,c=s.Dst,u,h,d=new t1,p,g;if(Mi(!hi.vertEq(c,l)),Mi(hi.edgeSign(l,t.event,a)<=0),Mi(hi.edgeSign(c,t.event,o)>=0),Mi(a!==t.event&&o!==t.event),Mi(!i.fixUpperEdge&&!n.fixUpperEdge),a===o||(u=Math.min(a.t,l.t),h=Math.max(o.t,c.t),u>h))return!1;if(hi.vertLeq(a,o)){if(hi.edgeSign(c,a,o)>0)return!1}else if(hi.edgeSign(l,o,a)<0)return!1;return e.debugEvent(t),hi.intersect(l,a,c,o,d),Mi(Math.min(a.t,l.t)<=d.t),Mi(d.t<=Math.max(o.t,c.t)),Mi(Math.min(c.s,l.s)<=d.s),Mi(d.s<=Math.max(o.s,a.s)),hi.vertLeq(d,t.event)&&(d.s=t.event.s,d.t=t.event.t),p=hi.vertLeq(a,o)?a:o,hi.vertLeq(p,d)&&(d.s=p.s,d.t=p.t),hi.vertEq(d,a)||hi.vertEq(d,o)?(e.checkForRightSplice(t,i),!1):!hi.vertEq(l,t.event)&&hi.edgeSign(l,t.event,d)>=0||!hi.vertEq(c,t.event)&&hi.edgeSign(c,t.event,d)<=0?c===t.event?(t.mesh.splitEdge(r.Sym),t.mesh.splice(s.Sym,r),i=e.topLeftRegion(t,i),r=e.regionBelow(i).eUp,e.finishLeftRegions(t,e.regionBelow(i),n),e.addRightEdges(t,i,r.Oprev,r,r,!0),!0):l===t.event?(t.mesh.splitEdge(s.Sym),t.mesh.splice(r.Lnext,s.Oprev),n=i,i=e.topRightRegion(i),g=e.regionBelow(i).eUp.Rprev,n.eUp=s.Oprev,s=e.finishLeftRegions(t,n,null),e.addRightEdges(t,i,s.Onext,r.Rprev,g,!0),!0):(hi.edgeSign(l,t.event,d)>=0&&(e.regionAbove(i).dirty=i.dirty=!0,t.mesh.splitEdge(r.Sym),r.Org.s=t.event.s,r.Org.t=t.event.t),hi.edgeSign(c,t.event,d)<=0&&(i.dirty=n.dirty=!0,t.mesh.splitEdge(s.Sym),s.Org.s=t.event.s,s.Org.t=t.event.t),!1):(t.mesh.splitEdge(r.Sym),t.mesh.splitEdge(s.Sym),t.mesh.splice(s.Oprev,r),r.Org.s=d.s,r.Org.t=d.t,r.Org.pqHandle=t.pq.insert(r.Org),e.getIntersectData(t,r.Org,a,l,o,c),e.regionAbove(i).dirty=i.dirty=n.dirty=!0,!1)},e.walkDirtyRegions=function(t,i){for(var n=e.regionBelow(i),r,s;;){for(;n.dirty;)i=n,n=e.regionBelow(n);if(!i.dirty&&(n=i,i=e.regionAbove(i),i===null||!i.dirty))return;if(i.dirty=!1,r=i.eUp,s=n.eUp,r.Dst!==s.Dst&&e.checkForLeftSplice(t,i)&&(n.fixUpperEdge?(e.deleteRegion(t,n),t.mesh.delete(s),n=e.regionBelow(i),s=n.eUp):i.fixUpperEdge&&(e.deleteRegion(t,i),t.mesh.delete(r),i=e.regionAbove(n),r=i.eUp)),r.Org!==s.Org)if(r.Dst!==s.Dst&&!i.fixUpperEdge&&!n.fixUpperEdge&&(r.Dst===t.event||s.Dst===t.event)){if(e.checkForIntersect(t,i))return}else e.checkForRightSplice(t,i);r.Org===s.Org&&r.Dst===s.Dst&&(e.addWinding(s,r),e.deleteRegion(t,i),t.mesh.delete(r),i=e.regionAbove(n))}},e.connectRightVertex=function(t,i,n){var r,s=n.Onext,a=e.regionBelow(i),o=i.eUp,l=a.eUp,c=!1;if(o.Dst!==l.Dst&&e.checkForIntersect(t,i),hi.vertEq(o.Org,t.event)&&(t.mesh.splice(s.Oprev,o),i=e.topLeftRegion(t,i),s=e.regionBelow(i).eUp,e.finishLeftRegions(t,e.regionBelow(i),a),c=!0),hi.vertEq(l.Org,t.event)&&(t.mesh.splice(n,l.Oprev),n=e.finishLeftRegions(t,a,null),c=!0),c){e.addRightEdges(t,i,n.Onext,s,s,!0);return}hi.vertLeq(l.Org,o.Org)?r=l.Oprev:r=o,r=t.mesh.connect(n.Lprev,r),e.addRightEdges(t,i,r,r.Onext,r.Onext,!1),r.Sym.activeRegion.fixUpperEdge=!0,e.walkDirtyRegions(t,i)},e.connectLeftDegenerate=function(t,i,n){var r,s,a,o,l;if(r=i.eUp,hi.vertEq(r.Org,n)){Mi(!1),e.spliceMergeVertices(t,r,n.anEdge);return}if(!hi.vertEq(r.Dst,n)){t.mesh.splitEdge(r.Sym),i.fixUpperEdge&&(t.mesh.delete(r.Onext),i.fixUpperEdge=!1),t.mesh.splice(n.anEdge,r),e.sweepEvent(t,n);return}Mi(!1),i=e.topRightRegion(i),l=e.regionBelow(i),a=l.eUp.Sym,s=o=a.Onext,l.fixUpperEdge&&(Mi(s!==a),e.deleteRegion(t,l),t.mesh.delete(a),a=s.Oprev),t.mesh.splice(n.anEdge,a),hi.edgeGoesLeft(s)||(s=null),e.addRightEdges(t,i,a.Onext,o,s,!0)},e.connectLeftVertex=function(t,i){var n,r,s,a,o,l,c=new zI;if(c.eUp=i.anEdge.Sym,n=t.dict.search(c).key,r=e.regionBelow(n),!!r){if(a=n.eUp,o=r.eUp,hi.edgeSign(a.Dst,i,a.Org)===0){e.connectLeftDegenerate(t,n,i);return}if(s=hi.vertLeq(o.Dst,a.Dst)?n:r,n.inside||s.fixUpperEdge){if(s===n)l=t.mesh.connect(i.anEdge.Sym,a.Lnext);else{var u=t.mesh.connect(o.Dnext,i.anEdge);l=u.Sym}s.fixUpperEdge?e.fixUpperEdge(t,s,l):e.computeWinding(t,e.addRegionBelow(t,n,l)),e.sweepEvent(t,i)}else e.addRightEdges(t,n,i.anEdge,i.anEdge,null,!0)}},e.sweepEvent=function(t,i){t.event=i,e.debugEvent(t);for(var n=i.anEdge;n.activeRegion===null;)if(n=n.Onext,n===i.anEdge){e.connectLeftVertex(t,i);return}var r=e.topLeftRegion(t,n.activeRegion);Mi(r!==null);var s=e.regionBelow(r),a=s.eUp,o=e.finishLeftRegions(t,s,null);o.Onext===a?e.connectRightVertex(t,r,o):e.addRightEdges(t,r,o.Onext,a,a,!0)},e.addSentinel=function(t,i,n,r){var s=new zI,a=t.mesh.makeEdge();a.Org.s=n,a.Org.t=r,a.Dst.s=i,a.Dst.t=r,t.event=a.Dst,s.eUp=a,s.windingNumber=0,s.inside=!1,s.fixUpperEdge=!1,s.sentinel=!0,s.dirty=!1,s.nodeUp=t.dict.insert(s)},e.initEdgeDict=function(t){t.dict=new $Le(t,e.edgeLeq);var i=t.bmax[0]-t.bmin[0],n=t.bmax[1]-t.bmin[1],r=t.bmin[0]-i,s=t.bmax[0]+i,a=t.bmin[1]-n,o=t.bmax[1]+n;e.addSentinel(t,r,s,a),e.addSentinel(t,r,s,o)},e.doneEdgeDict=function(t){for(var i,n=0;(i=t.dict.min().key)!==null;)i.sentinel||(Mi(i.fixUpperEdge),Mi(++n===1)),Mi(i.windingNumber===0),e.deleteRegion(t,i)},e.removeDegenerateEdges=function(t){var i,n,r,s=t.mesh.eHead;for(i=s.next;i!==s;i=n)n=i.next,r=i.Lnext,hi.vertEq(i.Org,i.Dst)&&i.Lnext.Lnext!==i&&(e.spliceMergeVertices(t,r,i),t.mesh.delete(i),i=r,r=i.Lnext),r.Lnext===i&&(r!==i&&((r===n||r===n.Sym)&&(n=n.next),t.mesh.delete(r)),(i===n||i===n.Sym)&&(n=n.next),t.mesh.delete(i))},e.initPriorityQ=function(t){var i,n,r,s=0;for(r=t.mesh.vHead,n=r.next;n!==r;n=n.next)s++;for(s+=8,i=t.pq=new ZLe(s,hi.vertLeq),r=t.mesh.vHead,n=r.next;n!==r;n=n.next)n.pqHandle=i.insert(n);return n!==r?!1:(i.init(),!0)},e.donePriorityQ=function(t){t.pq=null},e.removeDegenerateFaces=function(t,i){var n,r,s;for(n=i.fHead.next;n!==i.fHead;n=r)r=n.next,s=n.anEdge,Mi(s.Lnext!==s),s.Lnext.Lnext===s&&(e.addWinding(s.Onext,s),t.mesh.delete(s));return!0},e.computeInterior=function(t,i){i===void 0&&(i=!0);var n,r;if(e.removeDegenerateEdges(t),!e.initPriorityQ(t))return!1;for(e.initEdgeDict(t);(n=t.pq.extractMin())!==null;){for(;r=t.pq.min(),!(r===null||!hi.vertEq(r,n));)r=t.pq.extractMin(),e.spliceMergeVertices(t,n.anEdge,r.anEdge);e.sweepEvent(t,n)}return t.event=t.dict.min().key.eUp.Org,e.debugEvent(t),e.doneEdgeDict(t),e.donePriorityQ(t),e.removeDegenerateFaces(t,t.mesh)?(i&&t.mesh.check(),!0):!1},e}(),tUe=function(){function e(){this.mesh=new TW,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=$n.ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0}return e.prototype.dot_=function(t,i){return t[0]*i[0]+t[1]*i[1]+t[2]*i[2]},e.prototype.normalize_=function(t){var i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(!i)throw"Zero-size vector!";i=Math.sqrt(i),t[0]/=i,t[1]/=i,t[2]/=i},e.prototype.longAxis_=function(t){var i=0;return Math.abs(t[1])>Math.abs(t[0])&&(i=1),Math.abs(t[2])>Math.abs(t[i])&&(i=2),i},e.prototype.computeNormal_=function(t){var i,n,r,s,a,o,l=[0,0,0],c=[0,0,0],u=[0,0,0],h=[0,0,0],d=[0,0,0],p=[null,null,null],g=[null,null,null],x=this.mesh.vHead;i=x.next;for(var y=0;y<3;++y)s=i.coords[y],c[y]=s,g[y]=i,l[y]=s,p[y]=i;for(i=x.next;i!==x;i=i.next)for(var b=0;b<3;++b)s=i.coords[b],s<c[b]&&(c[b]=s,g[b]=i),s>l[b]&&(l[b]=s,p[b]=i);var A=0;if(l[1]-c[1]>l[0]-c[0]&&(A=1),l[2]-c[2]>l[A]-c[A]&&(A=2),c[A]>=l[A]){t[0]=0,t[1]=0,t[2]=1;return}for(o=0,n=g[A],r=p[A],u[0]=n.coords[0]-r.coords[0],u[1]=n.coords[1]-r.coords[1],u[2]=n.coords[2]-r.coords[2],i=x.next;i!==x;i=i.next)h[0]=i.coords[0]-r.coords[0],h[1]=i.coords[1]-r.coords[1],h[2]=i.coords[2]-r.coords[2],d[0]=u[1]*h[2]-u[2]*h[1],d[1]=u[2]*h[0]-u[0]*h[2],d[2]=u[0]*h[1]-u[1]*h[0],a=d[0]*d[0]+d[1]*d[1]+d[2]*d[2],a>o&&(o=a,t[0]=d[0],t[1]=d[1],t[2]=d[2]);o<=0&&(t[0]=t[1]=t[2]=0,t[this.longAxis_(u)]=1)},e.prototype.checkOrientation_=function(){for(var t=this.mesh.fHead,i,n=this.mesh.vHead,r,s=0,a=t.next;a!==t;a=a.next)if(r=a.anEdge,!(r.winding<=0))do s+=(r.Org.s-r.Dst.s)*(r.Org.t+r.Dst.t),r=r.Lnext;while(r!==a.anEdge);if(s<0){for(i=n.next;i!==n;i=i.next)i.t=-i.t;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},e.prototype.projectPolygon_=function(){var t=this.mesh.vHead,i=[0,0,0],n,r,s=!1;i[0]=this.normal[0],i[1]=this.normal[1],i[2]=this.normal[2],!i[0]&&!i[1]&&!i[2]&&(this.computeNormal_(i),s=!0),n=this.sUnit,r=this.tUnit;var a=this.longAxis_(i);n[a]=0,n[(a+1)%3]=1,n[(a+2)%3]=0,r[a]=0,r[(a+1)%3]=0,r[(a+2)%3]=i[a]>0?1:-1;for(var o=t.next;o!==t;o=o.next)o.s=this.dot_(o.coords,n),o.t=this.dot_(o.coords,r);s&&this.checkOrientation_();for(var l=!0,c=t.next;c!==t;c=c.next)l?(this.bmin[0]=this.bmax[0]=c.s,this.bmin[1]=this.bmax[1]=c.t,l=!1):(c.s<this.bmin[0]&&(this.bmin[0]=c.s),c.s>this.bmax[0]&&(this.bmax[0]=c.s),c.t<this.bmin[1]&&(this.bmin[1]=c.t),c.t>this.bmax[1]&&(this.bmax[1]=c.t))},e.prototype.addWinding_=function(t,i){t.winding+=i.winding,t.Sym.winding+=i.Sym.winding},e.prototype.tessellateMonoRegion_=function(t,i){var n,r;if(n=i.anEdge,!(n.Lnext!==n&&n.Lnext.Lnext!==n))throw"Mono region invalid";for(;hi.vertLeq(n.Dst,n.Org);n=n.Lprev);for(;hi.vertLeq(n.Org,n.Dst);n=n.Lnext);r=n.Lprev;for(var s=void 0;n.Lnext!==r;)if(hi.vertLeq(n.Dst,r.Org)){for(;r.Lnext!==n&&(hi.edgeGoesLeft(r.Lnext)||hi.edgeSign(r.Org,r.Dst,r.Lnext.Dst)<=0);)s=t.connect(r.Lnext,r),r=s.Sym;r=r.Lprev}else{for(;r.Lnext!==n&&(hi.edgeGoesRight(n.Lprev)||hi.edgeSign(n.Dst,n.Org,n.Lprev.Org)>=0);)s=t.connect(n,n.Lprev),n=s.Sym;n=n.Lnext}if(r.Lnext===n)throw"Mono region invalid";for(;r.Lnext.Lnext!==n;)s=t.connect(r.Lnext,r),r=s.Sym;return!0},e.prototype.tessellateInterior_=function(t){for(var i,n=t.fHead.next;n!==t.fHead;n=i)if(i=n.next,n.inside&&!this.tessellateMonoRegion_(t,n))return!1;return!0},e.prototype.discardExterior_=function(t){for(var i,n=t.fHead.next;n!==t.fHead;n=i)i=n.next,n.inside||t.zapFace(n)},e.prototype.setWindingNumber_=function(t,i,n){for(var r,s=t.eHead.next;s!==t.eHead;s=r)r=s.next,s.Rface.inside!==s.Lface.inside?s.winding=s.Lface.inside?i:-i:n?t.delete(s):s.winding=0},e.prototype.getNeighbourFace_=function(t){return!t.Rface||!t.Rface.inside?-1:t.Rface.n},e.prototype.outputPolymesh_=function(t,i,n,r){var s,a=0,o=0,l;n>3&&t.mergeConvexFaces(n);for(var c=t.vHead.next;c!==t.vHead;c=c.next)c.n=-1;for(var u=t.fHead.next;u!==t.fHead;u=u.next)if(u.n=-1,!!u.inside){s=u.anEdge,l=0;do{var c=s.Org;c.n===-1&&(c.n=o,o++),l++,s=s.Lnext}while(s!==u.anEdge);if(l>n)throw"Face vertex greater that support polygon";u.n=a,++a}this.elementCount=a,i===Ts.CONNECTED_POLYGONS&&(a*=2),this.elements=[],this.elements.length=a*n,this.vertexCount=o,this.vertices=[],this.vertices.length=o*r,this.vertexIndices=[],this.vertexIndices.length=o;for(var c=t.vHead.next;c!==t.vHead;c=c.next)if(c.n!==-1){var h=c.n*r;this.vertices[h+0]=c.coords[0],this.vertices[h+1]=c.coords[1],r>2&&(this.vertices[h+2]=c.coords[2]),this.vertexIndices[c.n]=c.idx}for(var d=0,u=t.fHead.next;u!==t.fHead;u=u.next)if(u.inside){s=u.anEdge,l=0;do{var c=s.Org;this.elements[d++]=c.n,l++,s=s.Lnext}while(s!==u.anEdge);for(var p=l;p<n;++p)this.elements[d++]=-1;if(i===Ts.CONNECTED_POLYGONS){s=u.anEdge;do this.elements[d++]=this.getNeighbourFace_(s),s=s.Lnext;while(s!==u.anEdge);for(var g=l;g<n;++g)this.elements[d++]=-1}}},e.prototype.outputContours_=function(t,i){var n,r,s=0,a=0;this.vertexCount=0,this.elementCount=0;for(var o=t.fHead.next;o!==t.fHead;o=o.next)if(o.inside){r=n=o.anEdge;do this.vertexCount++,n=n.Lnext;while(n!==r);this.elementCount++}this.elements=[],this.elements.length=this.elementCount*2,this.vertices=[],this.vertices.length=this.vertexCount*i,this.vertexIndices=[],this.vertexIndices.length=this.vertexCount;var l=0,c=0,u=0;s=0;for(var o=t.fHead.next;o!==t.fHead;o=o.next)if(o.inside){a=0,r=n=o.anEdge;do this.vertices[l++]=n.Org.coords[0],this.vertices[l++]=n.Org.coords[1],i>2&&(this.vertices[l++]=n.Org.coords[2]),this.vertexIndices[c++]=this.vertexIdCallback?this.vertexIdCallback(n):n.Org.idx,a++,n=n.Lnext;while(n!==r);this.elements[u++]=s,this.elements[u++]=a,s+=a}},e.prototype.addContour=function(t,i){this.mesh===null&&(this.mesh=new TW),t<2&&(t=2),t>3&&(t=3);for(var n=null,r=0;r<i.length;r+=t)n===null?(n=this.mesh.makeEdge(),this.mesh.splice(n,n.Sym)):(this.mesh.splitEdge(n),n=n.Lnext),n.Org.coords[0]=i[r+0],n.Org.coords[1]=i[r+1],t>2?n.Org.coords[2]=i[r+2]:n.Org.coords[2]=0,n.Org.idx=this.vertexIndexCounter++,this.edgeCreateCallback&&this.edgeCreateCallback(n),n.winding=1,n.Sym.winding=-1},e.prototype.tesselate=function(t,i,n,r,s,a){if(t===void 0&&(t=$n.ODD),i===void 0&&(i=Ts.POLYGONS),a===void 0&&(a=!0),this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,s&&(this.normal[0]=s[0],this.normal[1]=s[1],this.normal[2]=s[2]),this.windingRule=t,r<2&&(r=2),r>3&&(r=3),!this.mesh)return!1;this.projectPolygon_(),eUe.computeInterior(this,a);var o=this.mesh;return i===Ts.BOUNDARY_CONTOURS?this.setWindingNumber_(o,1,!0):this.tessellateInterior_(o),a&&o.check(),i===Ts.BOUNDARY_CONTOURS?this.outputContours_(o,r):this.outputPolymesh_(o,i,n,r),!0},e}();function Gm(e){var t=e.windingRule,i=t===void 0?$n.ODD:t,n=e.elementType,r=n===void 0?Ts.POLYGONS:n,s=e.polySize,a=s===void 0?3:s,o=e.vertexSize,l=o===void 0?2:o,c=e.normal,u=c===void 0?[0,0,1]:c,h=e.contours,d=h===void 0?[]:h,p=e.strict,g=p===void 0?!0:p,x=e.debug,y=x===void 0?!1:x;if(!d&&g)throw new Error("Contours can't be empty");if(d){var b=new tUe;e.edgeCreateCallback&&(b.edgeCreateCallback=e.edgeCreateCallback),e.vertexIdCallback&&(b.vertexIdCallback=e.vertexIdCallback);for(var A=0;A<d.length;A++)b.addContour(l||2,d[A]);return b.tesselate(i,r,a,l,u,g),{vertices:b.vertices,vertexIndices:b.vertexIndices,vertexCount:b.vertexCount,elements:b.elements,elementCount:b.elementCount,mesh:y?b.mesh:void 0}}}$n.ODD;$n.NONZERO;$n.POSITIVE;$n.NEGATIVE;$n.ABS_GEQ_TWO;Ts.POLYGONS;Ts.CONNECTED_POLYGONS;Ts.BOUNDARY_CONTOURS;var tz=class{constructor(e=256,t=!1){this.capacity=e,this.size=0,this.debug=t,this.debug&&console.log(`allocating with cap ${e}`);let i=e*tz.eSize;this.buffer=new ArrayBuffer(i);let n=Float32Array.BYTES_PER_ELEMENT,r=0;this.positions=new Float32Array(this.buffer,r*n,3*e),r+=3*e,this.normals=new Float32Array(this.buffer,r*n,3*e),r+=3*e,this.uvs=new Float32Array(this.buffer,r*n,2*e)}realloc(e,t=!1){if(e<this.size)throw Error("cannot shrink buffer");if(e<=this.capacity&&!t)return;this.debug&&console.log(`resizing from ${this.capacity}  ${e}`);let i=e*tz.eSize,n=new ArrayBuffer(i),r=Float32Array.BYTES_PER_ELEMENT,s=0,a=new Float32Array(n,s*r,3*e);s+=3*e;let o=new Float32Array(n,s*r,3*e);s+=3*e;let l=new Float32Array(n,s*r,2*e);t?(a.set(this.positions.subarray(0,this.size*3)),o.set(this.normals.subarray(0,this.size*3)),l.set(this.uvs.subarray(0,this.size*2))):(a.set(this.positions),o.set(this.normals),l.set(this.uvs)),this.buffer=n,this.positions=a,this.normals=o,this.uvs=l,this.capacity=e}get(e=1){let t=this.size+e;if(t>this.capacity){let n=this.capacity;for(;t>n;)n*=2;this.realloc(n)}let i=this.size;return this.size=t,i}reserve(e){let t=this.size+e;t>this.capacity&&this.realloc(t)}shrink(){this.debug&&console.log(`shrinking ${this.capacity}  ${this.size}`),this.realloc(this.size,!0)}},lee=tz;lee.eSize=8*Float32Array.BYTES_PER_ELEMENT;var iUe=class{constructor(e=[],t=(i,n)=>i<n?-1:i>n?1:0){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;let e=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){let{data:t,compare:i}=this,n=t[e];for(;e>0;){let r=e-1>>1,s=t[r];if(i(n,s)>=0)break;t[e]=s,e=r}t[e]=n}_down(e){let{data:t,compare:i}=this,n=this.length>>1,r=t[e];for(;e<n;){let s=(e<<1)+1,a=s+1;if(a<this.length&&i(t[a],t[s])<0&&(s=a),i(t[s],r)>=0)break;t[e]=t[s],e=s}t[e]=r}};function nUe(e,t,i=1,n=!1){let r=1/0,s=1/0,a=-1/0,o=-1/0;for(let[A,w]of e[0])A<r&&(r=A),w<s&&(s=w),A>a&&(a=A),w>o&&(o=w);let l=a-r,c=o-s,u=Math.max(i,Math.min(l,c));if(u===i){let A=[r,s];return A.distance=0,A.distance}let h=new iUe([],(A,w)=>w.max-A.max),d=sUe(e),p=new V3(r+l/2,s+c/2,0,e);p.d>d.d&&(d=p);let g=2;function x(A,w,E){let D=new V3(A,w,E,e);if(g++,D.max>d.d+i&&h.push(D),D.d>d.d&&(d=D,n&&console.log(`found best ${Math.round(1e4*D.d)/1e4} after ${g} probes`),d.d>t))return t}let y=u/2;for(let A=r;A<a;A+=u)for(let w=s;w<o;w+=u)x(A+y,w+y,y);for(;h.length;){let{max:A,x:w,y:E,h:D}=h.pop();if(A-d.d<=i)break;y=D/2,x(w-y,E-y,y),x(w+y,E-y,y),x(w-y,E+y,y),x(w+y,E+y,y)}n&&console.log(`num probes: ${g}
best distance: ${d.d}`);let b=[d.x,d.y];return b.distance=d.d,b.distance}function V3(e,t,i,n){this.x=e,this.y=t,this.h=i,this.d=rUe(e,t,n),this.max=this.d+this.h*Math.SQRT2}function rUe(e,t,i){let n=!1,r=1/0;for(let s of i)for(let a=0,o=s.length,l=o-1;a<o;l=a++){let c=s[a],u=s[l];c[1]>t!=u[1]>t&&e<(u[0]-c[0])*(t-c[1])/(u[1]-c[1])+c[0]&&(n=!n),r=Math.min(r,aUe(e,t,c,u))}return r===0?0:(n?1:-1)*Math.sqrt(r)}function sUe(e){let t=0,i=0,n=0,r=e[0];for(let a=0,o=r.length,l=o-1;a<o;l=a++){let c=r[a],u=r[l],h=c[0]*u[1]-u[0]*c[1];i+=(c[0]+u[0])*h,n+=(c[1]+u[1])*h,t+=h*3}let s=new V3(i/t,n/t,0,e);return t===0||s.d<0?new V3(r[0][0],r[0][1],0,e):s}function aUe(e,t,i,n){let r=i[0],s=i[1],a=n[0]-r,o=n[1]-s;if(a!==0||o!==0){let l=((e-r)*a+(t-s)*o)/(a*a+o*o);l>1?(r=n[0],s=n[1]):l>0&&(r+=a*l,s+=o*l)}return a=e-r,o=t-s,a*a+o*o}var w5={vertices:[160,160,-160,160,-160,-160,160,-160],vertexIndices:[1,0,3,2],vertexCount:4,elements:[0,4],elementCount:1,mesh:void 0},cee={vertices:[],vertexIndices:[],vertexCount:0,elements:[],elementCount:0,mesh:void 0},uee={vertices:[-160,160,160,-160,160,160,-160,-160],vertexIndices:[1,3,0,2],vertexCount:4,elements:[0,1,2,1,0,3],elementCount:2,mesh:void 0},FI=(e,t)=>([i,n])=>(n<i&&(n+=t),(e>=i?e:e+t)<=n),M5=class extends ii{constructor(e,t,i=0,n=12,r=3,s=$n.ODD,a=!1){super(),this.forPathBevel=a,this.type="ShapeGeometry",this.vertexCache={},this._shape=e,this._depth=t,this._curveSegments=n,this._bevelSegmentsInput=r;let o=this._shape.extractShapePointsToFlatArray([],n),l=this._shape.shapeHoles.map(O=>{let P=O.extractShapePointsToFlatArray([],n),U=[];for(let H=P.length-1;H>=1;H-=2){let V=P[H-1],j=P[H-0];U.push(V,j)}return U}),c=[],u=[];for(let O=0;O<o.length;O+=2)u.push([o[O],o[O+1]]);c.push(u);for(let O=0;O<l.length;O++){let P=l[O],U=[];for(let H=0;H<P.length;H+=2)U.push([P[H],P[H+1]]);c.push(U)}let h;e.isText?h=new j4().setFromPoints(e.points.map(O=>O.position)).getSize(new Ae).length()*.1:c[0].length===0?h=i:i>0?h=nUe(c,i):h=1e-5,i<=0?(this._bevel=0,this._bevelSegments=0):(this._bevel=Math.min(i,h,t/2),this._bevelSegments=Math.floor(r));let d;try{d=Gm({windingRule:s,elementType:Ts.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[o]})}catch{d=w5}let p;try{p=Gm({windingRule:$n.ODD,elementType:Ts.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...l]})}catch{p=cee}if(!d)throw new Error("error generating geometry");let g=d.elementCount;if(p){d.elementCount+=p.elementCount;for(let O=0;O<p.elements.length;O++){let P=p.elements[O],U=O%2===0?d.vertexCount:0;d.elements.push(P+U)}for(let O=0;O<p.vertexIndices.length;O++){let P=p.vertexIndices[O],U=d.vertexCount;d.vertexIndices.push(P+U)}for(let O=0;O<p.vertices.length;O++){let P=p.vertices[O];d.vertices.push(P)}}let x=1/0,y=-1/0,b=1/0,A=-1/0;for(let O=0,P=d.vertexCount;O<P;O++){let U=O*2,H=d.vertices[U+0],V=d.vertices[U+1];H<x&&(x=H),H>y&&(y=H),V<b&&(b=V),V>A&&(A=V)}this._minX=x,this._minY=b,this._width=y-x,this._height=A-b,this._buffer=new lee(this._computeBufferEstimatedSize(d));let w=[],E=[];for(let O=d.elementCount-1;O>=0;O--){let P=O>=g,U=O*2,H=d.elements[U+0],V=d.elements[U+1],j=H+V,J={start:H,count:V,normals:[],continuous:[],concave:[]},F=H,X=j-1,W=H+1,ne=this._shape.roundedCurves.length;do{let te=F-H,de=d.vertices[X*2+0],le=d.vertices[X*2+1],_e=d.vertices[F*2+0],be=d.vertices[F*2+1],we=d.vertices[W*2+0],Me=d.vertices[W*2+1],Ne=_e-de,Ge=be-le,We=Math.sqrt(Ne*Ne+Ge*Ge);Ne/=We,Ge/=We;let ae=_e-we,He=be-Me,Ke=Math.sqrt(ae*ae+He*He);ae/=Ke,He/=Ke,J.normals[te*2+0]=-He,J.normals[te*2+1]=ae,J.concave[te]=Ne*He-Ge*ae>0;let je=d.vertexIndices[F];if(Array.isArray(je))J.continuous[te]=!1;else{let[Oe,Qe]=this._shape.getCurveIndexFromVertexId(je-1,!0);if(Qe>0&&Qe<1)J.continuous[te]=!0;else{let $e=Qe===1?Oe+1:Oe-1;$e=($e+ne)%ne;let gt=Qe===1?0:1,pe=this._shape.roundedCurves[Oe].getTangent(Qe),k=this._shape.roundedCurves[$e].getTangent(gt);J.continuous[te]=pe.dot(k)>.95}}P&&(J.normals[te*2+0]*=-1,J.normals[te*2+1]*=-1),[X,F,W]=[F,W,W+1],W>=j&&(W-=V)}while(W!==H+1);let Y=[];Y.push({bevelI:0,angle:0,size:0,boundary:{vertices:d.vertices.slice(H*2,j*2),vertexCount:V,vertexIndices:new Array(V).fill(!0).map((te,de)=>[de,de]),elements:[0,V],elementCount:1,mesh:null},reverseMap:[],insetPoints:d.vertices.slice(H*2,j*2)});let $=0;for(let te=1;te<=this._bevelSegments;te++){let de=te/this._bevelSegments*Math.PI/2,le=(1-Math.cos(de))*this._bevel,_e=[],be=[],we=0;for(let Ne=0;Ne<V;Ne++){let Ge=Ne*2,We=(Ne-1+V)%V*2,ae=d.vertices[J.start*2+Ge+0],He=d.vertices[J.start*2+Ge+1],Ke=-J.normals[We+0]*le,je=-J.normals[We+1]*le,Oe=-J.normals[Ge+0]*le,Qe=-J.normals[Ge+1]*le;if(J.concave[Ne]||!J.concave[Ne]&&P){let $e=Math.atan2(je,Ke),gt=Math.atan2(Qe,Oe);gt>$e&&(gt-=Math.PI*2);let pe=gt-$e;if(J.continuous[Ne]||P){let k=$e+pe/2,Q=Math.cos(k)*le,xe=Math.sin(k)*le;_e[2*we+0]=ae+Q*(P?-1:1),_e[2*we+1]=He+xe*(P?-1:1),be[we]=Ne,we++}else{let k=Math.max(1,Math.floor(n/4*Math.abs(pe)/Math.PI));for(let Q=0;Q<=k;Q++){let xe=$e+pe*(Q/k),K=Math.cos(xe)*le,Re=Math.sin(xe)*le;_e[2*we+0]=ae+K,_e[2*we+1]=He+Re,be[we]=Ne,we++}}}else _e[2*we+0]=ae+Ke,_e[2*we+1]=He+je,be[we]=Ne,we++,_e[2*we+0]=ae,_e[2*we+1]=He,be[we]=Ne,we++,_e[2*we+0]=ae+Oe,_e[2*we+1]=He+Qe,be[we]=Ne,we++}let Me=Gm({windingRule:$n.POSITIVE,elementType:Ts.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[_e],edgeCreateCallback:Ne=>{let Ge=Ne.Org.idx,We=be[Ge],ae=be[(Ge+1)%be.length];Ne.idx=[We,ae],Ne.Sym.idx=[ae,We]},vertexIdCallback:Ne=>{let Ge=Ne.Lprev.idx;return[Ge?Ge[1]:0,Ne.idx?Ne.idx[0]:0]}});if(!Me)throw console.log("Error"),new Error(`error generating bevel geometry for ${te}'th loop`);if(!Me.vertexCount){let Ne=(te-1)/this._bevelSegments*Math.PI/2;$=(1-Math.sin(Ne))*this._bevel;break}for(let Ne=0;Ne<Me.vertexIndices.length;Ne++){let[Ge,We]=Me.vertexIndices[Ne];if(Ge===We)continue;let ae=We;We<Ge&&(ae+=V);for(let He=Ge;He<ae;He++){let Ke=He%V,je=(He+1)%V;if(!J.continuous[Ke]||!J.continuous[je]){Me.vertexIndices[Ne]=[Ge,Ke],Me.vertexIndices.splice(Ne+1,0,[je,We]),Me.vertices.splice((Ne+1)*2,0,Me.vertices[Ne*2],Me.vertices[Ne*2+1]);break}}}Y.push({bevelI:te,angle:de,size:le,boundary:Me,reverseMap:be,insetPoints:_e})}let se=(te,de,le)=>{let _e=0,be=te.boundary.vertexIndices.length;for(;_e<be&&le(te.boundary.vertexIndices[de]);)de=(de+1)%be,_e++;return _e},fe=w.length;for(let te=1;te<Y.length;te++){let de=Y[te-1],le=Y[te],_e=de.boundary.vertexIndices.length,be=le.boundary.vertexIndices.length;if(!_e||!be)break;let we=J.concave.length,Me=0,Ne=FI(Me,V);for(;!de.boundary.vertexIndices.filter(Ne).length||!le.boundary.vertexIndices.filter(Ne).length;)Me++,Ne=FI(Me,V);let Ge=de.boundary.vertexIndices.findIndex(Ne),We=le.boundary.vertexIndices.findIndex(Ne);do Ge=(Ge+1)%_e;while(Ne(de.boundary.vertexIndices[Ge]));do We=(We+1)%be;while(Ne(le.boundary.vertexIndices[We]));Me=(Me+1)%V;let ae=Me,He=0,Ke=this._buildBevelVert(J,de,(Ge-1+_e)%_e,void 0,He),je=this._buildBevelVert(J,le,(We-1+be)%be,void 0,He),Oe=Ke,Qe=je,$e,gt,pe=!1;do{He=(Me||we)/we,Ne=FI(Me,V);let k=se(de,Ge,Ne),Q=se(le,We,Ne),xe=pe;if(pe=!1,k&&!Q){for(let K=0;K<k;K++)$e=this._buildBevelVert(J,de,(Ge+K)%_e,K/(k-1),He),w.push(Oe.topN,$e.topP,Qe.topN),a===!1&&w.push($e.bottomP,Oe.bottomN,Qe.bottomN),Oe=$e;pe=!0}else if(!k&&Q)for(let K=0;K<Q;K++)gt=this._buildBevelVert(J,le,(We+K)%be,K/(Q-1),He),w.push(Qe.topN,Oe.topP,gt.topP),a===!1&&w.push(Oe.bottomP,Qe.bottomN,gt.bottomP),Qe=gt;else if(k&&Q)if($e=this._buildBevelVert(J,de,Ge,0,He),gt=this._buildBevelVert(J,le,We,0,He),xe?(w.push(Oe.topN,gt.topP,Qe.topN),w.push(Oe.topN,$e.topP,gt.topP),a===!1&&(w.push(gt.bottomP,Oe.bottomN,Qe.bottomN),w.push(gt.bottomP,$e.bottomP,Oe.bottomN))):(w.push(Qe.topN,Oe.topN,$e.topP),w.push(Qe.topN,$e.topP,gt.topP),a===!1&&(w.push($e.bottomP,Oe.bottomN,Qe.bottomN),w.push($e.bottomP,Qe.bottomN,gt.bottomP))),Oe=$e,Qe=gt,k===Q)for(let K=1;K<k;K++)$e=this._buildBevelVert(J,de,(Ge+K)%_e,K/(k-1),He),gt=this._buildBevelVert(J,le,(We+K)%be,K/(Q-1),He),w.push(Oe.topN,$e.topP,Qe.topN),w.push(Qe.topN,$e.topP,gt.topP),a===!1&&(w.push($e.bottomP,Oe.bottomN,Qe.bottomN),w.push($e.bottomP,Qe.bottomN,gt.bottomP)),Oe=$e,Qe=gt;else if(k>Q){let K=k/Q,Re=0;for(let Le=1;Le<k;Le++)$e=this._buildBevelVert(J,de,(Ge+Le)%_e,Le/(k-1),He),w.push(Oe.topN,$e.topP,Qe.topN),a===!1&&w.push($e.bottomP,Oe.bottomN,Qe.bottomN),Oe=$e,Le>(Re+1)*K&&(Re++,gt=this._buildBevelVert(J,le,(We+Re)%be,Re/(Q-1),He),w.push(Qe.topN,$e.topP,gt.topP),a===!1&&w.push($e.bottomP,Qe.bottomN,gt.bottomP),Qe=gt)}else{let K=Q/k,Re=0;for(let Le=1;Le<Q;Le++)gt=this._buildBevelVert(J,le,(We+Le)%be,Le/(Q-1),He),w.push(Qe.topN,$e.topP,gt.topP),a===!1&&w.push($e.bottomP,Qe.bottomN,gt.bottomP),Qe=gt,Le>(Re+1)*K&&(Re++,$e=this._buildBevelVert(J,de,(Ge+Re)%_e,Re/(k-1),He),w.push(Oe.topN,$e.topP,Qe.topN),a===!1&&w.push($e.bottomP,Oe.bottomN,Qe.bottomN),Oe=$e)}Ge=(Ge+k)%_e,We=(We+Q)%be,Me=(Me+1)%we}while(Me!==ae)}if(a===!1&&this._depth>this._bevel*2&&this._buildWall(Y,J,w),P){let te=[];for(let de=w.length-1;de>=fe+2;de-=3){let le=w[de-2],_e=w[de-1],be=w[de-0];te.push(be,_e,le)}w.splice(fe,w.length-fe,...te)}if(P){let te=[];for(let de=Y[Y.length-1].boundary.vertices.length-1;de>=1;de-=2){let le=Y[Y.length-1].boundary.vertices[de-1],_e=Y[Y.length-1].boundary.vertices[de-0];te.push(le,_e)}E.push(te)}if(!P){let te=Y[Y.length-1],de;try{de=Gm({windingRule:Y.length>1?$n.POSITIVE:$n.ODD,elementType:Ts.POLYGONS,vertexSize:2,strict:!0,contours:[te.insetPoints,...E]})}catch{de=uee}if(!de)throw new Error("Error generating geometry for surface");l.length===0&&this._bevel<h&&Object.assign(this,{useNgonForTopBottomFaceDuringBake:!0});for(let le=0;le<de.elementCount*3;le+=3){let _e=this._buildSurfaceVert(de,de.elements[le+0],$),be=this._buildSurfaceVert(de,de.elements[le+1],$),we=this._buildSurfaceVert(de,de.elements[le+2],$);w.push(_e.top,be.top,we.top),a===!1&&w.push(we.bottom,be.bottom,_e.bottom)}}this.vertexCache={}}this._buffer.shrink();let D=new vi(Uint32Array.from(w),1),T=new vi(this._buffer.positions,3),I=new vi(this._buffer.normals,3),R=new vi(this._buffer.uvs,2);T.needsUpdate=!0,I.needsUpdate=!0,R.needsUpdate=!0,D.needsUpdate=!0,this.setAttribute("position",T),this.setAttribute("normal",I),this.setAttribute("uv",R),this.setIndex(D)}_computeBufferEstimatedSize(e){return e.vertexCount*2*(2+this._bevelSegments)}_buildWall(e,t,i){let n=e[0];for(let r=0,s=n.boundary.vertexCount;r<s;r++){let a=this._buildBevelVert(t,n,r),o=this._buildBevelVert(t,n,(r+1)%s);i.push(o.topP,a.topN,a.bottomN),i.push(o.topP,a.bottomN,o.bottomP)}}_buildSurfaceVert(e,t,i){let n=t.toString();if(n in this.vertexCache)return this.vertexCache[n];let r=e.vertices[t*2+0],s=e.vertices[t*2+1],a=(r-this._minX)/this._width,o=(s-this._minY)/this._height;this.forPathBevel&&(o=1);let l=this._buffer.get(this.forPathBevel?1:2),c=l*3,u=l*2,h={top:l+0,bottom:l+1};return this._buffer.positions[c+0]=r,this._buffer.positions[c+1]=s,this._buffer.positions[c+2]=this.forPathBevel?this._bevel:this._depth-i,this._buffer.normals[c+0]=0,this._buffer.normals[c+1]=0,this._buffer.normals[c+2]=1,this._buffer.uvs[u+0]=a,this._buffer.uvs[u+1]=o,this.forPathBevel===!1&&(this._buffer.positions[c+3]=r,this._buffer.positions[c+4]=s,this._buffer.positions[c+5]=i,this._buffer.normals[c+3]=0,this._buffer.normals[c+4]=0,this._buffer.normals[c+5]=-1,this._buffer.uvs[u+2]=a,this._buffer.uvs[u+3]=o),this.vertexCache[n]=h,h}_buildBevelVert(e,t,i,n=1,r){let s=`${t.bevelI}:${i}`;if(s in this.vertexCache&&r!==0&&r!==1&&(!r||r===this.vertexCache[s].pathBevelUCoord))return this.vertexCache[s];let[a,o]=t.boundary.vertexIndices[i],l,c,u,h;a!==o?(c=a,l=o,h=!1,u=e.continuous[c]&&e.continuous[l]):(l=a,c=(l-1+e.count)%e.count,h=e.concave[l]&&t.bevelI>0,u=e.continuous[l]||h);let d=Math.cos(t.angle),p=Math.sin(t.angle),g=i*2,x=l*2,y=c*2,b=t.boundary.vertices[g+0],A=t.boundary.vertices[g+1],w=(1-p)*this._bevel,E=(b-this._minX)/this._width,D=(A-this._minY)/this._height;this.forPathBevel&&(r!==void 0&&(E=r),D=1);let T=e.normals[x+0],I=e.normals[x+1],R=e.normals[y+0],O=e.normals[y+1];if(h){let j=R-T,J=O-I;T=T+j*(1-n),I=I+J*(1-n);let F=Math.sqrt(T*T+I*I);T/=F,I/=F}let P=this.forPathBevel?this._buffer.get(u?1:2):this._buffer.get(u?2:4),U=P*3,H=P*2,V={i,fi:l,topP:P+0,topN:P+0,bottomP:P+1,bottomN:P+1,pathBevelUCoord:r};return this._buffer.positions[U+0]=b,this._buffer.positions[U+1]=A,this._buffer.positions[U+2]=(this.forPathBevel?this._bevel:this._depth)-w,this._buffer.normals[U+0]=T*d,this._buffer.normals[U+1]=I*d,this._buffer.normals[U+2]=p,this._buffer.uvs[H+0]=E,this._buffer.uvs[H+1]=D,this.forPathBevel===!1&&(this._buffer.positions[U+3]=b,this._buffer.positions[U+4]=A,this._buffer.positions[U+5]=w,this._buffer.normals[U+3]=T*d,this._buffer.normals[U+4]=I*d,this._buffer.normals[U+5]=-p,this._buffer.uvs[H+2]=D,this._buffer.uvs[H+3]=E),u||(this.forPathBevel?(P+=1,U+=3,H+=2):(P+=2,U+=6,H+=4),V.topP=P+0,V.bottomP=P+1,this._buffer.positions[U+0]=b,this._buffer.positions[U+1]=A,this._buffer.positions[U+2]=(this.forPathBevel?this._bevel:this._depth)-w,this._buffer.normals[U+0]=R*d,this._buffer.normals[U+1]=O*d,this._buffer.normals[U+2]=p,this._buffer.uvs[H+0]=E,this._buffer.uvs[H+1]=D,this.forPathBevel===!1&&(this._buffer.positions[U+3]=b,this._buffer.positions[U+4]=A,this._buffer.positions[U+5]=w,this._buffer.normals[U+3]=R*d,this._buffer.normals[U+4]=O*d,this._buffer.normals[U+5]=-p,this._buffer.uvs[H+2]=D,this._buffer.uvs[H+3]=E)),this.vertexCache[s]=V,V}clone(){let e=new M5(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=$R(this.userData),e}},hee=class extends ii{constructor(e,t=12,i={}){super(),this.type="ShapeGeometry",this.windingRule=$n.ODD,this.elementType=Ts.POLYGONS,this.polySize=3,this.vertexSize=2,this.strict=!0,this._shape=e,this._curveSegments=t,this._triangulationOptions=Object.assign({windingRule:$n.ODD,elementType:Ts.POLYGONS,polySize:3,vertexSize:2,strict:!0},i);let n=this._shape.extractShapePointsToFlatArray([],this._curveSegments),r=this._shape.shapeHoles.map(d=>d.extractShapePointsToFlatArray([],this._curveSegments)),s,a=!0,o=!0,l,c;for(let d=0,p=n.length/2;d<p;d++){let g=d*2,x=n[g+0],y=n[g+1];if(l!==void 0&&x!==l&&(a=!1),c!==void 0&&y!==c&&(o=!1),l=x,c=y,!a&&!o)break}if(!a&&!o)try{s=Gm({contours:[n,...r],windingRule:this._triangulationOptions.windingRule,elementType:this._triangulationOptions.elementType,polySize:this._triangulationOptions.polySize,vertexSize:this._triangulationOptions.vertexSize,strict:this._triangulationOptions.strict})}catch{s=w5}let u=(s==null?void 0:s.vertexCount)??1,h=(s==null?void 0:s.elementCount)??1;if(this._positionAttribute=new vi(new Float32Array(u*3),3),this._normalAttribute=new vi(new Float32Array(u*3),3),this._uvAttribute=new vi(new Float32Array(u*2),2),this._indexAttribute=new vi(new Uint32Array(h*3),1),s){let d=1/0,p=-1/0,g=1/0,x=-1/0;for(let A=0,w=u;A<w;A++){let E=A*2,D=s.vertices[E+0],T=s.vertices[E+1];D<d&&(d=D),D>p&&(p=D),T<g&&(g=T),T>x&&(x=T)}let y=p-d,b=x-g;for(let A=0,w=u;A<w;A++){let E=A*2,D=s.vertices[E+0],T=s.vertices[E+1],I=(D-d)/y,R=(T-g)/b;this._positionAttribute.setXYZ(A,D,T,0),this._normalAttribute.setXYZ(A,0,0,1),this._uvAttribute.setXY(A,I,R)}for(let A=0,w=h;A<w;A++){let E=A*3,D=s.elements[E+0],T=s.elements[E+1],I=s.elements[E+2];this._indexAttribute.setX(E+0,D),this._indexAttribute.setX(E+1,T),this._indexAttribute.setX(E+2,I)}}this.setAttribute("position",this._positionAttribute),this.setAttribute("normal",this._normalAttribute),this.setAttribute("uv",this._uvAttribute),this.setIndex(this._indexAttribute),this.setDrawRange(0,((s==null?void 0:s.elementCount)??1)*3)}clone(){let e=new hee(this._shape,this._curveSegments);return e.userData=$R(this.userData),e}},dee=class extends M5{constructor(e,t,i=0,n=12,r=3,s=$n.ODD){super(e,t,i,n,r,s),this.type="ShapeGeometry"}_computeBufferEstimatedSize(e){return e.vertexCount*2*(2+this._bevelSegments)}_buildWall(e,t,i){let n=e[0];for(let r=0,s=n.boundary.vertexCount;r<s;r++){let a=this._buildBevelVert(t,n,r),o=this._buildBevelVert(t,n,(r+1)%s);i.push(o.topP,a.topN,a.bottomN),i.push(o.topP,a.bottomN,o.bottomP)}}clone(){let e=new dee(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=$R(this.userData),e}},J0=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var c,u;let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,subdivisions:40,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3,windingRule:$n.ODD},e.parameters),n=Math.abs(i.width),r=Math.abs(i.height??i.width),s=Math.abs(i.depth??0),a=e.shape??(t==null?void 0:t.shape),o=(a==null?void 0:a.roundness)??i.roundness;a!==void 0&&(a instanceof $r?(a.width!==n||a.height!==r)&&a.applySize(n,r):a=new $r(n,r).fromJSON(a),((c=e.parameters)==null?void 0:c.roundness)!==void 0&&((u=e.parameters)==null?void 0:u.roundness)>0&&a.update());let l=a??new $r(n,r);return{parameters:Object.assign(i,{width:n,height:r,depth:s,roundness:o}),shape:l}}static build(e){let{depth:t,extrudeBevelSize:i,extrudeBevelSegments:n,subdivisions:r,roundness:s,windingRule:a}=e.parameters;e.shape.roundness=s;let o;return t<=0?o=new hee(e.shape,r,{windingRule:a}):o=new dee(e.shape,t,i,r,n,a),Object.assign(o,{userData:{...e,type:"VectorGeometry"}})}},fee=Math.PI*2,E5=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,spikes:64,angle:360,innerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return i.angle=qt.clamp(i.angle,0,360),{shape:e.shape&&e.shape instanceof $r?e.shape:new $r,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i,spikes:n,angle:r,innerRadius:s,depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}=e.parameters,c=e.shape,u=t*.5,h=i*.5,d=oUe(c,u,h,r*Math.PI/180,n,s);c.isClosed=!0,c.update();let p;return r===0?(p=new ii,p.setAttribute("position",new Gt([],3))):p=J0.create({shape:c,parameters:{subdivisions:d,depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}}),Object.assign(p,{userData:{...e,type:"EllipseGeometry"}})}};function oUe(e,t,i,n,r,s){if(n>=fee)return r>30||r%4===0?(cUe(e,t,i,s),Math.round(r/4)):PW(e,n,r,t,i,s);n=Math.max(n,.001);let a={x:0,y:i},o=n+Math.PI*.5,l={x:Math.cos(o)*t,y:Math.sin(o)*i},c=JLe({px:a.x,py:a.y,cx:l.x,cy:l.y,rx:t,ry:i,largeArcFlag:n>Math.PI,sweepFlag:!0});return r>30||r%c.length===0?lUe(e,a.x,a.y,c,r,t,i,s):PW(e,n,r,t,i,s)}function lUe(e,t,i,n,r,s,a,o){let l=Math.round(r/n.length);e.addPoint(P1(t,i));for(let c=0,u=n.length;c<u;c++){let h=n[c],d=e.points[c],p=P1(h.x,h.y);d.controls[1].position.set(h.x1,h.y1),p.controls[0].position.set(h.x2,h.y2),e.addPoint(p)}return o>0?pee(e,s,a,o):e.addPoint(P1(0,0)),l}function PW(e,t,i,n,r,s){let a=-t/i;for(let o=0;o<=i;o++){let l=a*o,c=Math.sin(l)*n,u=Math.cos(l)*r;e.addPoint(P1(c,u))}return t<fee?s>0?pee(e,n,r,s):e.addPoint(P1(0,0)):(e.removePoint(e.points[e.points.length-1]),s>0&&mee(e,n,r,s)),1}function cUe(e,t,i,n=0,r=0,s=0){let a=.5522847498,o=t*a,l=i*a;e.addPoint(kT(r-t,s,r-t,s-l,r-t,s+l)),e.addPoint(kT(r,s+i,r-o,s+i,r+o,s+i)),e.addPoint(kT(r+t,s,r+t,s+l,r+t,s-l)),e.addPoint(kT(r,s-i,r+o,s-i,r-o,s-i)),n>0&&mee(e,t,i,n)}function P1(e,t){return new R1(qt.generateUUID(),new Ae(e,t))}function kT(e,t,i,n,r,s){let a=P1(e,t);return a.controls[0].position.set(i,n),a.controls[1].position.set(r,s),a}function pee(e,t,i,n){gee(e,t,i,n).forEach(r=>e.addPoint(r))}function mee(e,t,i,n){let r=gee(e,t,i,n),s=new $r;r.forEach(a=>s.addPoint(a)),s.isClosed=!0,e.shapeHoles.push(s)}function gee(e,t,i,n){let r=n*t/100,s=r*(Math.abs(i)/Math.abs(t)),a=new Ae(r/t,s/i),o=e.points.map(l=>{let c=l.clone();return c.uuid=qt.generateUUID(),c}).reverse();return o.forEach(l=>{l.position.multiply(a);let c=l.controls[0].position.clone().multiply(a),u=l.controls[1].position.clone().multiply(a);l.controls[0].position.copy(u),l.controls[1].position.copy(c)}),o}var uUe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,revolutions:2,segments:40,pathRadius:10,pathType:0,pathSegments:30,cornerRadius:30,cornerSegments:4},e.parameters),n=Math.abs(i.width),r=Math.abs(i.height??n),s=Math.abs(i.depth??n),a=Math.abs(Math.min(n,s))/2;return{parameters:Object.assign(i,{width:n,height:r,depth:s,radius:a,segments:Math.round(i.segments),pathSegments:Math.round(i.pathSegments),cornerSegments:Math.round(i.cornerSegments)})}}static build(e){let{width:t,height:i,depth:n,radius:r,revolutions:s,segments:a,pathRadius:o,pathType:l,pathSegments:c,cornerRadius:u,cornerSegments:h}=e.parameters,d=new vee(!1,t,i,n,r,s,a,o,l,c,u,h);return Object.assign(d,{userData:{...e,type:"HelixGeometry"}})}},VI=new M1([0,0,0],1),vee=class extends ii{constructor(e=!0,t=1,i=1,n=1,r=1,s=1,a=1,o=1,l=1,c=1,u=1,h=1){if(super(),s===0)return;let d=e&&s===1;d&&(h=0),u>100&&(u=100),u===0&&(h=0);let p=()=>new G,g=new G,x=p(),y=p(),b=p(),A,w,E,D,T,I,R,O,P=p(),U=p(),H=p(),V=p(),j=p(),J=p(),F=p(),X=p(),W=i-2*o+.001,ne=W/s,Y=Math.ceil(a*s),$=Y+1,se=W/Y,fe=-W/2,te=c+1,de=2*Math.PI/c,le=Math.PI/2/h,_e=.01,be=Math.min((1-u/100)*o,o-_e),we=o-be,Me=0,Ne=2,Ge=h*Ne+Ne,We=te*Ge/Ne,ae=We+te*$,He=Math.max(0,te*($+Ge)),[Ke,je,Oe]=[3,3,2].map(Be=>Array(He*Be).fill(0)),Qe=[],$e=r-o;function gt(Be,bt){let vt=Math.PI/2;I=bt*se,O=2*Math.PI*(I%ne)/ne+vt,I+=fe,R=Math.sin(O)*$e,T=Math.cos(O)*$e,e?Be.set(T,R,I):Be.set(T,I,R)}gt(g,-1e-10),gt(x,0),P.copy(g),gt(g,1);let pe=g.distanceTo(x),k=d?0:we+be,Q=pe*Y+2*k,xe=be,K=Q-k;for(let Be=0;Be<=Y;Be++){gt(y,Be),X.subVectors(y,P).normalize(),P.copy(y),J.copy(y).setComponent(+e+1,0).normalize(),F.crossVectors(X,J).normalize();let bt=Be===0,vt=Be===Y,Xe=bt?3*Math.PI/2:le,xt=bt?xe:K,_t=bt?te:ae,ye=bt?0:He-te,Ve=X.clone().multiplyScalar(bt?-we:we).add(y),At=X.clone().multiplyScalar(bt?-1:1).normalize();for(let ie=0;ie<te;ie++){let Ce=ie*de;if(U.addVectors(g.copy(J).multiplyScalar(o*Math.cos(Ce)),x.copy(F).multiplyScalar(o*Math.sin(Ce))),H.copy(U).normalize(),bt||vt){d||(Me=ye+ie,[0,1,2].forEach(De=>{Ke[Me*3+De]=Ve.getComponent(De),je[Me*3+De]=At.getComponent(De)}),Oe[Me*2]=+vt,Oe[Me*2+1]=ie/c),x.copy(H).multiplyScalar(be),b.addVectors(y,x);for(let De=0;De<h;De++){let at=De*le+Xe;V.addVectors(g.copy(X).multiplyScalar(we*Math.sin(at)),x.copy(H).multiplyScalar(we*Math.cos(at))),j.copy(V).normalize(),x.addVectors(b,V),V.normalize(),Me=_t+De*te+ie,[0,1,2].forEach(lt=>{Ke[Me*3+lt]=x.getComponent(lt),je[Me*3+lt]=j.getComponent(lt)});let ut=+bt+Math.sin(at);Oe[Me*2]=(xt+we*ut)/Q,Oe[Me*2+1]=ie/c}}x.addVectors(y,U),Me=We+Be*te+ie,[0,1,2].forEach(De=>{Ke[Me*3+De]=x.getComponent(De),je[Me*3+De]=H.getComponent(De)}),Oe[Me*2]=(k+Be*pe)/Q,Oe[Me*2+1]=ie/c}}let Re=$+2*h+Ne,[Le,st]=[+d,Re-1];for(let Be=Le;Be<=st-1;Be++){let bt=d&&Be===st-1;for(let vt=0;vt<te-1;vt++)A=Be*te+vt,w=A+1,E=(bt?vt:A)+te,D=(bt?vt+1:w)+te,Be===0?Qe.push(w,D,E):Be===Re-2?Qe.push(A,w,E):Qe.push(A,w,E,w,D,E)}this.setIndex(Qe),this.setAttribute("position",new Gt(Ke,3)),this.setAttribute("normal",new Gt(je,3)),this.setAttribute("uv",new Gt(Oe,2))}getClosedTorusIndicesForBooleanOrSubdiv(){let e=this.userData.parameters,t=Math.ceil(e.tubularSegments),i=e.radialSegments+1,n=Array.from(this.getIndex().array),r,s,a,o,l=6*(t-1)*e.radialSegments,c=t,u=c===t;for(let h=0;h<e.radialSegments;h++)r=c*i+h,s=r+1,a=(u?h:r)+i,o=(u?h+1:s)+i,n[l++]=r,n[l++]=s,n[l++]=a,n[l++]=s,n[l++]=o,n[l++]=a;return n.length=l,VI.array=n,VI.count=n.length,VI}},hUe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:n,detail:r,corner:s,cornerSides:a}=e.parameters,o=r===0&&s!==0?new yee(t*.5,s,a):new mZ(t*.5,r);return o.scale(1,i/t,n/t),Object.assign(o,{userData:{...e,type:"IcosahedronGeometry"}})}},yee=class extends S5{constructor(e=1,t=.2,i=4){let n=(1+Math.sqrt(5))/2,r=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],a="IcosahedronGeometry";super(r,s,a,e,t,i),this.type=a}static fromJSON(e){return new yee(e.radius,e.corner,e.cornerSides)}},dUe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var n;(((n=e.parameters)==null?void 0:n.points)??[]).forEach(r=>{Array.isArray(r)&&(r.x=r[0],r.y=r[1])});let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,segments:64,verticalSegments:64,points:[{x:0,y:-50,id:0},{x:50,y:-50,id:1},{x:50,y:50,id:2},{x:0,y:50,id:3}]},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{points:t,segments:i,verticalSegments:n}=e.parameters,r=new n3;r.moveTo(t[0].x,t[0].y),r.bezierCurveTo(t[1].x,t[1].y,t[2].x,t[2].y,t[3].x,t[3].y);let s=new cZ(r.extractPoints(n).shape,i);return s.rotateZ(Math.PI),Object.assign(s,{userData:{...e,type:"LatheGeometry"}})}},Xh=new Bt,HI=new kn,jT=new G,H3=class extends Ka{constructor(){super(),this.uuid=qt.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}applyMatrix4(e){let t=new Cs().getNormalMatrix(e);for(let i=0,n=this.vertices.length;i<n;i++)this.vertices[i].applyMatrix4(e);for(let i=0,n=this.faces.length;i<n;i++){let r=this.faces[i];r.normal.applyMatrix3(t).normalize();for(let s=0,a=r.vertexNormals.length;s<a;s++)r.vertexNormals[s].applyMatrix3(t).normalize()}return this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this}rotateX(e){return Xh.makeRotationX(e),this.applyMatrix4(Xh),this}rotateY(e){return Xh.makeRotationY(e),this.applyMatrix4(Xh),this}rotateZ(e){return Xh.makeRotationZ(e),this.applyMatrix4(Xh),this}translate(e,t,i){return Xh.makeTranslation(e,t,i),this.applyMatrix4(Xh),this}scale(e,t,i){return Xh.makeScale(e,t,i),this.applyMatrix4(Xh),this}lookAt(e){return HI.lookAt(e),HI.updateMatrix(),this.applyMatrix4(HI.matrix),this}fromBufferGeometry(e){let t=this,i=e.index!==null?e.index:void 0,n=e.attributes;if(n.position===void 0)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;let r=n.position,s=n.normal,a=n.color,o=n.uv,l=n.uv2;l!==void 0&&(this.faceVertexUvs[1]=[]);for(let h=0;h<r.count;h++)t.vertices.push(new G().fromBufferAttribute(r,h)),a!==void 0&&t.colors.push(new gi().fromBufferAttribute(a,h));function c(h,d,p,g){let x=a===void 0?[]:[t.colors[h].clone(),t.colors[d].clone(),t.colors[p].clone()],y=s===void 0?[]:[new G().fromBufferAttribute(s,h),new G().fromBufferAttribute(s,d),new G().fromBufferAttribute(s,p)],b=new iz(h,d,p,y,x,g);t.faces.push(b),o!==void 0&&t.faceVertexUvs[0].push([new Ae().fromBufferAttribute(o,h),new Ae().fromBufferAttribute(o,d),new Ae().fromBufferAttribute(o,p)]),l!==void 0&&t.faceVertexUvs[1].push([new Ae().fromBufferAttribute(l,h),new Ae().fromBufferAttribute(l,d),new Ae().fromBufferAttribute(l,p)])}let u=e.groups;if(u.length>0)for(let h=0;h<u.length;h++){let d=u[h],p=d.start,g=d.count;for(let x=p,y=p+g;x<y;x+=3)i!==void 0?c(i.getX(x),i.getX(x+1),i.getX(x+2),d.materialIndex):c(x,x+1,x+2,d.materialIndex)}else if(i!==void 0)for(let h=0;h<i.count;h+=3)c(i.getX(h),i.getX(h+1),i.getX(h+2));else for(let h=0;h<r.count;h+=3)c(h,h+1,h+2);return this.computeFaceNormals(),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(jT).negate(),this.translate(jT.x,jT.y,jT.z),this}normalize(){this.computeBoundingSphere();let e=this.boundingSphere.center,t=this.boundingSphere.radius,i=t===0?1:1/t,n=new Bt;return n.set(i,0,0,-i*e.x,0,i,0,-i*e.y,0,0,i,-i*e.z,0,0,0,1),this.applyMatrix4(n),this}computeFaceNormals(){let e=new G,t=new G;for(let i=0,n=this.faces.length;i<n;i++){let r=this.faces[i],s=this.vertices[r.a],a=this.vertices[r.b],o=this.vertices[r.c];e.subVectors(o,a),t.subVectors(s,a),e.cross(t),e.normalize(),r.normal.copy(e)}}computeVertexNormals(e=!0){let t=new Array(this.vertices.length);for(let i=0,n=this.vertices.length;i<n;i++)t[i]=new G;if(e){let i=new G,n=new G;for(let r=0,s=this.faces.length;r<s;r++){let a=this.faces[r],o=this.vertices[a.a],l=this.vertices[a.b],c=this.vertices[a.c];i.subVectors(c,l),n.subVectors(o,l),i.cross(n),t[a.a].add(i),t[a.b].add(i),t[a.c].add(i)}}else{this.computeFaceNormals();for(let i=0,n=this.faces.length;i<n;i++){let r=this.faces[i];t[r.a].add(r.normal),t[r.b].add(r.normal),t[r.c].add(r.normal)}}for(let i=0,n=this.vertices.length;i<n;i++)t[i].normalize();for(let i=0,n=this.faces.length;i<n;i++){let r=this.faces[i],s=r.vertexNormals;s.length===3?(s[0].copy(t[r.a]),s[1].copy(t[r.b]),s[2].copy(t[r.c])):(s[0]=t[r.a].clone(),s[1]=t[r.b].clone(),s[2]=t[r.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeFlatVertexNormals(){this.computeFaceNormals();for(let e=0,t=this.faces.length;e<t;e++){let i=this.faces[e],n=i.vertexNormals;n.length===3?(n[0].copy(i.normal),n[1].copy(i.normal),n[2].copy(i.normal)):(n[0]=i.normal.clone(),n[1]=i.normal.clone(),n[2]=i.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeMorphNormals(){for(let t=0,i=this.faces.length;t<i;t++){let n=this.faces[t];n.__originalFaceNormal?n.__originalFaceNormal.copy(n.normal):n.__originalFaceNormal=n.normal.clone(),n.__originalVertexNormals||(n.__originalVertexNormals=[]);for(let r=0,s=n.vertexNormals.length;r<s;r++)n.__originalVertexNormals[r]?n.__originalVertexNormals[r].copy(n.vertexNormals[r]):n.__originalVertexNormals[r]=n.vertexNormals[r].clone()}let e=new H3;e.faces=this.faces;for(let t=0,i=this.morphTargets.length;t<i;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];let r=this.morphNormals[t].faceNormals,s=this.morphNormals[t].vertexNormals;for(let a=0,o=this.faces.length;a<o;a++){let l=new G,c={a:new G,b:new G,c:new G};r.push(l),s.push(c)}}let n=this.morphNormals[t];e.vertices=this.morphTargets[t].vertices,e.computeFaceNormals(),e.computeVertexNormals();for(let r=0,s=this.faces.length;r<s;r++){let a=this.faces[r],o=n.faceNormals[r],l=n.vertexNormals[r];o.copy(a.normal),l.a.copy(a.vertexNormals[0]),l.b.copy(a.vertexNormals[1]),l.c.copy(a.vertexNormals[2])}}for(let t=0,i=this.faces.length;t<i;t++){let n=this.faces[t];n.normal=n.__originalFaceNormal,n.vertexNormals=n.__originalVertexNormals}}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ps),this.boundingBox.setFromPoints(this.vertices)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ol),this.boundingSphere.setFromPoints(this.vertices)}merge(e,t,i=0){if(!(e&&e.isGeometry)){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);return}let n,r=this.vertices.length,s=this.vertices,a=e.vertices,o=this.faces,l=e.faces,c=this.colors,u=e.colors;t!==void 0&&(n=new Cs().getNormalMatrix(t));for(let h=0,d=a.length;h<d;h++){let p=a[h].clone();t!==void 0&&p.applyMatrix4(t),s.push(p)}for(let h=0,d=u.length;h<d;h++)c.push(u[h].clone());for(let h=0,d=l.length;h<d;h++){let p=l[h],g,x,y=p.vertexNormals,b=p.vertexColors,A=new iz(p.a+r,p.b+r,p.c+r);A.normal.copy(p.normal),n!==void 0&&A.normal.applyMatrix3(n).normalize();for(let w=0,E=y.length;w<E;w++)g=y[w].clone(),n!==void 0&&g.applyMatrix3(n).normalize(),A.vertexNormals.push(g);A.color.copy(p.color);for(let w=0,E=b.length;w<E;w++)x=b[w],A.vertexColors.push(x.clone());A.materialIndex=p.materialIndex+i,o.push(A)}for(let h=0,d=e.faceVertexUvs.length;h<d;h++){let p=e.faceVertexUvs[h];this.faceVertexUvs[h]===void 0&&(this.faceVertexUvs[h]=[]);for(let g=0,x=p.length;g<x;g++){let y=p[g],b=[];for(let A=0,w=y.length;A<w;A++)b.push(y[A].clone());this.faceVertexUvs[h].push(b)}}}mergeMesh(e){if(!(e&&e.isMesh)){console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e);return}e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)}mergeVertices(e=4){let t={},i=[],n=[],r=Math.pow(10,e);for(let o=0,l=this.vertices.length;o<l;o++){let c=this.vertices[o],u=Math.round(c.x*r)+"_"+Math.round(c.y*r)+"_"+Math.round(c.z*r);t[u]===void 0?(t[u]=o,i.push(this.vertices[o]),n[o]=i.length-1):n[o]=n[t[u]]}let s=[];for(let o=0,l=this.faces.length;o<l;o++){let c=this.faces[o];c.a=n[c.a],c.b=n[c.b],c.c=n[c.c];let u=[c.a,c.b,c.c];for(let h=0;h<3;h++)if(u[h]===u[(h+1)%3]){s.push(o);break}}for(let o=s.length-1;o>=0;o--){let l=s[o];this.faces.splice(l,1);for(let c=0,u=this.faceVertexUvs.length;c<u;c++)this.faceVertexUvs[c].splice(l,1)}let a=this.vertices.length-i.length;return this.vertices=i,a}setFromPoints(e){this.vertices=[];for(let t=0,i=e.length;t<i;t++){let n=e[t];this.vertices.push(new G(n.x,n.y,n.z||0))}return this}sortFacesByMaterialIndex(){let e=this.faces,t=e.length;for(let o=0;o<t;o++)e[o]._id=o;function i(o,l){return o.materialIndex-l.materialIndex}e.sort(i);let n=this.faceVertexUvs[0],r=this.faceVertexUvs[1],s,a;n&&n.length===t&&(s=[]),r&&r.length===t&&(a=[]);for(let o=0;o<t;o++){let l=e[o]._id;s&&s.push(n[l]),a&&a.push(r[l])}s&&(this.faceVertexUvs[0]=s),a&&(this.faceVertexUvs[1]=a)}toJSON(){let e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),this.parameters!==void 0){let p=this.parameters;for(let g in p)p[g]!==void 0&&(e[g]=p[g]);return e}let t=[];for(let p=0;p<this.vertices.length;p++){let g=this.vertices[p];t.push(g.x,g.y,g.z)}let i=[],n=[],r={},s=[],a={},o=[],l={};for(let p=0;p<this.faces.length;p++){let g=this.faces[p],x=!0,y=!1,b=this.faceVertexUvs[0][p]!==void 0,A=g.normal.length()>0,w=g.vertexNormals.length>0,E=g.color.r!==1||g.color.g!==1||g.color.b!==1,D=g.vertexColors.length>0,T=0;if(T=c(T,0,0),T=c(T,1,x),T=c(T,2,y),T=c(T,3,b),T=c(T,4,A),T=c(T,5,w),T=c(T,6,E),T=c(T,7,D),i.push(T),i.push(g.a,g.b,g.c),i.push(g.materialIndex),b){let I=this.faceVertexUvs[0][p];i.push(d(I[0]),d(I[1]),d(I[2]))}if(A&&i.push(u(g.normal)),w){let I=g.vertexNormals;i.push(u(I[0]),u(I[1]),u(I[2]))}if(E&&i.push(h(g.color)),D){let I=g.vertexColors;i.push(h(I[0]),h(I[1]),h(I[2]))}}function c(p,g,x){return x?p|1<<g:p&~(1<<g)}function u(p){let g=p.x.toString()+p.y.toString()+p.z.toString();return r[g]!==void 0||(r[g]=n.length/3,n.push(p.x,p.y,p.z)),r[g]}function h(p){let g=p.r.toString()+p.g.toString()+p.b.toString();return a[g]!==void 0||(a[g]=s.length,s.push(p.getHex())),a[g]}function d(p){let g=p.x.toString()+p.y.toString();return l[g]!==void 0||(l[g]=o.length/2,o.push(p.x,p.y)),l[g]}return e.data={},e.data.vertices=t,e.data.normals=n,s.length>0&&(e.data.colors=s),o.length>0&&(e.data.uvs=[o]),e.data.faces=i,e}clone(){return new H3().copy(this)}copy(e){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;let t=e.vertices;for(let h=0,d=t.length;h<d;h++)this.vertices.push(t[h].clone());let i=e.colors;for(let h=0,d=i.length;h<d;h++)this.colors.push(i[h].clone());let n=e.faces;for(let h=0,d=n.length;h<d;h++)this.faces.push(n[h].clone());for(let h=0,d=e.faceVertexUvs.length;h<d;h++){let p=e.faceVertexUvs[h];this.faceVertexUvs[h]===void 0&&(this.faceVertexUvs[h]=[]);for(let g=0,x=p.length;g<x;g++){let y=p[g],b=[];for(let A=0,w=y.length;A<w;A++){let E=y[A];b.push(E.clone())}this.faceVertexUvs[h].push(b)}}let r=e.morphTargets;for(let h=0,d=r.length;h<d;h++){let p={};if(p.name=r[h].name,r[h].vertices!==void 0){p.vertices=[];for(let g=0,x=r[h].vertices.length;g<x;g++)p.vertices.push(r[h].vertices[g].clone())}if(r[h].normals!==void 0){p.normals=[];for(let g=0,x=r[h].normals.length;g<x;g++)p.normals.push(r[h].normals[g].clone())}this.morphTargets.push(p)}let s=e.morphNormals;for(let h=0,d=s.length;h<d;h++){let p={};if(s[h].vertexNormals!==void 0){p.vertexNormals=[];for(let g=0,x=s[h].vertexNormals.length;g<x;g++){let y=s[h].vertexNormals[g],b={};b.a=y.a.clone(),b.b=y.b.clone(),b.c=y.c.clone(),p.vertexNormals.push(b)}}if(s[h].faceNormals!==void 0){p.faceNormals=[];for(let g=0,x=s[h].faceNormals.length;g<x;g++)p.faceNormals.push(s[h].faceNormals[g].clone())}this.morphNormals.push(p)}let a=e.skinWeights;for(let h=0,d=a.length;h<d;h++)this.skinWeights.push(a[h].clone());let o=e.skinIndices;for(let h=0,d=o.length;h<d;h++)this.skinIndices.push(o[h].clone());let l=e.lineDistances;for(let h=0,d=l.length;h<d;h++)this.lineDistances.push(l[h]);let c=e.boundingBox;c!==null&&(this.boundingBox=c.clone());let u=e.boundingSphere;return u!==null&&(this.boundingSphere=u.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}toBufferGeometry(){let e=new fUe().fromGeometry(this),t=new ii,i=new Float32Array(e.vertices.length*3);if(t.setAttribute("position",WT.call(new vi(i,3),e.vertices)),e.normals.length>0){let n=new Float32Array(e.normals.length*3);t.setAttribute("normal",WT.call(new vi(n,3),e.normals))}if(e.colors.length>0){let n=new Float32Array(e.colors.length*3);t.setAttribute("color",OW.call(new vi(n,3),e.colors))}if(e.uvs.length>0){let n=new Float32Array(e.uvs.length*2);t.setAttribute("uv",BW.call(new vi(n,2),e.uvs))}if(e.uvs2.length>0){let n=new Float32Array(e.uvs2.length*2);t.setAttribute("uv2",BW.call(new vi(n,2),e.uvs2))}t.groups=e.groups;for(let n in e.morphTargets){let r=[],s=e.morphTargets[n];for(let a=0,o=s.length;a<o;a++){let l=s[a],c=new Gt(l.data.length*3,3);c.name=l.name,r.push(WT.call(c,l.data))}t.morphAttributes[n]=r}if(e.skinIndices.length>0){let n=new Gt(e.skinIndices.length*4,4);t.setAttribute("skinIndex",IW.call(n,e.skinIndices))}if(e.skinWeights.length>0){let n=new Gt(e.skinWeights.length*4,4);t.setAttribute("skinWeight",IW.call(n,e.skinWeights))}return e.boundingSphere!==null&&(t.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(t.boundingBox=e.boundingBox.clone()),t}computeTangents(){console.error("THREE.Geometry: .computeTangents() has been removed.")}computeLineDistances(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}applyMatrix(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}dispose(){this.dispatchEvent({type:"dispose"})}static createBufferGeometryFromObject(e){let t=new ii,i=e.geometry;if(e.isPoints||e.isLine){let n=new Gt(i.vertices.length*3,3),r=new Gt(i.colors.length*3,3);if(t.setAttribute("position",WT.call(n,i.vertices)),t.setAttribute("color",OW.call(r,i.colors)),i.lineDistances&&i.lineDistances.length===i.vertices.length){let s=new Gt(i.lineDistances.length,1);t.setAttribute("lineDistance",pUe.call(s,i.lineDistances))}i.boundingSphere!==null&&(t.boundingSphere=i.boundingSphere.clone()),i.boundingBox!==null&&(t.boundingBox=i.boundingBox.clone())}else e.isMesh&&(t=i.toBufferGeometry());return t}};H3.prototype.isGeometry=!0;var fUe=class{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(e){let t=[],i,n,r,s=e.faces;for(n=0;n<s.length;n++){let a=s[n];a.materialIndex!==r&&(r=a.materialIndex,i!==void 0&&(i.count=n*3-i.start,t.push(i)),i={start:n*3,materialIndex:r})}i!==void 0&&(i.count=n*3-i.start,t.push(i)),this.groups=t}fromGeometry(e){let t=e.faces,i=e.vertices,n=e.faceVertexUvs,r=n[0]&&n[0].length>0,s=n[1]&&n[1].length>0,a=e.morphTargets,o=a.length,l;if(o>0){l=[];for(let y=0;y<o;y++)l[y]={name:a[y].name,data:[]};this.morphTargets.position=l}let c=e.morphNormals,u=c.length,h;if(u>0){h=[];for(let y=0;y<u;y++)h[y]={name:c[y].name,data:[]};this.morphTargets.normal=h}let d=e.skinIndices,p=e.skinWeights,g=d.length===i.length,x=p.length===i.length;i.length>0&&t.length===0&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let y=0;y<t.length;y++){let b=t[y];this.vertices.push(i[b.a],i[b.b],i[b.c]);let A=b.vertexNormals;if(A.length===3)this.normals.push(A[0],A[1],A[2]);else{let E=b.normal;this.normals.push(E,E,E)}let w=b.vertexColors;if(w.length===3)this.colors.push(w[0],w[1],w[2]);else{let E=b.color;this.colors.push(E,E,E)}if(r===!0){let E=n[0][y];E!==void 0?this.uvs.push(E[0],E[1],E[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",y),this.uvs.push(new Ae,new Ae,new Ae))}if(s===!0){let E=n[1][y];E!==void 0?this.uvs2.push(E[0],E[1],E[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",y),this.uvs2.push(new Ae,new Ae,new Ae))}for(let E=0;E<o;E++){let D=a[E].vertices;l[E].data.push(D[b.a],D[b.b],D[b.c])}for(let E=0;E<u;E++){let D=c[E].vertexNormals[y];h[E].data.push(D.a,D.b,D.c)}g&&this.skinIndices.push(d[b.a],d[b.b],d[b.c]),x&&this.skinWeights.push(p[b.a],p[b.b],p[b.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),this}},iz=class{constructor(e,t,i,n,r,s=0){this.a=e,this.b=t,this.c=i,this.normal=n&&n.isVector3?n:new G,this.vertexNormals=Array.isArray(n)?n:[],this.color=r&&r.isColor?r:new gi,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=s}clone(){return new this.constructor().copy(this)}copy(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(let t=0,i=e.vertexNormals.length;t<i;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(let t=0,i=e.vertexColors.length;t<i;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}};function pUe(e){return this.array.set(e),this}function OW(e){let t=this.array,i=0;for(let n=0,r=e.length;n<r;n++){let s=e[n];s===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),s=new gi),t[i++]=s.r,t[i++]=s.g,t[i++]=s.b}return this}function BW(e){let t=this.array,i=0;for(let n=0,r=e.length;n<r;n++){let s=e[n];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),s=new Ae),t[i++]=s.x,t[i++]=s.y}return this}function WT(e){let t=this.array,i=0;for(let n=0,r=e.length;n<r;n++){let s=e[n];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),s=new G),t[i++]=s.x,t[i++]=s.y,t[i++]=s.z}return this}function IW(e){let t=this.array,i=0;for(let n=0,r=e.length;n<r;n++){let s=e[n];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),s=new Di),t[i++]=s.x,t[i++]=s.y,t[i++]=s.z,t[i++]=s.w}return this}var mUe=["a","b","c"];function gUe(e,t){switch(t){case"c":return e.c;case"b":return e.b;case"a":default:return e.a}}function GI(e,t,i){let n=Math.min(e,t),r=Math.max(e,t),s=n+"_"+r;return i.get(s)}function kI(e,t,i,n,r,s){let a=Math.min(e,t),o=Math.max(e,t),l=a+"_"+o,c;if(n.has(l))c=n.get(l);else{let u=i[a],h=i[o];c={a:u,b:h,newEdge:null,faces:[]},n.set(l,c)}c.faces.push(r),s[e].edges.push(c),s[t].edges.push(c)}function vUe(e,t,i,n){let r,s,a;for(r=0,s=e.length;r<s;r++)i[r]={edges:[]};for(r=0,s=t.length;r<s;r++)a=t[r],kI(a.a,a.b,e,n,a,i),kI(a.b,a.c,e,n,a,i),kI(a.c,a.a,e,n,a,i)}function XT(e,t,i,n,r){e.push(new iz(t,i,n,void 0,void 0,r))}function Hx(e,t){return Math.abs(t-e)/2+Math.min(e,t)}function qT(e,t,i,n){e.push([t.clone(),i.clone(),n.clone()])}var yUe=class{constructor(e=1){this.subdivisions=e}modify(e){e instanceof ii?e=new H3().fromBufferGeometry(e):e=e.clone(),e.mergeVertices();let t=this.subdivisions;for(;t-- >0;)this._smooth(e);return e.computeFaceNormals(),e.computeVertexNormals(),e}_smooth(e){let t=new G,i,n,r,s,a,o=e.vertices,l=e.faces,c=e.faceVertexUvs[0],u=c!==void 0&&c.length>0,h=[],d=new Map;vUe(o,l,h,d);let p=[],g,x,y,b,A,w,E;for(let _e of Array.from(d.keys())){for(x=d.get(_e),y=new G,A=3/8,w=1/8,E=x.faces.length,E!=2&&(A=.5,w=0,E!=1),y.addVectors(x.a,x.b).multiplyScalar(A),t.set(0,0,0),s=0;s<E;s++){for(b=x.faces[s],a=0;a<3&&(g=o[gUe(b,mUe[a])],!(g!==x.a&&g!==x.b));a++);g&&t.add(g)}t.multiplyScalar(w),y.add(t),x.newEdge=p.length,p.push(y)}let D,T,I,R,O,P,U,H=[];for(n=0,r=o.length;n<r;n++){for(P=o[n],O=h[n].edges,i=O.length,i==3?D=3/16:i>3&&(D=3/(8*i)),T=1-i*Number(D),I=D,i<=2&&(i==2?(T=3/4,I=1/8):i==1||i==0),U=P.clone().multiplyScalar(T),t.set(0,0,0),s=0;s<i;s++)R=O[s],g=R.a!==P?R.a:R.b,t.add(g);t.multiplyScalar(Number(I)),U.add(t),H.push(U)}let V=H.concat(p),j=H.length,J,F,X,W=[],ne=[],Y,$,se,fe,te=new Ae,de=new Ae,le=new Ae;for(n=0,r=l.length;n<r;n++)b=l[n],J=Number(GI(b.a,b.b,d).newEdge)+j,F=Number(GI(b.b,b.c,d).newEdge)+j,X=Number(GI(b.c,b.a,d).newEdge)+j,XT(W,J,F,X,b.materialIndex),XT(W,b.a,J,X,b.materialIndex),XT(W,b.b,F,J,b.materialIndex),XT(W,b.c,X,F,b.materialIndex),u&&(Y=c[n],$=Y[0],se=Y[1],fe=Y[2],te.set(Hx($.x,se.x),Hx($.y,se.y)),de.set(Hx(se.x,fe.x),Hx(se.y,fe.y)),le.set(Hx($.x,fe.x),Hx($.y,fe.y)),qT(ne,te,de,le),qT(ne,$,te,le),qT(ne,se,de,te),qT(ne,fe,le,de));e.vertices=V,e.faces=W,u&&(e.faceVertexUvs[0]=ne)}},ks=new G,xUe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=e.geometry??(t==null?void 0:t.geometry)??new ii().copy(new eh(100,100,100)),n;t===void 0?(i.computeBoundingBox(),i.boundingBox.getSize(ks),n={width:ks.x,height:ks.y,depth:ks.z,subdivisions:0}):n=t.parameters;let r={...n,...e.parameters};return{parameters:{width:Math.abs(r.width),height:Math.abs(r.height),depth:Math.abs(r.depth),subdivisions:Math.abs(r.subdivisions)},geometry:i}}static build(e){let{width:t,height:i,depth:n,subdivisions:r}=e.parameters,s=e.geometry??new ii().copy(new eh(100,100,100)),a=s.userData.parameters;a===void 0?(s.computeBoundingBox(),s.boundingBox.getSize(ks)):ks.set(a.width,a.height,a.depth),(t!==ks.x||i!==ks.y||n!==ks.z)&&s.scale(ks.x===0?1:t/ks.x,ks.y===0?1:i/ks.y,ks.z===0?1:n/ks.z);let o=s.originalGeometry;try{r>0?(o===void 0||(a==null?void 0:a.subdivisions)!==r)&&(o===void 0&&(o=s),s=new yUe(r).modify(o).toBufferGeometry()):(o!==void 0&&(s=o),o=void 0,s.getAttribute("normal")===void 0&&s.computeVertexNormals())}catch{o!==void 0&&(s=o),o=void 0,s.getAttribute("normal")===void 0&&s.computeVertexNormals()}return o!==void 0&&Object.assign(s,{originalGeometry:o}),delete e.geometry,Object.assign(s,{userData:{...e,type:"NonParametricGeometry"}})}static loadFromUrl(e,t,i){new wZ(i).load(e,n=>{let r=this.normalizeInputs({geometry:n});n.boundingBox.getSize(ks);let s=100/ks.x;Object.assign(r.parameters,{width:100,height:ks.y*s,depth:ks.z*s}),t(this.build(r))})}},xee=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters);return{shape:e.shape&&e.shape instanceof $r?e.shape:new $r,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i,spikes:n,cornerRadius:r,depth:s,extrudeBevelSize:a,extrudeBevelSegments:o}=e.parameters,l=e.shape,c=t*.5,u=i*.5,h=0,d=0,p=2*Math.PI/n;for(let x=0;x<n;x++){let y=p*x,b=h+Math.sin(y)*c,A=d+Math.cos(y)*u;l.addPoint(l.createPoint(b,A))}l.isClosed=!0;for(let x=0,y=l.points.length;x<y;x++)l.points[x].roundness=r;l.roundness=r,l.update();let g=J0.create({shape:l,parameters:{roundness:r,depth:s,extrudeBevelSize:a,extrudeBevelSegments:o}});return Object.assign(g,{userData:{...e,type:"PolygonGeometry"}})}},bUe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:4,heightSegments:1,cornerRadius:0,cornerSegments:8,openEnded:!1},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:n,radialSegments:r,heightSegments:s,openEnded:a,cornerRadius:o,cornerSegments:l}=e.parameters,c=new _Ue(t*.5,i,r,s,a,o,l);return c.scale(1,1,n/t),Object.assign(c,{userData:{...e,type:"PyramidGeometry"}})}};function G_(e,t,i){i.x=e.x*t.x,i.y=e.y,i.z=e.x*t.y}function jI(e,t,i,n,r,s){let a=t.clone().sub(e),o=i.clone().sub(e),l=a.angleTo(o);if(a.normalize(),o.normalize(),n===r){let c=a.add(o).normalize();s.copy(e).addScaledVector(c,n/Math.sin(l/2))}else{let c=a.angleTo(o);s.copy(e),s.addScaledVector(a,r/Math.sin(c)),s.addScaledVector(o,n/Math.sin(c))}}function SUe(e,t,i){let n=e.clone().sub(t),r=i.clone().sub(t);return n.projectOnVector(r),n.add(t)}var _Ue=class extends ii{constructor(e=.5,t=1,i=4,n=1,r=!1,s=0,a=4){super(),i=Math.floor(Math.max(3,i)),n=Math.floor(n),a=Math.floor(a);let o=[],l=[],c=[],u=[],h=0,d=t/2,p=Math.PI/i,g=e*Math.cos(Math.PI/i),x=2*Math.PI/i,y=(i-2)*Math.PI/i,b=Math.PI-y,A=new G(0,-d,0),w=new G(0,d,0),E=new Ae(e,-d),D=new Ae(g,-d),T=new Ae(0,w.y).sub(D),I=new Ae(0,w.y).sub(E),R=new Ae(T.y,-T.x).normalize(),O=new Ae(I.y,-I.x).normalize(),P=e*Math.cos(Math.PI/i)*Math.tan((Math.PI-T.angle())/2)-1e-8;s=Math.min(s,P);let U;{let X=new G(R.x,R.y,0),W=new G(Math.cos(x)*X.x,X.y,Math.sin(x)*X.x);U=X.angleTo(W)}let H=s/Math.tan((Math.PI-T.angle())/2),V=s/Math.tan((Math.PI-U)/2),j=new G;if(!r){l.push(A.x,A.y,A.z),c.push(0,-1,0),u.push(0,0);let X=h++,W=[],ne=E.clone(),Y=H/Math.cos(Math.PI/i);ne.x-=Y;for(let $=0;$<i;$++){let se=$/i*Math.PI*2+p,fe=new Ae(Math.sin(se),Math.cos(se));G_(ne,fe,j),l.push(j.x,j.y,j.z),c.push(0,-1,0),u.push(0,0),W.push(h++)}for(let $=0;$<W.length;$++)o.push(W[$],X,W[($+1)%W.length])}{let X=new G,W=new G,ne=new G,Y=new G,$=new G,se=new G;for(let fe=0;fe<i;fe++){let te=fe/i*Math.PI*2+p,de=(fe+.5)/i*Math.PI*2+p,le=(fe+1)/i*Math.PI*2+p,_e=new Ae(Math.sin(te),Math.cos(te)),be=new Ae(Math.sin(de),Math.cos(de)),we=new Ae(Math.sin(le),Math.cos(le));G_(E,_e,W),G_(E,we,ne),G_(R,be,X),jI(w,W,ne,V,V,Y),l.push(Y.x,Y.y,Y.z),jI(W,w,ne,V,H,$),l.push($.x,$.y,$.z),jI(ne,W,w,H,V,se),l.push(se.x,se.y,se.z),c.push(X.x,X.y,X.z),c.push(X.x,X.y,X.z),c.push(X.x,X.y,X.z),u.push(0,0),u.push(0,0),u.push(0,0);let Me=h++,Ne=h++,Ge=h++;if(o.push(Me,Ne,Ge),s>0){{let He=W.clone().add(ne).multiplyScalar(.5),Ke=w.clone().sub(He).normalize(),je=A.clone().sub(He).normalize().add(Ke).normalize().multiplyScalar(-1),Oe=se.clone().sub($);J(He,Oe,je,T.angle())}let We,ae;{let He=new G;G_(O,we,He);let Ke=se.clone().add(Y).multiplyScalar(.5);Ke=SUe(Ke,ne,w);let je=se.clone().sub(Y);[We,ae]=J(Ke,je,He,U,Y.y)}{let He=We,Ke=He.clone().setY(0).normalize(),je=new G(0,-1,0),Oe=Ke.clone().cross(je);F(He,Ke,je,Oe)}{let He=T.angle(),Ke=Math.PI-He,je=w.clone();je.y-=s/Math.sin(He-Math.PI/2);let Oe=new G,Qe=[];for(let gt=0;gt<a;gt++){let pe=[],k=Math.PI/2-Ke*gt/a,Q=Math.cos(k),xe=Math.sin(k),K=de;for(let Re=0;Re<=gt;Re++){let Le=Math.cos(K),st=Math.sin(K);X.x=Q*st,X.y=xe,X.z=Q*Le,Oe.copy(je).addScaledVector(X,s),l.push(Oe.x,Oe.y,Oe.z),c.push(X.x,X.y,X.z),u.push(0,0),pe.push(h++),K+=Math.PI*2/gt/i}Qe.push(pe)}ae.reverse(),Qe.push(ae);let $e=Qe.length-1;for(let gt=0;gt<$e;gt++){let pe=Qe[gt],k=Qe[gt+1],Q=pe.length-1;o.push(k[1],pe[0],k[0]);for(let xe=1;xe<=Q;xe++)o.push(pe[xe],pe[xe-1],k[xe]),o.push(k[xe+1],pe[xe],k[xe])}}}}}this.setIndex(o),this.setAttribute("position",new Gt(l,3)),this.setAttribute("normal",new Gt(c,3)),this.setAttribute("uv",new Gt(u,2));function J(X,W,ne,Y,$){let se=-Y/2,fe=(Math.PI-Y)/2,te=W.clone().normalize().cross(ne);X.addScaledVector(ne,-s/Math.sin(fe));let de=new G,le=new G,_e=1,be=h,we=[];for(let Me=0;Me<=a;Me++){let Ne=se+Me/a*Y;le.set(0,0,0),le.addScaledVector(te,Math.sin(Ne)),le.addScaledVector(ne,Math.cos(Ne));for(let Ge=0;Ge<=_e;Ge++){let We=Ge/_e-.5;if(de.copy(X),de.addScaledVector(W,We),de.addScaledVector(le,s),$!=null){let ae=Math.max(0,de.y-$);de.addScaledVector(W,-ae/W.y)}l.push(de.x,de.y,de.z),c.push(le.x,le.y,le.z),u.push(0,0),Ge===0&&we.push(h),h++}}for(let Me=0;Me<a;Me++)for(let Ne=0;Ne<_e;Ne++){let Ge=be+Ne+(_e+1)*Me,We=Ge+(_e+1),ae=We+1,He=Ge+1;o.push(Ge,We,He),o.push(We,ae,He)}return[X.clone().addScaledVector(W,.5),we]}function F(X,W,ne,Y){let $=Math.PI/2,se=I.angle()-$,fe=[],te=new G,de=new G;for(let _e=0;_e<=a;_e++){let be=[],we=_e/a;for(let Me=0;Me<=_e;Me++){let Ne=((_e?Me/_e:0)-.5)*b,Ge=Math.cos(Ne),We=Math.sin(Ne),ae=Math.atan(Math.tan(se)*Ge),He=($+ae)*we,Ke=Math.cos(He),je=Math.sin(He);te.set(0,0,0),te.addScaledVector(W,je*Ge),te.addScaledVector(ne,Ke),te.addScaledVector(Y,je*We),de.copy(X).addScaledVector(te,s),l.push(de.x,de.y,de.z),c.push(te.x,te.y,te.z),u.push(0,0),be.push(h++)}fe.push(be)}let le=fe.length-1;for(let _e=0;_e<le;_e++){let be=fe[_e],we=fe[_e+1],Me=be.length-1;o.push(be[0],we[1],we[0]);for(let Ne=1;Ne<=Me;Ne++)o.push(be[Ne-1],be[Ne],we[Ne]),o.push(be[Ne],we[Ne+1],we[Ne])}}}},T5=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,cornerRadius:[0,0,0,0],cornerType:1,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters),n=Object.assign((t==null?void 0:t.ui)??{enabledIndieCorners:!1},e.ui);return{shape:e.shape&&e.shape instanceof $r?e.shape:new $r,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)}),ui:n}}static build(e){let t=e.shape,{width:i,height:n,cornerRadius:r,cornerType:s,depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}=e.parameters,c={x:i*.5,y:n*.5},u={x:-c.x,y:-c.y},h={x:c.x,y:c.y};function d(E,D,T){return D>i&&T>n?Math.min(E*i/D,E*n/T):D>i?E*i/D:T>n?E*n/T:E}let p=[];p[0]=r[0]===0?0:d(r[0],r[0]+r[3],r[0]+r[1]),p[1]=r[1]===0?0:d(r[1],r[1]+r[2],r[1]+r[0]),p[2]=r[2]===0?0:d(r[2],r[2]+r[1],r[2]+r[3]),p[3]=r[3]===0?0:d(r[3],r[3]+r[0],r[3]+r[2]);let g=u.x,x=h.x,y=h.y,b=u.y;t.addPoint(t.createPoint(g,y)),t.addPoint(t.createPoint(x,y)),t.addPoint(t.createPoint(x,b)),t.addPoint(t.createPoint(g,b)),t.isClosed=!0;let A=!0;for(let E=0,D=t.points.length;E<D;E++)t.points[E].roundness=p[E],E>0&&p[E]!==p[E-1]&&(A=!1);A&&(t.roundness=p[0]),t.useCubicForRoundedCorners=s!==1,t.update();let w=J0.create({shape:t,parameters:{depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}});return Object.assign(w,{userData:{...e,type:"RectangleGeometry"}})}},AUe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180},e.parameters);return i.thetaLength=qt.clamp(i.thetaLength,0,180),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t=100,height:i=t,depth:n=t,widthSegments:r=64,heightSegments:s=64,phiStart:a,phiLength:o,thetaStart:l,thetaLength:c}=e.parameters,u;return c===0?(u=new ii,u.setAttribute("position",new Gt([],3))):u=new E1(.5*t,r,s,a,o,l,c*qt.DEG2RAD),u.scale(1,i/t,n/t),Object.assign(u,{userData:{...e,type:"SphereGeometry"}})}},wUe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,widthSegments:8,heightSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:0})}}static build(e){let{width:t=100,height:i=t,widthSegments:n=8,heightSegments:r=8}=e.parameters,s=new Ad(t,i,n,r);return s.scale(1,1,1),Object.assign(s,{userData:{...e,type:"PlaneGeometry"}})}},MUe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,angle:90,cornerRadius:24,cornerSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:n,angle:r,cornerRadius:s,cornerSegments:a}=e.parameters,o=new EUe(t,i,n,r,s,a);return Object.assign(o,{userData:{...e,type:"BackdropGeometry"}})}},EUe=class extends ii{constructor(e=1,t=1,i=1,n=90,r=10,s=24){super(),this.type="BackdropGeometry";let a=[],o=[],l=[],c=.001;r==0&&(s=1),s=Math.max(1,Math.floor(s)),r=Math.min(r,100),n=Math.min(180-c,n),n*=Math.PI/180;let u=[],h=Math.PI/2,d=(_e=0,be=0,we=0)=>new G(_e,be,we),p=d(),g=d(),[x,y,b]=[t/2,e/2,i/2],A=-y,w=+y,[E,D,T]=[d(A,-x,+b),d(A,-x,-b),d(A,+x,-b)],I=(_e,be=!1)=>Math.sin(_e-Math.PI/(1+ +be)),R=(_e,be=!1)=>Math.cos(_e-Math.PI/(1+ +be));T.y=Math.sin(n)*t-x;let O=Math.cos(n)*t-b,P=E.z-c;n<=h?(T.z=Math.min(O,P),T.z==P&&(T.y-=(O-P)/Math.tan(h-n))):D.z=Math.min(D.z-O-b,E.z-c),p.subVectors(E,D),g.subVectors(T,D);let U=Math.min(p.length(),g.length())*r/100,H=U*Math.tan(n/2),V=U/Math.cos(n/2),j=p.clone().normalize().add(g.normalize()).setLength(V).add(D);p.set(0,I(n,!0),R(n,!0)),u.push([T,p.clone()]);let J=(Math.PI-n)/s;for(let _e=0;_e<=s;_e++){let be=h+n+_e*J;p.set(0,Math.sin(be)*H,Math.cos(be)*H),p.add(j),g.set(0,I(be),R(be)),u.push([p.clone(),g.clone()])}u.push([E,d(0,1,0)]);let F=Math.sin(J/2)*H*2,X=u.length-1,W=u[0][0].distanceTo(u[1][0]),ne=u[X-1][0].distanceTo(u[X][0]),Y=W+F*s+ne;u[0].push(1);for(let _e=0;_e<=s;_e++)u[_e+1].push(1-(W+_e*F)/Y);u[X].push(0);let[$,se,fe]=u[0],te,de,le;for(let _e=1;_e<u.length;_e++)[te,de,le]=u[_e],a.push(A,$.y,$.z,A,te.y,te.z,w,$.y,$.z,w,$.y,$.z,A,te.y,te.z,w,te.y,te.z),o.push(0,se.y,se.z,0,de.y,de.z,0,se.y,se.z,0,se.y,se.z,0,de.y,de.z,0,de.y,de.z),l.push(0,fe,0,le,1,fe,1,fe,0,le,1,le),[$,se,fe]=[te,de,le];this.setAttribute("position",new Gt(a,3)),this.setAttribute("normal",new Gt(o,3)),this.setAttribute("uv",new Gt(l,2))}},bee=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,innerRadiusPercent:38.19,spikes:5,cornerRadius:0,angle:360,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return{shape:e.shape&&e.shape instanceof $r?e.shape:new $r,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i,innerRadiusPercent:n,spikes:r,cornerRadius:s,angle:a,depth:o,extrudeBevelSize:l,extrudeBevelSegments:c}=e.parameters,u=e.shape,h=t*.5,d=i*.5,p=0,g=0,x=a*Math.PI/360/r,y=Math.PI/2*3*-1,b=h*n/100,A=d*n/100;if(r===3&&n===50){x=2*Math.PI/r;for(let E=0;E<r;E++){let D=x*E,T=p+Math.sin(D)*h,I=g+Math.cos(D)*d;u.addPoint(u.createPoint(T,I))}}else for(let E=0;E<r;E++){let D=p+Math.cos(y)*h,T=g+Math.sin(y)*d;u.addPoint(u.createPoint(D,T)),y+=x,D=p+Math.cos(y)*b,T=g+Math.sin(y)*A,u.addPoint(u.createPoint(D,T)),y+=x}u.isClosed=!0;for(let E=0,D=u.points.length;E<D;E++)u.points[E].roundness=s;u.roundness=s,u.update();let w=J0.create({shape:u,parameters:{roundness:s,depth:o,extrudeBevelSize:l,extrudeBevelSegments:c}});return Object.assign(w,{userData:{...e,type:"StarGeometry"}})}},TUe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i}=e.parameters,n=new Ad(t,i);return Object.assign(n,{userData:{...e,type:"TextFrameGeometry"}})}},CUe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:32,tubularSegments:64,arc:360,cornerRadius:30,cornerSegments:8},e.parameters),n=Math.abs(i.width),r=Math.abs(i.height??i.width);i.shapeBlendNode&&(r=n);let s=Math.round(Math.abs(i.depth??i.width*.25));return{parameters:Object.assign(i,{width:n,height:r,depth:s})}}static build(e){let{width:t,height:i,depth:n,radialSegments:r,tubularSegments:s,arc:a,cornerRadius:o,cornerSegments:l}=e.parameters,c=DUe(t,i,n,t*.5,a,s,0,0,r,o,l);return c.scale(1,i/t,1),Object.assign(c,{userData:{...e,type:"TorusGeometry"}})}};function DUe(e,t,i,n,r,s,a,o,l,c,u){[t,i]=[i,t],a=t/2;let h=qt.clamp(r/360,0,1);if(h===0){let d=new ii;return d.setAttribute("position",new Gt([],3)),d}return h===1&&(c=0),new vee(!0,e,t,i,n,h,s,a,o,l,c,u)}var RUe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,tubularSegments:64,radialSegments:32,p:2,q:3},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width),tube:i.tube??i.width*.125})}}static build(e){let{width:t,tube:i,tubularSegments:n,radialSegments:r,p:s,q:a}=e.parameters,o=t*.5;o!==i&&(o-=i);let l=new vZ(o,i,n,r,s,a);return Object.assign(l,{userData:{...e,type:"TorusKnotGeometry"}})}},PUe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1,isRect:!1},e.parameters);return{shape:e.shape&&e.shape instanceof $r?e.shape:new $r,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width*(i.isRect?1:Math.sqrt(3)/2)),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t=100,height:i,cornerRadius:n,depth:r,extrudeBevelSize:s,extrudeBevelSegments:a,isRect:o}=e.parameters,l=e.shape,c=t*.5,u=i*.5;o?(l.addPoint(l.createPoint(-c,u)),l.addPoint(l.createPoint(c,-u)),l.addPoint(l.createPoint(-c,-u))):(l.addPoint(l.createPoint(0,u)),l.addPoint(l.createPoint(c,-u)),l.addPoint(l.createPoint(-c,-u))),l.isClosed=!0;for(let d=0,p=l.points.length;d<p;d++)l.points[d].roundness=n;l.roundness=n,l.update();let h=J0.create({shape:l,parameters:{roundness:n,depth:r,extrudeBevelSize:s,extrudeBevelSegments:a}});return Object.assign(h,{userData:{...e,type:"TriangleGeometry"}})}};function OUe(e,t){let i=2*Math.PI;return(e%i+i)%i===(t%i+i)%i}function BUe(e){return/^(rgba)?\(\s*(\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\s*\)$/.exec(e.toLowerCase())}function IUe(e,t,i){let n,r,s,a=Math.floor(e*6),o=e*6-a,l=i*(1-t),c=i*(1-o*t),u=i*(1-(1-o)*t);switch(a%6){case 0:n=i,r=u,s=l;break;case 1:n=c,r=i,s=l;break;case 2:n=l,r=i,s=u;break;case 3:n=l,r=c,s=i;break;case 4:n=u,r=l,s=i;break;case 5:default:n=i,r=l,s=c;break}return{r:n*255,g:r*255,b:s*255}}function LUe(e,t,i){e/=255,t/=255,i/=255;let n=Math.max(e,t,i),r=Math.min(e,t,i),s=n,a=n-r,o=n==0?0:a/n,l;if(n==r)l=0;else{switch(n){case e:l=(t-i)/a+(t<i?6:0);break;case t:l=(i-e)/a+2;break;case i:default:l=(e-t)/a+4;break}l/=6}return{h:l,s:o,v:s}}function UUe(e){return e=Math.floor(e),{r:e>>16&255,g:e>>8&255,b:e&255}}function NUe(e,t,i){return(e<<16)+(t<<8)+i}function zUe(e,t,i){return e=Math.round(e),t=Math.round(t),i=Math.round(i),"#"+[e,t,i].map(n=>n.toString(16).padStart(2,"0")).join("").toUpperCase()}function FUe(e){let t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,(n,r,s,a)=>String(r+r+s+s+a+a));let i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:null}var VUe={parseRgba:BUe,hsvToRgb:IUe,rgbToHsv:LUe,hexToRgb:UUe,rgbToHex:NUe,rgbToHexString:zUe,hexStringToRgb:FUe},HUe=class{add(e,t,i){if(typeof arguments[0]!="string")for(let n in arguments[0])this.add(n,arguments[0][n],arguments[1]);else(Array.isArray(e)?e:[e]).forEach(function(n){this[n]=this[n]||[],t&&this[n][i?"unshift":"push"](t)},this)}run(e,t){this[e]=this[e]||[],this[e].forEach(function(i){i.call(t&&t.context?t.context:t,t)})}},GUe=class{constructor(e){this.jsep=e,this.registered={}}register(...e){e.forEach(t=>{if(typeof t!="object"||!t.name||!t.init)throw new Error("Invalid JSEP plugin format");this.registered[t.name]||(t.init(this.jsep),this.registered[t.name]=t)})}},St=class{static get version(){return"1.3.8"}static toString(){return"JavaScript Expression Parser (JSEP) v"+St.version}static addUnaryOp(e){return St.max_unop_len=Math.max(e.length,St.max_unop_len),St.unary_ops[e]=1,St}static addBinaryOp(e,t,i){return St.max_binop_len=Math.max(e.length,St.max_binop_len),St.binary_ops[e]=t,i?St.right_associative.add(e):St.right_associative.delete(e),St}static addIdentifierChar(e){return St.additional_identifier_chars.add(e),St}static addLiteral(e,t){return St.literals[e]=t,St}static removeUnaryOp(e){return delete St.unary_ops[e],e.length===St.max_unop_len&&(St.max_unop_len=St.getMaxKeyLen(St.unary_ops)),St}static removeAllUnaryOps(){return St.unary_ops={},St.max_unop_len=0,St}static removeIdentifierChar(e){return St.additional_identifier_chars.delete(e),St}static removeBinaryOp(e){return delete St.binary_ops[e],e.length===St.max_binop_len&&(St.max_binop_len=St.getMaxKeyLen(St.binary_ops)),St.right_associative.delete(e),St}static removeAllBinaryOps(){return St.binary_ops={},St.max_binop_len=0,St}static removeLiteral(e){return delete St.literals[e],St}static removeAllLiterals(){return St.literals={},St}get char(){return this.expr.charAt(this.index)}get code(){return this.expr.charCodeAt(this.index)}constructor(e){this.expr=e,this.index=0}static parse(e){return new St(e).parse()}static getMaxKeyLen(e){return Math.max(0,...Object.keys(e).map(t=>t.length))}static isDecimalDigit(e){return e>=48&&e<=57}static binaryPrecedence(e){return St.binary_ops[e]||0}static isIdentifierStart(e){return e>=65&&e<=90||e>=97&&e<=122||e>=128&&!St.binary_ops[String.fromCharCode(e)]||St.additional_identifier_chars.has(String.fromCharCode(e))}static isIdentifierPart(e){return St.isIdentifierStart(e)||St.isDecimalDigit(e)}throwError(e){let t=new Error(e+" at character "+this.index);throw t.index=this.index,t.description=e,t}runHook(e,t){if(St.hooks[e]){let i={context:this,node:t};return St.hooks.run(e,i),i.node}return t}searchHook(e){if(St.hooks[e]){let t={context:this};return St.hooks[e].find(function(i){return i.call(t.context,t),t.node}),t.node}}gobbleSpaces(){let e=this.code;for(;e===St.SPACE_CODE||e===St.TAB_CODE||e===St.LF_CODE||e===St.CR_CODE;)e=this.expr.charCodeAt(++this.index);this.runHook("gobble-spaces")}parse(){this.runHook("before-all");let e=this.gobbleExpressions(),t=e.length===1?e[0]:{type:St.COMPOUND,body:e};return this.runHook("after-all",t)}gobbleExpressions(e){let t=[],i,n;for(;this.index<this.expr.length;)if(i=this.code,i===St.SEMCOL_CODE||i===St.COMMA_CODE)this.index++;else if(n=this.gobbleExpression())t.push(n);else if(this.index<this.expr.length){if(i===e)break;this.throwError('Unexpected "'+this.char+'"')}return t}gobbleExpression(){let e=this.searchHook("gobble-expression")||this.gobbleBinaryExpression();return this.gobbleSpaces(),this.runHook("after-expression",e)}gobbleBinaryOp(){this.gobbleSpaces();let e=this.expr.substr(this.index,St.max_binop_len),t=e.length;for(;t>0;){if(St.binary_ops.hasOwnProperty(e)&&(!St.isIdentifierStart(this.code)||this.index+e.length<this.expr.length&&!St.isIdentifierPart(this.expr.charCodeAt(this.index+e.length))))return this.index+=t,e;e=e.substr(0,--t)}return!1}gobbleBinaryExpression(){let e,t,i,n,r,s,a,o,l;if(s=this.gobbleToken(),!s||(t=this.gobbleBinaryOp(),!t))return s;for(r={value:t,prec:St.binaryPrecedence(t),right_a:St.right_associative.has(t)},a=this.gobbleToken(),a||this.throwError("Expected expression after "+t),n=[s,r,a];t=this.gobbleBinaryOp();){if(i=St.binaryPrecedence(t),i===0){this.index-=t.length;break}r={value:t,prec:i,right_a:St.right_associative.has(t)},l=t;let c=u=>r.right_a&&u.right_a?i>u.prec:i<=u.prec;for(;n.length>2&&c(n[n.length-2]);)a=n.pop(),t=n.pop().value,s=n.pop(),e={type:St.BINARY_EXP,operator:t,left:s,right:a},n.push(e);e=this.gobbleToken(),e||this.throwError("Expected expression after "+l),n.push(r,e)}for(o=n.length-1,e=n[o];o>1;)e={type:St.BINARY_EXP,operator:n[o-1].value,left:n[o-2],right:e},o-=2;return e}gobbleToken(){let e,t,i,n;if(this.gobbleSpaces(),n=this.searchHook("gobble-token"),n)return this.runHook("after-token",n);if(e=this.code,St.isDecimalDigit(e)||e===St.PERIOD_CODE)return this.gobbleNumericLiteral();if(e===St.SQUOTE_CODE||e===St.DQUOTE_CODE)n=this.gobbleStringLiteral();else if(e===St.OBRACK_CODE)n=this.gobbleArray();else{for(t=this.expr.substr(this.index,St.max_unop_len),i=t.length;i>0;){if(St.unary_ops.hasOwnProperty(t)&&(!St.isIdentifierStart(this.code)||this.index+t.length<this.expr.length&&!St.isIdentifierPart(this.expr.charCodeAt(this.index+t.length)))){this.index+=i;let r=this.gobbleToken();return r||this.throwError("missing unaryOp argument"),this.runHook("after-token",{type:St.UNARY_EXP,operator:t,argument:r,prefix:!0})}t=t.substr(0,--i)}St.isIdentifierStart(e)?(n=this.gobbleIdentifier(),St.literals.hasOwnProperty(n.name)?n={type:St.LITERAL,value:St.literals[n.name],raw:n.name}:n.name===St.this_str&&(n={type:St.THIS_EXP})):e===St.OPAREN_CODE&&(n=this.gobbleGroup())}return n?(n=this.gobbleTokenProperty(n),this.runHook("after-token",n)):this.runHook("after-token",!1)}gobbleTokenProperty(e){this.gobbleSpaces();let t=this.code;for(;t===St.PERIOD_CODE||t===St.OBRACK_CODE||t===St.OPAREN_CODE||t===St.QUMARK_CODE;){let i;if(t===St.QUMARK_CODE){if(this.expr.charCodeAt(this.index+1)!==St.PERIOD_CODE)break;i=!0,this.index+=2,this.gobbleSpaces(),t=this.code}this.index++,t===St.OBRACK_CODE?(e={type:St.MEMBER_EXP,computed:!0,object:e,property:this.gobbleExpression()},this.gobbleSpaces(),t=this.code,t!==St.CBRACK_CODE&&this.throwError("Unclosed ["),this.index++):t===St.OPAREN_CODE?e={type:St.CALL_EXP,arguments:this.gobbleArguments(St.CPAREN_CODE),callee:e}:(t===St.PERIOD_CODE||i)&&(i&&this.index--,this.gobbleSpaces(),e={type:St.MEMBER_EXP,computed:!1,object:e,property:this.gobbleIdentifier()}),i&&(e.optional=!0),this.gobbleSpaces(),t=this.code}return e}gobbleNumericLiteral(){let e="",t,i;for(;St.isDecimalDigit(this.code);)e+=this.expr.charAt(this.index++);if(this.code===St.PERIOD_CODE)for(e+=this.expr.charAt(this.index++);St.isDecimalDigit(this.code);)e+=this.expr.charAt(this.index++);if(t=this.char,t==="e"||t==="E"){for(e+=this.expr.charAt(this.index++),t=this.char,(t==="+"||t==="-")&&(e+=this.expr.charAt(this.index++));St.isDecimalDigit(this.code);)e+=this.expr.charAt(this.index++);St.isDecimalDigit(this.expr.charCodeAt(this.index-1))||this.throwError("Expected exponent ("+e+this.char+")")}return i=this.code,St.isIdentifierStart(i)?this.throwError("Variable names cannot start with a number ("+e+this.char+")"):(i===St.PERIOD_CODE||e.length===1&&e.charCodeAt(0)===St.PERIOD_CODE)&&this.throwError("Unexpected period"),{type:St.LITERAL,value:parseFloat(e),raw:e}}gobbleStringLiteral(){let e="",t=this.index,i=this.expr.charAt(this.index++),n=!1;for(;this.index<this.expr.length;){let r=this.expr.charAt(this.index++);if(r===i){n=!0;break}else if(r==="\\")switch(r=this.expr.charAt(this.index++),r){case"n":e+=`
`;break;case"r":e+="\r";break;case"t":e+="	";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:e+=r}else e+=r}return n||this.throwError('Unclosed quote after "'+e+'"'),{type:St.LITERAL,value:e,raw:this.expr.substring(t,this.index)}}gobbleIdentifier(){let e=this.code,t=this.index;for(St.isIdentifierStart(e)?this.index++:this.throwError("Unexpected "+this.char);this.index<this.expr.length&&(e=this.code,St.isIdentifierPart(e));)this.index++;return{type:St.IDENTIFIER,name:this.expr.slice(t,this.index)}}gobbleArguments(e){let t=[],i=!1,n=0;for(;this.index<this.expr.length;){this.gobbleSpaces();let r=this.code;if(r===e){i=!0,this.index++,e===St.CPAREN_CODE&&n&&n>=t.length&&this.throwError("Unexpected token "+String.fromCharCode(e));break}else if(r===St.COMMA_CODE){if(this.index++,n++,n!==t.length){if(e===St.CPAREN_CODE)this.throwError("Unexpected token ,");else if(e===St.CBRACK_CODE)for(let s=t.length;s<n;s++)t.push(null)}}else if(t.length!==n&&n!==0)this.throwError("Expected comma");else{let s=this.gobbleExpression();(!s||s.type===St.COMPOUND)&&this.throwError("Expected comma"),t.push(s)}}return i||this.throwError("Expected "+String.fromCharCode(e)),t}gobbleGroup(){this.index++;let e=this.gobbleExpressions(St.CPAREN_CODE);if(this.code===St.CPAREN_CODE)return this.index++,e.length===1?e[0]:e.length?{type:St.SEQUENCE_EXP,expressions:e}:!1;this.throwError("Unclosed (")}gobbleArray(){return this.index++,{type:St.ARRAY_EXP,elements:this.gobbleArguments(St.CBRACK_CODE)}}},kUe=new HUe;Object.assign(St,{hooks:kUe,plugins:new GUe(St),COMPOUND:"Compound",SEQUENCE_EXP:"SequenceExpression",IDENTIFIER:"Identifier",MEMBER_EXP:"MemberExpression",LITERAL:"Literal",THIS_EXP:"ThisExpression",CALL_EXP:"CallExpression",UNARY_EXP:"UnaryExpression",BINARY_EXP:"BinaryExpression",ARRAY_EXP:"ArrayExpression",TAB_CODE:9,LF_CODE:10,CR_CODE:13,SPACE_CODE:32,PERIOD_CODE:46,COMMA_CODE:44,SQUOTE_CODE:39,DQUOTE_CODE:34,OPAREN_CODE:40,CPAREN_CODE:41,OBRACK_CODE:91,CBRACK_CODE:93,QUMARK_CODE:63,SEMCOL_CODE:59,COLON_CODE:58,unary_ops:{"-":1,"!":1,"~":1,"+":1},binary_ops:{"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},right_associative:new Set,additional_identifier_chars:new Set(["$","_"]),literals:{true:!0,false:!1,null:null},this_str:"this"});St.max_unop_len=St.getMaxKeyLen(St.unary_ops);St.max_binop_len=St.getMaxKeyLen(St.binary_ops);var db=e=>new St(e).parse(),jUe=Object.getOwnPropertyNames(St);jUe.forEach(e=>{db[e]===void 0&&e!=="prototype"&&(db[e]=St[e])});db.Jsep=St;var WUe="ConditionalExpression",XUe={name:"ternary",init(e){e.hooks.add("after-expression",function(t){if(t.node&&this.code===e.QUMARK_CODE){this.index++;let i=t.node,n=this.gobbleExpression();if(n||this.throwError("Expected expression"),this.gobbleSpaces(),this.code===e.COLON_CODE){this.index++;let r=this.gobbleExpression();if(r||this.throwError("Expected expression"),t.node={type:WUe,test:i,consequent:n,alternate:r},i.operator&&e.binary_ops[i.operator]<=.9){let s=i;for(;s.right.operator&&e.binary_ops[s.right.operator]<=.9;)s=s.right;t.node.test=s.right,s.right=t.node,t.node=i}}else this.throwError("Expected :")}})}};db.plugins.register(XUe);function oP(e){return{all:e=e||new Map,on:function(t,i){var n=e.get(t);n?n.push(i):e.set(t,[i])},off:function(t,i){var n=e.get(t);n&&(i?n.splice(n.indexOf(i)>>>0,1):e.set(t,[]))},emit:function(t,i){var n=e.get(t);n&&n.slice().map(function(r){r(i)}),(n=e.get("*"))&&n.slice().map(function(r){r(t,i)})}}}var See=class{constructor(e,t,i){var n;this.id=e,this.userAPI=t,this.result=void 0,this.error="null",this.isPrefetched=!1,this.isLoading=!1,this.isLoaded=!1,this.prefetchPromise=new Promise(r=>r()),this.emitter=oP(),this._innerCallUserAPI=async r=>{var s,a,o;this.emitter.emit("start",{userAPIId:this.id}),this.isLoading=!0,this.isLoading=!1;try{this.result=await JUe(this.userAPI,r),this.error="null",this.emitter.emit("success",{userAPIId:this.id})}catch(l){let c=((o=(a=(s=l.message)==null?void 0:s.split("_:_"))==null?void 0:a[0])==null?void 0:o.replace("status:",""))??"null";this.error=c,this.result=null,this.emitter.emit("error",{userAPIId:this.id})}this.isLoading=!1,this.isPrefetched=!0,this.isLoaded=!0},((n=t==null?void 0:t.integration)==null?void 0:n.type)==="OpenAI"?this.result={content:""}:t.method==="GET"&&t.url!==""&&(this.prefetchPromise=this.prefetch(i)),this._debouncedCallUserAPI=this._innerCallUserAPI,this._updateDebouncedCallUserAPI(),this._debouncedPrefetch=_w(this.prefetch,1e3,{trailing:!0})}_updateDebouncedCallUserAPI(){this._debouncedCallUserAPI=this.userAPI.debounce!==void 0&&this.userAPI.debounce>0?_w(this._innerCallUserAPI,this.userAPI.debounce,{leading:!0,trailing:!0}):this._innerCallUserAPI}async prefetch(e){await this.callUserAPI(e)}async callUserAPI(e){await this._debouncedCallUserAPI(e)}update(e,t,i=!0){this.userAPI=e,this._updateDebouncedCallUserAPI(),this.userAPI.url!==""&&this.userAPI.method==="GET"&&i&&this._debouncedPrefetch(t)}retrieveValue(e){if(this.result)try{return Ys.zoom(this.result,e)}catch(t){console.error(t)}}retrieveZoomedKeyValues(e){if(this.result){let t=e&&e.length?Ys.zoom(this.result,e):this.result;if(KUe(t))return Object.entries(t);if(QUe(t))return t.map((i,n)=>[n.toString(),i]);throw YUe(t)?new Error("This path points to a value, use retrieveValue() instead. "+(e==null?void 0:e.join("."))):new Error("Path error"+(e==null?void 0:e.join(".")))}}dispose(){}on(e,t){this.emitter.on(e,t)}off(e,t){this.emitter.off(e,t)}get autostart(){return this.userAPI.autoStart}};function qUe(e){let t=new Headers;return e.headers.forEach(i=>{i.data.key!==""&&t.append(i.data.key,i.data.value)}),t}function YUe(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||e===null}function QUe(e){return Array.isArray(e)}function KUe(e){return typeof e=="object"&&e!==null}async function JUe(e,t,i=new AbortController){var l,c,u,h;let n,r=e.url,s=((l=e.proxy)==null?void 0:l.enabled)??!1,a;if(((c=e.integration)==null?void 0:c.type)==="OpenAI"){let d=hA(e.integration.prompt===""?[]:JSON.parse(e.integration.prompt),t),p=e.integration.behavior===""?[]:hA(JSON.parse(e.integration.behavior),t);a=`{
		"model": "${e.integration.model}",
		"messages": [${e.integration.useBehavior?`
		{
			"role": "system",
			"content": "${p}"
		},`:""}
		{
			"role": "user",
			"content": "${d}"
		}
		]
	}`}if(s){r=`https://apis.spline.design/file/${e.proxy.fileId}/external-api/request?uuidexternalapi=${e.proxy.proxyId}`;let d;a!==void 0?d=a:e.method==="POST"&&e.body&&(d=hA(JSON.parse(e.body),t)),d!==void 0&&(r+=`&data=${encodeURIComponent(d.replace(/(\r\n|\n|\r|\t)/gm,""))}`)}else((u=e.integration)==null?void 0:u.type)==="OpenAI"?n=a:e.method==="POST"&&e.body&&(n=hA(JSON.parse(e.body),t));let o=await fetch(r,{method:s?"GET":e.method,headers:s?void 0:qUe(e),signal:i.signal,body:n});if(!o.ok)throw new Error("status:"+o.status+"_:_"+o.statusText);if(((h=e.integration)==null?void 0:h.type)==="OpenAI"){let d=await o.json();return s&&(d=d.response),{content:d.choices[0].message.content}}else{let d=await o.json();return s&&(d=d.response),d}}var _ee=(e,t)=>{if(typeof e=="string"){let i=t.getVariable(e);if(i)return _ee(i,t)}return Xa.isBoolean(e)?Xa.getDisplayedValue(e).toLowerCase():Xa.getDisplayedValue(e)},hA=(e,t)=>e.map((i,n)=>{if("text"in i)return i.text;if("type"in i){if(i.type==="paragraph")return(n>0?`
`:"")+hA(i.children,t);if(i.type==="variable"){let r=t.getVariable(i.variableId);if(r!==void 0)return _ee(r,t)}}return""}).join(""),ZUe=["+","-","*","/","(",")","==","!=",">","<",">=","<=","and","or","!","%","^",","],$Ue=["0","1","2","3","4","5","6","7","8","9","."],eNe=["sin","cos","tan","asin","acos","atan","atan2","sqrt","abs","log","exp","floor","ceil","round","min","max","random"];function tNe(e){return typeof e!="string"?!1:!isNaN(e)&&!isNaN(parseFloat(e))}db.addBinaryOp("^",11,!0);function Aee(e,t,i="number"){let n="";for(let a=0;a<e.length;a++){let o=e[a];if("objType"in o&&o.objType==="api"){let l=JSON.parse(o.id),c=l[0],u=t.getUserAPI(c);if(u!==void 0&&u instanceof See){let h=u.retrieveValue(l.slice(1));h!==void 0&&(n+=h)}continue}if("objType"in o&&o.objType==="webhook"){let l=JSON.parse(o.id),[c,u]=l,h=t.getUserWebhook(c);if(h!==void 0){let d=h.getParameterValue(u);d!==void 0&&(n+=d)}continue}if("objType"in o&&o.objType==="aiAssistant"){let l=t.openAIRealtime;if("objId"in o&&o.objId!==void 0){let c;if(t.scene.data.objects.traverse((u,h)=>{var p;let d=(p=h.events)==null?void 0:p.find(g=>g.id===o.objId);d&&(c=d)}),c!==void 0&&c.data.type==="AIAssistantListener"){let u=l==null?void 0:l.computeAnalysisForListenerEvent(c.data);if(u!==void 0){n+=u;continue}}}n+=(l==null?void 0:l.voice)??0;continue}if("id"in o){let l=e[a-1];if(a>0&&"id"in l){console.error("Two variables in a row",e);return}let c=t.getVariable(o.id),u=Xa.getDisplayedValue(c);i==="number"&&Xa.isTextValue(c)&&Array.isArray(c.textValue)&&c.textValue.length===1?u=parseFloat(u).toString():i==="boolean"&&Xa.isBoolean(c)?u=c?"true":"false":i==="boolean"&&Xa.isTextValue(c)&&!Array.isArray(c.textValue)&&(u='"'+u+'"'),n+=u;continue}else if(i==="string"){o.name!=='"'&&(o.name!=="+"||o.escaped)&&(n+=o.name),o.name==="+"&&!o.escaped&&n[n.length-1]==="\\"&&(n=n.slice(0,-1)+o.name);continue}if(o.name==="and"){n+="&&";continue}if(o.name==="or"){n+="||";continue}if(o.name==="True"){n+="true";continue}if(o.name==="False"){n+="false";continue}if(i==="boolean"&&!tNe(o.name)&&!$Ue.includes(o.name)&&!ZUe.includes(o.name)&&!eNe.includes(o.name.replace(/\($/g,""))){n+='"'+o.name+'"';continue}n+=o.name}if(i==="string")return n;if(e.length===0){if(i==="number")return 0;if(i==="boolean")return!1}let r;try{r=db(n)}catch(a){console.error(n,a);return}let s;try{s=En(r)}catch(a){console.error(n,r,a)}return s}function En(e){switch(e.type){case"BinaryExpression":switch(e.operator){case"==":return+(En(e.left)===En(e.right));case"!=":return+(En(e.left)!==En(e.right));case">":return+(En(e.left)>En(e.right));case">=":return+(En(e.left)>=En(e.right));case"<":return+(En(e.left)<En(e.right));case"<=":return+(En(e.left)<=En(e.right));case"+":return En(e.left)+En(e.right);case"-":return En(e.left)-En(e.right);case"*":return En(e.left)*En(e.right);case"/":return En(e.left)/En(e.right);case"%":return En(e.left)%En(e.right);case"&&":return En(e.left)&&En(e.right);case"||":return En(e.left)||En(e.right);case"^":return Math.pow(En(e.left),En(e.right));default:throw new Error("Unknown operator: "+e.operator)}case"UnaryExpression":switch(e.operator){case"-":return-En(e.argument);case"!":return+!En(e.argument);default:throw new Error("Unknown operator: "+e.operator)}case"Identifier":throw new Error("Unknown identifier: "+e.name);case"Literal":return e.value;case"CallExpression":if(e.callee.type==="Identifier"){if(e.callee.name==="random"){let t=0,i=1;if(e.arguments.length>=1)try{t=En(e.arguments[0])}catch(n){console.warn(n)}if(e.arguments.length>=2)try{i=En(e.arguments[1])}catch(n){console.warn(n)}return t=Math.min(i,t),i=Math.max(i,t),t+Math.random()*(i-t)}return Math[e.callee.name].apply(null,e.arguments.map(En))}else throw new Error("Unknown node");default:throw new Error("Unknown node type: "+e.type)}}var iNe=new Bt,nNe=new Bt;function rNe(e,t,i){let n=[new G,new G,new G],r=[new G,new G,new G];return e.extractBasis(n[0],n[1],n[2]),t.extractBasis(r[0],r[1],r[2]),n.forEach((s,a)=>{let o=r[a],l=qt.lerp(s.length(),o.length(),i);s.lerp(o,i).setLength(l)}),new Bt().makeBasis(n[0],n[1],n[2])}var sNe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,height:100,depth:1,subdivisions:12,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters),n=Math.abs(i.width),r=Math.abs(i.height??i.width),s=Math.abs(i.depth??0),a=(t==null?void 0:t.shapeData)??E5.create({parameters:j$}).userData.shape;return{path:e.path??E3.defaultData(),parameters:Object.assign(i,{width:n,height:r,depth:s,extrusion:{...W$,...i.extrusion}}),shapeData:a}}static build(e){if(e.path.points.length>=2){let t=new aNe(e);return Object.assign(t,{userData:{...e,type:"PathGeometry"}})}else return Object.assign(new ii,{userData:{...e,type:"PathGeometry"}})}},aNe=class extends ii{constructor(e){super(),this.type="PathExtrusionGeometry",this.inputs=e,this.build()}_isGeometryClosed(){return this.inputs.path.isClosed&&this.inputs.parameters.extrusion.depth===1}_isOpenEnded(){let e=this.inputs.parameters.extrusion;return!(this.inputs.path.isClosed&&e.depth===1)||!OUe(e.twist,0)||e.startScale!==e.endScale}build(){let e=this._extractPathPoints();if(e.length<2)return;let t=this._computeBasisMatrices(e),{depth:i,offset:n}=this.inputs.parameters.extrusion;i=Math.max(0,Math.min(i,1)),n=Math.max(0,Math.min(n,1));let r=this.inputs.path.isClosed?e.length:e.length-1,s=Math.floor(n*r),a=this.inputs.path.isClosed?Math.ceil((i+n)*r):Math.ceil(Math.min(1,i+n)*r),o=Math.min(Math.max(2,a-s+1),r+2),l=[],c=[];for(let X=0;X<o;X++){let W=this.inputs.path.isClosed?(X+s)%e.length:Math.min(X+s,e.length-1);l.push(e[W].clone()),c.push(t[W].clone())}let u=(X,W,ne)=>{l[X]=l[X].clone().lerp(l[W],ne),c[X]=rNe(c[X],c[W],ne)},h=0,d=n*r%1;(!this.inputs.path.isClosed||i<=1)&&(d||n===0)&&(h=d,u(0,1,h));let p=0,g=(n+i)*r%1;if((this.inputs.path.isClosed&&i<=1||!this.inputs.path.isClosed&&n+i<1)&&g&&(p=g,u(l.length-1,l.length-2,1-p)),i===0){let X=l.length-1;l[X].copy(l[0]),c[X].copy(c[0])}this._applyPathModifiers(c,h,p);let{bevel:x,bevelSides:y}=this.inputs.parameters.extrusion,b=x>0?this.inputs.parameters.extrusion.capType:"flat",A=5;this.inputs.parameters.extrusion.shape.type==="Custom"&&(A=this.inputs.parameters.extrusion.shape.shapeQuality==="low"?5:12);let{regions:w,infos:E,vertices:D}=this._computeShapePoints(A),T=0,I;b==="round"&&(I=new M5(this.inputs.shapeData,2*x,x,A,y,void 0,!0),T=I.getAttribute("position").count);let R=0,O=0;E.sort((X,W)=>X.start-W.start),E.forEach(X=>{X.verticesStart=R,X.verticesCount=X.continuous.reduce((W,ne,Y)=>W+(Y===0||!ne?2:1),0),O+=X.verticesCount,R=O});let P=O*o,U,H=0;if(this._isOpenEnded()&&b==="flat"){try{U=Gm({windingRule:$n.ODD,elementType:Ts.POLYGONS,polySize:3,vertexSize:2,strict:!0,contours:w})}catch{U=uee}H=U.vertexCount}let V=P+2*H+T*2,j=P+2*H,J={positions:new Float32Array(V*3),normals:new Float32Array(V*3),uvs:new Float32Array(V*2)},F=[];if(E.forEach(X=>{this._extrudeRegion(X,D,c,l,J,F,this._isGeometryClosed()&&!this._isOpenEnded())}),U&&(this._closeEnd(U,P,F,J,c[0],l[0],!1),this._closeEnd(U,P+H,F,J,c[c.length-1],l[l.length-1],!0)),I){J.positions.set(I.getAttribute("position").array,j*3),J.normals.set(I.getAttribute("normal").array,j*3),J.uvs.set(I.getAttribute("uv").array,j*2);for(let Y=j;Y<j+T;Y++)J.uvs[Y*2+1]=1e-4;let X=F.length;F.push(...I.getIndex().array.map(Y=>Y+j)),j+=T,J.positions.set(I.getAttribute("position").array,j*3),J.normals.set(I.getAttribute("normal").array,j*3),J.uvs.set(I.getAttribute("uv").array,j*2);let W=F.length;F.push(...I.getIndex().array.map(Y=>Y+j)),this.setAttribute("position",new vi(J.positions,3)),this.setAttribute("normal",new vi(J.normals,3)),this.setAttribute("uv",new vi(J.uvs,2)),this.setIndex(F);let ne=iNe;ne.copy(c[c.length-1]).setPosition(l[l.length-1]),this.applyMatrix4OnRange(ne,j,V),ne.copy(c[0]).setPosition(l[0]).multiply(nNe.makeScale(1,1,-1)),this.applyMatrix4OnRange(ne,j-T,j),this.reverseIndicesOnRange(X,W)}else this.setAttribute("position",new vi(J.positions,3)),this.setAttribute("normal",new vi(J.normals,3)),this.setAttribute("uv",new vi(J.uvs,2)),this.setIndex(F)}_extractPathPoints(){let e=eee(this.inputs.path).getPoints(this.inputs.path.subdivisions);if(e.length<2)return[];let t=[e[0]];return e.forEach(i=>{t[t.length-1].distanceToSquared(i)>.001&&t.push(i)}),this.inputs.path.isClosed&&t[t.length-1].distanceTo(t[0])<.001&&t.pop(),t}_computeBasisMatrices(e){let t=[],i=e.length,n=this.inputs.path.isClosed,r=new G,s=new G,a=new G,o=new G,l=new G(0,1,0);for(let g=0;g<i;g++){let x=e[g],y;g===0?y=n?e[e.length-2]:x.clone().multiplyScalar(2).sub(e[1]):y=e[g-1];let b;g===i-1?b=n?e[1]:x.clone().multiplyScalar(2).sub(e[g-1]):b=e[g+1];let A=x.clone().sub(y).normalize(),w=b.clone().sub(x).normalize(),E=A.clone().add(w).normalize();a.copy(E),g===0&&(E.equals(l)||E.clone().negate().equals(l))&&l.set(0,0,1);let D=l.clone().cross(E).normalize(),T=E.clone().cross(D).normalize();l.copy(T),o.copy(D),g===0&&(r.copy(T),s.copy(E));let I=new Bt().makeBasis(D,T,E);t.push(I)}let c=n?s:a,u=n?r:new G(0,1,0),h=c.clone().cross(o).normalize(),d=Math.acos(u.dot(h));if(isNaN(d))return t;let p=u.clone().cross(h);c.dot(p)>0&&(d*=-1);for(let g=1;g<t.length;g++){let x=new Bt().makeRotationZ(d*g/t.length);t[g].multiply(x)}return t}_applyPathModifiers(e,t,i){let n=e.length,{angle:r,twist:s,startScale:a,endScale:o}=this.inputs.parameters.extrusion,l=new Bt,c=new Bt;return e.forEach((u,h)=>{let d=h===0?0:h===n-1?1:(h-t)/(n-(i===0?0:1)-(t+(1-i)));l.makeRotationZ(qt.lerp(r,r+s,d)*qt.DEG2RAD);let p=qt.lerp(a,o,d);c.makeScale(p,p,p),u.multiply(l).multiply(c)}),e}_computeShapePoints(e=12,t=$n.ODD){let i=this.inputs.shapeData,n=i.extractShapePointsToFlatArray([],e),r=i.shapeHoles.map(c=>{let u=c.extractShapePointsToFlatArray([],e),h=[];for(let d=u.length-1;d>=1;d-=2){let p=u[d-1],g=u[d-0];h.push(p,g)}return h}),s;try{s=Gm({windingRule:t,elementType:Ts.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[n]})}catch{s=w5}let a;try{a=Gm({windingRule:$n.ODD,elementType:Ts.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...r]})}catch{a=cee}if(!s)throw new Error("error generating geometry");let o=s.elementCount;if(a){s.elementCount+=a.elementCount;for(let c=0;c<a.elements.length;c++){let u=a.elements[c],h=c%2===0?s.vertexCount:0;s.elements.push(u+h)}for(let c=0;c<a.vertexIndices.length;c++){let u=a.vertexIndices[c],h=s.vertexCount;s.vertexIndices.push(u+h)}for(let c=0;c<a.vertices.length;c++){let u=a.vertices[c];s.vertices.push(u)}}for(let c=0,u=s.vertexCount;c<u;c++){let h=c*2;s.vertices[h+0],s.vertices[h+1]}let l=[];for(let c=s.elementCount-1;c>=0;c--){let u=c>=o,h=c*2,d=s.elements[h+0],p=s.elements[h+1],g=d+p,x={start:d,count:p,normals:[],isHole:u,continuous:[],verticesStart:0,verticesCount:0};l.push(x);let y=d,b=g-1,A=d+1,w=i.roundedCurves.length;do{let E=y-d;s.vertices[b*2+0],s.vertices[b*2+1];let D=s.vertices[y*2+0],T=s.vertices[y*2+1],I=s.vertices[A*2+0],R=s.vertices[A*2+1],O=D-I,P=T-R,U=Math.sqrt(O*O+P*P);O/=U,P/=U,x.normals[E*2+0]=-P,x.normals[E*2+1]=O;let H=s.vertexIndices[y];if(Array.isArray(H))x.continuous[E]=!1;else{let[V,j]=i.getCurveIndexFromVertexId(H-1,!0);if(j>0&&j<1)x.continuous[E]=!0;else{let J=j===1?V+1:V-1;J=(J+w)%w;let F=j===1?0:1,X=i.roundedCurves[V].getTangent(j),W=i.roundedCurves[J].getTangent(F);x.continuous[E]=X.dot(W)>.95}}u&&(x.normals[E*2+0]*=-1,x.normals[E*2+1]*=-1),[b,y,A]=[y,A,A+1],A>=g&&(A-=p)}while(A!==d+1)}return{regions:[n,...r],infos:l,vertices:s.vertices}}_insertVertex(e,t,i,n,r){let s=t*2,a=t*3;e.positions[a+0]=i.x,e.positions[a+1]=i.y,e.positions[a+2]=i.z,e.normals[a+0]=n.x,e.normals[a+1]=n.y,e.normals[a+2]=n.z,e.uvs[s+0]=r.x,e.uvs[s+1]=r.y}_extrudeRegion(e,t,i,n,r,s,a){let o=new G,l=new G,c=new G,u=new G,h=new Ae;i.forEach((p,g)=>{let x=n[g],y=e.verticesStart*i.length+e.verticesCount*g;for(let b=0;b<e.count;b++){let A=(e.start+b)*2;if(o.set(t[A+0],t[A+1],0),c.copy(o).applyMatrix4(p).add(x),e.continuous[b])u.set(e.normals[b*2+0],e.normals[b*2+1],0);else{let w=b===0?(e.start+e.count-1)*2:A-2;l.set(t[w+0],t[w+1],0),u.copy(o).sub(l),u.set(-u.y,u.x,0),e.isHole||u.negate()}if(u.applyMatrix4(p).normalize(),h.set(b===0?1:b/e.count,g/(i.length-1)),this._insertVertex(r,y,c,u,h),y++,!e.continuous[b]||b===0){if(b===0)u.set(e.normals[b*2+0],e.normals[b*2+1],0),h.set(0,g/(i.length-1));else{let w=b===e.count-1?e.start*2:A+2;l.set(t[w+0],t[w+1],0),u.copy(l).sub(o),u.set(-u.y,u.x,0),e.isHole||u.negate()}u.applyMatrix4(p).normalize(),this._insertVertex(r,y,c,u,h),y++}}});let d=i.length-1;for(let p=0;p<d;p++){let g=e.verticesStart*i.length+e.verticesCount*p,x=e.verticesStart*i.length+e.verticesCount*(p+1),y=0;for(let b=0;b<e.count;b++){(!e.continuous[b]||b===0)&&y++;let A=b===e.count-1?0:y+1,w=g+y,E=g+A,D=x+A,T=x+y;e.isHole?s.push(w,D,E,w,T,D):s.push(w,E,D,w,D,T),y++}}}_closeEnd(e,t,i,n,r,s,a){let o=e.vertexCount,l=new G(0,0,a?-1:1).applyMatrix4(r),c=new G,u=new Ae;for(let d=0;d<o;d++){let p=2*d;c.set(e.vertices[p+0],e.vertices[p+1],0).applyMatrix4(r).add(s),this._insertVertex(n,t+d,c,l,u)}let h=e.elements;for(let d=0;d<e.elementCount;d++){let p=3*d,g=h[p+0]+t,x=h[p+(a?1:2)]+t,y=h[p+(a?2:1)]+t;i.push(g,x,y)}}applyMatrix4OnRange(e,t,i){let n=e.elements,r=new Cs().getNormalMatrix(e).elements,s,a,o,l,c=this.attributes.position,u=this.attributes.normal;if(!c||!u)return;let h=c.array,d=u.array,p=c.itemSize;for(let g=t*p,x=i*p;g<x;g+=p){if(g===t)debugger;s=h[g+0],a=h[g+1],o=h[g+2],l=1/(n[3]*s+n[7]*a+n[11]*o+n[15]),h[g+0]=(n[0]*s+n[4]*a+n[8]*o+n[12])*l,h[g+1]=(n[1]*s+n[5]*a+n[9]*o+n[13])*l,h[g+2]=(n[2]*s+n[6]*a+n[10]*o+n[14])*l,s=d[g+0],a=d[g+1],o=d[g+2],d[g+0]=r[0]*s+r[3]*a+r[6]*o,d[g+1]=r[1]*s+r[4]*a+r[7]*o,d[g+2]=r[2]*s+r[5]*a+r[8]*o}c.needsUpdate=!0,u.needsUpdate=!0}reverseIndicesOnRange(e,t){let i=this.index;if(i){for(let n=e;n<t;n+=3){let r=i.getX(n),s=i.getX(n+1),a=i.getX(n+2);i.setXYZ(n,a,s,r)}i.needsUpdate=!0}}};function wee(){let e=new ii;return e.setAttribute("position",new vi(new Float32Array([]),3)),e.setIndex(new vi(new Uint16Array([]),1)),e}var oNe=wee().attributes,lNe=12,cNe=1,nz=class extends ii{constructor(e,t){super(),this.charWidths=[],this.charCoords=[],this.wrappedText=[],this.isLowResolution=!1,this.vectorShapes=[],Object.assign(this.attributes,oNe),this.userData={parameters:e,type:"TextGeometry"};let i=t.getFont(e.font);i!=null&&i.isLoaded?(this.font=i,this.update(e)):this.updateFont(e.font,t).then(()=>{this.update(e),t==null||t.requestRender()})}async updateFont(e,t){let i=t.getFont(e);i&&(this.font=i,await i.loadingPromise)}update(e){let t=this.font;if(this.userData={parameters:e,type:"TextGeometry"},!(t!=null&&t.isLoaded)){console.warn("Cannot update text because its font is not loaded");return}let{width:i,height:n,depth:r,extrudeBevelSize:s,extrudeBevelSegments:a,text:o,textTransform:l}=e,c=Xa.getDisplayedValue(o),u=l===2?c.toUpperCase():l===3?c.toLowerCase():c,h=uNe(e,t,u),{shapes:d,charWidths:p,charCoords:g}=t.generateShapes(h,e),x=(typeof i=="number"?i:1)*.5,y=(typeof n=="number"?n:1)*.5,b=d.map(E=>new $r().fromShape(E,!0));this.vectorShapes=b;let A=b.map(E=>J0.create({shape:E,parameters:{depth:r,extrudeBevelSegments:a,extrudeBevelSize:s,windingRule:r<=0?$n.NONZERO:$n.ODD,subdivisions:this.isLowResolution&&r>0?cNe:lNe}})),w=A.length?u0(A):wee();w.translate(-x,y,0),this.dispose(),this.wrappedText=h,this.charCoords=g,this.charWidths=p,this.deleteAttribute("extrudeNormal"),Object.entries(w.attributes).forEach(([E,D])=>{this.setAttribute(E,D)}),this.setIndex(w.index),this.computeBoundingSphere()}clone(){let e=$c(new ii,nz.prototype);return e.copy(this),console.log("CloneGeometry",this,e),e}copy(e){return Object.entries(e.attributes).forEach(([t,i])=>{this.setAttribute(t,i)}),this.setIndex(e.index),this.userData={parameters:{...e.userData.parameters},type:"TextGeometry"},this}async setText(e){this.font&&await this.font.loadingPromise,await this.update({...this.userData.parameters,text:{textValue:e}})}get text(){return this.userData.parameters.text??""}};function uNe(e,t,i){let n=[""],r="";for(let s of i)r+=s,s===" "||s===`
`?(n[n.length-1]+=r,r="",s===`
`&&n.push("")):t.getTextWidth(n[n.length-1]+r,e)>e.width&&(n[n.length-1].length&&n.push(""),t.getTextWidth(n[n.length-1]+r,e)>e.width&&(r.length===1?(n[n.length-1]+=r,r=""):(n[n.length-1]+=r.slice(0,-1),r=r[r.length-1],n.push(""))));return n[n.length-1]+=r,n}var Mee,Eee=new Promise(e=>{Mee=e}),LW=!1,YT;function hNe(){if(LW)return;if(YT)return YT;async function e(){let t="https://unpkg.com/@splinetool/modelling-wasm@1.10.2/build",i=dg(()=>import("./process-DLQUZ-E7.js"),[]),[n,r]=await Promise.all([i,fetch(`${t}/process.wasm`).then(o=>o.arrayBuffer())]),s=n.default,a=await s({wasmBinary:r});Mee(a),LW=!0}return YT=e(),YT}var dNe=["font"];function Bw(e,t,i,n){var c,u;let r,s,a;e.type==="PathGeometry"?(s=JSON.parse(JSON.stringify(e)),a=[[],["extrusion"]]):(s={...e},a=[[]]);for(let h of a){let d=s;for(let p of h)d=d[p];for(r in d){let p=d[r];z9(p)&&!dNe.includes(r)&&(d[r]=t.getVariable(p,[n.uuid,"geometry",...h,r]),z9(d[r])&&(d[r]=1))}}let o={parameters:s,type:s.type};if(s.type==="PathGeometry")o.path=s.path;else if(s.type==="VectorGeometry"){let h=$r.createFromState(s.shape,s.width,s.height);o.shape=h}else if(s.type==="NonParametricGeometry"){if(s.data.groups&&((c=s.data.groups)==null||c.forEach(h=>h.materialIndex=Math.max(h.materialIndex??0,0))),o.geometry=new wZ().parse(s),o.geometry.groups.length===0){let h=o.geometry;h.addGroup(0,Math.max(((u=h.getIndex())==null?void 0:u.count)??0,h.getAttribute("position").count),0)}}else if(s.type==="SubdivGeometry"){let h=new qo(s,i);return h.data=e,h}else{if(s.type==="TextGeometry")return new nz(s,t);if(s.type==="InputGeometry")return new nz(s,t);if(s.type==="UIGeometry")return T5.create({parameters:{width:s.width,height:s.height,cornerRadius:s.cornerRadius,cornerType:s.cornerType}})}let l;try{l=VW(o)}catch(h){console.error(h)}if(!l){let h=$r.createFromState(M3.defaultData(),100,100);o.shape=h,l=VW(o)}return l}var fNe=new Bt;function rz(e,t,i,n){let r=e.position.array,s=e.normal.array,a=fNe.makeScale(t,i,n).invert().elements,o,l,c;for(var u=0,h=r.length;u<h;u+=3)r[u]*=t,r[u+1]*=i,r[u+2]*=n,o=s[u],l=s[u+1],c=s[u+2],s[u]=a[0]*o+a[4]*l+a[8]*c,s[u+1]=a[1]*o+a[5]*l+a[9]*c,s[u+2]=a[2]*o+a[6]*l+a[10]*c;e.position.needsUpdate=!0,e.normal.needsUpdate=!0}var QT=new ps,Gx=new G,yi;Eee.then(e=>{yi=e});var UW=new Float32Array([10,10,0,-10,10,0,-10,-10,0,10,-10,0]),NW=new Uint32Array([0,1,2,3]),zW=new Uint8Array([4]),qo=class extends ii{constructor(e,t){super(),this.data=e,this.flatShading=t,this.subdivPointer=0,this.rebuild(),this.freeSubdivPointer()}mutateDirectlyScaleBaked(e,t){this.freeSubdivPointer();let i=this.data.scaleBaked,n=A0.div(t,i);this.subdividedGeometry&&rz(this.subdividedGeometry.attributes,...n),this.originalGeometry&&rz(this.originalGeometry.attributes,...n),this.data=e;let r=this.userData.parameters;this.userData.parameters={width:r.width*n[0],height:r.height*n[1],depth:r.depth*n[2]},this.originalGeometry.boundingSphere.center.multiply(Gx.fromArray(n));let s=Gx.set(r.width,r.height,r.depth).length();this.originalGeometry.boundingSphere.radius=s/2}ensureSubdivPointer(){return this.subdivPointer===0&&this.rebuild(),this.subdivPointer}rebuild(){let e,t,i;try{({originalGeometry:e,subdividedGeometry:t,subdivPointer:i}=qo.build(this.data,void 0,!this.flatShading,void 0))}catch{e=new eh(100,100,100),i=0}this.subdivPointer=i,this.originalGeometry=e,this.subdividedGeometry=t??void 0;let n=this.subdividedGeometry??this.originalGeometry;Object.assign(this,n),this.calcBoundingBox()}freeSubdivPointer(){this.subdivPointer&&(qo.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0)}dispose(){super.dispose(),this.freeSubdivPointer()}calcBoundingBox(){let e=this.originalGeometry;e.boundingSphere===null&&(e.boundingSphere=new Ol,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=e.boundingSphere));let t=e.attributes.position,i=e.boundingSphere.center;QT.setFromBufferAttribute(t),QT.getCenter(i),e.boundingSphere.radius=i.distanceTo(QT.max),isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),QT.getSize(Gx);let n={width:Gx.x,height:Gx.y,depth:Gx.z};return this.userData.parameters=n,n}static build(e,t,i,n){let r,s,a,o=(e==null?void 0:e.phongAngle)??35;i===!1&&(o=-1),t&&(yi.free_bvh(t),yi.free_subdivision_surface(t));try{r=qo.allocate(e,n)}catch(l){console.error(l,e),r=qo.allocate({positionWASM:UW,indexWASM:NW,verticesPerFaceWASM:zW},n)}if(yi.set_destination_refinement_level(r,0),s=qo.buildLevel(r,!0,o),e.subdivisions>0)try{yi.set_destination_refinement_level(r,e.subdivisions),a=qo.buildLevel(r,!1,o)}catch{try{yi.set_destination_refinement_level(r,e.subdivisions-1),a=qo.buildLevel(r,!1,o)}catch{a=null}}else a=null;return{subdivPointer:r,originalGeometry:s,subdividedGeometry:a}}static primitiveToQuads(e,t,i){e.widthSegments>16&&(e.widthSegments=16),e.heightSegments>16&&(e.heightSegments=16),e.depthSegments>16&&(e.depthSegments=16),e.radialSegments>16&&(e.radialSegments=16),e.type==="DodecahedronGeometry"&&(e.detail=0);let n=e.shape!==void 0||e.path!==void 0?t.geometry:Bw(e,i,!1),r;e.type==="TorusGeometry"&&e.arc===Math.PI*2?r=n.getClosedTorusIndicesForBooleanOrSubdiv():r=n.getIndex();let s,a,o,l;({positions:s,triIndices:l}=lP(n.getAttribute("position"),r));let c;if(e.type==="CylinderGeometry"&&e.cornerRadius===0&&e.hollow===0&&e.openEnded===!1){let u=e.radialSegments*e.heightSegments*3*2,h=u+e.radialSegments*3;c=[u,h]}return{indices:a,verticesPerFace:o}=Tee(s,l,n,c),{positions:s,indices:a,verticesPerFace:o}}static allocate(e,t){var w;let i,n,r,s=[],a=[];e.positionWASM&&e.positionWASM.length>0?(i=e.positionWASM,n=e.indexWASM,r=e.verticesPerFaceWASM):(i=UW,n=NW,r=zW);let o=i.length,l=n.length,c=r.length,u=i.length+s.length+a.length,h=n.length+r.length,d=u*Float32Array.BYTES_PER_ELEMENT+h*Uint32Array.BYTES_PER_ELEMENT,p=u*Float32Array.BYTES_PER_ELEMENT,g=yi._malloc(d),x=new Float32Array(yi.HEAPF32.buffer,g,u),y=new Uint32Array(yi.HEAPU32.buffer,g+p,h);x.set(i,0),x.set(s,i.length),x.set(a,i.length+s.length),y.set(n,0),y.set(r,n.length);let b;(w=e==null?void 0:e.scaleBaked)!=null&&w.some(E=>E!==1)&&(b=new Bt().makeScale(...e.scaleBaked)),t&&(b?b.premultiply(t):b=t);let A=b?yi.alloc_subdivision_surface2(g,o,g+p,l,g+p+n.length*Uint32Array.BYTES_PER_ELEMENT,c,b.elements):yi.alloc_subdivision_surface(g,o,g+p,l,g+p+n.length*Uint32Array.BYTES_PER_ELEMENT,c);return yi._free(g),A}static buildLevel(e,t,i,n,r){let s=r?yi.get_mesh_data2(e,t?yi.Level.CONTROL:yi.Level.REFINED,i,r.elements):yi.get_mesh_data(e,t?yi.Level.CONTROL:yi.Level.REFINED,i),a=8,o=yi.HEAPU32.subarray(s>>2,(s>>2)+a),l=o.subarray(4,8),c=0,u=yi.HEAPU32[o[c]>>2],h=yi.HEAPF32.subarray(u>>2,(u>>2)+l[c]);c++;let d=yi.HEAPU32[o[c]>>2],p=yi.HEAPF32.subarray(d>>2,(d>>2)+l[c]);c++;let g=yi.HEAPU32[o[c]>>2],x=yi.HEAPU32.subarray(g>>2,(g>>2)+l[c]);c++;let y=yi.HEAPU32[o[c]>>2],b=yi.HEAPU32.subarray(y>>2,(y>>2)+l[c]);if(c++,n===void 0){let A=new ii;if(A.setIndex(new M1(b,1)),A.setAttribute("position",new Gt(h,3)),A.setAttribute("normal",new Gt(p,3)),t){A.setAttribute("faceMap",new M1(x,1));let w=new Float32Array(p.length/3*4).fill(0);A.setAttribute("color",new vi(w,4))}return yi.free_mesh_data(s),A.userData.type="SubdivGeometry",A}n.getAttribute("position").copyArray(h),n.getAttribute("normal").copyArray(p),n.attributes.position.needsUpdate=!0,n.attributes.normal.needsUpdate=!0,yi.free_mesh_data(s)}static freeSubdivPointer(e){yi.free_bvh(e),yi.free_subdivision_surface(e)}static buildControlCageWireframe(e,t,i){let n=yi.get_wireframe_data_for_base_level(e),r=4,s=yi.HEAPU32.subarray(n>>2,(n>>2)+r),a=s.subarray(2,4),o=0,l=yi.HEAPU32[s[o]>>2],c=yi.HEAPF32.subarray(l>>2,(l>>2)+a[o]);o++;let u=yi.HEAPU32[s[o]>>2],h=yi.HEAPU32.subarray(u>>2,(u>>2)+a[o]);if(t===void 0){let d=new ii;d.setAttribute("position",new Gt(c,3));let p=new Float32Array(c.length);for(let g=0,x=c.length;g<x;)p[g++]=i.r,p[g++]=i.g,p[g++]=i.b;return d.setAttribute("color",new vi(p,3)),d.setIndex(new M1(h,1)),yi.free_wireframe_data_for_base_level(n),d}t.getAttribute("position").copyArray(c),t.attributes.position.needsUpdate=!0,yi.free_wireframe_data_for_base_level(n)}static updateCollabMesh(e,t,i){let n=t===0;n||yi.set_destination_refinement_level(e,t);let r=i?yi.get_topological_data2(e,n?yi.Level.CONTROL:yi.Level.REFINED,i.elements):yi.get_topological_data(e,n?yi.Level.CONTROL:yi.Level.REFINED),s=6,a=yi.HEAPU32.subarray(r>>2,(r>>2)+s),o=a.subarray(3,6),l=0,c=yi.HEAPU32[a[l]>>2],u=new Float32Array(yi.HEAPF32.subarray(c>>2,(c>>2)+o[l]));l++;let h=yi.HEAPU32[a[l]>>2],d=new Uint32Array(yi.HEAPU32.subarray(h>>2,(h>>2)+o[l]));l++;let p=yi.HEAPU32[a[l]>>2],g=new Uint8Array(yi.HEAPU32.subarray(p>>2,(p>>2)+o[l]));return yi.free_topological_data(r),{positions:u,indices:d,verticesPerFace:g}}},FW=["getX","getY","getZ"];function lP(e,t){let i={},n=t?t.count:e.count,r=0,s=[],a=[],o=1e4;for(let c=0;c<n;c++){let u=t?t.getX(c):c,h="";for(let d=0;d<3;d++)h+=`${~~(e[FW[d]](u)*o)},`;if(h in i)s.push(i[h]);else{for(let d=0;d<3;d++)a.push(e[FW[d]](u));i[h]=r,s.push(r),r++}}let l=[];for(let c=0;c<s.length;c+=3)s[c]===s[c+1]||s[c]===s[c+2]||s[c+1]===s[c+2]||l.push(s[c],s[c+1],s[c+2]);return{positions:a,triIndices:l}}var KT=new G,WI=new G,XI=new G,qI=new G;function Tee(e,t,i,n){let r=[],s=[];if(i.userData.shape!==void 0&&i.userData.parameters.depth===0&&i.userData.shape.shapeHoles.length===0){let l=i.userData.shape.extractShapePointsToFlatArray([]),c=i.userData.parameters.spikes;if(i.userData.type==="EllipseGeometry"&&c<=24&&c%4===0&&i.userData.parameters.angle>=360){let d=l.length/2/c;l=l.filter((p,g)=>Math.floor(g/2)%d===0)}let u=0;for(let d=0;d<l.length;d+=2)u+=(l[d]-l[(d===0?l.length:d)-2])*(l[d+1]+l[(d===0?l.length:d)-1]);e.length=0;let h=0;if(u<0)for(let d=0;d<l.length;d+=2)e.push(l[d],l[d+1],0),r.push(h++);else for(let d=l.length-2;d>=0;d-=2)e.push(l[d],l[d+1],0),r.push(h++);return s.push(h),{indices:r,verticesPerFace:s}}let a=new Float32Array([i.userData.parameters.depth])[0],o=0;for(;o<t.length;){if(i.useNgonForTopBottomFaceDuringBake){let l=0;if((e[t[o]*3+2]===a||e[t[o]*3+2]===0)&&l++,(e[t[o+1]*3+2]===a||e[t[o+1]*3+2]===0)&&l++,(e[t[o+2]*3+2]===a||e[t[o+2]*3+2]===0)&&l++,l===3)break}if(t[o+1]===t[o+3]&&t[o+2]===t[o+5]||t[o+0]===t[o+3]&&t[o+2]===t[o+4]){KT.set(e[t[o]*3],e[t[o]*3+1],e[t[o]*3+2]),WI.set(e[t[o+1]*3],e[t[o+1]*3+1],e[t[o+1]*3+2]),XI.set(e[t[o+4]*3],e[t[o+4]*3+1],e[t[o+4]*3+2]),qI.set(e[t[o+5]*3],e[t[o+5]*3+1],e[t[o+5]*3+2]),WI.sub(KT).normalize(),XI.sub(KT).normalize(),qI.sub(KT).normalize();let l=WI.cross(XI).dot(qI);Math.abs(l)>.005||n&&n.some((c,u)=>u%2===1?!1:o>=n[u]&&o<n[u+1])?(r.push(t[o],t[o+1],t[o+2]),s.push(3),o+=3):(r.push(t[o],t[o+1],t[o+4],t[o+5]),s.push(4),o+=6)}else r.push(t[o],t[o+1],t[o+2]),s.push(3),o+=3}if(i.useNgonForTopBottomFaceDuringBake){let l=[],c=[],u=0;for(let h=0,d=0;h<e.length;h+=3,d++)e[h+2]===0&&(l.push(d),u++),e[h+2]===a&&c.push(d);if(i.userData.parameters.extrudeBevelSize===0){let h=c[0];c[0]=c[1],c[1]=h}l.reverse(),r.push(...l,...c),s.push(u,u)}return{indices:r,verticesPerFace:s}}var wf={};a1e(wf,{calcBoolean:()=>yNe,calcBooleanTopological:()=>vNe,freeMeshSet:()=>_Ne,getMeshSet:()=>xNe,hasOpenEdges:()=>bNe,transformMeshSet:()=>SNe});var Cee,pNe=new Promise(e=>{Cee=e}),JT;function mNe(){if(JT)return JT;async function e(){let t="https://unpkg.com/@splinetool/boolean-wasm@1.10.2/build",i=dg(()=>import("./boolean-CynEgfvK.js"),[]),[n,r]=await Promise.all([i,fetch(`${t}/boolean.wasm`).then(o=>o.arrayBuffer())]),s=n.default,a=await s({wasmBinary:r});Cee(a)}return JT=e(),JT}var hn,O1;pNe.then(e=>hn=e);function gNe(e,t,i){let n,r;e.userData.parameters.type==="TorusGeometry"&&e.userData.parameters.arc===Math.PI*2?r=e.getClosedTorusIndicesForBooleanOrSubdiv():r=e.getIndex();let{positions:s,triIndices:a}=lP(e.getAttribute("position"),r),o;if(t&&i){let{indices:l,verticesPerFace:c}=Tee(s,a,e);o=c.length,n=[];for(let u=0,h=0;u<o;u++){n.push(c[u]);for(let d=0;d<c[u];d++)n.push(l[h++])}}else{let l=a.length;n=Array(l+l/3),o=0;for(let c=0,u=0;u<n.length;)n[u++]=3,o++,n[u++]=a[c++],n[u++]=a[c++],n[u++]=a[c++]}return{positions:s,faceIndices:n,nFaces:o}}function Dee(e){let t=e.length,i=t*Uint32Array.BYTES_PER_ELEMENT,n=t*Float32Array.BYTES_PER_ELEMENT,r=Number.isInteger(e[0])?i:n,s=hn._malloc(r);return(Number.isInteger(e[0])?new Uint32Array(hn.HEAPU32.buffer,s,t):new Float32Array(hn.HEAPF32.buffer,s,t)).set(e,0),s}function Ree(e){switch(e){case 0:return hn.OP.UNION;case 1:return hn.OP.INTERSECTION;case 2:return hn.OP.A_MINUS_B;default:throw new Error("Unknown boolean operation "+e)}}function vNe(e,t){O1===void 0&&(O1=hn.init_csg());let i=Dee(e),n=hn.csg_calc_topological(O1,i,e.length,Ree(t));hn._free(i);let r=6,s=hn.HEAPU32.subarray(n>>2,(n>>2)+r),a=s.subarray(3,6),o=0,l=hn.HEAPU32[s[o]>>2],c=new Float32Array(hn.HEAPF32.subarray(l>>2,(l>>2)+a[o]));o++;let u=hn.HEAPU32[s[o]>>2],h=new Uint32Array(hn.HEAPU32.subarray(u>>2,(u>>2)+a[o]));o++;let d=hn.HEAPU32[s[o]>>2],p=new Uint8Array(hn.HEAPU32.subarray(d>>2,(d>>2)+a[o]));return hn.free_mesh_data(n),{positions:c,indices:h,verticesPerFace:p}}function yNe(e,t,i,n){O1===void 0&&(O1=hn.init_csg());let r=Dee(e),s=hn.csg_calc(O1,r,e.length,n,Ree(t));hn._free(r);let a=5,o=hn.HEAPU32.subarray(s>>2,(s>>2)+a),l=o.subarray(2,5),c=0,u=hn.HEAPU32[o[c]>>2],h=hn.HEAPF32.subarray(u>>2,(u>>2)+l[c]);c++;let d=hn.HEAPU32[o[c]>>2],p=hn.HEAPF32.subarray(d>>2,(d>>2)+l[c]);c++;let g=l[c];i.setAttribute("position",new Gt(h,3)),i.setAttribute("normal",new Gt(p,3));let x=hn.HEAPF32.subarray((s>>2)+5,(s>>2)+5+6);return i.boundingSphere===null&&(i.boundingSphere=new Ol),i.boundingSphere.center.set(x[0],x[1],x[2]),i.boundingSphere.radius=(x[3]**2+x[4]**2+x[5]**2)**.5,i.userData.parameters={width:x[3]*2,height:x[4]*2,depth:x[5]*2},hn.free_mesh_data(s),g}function xNe(e,t,i){if(hn===void 0)return-1;let n,r,s;if(t&&e.userData.positions!==void 0){let y=e.userData;s=y.verticesPerFace.length,n=y.positions,r=Array(y.verticesPerFace.reduce((b,A)=>b+A,0)+s);for(let b=0,A=0,w=0;b<y.verticesPerFace.length;b++){r[w++]=y.verticesPerFace[b];for(let E=0;E<y.verticesPerFace[b];E++)r[w++]=y.indices[A++]}}else({positions:n,faceIndices:r,nFaces:s}=gNe(e,t,i));let a=n.length,o=r.length,l=n.length,c=r.length,u=l*Float32Array.BYTES_PER_ELEMENT+c*Uint32Array.BYTES_PER_ELEMENT,h=l*Float32Array.BYTES_PER_ELEMENT,d=hn._malloc(u),p=new Float32Array(hn.HEAPF32.buffer,d,l),g=new Uint32Array(hn.HEAPU32.buffer,d+h,c);p.set(n,0),g.set(r,0);let x=hn.get_csg_mesh(d,a,d+h,o,s);return hn._free(d),x}function bNe(e){return hn.has_open_edges(e)}function SNe(e,t){hn.transform_csg_mesh(e,t.elements)}function _Ne(e){hn.free_csg_mesh(e)}var ANe={ConeGeometry:MLe,CubeGeometry:ELe,CylinderGeometry:tee,DodecahedronGeometry:CLe,EllipseGeometry:E5,HelixGeometry:uUe,IcosahedronGeometry:hUe,LatheGeometry:dUe,NonParametricGeometry:xUe,PolygonGeometry:xee,PyramidGeometry:bUe,RectangleGeometry:T5,SphereGeometry:AUe,PlaneGeometry:wUe,BackdropGeometry:MUe,StarGeometry:bee,TextFrameGeometry:TUe,TorusGeometry:CUe,TorusKnotGeometry:RUe,TriangleGeometry:PUe,PathGeometry:sNe,VectorGeometry:J0},VW=e=>ANe[e.type].create(e);function kx(e){return e!==null&&"booleanOp"in e}var Pee=class extends b5(fr){constructor(){super(...arguments),this.booleanMeshSetAddress=-1,this.booleanWasTransformed=!1,this.booleanMatrixInvOld=new Bt}updateVisible(e){super.updateVisible(e),this.visible=!kx(this.parent)&&this.visible,kx(this.parent)&&this.parent.invalidateDownstreamBooleanData()}freeBooleanPointer(){this.booleanMeshSetAddress!==-1&&(wf.freeMeshSet(this.booleanMeshSetAddress),this.booleanMeshSetAddress=-1)}invalidateDownstreamBooleanData(e=!1){return e?this.booleanWasTransformed=!0:this.freeBooleanPointer(),kx(this.parent)?this.parent.invalidateDownstreamBooleanData():this}invalidateUpstreamBooleanData(){this.freeBooleanPointer();for(let e of this.children)e instanceof Pee&&(e.freeBooleanPointer(),kx(e)&&e.invalidateUpstreamBooleanData())}updateTransformState(e,t){let i=super.updateTransformState(e,t);return i&&kx(this.parent)&&this.invalidateDownstreamBooleanData(!0),i}onVariableUpdate(e=!1){super.onVariableUpdate(e),kx(this.parent)&&this.invalidateDownstreamBooleanData(!0)}},ZT=new ps;function C5(e,t=0,i=e.count,n,r){let s=1/0,a=1/0,o=1/0,l=-1/0,c=-1/0,u=-1/0;for(let h=t;h<i;h++){let d=e.getX(h),p=e.getY(h),g=e.getZ(h);d<s&&(s=d),p<a&&(a=p),g<o&&(o=g),d>l&&(l=d),p>c&&(c=p),g>u&&(u=g)}ZT.min.set(s,a,o),ZT.max.set(l,c,u),ZT.getCenter(n),ZT.getSize(r).multiplyScalar(.5)}var wNe=new ii,MNe=new np,nl=class extends Pee{constructor(e,t){super(wNe,MNe),this.super_Entity(e,t)}updateState(e,t){this.updateState_Entity(e,t)}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");i!==void 0?C5(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},Tm=class{constructor(e){if(this.hashProperties=void 0,this.isNode=!0,this.shortcuts={},Tm.uuidContext===null)throw new Error("plz startContext");Tm.uuidContext===Tm.globalContext?this.uuid="_gid"+Tm.uuidContext.nodeContextUuid++:this.uuid="_uid"+Tm.uuidContext.nodeContextUuid++,this.type=e,this.name=""}static startContext(e){this.uuidContext===null||this.uuidContext===Tm.globalContext?this.uuidContext=e:console.error("Can't start context twice")}static endContext(e){this.uuidContext!==e&&console.error("Can't end context twice"),this.uuidContext=null}analyze(e,t){t=t??{},e.analyzing=!0,this.build(e.addFlow(t.slot,t.cache,t.context),"v4"),e.clearVertexNodeCode(),e.clearFragmentNodeCode(),e.removeFlow(),e.analyzing=!1}analyzeAndFlow(e,t,i){return i=i??{},this.analyze(e,i),this.flow(e,t,i)}flow(e,t,i){i=i??{},e.addFlow(i.slot,i.cache,i.context);let n={result:this.build(e,t),code:e.clearNodeCode(),extra:e.context.extra};return e.removeFlow(),n}build(e,t,i){t=t??this.getType(e,t);let n=e.getNodeData(i??this);return e.analyzing&&this.appendDepsNode(e,n,t),e.nodes.indexOf(this)===-1&&e.nodes.push(this),this.updateFrame!==void 0&&e.updaters.indexOf(this)===-1&&e.updaters.push(this),this.generate(e,t,i)}updateFrame(e){}generateReadonly(e,t,i,n,r,s){return""}generate(e,t,i,n,r){return""}parse(e,t,i,n){}appendDepsNode(e,t,i){t.deps=(t.deps||0)+1;let n=e.getTypeLength(i);(n>(t.outputMax||0)||this.getType(e,i))&&(t.outputMax=n,t.output=i)}setName(e){this.name=e}getName(){return this.name}getType(e,t){return t==="sampler2D"||t==="samplerCube"?t:this.type}},Xs=Tm;Xs.globalContext={nodeContextUuid:0},Xs.uuidContext=Tm.globalContext;var HW=class{constructor(e){e=e??{},this.name=e.name,this.type=e.type,this.node=e.node,this.size=e.size,this.needsUpdate=e.needsUpdate}get value(){return this.node.value}set value(e){this.node.value=e}},ENe=class{constructor(){this.nodes={},this.keywords={}}add(e){this.nodes[e.name]=e}addKeyword(e,t,i){i=i!==void 0?i:!0,this.keywords[e]={callback:t,cache:i}}remove(e){delete this.nodes[e.name]}removeKeyword(e){delete this.keywords[e]}get(e){return this.nodes[e]}getKeyword(e,t){return this.keywords[e].callback(t)}getKeywordData(e){return this.keywords[e]}contains(e){return this.nodes[e]!==void 0}containsKeyword(e){return this.keywords[e]!==void 0}},El=new ENe,tr=class extends Xs{constructor(e,t){super(e),this.scope="",t=t??{},this.shared=t.shared!==void 0?t.shared:!0,this.unique=t.unique!==void 0?t.unique:!1}build(e,t,i,n){if(t=t??this.getType(e),this.getShared(e,t)){let r=this.getUnique(e,t);r&&this.uuid===void 0&&(this.uuid=qt.generateUUID()),i=e.getUUID(i??this.getUUID(),!r);let s=e.getNodeData(i),a=s.output||this.getType(e);if(e.analyzing)return(s.deps||0)>0||this.getLabel()?(this.appendDepsNode(e,s,t),this.generate(e,t,i)):super.build(e,t,i);if(r)return s.name=s.name||super.build(e,t,i),s.name;if(!this.getLabel()&&(!this.getShared(e,a)||e.context.ignoreCache||s.deps===1))return super.build(e,t,i);i=this.getUUID(!1);let o=this.getTemp(e,i);if(o)return e.format(o,a,t);{o=super.generate(e,t,i,s.output,n);let l=this.generate(e,a,i);return e.addNodeCode(o+" = "+l+";"),e.format(o,a,t)}}return super.build(e,t,i)}getShared(e,t){return t!=="sampler2D"&&t!=="samplerCube"&&this.shared}getUnique(e,t){return this.unique}setLabel(e){return this.label=e,this}getLabel(){return this.label}getUUID(e){let t=this.uuid;return typeof this.scope=="string"&&(t=this.scope+"-"+t),t}getTemp(e,t){t=t||this.uuid;let i=e.getVars()[t];return i?i.name:void 0}generate(e,t,i,n,r){return this.getShared(e,t)||console.error("TempNode is not shared"),i=i??this.uuid,e.getTempVar(i,n??this.getType(e),r,this.getLabel()).name}},Bl=class extends tr{constructor(e,t){t=t??{},t.shared=t.shared!==void 0?t.shared:!1,super(e,t),this.readonly=!1}setReadonly(e){return this.readonly=e,this.hashProperties=this.readonly?["value"]:void 0,this}getReadonly(){return this.readonly}generate(e,t,i,n,r,s){i=e.getUUID(i??this.getUUID()),n=n??this.getType(e);let a=e.getNodeData(i);return this.getReadonly()&&this.generateReadonly!==void 0?this.generateReadonly(e,t,i,n,r,s):e.isShader("vertex")?(a.vertex||(a.vertex=e.createVertexUniform(n,this,r,s,this.getLabel())),e.format(a.vertex.name,n,t)):(a.fragment||(a.fragment=e.createFragmentUniform(n,this,r,s,this.getLabel())),e.format(a.fragment.name,n,t))}},Fa=class extends Bl{constructor(e=0,t){super("v2"),this.nodeType="Vector2",this.value=e instanceof Ae?e:new Ae(e,t)}get x(){return this.value.x}set x(e){this.value.x=e}get y(){return this.value.y}set y(e){this.value.y=e}generateReadonly(e,t,i,n,r,s){return e.format("vec2("+this.value.x+", "+this.value.y+")",n,t)}},Lc=class extends Bl{constructor(e=0,t,i){super("v3"),this.nodeType="Vector3",this.value=e instanceof G?e:new G(e,t,i)}get x(){return this.value.x}set x(e){this.value.x=e}get y(){return this.value.y}set y(e){this.value.y=e}get z(){return this.value.z}set z(e){this.value.z=e}generateReadonly(e,t,i,n,r,s){return e.format("vec3("+this.value.x+", "+this.value.y+", "+this.value.z+")",n,t)}},Qa=class extends gi{constructor(e,t,i,n){super(e,t,i),this.isColorA=!0,this.a=n}setRGBA(e,t,i,n){super.setRGB(e,t,i),this.a=n}copy(e){return super.copy(e),this.a="a"in e?e.a:1,this}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}equals(e){return super.equals(e)&&this.a===e.a}setStyle(e,t="srgb"){let i;if(e==="transparent")return this.setRGBA(0,0,0,0),this;if(i=/^((?:rgb|hsl)a?)\(([^)]*)\)/.exec(e)){let n,r=i[1],s=i[2];switch(r){case"rgb":case"rgba":if(n=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.a=r==="rgba"?parseFloat(n[4]):1,super.setStyle(e,t);break;case"hsl":case"hsla":if(n=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)%\s*,\s*(\d*\.?\d+)%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.a=r==="hsla"?parseFloat(n[4]):1,super.setStyle(e,t);break}}return super.setStyle(e,t)}get x(){return this.r}get y(){return this.g}get z(){return this.b}get w(){return this.a}set x(e){this.r=e}set y(e){this.g=e}set z(e){this.b=e}set w(e){this.a=e}},Mf=class extends Bl{constructor(e){super("v4"),this.nodeType="Vector4",this.value=e instanceof Qa?e:new Qa(e.r,e.g,e.b,e.a)}generateReadonly(e,t,i,n,r,s){return e.format("vec4("+this.value.r+", "+this.value.g+", "+this.value.b+", "+this.value.a+")",n,t)}},TNe=/^\s*([a-z_0-9]+)\s([a-z_0-9]+)\s*\((.*?)\)/i,GW=/[a-z_0-9]+/gi,Ft=class extends tr{constructor(e,t,i,n,r){super(r),this.src="",this.nodeType="Function",this.useKeywords=!0,this.includes=[],this.extensions={},this.keywords={},this.isMethod=r===void 0,this.isInterface=!1,this.parse(e,t,i,n)}getShared(e,t){return!this.isMethod}getType(e){return e.getTypeByFormat(this.type)}getInputByName(e){if(this.inputs){let t=this.inputs.length;for(;t--;)if(this.inputs[t].name===e)return this.inputs[t]}}getIncludeByName(e){if(this.includes){let t=this.includes.length;for(;t--;)if(this.includes[t].name===e)return this.includes[t]}}generate(e,t,i,n,r){let s,a=0,o=this.src;if(this.includes)for(let c=0;c<this.includes.length;c++)e.include(this.includes[c],this);for(let c in this.extensions)e.extensions[c]=!0;let l=[];for(;s=GW.exec(this.src);)l.push(s);for(let c=0;c<l.length;c++){let u=l[c],h=u[0],d=this.isMethod?!this.getInputByName(h):!0,p=h;if(this.keywords[h]||this.useKeywords&&d&&El.containsKeyword(h)){let g=this.keywords[h];if(!g){let x=El.getKeywordData(h);x.cache&&(g=e.keywords[h]),g=g||El.getKeyword(h,e),x.cache&&(e.keywords[h]=g)}p=g.build(e)}h!==p&&o[u.index+a-1]!=="."&&(o=o.substring(0,u.index+a)+p+o.substring(u.index+h.length+a),a+=p.length-h.length),this.getIncludeByName(p)===void 0&&El.contains(p)&&e.include(El.get(p))}return t==="source"?o:this.isMethod?(this.isInterface||e.include(this,void 0,o),this.name):e.format("( "+o+" )",this.getType(e),t)}parse(e,t,i,n){if(this.src=e||"",this.includes=t??[],this.extensions=i??{},this.keywords=n??{},this.isMethod){let r=TNe.exec(this.src);if(this.inputs=[],r&&r.length==4){this.type=r[1],this.name=r[2];let s=r[3].match(GW);if(s){let a=0;for(;a<s.length;){let o=s[a++],l;o==="in"||o==="out"||o==="inout"?l=s[a++]:(l=o,o="");let c=s[a++];this.inputs.push({name:c,type:l,qualifier:o})}}this.isInterface=this.src.indexOf("{")===-1}else this.type="",this.name=""}}},CNe=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i,Oee=class extends tr{constructor(e="",t){super(),this.src="",this.useDefine=!1,this.nodeType="Const",this.parse(e||Oee.PI,void 0,void 0,void 0,t)}getType(e){return e.getTypeByFormat(this.type)}parse(e,t,i,n,r){this.src=e||"";let s,a,o="",l=CNe.exec(e);this.useDefine=r??this.src.charAt(0)==="#",l&&l.length>1?(a=l[1],s=l[2],o=l[3]):(s=this.src,a="f"),this.name=s,this.type=a,this.value=o}build(e,t){if(t==="source"){if(this.value)return this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";";if(this.useDefine)return this.src}return e.include(this),e.format(this.name,this.getType(e),t)}generate(e,t,i,n,r){return e.format(this.name,this.getType(e),t)}},Fn=Oee;Fn.PI="PI",Fn.PI2="PI2",Fn.RECIPROCAL_PI="RECIPROCAL_PI",Fn.RECIPROCAL_PI2="RECIPROCAL_PI2",Fn.LOG2="LOG2",Fn.EPSILON="EPSILON";var DNe=new RegExp(`^structs*([a-z_0-9]+)s*{s*((.|
)*?)}`,"gim"),RNe=new RegExp("s*(w*?)s*(w*?)(=|;)","gim"),Bee=class extends tr{constructor(e=""){super(),this.inputs=[],this.src="",this.nodeType="Struct",this.parse(e)}getType(e){return e.getTypeByFormat(this.name)}getInputByName(e){let t=this.inputs.length;for(;t--;)if(this.inputs[t].name===e)return this.inputs[t]}generate(e,t,i,n,r){return t==="source"?this.src+";":e.format("( "+this.src+" )",this.getType(e),t)}parse(e=""){this.src=e,this.inputs=[];let t=DNe.exec(e);if(t){let i=t[2],n;for(;n=RNe.exec(i);)this.inputs.push({type:n[1],name:n[2]});this.name=t[1]}else this.name="";this.type=this.name}},D5=class extends tr{constructor(e){super("v2",{shared:!1}),this.nodeType="UV",this.index=e??0}generate(e,t){e.requires.uv[this.index]=!0;let i=this.index>0?this.index+1:"",n=e.isShader("vertex")?"uv"+i:"vUv"+i;return e.format(n,this.getType(e),t)}};El.addKeyword("uv",function(){return new D5});El.addKeyword("uv2",function(){return new D5(1)});var i1=class extends tr{constructor(e,t){super("v4"),this.nodeType="ColorSpace",this.input=e,this.method=t??i1.LINEAR_TO_LINEAR,this.hashProperties=["method"]}static getEncodingComponents(e){switch(e){case $u:return["Linear"];case Gi:return["sRGB"];default:return[]}}generate(e,t){var a;let i=this.input.build(e,"v4"),n=this.getType(e),r=i1.Nodes[this.method],s=e.include(r);if(s===i1.LINEAR_TO_LINEAR)return e.format(i,n,t);if(((a=r.inputs)==null?void 0:a.length)===2){let o=this.factor.build(e,"f");return e.format(s+"( "+i+", "+o+" )",n,t)}else return e.format(s+"( "+i+" )",n,t)}fromEncoding(e){let t=i1.getEncodingComponents(e);this.method="LinearTo"+t[0],this.factor=t[1]}fromDecoding(e){let t=i1.getEncodingComponents(e);this.method=t[0]+"ToLinear",this.factor=t[1]}},ld=i1;ld.Nodes={LinearToLinear:new Ft(["vec4 LinearToLinear( in vec4 value ) {","	return value;","}"].join(`
`)),sRGBToLinear:new Ft(["vec4 sRGBToLinear( in vec4 value ) {","	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );","}"].join(`
`)),LinearTosRGB:new Ft(["vec4 LinearTosRGB( in vec4 value ) {","	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );","}"].join(`
`))},ld.LINEAR_TO_LINEAR="LinearToLinear",ld.SRGB_TO_LINEAR="sRGBToLinear",ld.LINEAR_TO_SRGB="LinearTosRGB";var gr=class extends Ft{constructor(e="",t,i,n,r){super(e,r,n,i,t),this.nodeType="Expression"}},Lf=class extends Bl{constructor(e=new Hr,t,i,n){super("v4",{shared:!0}),this.nodeType="Texture",this.value=e,this.uv=t??new D5,this.bias=i,this.project=n!==void 0?n:!1}getTexture(e,t){return super.generate(e,t,this.value.uuid,"t")}generate(e,t){if(t==="sampler2D")return this.getTexture(e,t);let i=this.getTexture(e,t),n=this.uv.build(e,this.project?"v4":"v2"),r=this.bias?this.bias.build(e,"f"):void 0;r===void 0&&e.context.bias&&(r=e.context.bias.setTexture(this).build(e,"f"));let s,a;this.project?s="texture2DProj":s=r?"tex2DBias":"tex2D",r?a=s+"( "+i+", "+n+", "+r+" )":a=s+"( "+i+", "+n+" )";let o={include:e.isShader("vertex"),ignoreCache:!0},l=this.getType(e);return e.addContext(o),this.colorSpace=this.colorSpace??new ld(new gr("",l)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(a),a=this.colorSpace.build(e,l),e.removeContext(),e.format(a,l,t)}},Qt=class extends Bl{constructor(e){super("f"),this.nodeType="Float",this.value=e??0}generateReadonly(e,t,i,n,r,s){return e.format(this.value+(this.value%1?"":".0"),n,t)}},kW=class extends tr{constructor(e,t){super(),this.inputs=[],this.nodeType="FunctionCall",this.value=e,this.inputs=t??[]}getFunction(){return this.value}getType(e){return this.value.getType(e)}generate(e,t,i,n,r){n=this.getType(e);let s=this.value,a=s.build(e,t)+"( ",o=[];if(s.inputs){for(let l=0;l<s.inputs.length;l++){let c=s.inputs[l],u=this.inputs[l]||this.inputs[c.name];o.push(u.build(e,e.getTypeByFormat(c.type)))}a+=o.join(", ")+" )"}return e.format(a,n,t)}},Iee=class extends tr{constructor(e,t,i=Iee.ADD){super(),this.nodeType="Operator",this.type=e.type,this.a=e,this.b=t,this.op=i}getType(e){let t=this.a.getType(e),i=this.b.getType(e);return e.isTypeMatrix(t)?"v4":e.getTypeLength(i)>e.getTypeLength(t)?i:t}generate(e,t){let i=this.getType(e);this.type=i;let n=this.a.build(e,i),r=this.b.build(e,i);return e.format("( "+n+" "+this.op+" "+r+" )",i,t)}},Sl=Iee;Sl.ADD="+",Sl.SUB="-",Sl.MUL="*",Sl.DIV="/";var Kn=class extends tr{constructor(e,t=Kn.ABS,i,n){super(),this.nodeType="Math",this.a=e,typeof t!="string"?this.b=t:n=t,typeof i!="string"?this.c=i:n=i,this.method=n,this.hashProperties=["method"]}getNumInputs(e){switch(this.method){case Kn.MIX:case Kn.CLAMP:case Kn.REFRACT:case Kn.SMOOTHSTEP:case Kn.FACEFORWARD:return 3;case Kn.MIN:case Kn.MAX:case Kn.MOD:case Kn.STEP:case Kn.REFLECT:case Kn.DISTANCE:case Kn.DOT:case Kn.CROSS:case Kn.POW:return 2;default:return 1}}getInputType(e){let t=e.getTypeLength(this.a.getType(e)),i=this.b?e.getTypeLength(this.b.getType(e)):0,n=this.c?e.getTypeLength(this.c.getType(e)):0;return t>i&&t>n?this.a.getType(e):i>n?this.b.getType(e):this.c.getType(e)}getType(e){switch(this.method){case Kn.LENGTH:case Kn.DISTANCE:case Kn.DOT:return"f";case Kn.CROSS:return"v3"}return this.getInputType(e)}generate(e,t){let i,n,r,s=this.a?e.getTypeLength(this.a.getType(e)):0,a=this.b?e.getTypeLength(this.b.getType(e)):0,o=this.c?e.getTypeLength(this.c.getType(e)):0,l=this.getInputType(e),c=this.getType(e);switch(this.type=c,this.method){case Kn.NEGATE:return e.format("( -"+this.a.build(e,l)+" )",l,t);case Kn.INVERT:return e.format("( 1.0 - "+this.a.build(e,l)+" )",l,t);case Kn.CROSS:i=this.a.build(e,"v3"),n=this.b.build(e,"v3");break;case Kn.STEP:i=this.a.build(e,s===1?"f":l),n=this.b.build(e,l);break;case Kn.MIN:case Kn.MAX:case Kn.MOD:i=this.a.build(e,l),n=this.b.build(e,a===1?"f":l);break;case Kn.REFRACT:i=this.a.build(e,l),n=this.b.build(e,l),r=this.c.build(e,"f");break;case Kn.MIX:i=this.a.build(e,l),n=this.b.build(e,l),r=this.c.build(e,o===1?"f":l);break;default:i=this.a.build(e,l),this.b&&(n=this.b.build(e,l)),this.c&&(r=this.c.build(e,l));break}let u=[];u.push(i),n&&u.push(n),r&&u.push(r);let h=this.getNumInputs(e);if(u.length!==h)throw Error(`Arguments not match used in "${this.method}". Require ${h}, currently ${u.length}.`);return e.format(this.method+"( "+u.join(", ")+" )",c,t)}},zi=Kn;zi.RAD="radians",zi.DEG="degrees",zi.EXP="exp",zi.EXP2="exp2",zi.LOG="log",zi.LOG2="log2",zi.SQRT="sqrt",zi.INV_SQRT="inversesqrt",zi.FLOOR="floor",zi.CEIL="ceil",zi.NORMALIZE="normalize",zi.FRACT="fract",zi.SATURATE="saturate",zi.SIN="sin",zi.COS="cos",zi.TAN="tan",zi.ASIN="asin",zi.ACOS="acos",zi.ARCTAN="atan",zi.ABS="abs",zi.SIGN="sign",zi.LENGTH="length",zi.NEGATE="negate",zi.INVERT="invert",zi.MIN="min",zi.MAX="max",zi.MOD="mod",zi.STEP="step",zi.REFLECT="reflect",zi.DISTANCE="distance",zi.DOT="dot",zi.CROSS="cross",zi.POW="pow",zi.MIX="mix",zi.CLAMP="clamp",zi.REFRACT="refract",zi.SMOOTHSTEP="smoothstep",zi.FACEFORWARD="faceforward";var dA=class extends tr{constructor(e,t,i){super("v4"),this.nodeType="TextureCubeUV",this.value=e,this.uv=t,this.bias=i}bilinearCubeUV(e,t,i,n){let r=new kW(dA.Nodes.bilinearCubeUV,[t,i,n]);this.colorSpaceTL=this.colorSpaceTL??new ld(new gr("","v4")),this.colorSpaceTL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTL.input.parse(r.build(e)+".tl"),this.colorSpaceTR=this.colorSpaceTR??new ld(new gr("","v4")),this.colorSpaceTR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTR.input.parse(r.build(e)+".tr"),this.colorSpaceBL=this.colorSpaceBL??new ld(new gr("","v4")),this.colorSpaceBL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBL.input.parse(r.build(e)+".bl"),this.colorSpaceBR=this.colorSpaceBR??new ld(new gr("","v4")),this.colorSpaceBR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBR.input.parse(r.build(e)+".br");let s={include:e.isShader("vertex"),ignoreCache:!0};e.addContext(s),this.colorSpaceTLExp=new gr(this.colorSpaceTL.build(e,"v4"),"v4"),this.colorSpaceTRExp=new gr(this.colorSpaceTR.build(e,"v4"),"v4"),this.colorSpaceBLExp=new gr(this.colorSpaceBL.build(e,"v4"),"v4"),this.colorSpaceBRExp=new gr(this.colorSpaceBR.build(e,"v4"),"v4"),e.removeContext();let a=new gr("mix( mix( cubeUV_TL, cubeUV_TR, cubeUV.f.x ), mix( cubeUV_BL, cubeUV_BR, cubeUV.f.x ), cubeUV.f.y )","v4");return a.keywords.cubeUV_TL=this.colorSpaceTLExp,a.keywords.cubeUV_TR=this.colorSpaceTRExp,a.keywords.cubeUV_BL=this.colorSpaceBLExp,a.keywords.cubeUV_BR=this.colorSpaceBRExp,a.keywords.cubeUV=r,a}generate(e,t){if(e.isShader("fragment")){let i=this.uv,n=this.bias||e.context.roughness,r=new kW(dA.Nodes.roughnessToMip,[n]),s=new zi(r,dA.Nodes.m0,dA.Nodes.cubeUV_maxMipLevel,zi.CLAMP),a=new zi(s,zi.FLOOR),o=new zi(s,zi.FRACT),l=this.bilinearCubeUV(e,this.value,i,a),c=this.bilinearCubeUV(e,this.value,i,new Sl(a,new Qt(1).setReadonly(!0),Sl.ADD)),u=new zi(l,c,o,zi.MIX);return e.format(u.build(e),"v4",t)}else return console.warn("TextureCubeUVNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t)}},sz=dA;sz.Nodes=function(){let e=new Bee(`struct TextureCubeUVData {
			vec4 tl;
			vec4 tr;
			vec4 br;
			vec4 bl;
			vec2 f;
		}`),t=new Fn("float cubeUV_maxMipLevel 8.0",!0),i=new Fn("float cubeUV_minMipLevel 4.0",!0),n=new Fn("float cubeUV_maxTileSize 256.0",!0),r=new Fn("float cubeUV_minTileSize 16.0",!0),s=new Ft(`float getFace(vec3 direction) {
				vec3 absDirection = abs(direction);
				float face = -1.0;
				if (absDirection.x > absDirection.z) {
					if (absDirection.x > absDirection.y)
						face = direction.x > 0.0 ? 0.0 : 3.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				} else {
					if (absDirection.z > absDirection.y)
						face = direction.z > 0.0 ? 2.0 : 5.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				}
				return face;
		}`);s.useKeywords=!1;let a=new Ft(`vec2 getUV(vec3 direction, float face) {
				vec2 uv;
				if (face == 0.0) {
					uv = vec2(direction.z, direction.y) / abs(direction.x); // pos x
				} else if (face == 1.0) {
					uv = vec2(-direction.x, -direction.z) / abs(direction.y); // pos y
				} else if (face == 2.0) {
					uv = vec2(-direction.x, direction.y) / abs(direction.z); // pos z
				} else if (face == 3.0) {
					uv = vec2(-direction.z, direction.y) / abs(direction.x); // neg x
				} else if (face == 4.0) {
					uv = vec2(-direction.x, direction.z) / abs(direction.y); // neg y
				} else {
					uv = vec2(direction.x, direction.y) / abs(direction.z); // neg z
				}
				return 0.5 * (uv + 1.0);
		}`);a.useKeywords=!1;let o=new Ft(`TextureCubeUVData bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {
			float face = getFace(direction);
			float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);
			mipInt = max(mipInt, cubeUV_minMipLevel);
			float faceSize = exp2(mipInt);
			float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);
			vec2 uv = getUV(direction, face) * (faceSize - 1.0);
			vec2 f = fract(uv);
			uv += 0.5 - f;
			if (face > 2.0) {
				uv.y += faceSize;
				face -= 3.0;
			}
			uv.x += face * faceSize;
			if(mipInt < cubeUV_maxMipLevel){
				uv.y += 2.0 * cubeUV_maxTileSize;
			}
			uv.y += filterInt * 2.0 * cubeUV_minTileSize;
			uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);
			uv *= texelSize;
			vec4 tl = texture2D(envMap, uv);
			uv.x += texelSize;
			vec4 tr = texture2D(envMap, uv);
			uv.y += texelSize;
			vec4 br = texture2D(envMap, uv);
			uv.x -= texelSize;
			vec4 bl = texture2D(envMap, uv);
			return TextureCubeUVData( tl, tr, br, bl, f );
		}`,[e,s,a,t,i,n,r]);o.useKeywords=!1;let l=new Fn("float r0 1.0",!0),c=new Fn("float v0 0.339",!0),u=new Fn("float m0 -2.0",!0),h=new Fn("float r1 0.8",!0),d=new Fn("float v1 0.276",!0),p=new Fn("float m1 -1.0",!0),g=new Fn("float r4 0.4",!0),x=new Fn("float v4 0.046",!0),y=new Fn("float m4 2.0",!0),b=new Fn("float r5 0.305",!0),A=new Fn("float v5 0.016",!0),w=new Fn("float m5 3.0",!0),E=new Fn("float r6 0.21",!0),D=new Fn("float v6 0.0038",!0),T=new Fn("float m6 4.0",!0),I=[l,c,u,h,d,p,g,x,y,b,A,w,E,D,T],R=new Ft(`float roughnessToMip(float roughness) {
			float mip = 0.0;
			if (roughness >= r1) {
				mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;
			} else if (roughness >= r4) {
				mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;
			} else if (roughness >= r5) {
				mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;
			} else if (roughness >= r6) {
				mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;
			} else {
				mip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25
			}
			return mip;
		}`,I);return{bilinearCubeUV:o,roughnessToMip:R,m0:u,cubeUV_maxMipLevel:t}}();var n1=class extends tr{constructor(e){super("v3"),this.nodeType="Normal",this.scope=e??n1.VIEW}getShared(){return this.scope===n1.WORLD}build(e,t,i,n){let r=e.context[this.scope+"Normal"];return r?r.build(e,t,i,n):super.build(e,t,i)}generate(e,t,i,n,r){let s;switch(this.scope){case n1.VIEW:e.isShader("vertex")?s="transformedNormal":s="geometryNormal";break;case n1.LOCAL:e.isShader("vertex")?s="objectNormal":(e.requires.normal=!0,s="vObjectNormal");break;case n1.WORLD:e.isShader("vertex")?s="inverseTransformDirection( transformedNormal, viewMatrix ).xyz":(e.requires.worldNormal=!0,s="vWNormal");break}return e.format(s,this.getType(e),t)}},Dl=n1;Dl.LOCAL="local",Dl.WORLD="world",Dl.VIEW="view",Dl.NORMAL="normal";El.addKeyword("viewNormal",function(){return new Dl(Dl.VIEW)});El.addKeyword("localNormal",function(){return new Dl(Dl.NORMAL)});El.addKeyword("worldNormal",function(){return new Dl(Dl.WORLD)});var Sf=class extends tr{constructor(e){super("v3"),this.nodeType="Position",this.scope=e??Sf.LOCAL}getType(){switch(this.scope){case Sf.PROJECTION:return"v4"}return this.type}getShader(){switch(this.scope){case Sf.LOCAL:case Sf.WORLD:return!1}return!0}generate(e,t,i,n,r){let s;switch(this.scope){case Sf.LOCAL:e.isShader("vertex")?s="transformed":(e.requires.position=!0,s="vPosition");break;case Sf.WORLD:if(e.isShader("vertex"))return"( modelMatrix * vec4( transformed, 1.0 ) ).xyz";e.requires.worldPosition=!0,s="vWPosition";break;case Sf.VIEW:s=e.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case Sf.PROJECTION:s=e.isShader("vertex")?"( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )":"vec4( 0.0 )";break}return e.format(s,this.getType(),t)}},qu=Sf;qu.LOCAL="local",qu.WORLD="world",qu.VIEW="view",qu.PROJECTION="projection";El.addKeyword("position",function(){return new qu});El.addKeyword("worldPosition",function(){return new qu(qu.WORLD)});El.addKeyword("viewPosition",function(){return new qu(qu.VIEW)});var ed=class extends tr{constructor(e){super("v3"),this.nodeType="Reflect",this.scope=e??ed.CUBE}getUnique(e){return!e.context.viewNormal}getType(){switch(this.scope){case ed.SPHERE:return"v2"}return this.type}generate(e,t){let i=this.getUnique(e);if(e.isShader("fragment")){let n;switch(this.scope){case ed.VECTOR:{let r=new Dl(Dl.VIEW),s=e.context.roughness,a=r.build(e,"v3"),o=new qu(qu.VIEW).build(e,"v3"),l=s?s.build(e,"f"):void 0,c=`reflect( -normalize( ${o} ), ${a} )`;l&&(c=`normalize( mix( ${c}, ${a}, ${l} * ${l} ) )`);let u=`inverseTransformDirection( ${c}, viewMatrix )`;i?(e.addNodeCode(`vec3 reflectVec = ${u};`),n="reflectVec"):n=u;break}case ed.CUBE:{let r=new ed(ed.VECTOR).build(e,"v3"),s="vec3( -"+r+".x, "+r+".yz )";i?(e.addNodeCode(`vec3 reflectCubeVec = ${s};`),n="reflectCubeVec"):n=s;break}case ed.SPHERE:{let r="normalize( ( viewMatrix * vec4( "+new ed(ed.VECTOR).build(e,"v3")+", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5";i?(e.addNodeCode(`vec2 reflectSphereVec = ${r};`),n="reflectSphereVec"):n=r;break}}return e.format(n,this.getType(),t)}else return console.warn("ReflectNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.type,t)}},B1=ed;B1.CUBE="cube",B1.SPHERE="sphere",B1.VECTOR="vector";var PNe=class extends tr{constructor(e=new Lf,t,i){super("v4"),this.nodeType="TextureCube",this.value=e,this.radianceNode=new sz(this.value,t??new B1(B1.VECTOR),i),this.irradianceNode=new sz(this.value,new Dl(Dl.WORLD),new Qt(1).setReadonly(!0))}generate(e,t){return e.isShader("fragment")?(e.require("irradiance"),e.context.bias&&e.context.bias.setTexture(this.value),(e.slot==="irradiance"?this.irradianceNode:this.radianceNode).build(e,t)):(console.warn("TextureCubeNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t))}},ONe=class extends Bl{constructor(e=new O4,t,i){super("v4",{shared:!0}),this.nodeType="CubeTexture",this.value=e,this.uv=t??new B1,this.bias=i}getTexture(e,t){return super.generate(e,t,this.value.uuid,"tc")}generate(e,t){var l;if(t==="samplerCube")return this.getTexture(e,t);let i=this.getTexture(e,t),n=(l=this.uv)==null?void 0:l.build(e,"v3"),r=this.bias?this.bias.build(e,"f"):void 0;r===void 0&&e.context.bias&&(r=e.context.bias.setTexture(this).build(e,"f"));let s;r?s="texCubeBias( "+i+", "+n+", "+r+" )":s="texCube( "+i+", "+n+" )";let a={include:e.isShader("vertex"),ignoreCache:!0},o=this.getType(e);return e.addContext(a),this.colorSpace=this.colorSpace??new ld(new gr("",o)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(s),s=this.colorSpace.build(e,o),e.removeContext(),e.format(s,o,t)}},BNe=`
uniform int frameIndex;
uniform vec2 resolution;
uniform mat4 previousModelViewMatrix;
uniform mat4 previousProjectionMatrix;

varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;
`,INe=`
layout(location = 1) out vec4 gVelocity;

uniform int frameIndex;
uniform vec2 resolution;

varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;

const vec2 haltonSequence[16] = vec2[16](
vec2( 0.000000,-0.333334),
vec2(-0.500000, 0.333334),
vec2( 0.500000,-0.777778),
vec2(-0.750000,-0.111112),
vec2( 0.250000, 0.555556),
vec2(-0.250000,-0.555556),
vec2( 0.750000, 0.111112),
vec2(-0.875000, 0.777778),
vec2(0.125000, -0.925926),
vec2(-0.375000, -0.259260),
vec2(0.625000, 0.407408),
vec2(-0.625000, -0.703704),
vec2(0.375000, -0.037038),
vec2(-0.125000, 0.629630),
vec2(0.875000, -0.481482),
vec2(-0.937500, 0.185186));

vec2 vogelDiskSample(int sampleIndex, int sampleCount, float angle) {
  const float goldenAngle = 2.399963f; // radians
  float r = sqrt(float(sampleIndex) + 0.5f) / sqrt(float(sampleCount));
  float theta = float(sampleIndex) * goldenAngle + angle;
  float sine = sin(theta);
  float cosine = cos(theta);
  return vec2(cosine, sine) * r;
}

// Derived from the interleaved gradient function from Jimenez 2014 http:goo.gl/eomGso
float getNoiseInterleavedGradient(vec2 screenPos) {
    vec3 magic = vec3(0.06711056f, 0.00583715f, 52.9829189f);
    return fract(magic.z * fract(dot(screenPos, magic.xy)));
}

`,LNe=`
// TODO: This could be generated CPU side and passed to the shader every frame
const vec2 haltonSequence[16] = vec2[16](
vec2( 0.000000,-0.333334),
vec2(-0.500000, 0.333334),
vec2( 0.500000,-0.777778),
vec2(-0.750000,-0.111112),
vec2( 0.250000, 0.555556),
vec2(-0.250000,-0.555556),
vec2( 0.750000, 0.111112),
vec2(-0.875000, 0.777778),
vec2(0.125000, -0.925926),
vec2(-0.375000, -0.259260),
vec2(0.625000, 0.407408),
vec2(-0.625000, -0.703704),
vec2(0.375000, -0.037038),
vec2(-0.125000, 0.629630),
vec2(0.875000, -0.481482),
vec2(-0.937500, 0.185186));

// TODO: Pass correct view size
vec2 offset = haltonSequence[frameIndex];
offset.x /= resolution.x;
offset.y /= resolution.y;

vec4 currentPosition = gl_Position;
vec4 currentPositionJittered = currentPosition + (vec4(offset.x, offset.y, 0.0, 0.0) * currentPosition.w);

// We want to calculate the velocity with unjittered positions
// so that things that are not moving get a velocity = 0
vCurrentPosition = currentPosition;
vPreviousPosition = previousProjectionMatrix * previousModelViewMatrix * vec4(transformed, 1.0);
#ifdef OUTLINE_COMPENSATION
vPreviousPosition.xy += OUTLINE_COMPENSATION;
#endif
gl_Position = currentPositionJittered;

`,UNe=`
vec2 oldPos = vPreviousPosition.xy;
    oldPos /= vPreviousPosition.w;
    oldPos.xy = (oldPos.xy+1.)/2.0;

vec2 newPos = vCurrentPosition.xy;
    newPos /= vCurrentPosition.w;
    newPos.xy = (newPos.xy+1.)/2.0;

vec2 velocity = (newPos - oldPos);

// Discard fully transparent pixels 
if (gl_FragColor.a <= 0.0) discard;

gVelocity = vec4(velocity, 0.0, 1.0);
`,NNe=`
layout(location = 1) out vec4 gVelocity;
`,zNe=`
    // Discard fully transparent pixels 
    if (gl_FragColor.a <= 0.0) discard;

    gVelocity = vec4(0.0, 0.0, 0.0, 1.0);
`,jW=["x","y","z","w"],FNe=["float","vec2","vec3","vec4"],VNe={float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"i",bool:"b","float[]":"f[]","vec4[]":"v4[]"},HNe={t:"sampler2D",tc:"samplerCube",b:"bool",i:"int",f:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4","f[]":"float[]","v4[]":"vec4[]"},Lee=class{constructor(){this.includes={consts:{},functions:{},structs:{}},this.cache="",this.slot="",this.shader="",this.context={},this.needsJitter=!0,this.getIncludesCode=function(){function e(t,i){return t.deps.length-i.deps.length}return function(t,i){let n=this.getIncludes(t,i);if(!n)return"";let r="";n=n.sort(e);for(let s=0;s<n.length;s++)n[s].src&&(r+=n[s].src+`
`);return r}}(),this.slots=[],this.caches=[],this.contexts=[],this.keywords={},this.nodeData={},this.fragmentVariables={},this.fragmentParsVariables={},this.vertexParsVariables={},this.requires={uv:[],color:[],transparent:!1,irradiance:!1,position:!1,worldPosition:!1,normal:!1,worldNormal:!1,vWorldViewDir:!1,modelMatrix:!1,viewMatrix:!1,projectionMatrix:!1},this.includes={consts:[],functions:[],structs:[]},this.attributes={},this.prefixCode=["#ifdef TEXTURE_LOD_EXT","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCube(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif",`
			// NOTE: Include Spline's blending modes. This could be part of BlendNode
			#define SPE_BLENDING_NORMAL 0
			#define SPE_BLENDING_MULTIPLY 1
			#define SPE_BLENDING_SCREEN 2
			#define SPE_BLENDING_OVERLAY 3

			vec3 spe_normalBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, b, alpha );
			}

			vec3 spe_multiplyBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, a * b, alpha );
			}

			vec3 spe_screenBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = 1.0 - ( 1.0 - a ) * ( 1.0 - b );
				return mix( a, tmp, alpha );
			}

			vec3 spe_overlayBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = mix( 1. - 2. * (1. - a) * (1. - b), 2. * a * b, step( a, vec3(.5) ) );
				return clamp( mix( a, tmp, alpha ), 0.0, 1.0 );
			}

			vec3 spe_blend( vec3 a, vec3 b, float alpha, int mode ) {
				if ( mode == SPE_BLENDING_NORMAL ) return spe_normalBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_MULTIPLY ) return spe_multiplyBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_SCREEN ) return spe_screenBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_OVERLAY ) return spe_overlayBlend( a, b, alpha );
				return vec3( 1.0 );
			}
			`,"#include <packing>","#include <common>"].join(`
`),this.parsCode={vertex:["float neighbor_offset = 0.0001;",""].join(`
`),fragment:["float accumAlpha = 0.0;",`void accumulateAlpha(float alpha) {
					accumAlpha += (1.0 - accumAlpha) * alpha;
				}`,""].join(`
`)},this.code={vertex:"",fragment:""},this.nodeCode={vertex:"",fragment:""},this.resultCode={vertex:"",fragment:""},this.finalCode={vertex:"",fragment:""},this.inputs={uniforms:{list:[],vertex:[],fragment:[]},arrayUniforms:{list:[],vertex:[],fragment:[]},vars:{varying:[],vertex:[],fragment:[]}},this.defines={},this.uniforms={},this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.updaters=[],this.nodes=[],this.analyzing=!1}build(e,t){this.addVertexParsCode(BNe),this.addFragmentParsCode(INe),this.buildShader("vertex",e),this.buildShader("fragment",t);for(let i=0;i<this.requires.uv.length;i++)if(this.requires.uv[i]){let n=i>0?i+1:"";this.addVaryCode("varying vec2 vUv"+n+";"),i>0&&this.addVertexParsCode("attribute vec2 uv"+n+";"),this.addVertexFinalCode("vUv"+n+" = uv"+n+";")}return this.requires.color[0]&&(this.addVaryCode("varying vec4 vColor;"),this.addVertexParsCode("attribute vec4 color;"),this.addVertexFinalCode("vColor = color;")),this.requires.color[1]&&(this.addVaryCode("varying vec4 vColor2;"),this.addVertexParsCode("attribute vec4 color2;"),this.addVertexFinalCode("vColor2 = color2;")),this.requires.position&&(this.addVaryCode("varying vec3 vPosition;"),this.addVertexFinalCode("vPosition = transformed;")),this.requires.worldPosition,this.requires.normal&&(this.addVaryCode("varying vec3 vObjectNormal;"),this.addVertexFinalCode(`
				#ifndef SHAPEBLEND 
					vObjectNormal = normal;
				#else
					vObjectNormal = objectNormal;
				#endif
			`)),this.requires.modelMatrix&&this.addFragmentParsCode("uniform mat4 modelMatrix;"),this.requires.viewMatrix&&this.addFragmentParsCode("uniform mat4 viewMatrix;"),this.requires.projectionMatrix&&this.addFragmentParsCode("uniform mat4 projectionMatrix;"),this.requires.worldNormal&&(this.addVaryCode("varying vec3 vWNormal;"),this.addVertexFinalCode("vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;")),this.requires.vWorldViewDir&&(this.addVaryCode("varying vec3 vWorldViewDir;"),this.addVertexFinalCode("vWorldViewDir = isPerspectiveMatrix( projectionMatrix ) ?  ( (modelMatrix * vec4(position, 1.0)).xyz - cameraPosition ) : vec3( -viewMatrix[0][2], -viewMatrix[1][2], -viewMatrix[2][2] );")),this.needsJitter&&(this.addVertexFinalCode(LNe),this.addFragmentFinalCode(UNe)),this}buildShader(e,t){this.resultCode[e]=t.build(this.setShader(e),"v4")}setMaterial(e,t){return this.defines={},this}addFlow(e,t,i){return this.addSlot(e).addCache(t).addContext(i)}removeFlow(){return this.removeSlot().removeCache().removeContext()}addCache(e){return this.cache=e??"",this.caches.push(this.cache),this}removeCache(){return this.caches.pop(),this.cache=this.caches[this.caches.length-1]||"",this}addContext(e){return this.context=Object.assign({},this.context,e),this.context.extra=this.context.extra||{},this.contexts.push(this.context),this}removeContext(){return this.contexts.pop(),this.context=this.contexts[this.contexts.length-1]||{},this}addSlot(e){return this.slot=e||"",this.slots.push(this.slot),this}removeSlot(){return this.slots.pop(),this.slot=this.slots[this.slots.length-1]||"",this}addFragmentVariable(e,t){this.fragmentVariables[e]===void 0&&(this.addFragmentCode(`${t} ${e};`),this.fragmentVariables[e]="")}addFragmentParsVariable(e,t){this.fragmentParsVariables[e]===void 0&&(this.addFragmentParsCode(`${t} ${e};`),this.fragmentParsVariables[e]="")}addVertexParsVariable(e,t){this.vertexParsVariables[e]===void 0&&(this.addVertexParsCode(`${t} ${e};`),this.vertexParsVariables[e]="")}addVertexCode(e){this.addCode(e,"vertex")}addFragmentCode(e){this.addCode(e,"fragment")}addCode(e,t){this.code[t??this.shader]+=e+`
`}addVertexNodeCode(e){this.addNodeCode(e,"vertex")}addFragmentNodeCode(e){this.addNodeCode(e,"fragment")}addNodeCode(e,t){this.nodeCode[t??this.shader]+=e+`
`}clearNodeCode(e){e=e??this.shader;let t=this.nodeCode[e];return this.nodeCode[e]="",t}clearVertexNodeCode(){return this.clearNodeCode("vertex")}clearFragmentNodeCode(){return this.clearNodeCode("fragment")}addVertexFinalCode(e){this.addFinalCode(e,"vertex")}addFragmentFinalCode(e){this.addFinalCode(e,"fragment")}addFinalCode(e,t){this.finalCode[t??this.shader]+=e+`
`}addVertexParsCode(e){this.addParsCode(e,"vertex")}addFragmentParsCode(e){this.addParsCode(e,"fragment")}addParsCode(e,t){this.parsCode[t??this.shader]+=e+`
`}addVaryCode(e){this.addVertexParsCode(e),this.addFragmentParsCode(e)}isCache(e){return this.caches.indexOf(e)!==-1}isSlot(e){return this.slots.indexOf(e)!==-1}define(e,t){this.defines[e]=t===void 0?1:t}require(e){this.requires[e]=!0}isDefined(e){return this.defines[e]!==void 0}getVar(e,t,i,n="varying",r="V",s=""){let a=this.getVars(n),o=a[e];if(!o){let l=a.length;o={name:i||"node"+r+l+(s?"_"+s:""),type:t},a.push(o),a[e]=o}return o}getTempVar(e,t,i,n){return this.getVar(e,t,i,this.shader,"T",n)}getAttribute(e,t){if(!this.attributes[e]){let i=this.getVar(e,t);this.addVertexParsCode("attribute "+t+" "+e+";"),this.addVertexFinalCode(i.name+" = "+e+";"),this.attributes[e]={varying:i,name:e,type:t}}return this.attributes[e]}getCode(e){return[this.prefixCode,this.parsCode[e],this.getVarListCode(this.getVars("varying"),"varying"),this.getVarListCode(this.inputs.uniforms[e],"uniform"),this.getVarListCode(this.inputs.arrayUniforms[e],"uniform"),this.getIncludesCode("consts",e),this.getIncludesCode("structs",e),this.getIncludesCode("functions",e),"void main() {",this.getVarListCode(this.getVars(e)),this.code[e],this.resultCode[e],this.finalCode[e],"}"].join(`
`)}getVarListCode(e,t){t=t??"";let i="";for(let n=0,r=e.length;n<r;++n){let s=e[n],a=s.type,o=s.name,l=s.size,c=this.getFormatByType(a);if(c===void 0)throw new Error("Node pars "+c+" not found.");c.includes("[]")?i+=t+" "+c.substring(0,c.length-2)+" "+o+`[${l}];
`:i+=t+" "+c+" "+o+`;
`}return i}getVars(e){return this.inputs.vars[e??this.shader]}getNodeData(e){let t=e instanceof Xs?e.uuid:e;return this.nodeData[t]=this.nodeData[t]||{}}createUniform(e,t,i,n,r,s){if(t.includes("[]")){let a=this.inputs.arrayUniforms,o=a.list.length,l=new HW({type:t,size:i.size,name:n||"nodeUA"+o+(s?"_"+s:""),node:i,needsUpdate:r});return a.list.push(l),a[e].push(l),a[e][l.name]=l,this.uniforms[l.name]=l,l}else{let a=this.inputs.uniforms,o=a.list.length,l=new HW({type:t,name:n||"nodeU"+o+(s?"_"+s:""),node:i,needsUpdate:r});return a.list.push(l),a[e].push(l),a[e][l.name]=l,this.uniforms[l.name]=l,l}}createVertexUniform(e,t,i,n,r){return this.createUniform("vertex",e,t,i,n,r)}createFragmentUniform(e,t,i,n,r){return this.createUniform("fragment",e,t,i,n,r)}include(e,t,i){var s;let n;if(e=typeof e=="string"?El.get(e):e,this.context.include===!1)return e.name;e instanceof Ft?n=this.includes.functions:e instanceof Fn?n=this.includes.consts:e instanceof Bee&&(n=this.includes.structs);let r=n[this.shader]=n[this.shader]||[];if(e){let a=r[e.name];if(a||(a=r[e.name]={node:e,deps:[]},r.push(a),a.src=e.build(this,"source")),e instanceof Ft&&t&&r[t.name]&&r[t.name].deps.indexOf(e)===-1&&(r[t.name].deps.push(e),(s=e.includes)==null?void 0:s.length)){let o=0;do this.include(e.includes[o++],t);while(o<e.includes.length)}return i&&(a.src=i),e.name}else throw new Error("Include not found.")}colorToVectorProperties(e){return e.replace("r","x").replace("g","y").replace("b","z").replace("a","w")}colorToVector(e){return e.replace(/c/g,"v3")}getIncludes(e,t){return this.includes[e][t||this.shader]}getConstructorFromLength(e){return FNe[e-1]}isTypeMatrix(e){return/^m/.test(e)}getTypeLength(e){return e==="f"?1:parseInt(this.colorToVector(e).substr(1))}getTypeFromLength(e){return e===1?"f":"v"+e}findNode(...e){for(let t=0;t<arguments.length;t++){let i=e[t];if(i!=null&&i.isNode)return i}}resolve(...e){for(let t=0;t<arguments.length;t++){let i=e[t];if(i!==void 0){if(i.isNode)return i;if(i.isTexture)switch(i.mapping){case B0:case I0:return new ONe(i);case rM:return new PNe(new Lf(i));default:return new Lf(i)}else{if(i.isVector2)return new Fa(i);if(i.isVector3)return new Lc(i);if(i.isVector4)return new Mf(i)}}}}format(e,t,i){switch(this.colorToVector(i+" <- "+t)){case"f <- v2":return e+".x";case"f <- v3":return e+".x";case"f <- v4":return e+".x";case"f <- i":case"f <- b":return"float( "+e+" )";case"v2 <- f":return"vec2( "+e+" )";case"v2 <- v3":return e+".xy";case"v2 <- v4":return e+".xy";case"v2 <- i":case"v2 <- b":return"vec2( float( "+e+" ) )";case"v3 <- f":return"vec3( "+e+" )";case"v3 <- v2":return"vec3( "+e+", 0.0 )";case"v3 <- v4":return e+".xyz";case"v3 <- i":case"v3 <- b":return"vec2( float( "+e+" ) )";case"v4 <- f":return"vec4( "+e+" )";case"v4 <- v2":return"vec4( "+e+", 0.0, 1.0 )";case"v4 <- v3":return"vec4( "+e+", 1.0 )";case"v4 <- i":case"v4 <- b":return"vec4( float( "+e+" ) )";case"i <- f":case"i <- b":return"int( "+e+" )";case"i <- v2":return"int( "+e+".x )";case"i <- v3":return"int( "+e+".x )";case"i <- v4":return"int( "+e+".x )";case"b <- f":return"( "+e+" != 0.0 )";case"b <- v2":return"( "+e+" != vec2( 0.0 ) )";case"b <- v3":return"( "+e+" != vec3( 0.0 ) )";case"b <- v4":return"( "+e+" != vec4( 0.0 ) )";case"b <- i":return"( "+e+" != 0 )"}return e}getTypeByFormat(e){return VNe[e]||e}getFormatByType(e){return HNe[e]||e}getUUID(e,t){return t=t!==void 0?t:!0,t&&this.cache&&(e=this.cache+"-"+e),e}getElementByIndex(e){return jW[e]}getIndexByElement(e){return jW.indexOf(e)}isShader(e){return this.shader===e}setShader(e){return this.shader=e,this}mergeDefines(e){for(let t in e)this.defines[t]=e[t];return this.defines}mergeUniform(e){for(let t in e)this.uniforms[t]=e[t];return this.uniforms}getTextureEncodingFromMap(e){let t;return e?e.isTexture&&(t=e.encoding):t=$u,t===$u&&this.context.gamma&&(t=Gi),t}},es=class extends Bl{constructor(e=0,t,i,n){super("c"),this.nodeType="Color",this.value=e instanceof Qa?e:new Qa(e||0,t,i,n)}setRGBA(e){this.value.setRGBA(e.r,e.g,e.b,e.a)}generate(e,t,i,n,r,s){i=e.getUUID(i??this.getUUID()),n=n??this.getType(e);let a=e.getNodeData(i),o=this.getReadonly()&&this.generateReadonly!==void 0;if(this.alpha){let l=this.alpha.build(e,"f");e.addFragmentNodeCode(`accumAlpha += ( 1.0 - accumAlpha ) * ${l};`)}return o?this.generateReadonly(e,t,i,n,r,s):e.isShader("vertex")?(a.vertex||(a.vertex=e.createVertexUniform(n,this,r,s,this.getLabel())),e.format(a.vertex.name,n,t)):(a.fragment||(a.fragment=e.createFragmentUniform(n,this,r,s,this.getLabel())),e.format(a.fragment.name,n,t))}generateReadonly(e,t,i,n,r,s){return e.format("vec3("+this.value.r+", "+this.value.g+", "+this.value.b+")",n,t)}},lr=class extends Bl{constructor(e){super("i"),this.nodeType="Int",this.value=Math.floor(e??0)}generateReadonly(e,t,i,n,r,s){return e.format(this.value.toString(),n,t)}},Qo=class extends Bl{constructor(e){super("b"),this.nodeType="Bool",this.value=e??!1}generateReadonly(e,t,i,n){return e.format(this.value?"true":"false",n,t)}},Gv=class extends Bl{constructor(e=1,t){super("f[]"),this.nodeType="FloatArray",this.size=e,this.value=Array.isArray(t)?t:typeof t=="number"?new Array(e).fill(t):new Array(e).fill(0)}},R5=class extends Bl{},GNe=class extends R5{constructor(e){super("v3"),this.image=e,this._value=new G}get value(){return this._value.x=this.image.isVideo?this.image.img.videoWidth??0:this.image.img.width,this._value.y=this.image.isVideo?this.image.img.videoHeight??0:this.image.img.height,this._value}},az=class extends R5{constructor(e,t,i=1008,n=1006){super("t"),this.image=e,this.wrap=t,this.minFilter=i,this.magFilter=n}get value(){return this.image.getTexture(this.wrap,this.minFilter,this.magFilter)}},Uee=class extends Bl{constructor(e){super("m3"),this.nodeType="Matrix3",this.value=e??new Cs}generateReadonly(e,t,i,n,r,s){return e.format("mat3("+this.value.elements.join(", ")+")",n,t)}get elements(){return this.value.elements}set elements(e){this.value.fromArray(e)}},Ed=class extends Bl{constructor(e){super("m4"),this.nodeType="Matrix4",this.value=e??new Bt}generateReadonly(e,t,i,n,r,s){return e.format("mat4("+this.value.elements.join(", ")+")",n,t)}get elements(){return this.value.elements}set elements(e){this.value.fromArray(e)}};function WW(e,t,i,n=0){e.setUvTransform(i[0],i[1],t[0],t[1],0,0,0).premultiply(new Cs().makeRotation(n*qt.DEG2RAD))}var kNe=class extends Uee{constructor(e,t,i=0){super(new Cs),this.repeat=e,this.offset=t,this.rotation=i,WW(this.value,e,t,i)}updateMatrix(){WW(this.value,this.repeat,this.offset,this.rotation)}},kv=class extends Bl{constructor(e=1,t){super("v4[]"),this.nodeType="Vector4Array",this.size=e,this.value=Array.isArray(t)?t:t instanceof Di?new Array(e).fill(t):new Array(e).fill(new Di(0))}},XW=class extends tr{constructor(e,t,i,n){super("v3"),this.nodeType="Blend",this.a=e,this.b=t,this.alpha=i,this.mode=n}generate(e,t){if(e.isShader("fragment")){let i=[];return i.push(this.a.build(e,"c")),i.push(this.b.build(e,"c")),i.push(this.alpha.build(e,"f")),i.push(this.mode.build(e,"i")),e.format("spe_blend("+i.join(",")+")",this.getType(e),t)}else return console.warn("BlendNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Nee=class extends tr{constructor(e,t){super("v3"),this.nodeType="CustomColor",this.color=e,this.alpha=t,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){let i=e.include(Nee.Nodes.customColor);e.addFragmentVariable(this.calpha,"float");let n=[];return n.push(this.color.build(e,"v3")),n.push(this.mask?`luminance(${this.mask.build(e,"v3")})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),e.format(i+"("+n.join(",")+")",this.getType(e),t)}else return console.warn("CustomColorNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},oz=Nee;oz.Nodes=function(){return{customColor:new Ft(`vec3 customColor(vec3 color, float mask, float alpha, out float calpha) {
				float lalpha = alpha * mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;

				return color;
			}`)}}();var zee=class extends tr{constructor(e,t){super("v3"),this.nodeType="CustomNormal",this.cnormal=e,this.alpha=t,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){let i=e.include(zee.Nodes.customNormal);e.addFragmentVariable(this.calpha,"float");let n=[];return n.push(this.cnormal.build(e,"v3")),n.push("normal"),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),e.format(i+"("+n.join(",")+")",this.getType(e),t)}else return console.warn("CustomNormalNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Fee=zee;Fee.Nodes=function(){return{customNormal:new Ft(`vec3 customNormal(vec3 cnormal, vec3 norm, float mask, float alpha, out float calpha) {
				vec3 normal = packNormalToRGB( norm ).rgb;
				normal *= step( vec3(0.5), cnormal );

				float lalpha = alpha * mask;
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * lalpha;

				return normal;
			}`)}}();var fA=class extends tr{constructor(e,t,i,n,r,s,a,o,l,c,u,h){super("v3"),this.nodeType="CustomTexture",this.texture=e,this.textureSize=t,this.crop=i,this.projection=n,this.axis=r,this.side=s,this.size=a,this.blending=o,this.mat=l,this.isMask=h,this.alpha=c,this.mode=u,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){e.require("position"),e.require("normal"),e.require("uv"),e.requires.uv=[!0],e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0;let i=`g${this.uuid.toString().replace(/-/g,"")}`,n;switch(this.projection.value){case 3:n=e.include(fA.Nodes.cylindrical);break;case 2:n=e.include(fA.Nodes.spherical);break;case 1:let s=["vec3(1.0, 0.0, 0.0)","vec3(0.0, 1.0, 0.0)","vec3(0.0, 0.0, 1.0)"][this.axis.value],a=["zy","xz","xy"][this.axis.value],o=new Ft(`
		vec3 ${i}_planarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
				vec2 projected = (1. + (position.${a})) / 2.;
				vec2 uvs = ( mat * vec3( (projected * 2. - 1.) / (size * .5), 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				${this.side.value===2?"":`lalpha *= step(0.0, ${this.side.value===1?"-1.0 * ":""}dot(vObjectNormal, ${s}));`}

				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				
				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}`);n=e.include(o);break;case 4:n=e.include(fA.Nodes.triplanar);break;default:n=e.include(fA.Nodes.uv);break}e.addFragmentVariable(this.calpha,"float");let r=[];if(r.push("normal"),r.push(this.texture.generate(e,"t")),r.push(this.textureSize.build(e,"v2")),r.push(this.crop.build(e,"f")),r.push(this.mat.build(e,"mat3")),r.push(this.size.build(e,"v2")),r.push(this.blending.build(e,"f")),r.push(this.isMask.build(e,"b")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.mode.build(e,"i")),r.push(this.calpha),this.projection.value===4){let s=`${i}_writeUvs`,a=s+"0",o=s+"1",l=s+"2",c=`${i}_triplanarWeights`;e.addFragmentVariable(a,"vec2"),e.addFragmentVariable(o,"vec2"),e.addFragmentVariable(l,"vec2"),e.addFragmentVariable(c,"vec3"),r.push(a),r.push(o),r.push(l),r.push(c)}else{let s=`${i}_writeUvs`;e.addFragmentVariable(s,"vec2"),r.push(s)}return e.format(n+"("+r.join(",")+")",this.getType(e),t)}},P5=fA;P5.Nodes=function(){let e=new Ft(`
vec3 cylindricalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
                vec3 posN = normalize(position);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float scaledHeight = position.y / (size.y * 0.5);
                float v =  (scaledHeight / 2.) + .5;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;

				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;
				
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}
`),t=new Ft(`
vec3 sphericalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
                vec3 posN = normalize(vPosition);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float v = 0.5 + asin(posN.y) / 3.1415;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;
				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}
`),i=new Ft(`vec3 uvTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
				vec2 uvs = ( mat * vec3( vUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;

				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				
				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}`),n=new Ft(`vec3 triplanarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUvs0, out vec2 writeUvs1, out vec2 writeUvs2, out vec3 writeWeights) {
				vec3 p = position;
				vec2 uv0 = (1.0 + p.xy) / 2.0;     
				vec2 uv1 = (1.0 + p.zy) / 2.0;		
				vec2 uv2 = (1.0 + p.xz) / 2.0;		
	
				uv0 = (mat * vec3((uv0 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;
				uv1 = (mat * vec3((uv1 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;
				uv2 = (mat * vec3((uv2 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;

				// Range from 3 to 128 seems to be good
				float exponent = (1.0 - blending) * 125.0 + 3.0;

				vec3 n = vObjectNormal;
				vec3 weights = abs(normalize(n));
				weights = pow(weights, vec3(exponent));
				weights /= dot(weights, vec3(1.0));

				// Write out all sets of UVs that we generated
				writeUvs0 = uv0;
				writeUvs1 = uv1;
				writeUvs2 = uv2;
				writeWeights = weights;

				// Derivatives for LOD
				vec2 df0 = fwidth(uv0);
				vec2 df1 = fwidth(uv1);
				vec2 df2 = fwidth(uv2);
				if (df0.x > 0.5) df0.x = 0.0;
				if (df1.x > 0.5) df1.x = 0.0;
				if (df2.x > 0.5) df2.x = 0.0;

				#ifdef GL_EXT_shader_texture_lod
                	vec4 tmp = 
						texture2DLodEXT(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + 
						texture2DLodEXT(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + 
						texture2DLodEXT(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;
				#else
                	vec4 tmp = 
						textureLod(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + 
						textureLod(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + 
						textureLod(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;

				// Apply cropping across all 3 planes
				if ( crop > 0.5 ) {
					if ( uv0.x < 0.0 || uv0.x > 1.0 || uv0.y < 0.0 || uv0.y > 1.0 )  {
						lalpha = 0.0;
					}
					if ( uv1.x < 0.0 || uv1.x > 1.0 || uv1.y < 0.0 || uv1.y > 1.0 )  {
						lalpha = 0.0;
					}
					if ( uv2.x < 0.0 || uv2.x > 1.0 || uv2.y < 0.0 || uv2.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;//n * 0.5 + 0.5;
			}			
			`);return{cylindrical:e,spherical:t,uv:i,triplanar:n}}();var pA=class extends tr{constructor(e,t,i,n,r,s,a,o,l,c,u,h){super("v3"),this.nodeType="Depth",this.gradientType=e,this.smooth=t,this.near=i,this.far=n,this.isVector=r,this.isWorldSpace=s,this.origin=a,this.direction=o,this.colors=l,this.steps=c,this.isMask=h,this.alpha=u,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){let i=`g${this.uuid.toString().replace(/-/g,"")}`,n=new Ft(`vec3 ${i}_sdepth(float near, float far, vec3 origin, vec3 direction, vec4 colors[${i}_MAX_COLORS], float steps[${i}_MAX_COLORS], bool isMask, float mask, float alpha, out float calpha) {
               vec4 color = colors[0];
               #ifdef ${i}_IS_VECTOR
                   #ifdef ${i}_LINEAR
                       #ifdef ${i}_WORLDSPACE
                       float depth = vectorLinearWorldSpaceDepth(direction, origin, near, far);
                       #else
                       float depth = vectorLinearObjectSpaceDepth(direction, origin, near, far);
                       #endif
                   #else
                       #ifdef ${i}_WORLDSPACE
                           float depth = vectorSphericalWorldSpaceDepth(origin, near, far);
                       #else
                           float depth = vectorSphericalObjectSpaceDepth(origin, near, far);
                       #endif
                   #endif
               #else
                   float dist = length(vWPosition - cameraPosition);
			       float depth = ( dist - near ) / ( far - near );
               #endif


              float p;
              #ifdef ${i}_SMOOTH
				for ( int i = 1; i < ${i}_MAX_COLORS; i++ ) {
						p = clamp( ( depth - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}
              #else
                for ( int i = 1; i < ${i}_MAX_COLORS; i++ ) {
                   p = clamp(( depth - steps[i - 1] ) / ( steps[i] - steps[i - 1] ), 0.0, 1.0);
                   color = mix(color, colors[i], p);
                 }
              #endif

               float lalpha = alpha * color.a * mask;
               calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
			   accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
			   
               return color.rgb;
			}`,[pA.Nodes.vectorLinearWorldSpaceDepth,pA.Nodes.vectorLinearObjectSpaceDepth,pA.Nodes.vectorSphericalObjectSpaceDepth,pA.Nodes.vectorSphericalWorldSpaceDepth]);if(e.isShader("fragment")){e.define(`${i}_MAX_COLORS`,this.colors.value.length),this.smooth.value&&e.define(`${i}_SMOOTH`),this.isVector.value>.5&&e.define(`${i}_IS_VECTOR`),this.gradientType.value===0&&e.define(`${i}_LINEAR`),this.isWorldSpace.value>.5&&e.define(`${i}_WORLDSPACE`),e.require("worldPosition"),e.addFragmentVariable(this.calpha,"float");let r=e.include(n),s=[];return s.push(this.near.build(e,"f")),s.push(this.far.build(e,"f")),s.push(this.origin.build(e,"v3")),s.push(this.direction.build(e,"v3")),s.push(this.colors.build(e,"v4[]")),s.push(this.steps.build(e,"f[]")),s.push(this.isMask.build(e,"b")),s.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),s.push(this.alpha.build(e,"f")),s.push(this.calpha),e.format(r+"("+s.join(",")+")",this.getType(e),t)}else return console.warn("DepthNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Vee=pA;Vee.Nodes=function(){let e=new Ft(`float vectorLinearWorldSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(vWPosition.x - origin.x) + n.y*(vWPosition.y - origin.y) + n.z*(vWPosition.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),t=new Ft(`float vectorLinearObjectSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(position.x - origin.x) + n.y*(position.y - origin.y) + n.z*(position.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),i=new Ft(`float vectorSphericalWorldSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(vWPosition - origin);
               return ( dist - near ) / ( far - near );
            }`),n=new Ft(`float vectorSphericalObjectSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(position - origin);
               return ( dist - near ) / ( far - near );
            }`);return{vectorLinearWorldSpaceDepth:e,vectorLinearObjectSpaceDepth:t,vectorSphericalWorldSpaceDepth:i,vectorSphericalObjectSpaceDepth:n}}();var jNe=class extends tr{constructor(e,t,i,n,r,s,a,o){super("v3"),this.nodeType="Fresnel",this.color=e,this.bias=t,this.scale=i,this.intensity=n,this.factor=r,this.isMask=o,this.alpha=s,this.mode=a,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");let i=new Ft(`vec3 fresnel(vec3 color, float bias, float scale, float intensity, float factor, bool isMask, float mask, float alpha, int mode, out float calpha) {
					float fresnel = bias + scale * pow( abs( factor + dot( normalize( vWorldViewDir ), normalize( vWNormal ) ) ), intensity );

					float lalpha = clamp(fresnel, 0.0, 1.0) * alpha * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

					return color;
				}`),n=e.include(i),r=[];return r.push(this.color.build(e,"c")),r.push(this.bias.build(e,"f")),r.push(this.scale.build(e,"f")),r.push(this.intensity.build(e,"f")),r.push(this.factor.build(e,"f")),r.push(this.isMask.build(e,"b")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.mode.build(e,"i")),r.push(this.calpha),e.format(n+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("FresnelNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Hee=class extends tr{constructor(e,t,i,n,r,s,a,o,l){super("v3"),this.nodeType="Gradient",this.gradientType=e,this.smooth=t,this.colors=i,this.steps=n,this.offset=r,this.morph=s,this.angle=a,this.isMask=l,this.alpha=o,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){e.define("GRAD_MAX",10),e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let i=e.include(Hee.Nodes.gradient),n=[];return n.push(this.gradientType.build(e,"i")),n.push(this.smooth.build(e,"b")),n.push(this.colors.build(e,"v4[]")),n.push(this.steps.build(e,"f[]")),n.push(this.offset.build(e,"v2")),n.push(this.morph.build(e,"v2")),n.push(this.angle.build(e,"f")),n.push(this.isMask.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),e.format(i+"("+n.join(",")+")",this.getType(e),t)}else return console.warn("GradientNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Gee=Hee;Gee.Nodes=function(){return{gradient:new Ft(`vec3 gradient(int gradientType, bool smoothed, vec4 colors[GRAD_MAX], float steps[GRAD_MAX], vec2 offset, vec2 morph, float angle, bool isMask, float mask, float alpha, out float calpha) {
				vec4 color = colors[0];
				vec2 m = morph / vUv.xy;
				vec2 rot = vec2( 0.5 + m.x, m.y );
				vec2 dt = vec2(
					cos( angle ) * rot.x - sin( angle ) * rot.y,
					sin( angle ) * rot.x + cos( angle ) * rot.y
				);
				vec2 pt = ( vUv - 0.5 + offset ) / 2.0 + dt / 2.0;
				float t = dot( pt, dt ) / dot( dt, dt );
				if ( gradientType == 1 ) {
					t = distance (
						( vUv + morph ) * 3.0,
						( vUv + offset ) + 1.0
					) + angle;
				} else if ( gradientType == 2 ) {
					float polar = atan(
						vUv.x + morph.x - 0.5 + offset.x,
						vUv.y + morph.y - 0.5 + offset.y
					) * -1.0;
					t = fract( ( angle / PI / -2.0 ) + 0.5 * ( polar / PI ) );
				}

				float p;
				if (smoothed) {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}

				} else {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], p);
					}
				}

				float lalpha = alpha * color.a * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
				
				return color.xyz;
			}`)}}();var kee=class extends tr{constructor(e,t,i,n,r){super("v3"),this.nodeType="Matcap",this.texture=e,this.isMask=n,this.alpha=t,this.mode=i,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`,this.rotation=r}generate(e,t){if(e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");let i=e.include(kee.Nodes.matcap);e.require("normal"),e.requires.normal=!0;let n=[];return n.push(this.texture.generate(e,"t")),n.push("normal"),n.push(this.isMask.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.mode.build(e,"i")),n.push(this.calpha),n.push(this.rotation.build(e,"f")),e.format(i+"("+n.join(",")+")",this.getType(e),t)}else return console.warn("MatcapNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},jee=kee;jee.Nodes=function(){return{matcap:new Ft(`vec3 matcap(sampler2D matcapTex, vec3 normal, bool isMask, float mask, float alpha, int mode, out float calpha, float rotation) {
					vec3 viewDir = normalize( vViewPosition );
					vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
					vec3 y = cross( viewDir, x );
					vec2 uv = vec2( dot( x, normal ), dot( y, normal ) );
					uv = mat2( cos(rotation), sin(rotation), -sin(rotation), cos(rotation) ) * uv;
					uv = uv * 0.495 + 0.5;
					vec4 matcapColor = texture2D( matcapTex, uv );

					float lalpha = alpha * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
					
					return matcapColor.rgb;
            	}`)}}();var Al=function(){let e=new Ft(`vec3 random3(vec3 c) {
			float j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));
			vec3 r;
			r.z = fract(512.0*j);
			j *= .125;
			r.x = fract(512.0*j);
			j *= .125;
			r.y = fract(512.0*j);
			return r-0.5;
		}`),t=new Ft(`float simplexFast(vec3 p) {
			 vec3 s = floor(p + dot(p, vec3(F3)));
			 mediump vec3 x = p - s + dot(s, vec3(G3));
			 mediump vec3 hs = s;
			 
			 mediump vec3 e = step(vec3(0.0), x - x.yzx);
			 mediump vec3 i1 = e*(1.0 - e.zxy);
			 mediump vec3 i2 = 1.0 - e.zxy*(1.0 - e);
				
			 mediump vec3 x1 = x - i1 + G3;
			 mediump vec3 x2 = x - i2 + 2.0*G3;
			 mediump vec3 x3 = x - 1.0 + 3.0*G3;
			 
			 mediump vec4 w, d;
			 
			 w.x = dot(x, x);
			 w.y = dot(x1, x1);
			 w.z = dot(x2, x2);
			 w.w = dot(x3, x3);
			 
			 w = max(0.6 - w, 0.0);
			 
			 d.x = dot(random3(hs), x);
			 d.y = dot(random3(hs + i1), x1);
			 d.z = dot(random3(hs + i2), x2);
			 d.w = dot(random3(hs + 1.0), x3);
			 
			 w *= w;
			 w *= w;
			 d *= w;
			 
			 return dot(d, vec4(52.0));
		}`,[e]);t.keywords.F3=new Fn("float F3 0.3333333"),t.keywords.G3=new Fn("float G3 0.1666667");let i=new Ft(`float simplexPrecise(vec3 p) {
			 vec3 s = floor(p + dot(p, vec3(F3)));
			 vec3 x = p - s + dot(s, vec3(G3));
			 
			 vec3 e = step(vec3(0.0), x - x.yzx);
			 vec3 i1 = e*(1.0 - e.zxy);
			 vec3 i2 = 1.0 - e.zxy*(1.0 - e);
				
			 vec3 x1 = x - i1 + G3;
			 vec3 x2 = x - i2 + 2.0*G3;
			 vec3 x3 = x - 1.0 + 3.0*G3;
			 
			 vec4 w, d;
			 
			 w.x = dot(x, x);
			 w.y = dot(x1, x1);
			 w.z = dot(x2, x2);
			 w.w = dot(x3, x3);
			 
			 w = max(0.6 - w, 0.0);
			 
			 d.x = dot(random3(s), x);
			 d.y = dot(random3(s + i1), x1);
			 d.z = dot(random3(s + i2), x2);
			 d.w = dot(random3(s + 1.0), x3);
			 
			 w *= w;
			 w *= w;
			 d *= w;
			 
			 return dot(d, vec4(52.0));
		}`,[e]);i.keywords.F3=new Fn("float F3 0.3333333"),i.keywords.G3=new Fn("float G3 0.1666667");let n=new Ft(`float simplexFractal(vec3 m) {
			mat3 rot1 = mat3(-0.37, 0.36, 0.85,-0.14,-0.93, 0.34,0.92, 0.01,0.4);
			mat3 rot2 = mat3(-0.55,-0.39, 0.74, 0.33,-0.91,-0.24,0.77, 0.12,0.63);
			mat3 rot3 = mat3(-0.71, 0.52,-0.47,-0.08,-0.72,-0.68,-0.7,-0.45,0.56);
			return 0.5333333 * simplexFast(m * rot1)
				 + 0.2666667 * simplexFast(2.0 * m * rot2)
				 + 0.1333333 * simplexFast(4.0 * m * rot3)
				 + 0.0666667 * simplexFast(8.0 * m);
		}`,[t]),r=new Ft("vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}"),s=new Ft("vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}"),a=new Ft(`float simplexAshima(vec3 v) {
		  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
		  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
		  vec3 i  = floor(v + dot(v, C.yyy) );
		  vec3 x0 =   v - i + dot(i, C.xxx) ;
		  vec3 g = step(x0.yzx, x0.xyz);
		  vec3 l = 1.0 - g;
		  vec3 i1 = min( g.xyz, l.zxy );
		  vec3 i2 = max( g.xyz, l.zxy );
		  vec3 x1 = x0 - i1 + 1.0 * C.xxx;
		  vec3 x2 = x0 - i2 + 2.0 * C.xxx;
		  vec3 x3 = x0 - 1. + 3.0 * C.xxx;
		  i = mod(i, 289.0 ); 
		  vec4 p = permute( permute( permute( 
					 i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
				   + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) 
				   + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
		  float n_ = 1.0/7.0; // N=7
		  vec3  ns = n_ * D.wyz - D.xzx;
		  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)
		  vec4 x_ = floor(j * ns.z);
		  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)
		  vec4 x = x_ *ns.x + ns.yyyy;
		  vec4 y = y_ *ns.x + ns.yyyy;
		  vec4 h = 1.0 - abs(x) - abs(y);
		  vec4 b0 = vec4( x.xy, y.xy );
		  vec4 b1 = vec4( x.zw, y.zw );
		  vec4 s0 = floor(b0)*2.0 + 1.0;
		  vec4 s1 = floor(b1)*2.0 + 1.0;
		  vec4 sh = -step(h, vec4(0.0));
		  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
		  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
		  vec3 p0 = vec3(a0.xy,h.x);
		  vec3 p1 = vec3(a0.zw,h.y);
		  vec3 p2 = vec3(a1.xy,h.z);
		  vec3 p3 = vec3(a1.zw,h.w);
		  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
		  p0 *= norm.x;
		  p1 *= norm.y;
		  p2 *= norm.z;
		  p3 *= norm.w;
		  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
		  m = m * m;
		  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), 
										dot(p2,x2), dot(p3,x3) ) );
		}`,[r,s]),o=new Ft("vec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}"),l=new Ft("vec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}",[o]),c=new Ft(`float noise(vec3 p){
			vec3 a = floor(p);
			vec3 d = p - a;
			d = d * d * (3.0 - 2.0 * d);
			vec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);
			vec4 k1 = perm(b.xyxy);
			vec4 k2 = perm(k1.xyxy + b.zzww);
			vec4 c = k2 + a.zzzz;
			vec4 k3 = perm(c);
			vec4 k4 = perm(c + 1.0);
			vec4 o1 = fract(k3 * (1.0 / 41.0));
			vec4 o2 = fract(k4 * (1.0 / 41.0));
			vec4 o3 = o2 * d.z + o1 * (1.0 - d.z);
			vec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);
			return o4.y * d.y + o4.x * (1.0 - d.y);
		}`,[l]),u=new Ft(`float fbm(vec3 x) {
			float v = 0.0;
			float a = 0.5;
			vec3 shift = vec3(100);
			for (int i = 0; i < NUM_OCTAVES; ++i) {
				v += a * noise(x);
				x = x * 2.0 + shift;
				a *= 0.5;
			}
			return v;
		}`,[c]);u.keywords.NUM_OCTAVES=new Fn("int NUM_OCTAVES 5");let h=new Ft("vec3 fade(vec3 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}"),d=new Ft(`float perlin(vec3 P){
		  vec3 Pi0 = floor(P);
		  vec3 Pi1 = Pi0 + vec3(1.0);
		  Pi0 = mod(Pi0, 289.0);
		  Pi1 = mod(Pi1, 289.0);
		  vec3 Pf0 = fract(P);
		  vec3 Pf1 = Pf0 - vec3(1.0);
		  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
		  vec4 iy = vec4(Pi0.yy, Pi1.yy);
		  vec4 iz0 = Pi0.zzzz;
		  vec4 iz1 = Pi1.zzzz;
		  vec4 ixy = permute(permute(ix) + iy);
		  vec4 ixy0 = permute(ixy + iz0);
		  vec4 ixy1 = permute(ixy + iz1);
		  vec4 gx0 = ixy0 / 7.0;
		  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;
		  gx0 = fract(gx0);
		  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
		  vec4 sz0 = step(gz0, vec4(0.0));
		  gx0 -= sz0 * (step(0.0, gx0) - 0.5);
		  gy0 -= sz0 * (step(0.0, gy0) - 0.5);
		  vec4 gx1 = ixy1 / 7.0;
		  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;
		  gx1 = fract(gx1);
		  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
		  vec4 sz1 = step(gz1, vec4(0.0));
		  gx1 -= sz1 * (step(0.0, gx1) - 0.5);
		  gy1 -= sz1 * (step(0.0, gy1) - 0.5);
		  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
		  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
		  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
		  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
		  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
		  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
		  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
		  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);
		  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
		  g000 *= norm0.x;
		  g010 *= norm0.y;
		  g100 *= norm0.z;
		  g110 *= norm0.w;
		  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
		  g001 *= norm1.x;
		  g011 *= norm1.y;
		  g101 *= norm1.z;
		  g111 *= norm1.w;
		  float n000 = dot(g000, Pf0);
		  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
		  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
		  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
		  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
		  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
		  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
		  float n111 = dot(g111, Pf1);
		  vec3 fade_xyz = fade(Pf0);
		  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
		  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
		  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); 
		  return 2.2 * n_xyz;
		}`,[r,s,h]),p=new Ft(`float hashwithoutsine13(vec3 p3)
		{
			p3  = fract(p3 * .1031);
			p3 += dot(p3, p3.yzx + 33.33);
			return fract((p3.x + p3.y) * p3.z);
		}`),g=new Ft(`vec3 hashwithoutsine33(vec3 p3)
		{
			p3 = fract(p3 * vec3(.1031, .1030, .0973));
			p3 += dot(p3, p3.yxz+33.33);
			return fract((p3.xxy + p3.yxx)*p3.zyx);
		}`),x=new Ft(`float metric(in vec3 p)
		{
			// L2 
			return length(p);

			// Chebyshev 
			// vec3 a = abs(p);
			// return max(a.x, max(a.y, a.z));
		}`),y=new Ft(`float smin( float a, float b, float k )
		{
			float h = smoothstep(0.0, 1.0, 0.5 + 0.5 * (b - a) / k);
			float correction = k * h * (1.0 - h);
			return mix(b, a, h) - correction;
		}`),b=new Ft(`float smax( float a, float b, float k )
		{
			float h = smoothstep(1.0, 0.0, 0.5 + 0.5 * (a - b) / k);
			float correction = k * h * (1.0 - h);
			return mix(a, b, h) + correction;
		}`),A=new Ft(`float remap(float value, float input_min, float input_max, float output_min, float output_max) {
			// Compute width of each interval
			float input_width = input_max - input_min;
			float output_width = output_max - output_min;
		
			// Convert input range into a 0-1 range 
			float scaled = (value - input_min) / input_width;
		
			// Convert the 0-1 range into a value in output range
			return output_min + (scaled * output_width);
		}`),w=new Ft(`float voronoi(in vec3 x, in int style, in float smoothness, in float seed, in int quality) 
		{
			// Integer and fractional parts of this point's coordinates
			ivec3 p = ivec3(floor(x));
			vec3 f = fract(x);

			// Different variables that we will use to construct noise:
			//
			// f1: distance to the closest feature point
			// f2: distance to the second closest feature point
			// e: distance to the closest edge (cell boundary)
			//
			// We also compute "smooth" versions of all of the above quantites, essentially
			// replacing "hard" minimums with "smooth" minimums (described by IQ)
			float f1_smooth = 8.0;
			float f1 = 8.0;
			float f2_smooth = 8.0;
			float f2 = 8.0;
			float e_smooth = 8.0;
			float e = 8.0;

			// Variables stored from closest cell
			ivec3 mb;
			vec3 mr; 

			int steps = quality;
			
			for (int x = -steps; x <= steps; x++) 
			for (int y = -steps; y <= steps; y++)
			for (int z = -steps; z <= steps; z++)
			{
				ivec3 b = ivec3(x, y, z);
				vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
				float d = length(r);
				
				f1_smooth = smin(d, f1_smooth, smoothness);

				// Store un-smoothed distances too 
				if (d < f1) 
				{
					f2 = f1;
					f1 = d;

					mb = ivec3(x, y, z);
					mr = r;
				} 
				else if (d < f2) 
				{
					f2 = d;
				}
			}	
			
			// Second pass for edge distance  
			// skip for styles don't need
			if (style != 0 &&  style != 5 && style != 7)
			for (int x = -steps; x <= steps; x++) 
			for (int y = -steps; y <= steps; y++)
			for (int z = -steps; z <= steps; z++)
			{
				// Start search at the cell that contains the closest point to "x" (found in 1st pass)
				ivec3 b = mb + ivec3(x, y, z);
				vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
				float d1 = dot(0.5 * (mr + r), (r - mr)); 				// IQ normalizes "r - mr" but that breaks things for the smooth version?
				float d2 = dot(0.5 * (mr + r), normalize(r - mr));

				e_smooth = smin(d1, e_smooth, smoothness);

				e = min(e, d2);

				// Also compute a smooth version of F2 in this pass
				{
					ivec3 b = ivec3(x, y, z);
					if (b != mb) 
					{
						vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
						float d = length(r);

						f2_smooth = smin(d, f2_smooth, smoothness);
					}
				}
			}

			// Different visualization modes 
			if (style == 0) 
			{
				return f1_smooth;
			}
			if (style == 1) 
			{
				return f2_smooth;
			}
			if (style == 2) 
			{
				return f2_smooth - f1_smooth;
				
				// "Pebbles" also cool
				//return step(0.2, f2_smooth - f1_smooth);
			}
			if (style == 3) 
			{
				// This one is really good for rock / stone effects
				float a = f1; 
				float b = f2;
				float k = 3.0;
				float h = max(k - abs(a - b), 0.0) / k;
				float final = min(a, b) - h * h * k * (1.0 / 4.0);
				return final;
			}
			if (style == 4) 
			{
				// Some random adjustments to make this style stand out more 
				return exp(5.0 * e_smooth);
			}
			if (style == 5) 
			{
				return pow(f1_smooth, 3.0);
			}
			if (style == 6) 
			{				
				const float eps = 0.0125;

				// Thicker lines as the user increases the smoothness slider
				float thickness = smoothness * 0.25 + eps;

				// Blurrier lines as the user increases the smoothness slider
				float blur = pow(smoothness, 3.0) * 0.25 + eps;

				return smoothstep(
					thickness - thickness * blur, 
					thickness + thickness * blur, 
					e
				);
			}
			if (style == 7) 
			{
				return hashwithoutsine13(vec3(p + mb) + seed);
			}
		}
	`,[p,g,x,y,b,A]);return{simplexFast:t,simplexPrecise:i,simplexFractal:n,simplexAshima:a,fbm:u,perlin:d,voronoi:w}}(),Wee=class extends tr{constructor(e,t,i,n,r,s,a,o,l,c,u,h,d,p,g,x,y,b,A){super("v3"),this.nodeType="Noise",this.scale=e,this.size=t,this.move=i,this.fA=n,this.fB=r,this.distortion=s,this.colorA=a,this.colorB=o,this.colorC=l,this.colorD=c,this.noiseType=h,this.voronoiStyle=p,this.highCut=g,this.lowCut=x,this.smoothness=y,this.seed=b,this.quality=A,this.isMask=d,this.alpha=u,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t,i,n,r){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let s=["simplexFast","simplexFractal","simplexAshima","fbm","perlin","voronoi"][this.noiseType.value],a=s=="voronoi"?`
		float v = ${s}(st + move, voronoiStyle, smoothness, seed, quality);

		// Apply clipping to colors
		v = remap(v, lowCut, highCut, 0.0, 1.0);
		v = smax(v, 0.0, smoothness * 0.25);
		v = smin(v, 1.0, smoothness * 0.25);

		// Note that the voronoi mode only uses colors "A" and "C" from the UI 
		vec4 color = mix(colorA, colorC, v); 
		`:`
		vec3 q = vec3(${s}(st),
					   ${s}(st + vec3(1.0)),
					   ${s}(st + vec3(1.0)));
		vec3 r = vec3(${s}(st + vec3(distortion, 1.0) * q + vec3(fA, 1.0) + move),
					  ${s}(st + vec3(distortion, 1.0) * q + vec3(fB, 1.0) + move), 
					  ${s}(st * q));
		float f = ${s}(st + r);
		vec4 color;
		color = mix(colorA, colorB, clamp((f * f) * 4.0, 0.0, 1.0));
		color = mix(color, colorC, clamp(length(q), 0.0, 1.0));
		color = mix(color, colorD, clamp(length(r.x), 0.0, 1.0));
		`,o=new Ft(`vec3 ${s}customNoise(float scale, vec3 size, float move, vec2 fA, vec2 fB, vec2 distortion, vec4 colorA, vec4 colorB, vec4 colorC, vec4 colorD, int voronoiStyle, float highCut, float lowCut, float smoothness, float seed, int quality, bool isMask, float mask, float alpha, out float calpha) 
			{
                // Prevent scale of zero 
				scale = max(abs(scale), 0.001);

				vec3 st = position / size;
				st /= scale;

				${a}

				float lalpha = alpha * color.a * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return clamp(color, 0.0, 1.0).rgb;
			}`,[Al.simplexFast,Al.simplexFractal,Al.simplexAshima,Al.fbm,Al.perlin,Al.voronoi]),l=e.include(o),c=[];return c.push(this.scale.build(e,"f")),c.push(this.size.build(e,"v3")),c.push(this.move.build(e,"f")),c.push(this.fA.build(e,"v2")),c.push(this.fB.build(e,"v2")),c.push(this.distortion.build(e,"v2")),c.push(this.colorA.build(e,"v4")),c.push(this.colorB.build(e,"v4")),c.push(this.colorC.build(e,"v4")),c.push(this.colorD.build(e,"v4")),c.push(this.voronoiStyle.build(e,"i")),c.push(this.highCut.build(e,"f")),c.push(this.lowCut.build(e,"f")),c.push(this.smoothness.build(e,"f")),c.push(this.seed.build(e,"f")),c.push(this.quality.build(e,"i")),c.push(this.isMask.build(e,"b")),c.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),c.push(this.alpha.build(e,"f")),c.push(this.calpha),e.format(l+"("+c.join(",")+")",this.getType(e),t)}};Wee.numOctaves=5;var Xee=class extends tr{constructor(e,t,i,n,r,s,a,o,l,c,u,h,d,p,g,x){super("v3"),this.nodeType="Outline",this.firstTime=!0,this.outlineColor=e,this.contourColor=t,this.outlineWidth=i,this.contourWidth=n,this.contourThreshold=r,this.outlineThreshold=s,this.contourFrequency=a,this.outlineSmoothing=o,this.contourDirection=l,this.positionalLines=c,this.compensation=u,this.resolution=h,this.normalMap=d,this.depthMap=p,this.pixelRatio=g,this.alpha=x,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){let i=`g${this.uuid.toString().replace(/-/g,"")}`;if(e.require("vWorldViewDir"),e.require("worldNormal"),e.extensions.derivatives=!0,this.compensation.value&&e.define("OUTLINE_COMPENSATION",`${i}_offset`),this.firstTime){let n=this.outlineWidth.build(e,"f"),r=this.resolution.build(e,"v2"),s=this.compensation.build(e,"b"),a=this.pixelRatio.build(e,"f");e.addVertexParsVariable("randomColor","attribute vec3"),e.addVertexParsVariable("extrudeNormal","attribute vec3"),e.addVertexParsVariable(n,"uniform float"),e.addVertexParsVariable(r,"uniform vec2"),e.addVertexParsVariable(s,"uniform bool"),e.addVertexParsVariable(a,"uniform float"),e.addVertexParsVariable("vID","flat out float"),e.addFragmentParsVariable("vID","flat in float"),e.addVertexFinalCode(`
                vID = randomColor.r;
                vec2 ${i}_offset = vec2(0.0);
                if (${s}) {
                    vec4 ${i}_clipPosition = projectionMatrix * (modelViewMatrix * vec4(transformed, 1.0));
                    // NOTE: For certain shapes, like spheres, we get incorrect extrusion when the
                    // normals face the camera directly. So we hackily fix this by offsetting the normal
                    // by a tiny amount.
                    vec3 ${i}_clipNormal = mat3(projectionMatrix) * (mat3(modelViewMatrix) * extrudeNormal) + 0.0000001;
                    ${i}_offset = normalize(${i}_clipNormal.xy) / ${r} * (${n} / 2.0) * ${i}_clipPosition.w * 2.0 * ${a};
                    ${i}_clipPosition.xy += ${i}_offset;
                    // TODO(MAX): To handle multiple outline layers, we only want to extrude
                    // if this offset is the biggest of all the potential offsets
                    gl_Position = ${i}_clipPosition;
                }
            `)}if(e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let n=e.include(Xee.Nodes.outline),r=[];return r.push(this.outlineColor.build(e,"c")),r.push(this.contourColor.build(e,"c")),r.push(this.outlineWidth.build(e,"f")),r.push(this.contourWidth.build(e,"f")),r.push(this.contourThreshold.build(e,"f")),r.push(this.outlineThreshold.build(e,"f")),r.push(this.contourFrequency.build(e,"f")),r.push(this.outlineSmoothing.build(e,"f")),r.push(this.contourDirection.build(e,"v3")),r.push(this.positionalLines.build(e,"b")),r.push(this.resolution.build(e,"v2")),r.push(this.normalMap.getTexture(e,"t")),r.push(this.depthMap.getTexture(e,"t")),r.push(this.pixelRatio.build(e,"f")),r.push(this.compensation.build(e,"b")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),this.firstTime=!this.firstTime,e.format(n+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("OutlineNode is not compatible with "+e.shader+" shader."),""}},qee=Xee;qee.Nodes=function(){let e=new Ft(`
float sobelSample(sampler2D t, sampler2D d, vec2 uv, vec2 resolution, float outlineWidth, float pixelRatio)
{
    vec2 halton = haltonSequence[frameIndex];
    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
    float temporalAngle  = temporalOffset * PI2;

    vec2 texelSize = (vec2(1.0) / resolution);
    vec2 offsetSize = texelSize * outlineWidth * pixelRatio;

    vec2 uvSamples[9];
    vec4 normalSamples[9];

	uvSamples[0] = uv + vec2( -offsetSize.x, -offsetSize.y) + (vogelDiskSample(0, 9, temporalAngle) * texelSize);
	uvSamples[1] = uv + vec2(0.0, -offsetSize.y) + (vogelDiskSample(1, 9, temporalAngle) * texelSize);
	uvSamples[2] = uv + vec2(  offsetSize.x, -offsetSize.y) + (vogelDiskSample(2, 9, temporalAngle) * texelSize);
	uvSamples[3] = uv + vec2( -offsetSize.x, 0.0) + (vogelDiskSample(3, 9, temporalAngle) * texelSize);
	uvSamples[4] = uv;
	uvSamples[5] = uv + vec2(  offsetSize.x, 0.0) + (vogelDiskSample(5, 9, temporalAngle) * texelSize);
	uvSamples[6] = uv + vec2( -offsetSize.x, offsetSize.y) + (vogelDiskSample(6, 9, temporalAngle) * texelSize);
	uvSamples[7] = uv + vec2(0.0, offsetSize.y) + (vogelDiskSample(7, 9, temporalAngle) * texelSize);
	uvSamples[8] = uv + vec2(  offsetSize.x, offsetSize.y) + (vogelDiskSample(8, 9, temporalAngle) * texelSize);


    normalSamples[0] = texture2D(t, uvSamples[0]);
    normalSamples[1] = texture2D(t, uvSamples[1]);
    normalSamples[2] = texture2D(t, uvSamples[2]);
    normalSamples[3] = texture2D(t, uvSamples[3]);
    normalSamples[4] = texture2D(t, uvSamples[4]);
    normalSamples[5] = texture2D(t, uvSamples[5]);
    normalSamples[6] = texture2D(t, uvSamples[6]);
    normalSamples[7] = texture2D(t, uvSamples[7]);
    normalSamples[8] = texture2D(t, uvSamples[8]);

    float depthBias = 0.0001;
    // TODO(MAX): Can we somehow reduce the number of conditionals here with MATH?!
    if (normalSamples[0].a != vID && normalSamples[0].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[0]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[1].a != vID && normalSamples[1].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[1]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[2].a != vID && normalSamples[2].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[2]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[3].a != vID && normalSamples[3].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[3]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }


    if (normalSamples[4].a != vID && normalSamples[4].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[4]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[5].a != vID && normalSamples[5].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[5]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[6].a != vID && normalSamples[6].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[6]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[7].a != vID && normalSamples[7].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[7]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[8].a != vID && normalSamples[8].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[8]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    vec3 sobel_edge_h = normalSamples[2].rgb + (2.0*normalSamples[5].rgb) + normalSamples[8].rgb - (normalSamples[0].rgb + (2.0*normalSamples[3].rgb) + normalSamples[6].rgb);
  	vec3 sobel_edge_v = normalSamples[0].rgb + (2.0*normalSamples[1].rgb) + normalSamples[2].rgb - (normalSamples[6].rgb + (2.0*normalSamples[7].rgb) + normalSamples[8].rgb);

    float edgeNormal = sqrt(dot(sobel_edge_h, sobel_edge_h) + dot(sobel_edge_v, sobel_edge_v));
    return edgeNormal;
}
`);return{outline:new Ft(`vec3 outline(vec3 outlineColor, vec3 contourColor, float outlineWidth, float contourWidth, float outlineThreshold, float contourThreshold, float outlineSmoothing, float contourFrequency, vec3 contourDirection, bool positionalLines, vec2 resolution, sampler2D normalMap, sampler2D depthMap, float pixelRatio, bool compensation, float mask, float alpha, out float calpha) {
                vec3 result = outlineColor;
                float resultAlpha = 0.0;

                vec3 N = normalize(vWNormal);
                vec2 nuv = (gl_FragCoord.xy / resolution);
                float sobelSample = compensation ? sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth / 2., pixelRatio) : sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth, pixelRatio);
                resultAlpha = smoothstep(outlineThreshold - outlineSmoothing, outlineThreshold + outlineSmoothing, sobelSample);

                //resultAlpha = 1.0;
                //result = vec3(sobelSample);

                float t = 1.0 - contourThreshold;
                if(positionalLines) {
                    vec3 NDir = position * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float f  = fract(NT * contourFrequency * 0.01);
                    float df = fwidth(NT * contourFrequency);

                    float g = smoothstep(df * (contourWidth * 0.01), df * (contourWidth * 0.01 * 2.0), f);
                    if (g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0;
                    }
                 }
                 else {
                    vec3 NDir = N * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float df = fwidth(NT * contourThreshold);
                    float f = sin(NT * 1.0 * contourFrequency);
                    float g = smoothstep(0.0, df * contourWidth, 1.0 - f);

                    if (df > (t * 0.5) && g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0 - g;
                    }
                 }

                 float lalpha = alpha * resultAlpha * mask;
                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
				 
                 return result;
             }`,[e])}}();var _f=class extends tr{constructor(e,t,i,n,r,s,a,o,l,c,u,h,d,p,g,x,y,b){super("v3"),this.nodeType="Pattern",this.style=e,this.projection=t,this.axis=i,this.blending=n,this.offset=r,this.colorA=s,this.colorB=a,this.frequency=o,this.size=l,this.variation=c,this.smoothness=u,this.zigzag=h,this.rotation=d,this.vertical=p,this.horizontal=g,this.sides=x,this.isMask=b,this.alpha=y,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){e.require("position"),e.require("uv"),e.requires.uv=[!0],e.require("normal"),e.requires.normal=!0,e.addFragmentVariable(this.calpha,"float");let i;switch(this.style.value){case 0:i="circle";break;case 1:i="ring";break;case 2:i="polygon";break;case 3:i="xcross";break;case 4:i="diamond";break;case 5:i="checkerboard";break;case 6:i="line";break;case 7:i="wave";break;default:i="circle";break}let n=`g${this.uuid.toString().replace(/-/g,"")}`,r=new Ft(`float hashwithoutsine12(vec2 p)
				{
					vec3 p3 = fract(vec3(p.xyx) * .1031);
					p3 += dot(p3, p3.yzx + 33.33);
					return fract((p3.x + p3.y) * p3.z);
				}`),s=new Ft(`vec2 rotate_uv(in vec2 uv, float a, bool repeat) 
				{
					const float mid = 0.5;
					float radians = a * (PI / 180.0);
					vec2 rotated = vec2(
						cos(radians) * (uv.x - mid) + sin(radians) * (uv.y - mid) + mid,
						cos(radians) * (uv.y - mid) - sin(radians) * (uv.x - mid) + mid
					);
					return repeat ? fract(rotated): rotated;
				}`),a="";if(this.projection.value===4){let u=this.style.value===2?`${i}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,h=this.style.value===2?`${i}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,d=this.style.value===2?`${i}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation)`;a=`
				vec3 p = position;
				float factor = 0.0125;
				vec2 uv0 = fract(p.xy * factor);
				vec2 uv1 = fract(p.zy * factor);
				vec2 uv2 = fract(p.xz * factor);
				
				uv0 = rotate_uv(uv0 + offset, rotation, true);
				uv1 = rotate_uv(uv1 + offset, rotation, true);
				uv2 = rotate_uv(uv2 + offset, rotation, true);
	
				float d0 = ${u};
				float d1 = ${h};
				float d2 = ${d};
				
				// Range from 3 to 128 seems to be good
				float exponent = (1.0 - blending) * 125.0 + 3.0;

				vec3 n = vObjectNormal;
				vec3 weights = abs(normalize(n));
				weights = pow(weights, vec3(exponent));
				weights /= dot(weights, vec3(1.0));
				d0 *= weights.z;
				d1 *= weights.x;
				d2 *= weights.y;
				float draw = d0 + d1 + d2;
	
				vec2 custom_uv = uv0 * weights.z + uv1 * weights.x + uv2 * weights.y;
				`}else{let u=this.style.value===2?`${i}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,h="";this.axis.value===0?h=`float radius = length(p);
					float theta = atan(p.y, p.z);
					float phi = acos(p.x / radius);`:this.axis.value===1?h=`float radius = length(p);
					float theta = atan(p.x, p.z);
					float phi = acos(p.y / radius);`:(this.axis.value,h=`float radius = length(p);
					float theta = atan(p.y, p.x);
					float phi = acos(p.z / radius);`);let d="";switch(this.projection.value){case 0:d="custom_uv = vUv.st;";break;case 1:break;case 2:d=`
							vec3 p = position;
							${h}
							custom_uv = vec2(theta, phi);
							custom_uv /= PI;
							`;break}a=`
				vec2 custom_uv;
				${d}
	
				custom_uv += offset;
				custom_uv = fract(custom_uv);
				custom_uv = rotate_uv(custom_uv, rotation, true);
	
				float draw = ${u};
				`}let o=new Ft(`vec3 ${n}_pattern(vec3 normal, float blending, int style, vec2 offset, vec4 colorA, vec4 colorB, vec2 frequency, float size, float variation, float smoothness, float zigzag, float rotation, vec2 vertical, vec2 horizontal, int sides, bool isMask, float mask, float alpha, out float calpha) {
					const float TWO_PI = PI * 2.0;
					float smoothness_remapped = pow(smoothness, 5.0);	

					${a}

					// Construct final output color
					vec4 color = mix(colorA, colorB, draw);
					color.a = clamp(color.a, 0.0, 1.0);

					// Apply cuts
					color.a *= 
						step(vertical.x, custom_uv.y) * 
						step(custom_uv.y, vertical.y);
					color.a *= 
						step(horizontal.x, abs(custom_uv.x)) * 
						step(abs(custom_uv.x), horizontal.y);

					// Accumulate alpha 
					float lalpha = alpha * clamp(color.a, 0.0, 1.0) * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

					return clamp(color, 0.0, 1.0).rgb;
				}`,[s,r,_f.DrawFunctions.circle,_f.DrawFunctions.ring,_f.DrawFunctions.polygon,_f.DrawFunctions.cross,_f.DrawFunctions.diamond,_f.DrawFunctions.checkerboard,_f.DrawFunctions.line,_f.DrawFunctions.wave]),l=e.include(o),c=[];return c.push("normal"),c.push(this.blending.build(e,"f")),c.push(this.style.build(e,"i")),c.push(this.offset.build(e,"v2")),c.push(this.colorA.build(e,"v4")),c.push(this.colorB.build(e,"v4")),c.push(this.frequency.build(e,"v2")),c.push(this.size.build(e,"f")),c.push(this.variation.build(e,"f")),c.push(this.smoothness.build(e,"f")),c.push(this.zigzag.build(e,"f")),c.push(this.rotation.build(e,"f")),c.push(this.vertical.build(e,"v2")),c.push(this.horizontal.build(e,"v2")),c.push(this.sides.build(e,"i")),c.push(this.isMask.build(e,"b")),c.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),c.push(this.alpha.build(e,"f")),c.push(this.calpha),e.format(l+"("+c.join(",")+")",this.getType(e),t)}else return console.warn("PatterNode is not compatible with "+e.shader+" shader."),e.format("vec3(0.0)",this.getType(e),t)}},Yee=_f;Yee.DrawFunctions=function(){let e=new Ft(`float hashwithoutsine12(vec2 p) {
				vec3 p3 = fract(vec3(p.xyx) * 0.1031);
				p3 += dot(p3, p3.yzx + 33.33);
				return fract((p3.x + p3.y) * p3.z);
			}`),t=new Ft(`vec2 tile_and_center(in vec2 uv, in vec2 frequency, in float variation, in float zigzag, in float rotation) {
                // Create tiles in UV-space
                uv *= frequency;

                // Integer coords
                vec2 i = floor(uv);

                // Offset every other row based on zigzag param, then compute fractional coords
                float row_offset = mod(i.y, 2.0);
                uv.x += row_offset * zigzag;
                vec2 f = fract(uv);

				// Rotate the tile itself:
				// const float mid = 0.5;
				// f = vec2(
				// 	cos(rotation) * (f.x - mid) + sin(rotation) * (f.y - mid) + mid,
				// 	cos(rotation) * (f.y - mid) - sin(rotation) * (f.x - mid) + mid
				// );
				// f = fract(f);

                f = f * 2.0 - 1.0;

				// Recompute integer coords after shifting - then, random value per tile 
				i = floor(uv);
				float rand = (hashwithoutsine12(i) * 5.0 + 1.0);
				float jitter = mix(1.0, rand, variation);
				f *= jitter;

                return f;
            }`,[e]),i=new Ft(`float circle(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(
                    -smoothness, 
                     smoothness, 
                     length(f) - size
                );
            }`,[t]),n=new Ft(`float ring(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);

				float d = length(f);
                const float inner_width = 0.5;

                float outer = smoothstep(-smoothness, smoothness, d - size);
                float inner = smoothstep(-smoothness, smoothness, d - size * inner_width);
				return outer + (1.0 - inner);   
            }`,[t]),r=new Ft(`float sdf_ngon(in vec2 p, in float r, in int n) {
                float an = (PI * 2.0) / float(n);
                float he = r * tan(0.5 * an);
                
                // Rotate to first sector
                p = -p.yx; 
                float bn = an * floor((atan(p.y, p.x) + 0.5 * an) / an);
                vec2  cs = vec2(cos(bn), sin(bn));
                p = mat2(cs.x, -cs.y, cs.y, cs.x)*p;
            
                // Side of polygon
                return length(p - vec2(r, clamp(p.y, -he, he))) * sign(p.x - r);
            }
            
            float polygon(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation, in int sides) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(-smoothness, smoothness, sdf_ngon(f, size, sides));
            }`,[t]),s=new Ft(`float sdf_cross(in vec2 p, in vec2 b, float r ) {
                p = abs(p); 
				p = (p.y > p.x) ? p.yx : p.xy;
                vec2  q = p - b;
                float k = max(q.y, q.x);
                vec2  w = (k > 0.0) ? q : vec2(b.y - p.x, -k);
                return sign(k) * length(max(w, 0.0)) + r;
            }
            
            // Avoid namespace conflicts 
            float xcross(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(-smoothness, smoothness, sdf_cross(f, vec2(size, size * 0.25), smoothness));
            }`,[t]),a=new Ft(`float ndot(vec2 a, vec2 b) { 
                return a.x*b.x - a.y*b.y; 
            }
            
            float sdf_diamond(in vec2 p, in vec2 b) {
                p = abs(p);
                float h = clamp(ndot(b - 2.0 * p, b) / dot(b, b), -1.0, 1.0);
                float d = length(p - 0.5 * b * vec2(1.0 - h, 1.0 + h));
                return d * sign(p.x * b.y + p.y * b.x - b.x * b.y);
            }

            float diamond(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
	            return smoothstep(-smoothness, smoothness, sdf_diamond(f, vec2(size)));
            }`,[t]),o=new Ft(`float checkerboard(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                uv *= frequency;
                vec2 i = floor(uv);

                float offset = mod(i.y, 2.0);

                uv.x += offset + zigzag * offset;
                float x = floor(uv.x);
                
                return mod(x, 2.0);
            }`),l=new Ft(`float line(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, 0.0, zigzag, rotation);
				
				// Different approach for variation param here
				float row = floor(uv * frequency).y;
				float rand = hashwithoutsine12(vec2(row));
				float s = mix(size, size * rand, variation);

				return smoothstep(
					s - smoothness, 
					s + smoothness, 
					abs(f.y)
				);
            }`,[t]),c=new Ft(`// Uses bisection 
            float udf_cos(in vec2 p, in float a, in float b, in float c, in float d) {
                // Convert all data to a primitive cosine wave
                p = c * (p - vec2(d, a));
                
                const float TWO_PI = PI * 2.0;

                // Reduce to principal half cycle
                p.x = mod(p.x, TWO_PI); 
                if (p.x > PI) {
                    p.x = TWO_PI - p.x;
                }
            
                // Find zero of derivative (minimize distance)
                float xa = 0.0;
                float xb = TWO_PI;

                // 24 bit precision
                for (int i = 0; i < 24; i++) {
                    float x = 0.5 * (xa + xb);
                    float y = x - p.x + b * c * sin(x) * (p.y - b * c * cos(x));
                    if (y < 0.0) xa = x; 
                    else xb = x;
                }
                float x = 0.5 * (xa + xb);
                
                // Compute distance    
                vec2 q = vec2(x, b * c * cos(x));
                return length(p - q) / c;
            }

            float wave(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                float repeat = frequency.x;
                uv *= repeat;
                vec2 i = floor(uv);
                float row_offset = mod(i.y, 2.0);
                uv.x += row_offset * zigzag;
                vec2 f = vec2(uv.x, fract(uv.y));

                // Generalized cosine: y(x) = a + b * cos(cx + d)
                const float amplitude = 0.125;
                float wave_frequency = frequency.y * 0.1;
                float distance_estimate = udf_cos(f, 0.50, amplitude, wave_frequency * (2.0 * PI), 0.0);

				// Different approach for variation param here
				float rand = hashwithoutsine12(vec2(i.y));
				float s = mix(size, size * rand, variation);

                return smoothstep(-smoothness, smoothness, distance_estimate - s * 0.5);
            }`);return{tileAndCenter:t,circle:i,ring:n,polygon:r,cross:s,diamond:a,checkerboard:o,line:l,wave:c}}();var Qee=class extends tr{constructor(e,t,i,n,r,s,a,o){super("v3"),this.nodeType="Rainbow",this.filmThickness=e,this.movement=t,this.wavelengths=i,this.noiseStrength=n,this.noiseScale=r,this.offset=s,this.isMask=o,this.alpha=a,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let i=e.include(Qee.Nodes.rainbow),n=[];return n.push(this.filmThickness.build(e,"f")),n.push(this.movement.build(e,"f")),n.push(this.wavelengths.build(e,"v3")),n.push(this.noiseStrength.build(e,"f")),n.push(this.noiseScale.build(e,"f")),n.push(this.offset.build(e,"v3")),n.push(this.isMask.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),e.format(i+"("+n.join(",")+")",this.getType(e),t)}else return console.warn("RainbowNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Kee=Qee;Kee.Nodes=function(){let e=new Ft(`vec3 attenuation(vec3 wavelengths, float filmThickness, float movement, float noiseStrength, float noiseScale, vec3 offset) {
				float f = 0.0;
				
				if (noiseStrength != 0.0) {
					vec3 st = position / noiseScale;
					float noise = simplexFast(1.6 * st + vec3(1.8, 1.5, 1.9) * simplexFast(st) + vec3(1.7, 9.2, 1.0));
					f = noise * noiseStrength;
				}

				vec3 waves = wavelengths * vec3(1.0, 0.8, 0.6) + 1.0;
				float angle = dot(normalize(vWorldViewDir + (offset * -0.001)), normalize(vWNormal));

				mediump vec3 color = cos((((filmThickness + f) / waves) * angle) + movement);
				return .5 + .5 * color;
			 }`,[Al.simplexFast]);return{rainbow:new Ft(`vec3 rainbow(float filmThickness, float movement, vec3 wavelengths, float noiseStrength, float noiseScale, vec3 offset, bool isMask, float mask, float alpha, out float calpha) {
				mediump vec3 res = clamp(attenuation(wavelengths, filmThickness, movement, noiseStrength, noiseScale, offset), 0.0, 2.0);

				float rainbowContribution = clamp(res.r + res.g + res.b, 0.0, 1.0);

				float lalpha = alpha * rainbowContribution * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return res;
			 }`,[e])}}();var Jee=class extends tr{constructor(e,t,i,n,r,s,a,o,l,c){super("v3"),this.nodeType="Toon",this.positioning=e,this.colors=t,this.steps=i,this.source=n,this.isWorldSpace=r,this.noiseStrength=s,this.noiseScale=a,this.shadowColor=o,this.offset=l,this.alpha=c,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("worldNormal"),e.require("worldPosition"),e.isShader("fragment")){e.define("COLORS_MAX",10),e.addFragmentVariable(this.calpha,"float");let i=e.include(Jee.Nodes.toon),n=[];return n.push(this.positioning.build(e,"i")),n.push(this.colors.build(e,"v4[]")),n.push(this.steps.build(e,"f[]")),n.push(this.source.build(e,"v3")),n.push(this.isWorldSpace.build(e,"b")),n.push(this.noiseStrength.build(e,"f")),n.push(this.noiseScale.build(e,"f")),n.push(this.shadowColor.build(e,"v4")),n.push(this.offset.build(e,"v3")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),e.format(i+"("+n.join(",")+")",this.getType(e),t)}else return console.warn("ToonNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Zee=Jee;Zee.Nodes=function(){let e=new Ft(`float rand(float n) {
				return fract(sin(n) * 43758.5453123);
			}`),t=new Ft(`float hash1(float p) { 
				p = fract(p * 0.011); 
				p *= p + 7.5; 
				p *= p + p; 
				return fract(p); 
			}`),i=new Ft(`float valueNoise(vec3 x) {
				const vec3 step = vec3(110, 241, 171);
			
				vec3 i = floor(x);
				vec3 f = fract(x);
			 
				// For performance, compute the base input to a 1D hash from the integer part of the argument and the 
				// incremental change to the 1D based on the 3D -> 1D wrapping
				float n = dot(i, step);
			
				vec3 u = f * f * (3.0 - 2.0 * f);
				return mix(mix(mix( hash1(n + dot(step, vec3(0, 0, 0))), hash1(n + dot(step, vec3(1, 0, 0))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 0))), hash1(n + dot(step, vec3(1, 1, 0))), u.x), u.y),
						   mix(mix( hash1(n + dot(step, vec3(0, 0, 1))), hash1(n + dot(step, vec3(1, 0, 1))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 1))), hash1(n + dot(step, vec3(1, 1, 1))), u.x), u.y), u.z);
			}`,[t]),n=new Ft(`vec3 hash3(vec3 x) {
				x = vec3(dot(x,vec3(127.1, 311.7, 74.7)),
						 dot(x,vec3(269.5, 183.3, 246.1)),
						 dot(x,vec3(113.5, 271.9, 124.6)));
			
				return fract(sin(x)*43758.5453123);
			}`),r=new Ft(`vec3 voronoiNoise(in vec3 x)
			{
				vec3 p = floor(x);
				vec3 f = fract(x);

				float id = 0.0;
				vec2 res = vec2(100.0);

				for(int k=-1; k<=1; k++)
				for(int j=-1; j<=1; j++)
				for(int i=-1; i<=1; i++)
				{
					vec3 b = vec3(float(i), float(j), float(k));

					// Comment out the "+ hash(p + b);" part below to get "square" cells
					vec3 r = vec3(b) - f + hash3(p + b);
					float d = dot(r, r);

					if (d < res.x)
					{
						id = dot(p + b, vec3(1.0, 57.0, 113.0));
						res = vec2(d, res.x);			
					}
					else if (d < res.y)
					{
						res.y = d;
					}
				}

				return vec3(sqrt(res), abs(id));
			}
			`,[n]);return{toon:new Ft(`vec3 toon(int positioning, vec4 colors[COLORS_MAX], float steps[COLORS_MAX], vec3 source, bool isWorldSpace, float noiseStrength, float noiseScale, vec4 shadowColor, vec3 offset, float mask, float alpha, out float calpha) {
				float t = 0.0;
				float shadow = 1.0;

				if (positioning == 0) {

					// Can't do this mode if lighting is "none"
					#if (defined(PHONG) || defined(LAMBERT) || defined(STANDARD))

						// Algorithm from Chapter 10 of Graphics Shaders
						const vec3 weights = vec3(0.2125, 0.7154, 0.0721);
						vec3 lpos;
						vec3 l;
						float dproduct;

						#if (NUM_POINT_LIGHTS > 0)

							#if defined(USE_SHADOWMAP) && (NUM_POINT_LIGHT_SHADOWS > 0)
								PointLightShadow pointLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_POINT_LIGHTS; i++) {
								// Light positions are in view-space for some reason?
								lpos = (inverse(viewMatrix) * vec4(pointLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								
								// TODO: we want to use "intensity" but it isn't available in the shader code
								//dproduct += dot(pointLights[UNROLLED_LOOP_INDEX].color, weights);

								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS)
									pointLightShadow = pointLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getPointShadow( 
											pointShadowMap[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowMapSize, 
											pointLightShadow.shadowBias, 
											pointLightShadow.shadowRadius,
											vPointShadowCoord[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowCameraNear, 
											pointLightShadow.shadowCameraFar);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_DIR_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_DIR_LIGHT_SHADOWS > 0)
								DirectionalLightShadow directionalLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_DIR_LIGHTS; i++) {
								// Use the direction vector for directional lights instead
								l = (inverse(viewMatrix) * vec4(directionalLights[UNROLLED_LOOP_INDEX].direction, 0.0)).xyz;
		
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS)
									directionalLightShadow = directionalLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow( 
										UNROLLED_LOOP_INDEX,
										directionalShadowMap[UNROLLED_LOOP_INDEX], 
										directionalLightShadow.shadowMapSize, 
										directionalLightShadow.shadowBias, 
										directionalLightShadow.shadowRadius, 
										vDirectionalShadowCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_SPOT_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_SPOT_LIGHT_SHADOWS > 0)
								SpotLightShadow spotLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_SPOT_LIGHTS; i++) {
								lpos = (inverse(viewMatrix) * vec4(spotLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS)
									spotLightShadow = spotLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow(
										UNROLLED_LOOP_INDEX,
										spotShadowMap[UNROLLED_LOOP_INDEX], 
										spotLightShadow.shadowMapSize, 
										spotLightShadow.shadowBias, 
										spotLightShadow.shadowRadius, 
										vSpotLightCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						t = clamp(t, 0.0, 1.0);
				
					#endif

				} else if (positioning == 1) {
					
					vec3 origin = mix(position, worldPosition, float(isWorldSpace));
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	

				} else {

					vec3 origin = worldPosition;
					vec3 source = cameraPosition - offset;
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	
					
				}

				if (noiseStrength > 0.0) {
					// Distort with noise
					vec3 st = position / noiseScale;
					
					// Voronoi "smooth" noise
					float noise = 1.0 - voronoiNoise(st).x;

					// Voronoi cellular noise
					//float noise = 1.0 - rand(voronoiNoise(st).z);

					// Position warp noise
					// vec3 offset = vec3(
					// 	simplexFast(st),
					// 	simplexFast(st + vec3(111.1, 143.89, 217.19)),
					// 	simplexFast(st + vec3(171.1, 247.89, 117.23))
					// );
					// st += offset;
					// float noise = valueNoise(st);

					t += noise * noiseStrength;
				}

				t = clamp(t, 0.0, 1.0);

				// Compute ramp color
				float p;
				vec4 color = colors[0];
				for (int i = 1; i < COLORS_MAX; i++) {
					p = clamp((t - steps[i-1]) / (steps[i] - steps[i-1]), 0.0, 1.0);
					color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
				}

				// Incorporate custom shadow color
				if (positioning == 0) {

					vec3 blendedShadow = mix(color.rgb, shadowColor.rgb, shadowColor.a);
					color.rgb = mix(blendedShadow, color.rgb, shadow);
				
				}

				// Accumulate alpha as usual
				float lalpha = alpha * color.a * mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;

				return color.xyz;

            }`,[Al.simplexFast,e,i,r])}}();var WNe=function(){return{textureBicubic:new Ft(`float w0( float a ) {
            return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
        }
    
        float w1( float a ) {
            return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
        }
    
        float w2( float a ){
            return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
        }
    
        float w3( float a ) {
            return ( 1.0 / 6.0 ) * ( a * a * a );
        }
    
        // g0 and g1 are the two amplitude functions
        float g0( float a ) {
            return w0( a ) + w1( a );
        }
    
        float g1( float a ) {
            return w2( a ) + w3( a );
        }
    
        // h0 and h1 are the two offset functions
        float h0( float a ) {
            return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
        }
    
        float h1( float a ) {
            return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
        }
    
        vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
            uv = uv * texelSize.zw + 0.5;
    
            vec2 iuv = floor( uv );
            vec2 fuv = fract( uv );
    
            float g0x = g0( fuv.x );
            float g1x = g1( fuv.x );
            float h0x = h0( fuv.x );
            float h1x = h1( fuv.x );
            float h0y = h0( fuv.y );
            float h1y = h1( fuv.y );
    
            vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
            vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
            vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
            vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
    
            return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) + 
                   g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
        }

        vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
            vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
            vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
            vec2 fLodSizeInv = 1.0 / fLodSize;
            vec2 cLodSizeInv = 1.0 / cLodSize;
            vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
            vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
            return mix( fSample, cSample, fract( lod ) );
        }`)}}();function XNe(e,t){return e>=t?new Ae(t/e,1):new Ae(1,e/t)}var $ee=class extends tr{constructor(e,t,i,n,r,s,a,o){super("v3"),this.nodeType="Transmission",this.thickness=e,this.ior=t,this.roughness=i,this.transmissionSamplerSize=n,this.transmissionSamplerMap=r,this.transmissionDepthMap=s,this.aspectRatio=a,this.alpha=o,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0,e.isShader("fragment")){e.define("NUM_SAMPLES",6),e.define("BLUR_SLOD",Math.pow(2,xi.transmissionLod.value)),e.require("worldPosition"),e.requires.worldNormal=!0,e.requires.modelMatrix=!0,e.requires.projectionMatrix=!0,e.addFragmentVariable(this.calpha,"float");let i=e.include($ee.Nodes.transmission),n=[];return n.push(this.thickness.build(e,"f")),n.push(this.ior.build(e,"f")),n.push(this.roughness.build(e,"f")),n.push(this.transmissionSamplerSize.build(e,"v2")),n.push(this.transmissionSamplerMap.getTexture(e,"t")),n.push(this.transmissionDepthMap.getTexture(e,"t")),n.push(this.aspectRatio.build(e,"v2")),n.push("normal"),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),e.format(i+"("+n.join(",")+")",this.getType(e),t)}else return console.warn("TransmissionNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},ete=$ee;ete.Nodes=function(){let e=new Ft(`vec3 blur(sampler2D sp, vec2 U, vec2 scale, float lod, sampler2D dm, vec2 unrefractedU, vec2 aspectRatio) {
                // Slightly modified version of this:
                // https://www.shadertoy.com/view/ltScRG

				// Special case for blur == 0.0
				if (lod == 0.0) {
					#ifdef TEXTURE_LOD_EXT
					return texture2DLodEXT( sp, U, 0.0).rgb;
					#else
					return textureLod( sp, U, 0.0).rgb;
					#endif
				}
				
				vec2 texelSize = vec2(1.0) / resolution;
                vec2 halton = haltonSequence[frameIndex];
                float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
                float temporalAngle  = temporalOffset * PI2;
				vec3 res = vec3(0.0);
                vec2 uv = vec2(0.0);
                vec2 offset = vec2(0.0);
                vec2 vogelSample = vec2(0.0);
                for (int i = 0; i < NUM_SAMPLES; i++) {
                    vogelSample =  vogelDiskSample(i, NUM_SAMPLES, temporalAngle) * texelSize;
                    offset = vogelSample * scale * (lod * 10.0); // TODO: used to be hardcoded to 20
                    uv = U + offset;
                    float opaqueDepth = unpackRGBAToDepth(textureLod(dm, uv, lod));
                    if (opaqueDepth != 0.0 && opaqueDepth < gl_FragCoord.z) {
                        uv = unrefractedU;
                        lod = lod > 4.0 ? lod : lod / 2.0;
                    }
                    res += textureLod(sp, uv, lod).rgb;
                }
                return res / float(NUM_SAMPLES);
            }`),t=new Ft(`vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {
		        // Direction of refracted light.
		        vec3 refractionVector = refract( -v,  n, 1.0 / ior );
		        
				// Compute rotation-independant scaling of the model matrix.
		        vec3 modelScale;
		        modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		        modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		        modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );

		        // The thickness is specified in local space
		        return normalize( refractionVector ) * thickness * modelScale;
	        }`),i=new Ft(`float applyIorToRoughness( float roughness, float ior ) {
				// Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and
				// an IOR of 1.5 results in the default amount of microfacet refraction.
				return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
			}`),n=new Ft(`vec3 getTransmissionSample( vec2 fragCoord, float roughness, float ior, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 unrefractedCoords, vec2 aspectRatio) {
				// Threejs exports do not pass a depth map to this shader, so we have to fallback to the "Threejs method of blurring" - see
				// also the code in convertTransmission.ts, which runs during export
				#ifdef IS_THREEJS_EXPORT
					float lod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness / 5.0, ior);
					return textureBicubic(transmissionSamplerMap, fragCoord.xy, lod).rgb;
				#else
					float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
					float lod = applyIorToRoughness(roughness, ior);
					return blur(transmissionSamplerMap, fragCoord, vec2(lod), min(framebufferLod / 5.5, 8.5), transmissionDepthMap, unrefractedCoords, aspectRatio);
				#endif
			}`,[WNe.textureBicubic,i,e]),r=new Ft(`vec3 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;

				// Project refracted vector on the framebuffer, while mapping to normalized device coordinates.
				vec4 ndcPos = projMatrix * viewMatrix *  vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;

				vec4 ndcPosUnrefracted = projMatrix * viewMatrix * vec4(position, 1.0 );
				vec2 unrefractedCoords = ndcPosUnrefracted.xy / ndcPosUnrefracted.w;
				unrefractedCoords += 1.0;
				unrefractedCoords /= 2.0;

				// Sample framebuffer to get pixel the refracted ray hits.
				return getTransmissionSample( refractionCoords, roughness, ior, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, unrefractedCoords, aspectRatio );
    		}`,[n,t]);return{transmission:new Ft(`vec3 transmission(float thickness, float ior, float roughness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio, vec3 normal, float mask, float alpha, out float calpha) {
                vec3 v = vec3(0.);
                if (isOrthographic) {
                    v = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
                } else {
                    v = normalize(vWPosition - cameraPosition);
                }
                vec3 transmission = getIBLVolumeRefraction(vWNormal, -v, roughness,  vWPosition, modelMatrix, viewMatrix, projectionMatrix, ior, thickness, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, aspectRatio );
                
				float lalpha = alpha * mask;
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * alpha;

				return transmission;
            }`,[r])}}();var lz=(e=>(e.NOISE="noise",e.MAP="map",e))(lz||{}),tte=class extends tr{constructor(e,t,i,n,r,s,a,o,l,c,u){super("v3"),this.displacementTypeIndex=new lr(0),this.nodeType="VertexDisplacement",this.intensity=e,this.movementOrTexture=t,Object.values(lz)[this.displacementTypeIndex.value]==="map"&&(this.mat=new Uee(this.movementOrTexture.value.matrix)),this.cropOrOffset=i,this.scale=c,this.noiseFunctionIndex=u,this.voronoiStyle=n,this.smoothness=r,this.seed=s,this.highCut=a,this.lowCut=o,this.quality=l}generate(e,t){if(e.isShader("vertex")){e.define("USE_LAYER_DISPLACE");let i,n=[];switch(n.push("displaced_position"),n.push("displaced_normal"),Object.values(lz)[this.displacementTypeIndex.value]){case"map":{i=e.include(tte.Nodes.map),n.push(this.movementOrTexture.getTexture(e,"t")),n.push("uv"),n.push(this.cropOrOffset.build(e,"f")),this.mat&&n.push(this.mat.build(e,"mat3"));break}case"noise":{let r=["simplexPrecise","simplexFractal","simplexAshima","fbm","perlin","voronoi"][this.noiseFunctionIndex.value],s=new Ft(`vec3 orthogonal(vec3 v) {
							return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
						}`),a=r=="voronoi"?`
					float v = ${r}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1), voronoiStyle, smoothness, seed, quality);
					v = remap(v, lowCut, highCut, 0.0, 1.0);
					v = smax(v, 0.0, smoothness * 0.25);
					v = smin(v, 1.0, smoothness * 0.25);

					return p + n * v * intensity;
					`:`
					return p + n * ${r}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1)) * intensity;
					`,o=new Ft(`vec3 distorted(vec3 p, vec3 n, float scale, float intensity, vec3 offset, float neighbour_offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality) {
							${a}
						}`,[Al.simplexPrecise,Al.simplexFractal,Al.simplexAshima,Al.fbm,Al.perlin,Al.voronoi]),l=new Ft(`vec3 vertexDisplacementNoise(vec3 position, vec3 normal, float scale, vec3 offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality, float intensity, out vec3 displaced_normal) {
							vec3 displaced_position = distorted(position, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							vec3 tangent1 = orthogonal(normal);
							vec3 tangent2 = normalize(cross(normal, tangent1));

                            // TODO(Max): The distance to the neighbors was originally scaled by 0.1.
                            // This caused some small oval/circular visual artifacts in the lighting.
                            // For now, simply using neighbors further away betters the problem,
                            // but we should figure out the underlying cause when we have some time.
                            // Maybe its related to how we calculate the tangent and bitangent?
							vec3 nearby1 = position + tangent1;
							vec3 nearby2 = position + tangent2;
							vec3 distorted1 = distorted(nearby1, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							vec3 distorted2 = distorted(nearby2, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
							return displaced_position;
						}`,[o,s]);i=e.include(l),n.push(this.scale.build(e,"f")),n.push(this.cropOrOffset.build(e,"v3")),n.push(this.movementOrTexture.build(e,"f")),n.push(this.voronoiStyle.build(e,"i")),n.push(this.smoothness.build(e,"f")),n.push(this.seed.build(e,"f")),n.push(this.highCut.build(e,"f")),n.push(this.lowCut.build(e,"f")),n.push(this.quality.build(e,"i"));break}}return n.push(this.intensity.build(e,"f")),n.push("displaced_normal"),e.format(i+"("+n.join(",")+")",this.getType(e),t)}else return console.warn("VertexDisplacementNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},ite=tte;ite.Nodes=function(){let e=new Ft(`vec3 orthogonal(vec3 v) {
				return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
			}`),t=new Ft(`float displacementMapTexture(sampler2D tex, float crop, vec2 uv, mat3 mat, vec2 offset) {
				vec2 uvs = (mat * vec3(uv * 2.0 - 1.0, 1.0) / 2.0 + 0.5).xy + offset;
				vec4 tmp = texture2D(tex, uvs);
				vec3 col = tmp.rgb;
				if (crop > 0.5) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						return 0.0;
					}
				}
				return col.r;
			}`);return{map:new Ft(`vec3 vertexDisplacementMap(vec3 position, vec3 normal, sampler2D tex, vec2 uv, float crop, mat3 mat, float intensity, out vec3 displaced_normal) {
				vec3 displaced_position = position + normal * displacementMapTexture(tex, crop, uv, mat, vec2(0.0)) * intensity;
				vec3 tangent1 = normalize(orthogonal(normal));
				vec3 tangent2 = normalize(cross(normal, tangent1));
				vec3 nearby1 = position + tangent1 * 0.1;
				vec3 nearby2 = position + tangent2 * 0.1;
				vec3 distorted1 = nearby1 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				vec3 distorted2 = nearby2 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
				return displaced_position;
			}`,[e,t])}}();var xi={normalRenderTarget:new Lf,normalRenderTargetDepth:new Lf,transmissionRenderTarget:new Lf,aspectRatio:new Fa,transmissionSize:new Fa(2048,2048),transmissionRenderTargetDepth:new Lf,aoRenderTarget:new Lf,aoEnabled:new Qo,pixelRatioNode:new Qt(1),resolution:new Fa,penumbraSize:new Gv(5,.5),frameIndex:new lr(0),transmissionLod:new lr(2)};for(let e of Object.values(xi))e.isRenderGlobal=!0;var nte={skiaWasmUrl:"https://unpkg.com/@splinetool/ui-wasm@1.10.2/build/ui.wasm"},O5=class extends Xs{constructor(){super("basic"),this.nodeType="Basic",this.color=new es(nc),this.shadingAlpha=new Qt(1),this.shadingBlend=new lr(0),this.previousModelViewMatrix=new Ed,this.previouseProjectionMatrix=new Ed}get category(){return"phong"}generate(e){let t;if(e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:xi.frameIndex}),e.mergeUniform({resolution:xi.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(Db.merge([zt.fog])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>"].join(`
`));let n=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];i&&n.push(i.code,i.result?"displaced_position = "+i.result+";":""),n.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","	vNormal = transformedNormal;","#endif"),n.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>"),n.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=n.join(`
`)}else{this.color===void 0&&(this.color=new es(nc)),this.color.analyze(e,{slot:"color"}),this.alpha&&this.alpha.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"});let i=this.color.flow(e,"c",{slot:"color"}),n=this.alpha?this.alpha.flow(e,"f"):void 0,r=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0,s=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0;e.requires.transparent=n!==void 0,e.addParsCode(["varying vec3 vWPosition;","#include <fog_pars_fragment>","#include <dithering_pars_fragment>","varying vec3 vViewPosition;","#include <normal_pars_fragment>"].join(`
`));let a=["#include <normal_fragment_begin>",i.code];n&&a.push(n.code,"#ifdef ALPHATEST"," if ( "+n.result+" <= ALPHATEST ) discard;","#endif"),s?a.push(s.code,`vec3 outgoingLight = ${i.result};`,`vec3 finalColor = spe_blend(outgoingLight, ${s.result}, 1.0, SPE_BLENDING_NORMAL);`):a.push(`vec3 finalColor = ${i.result};`);let o="1.0";this.mask&&(this.mask.analyze(e),o=`luminance(${this.mask.flow(e,"v3").result})`),n?a.push(`gl_FragColor = vec4( finalColor, accumAlpha * ${n.result} * ${o} );`):a.push("gl_FragColor = vec4("+i.result+", 1.0 );"),r&&a.push(`gl_FragColor.a *= ${r.result};`),a.push("#include <fog_fragment>","#include <dithering_fragment>"),t=a.join(`
`)}return t}},qNe=class extends Xs{constructor(){super("lambert"),this.nodeType="Lambert",this.color=new es(nc),this.emissive=new es(0),this.emissiveIntensity=new Qt(1),this.previousModelViewMatrix=new Ed,this.previouseProjectionMatrix=new Ed,this.shadingAlpha=new Qt(1),this.shadingBlend=new lr(0),this.occlusion=new Qo(!0)}get category(){return"lambert"}build(e){let t;if(e.define("LAMBERT"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:xi.frameIndex}),e.mergeUniform({resolution:xi.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(Db.merge([zt.fog,zt.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","	varying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <color_pars_vertex>","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let n=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&n.push(i.code,i.result?"displaced_position = "+i.result+";":""),n.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),n.push("	#include <project_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>",`
					vec3 diffuse = vec3( 1.0 );
					GeometricContext geometry;
					geometry.position = mvPosition.xyz;
					geometry.normal = normalize( transformedNormal );
					geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
				`),n.push(`
					GeometricContext backGeometry;
					backGeometry.position = geometry.position;
					backGeometry.normal = -geometry.normal;
					backGeometry.viewDir = geometry.viewDir;
					vLightFront = vec3( 0.0 );
					vIndirectFront = vec3( 0.0 );
					#ifdef DOUBLE_SIDED
						vLightBack = vec3( 0.0 );
						vIndirectBack = vec3( 0.0 );
					#endif
					IncidentLight directLight;
					float dotNL;
					vec3 directLightColor_Diffuse;
					vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
					vIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );
					#ifdef DOUBLE_SIDED
						vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
						vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );
					#endif
					#if NUM_POINT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
							getPointLightInfo( pointLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_SPOT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
							getSpotLightInfo( spotLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_DIR_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
							getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_HEMI_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
							vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
							#ifdef DOUBLE_SIDED
								vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );
							#endif
						}
						#pragma unroll_loop_end
					#endif
				`,"	#include <shadowmap_vertex>","	#include <fog_vertex>"),n.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=n.join(`
`)}else{e.mergeUniform({penumbraSize:xi.penumbraSize}),e.mergeUniform({frameIndex:xi.frameIndex}),e.mergeUniform({aoMap:xi.aoRenderTarget}),e.mergeUniform({aoEnabled:xi.aoEnabled}),this.color===void 0&&(this.color=new es(nc)),this.color.analyze(e,{slot:"color"}),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let i=this.color.flow(e,"c",{slot:"color"}),n=this.emissive.flow(e,"c",{slot:"emissive"}),r=this.emissiveIntensity.flow(e,"f",{slot:"emissive"}),s=this.occlusion.flow(e,"b",{slot:"occlusion"}),a=this.shadingAlpha.flow(e,"f"),o=this.shadingBlend.flow(e,"i"),l=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,c=this.alpha?this.alpha.flow(e,"f"):void 0,u=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=c!==void 0,e.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#include <normal_pars_fragment>","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","	varying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <fog_pars_fragment>","#include <shadowmap_pars_fragment>","#include <shadowmask_pars_fragment>","#include <clipping_planes_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let h=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx, viewdy));
				bool isFrontFacing = (dot(normal, faceNormal) >= 0.0);
				`,"#include <clipping_planes_fragment>"];h.push(i.code,"vec3 diffuseColor = "+i.result+";","ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );"),c&&h.push(c.code,"#ifdef ALPHATEST","if ( "+c.result+" <= ALPHATEST ) discard;","#endif"),h.push("#ifdef DOUBLE_SIDED","	reflectedLight.indirectDiffuse += ( isFrontFacing ) ? vIndirectFront : vIndirectBack;","#else","	reflectedLight.indirectDiffuse += vIndirectFront;","#endif","#include <lightmap_fragment>","reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );","#ifdef DOUBLE_SIDED","	reflectedLight.directDiffuse = ( isFrontFacing ) ? vLightFront : vLightBack;","#else","	reflectedLight.directDiffuse = vLightFront;","#endif","reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();"),n&&h.push(n.code,"reflectedLight.directDiffuse += "+n.result+" * "+r.result+";"),h.push("vec3 ao = aoEnabled && "+s.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = (reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) ;");let d="1.0";this.mask&&(this.mask.analyze(e),d=`luminance(${this.mask.flow(e,"v3").result})`),h.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${a.result} * ${d} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${a.result} * ${d}, ${o.result} );

					outgoingLight *= ao;
				}
				`),l&&h.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),c?h.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${c.result} );`):h.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),u&&h.push(`gl_FragColor.a *= ${u.result};`),h.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=h.join(`
`)}return t}},fb=function(){let e=new Ft(`vec2 dHdxy(sampler2D bumpMap, vec2 bumpMapUv, float bumpScale) {

            // Gradient of UVs w.r.t. X coordinate (in screen-space)
            vec2 dSTdx = dFdx(bumpMapUv);

            // Gradient of UVs w.r.t. Y coordinate (in screen-space)
            vec2 dSTdy = dFdy(bumpMapUv);
            
            // Forward differencing
            float Hll = bumpScale * luminance(texture(bumpMap, bumpMapUv).rgb);
            float dBx = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdx).rgb) - Hll;
            float dBy = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdy).rgb) - Hll;
            
            return vec2( dBx, dBy );
        }`),t=new Ft(`vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
            vec3 vSigmaX = dFdx( surf_pos.xyz );
            vec3 vSigmaY = dFdy( surf_pos.xyz );
            vec3 vN = surf_norm; // normalized
            
            vN = normalize(vN);

            vec3 R1 = cross( vSigmaY, vN );
            vec3 R2 = cross( vN, vSigmaX );

            R1 = normalize(R1);
            R2 = normalize(R2);
    
            float fDet = dot( vSigmaX, R1 ) * faceDirection;
    
            vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
            return normalize( abs( fDet ) * vN - vGrad );
        }`);return{dHdxy:e,perturbNormalArb:t}}(),YNe=class extends Xs{constructor(){super("phong"),this.nodeType="Phong",this.color=new es(nc),this.specular=new es(1118481),this.shininess=new Qt(30),this.previousModelViewMatrix=new Ed,this.previouseProjectionMatrix=new Ed,this.shadingAlpha=new Qt(1),this.shadingBlend=new lr(0),this.occlusion=new Qo(!0)}get category(){return"phong"}build(e){let t;if(e.define("PHONG"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:xi.frameIndex}),e.mergeUniform({resolution:xi.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(Db.merge([zt.fog,zt.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let n=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&n.push(i.code,i.result?"displaced_position = "+i.result+";":""),n.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),n.push("	#include <project_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>","	#include <shadowmap_vertex>","	#include <fog_vertex>"),n.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=n.join(`
`)}else{e.mergeUniform({penumbraSize:xi.penumbraSize}),e.mergeUniform({frameIndex:xi.frameIndex}),e.mergeUniform({aoMap:xi.aoRenderTarget}),e.mergeUniform({aoEnabled:xi.aoEnabled}),this.color===void 0&&(this.color=new es(nc)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e);let i=this.occlusion.flow(e,"b",{slot:"occlusion"});this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let n=this.color.flow(e,"c",{slot:"color"}),r=this.specular.flow(e,"c"),s=this.shininess.flow(e,"f"),a=this.shadingAlpha.flow(e,"f"),o=this.shadingBlend.flow(e,"i"),l=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,c=this.alpha?this.alpha.flow(e,"f"):void 0,u=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=c!==void 0,e.addParsCode(["varying vec3 vWPosition;","uniform vec3 emissive;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let h=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	BlinnPhongMaterial material;"];if(this.bumpMap){e.include(fb.dHdxy),e.include(fb.perturbNormalArb);let p=this.bumpMap.texture.flow(e,"t"),g=this.bumpMap.flow(e,"v3"),x=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",y="";this.bumpMap.projection.value===4?y=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${p.result}, uv0, ${x});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${p.result}, uv1, ${x});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${p.result}, uv2, ${x});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:y=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${p.result}, bumpMapCachedUv, ${x});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,h.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${g.result};
					${y}
					`)}h.push(n.code,"	vec3 diffuseColor = "+n.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","	vec3 totalEmissiveRadiance = emissive;",r.code,"	vec3 specular = "+r.result+";",s.code,"	float shininess = max( 0.0001, "+s.result+" );","	float specularStrength = 1.0;"),c&&h.push(c.code,"#ifdef ALPHATEST","if ( "+c.result+" <= ALPHATEST ) discard;","#endif"),h.push("material.diffuseColor = diffuseColor;"),h.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),h.push("vec3 ao = aoEnabled && "+i.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;");let d="1.0";this.mask&&(this.mask.analyze(e),d=`luminance(${this.mask.flow(e,"v3").result})`),h.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${a.result} * ${d} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${a.result} * ${d}, ${o.result} );
					
					outgoingLight *= ao;
				}
				`),l&&h.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),c?h.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${c.result});`):h.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),u&&h.push(`gl_FragColor.a *= ${u.result};`),h.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=h.join(`
`)}return t}},QNe=class extends Xs{constructor(){super("standard"),this.nodeType="Standard",this.color=new es(nc),this.roughness=new Qt(.3),this.metalness=new Qt(0),this.reflectivity=new Qt(.5),this.previousModelViewMatrix=new Ed,this.previouseProjectionMatrix=new Ed,this.shadingAlpha=new Qt(1),this.shadingBlend=new lr(0),this.occlusion=new Qo(!0)}get category(){return"physical"}build(e){let t;if(e.define("STANDARD"),e.requires.lights=!0,e.extensions.derivatives=!0,e.extensions.shaderTextureLOD=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:xi.frameIndex}),e.mergeUniform({resolution:xi.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(Db.merge([zt.fog,zt.lights])),zt.LTC_1&&(e.uniforms.ltc_1={value:void 0},e.uniforms.ltc_2={value:void 0}),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let n=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];i&&n.push(i.code,i.result?"displaced_position = "+i.result+";":""),n.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),n.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),n.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=n.join(`
`)}else{e.mergeUniform({penumbraSize:xi.penumbraSize}),e.mergeUniform({frameIndex:xi.frameIndex}),e.mergeUniform({aoMap:xi.aoRenderTarget}),e.mergeUniform({aoEnabled:xi.aoEnabled});let i={gamma:!0};this.color===void 0&&(this.color=new es(nc)),this.color.analyze(e,{slot:"color",context:i}),this.roughness.analyze(e),this.metalness.analyze(e);let n=this.occlusion.flow(e,"b",{slot:"occlusion"});this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e),this.reflectivity&&this.reflectivity.analyze(e);let r=this.color.flow(e,"c",{slot:"color",context:i}),s=this.roughness.flow(e,"f"),a=this.metalness.flow(e,"f"),o=this.shadingAlpha.flow(e,"f"),l=this.shadingBlend.flow(e,"i"),c=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,u=this.alpha?this.alpha.flow(e,"f"):void 0,h=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0,d=this.reflectivity?this.reflectivity.flow(e,"f"):void 0;e.requires.transparent=u!==void 0,e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <dithering_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>"].join(`
`));let p=["#include <clipping_planes_fragment>","	#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	PhysicalMaterial material;","	material.diffuseColor = vec3( 1.0 );"];if(this.bumpMap){e.include(fb.dHdxy),e.include(fb.perturbNormalArb);let x=this.bumpMap.texture.flow(e,"t"),y=this.bumpMap.flow(e,"v3"),b=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",A="";this.bumpMap.projection.value===4?A=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${x.result}, uv0, ${b});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${x.result}, uv1, ${b});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${x.result}, uv2, ${b});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:A=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${x.result}, bumpMapCachedUv, ${b});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,p.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${y.result};
					${A}
					`)}if(p.push(r.code,"	vec3 diffuseColor = "+r.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",a.code,"	float metalnessFactor = "+a.result+";"),this.roughnessMap){let x=this.roughnessMap.texture.flow(e,"t"),y=this.roughnessMap.flow(e,"v3"),b="";this.roughnessMap.projection.value===4?b=`
					float roughnessChange = 1.0;
					{
						vec2 uv0 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						float r0 = luminance(texture(${x.result}, uv0).rgb) * roughnessScale;
						float r1 = luminance(texture(${x.result}, uv1).rgb) * roughnessScale;
						float r2 = luminance(texture(${x.result}, uv2).rgb) * roughnessScale;

						roughnessChange = (r0 * weights.z + r1 * weights.x + r2 * weights.y);
					}
					float roughnessFactor = roughnessChange * ${s.result};
					`:b=`
					vec2 roughnessMapCachedUv = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs;

					vec4 vals = texture(${x.result},  roughnessMapCachedUv);
					float roughnessFactor = luminance(vals.rgb) * ${s.result};
					`,p.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${y.result};

					const float roughnessScale = 1.0;

					${b}
				`)}else p.push(s.code,"	float roughnessFactor = "+s.result+";");u&&p.push(u.code,"#ifdef ALPHATEST","	if ( "+u.result+" <= ALPHATEST ) discard;","#endif"),p.push("vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );"),p.push("material.diffuseColor = diffuseColor * ( 1.0 - metalnessFactor );","material.roughness = max( roughnessFactor, 0.0525 );","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.roughness = clamp( roughnessFactor, 0.04, 1.0 );"),d?p.push(d.code,"material.specularColor = mix( vec3( 0.16 * pow2( "+d.result+" ) ), diffuseColor, metalnessFactor );"):p.push("material.specularColor = mix( vec3( 0.04 ), diffuseColor, metalnessFactor );"),p.push("#include <lights_fragment_begin>"),p.push("#include <lights_fragment_end>"),p.push("vec3 ao = aoEnabled && "+n.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular;");let g="1.0";this.mask&&(this.mask.analyze(e),g=`luminance(${this.mask.flow(e,"v3").result})`),p.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${o.result} * ${g} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${o.result} * ${g}, ${l.result} );
					
					outgoingLight *= ao;
				}
				`),c&&p.push(c.code,`outgoingLight = spe_blend(outgoingLight, ${c.result}, 1.0, SPE_BLENDING_NORMAL);`),u?p.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${u.result} );`):p.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),h&&p.push(`gl_FragColor.a *= ${h.result};`),p.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=p.join(`
`)}return t}},KNe=class extends Xs{constructor(){super("toon"),this.nodeType="Toon",this.color=new es(nc),this.specular=new es(1118481),this.shininess=new Qt(30),this.previousModelViewMatrix=new Ed,this.previouseProjectionMatrix=new Ed,this.shadingAlpha=new Qt(1),this.shadingBlend=new lr(0)}get category(){return"toon"}build(e){let t;if(e.define("TOON"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:xi.frameIndex}),e.mergeUniform({resolution:xi.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(Db.merge([zt.fog,zt.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let n=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&n.push(i.code,i.result?"displaced_position = "+i.result+";":""),n.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),n.push("	#include <project_vertex>","	#include <fog_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>","	#include <shadowmap_vertex>","	#include <fog_vertex>"),n.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=n.join(`
`)}else{e.mergeUniform({penumbraSize:xi.penumbraSize}),e.mergeUniform({frameIndex:xi.frameIndex}),e.mergeUniform({aoMap:xi.aoRenderTarget}),e.mergeUniform({aoEnabled:xi.aoEnabled}),this.color===void 0&&(this.color=new es(nc)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let i=this.color.flow(e,"c",{slot:"color"}),n=this.specular.flow(e,"c"),r=this.shininess.flow(e,"f"),s=this.shadingAlpha.flow(e,"f"),a=this.shadingBlend.flow(e,"i"),o=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,l=this.alpha?this.alpha.flow(e,"f"):void 0,c=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=l!==void 0,e.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vWPosition;","#include <normal_pars_fragment>","#include <gradientmap_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <dithering_pars_fragment>",`
					varying vec3 vViewPosition;
					struct ToonMaterial {
						vec3	diffuseColor;
						vec3	specularColor;
						float	specularShininess;
						float	specularStrength;
					};
					void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
			
						reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
						reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
					}
					void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
					}
					#define RE_Direct				RE_Direct_Toon
					#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
					#define Material_LightProbeLOD( material )	(0)
					`,"#include <shadowmap_pars_fragment>","#include <bumpmap_pars_fragment>","#include <normalmap_pars_fragment>"].join(`
`));let u=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	ToonMaterial material;"];if(this.bumpMap){e.include(fb.dHdxy),e.include(fb.perturbNormalArb);let d=this.bumpMap.texture.flow(e,"t"),p=this.bumpMap.flow(e,"v3"),g=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",x="";this.bumpMap.projection.value===4?x=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${d.result}, uv0, ${g});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${d.result}, uv1, ${g});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${d.result}, uv2, ${g});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:x=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${d.result}, bumpMapCachedUv, ${g});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,u.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${p.result};
					${x}
					`)}u.push(i.code,"	vec3 diffuseColor = "+i.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",n.code,"	vec3 specular = "+n.result+";",r.code,"	float shininess = max( 0.0001, "+r.result+" );","	float specularStrength = 1.0;"),l&&u.push(l.code,"#ifdef ALPHATEST","if ( "+l.result+" <= ALPHATEST ) discard;","#endif"),u.push("material.diffuseColor = diffuseColor;"),u.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),u.push("vec3 ao = aoEnabled ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) * ao) + reflectedLight.directSpecular;");let h="1.0";this.mask&&(this.mask.analyze(e),h=`luminance(${this.mask.flow(e,"v3").result})`),u.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${s.result} * ${h} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${s.result} * ${h}, ${a.result} );
				}
				`),o&&u.push(o.code,`outgoingLight = spe_blend(outgoingLight, ${o.result}, 1.0, SPE_BLENDING_NORMAL);`),l?u.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${l.result} );`):u.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),c&&u.push(`gl_FragColor.a *= ${c.result};`),u.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=u.join(`
`)}return t}},JNe=class{constructor(e=1e3*10){this.timeout=e,this.cache=new Map,this.head={data:null,time:0,src:null,next:null,prev:null},this.tail={data:null,time:1/0,src:null,next:null,prev:null},this.hasClean=!1,this.head.next=this.tail,this.tail.prev=this.head}log(...e){}remove(e){let t=this.cache.get(e);t&&(this.dispose(e,t.data),this.cache.delete(e),t.prev.next=t.next,t.next.prev=t.prev)}scheduleCleanup(){this.hasClean||(this.log("scheduled cleanup"),this.hasClean=!0,setTimeout(()=>{this.hasClean=!1,this.log("cleaning");let e=Date.now(),t=this.head.next;for(;t.time<e-this.timeout;)this.dispose(t.src,t.data),this.cache.delete(t.src),t=t.next,t.prev=this.head,this.head.next=t;this.head.next!==this.tail?this.scheduleCleanup():this.log("no more cleanup")},this.timeout+1e3))}has(e){var t;return(t=this.cache.get(e))==null?void 0:t.data}load(e){let t=Date.now(),i=this.cache.get(e);return i===void 0?(i={data:this.create(e),src:e,time:t,next:null,prev:null},this.cache.set(e,i)):(i.time=t,i.prev.next=i.next,i.next.prev=i.prev),i.prev=this.tail.prev,i.next=this.tail,this.tail.prev.next=i,this.tail.prev=i,this.scheduleCleanup(),i.data}},ZNe=class extends JNe{create(e){return URL.createObjectURL(new Blob([e]))}dispose(e,t){URL.revokeObjectURL(t)}},YI;function $Ne(e){return typeof e=="string"?e:(YI||(YI=new ZNe),YI.load(e))}var eze=class{constructor(e,t){this.data=e,this.cache=t,this.refCount=0}deref(){this.refCount,this.refCount-=1,this.refCount===0&&(this.cache.remove(this),this.dispose())}dispose(){this.refCount}},tze=class{constructor(){this.cache=new Map}remove(e){this.cache.delete(e.data)}load(e){let t=this.cache.get(e);return t===void 0&&(t=this.create(e),this.cache.set(e,t)),t.refCount+=1,t}},rte=class extends eze{constructor(e,t){super(e,t.imageHolderCache),this.data=e,this.shared=t,this.loaded=!1,this.isVideo=!1,this.isBuffer=!1,this._cache={1e3:{},1001:{},1002:{}},this.isVideo=e.type==="video",this.isBuffer=e.isWebGLRenderTarget===!0,this.loadPromise=this.updateSrc(this.isBuffer?e:e.data)}async updateSrc(e){if(typeof document>"u")return;this.disposeTextures(),this.loaded=!1;let t=()=>{this.loaded=!0;for(let n of Object.values(this._cache))for(let r of Object.values(n))for(let s of Object.values(r))s&&(s.image=this.img,s.needsUpdate=!0);this.shared.requestRender()};if(this.isBuffer)this.img=e,this.loaded=!0;else if(this.isVideo){if(this.img=document.createElement("video"),this.img.preload="auto",this.img.playsInline=!0,this.img.currentTime=.01,typeof e!="string"){var i=new FileReader;i.readAsDataURL(new Blob([e],{type:"video/mp4"}));let n;await new Promise(r=>{i.onloadend=s=>{var a;n=(a=s.target)==null?void 0:a.result,r(null)}}),this.img.src=n}else this.img.src=e;this.img.onloadeddata=()=>{t()}}else this.img=new Image,this.img.src=$Ne(e),this.img.onload=t,await new Promise(n=>{this.img.onload=()=>{t(),n(null)}})}getTexture(e,t=1008,i=1006){var r,s;let n=(s=(r=this._cache[e])==null?void 0:r[t])==null?void 0:s[i];if(n)return n;{let a;return this.isBuffer?a=this.img.texture:this.isVideo?a=new SMe(this.img,void 0,e,e):a=new Hr(this.img,void 0,e,e,i,t),this.loaded&&(a.needsUpdate=!0),this._cache[e]===void 0&&(this._cache[e]={}),this._cache[e][t]===void 0&&(this._cache[e][t]={}),this._cache[e][t][i]=a,a}}setNeedsUpdate(e){for(let t of Object.values(this._cache))for(let i of Object.values(t))for(let n of Object.values(i))n&&(n.needsUpdate=e)}disposeTextures(){for(let[e,t]of Object.entries(this._cache))for(let[i,n]of Object.entries(t))for(let[r,s]of Object.entries(n))s==null||s.dispose(),this._cache[e]!==void 0&&this._cache[e][i]!==void 0&&(this._cache[e][i][r]=void 0)}dispose(){super.dispose(),this.disposeTextures()}},Im=class extends rte{};function ize(e,t){var i=aze(t);return i.formatToParts?rze(i,e):sze(i,e)}var nze={year:0,month:1,day:2,hour:3,minute:4,second:5};function rze(e,t){try{for(var i=e.formatToParts(t),n=[],r=0;r<i.length;r++){var s=nze[i[r].type];s>=0&&(n[s]=parseInt(i[r].value,10))}return n}catch(a){if(a instanceof RangeError)return[NaN];throw a}}function sze(e,t){var i=e.format(t).replace(/\u200E/g,""),n=/(\d+)\/(\d+)\/(\d+),? (\d+):(\d+):(\d+)/.exec(i);return[n[3],n[1],n[2],n[4],n[5],n[6]]}var QI={};function aze(e){if(!QI[e]){var t=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:"America/New_York",year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date("2014-06-25T04:00:00.123Z")),i=t==="06/25/2014, 00:00:00"||t==="06/25/2014 00:00:00";QI[e]=i?new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:e,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):new Intl.DateTimeFormat("en-US",{hourCycle:"h23",timeZone:e,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}return QI[e]}function ste(e,t,i,n,r,s,a){var o=new Date(0);return o.setUTCFullYear(e,t,i),o.setUTCHours(n,r,s,a),o}var qW=36e5,oze=6e4,KI={timezoneZ:/^(Z)$/,timezoneHH:/^([+-]\d{2})$/,timezoneHHMM:/^([+-]\d{2}):?(\d{2})$/};function ate(e,t,i){var n,r;if(!e||(n=KI.timezoneZ.exec(e),n))return 0;var s;if(n=KI.timezoneHH.exec(e),n)return s=parseInt(n[1],10),YW(s)?-(s*qW):NaN;if(n=KI.timezoneHHMM.exec(e),n){s=parseInt(n[1],10);var a=parseInt(n[2],10);return YW(s,a)?(r=Math.abs(s)*qW+a*oze,s>0?-r:r):NaN}if(uze(e)){t=new Date(t||Date.now());var o=i?t:lze(t),l=cz(o,e),c=i?l:cze(t,l,e);return-c}return NaN}function lze(e){return ste(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())}function cz(e,t){var i=ize(e,t),n=ste(i[0],i[1]-1,i[2],i[3]%24,i[4],i[5],0).getTime(),r=e.getTime(),s=r%1e3;return r-=s>=0?s:1e3+s,n-r}function cze(e,t,i){var n=e.getTime(),r=n-t,s=cz(new Date(r),i);if(t===s)return t;r-=s-t;var a=cz(new Date(r),i);return s===a?s:Math.max(s,a)}function YW(e,t){return-23<=e&&e<=23&&(t==null||0<=t&&t<=59)}var QW={};function uze(e){if(QW[e])return!0;try{return new Intl.DateTimeFormat(void 0,{timeZone:e}),QW[e]=!0,!0}catch{return!1}}var hze=pg(c1e(),1),KW=pg(u1e(),1),dze=/(Z|[+-]\d{2}(?::?\d{2})?| UTC| [a-zA-Z]+\/[a-zA-Z_]+(?:\/[a-zA-Z_]+)?)$/,fze=dze,JI=36e5,JW=6e4,pze=2,Ko={dateTimePattern:/^([0-9W+-]+)(T| )(.*)/,datePattern:/^([0-9W+-]+)(.*)/,YY:/^(\d{2})$/,YYY:[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],YYYY:/^(\d{4})/,YYYYY:[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],MM:/^-(\d{2})$/,DDD:/^-?(\d{3})$/,MMDD:/^-?(\d{2})-?(\d{2})$/,Www:/^-?W(\d{2})$/,WwwD:/^-?W(\d{2})-?(\d{1})$/,HH:/^(\d{2}([.,]\d*)?)$/,HHMM:/^(\d{2}):?(\d{2}([.,]\d*)?)$/,HHMMSS:/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,timeZone:fze};function mze(e,t){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");if(e===null)return new Date(NaN);var i={},n=i.additionalDigits==null?pze:(0,hze.default)(i.additionalDigits);if(n!==2&&n!==1&&n!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]")return new Date(e.getTime());if(typeof e=="number"||Object.prototype.toString.call(e)==="[object Number]")return new Date(e);if(!(typeof e=="string"||Object.prototype.toString.call(e)==="[object String]"))return new Date(NaN);var r=gze(e),s=vze(r.date,n),a=s.year,o=s.restDateString,l=yze(o,a);if(isNaN(l))return new Date(NaN);if(l){var c=l.getTime(),u=0,h;if(r.time&&(u=xze(r.time),isNaN(u)))return new Date(NaN);if(r.timeZone||i.timeZone){if(h=ate(r.timeZone||i.timeZone,new Date(c+u)),isNaN(h))return new Date(NaN)}else h=(0,KW.default)(new Date(c+u)),h=(0,KW.default)(new Date(c+u+h));return new Date(c+u+h)}else return new Date(NaN)}function gze(e){var t={},i=Ko.dateTimePattern.exec(e),n;if(i?(t.date=i[1],n=i[3]):(i=Ko.datePattern.exec(e),i?(t.date=i[1],n=i[2]):(t.date=null,n=e)),n){var r=Ko.timeZone.exec(n);r?(t.time=n.replace(r[1],""),t.timeZone=r[1].trim()):t.time=n}return t}function vze(e,t){var i=Ko.YYY[t],n=Ko.YYYYY[t],r;if(r=Ko.YYYY.exec(e)||n.exec(e),r){var s=r[1];return{year:parseInt(s,10),restDateString:e.slice(s.length)}}if(r=Ko.YY.exec(e)||i.exec(e),r){var a=r[1];return{year:parseInt(a,10)*100,restDateString:e.slice(a.length)}}return{year:null}}function yze(e,t){if(t===null)return null;var i,n,r,s;if(e.length===0)return n=new Date(0),n.setUTCFullYear(t),n;if(i=Ko.MM.exec(e),i)return n=new Date(0),r=parseInt(i[1],10)-1,$W(t,r)?(n.setUTCFullYear(t,r),n):new Date(NaN);if(i=Ko.DDD.exec(e),i){n=new Date(0);var a=parseInt(i[1],10);return _ze(t,a)?(n.setUTCFullYear(t,0,a),n):new Date(NaN)}if(i=Ko.MMDD.exec(e),i){n=new Date(0),r=parseInt(i[1],10)-1;var o=parseInt(i[2],10);return $W(t,r,o)?(n.setUTCFullYear(t,r,o),n):new Date(NaN)}if(i=Ko.Www.exec(e),i)return s=parseInt(i[1],10)-1,e7(t,s)?ZW(t,s):new Date(NaN);if(i=Ko.WwwD.exec(e),i){s=parseInt(i[1],10)-1;var l=parseInt(i[2],10)-1;return e7(t,s,l)?ZW(t,s,l):new Date(NaN)}return null}function xze(e){var t,i,n;if(t=Ko.HH.exec(e),t)return i=parseFloat(t[1].replace(",",".")),ZI(i)?i%24*JI:NaN;if(t=Ko.HHMM.exec(e),t)return i=parseInt(t[1],10),n=parseFloat(t[2].replace(",",".")),ZI(i,n)?i%24*JI+n*JW:NaN;if(t=Ko.HHMMSS.exec(e),t){i=parseInt(t[1],10),n=parseInt(t[2],10);var r=parseFloat(t[3].replace(",","."));return ZI(i,n,r)?i%24*JI+n*JW+r*1e3:NaN}return null}function ZW(e,t,i){t=t||0,i=i||0;var n=new Date(0);n.setUTCFullYear(e,0,4);var r=n.getUTCDay()||7,s=t*7+i+1-r;return n.setUTCDate(n.getUTCDate()+s),n}var bze=[31,28,31,30,31,30,31,31,30,31,30,31],Sze=[31,29,31,30,31,30,31,31,30,31,30,31];function ote(e){return e%400===0||e%4===0&&e%100!==0}function $W(e,t,i){if(t<0||t>11)return!1;if(i!=null){if(i<1)return!1;var n=ote(e);if(n&&i>Sze[t]||!n&&i>bze[t])return!1}return!0}function _ze(e,t){if(t<1)return!1;var i=ote(e);return!(i&&t>366||!i&&t>365)}function e7(e,t,i){return!(t<0||t>52||i!=null&&(i<0||i>6))}function ZI(e,t,i){return!(e!=null&&(e<0||e>=25)||t!=null&&(t<0||t>=60)||i!=null&&(i<0||i>=60))}function Aze(e,t,i){var n=mze(e,i),r=ate(t,n,!0),s=new Date(n.getTime()-r),a=new Date(0);return a.setFullYear(s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate()),a.setHours(s.getUTCHours(),s.getUTCMinutes(),s.getUTCSeconds(),s.getUTCMilliseconds()),a}function $o(e,t){return t.color(e)}function t7(e=new Date,t){let i=t.format,n=e.getSeconds(),r=e;t&&t.timeZone!==null&&(r=Aze(new Date,t.timeZone));let s=r.getHours(),a=r.getMinutes(),o;t.format12h24h==="12ampm"&&(o=s>=12?"PM":"AM");let l=s;t.format12h24h!=="24"&&(l=s%12,l===0&&(l=12));let c,u;switch(i){case"HH:mm:ss":c=[l,a,n];break;case"HH:mm":c=[l,a];break;case"HH":c=[l],o=void 0;break;case"mm":c=[a],o=void 0;break;case"ss":c=[n],o=void 0;break;case"year":u=r.getFullYear();break;case"month":u=r.getMonth()+1;break;case"dayOfYear":u=Math.floor((r.getTime()-new Date(r.getFullYear(),0,0).getTime())/864e5);break;case"dayOfMonth":u=r.getDate();break;case"secondOfDay":u=s*60*60+a*60+n;break;default:console.error("Unknown time format",i),u=0;break}return c!==void 0?{textValue:c,suffix:o}:u}function wze(e,t){switch(e.type){case"fresnel":return Tze(e,t);case"gradient":return Cze(e,t);case"depth":return Dze(e,t);case"normal":return Rze(e,t);case"noise":return Pze(e,t);case"rainbow":return Oze(e,t);case"toon":return Bze(e,t);case"outline":return Ize(e,t);case"transmission":return Lze(e,t);case"color":return Eze(e,t);case"pattern":return Uze(e,t)}}function Mze(e){return{type:e.type}}function sh(e,t){let{alpha:i,mode:n,isMask:r}=e,s=typeof i=="string"?(Number(t.getVariable(i))??100)/100:i;return{...Mze(e),alpha:s,mode:n,isMask:r}}function Eze(e,t){return{...sh(e,t),color:$o(e.color,t)}}function Tze(e,t){let{bias:i,scale:n,intensity:r,factor:s,color:a}=e;return{...sh(e,t),color:$o(a,t),bias:i,scale:n,intensity:r,factor:s}}function Cze(e,t){let{gradientType:i,smooth:n,colors:r,steps:s,angle:a,offset:o,morph:l}=e;return{...sh(e,t),gradientType:i,smooth:n,colors:r.map(c=>new Di(c[0],c[1],c[2],c[3])),num:r.length,steps:s,offset:new Ae(...o),morph:new Ae(...l),angle:a}}function Dze(e,t){let{gradientType:i,near:n,far:r,isVector:s,isWorldSpace:a,origin:o,direction:l,colors:c,steps:u,smooth:h}=e;return{...sh(e,t),gradientType:i,near:n,far:r,isVector:s,isWorldSpace:a,origin:new G(...o),direction:l?new G(...l):new G(1,0,0),colors:c.map(d=>d!==void 0?new Di(d[0],d[1],d[2],d[3]):new Di(0,0,0,0)),steps:u.slice(0,c.length),smooth:h}}function Rze(e,t){let{cnormal:i}=e;return{...sh(e,t),cnormal:new G(i[0],i[1],i[2])}}function Pze(e,t){return{...sh(e,t),scale:e.scale,move:e.move,fA:new Ae(...e.fA),fB:new Ae(...e.fB),size:new G(...e.size),distortion:new Ae(...e.distortion),colorA:$o(e.colorA,t),colorB:$o(e.colorB,t),colorC:$o(e.colorC,t),colorD:$o(e.colorD,t),noiseType:e.noiseType,voronoiStyle:e.voronoiStyle,highCut:e.highCut,lowCut:e.lowCut,smoothness:e.smoothness,seed:e.seed,quality:e.quality}}function Oze(e,t){return{...sh(e,t),filmThickness:e.filmThickness,movement:e.movement,wavelengths:new G(...e.wavelengths),noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,offset:new G(...e.offset)}}function Bze(e,t){return{...sh(e,t),positioning:e.positioning,colors:e.colors.map(i=>new Di(i[0],i[1],i[2],i[3])),num:e.colors.length,steps:e.steps,source:new G(...e.source),isWorldSpace:e.isWorldSpace,noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,shadowColor:$o(e.shadowColor,t),offset:new G(...e.offset)}}function Ize(e,t){return{...sh(e,t),outlineColor:$o(e.outlineColor,t),contourColor:$o(e.contourColor,t),outlineWidth:e.outlineWidth,contourWidth:e.contourWidth,outlineThreshold:e.outlineThreshold,contourThreshold:e.contourThreshold,outlineSmoothing:e.outlineSmoothing,contourFrequency:e.contourFrequency,contourDirection:new G(...e.contourDirection),positionalLines:e.positionalLines,compensation:e.compensation}}function Lze(e,t){return{...sh(e,t),thickness:e.thickness,ior:e.ior,roughness:e.roughness}}function Uze(e,t){return{...sh(e,t),style:e.style,projection:e.projection,axis:e.axis,blending:e.blending,offset:new Ae(...e.offset),colorA:$o(e.colorA,t),colorB:$o(e.colorB,t),frequency:new Ae(...e.frequency),size:e.size,variation:e.variation,smoothness:e.smoothness,zigzag:e.zigzag,rotation:e.rotation,vertical:new Ae(...e.vertical),horizontal:new Ae(...e.horizontal),sides:e.sides}}var G3=class extends Qa{},Nze={noise:["noiseType"],texture:["projection","axis","side"],video:["projection","axis","side"],displace:["noiseType"],light:["roughnessMap","bumpMap"],depth:["smooth","isWorldSpace","gradientType","isVector"],pattern:["style","projection","axis"]},zze={depth:["colors"]};function Fze(e,t,i){var s,a;if(t==="isMask")return!0;let n=Nze[e.type],r=zze[e.type];if(r!==void 0){let o=e.color;if(r.includes(t)){let l=(a=(s=o[t])==null?void 0:s.value)==null?void 0:a.length;if(l!==void 0&&l!==i.length)return!0}}return n!==void 0?n.includes(t):!1}function lte(e,t,i){let n=i.uniforms[`f${i.id}_texture`];if(!n)return!1;let r=!1,s=e;if("image"in s){let a=s.image,o=t.image(a),l=n;l.image instanceof Im||l.image.deref(),l.image=o}if("video"in s){let a=s.video,o=t.video(a),l=n;l.image instanceof Im||l.image.deref(),l.image=o}if("wrapping"in s){let a=n;a.wrap=s.wrapping}if("minFilter"in s){let a=n;a.minFilter=s.minFilter}if("magFilter"in s){let a=n;a.magFilter=s.magFilter}if("rotation"in s&&i.uniforms[`f${i.id}_rotation`])return i.uniforms[`f${i.id}_rotation`].value=(s.rotation??0)*qt.DEG2RAD,r;if("repeat"in s||"offset"in s||"rotation"in s){let a="mat",o=i.uniforms[`f${i.id}_${a}`];"repeat"in s&&(o.repeat=s.repeat),"offset"in s&&(o.offset=s.offset),"rotation"in s&&(o.rotation=s.rotation??0),o.updateMatrix()}return r}function Vze(e,t,i,n){let r=!1;for(let[s,a]of Object.entries(e)){if(s==="bumpMap"||s==="roughnessMap"){r=!0;continue}if(!s||a===void 0)continue;if(ute(s,i,n,t)){s==="visible"&&i.type==="light"&&(r=!0);continue}i.visible=n.visible;let o=i.uniforms[`f${i.id}_${s}`];if(o&&!(o instanceof R5))switch(r=r||Fze(i,s,a),o.constructor){case es:if(typeof a=="string"){let l=t.getColor(a);l&&(o.value=l);break}else{let l=a;o.value instanceof G3?o.value=new Qa(l.r,l.g,l.b,l.a):o.setRGBA(l);break}case Mf:if(typeof a=="string"){let l=t.getColor(a);l&&(o.value=l);break}else{let l=a;o.value instanceof G3?o.value=new Qa(l.r,l.g,l.b,l.a):o.value.setRGBA(l.r,l.g,l.b,l.a);break}case Fa:{let l=a;o.value.setX(l[0]),o.value.setY(l[1]);break}case Lc:{let l=a;o.value.setX(l[0]),o.value.setY(l[1]),o.value.setZ(l[2]);break}case Lf:{lte(a,t,i);break}case kv:{o.value=a.map(l=>new Di(...l));break}default:{o.value=a;break}}}return r}var F0=(e,t,i)=>Math.max(0,Math.min(1,Number(t.getVariable(typeof e=="number"?e*100:e,i)??100)/100))??1,pM=class{constructor(e,t,i,n,r){this.id=e,this.uuid=t,this.data=i,this.uniforms={};for(let s in n)this.uniforms[`f${this.id}_${s}`]=n[s];for(let s in i)ute(s,this,i,r)}get type(){return this.data.type}static create(e,t,i,n){if(i.type==="light")return id.createLightLayer(e,t,i,n);if(i.type==="texture"||i.type==="video"){let r=i.type==="texture"?n.uiBuffer(i.texture.image)??n.image(i.texture.image):n.video(i.texture.video),s=new az(r,i.texture.wrapping,i.texture.minFilter??1008,i.texture.magFilter??1006),a=new GNe(r),o=new kNe(i.texture.repeat,i.texture.offset,i.texture.rotation??0),l=new Qt(i.crop?1:0),c=new lr(i.projection??0),u=new lr(["x","y","z"].indexOf(i.axis)??0),h=new lr(i.side??0),d=new Fa(i.size?new Ae(i.size[0],i.size[1]):new Ae(100,100)),p=new Qt(i.blending??0),g=new Qt(F0(i.alpha,n)),x=new lr(i.mode??0),y=new Qo(i.isMask??!1),b=new P5(s,a,l,c,u,h,d,p,o,g,x,y),A=new gr(b.calpha,"f");return new Kr(e,t,i,{texture:s,textureSize:a,crop:l,projection:c,axis:u,side:h,size:d,blending:p,mat:o,alpha:g,mode:x,isMask:y},b,x,A,y,n)}else if(i.type==="matcap"){let r=n.image(i.texture.image),s=new az(r,i.texture.wrapping,i.texture.minFilter??1008,i.texture.magFilter??1006),a=new Qt(F0(i.alpha,n)),o=new lr(i.mode??0),l=new Qo(i.isMask??!1),c=new Qt((i.texture.rotation??0)*qt.DEG2RAD),u=new jee(s,a,o,l,c),h=new gr(u.calpha,"f");return new Kr(e,t,i,{texture:s,alpha:a,mode:o,isMask:l,rotation:c},u,o,h,l,n)}else if(i.type==="displace")if(i.displacementType==="noise"){let r=new Lc(new G(...i.offset)),s=new Qt(i.scale??10),a=new Qt(i.intensity??8),o=new Qt(i.movement??1),l=new lr(i.noiseType??0),c=new lr(i.voronoiStyle??0),u=new Qt(i.smoothness??.5),h=new Qt(i.seed??0),d=new Qt(i.highCut??1),p=new Qt(i.lowCut??0),g=new lr(i.quality??1),x=new ite(a,o,r,c,u,h,d,p,g,s,l);return new cte(e,t,i,{offset:r,scale:s,intensity:a,movement:o,noiseType:l,voronoiStyle:c,smoothness:u,seed:h,highCut:d,lowCut:p,quality:g},x,n)}else throw new Error;else return kze(e,t,i,n)}updateByOp(e,t,i){let n=e;if(n.path[0]===void 0){if(n.type===0)return"type"in n.props||"category"in n.props||"visible"in n.props||"noiseType"in n.props?(i.scene.markNeedsUpdateRendererDirty(),!0):Vze(n.props,i.shared,this,t)}else if(n.path[0]==="texture")return"texture"in t||"video"in t?lte(n.props,i.shared,this):!0;return!1}dispose(){if(Hze(this)){let e=this.uniforms[`f${this.id}_texture`];if(!e)return!1;let t=e;t.image instanceof Im||t.image.deref()}}hasValueByKey(e){return this.uniforms[e]!==void 0}hasValue(e){return this.hasValueByKey(`f${this.id}_${e}`)}setValue(e,t){let i=`f${this.id}_${e}`;this.hasValueByKey(i)&&t!==void 0&&(this.uniforms[i].value=t)}getNode(e){let t=`f${this.id}_${e}`;if(this.hasValueByKey(t))return this.uniforms[t]}getValue(e){let t=`f${this.id}_${e}`;if(this.hasValueByKey(t))return this.uniforms[t].value}getName(e){let t=/f\d+_(.*)/.exec(e);if(t&&t.length>1)return t[1];console.log(`Layer.getName: error ${e}`)}getNames(){let e=[];for(let t in this.uniforms){let i=this.getName(t);i&&e.push(i)}return e}},Kr=class extends pM{constructor(e,t,i,n,r,s,a,o,l){super(e,t,i,n,l),this.params=n,this.color=r,this.mode=s,this.alpha=a,this.isMask=o}},cte=class extends pM{constructor(e,t,i,n,r,s){super(e,t,i,n,s),this.position=r}},id=class extends pM{constructor(e,t,i,n,r,s){super(e,t,i,r,s),this.node=n}static createLightLayer(e,t,i,n){let r,s=new Qt(F0(i.alpha,n)),a=new lr(i.mode),o=new Qt(i.bumpMapIntensity),l=new Qt(F0(i.alphaOverride,n)),c;if(!i.visible)r=new O5,c={};else if(i.category==="lambert"){r=new qNe;let u=new es(n.color(i.emissive)??0),h=new Qo(i.occlusion??!0);c={emissive:u,occlusion:h},r.emissive=u,r.occlusion=h}else if(i.category==="toon"){r=new KNe;let u=new Qt(i.shininess??30),h=new es(n.color(i.specular)??1118481);c={shininess:u,specular:h},r.shininess=u,r.specular=h}else if(i.category==="physical"){r=new QNe;let u=new Qt(i.roughness??.3),h=new Qt(i.metalness??0),d=new Qt(i.reflectivity??.5),p=new Qo(i.occlusion??!0);c={roughness:u,metalness:h,reflectivity:d,occlusion:p},r.roughness=u,r.metalness=h,r.reflectivity=d,r.occlusion=p}else{r=new YNe;let u=new Qt(i.shininess??30),h=new es(i.specular!==void 0?n.color(i.specular)??1118481:1118481),d=new Qo(i.occlusion??!0);c={shininess:u,specular:h,occlusion:d},r.shininess=u,r.specular=h,r.occlusion=d}return r.alpha=new Qt(1),r.shadingAlpha=s,r.shadingBlend=a,r.bumpMapIntensity=o,r.alphaOverride=l,c.alpha=r.shadingAlpha,c.mode=r.shadingBlend,c.bumpMapIntensity=r.bumpMapIntensity,c.alphaOverride=r.alphaOverride,new id(e,t,i,r,c,n)}get category(){return this.node.category}};function Hze(e){let t=e instanceof pM?e.type:e;return t==="texture"||t==="video"||t==="displace_map"||t==="matcap"}function Dc(e){return{alpha:new Qt(e.alpha??1),mode:new lr(e.mode??0),isMask:new Qo(e.isMask??!1)}}function Gze(e,t,i,n,r){switch(e.type){case"color":{let s=new es(n.color??nc),a=Dc(n),o=new oz(s,a.alpha),l=new gr(o.calpha,"f");return new Kr(t,i,e,{color:s,...a},o,a.mode,l,a.isMask,r)}case"fresnel":{let s=new es(n.color??16777215),a=new Qt(n.bias??.1),o=new Qt(n.scale??1),l=new Qt(n.intensity??2),c=new Qt(n.factor??1),u=Dc(n),h=new jNe(s,a,o,l,c,u.alpha,u.mode,u.isMask),d=new gr(h.calpha,"f");return new Kr(t,i,e,{color:s,bias:a,scale:o,intensity:l,factor:c,...u},h,u.mode,d,u.isMask,r)}case"rainbow":{let s=new Qt(n.filmThickness??30),a=new Qt(n.movement??0),o=new Lc(n.wavelengths??new G(0,0,0)),l=new Qt(n.noiseStrength??0),c=new Qt(n.noiseScale??1),u=new Lc(n.offset??new G(0,0,0)),h=Dc(n),d=new Kee(s,a,o,l,c,u,h.alpha,h.isMask),p=new gr(d.calpha,"f");return new Kr(t,i,e,{filmThickness:s,movement:a,wavelengths:o,noiseStrength:l,noiseScale:c,offset:u,...h},d,h.mode,p,h.isMask,r)}case"transmission":{let s=new Qt(n.thickness??10),a=new Qt(n.ior??1.5),o=new Qt(n.roughness??.5),l=xi.transmissionSize,c=xi.transmissionRenderTarget,u=xi.transmissionRenderTargetDepth,h=window.innerWidth,d=window.innerHeight,p=h>=d?new Fa(d/h,1):new Fa(1,h/d),g=Dc(n),x=new ete(s,a,o,l,c,u,p,g.alpha),y=new gr(x.calpha,"f");return new Kr(t,i,e,{thickness:s,ior:a,roughness:o,aspectRatio:p,...g},x,g.mode,y,g.isMask,r)}case"toon":{let s=new lr(n.positioning??0),a;n.colors?a=new kv(n.colors.length,n.colors):(a=new kv(10,new Di(0,0,0,1)),a.value[1]=new Di(1,1,1,1));let o;n.steps?o=new Gv(n.steps.length,n.steps):(o=new Gv(10,1),o.value[0]=0);let l=new Lc(n.source??new G(0,0,0)),c=new Qo(n.isWorldSpace??!0),u=new Qt(n.noiseStrength??0),h=new Qt(n.noiseScale??1),d=new Mf(n.shadowColor),p=new Lc(n.offset??new G(0,0,0)),g=Dc(n),x=new Zee(s,a,o,l,c,u,h,d,p,g.alpha),y=new gr(x.calpha,"f");return new Kr(t,i,e,{positioning:s,colors:a,steps:o,source:l,isWorldSpace:c,noiseStrength:u,noiseScale:h,shadowColor:d,offset:p,...g},x,g.mode,y,g.isMask,r)}case"outline":{let s=new es(n.outlineColor??16777215),a=new es(n.contourColor??16777215),o=new Qt(n.outlineWidth??.1),l=new Qt(n.contourWidth??.1),c=new Qt(n.outlineThreshold??.1),u=new Qt(n.contourThreshold??.1),h=new Qt(n.outlineSmoothing??.1),d=new Qt(n.contourFrequency??.1),p=new Lc(n.contourDirection??new G(0,1,0)),g=new Qo(n.positionalLines??!1),x=new Qo(n.compensation??!0),y=xi.normalRenderTarget,b=xi.normalRenderTargetDepth,A=xi.pixelRatioNode,w=xi.resolution,E=Dc(n),D=new qee(s,a,o,l,c,u,h,d,p,g,x,w,y,b,A,E.alpha),T=new gr(D.calpha,"f");return new Kr(t,i,e,{outlineColor:s,contourColor:a,outlineWidth:o,contourWidth:l,outlineThreshold:c,contourThreshold:u,outlineSmoothing:h,contourFrequency:d,contourDirection:p,positionalLines:g,compensation:x,...E},D,E.mode,T,E.isMask,r)}case"depth":{let s=new lr(n.gradientType??0),a=new Qo(n.smooth??!1),o=new Qt(n.near??50),l=new Qt(n.far??200),c=new Qt(n.isVector??1),u=new Qt(n.isWorldSpace??0),h=new Lc(n.origin??new G),d=new Lc(n.direction??new G),p;n.colors?p=new kv(n.colors.length,n.colors):(p=new kv(2,new Di(0,0,0,1)),p.value[1]=new Di(1,1,1,1));let g;n.steps?g=new Gv(n.steps.length,n.steps):(g=new Gv(2,1),g.value[0]=0);let x=Dc(n),y=new Vee(s,a,o,l,c,u,h,d,p,g,x.alpha,x.isMask),b=new gr(y.calpha,"f");return new Kr(t,i,e,{gradientType:s,smooth:a,near:o,far:l,isVector:c,isWorldSpace:u,origin:h,direction:d,colors:p,steps:g,...x},y,x.mode,b,x.isMask,r)}case"noise":{let s=new Qt(n.scale??1),a=new Lc(n.size??new G(100,100,100)),o=new Qt(n.move??1),l=new Fa(n.fA??new Ae(1.7,9.2)),c=new Fa(n.fB??new Ae(8.3,2.8)),u=new Fa(n.distortion??new Ae(1,1)),h=new Mf(n.colorA),d=new Mf(n.colorB),p=new Mf(n.colorC),g=new Mf(n.colorD),x=new lr(n.noiseType??0),y=new lr(n.voronoiStyle??0),b=new Qt(n.highCut??1),A=new Qt(n.lowCut??0),w=new Qt(n.smoothness??.5),E=new Qt(n.seed??.5),D=new lr(n.quality??1),T=Dc(n),I=new Wee(s,a,o,l,c,u,h,d,p,g,T.alpha,x,T.isMask,y,b,A,w,E,D),R=new gr(I.calpha,"f");return new Kr(t,i,e,{scale:s,size:a,move:o,fA:l,fB:c,distortion:u,colorA:h,colorB:d,colorC:p,colorD:g,noiseType:x,...T,voronoiStyle:y,highCut:b,lowCut:A,smoothness:w,seed:E,quality:D},I,T.mode,R,T.isMask,r)}case"normal":{let s=new Lc(n.cnormal??new G(1,1,1)),a=Dc(n),o=new Fee(s,a.alpha),l=new gr(o.calpha,"f");return new Kr(t,i,e,{cnormal:s,...a},o,a.mode,l,a.isMask,r)}case"gradient":{let s=new lr(n.gradientType??0),a=new Qo(n.smooth??!1),o;n.colors?o=new kv(n.colors.length,n.colors):(o=new kv(10,new Di(0,0,0,1)),o.value[1]=new Di(1,1,1,1));let l;n.steps?l=new Gv(n.steps.length,n.steps):(l=new Gv(10,1),l.value[0]=0);let c=new Fa(n.offset??new Ae(0,0)),u=new Fa(n.morph??new Ae(0,0)),h=new Qt(n.angle??0),d=Dc(n),p=new Gee(s,a,o,l,c,u,h,d.alpha,d.isMask),g=new gr(p.calpha,"f");return new Kr(t,i,e,{gradientType:s,smooth:a,colors:o,steps:l,offset:c,morph:u,angle:h,...d},p,d.mode,g,d.isMask,r)}case"pattern":{let s=new lr(n.style??0),a=new lr(n.projection??0),o=new lr(["x","y","z"].indexOf(n.axis)??0),l=new Qt(n.blending??0),c=new Fa(n.offset??new Ae(0,0)),u=new Mf(n.colorA),h=new Mf(n.colorB),d=new Fa(n.frequency??new Ae(10,10)),p=new Qt(n.size??.5),g=new Qt(n.variation??0),x=new Qt(n.smoothness??.5),y=new Qt(n.zigzag??0),b=new Qt(n.rotation??0),A=new Fa(n.vertical??new Ae(0,1)),w=new Fa(n.horizontal??new Ae(0,1)),E=new lr(n.sides??6),D=Dc(n),T=new Yee(s,a,o,l,c,u,h,d,p,g,x,y,b,A,w,E,D.alpha,D.isMask),I=new gr(T.calpha,"f");return new Kr(t,i,e,{style:s,projection:a,axis:o,blending:l,offset:c,colorA:u,colorB:h,frequency:d,size:p,variation:g,smoothness:x,zigzag:y,rotation:b,vertical:A,horizontal:w,sides:E,...D},T,D.mode,I,D.isMask,r)}default:{let s=new es(1,0,0,1),a=Dc(n),o=new oz(s,a.alpha),l=new gr(o.calpha,"f");return new Kr(t,i,e,{color:s,...a},o,a.mode,l,a.isMask,r)}}}function kze(e,t,i,n){let r=wze(i,n);return Gze(i,e,t,r,n)}function ute(e,t,i,n){if(i.type==="displace"&&(e==="intensity"||e==="visible")){let r=t.uniforms[`f${t.id}_intensity`];return r?(r.value=i.intensity*(i.visible?1:0),r):void 0}if(i.type!=="displace"&&(e==="alpha"||e==="visible")){let r=t.uniforms[`f${t.id}_alpha`];if(!r)return;if(r.value=F0(i.alpha,n)*(i.visible?1:0),i.type==="outline"&&e==="visible"){let s=t.uniforms[`f${t.id}_compensation`];s&&(s.value=i.compensation&&i.visible)}return r}}function y1(e,t){let i=0,n=e.layers.find(r=>r.data.type==="light");if(n){let r=n.data,s=Number(t.getVariable(r.alphaOverride));if((typeof r.alphaOverride=="string"?s/100:r.alphaOverride)<1)return!0}for(let r of e.layers){if(r.data.type!=="displace"&&r.data.isMask)return!0;if(r.data.type!=="displace"&&"alpha"in r.data&&r.data.type!=="light"&&r.data.type!=="fresnel"&&r.data.type!=="texture"&&r.data.type!=="matcap"&&r.data.type!=="rainbow"&&r.data.type!=="outline"&&r.data.type!=="pattern"){let s=r.data.visible?r.data.alpha:0;if(typeof s=="string"&&(s=Math.max(0,Math.min(1,Number(t.getVariable(s)??100)/100))),s===1&&r.data.type==="depth"||r.data.type==="gradient"){for(let a of r.data.colors)if(a[3]<1){s=a[3];break}}else if(s===1&&r.data.type==="noise"){let a=t.color(r.data.colorA).a,o=t.color(r.data.colorB).a,l=t.color(r.data.colorC).a,c=t.color(r.data.colorD).a,u=Math.min(a,Math.min(o,Math.min(l,c)));u<1&&(s=u)}i+=(1-i)*s}}return i<1}var sg=class extends vn{constructor(){super(void 0),this.flatShading=!1,this.needsJitter=!0,this.shadersPatchedForShapeBlend=!1,this.nodeContextUuid=0,this.fog=!0,this.dithering=!0,this.vertexColors=!0,this.transparent=!0}customProgramCacheKey(){return""}},jze=class extends sg{constructor(e,t,i,n){super(),this.flatShading=e,this.side=t,this.wireframe=i,this.root=n}updateAfterBuild(){let e=this.root;this.lights=e.lights,this.vertexShader=e.vertexShader,this.fragmentShader=e.fragmentShader,Object.assign(this.defines,e.defines),Object.assign(this.uniforms,e.uniforms),this.extensions=e.extensions,this.transparent=e.transparent,this.cacheKey=e.customProgramCacheKey()+"flat"+this.flatShading+this.side}onBeforeCompile(e,t){this.root.onBeforeCompile(e)}get data(){return this.root.data}get category(){return this.root.category}get hasAO(){return this.root.hasAO}getFlavor(e,t,i,n){return this.root.getFlavor(e,t,i,n)}get layers(){return this.root.layers}get fragment(){return this.root.fragment}getLayersOfType(e){return this.root.getLayersOfType(e)}getLayerByUuid(e){return this.root.getLayerByUuid(e)}updateByOp(e,t,i){this.root.updateByOp(e,t,i)}nodeMaterialDispose(){this.root.nodeMaterialDispose()}},B5=class extends sg{constructor(e,t,i=!0){super(),this.data=e,this.allowVariableSaves=i,this.layerIdGen=0,this.flavors=[],this.masks={},this.type="NodeMaterial",this.updaters=[],this.needsJitter=t.shared.needsJitter,Xs.startContext(this),this.reset0(e,t),Xs.endContext(this)}get nodeMaterial(){return this}getFlavor(e,t,i,n){let r=i?6:(e?3:0)+t;if(r+=(((n==null?void 0:n.resolutionLevel)??0)-(n!=null&&n.useChildrenColors?4:0))*7,r===0)return this;this.flavors===void 0&&(this.flavors=[]),r-=1;let s=this.flavors[r];return s===void 0&&(s=new jze(e,t,i,this),s.needsJitter=this.needsJitter,this.flavors[r]=s,s.flatShading=e,s.side=t,s.updateAfterBuild(),n&&(s.defines.SHAPEBLEND=n.resolutionLevel,s.defines.SHAPEBLEND_C=n.useChildrenColors?1:0)),s}get fragment(){return this.lightLayer.node}get category(){return this.lightLayer.category}get hasAO(){var e;return((e=this.lightLayer.getNode("occlusion"))==null?void 0:e.value)??!1}reset(e,t,i=!1){Xs.startContext(this),(this.data!==e||i)&&this.reset0(e,t),Xs.endContext(this)}reset0(e,t){this.data=e;let i=e.layers??ga.defaultTwoLayerData("phong").layers;try{this.layers=i.map(n=>pM.create(this.layerIdGen++,n.id,n.data,t.shared))}catch{this.layers=[]}this.layers.reverse(),this.name=e.name??"Untitled Material",this.onUpdate(t.shared),this.transparent=y1(e,t.shared),this.saveVariableLocations(t)}onVariableUpdate(e,t,i){if(e[0]==="alphaOverride")this.transparent=y1(this.data,i.shared),this.lightLayer.setValue("alphaOverride",Math.max(0,Math.min(Number(t)/100,1)));else if(e[0]==="layer"){let n=e[1],r=e[2];if(n&&r){let s=this.layers.find(a=>a.uuid===n);s!=null&&s.hasValue(r)&&(r==="alpha"?(this.transparent=y1(this.data,i.shared),s.setValue(r,Math.max(0,Math.min(Number(t)/100,1)))):s.setValue(r,t))}}}saveVariableLocations(e){if(!this.allowVariableSaves)return;let t=this.data.layers.find(i=>i.data.type==="light");t&&e.shared.getVariable(t.data.alphaOverride,["material",this.uuid,"alphaOverride"]),this.data.layers.forEach(i=>{"alpha"in i.data&&typeof i.data.alpha=="string"&&e.shared.getVariable(i.data.alpha,["material",this.uuid,"layer",i.id,"alpha"])})}getLayersOfType(e){return this.layers.filter(t=>t.type===e)}getLayerByUuid(e){return this.layers.find(t=>t.uuid===e)}onUpdate(e){this.lightLayer=this.layers.find(t=>t instanceof id),this.lightLayer===void 0&&(this.lightLayer=new id(0,"",{...da.defaultData("light","phong"),visible:!1},new O5,{},e)),this.dispose();for(let t of this.flavors)t&&t.dispose();this.applyTextureMaps(),this.applyMasks(),this.blendColors(),this.blendAfterColors(),this.blendPositions(),this.build(),this.nodeContextUuid=0}applyTextureMaps(){let e=this.layers.find(r=>r instanceof id);if(!e)return;let t=e.data,i=t.bumpMap,n=t.roughnessMap;e.node.bumpMap=void 0,e.node.roughnessMap=void 0;for(let r=0;r<this.layers.length;++r){let s=this.layers[r];s instanceof Kr&&s.color instanceof P5&&(s.uuid===i&&(e.node.bumpMap=s.color),s.uuid===n&&(e.node.roughnessMap=s.color))}}updateByOp(e,t,i){if(Xs.startContext(this),t!==void 0?this.data=t:t=this.data,this.transparent=y1(t,i.shared),e.path[0]==="layers"){let n=i.shared,r=e.path[1];if(r===void 0)i.scene.markNeedsUpdateRendererDirty(),this.reset0(t,i);else{e.type===0&&e.props.occlusion!==void 0&&i.scene.markNeedsUpdateRendererDirty();let s=this.layers.find(a=>a.uuid===r);if(s){let a=t.layers.data(r),o;e.type===0&&("alpha"in e.props||"alphaOverride"in e.props)&&("alpha"in e.props?o={...e.props,alpha:F0(e.props.alpha,n,["material",this.uuid,"layer",r,"alpha"])}:o={...e.props,alphaOverride:F0(e.props.alphaOverride,n,["material",this.uuid,"alphaOverride"])}),s.updateByOp({...e,...o?{props:o}:{},path:e.path.slice(2)},a,i)&&this.reset0(t,i)}}}else this.reset0(t,i);Xs.endContext(this)}applyMasks(){for(let e=0;e<this.layers.length;++e){let t=this.layers[e];t instanceof Kr?t.color.mask=void 0:t instanceof id&&(t.node.mask=void 0)}for(let e=0;e<this.layers.length;++e){let t=this.layers[e];if(t instanceof Kr&&t.isMask.value&&t.data.visible&&e>0){let i=e-1,n=this.layers[i];n instanceof id?n.node.mask=new Sl(t.color,t.alpha,Sl.MUL):n instanceof Kr&&(n.isMask.value||(n.color.mask=new Sl(t.color,t.alpha,Sl.MUL)))}}}blendColors(){let e=this.layers.findIndex(i=>i instanceof Kr),t=this.layers.findIndex(i=>i instanceof id);if(e!==-1&&e<t){let i=this.layers[e].color;for(let n=e+1;n<t;++n){let r=this.layers[n];if(r instanceof Kr){if(r.isMask.value)continue;i=new XW(i,r.color,r.alpha,r.mode)}}this.fragment.color=i}else this.fragment.color=void 0}blendAfterColors(){let e=new gr("outgoingLight","f"),t=this.layers.findIndex(i=>i instanceof id);if(this.layers.length>t+1){for(let i=t+1;i<this.layers.length;++i){let n=this.layers[i];if(n instanceof Kr){if(n.isMask.value)continue;e=new XW(e,n.color,n.alpha,n.mode)}}this.fragment.afterColor=e}else this.fragment.afterColor=void 0}blendPositions(){let e=this.layers.filter(t=>t instanceof cte);if(e.length>0){let t=e[0].position;for(let i=1;i<e.length;++i)e[i]&&(t=new Sl(t,e[i].position,Sl.ADD),t=new Sl(t,new Qt(.5).setReadonly(!0),Sl.MUL));this.fragment.position=t}else this.fragment.position=void 0}getDefines(){return this.defines}getUniforms(){return this.uniforms}getVertexShader(){return this.vertexShader}getFragmentShader(){return this.fragmentShader}onBeforeCompile(e){this.shapeBlendhack&&this.shapeBlendhack(this),e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.extensionDerivatives=this.extensions.derivatives===!0,e.extensionFragDepth=this.extensions.fragDepth===!0,e.extensionDrawBuffers=this.extensions.drawBuffers===!0,e.extensionShaderTextureLOD=this.extensions.shaderTextureLOD===!0}clampUniformsForPreview(e,t){let i=(n,r,s)=>Math.min(Math.max(n,r),s);for(let n of this.layers)if(n.type==="displace"){let r=i(n.uniforms[`f${n.id}_intensity`].value,e,t);n.uniforms[`f${n.id}_intensity`].value=r}}updateFrame(e){for(let t=0;t<this.updaters.length;++t)e.updateNode(this.updaters[t])}build(){let e=new Lee;e.needsJitter=this.needsJitter,this.lights=this.lightLayer.data.visible,e.build(this.fragment,this.fragment),this.vertexShader=e.getCode("vertex"),this.fragmentShader=e.getCode("fragment"),this.defines=e.defines,this.uniforms=e.uniforms,this.extensions=e.extensions,this.updaters=e.updaters;for(let t of this.flavors)t&&t.updateAfterBuild();return this.shadersPatchedForShapeBlend=!1,this}nodeMaterialDispose(){this.layers.forEach(e=>e.dispose()),super.dispose();for(let e of this.flavors)e&&e.dispose()}assetsLoaded(){for(let e of this.layers)if(e instanceof Kr){let t=e.params.texture;if(t instanceof az&&!t.image.loaded)return!1}return!0}};Object.defineProperties(sg.prototype,{properties:{get:function(){return this.fragment.properties}}});var uz=class extends B5{constructor(e,t,i){super(e,t,!1),this.uuid=i,this.allowVariableSaves=!0,this.saveVariableLocations(t)}},i7=new Map;function Wze(e){if(typeof e=="string")return e;let t=i7.get(e);return t||(t={url:URL.createObjectURL(new Blob([e]))},i7.set(e,t)),t.url}var hte,Xze=new Promise(e=>{hte=e}),n7=!1,$T;function qze(){if(n7)return;if($T)return $T;async function e(){await dg(()=>import("./howler-BDOVvIc0.js").then(t=>t.h),[]),hte(window!==void 0?window:global),n7=!0}return $T=e(),$T}var dte;Xze.then(e=>dte=e);function r7(e,t){e.forEach(i=>{"dragDropActions"in i.data?(t.push(...i.data.dragDropActions.drag),t.push(...i.data.dragDropActions.drop)):"inActions"in i.data?(t.push(...i.data.inActions),t.push(...i.data.outActions)):"gameActions"in i.data?(t.push(...i.data.gameActions.idle),t.push(...i.data.gameActions.move),t.push(...i.data.gameActions.jump),t.push(...i.data.gameActions.run)):"breakpoints"in i.data?i.data.breakpoints.forEach(n=>{t.push(...n.data.actions)}):"actions"in i.data&&(t.push(...i.data.actions),i.data.actions.forEach(n=>{n.data.type==="Conditional"&&n.data.ifActions&&(t.push(...n.data.ifActions),t.push(...n.data.elseActions))}))})}function Yze(e){let t=!1,i=[];return e.scene.objects.traverse((n,r)=>{if(r.type==="Page"&&r.uiScene!==void 0&&r.uiScene.objects.traverse((s,a)=>{if(a.events===void 0||Array.isArray(a.events)===!1)return!0;r7(a.events,i),t=t||i.some(o=>o.data.type==="Audio")}),r.events===void 0||Array.isArray(r.events)===!1)return!0;r7(r.events,i),t=t||i.some(s=>s.data.type==="Audio")}),t}var mA=class{constructor({src:e,volume:t,delay:i,loop:n}){this._volume=1,this.delay=0,this._loop=1,this.loopsRemaining=0,this._status="stopped",this.onEnd=()=>{this.loopsRemaining===1/0?this.replay():this.loopsRemaining>1?(this.replay(),this.loopsRemaining--):(this._status="stopped",this.loopsRemaining=this._loop)};let r;typeof e=="string"?r={src:e}:r={src:Wze(e),format:"wav"},this.sound=new dte.Howl(r),this.sound.on("end",this.onEnd),this.src=e,t!==void 0&&(this.volume=t),i!==void 0&&(this.delay=i),n!==void 0&&(this.loop=n)}get status(){return this._status}get volume(){return this._volume}set volume(e){this._volume=e,this.sound.volume(e)}get loop(){return this._loop}set loop(e){this._loop=e,this.loopsRemaining=e}replay(){this.clearDelay(),this.delayTimerId=window.setTimeout(()=>{this.sound.play(),this.clearDelay()},this.delay)}fade(e,t=1e3){e?(this.sound.volume(this._volume),this.clearFade(),this.fadeTimerId=window.setTimeout(()=>{this.sound.fade(this._volume,0,t),this.clearFade()},e)):this.sound.fade(this._volume,0,t)}on(e,t,i){this.sound.on(e,t,i)}off(e,t,i){this.sound.off(e,t,i)}play(){this._status==="playing"||this.sound.playing()||(this._status==="paused"?(this.sound.seek()===0?this.replay():this.sound.play(),this._status="playing"):this._status==="stopped"&&(this.replay(),this._status="playing"))}pause(){this._status==="playing"&&(this.sound.pause(),this.clearFade(),this.clearDelay(),this._status="paused")}stop(){this.sound.stop(),this.loopsRemaining=this._loop,this.clearFade(),this.clearDelay(),this._status="stopped"}clearFade(){this.fadeTimerId&&(clearTimeout(this.fadeTimerId),delete this.fadeTimerId)}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}dispose(e=!1){this.off(),this.stop(),this.clearFade(),this.clearDelay()}},Qze=class{constructor(){this.type="ShapePath",this.color=new gi,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new i3,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){var i;return(i=this.currentPath)==null||i.lineTo(e,t),this}quadraticCurveTo(e,t,i,n){var r;return(r=this.currentPath)==null||r.quadraticCurveTo(e,t,i,n),this}bezierCurveTo(e,t,i,n,r,s){var a;return(a=this.currentPath)==null||a.bezierCurveTo(e,t,i,n,r,s),this}splineThru(e){var t;return(t=this.currentPath)==null||t.splineThru(e),this}toShapes(){let e={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},t={loc:e.ORIGIN,t:0};function i(p,g,x,y){let b=p.x,A=g.x,w=x.x,E=y.x,D=p.y,T=g.y,I=x.y,R=y.y,O=(E-w)*(D-I)-(R-I)*(b-w),P=(A-b)*(D-I)-(T-D)*(b-w),U=(R-I)*(A-b)-(E-w)*(T-D),H=O/U,V=P/U;if(U===0&&O!==0||H<=0||H>=1||V<0||V>1)return null;if(O===0&&U===0){for(let j=0;j<2;j++)if(n(j===0?x:y,p,g),t.loc===e.ORIGIN){let J=j===0?x:y;return{x:J.x,y:J.y,t:t.t}}else if(t.loc===e.BETWEEN){let J=+(b+t.t*(A-b)).toPrecision(10),F=+(D+t.t*(T-D)).toPrecision(10);return{x:J,y:F,t:t.t}}return null}else{for(let F=0;F<2;F++)if(n(F===0?x:y,p,g),t.loc===e.ORIGIN){let X=F===0?x:y;return{x:X.x,y:X.y,t:t.t}}let j=+(b+H*(A-b)).toPrecision(10),J=+(D+H*(T-D)).toPrecision(10);return{x:j,y:J,t:H}}}function n(p,g,x){let y=x.x-g.x,b=x.y-g.y,A=p.x-g.x,w=p.y-g.y,E=y*w-A*b;if(p.x===g.x&&p.y===g.y){t.loc=e.ORIGIN,t.t=0;return}if(p.x===x.x&&p.y===x.y){t.loc=e.DESTINATION,t.t=1;return}if(E<-Number.EPSILON){t.loc=e.LEFT;return}if(E>Number.EPSILON){t.loc=e.RIGHT;return}if(y*A<0||b*w<0){t.loc=e.BEHIND;return}if(Math.sqrt(y*y+b*b)<Math.sqrt(A*A+w*w)){t.loc=e.BEYOND;return}let D;y!==0?D=A/y:D=w/b,t.loc=e.BETWEEN,t.t=D}function r(p,g){let x=[],y=[];for(let b=1;b<p.length;b++){let A=p[b-1],w=p[b];for(let E=1;E<g.length;E++){let D=g[E-1],T=g[E],I=i(A,w,D,T);I!==null&&x.find(R=>R.t<=I.t+Number.EPSILON&&R.t>=I.t-Number.EPSILON)===void 0&&(x.push(I),y.push(new Ae(I.x,I.y)))}}return y}function s(p,g,x){let y=new Ae;g.getCenter(y);let b=[];return x.forEach(A=>{A.boundingBox.containsPoint(y)&&r(p,A.points).forEach(w=>{b.push({identifier:A.identifier,isCW:A.isCW,point:w})})}),b.sort((A,w)=>A.point.x-w.point.x),b}function a(p,g,x,y,b){(b==null||b==="")&&(b="nonzero");let A=new Ae;p.boundingBox.getCenter(A);let w=[new Ae(x,A.y),new Ae(y,A.y)],E=s(w,p.boundingBox,g);E.sort((P,U)=>P.point.x-U.point.x);let D=[],T=[];E.forEach(P=>{P.identifier===p.identifier?D.push(P):T.push(P)});let I=D[0].point.x,R=[],O=0;for(;O<T.length&&T[O].point.x<I;)R.length>0&&R[R.length-1]===T[O].identifier?R.pop():R.push(T[O].identifier),O++;if(R.push(p.identifier),b==="evenodd"){let P=R.length%2===0,U=R[R.length-2];return{identifier:p.identifier,isHole:P,for:U}}else if(b==="nonzero"){let P=!0,U=null,H=null;for(let V=0;V<R.length;V++){let j=R[V];g[j]&&(P?(H=g[j].isCW,P=!1,U=j):H!==g[j].isCW&&(H=g[j].isCW,P=!0))}return{identifier:p.identifier,isHole:P,for:U}}else console.warn('fill-rule: "'+b+'" is currently not implemented.')}let o=0,l=999999999,c=-999999999,u=[];this.subPaths.forEach(p=>{let g=p.getPoints(),x=-999999999,y=999999999,b=-999999999,A=999999999;for(let w=0;w<g.length;w++){let E=g[w];E.y>x&&(x=E.y),E.y<y&&(y=E.y),E.x>b&&(b=E.x),E.x<A&&(A=E.x)}c<=b&&(c=b+1),l>=A&&(l=A-1),g.length&&u.push({curves:p.curves,points:g,isCW:pZ.isClockWise(g),identifier:o++,boundingBox:new j4(new Ae(A,y),new Ae(b,x))})});let h=u.map(p=>{var g;return a(p,u,l,c,(g=this.userData)==null?void 0:g.style.fillRule)}),d=[];return u.forEach(p=>{let g=h[p.identifier];if(g&&!g.isHole){let x=new n3;x.curves=p.curves,h.filter(y=>(y==null?void 0:y.isHole)&&y.for===p.identifier).forEach(y=>{if(y){let b=u[y.identifier],A=new i3;A.curves=b.curves,x.holes.push(A)}}),d.push(x)}}),d}},fte=!1,pte,s7=new Promise(e=>{pte=e}),a7=!1,eC;function Kze(){if(fte=!0,a7)return;if(eC)return eC;async function e(){let t=await dg(()=>import("./opentype-LDE648lb.js"),[]);pte(t),a7=!0}return eC=e(),eC}var Jze=class{async load(e,t,i=()=>{}){let{load:n}=await s7;n(e,(r,s)=>{r||!s?i(r??"Something went wrong"):t(s)})}async parse(e){let{parse:t,Bidi:i}=await s7;try{let n=t(e),r=new i,s=a=>n.charToGlyphIndex(a.char);return r.registerModifier("glyphIndex",null,s),r.applyFeatures(n,n.defaultRenderOptions.features),{font:n,bidi:r}}catch(n){console.error(n)}}};async function Zze(e){return await(await fetch(e)).arrayBuffer()}var $ze=new Jze;async function o7(e){let t,i,n=!1;if(e.url?(t=await Zze(e.url),i=e.url,n=e.url.startsWith("/")):e.data&&(t=e.data.buffer.slice(e.data.byteOffset,e.data.byteOffset+e.data.byteLength)),t)if(fte){let r=await $ze.parse(t);if(r)return{font:r.font,url:i,intercepted:n,arr:t,bidi:r.bidi}}else return{font:void 0,url:i,intercepted:n,arr:t,bidi:null}}function eFe(e,t){return t.state.glyphIndex===e||t.state.fina===e||t.state.medi===e||t.state.init===e}var tFe=class{constructor(e){this._arrayBuffer=new ArrayBuffer(1),this._isLoaded=!1,this._intercepted=!1,this._isUserFont=e.isUserFont??!1,this._loadingPromise=o7(e).then(t=>{t&&(this._arrayBuffer=t.arr,this._url=t.url,this.font=t.font,this._intercepted=t.intercepted,this._isLoaded=!0,this._bidi=t.bidi)})}update(e){this._isLoaded=!1,this._isUserFont=e.isUserFont??!1,this._loadingPromise=o7(e).then(t=>{t&&(this._arrayBuffer=t.arr,this._url=t.url,this.font=t.font,this._intercepted=t.intercepted,this._isLoaded=!0,this._bidi=t.bidi)})}get url(){return this._url}get intercepted(){return this._intercepted}get isLoaded(){return this._isLoaded}get loadingPromise(){return this._loadingPromise}reverseLigaturesTable(e,t,i){if(!this._bidi)return[];let n=this._bidi;n.getTextGlyphs(t);let r=n.tokenizer.tokens,s=[],a=0,o=i.length===r.length;for(let l=0;l<i.length;l++){let c=i[l].index,u=String.fromCharCode(i[l].unicode),h=r[a];if(eFe(c,h)||o)s.push({char:u,index:c,replacements:[h.state.glyphIndex],replacementChars:[h.char]}),a++;else{let d=h.char,p="",g=[h.state.glyphIndex],x=[],y=!1;for(;!y;)a++,p=t.charAt(a),d+=p,g.push(e.charToGlyphIndex(p)),x=e.stringToGlyphs(d),x.length===1&&x[0].index===c&&(y=!0),a>t.length&&(y=!0);s.push({char:u,index:c,replacements:g,replacementChars:Array.from(d)}),a++}}return s}generateShapes(e,t){if(!this._isLoaded)return;let i=this.font,n=t.fontSize/this.unitsPerEm,r=t.fontSize*t.lineHeight,s=e.map(b=>this.getTextWidth(b,t)),a=t.width,o=this.getCharWidth(`
`,t),l=t.horizontalAlign===1?o:0,c=this.computeSpaceWidthForLine(e,0,t),u=this.getLineInitialOffsetX(s[0],a,t.horizontalAlign,e[0],o),h=this.getLineInitialOffsetY(r,e.length,t.height,n,t.verticalAlign),d=[],p=e.map(b=>[]),g=e.map(b=>[]),x;for(let b=0;b<e.length;b++){let A=e[b],w={features:{liga:!0}},E=[];try{E=i.stringToGlyphs(A,w)}catch(T){console.warn(T)}u=this.getLineInitialOffsetX(s[b],a,t.horizontalAlign,A,o);let D=[];try{D=this.reverseLigaturesTable(i,A,E)}catch(T){console.warn(T)}c=this.computeSpaceWidthForLine(e,b,t);for(let T=0;T<E.length;T++){let I=E[T],R=I.index===0?`
`:I.unicode?String.fromCharCode(I.unicode):void 0,O=D[T],P=0,U=0;T===0&&t.horizontalAlign===2&&I.leftSideBearing!==void 0&&(U=-I.leftSideBearing*n),x&&(P=i.getKerningValue(I,x)*n),u+=U+P;let H=0;if(R===`
`)H=l;else if(R===" ")H=c;else{let V=this.createPath(I,n,u,h,t);V&&(H=V.offsetX-(P+U),d.push(V.path))}if(O.replacements.length===1)g[b].push([u,h]),p[b].push(H);else{let V=O.replacements.map(X=>(i.glyphs.get(X).advanceWidth??0)*n),j=V.reduce((X,W)=>X+=W,0),J=V.map(X=>X/j),F=u;for(let X=0;X<J.length;X++){let W=H*J[X];g[b].push([F,h]),p[b].push(W),F+=W}}u+=H,x=I}h-=r}let y=[];for(let b=0,A=d.length;b<A;b++)y.push(...d[b].toShapes());return{shapes:y,charWidths:p,lineWidths:s,charCoords:g}}get isUserFont(){return this._isUserFont}get arrayBuffer(){return this._arrayBuffer}get ascender(){var e;return((e=this.font)==null?void 0:e.ascender)??0}get descender(){var e;return((e=this.font)==null?void 0:e.descender)??0}get familyName(){var e;return((e=this.font)==null?void 0:e.names.fontFamily)??""}get subfamilyName(){var e;return((e=this.font)==null?void 0:e.names.fontSubfamily)??""}get unitsPerEm(){var e;return((e=this.font)==null?void 0:e.unitsPerEm)??1}getLineInitialOffsetX(e,t,i,n,r){return(i===3||i===2)&&n.indexOf(`
`)>=0&&(e-=r),i===3?t*.5-e*.5:i===2?t-e:0}getLineInitialOffsetY(e,t,i,n,r){let s=t*e,a=Math.abs(this.ascender-this.descender)*n,o=e-a,l=-this.ascender*n-o/2;return r===3?-(i-s-l):r===2?-(i*.5-s*.5-l):l}createPath(e,t,i,n,r){var l;let s=e.getPath(i,-n,r.fontSize,{kerning:!1,letterSpacing:r.letterSpacing});if(!s){console.error('THREE.Font: character "'+e+'" does not exists in font family '+this.familyName+".");return}let a=new Qze,o=(e.advanceWidth??1)*t;if(e)for(let c of s.commands){let u=(l=a.currentPath)==null?void 0:l.currentPoint;if(!(u&&c.type!=="Z"&&u.x===c.x&&-u.y===c.y))switch(c.type){case"M":a.moveTo(c.x,-c.y);break;case"L":a.lineTo(c.x,-c.y);break;case"Q":a.quadraticCurveTo(c.x1,-c.y1,c.x,-c.y);break;case"C":a.bezierCurveTo(c.x1,-c.y1,c.x2,-c.y2,c.x,-c.y);break}}return a.subPaths.forEach(c=>{let u=iFe(c.curves);u!==void 0&&c.currentPoint.distanceTo(u)>0&&c.lineTo(u.x,u.y)}),{offsetX:o+r.fontSize*r.letterSpacing,path:a}}getCharWidth(e,t){var i;return((i=this.font)==null?void 0:i.getAdvanceWidth(e,t.fontSize,{kerning:!0,letterSpacing:t.letterSpacing}))??0}getTextWidth(e,t){var i;return((i=this.font)==null?void 0:i.getAdvanceWidth(e,t.fontSize,{kerning:!0,letterSpacing:t.letterSpacing}))??0}computeSpaceWidthForLine(e,t,i){let n=this.getCharWidth(" ",i),r=e[t];if(r){let s=this.countSpaces(r.trimEnd());if(i.horizontalAlign===4&&t<e.length-1&&s){let a=i.width,o=this.getTextWidth(r,i);return(a-(o-s*n))/s}}return n}countSpaces(e){return(e.match(/ /g)||[]).length}};function iFe(e){if(e.length){let t=e[0];if(t instanceof Ku)return t.v1;if(t instanceof Xu||t instanceof ng)return t.v0}}var nFe=class{constructor(){this.objects=new Map,this.unreachable=new Set}getCached(e){return this.objects.get(e)}get size(){return this.objects.size}get(e,t,i){let n=this.objects.get(e);return n===void 0?(n=this.createObject(e,t,i),this.objects.set(e,n)):n.isShared=!0,n}forceDelete(e){let t=this.objects.get(e);t&&(this.disposeObject(t),this.objects.delete(e))}mutateIfUnique(e,t){let i=this.objects.get(e);if(i&&i.isShared!==!0)return this.objects.delete(e),this.objects.set(t,i),i}startGc(){this.unreachable=new Set(this.objects.keys())}markAsReachable(e,t){let i=this.objects.get(e);t===i&&this.unreachable.delete(e)}endGc(){this.unreachable.forEach(e=>{this.disposeObject(this.objects.get(e)),this.objects.delete(e)}),this.unreachable.clear()}dispose(){this.objects.forEach(e=>{this.disposeObject(e)}),this.objects.clear()}},l7=class extends nFe{constructor(e){super(),this.flatShading=e}disposeObject(e){e.dispose()}createObject(e,t,i){let n=Bw(e,t,this.flatShading,i);return n.computeBoundingSphere(),n}},rFe={markNeedsUpdateRendererDirty:()=>{}},HC=1e3,c7=512*HC;function sFe(e,t){let i=typeof e;return!!((t==="string"||t==="number")&&i===t||t==="boolean"&&(e==="true"||e==="false"||e===!0||e===!1)||t==="image"&&i==="string"&&e.startsWith("http"))}var aFe="https://hooks.spline.design",oFe=`${aFe}/events?hashFile=`,lFe=class{constructor(e,t){this.id=e,this.userWebhook=t,this.result=void 0,this._connected=!1,this.emitter=oP(),this.reconnectWaitFor=HC,this._onError=i=>{var n,r,s;(n=this.eventSource)==null||n.removeEventListener("message",this._onMessage),(r=this.eventSource)==null||r.removeEventListener("error",this._onError),(s=this.eventSource)==null||s.removeEventListener("open",this._onConnected),this._scheduleReconnect()},this._onConnected=i=>{clearTimeout(this.scheduledReconnectHandle),this.reconnectWaitFor=HC,this._connected=!0},this._onDisconnected=()=>{clearTimeout(this.scheduledReconnectHandle),this.reconnectWaitFor=HC,this._connected=!1},this._onMessage=i=>{let n=i.data,r;try{r=JSON.parse(n)}catch(s){console.error("Error parsing webhook message",s)}if(r){let s=!1;this.userWebhook.parametersSchemas.forEach(({data:a})=>{r[a.name]!==void 0&&sFe(r[a.name],a.type)&&(this.result===void 0&&(this.result={}),this.result[a.name]=r[a.name],s=!0)}),s&&this.emitter.emit("message",{userWebhookId:this.id})}}}connect(){clearTimeout(this.scheduledReconnectHandle),this.userWebhook.url&&(this.eventSource=new EventSource(oFe+this.userWebhook.url),this.eventSource.addEventListener("message",this._onMessage),this.eventSource.addEventListener("error",this._onError),this.eventSource.addEventListener("open",this._onConnected))}disconnect(){var e,t,i,n;(e=this.eventSource)==null||e.removeEventListener("message",this._onMessage),(t=this.eventSource)==null||t.removeEventListener("error",this._onError),(i=this.eventSource)==null||i.removeEventListener("open",this._onConnected),(n=this.eventSource)==null||n.close(),this._onDisconnected(),clearTimeout(this.scheduledReconnectHandle)}_scheduleReconnect(){this.reconnectWaitFor*=2,this.reconnectWaitFor>c7&&(this.reconnectWaitFor=c7),clearTimeout(this.scheduledReconnectHandle),this.scheduledReconnectHandle=setTimeout(()=>{this.scheduledReconnectHandle=void 0,this.connect()},this.reconnectWaitFor)}update(e){this.userWebhook=e}dispose(){this._connected&&this.disconnect()}get connected(){return this._connected}on(e,t){this.emitter.on(e,t)}off(e,t){this.emitter.off(e,t)}getParametersKeys(){return this.userWebhook.parametersSchemas.map(e=>e.data.name)}getParameterValue(e){var t;if(this.getParametersKeys().includes(e)){if(this.result)return(t=this.result)==null?void 0:t[e];for(let i of this.userWebhook.parametersSchemas)if(i.data.name===e)return zN.defaultParameterValueByType(i.data.type)}}},u7=[4186.01,4434.92,4698.63,4978.03,5274.04,5587.65,5919.91,6271.93,6644.88,7040,7458.62,7902.13],cFe=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],Km=[],I5=[];for(let e=1;e<=8;e++)for(let t=0;t<u7.length;t++){let i=u7[t];Km.push(i/Math.pow(2,8-e)),I5.push(cFe[t]+e)}var k3=[32,2e3],h7=Km.filter((e,t)=>Km[t]>k3[0]&&Km[t]<k3[1]),uFe=I5.filter((e,t)=>Km[t]>k3[0]&&Km[t]<k3[1]),hFe=class{static getFrequencies(e,t,i,n="frequency",r=-100,s=-30){i||(i=new Float32Array(e.frequencyBinCount),e.getFloatFrequencyData(i));let a=t/2,o=1/i.length*a,l,c,u;if(n==="music"||n==="voice"){let d=n==="voice"?h7:Km,p=Array(d.length).fill(r);for(let g=0;g<i.length;g++){let x=g*o,y=i[g];for(let b=d.length-1;b>=0;b--)if(x>d[b]){p[b]=Math.max(p[b],y);break}}l=p,c=n==="voice"?h7:Km,u=n==="voice"?uFe:I5}else l=Array.from(i),c=l.map((d,p)=>o*p),u=c.map(d=>`${d.toFixed(2)} Hz`);let h=l.map(d=>Math.max(0,Math.min((d-r)/(s-r),1)));return{values:new Float32Array(h),frequencies:c,labels:u}}},dFe="gpt-4o-realtime-preview-2024-12-17",fFe=()=>"https://relayserver.spline.design/";async function pFe(e){try{return(await(await fetch(fFe()+"session?uuidfile="+e)).json()).token}catch(t){console.error("Token generation error:",t)}}var mFe=class{constructor(e){this.value=0,this.frequencies=new Float32Array(0);let t=new AudioContext;this.source=t.createMediaStreamSource(e),this.analyser=t.createAnalyser(),this.source.connect(this.analyser),this.analyser.fftSize=8192,this.analyser.smoothingTimeConstant=.1}getFrequencies(e=-100,t=-30){if(!this.analyser)throw new Error("Not connected, please call .connect() first");return hFe.getFrequencies(this.analyser,44100,void 0,"voice",e,t)}update(){let e=this.getFrequencies(),t=e.values.reduce((i,n)=>i+n,0)/e.values.length;this.value=t,this.frequencies=e.values}disconnect(){this.source.disconnect(),this.analyser.disconnect()}},d7=class{constructor(e,t,i){this.data=e,this.id=t,this.shared=i,this.emitter=oP(),this.rafId=0,this.voice=0,this.frequencies=new Float32Array([0]),this.events=[],this.isConnected=!1,this.isToolsAdded=!1,this.tools=[],this.onMessage=n=>{var s;let r=JSON.parse(n.data);if(this.appendEvent(r),r.type==="session.created"&&this.onSessionCreated(),r.type==="response.done"&&((s=r.response)==null?void 0:s.output)){for(let a of r.response.output)if(a.type==="function_call")for(let[o,l]of this.tools)a.name===o.name&&(l(JSON.parse(a.arguments)),setTimeout(()=>{this.sendClientEvent({type:"response.create",response:{instructions:"notice the user about what you just did"}})}))}},this.onSessionCreated=()=>{this.isToolsAdded||this.registerTools()},this.onOpen=()=>{this.events=[],this.isConnected=!0,this.sendClientEvent({type:"response.create",response:{instructions:"Say hi"}})},this.animate=()=>{if(this.rafId=requestAnimationFrame(this.animate),this.isConnected&&this.analyser){this.analyser.update();let n=this.analyser.value,r=this.analyser.frequencies;this.voice=n,this.frequencies=r,this.emitter.emit("voice",{value:n,frequencies:r})}}}update(e){this.data=e}setColorByName(e,t){let i=this.shared.getColorByName(e);if(i){let{id:n}=i,{r,g:s,b:a}=VUe.hexStringToRgb(t)??{r:0,g:0,b:0};this.shared.updateColor(n,{r:r/255,g:s/255,b:a/255})}}async connect(){if(this.isConnected)return;let e=await pFe(this.data.integration.hash);this.pc=new RTCPeerConnection,this.audioElement=document.createElement("audio"),this.audioElement.autoplay=!0,this.pc.ontrack=r=>{let s=r.streams[0];this.audioElement.srcObject=s,this.analyser=new mFe(s)};let t=await navigator.mediaDevices.getUserMedia({audio:!0});this.pc.addTrack(t.getTracks()[0]),this.dc=this.pc.createDataChannel("oai-events"),this.dc.addEventListener("message",this.onMessage),this.dc.addEventListener("open",this.onOpen);let i=await this.pc.createOffer();await this.pc.setLocalDescription(i);let n={type:"answer",sdp:await(await fetch(`https://api.openai.com/v1/realtime?model=${dFe}`,{method:"POST",body:i.sdp,headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/sdp"}})).text()};await this.pc.setRemoteDescription(n),this.animate()}appendEvent(e){this.events=[e,...this.events]}sendClientEvent(e){this.dc?(e.event_id=e.event_id||crypto.randomUUID(),this.dc.send(JSON.stringify(e)),this.appendEvent(e)):console.error("Failed to send message - no data channel available",e)}registerTools(){this.isToolsAdded=!0,this.registerTool({type:"function",name:"set_personality_color",description:"returns a color based on the voice personality of the ai assistant. This should be called by the voice assistant each time it is asks to speak differently. If a color cannot be associated to the personality, the color should be a neutral color.",parameters:{type:"object",properties:{color:{type:"string",description:"css hex color string, reflecting the personality"},personality:{type:"string",description:"the personality of the voice assistant"}},required:["color","personality"]}},({color:r})=>{this.setColorByName("Voice Assistant Color",r)});let e=this.shared.getVariablesNames().join(", ");this.registerTool({type:"function",name:"set_variable",description:"Sets a Spline variable value when asked by the user.",parameters:{type:"object",properties:{name:{type:"string",description:`The name of the variable that needs to be set. Here's a list of available variables: ${e}. It the variable does not exist, don't call the function and warn the user about it.`},value:{type:"string",description:"The new value for this variable, should always be a string even for number and boolean variables, assume that the value will be cast to the proper type afterwards."}},required:["name","value","type"]}},({name:r,value:s})=>{let a=this.shared.getVariableByName(r);if(a){let o=this.shared.getVariable(a.id),l;typeof o=="number"?l=parseFloat(s):typeof o=="boolean"?l=s.toLowerCase()==="true":l={textValue:s},this.shared.updateVariable(a.id,l)}});let t=this.shared.getColorNames().join(", ");this.registerTool({type:"function",name:"set_color",description:"Sets a Spline color asset value when asked by the user.",parameters:{type:"object",properties:{name:{type:"string",description:`The name of the color asset that needs to be set. Here's a list of available color assets: ${t}. It the color asset does not exist, don't call the function and warn the user about it.`},value:{type:"string",description:"css hex color string"}},required:["name","value"]}},({name:r,value:s})=>{this.setColorByName(r,s)});let i=this.shared.scene,n=[];i.traverseEntity(r=>{r.data.events.forEach(s=>{if(s.data.type==="AIAssistantTrigger"){let{description:a}=s.data;n.push(a)}})}),this.registerTool({type:"function",name:"trigger_event",description:"Trigger an event by name, here are the available events, please match what the user is asking for to one of these if it applies, otherwise don't call the function and warn the user.",parameters:{type:"object",properties:{description:{type:"string",description:`The name of the event that needs to be triggered. Here's a list of available events: ${JSON.stringify(n)}.`},direction:{type:"string",description:"default is forward, but can be forward or backward. Always set to forward unless the user ask to reverse or cancel the event, then set to backward."}},required:["description","direction"]}},({description:r,direction:s})=>{this.emitter.emit("trigger_event",{description:r,direction:s})}),this.sendClientEvent({type:"session.update",session:{tools:this.tools.map(([r])=>r)}})}registerTool(e,t){this.tools.push([e,t])}disconnect(){var e,t,i,n,r,s;cancelAnimationFrame(this.rafId),(e=this.analyser)==null||e.disconnect(),this.voice=0,this.isConnected=!1,this.isToolsAdded=!1,(t=this.dc)==null||t.removeEventListener("message",this.onMessage),(i=this.dc)==null||i.removeEventListener("open",this.onOpen),(n=this.dc)==null||n.close(),(r=this.pc)==null||r.getSenders().forEach(a=>{a.track&&a.track.stop()}),(s=this.pc)==null||s.close(),this.pc=void 0}computeAnalysisForListenerEvent(e){if(e.analysis==="range"){let t=this.frequencies.slice(...e.analysisRange);return t.reduce((i,n)=>i+n,0)/t.length}return e.analysis==="single"?this.frequencies[e.analysisSingle]:this.voice}on(e,t){this.emitter.on(e,t)}off(e,t){this.emitter.off(e,t)}};function hz(e){return"variable_"+e}var gFe=class extends tze{constructor(e){super(),this.shared=e}create(e){return new rte(e,this.shared)}},L5=class{constructor(e,t={},i=!0,n=!1){if(this.data=e,this.needsJitter=i,this.enableLocalStorageForPersistentVariables=n,this.geometryCache=new l7(!0),this.geometryCache2=new l7(!1),this.imageHolderCache=new gFe(this),this.thisContext={scene:rFe,shared:this},this.deletedMaterial=new uz(ga.defaultTwoLayerData("phong"),this.thisContext,""),this.deletedImage=new Im(VN.emptyImage,this),this.deletedVideo=new Im(w3.defaultVideo,this),this.materials={},this.images={},this.uiBuffers={},this.videos={},this.colors={},this.audios={},this.particles={},this.fonts={},this.variables={},this.userAPIs={},this.userWebhooks={},this.mouseProperty=null,this.raycastProperty=null,this.requestRender=()=>{this._requestRender&&this._requestRender()},t.images)for(let[r,s]of Object.entries(t.images))this.addImage(r,s);if(t.videos)for(let[r,s]of Object.entries(t.videos))this.addVideo(r,s);if(t.audios)for(let[r,s]of Object.entries(t.audios))this.addAudio(r,s);if(t.particles)for(let[r,s]of Object.entries(t.particles))this.addParticle(r,s);this.reset(e)}setRequestRender(e){this._requestRender=e}getImageLoadPromises(){return Object.values(this.images).map(e=>e.loadPromise)}setEntityOpContext(e){this.entityOpContext=e}reset(e,t=!1){this.data=e,this.resetLib(e.lib);for(let{id:i,data:n}of e.variables)this.addVariableHolder(i,n),t&&this.updateVariableHolder(i,n);for(let[i,n]of Object.entries(e.userAPIs))this.addUserAPI(i,n);for(let[i,n]of Object.entries(e.userWebhooks))this.addUserWebhook(i,n);for(let[i,n]of Object.entries(e.images))this.addImage(i,n);for(let[i,n]of Object.entries(e.videos))this.addVideo(i,n);for(let[i,n]of Object.entries(e.colors))this.addColor(i,n);for(let[i,n]of Object.entries(e.materials))this.addMaterial(i,n);for(let[i,n]of Object.entries(e.audios))this.addAudio(i,n);for(let[i,n]of Object.entries(e.particles))this.addParticle(i,n);for(let[i,n]of Object.entries(e.fonts))this.addFont(i,n)}addMaterial(e,t){if(this.materials[e]){let i=this.materials[e];i.reset(t,this.thisContext),i.dispose()}else{let i=new uz(t,this.thisContext,e);this.materials[e]=i}}deleteMaterial(e){this.materials[e]&&(this.materials[e].nodeMaterialDispose(),delete this.materials[e])}getMaterial(e){return this.materials[e]}getMaterialOrDeletedPlaceholder(e){return this.materials[e]??this.deletedMaterial}material(e){return typeof e=="string"?this.getMaterialOrDeletedPlaceholder(e):e==null?(console.error("material is undefined or null"),this.deletedMaterial):new B5(e,this.thisContext)}getMaterials(){return this.materials}addImage(e,t){return this.images[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.images[e].updateSrc(t.data),!0):(this.images[e]=new Im(t,this),!1)}deleteImage(e){let t=this.images[e];t&&(t.dispose(),delete this.images[e])}getDefaultImage(){return this.images.image_0}getImage(e){return this.images[e]??this.deletedImage}image(e){return typeof e=="string"?this.getImage(e):this.imageHolderCache.load(e)}addUIBuffer(e,t){return this.uiBuffers[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.uiBuffers[e].updateSrc(t),!0):(this.uiBuffers[e]=new Im(t,this),!1)}uiBuffer(e){return this.uiBuffers[e]}addVideo(e,t){return this.videos[e]?(this.videos[e].updateSrc(t.data),!0):(this.videos[e]=new Im(t,this),!1)}deleteVideo(e){let t=this.videos[e];t&&(t.dispose(),delete this.videos[e])}getVideo(e){return this.videos[e]??this.deletedVideo}video(e){return typeof e=="string"?this.getVideo(e):this.imageHolderCache.load(e)}addColor(e,t){return this.colors[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),"a"in t?this.colors[e].setRGBA(t.r,t.g,t.b,t.a):this.colors[e].setRGBA(t.r,t.g,t.b,1),!0):("a"in t?this.colors[e]=new G3(t.r,t.g,t.b,t.a):this.colors[e]=new G3(t.r,t.g,t.b,1),!1)}updateColor(e,t){if(this.colors[e]){this.onColorOrImageUpdate&&this.onColorOrImageUpdate();let i=this.colors[e];return this.colors[e].r=t.r??i.r,this.colors[e].g=t.g??i.g,this.colors[e].b=t.b??i.b,this.colors[e].a=t.a??i.a,!0}return!1}deleteColor(e){this.colors[e]&&delete this.colors[e]}getColor(e){return this.colors[e]}getColorNames(){return Object.values(this.data.colors).map(e=>e.name)}getColorByName(e){for(let t in this.data.colors)if(this.data.colors[t].name===e)return{color:this.colors[t],id:t}}color(e){let t;if(typeof e=="string"){let i=this.getColor(e);i?t=i:(console.warn("Tried to create color layer params with a color key that does not exist in the assets manager"),t=new Qa(0,0,0,0))}else return"a"in e?new Qa(e.r,e.g,e.b,e.a):new Qa(e.r,e.g,e.b,1);return t}addAudio(e,t){this.audios[e]=t}getAudio(e){let t=this.audios[e];if(t instanceof mA)return t;{let i=new mA({src:t.data});return this.audios[e]=i,i}}addParticle(e,t){this.particles[e]=t}getParticle(e){return this.particles[e]}deleteParticle(e){this.particles[e]&&delete this.particles[e]}deleteAudio(e){let t=this.audios[e];t&&(t instanceof mA&&t.dispose(),delete this.audios[e])}addFont(e,t){this.fonts[e]=new tFe(t),this.fonts[e].loadingPromise.then(()=>this.requestRender())}getFont(e){return this.fonts[e]}deleteFont(e){this.fonts[e]&&delete this.fonts[e]}dispose(){Object.keys(this.materials).forEach(e=>this.deleteMaterial(e)),this._requestRender=void 0,Object.values(this.audios).forEach(e=>{e instanceof mA&&e.dispose()}),this.audios={},this.particles={},this.geometryCache.dispose(),this.geometryCache2.dispose()}addVariableHolder(e,t){if(this.variables[e]===void 0){let i=t.value;if(this.enableLocalStorageForPersistentVariables&&t.persistent){let n=localStorage.getItem(hz(e));i=n!==null?JSON.parse(n):t.value}return this.variables[e]={value:i,locations:[],persistent:t.persistent},"dynamicVariableType"in t&&(this.variables[e].dynamicVariablePlayState="Playing",this.variables[e].dynamicVariableToggleIsForward=void 0),!0}return this.variables[e].value=t.value,!1}resetDynamicVariablePlayState(){for(let e in this.variables)this.variables[e].dynamicVariablePlayState!==void 0&&(this.variables[e].dynamicVariablePlayState="Playing",this.variables[e].dynamicVariableToggleIsForward=void 0)}updateVariableHolder(e,t){this.updateVariable(e,t.value)}updateVariable(e,t){if(this.variables[e]===void 0)return!1;this.variables[e].value=t,this.enableLocalStorageForPersistentVariables&&this.variables[e].persistent&&localStorage.setItem(hz(e),JSON.stringify(t));let i=t;for(;typeof i=="string";)i=this.variables[i].value;let n=this.entityOpContext.scene;for(let r=this.variables[e].locations.length-1;r>=0;r--){let s=this.variables[e].locations[r];if(s[0]==="material"){let a=s[1],o=i,l={scene:n,shared:this},c=s.slice(2);n.traverseMaterial(h=>{let d=h.root??h;d.uuid===a&&d.onVariableUpdate(c,o,l)});let u=this.materials[a];u&&u.onVariableUpdate(c,o,l)}else{let a=n.find(s[0]);if(a===void 0){this.variables[e].locations.splice(r,1);continue}if(s[1]!=="geometry"&&s[1]!=="particles"){for(let o=1;o<s.length-1;o++)a=a[s[o]];s[1]==="rotation"?a[s[s.length-1]]=i*qt.DEG2RAD:a[s[s.length-1]]=i}if(a=n.find(s[0]),a.type==="ParticleEmitter"&&a.updateVariableState(i,s),dn.is(a))if(s[1]==="position"||s[1]==="rotation"||s[1]==="scale")a.onVariableUpdate();else if(s[1]==="geometry"){let o=a;a.component&&(o=a.component);let l=o.dataPatched;o.chooseGeoemtryCache(this).forceDelete(l.geometry),o.createGeometryDelayed(this.entityOpContext),o.onVariableUpdate(!0),o.invalidateDownstreamBooleanData(),o.instances.forEach(c=>{let u=c.dataPatched;c.chooseGeoemtryCache(this).forceDelete(u.geometry),c.createGeometryDelayed(this.entityOpContext),c.onVariableUpdate(!0),c.invalidateDownstreamBooleanData()})}else s[1]==="morphTargetInfluences"&&a.updateMorphInfluences(s[2],i)}}return this.requestRender(),!0}deleteVariable(e){this.variables[e]&&delete this.variables[e]}getVariable(e,t){var i,n,r;if(Array.isArray(e)){if(e[0]==="mouse")return((i=this.mouseProperty)==null?void 0:i[e[1]])??0;if(e[0]==="raycast")return((n=this.raycastProperty)==null?void 0:n[e[1]])??0;let s=this.entityOpContext.scene.find(e[0]);if(e[1]==="width"||e[1]==="height"||e[1]==="depth")return s.geometry.userData.parameters[e[1]];for(let a=1;a<e.length;a++)s=s[e[a]];return e[1]==="rotation"&&(s*=qt.RAD2DEG),s}for(let s in this.variables){if(t===void 0)break;let a=this.variables[s],o=(r=a.locations)==null?void 0:r.findIndex(l=>Ys.equal(l,t));o!==void 0&&o!==-1&&a.locations.splice(o,1)}if(typeof e=="string"){let s=e,a=e;do{if(a=s,this.variables[s]===void 0)break;let o=this.variables[s].value;t&&this.variables[a]!==void 0&&this.variables[a].locations.push(t),s=o}while(typeof s=="string");return s}else return e}getVariables(){return this.variables}getVariablesNames(){return this.data.variables.map(e=>e.data.name)}getVariableByName(e){for(let t of this.data.variables)if(t.data.name===e)return{variable:t.data,id:t.id}}getDynamicVariablePlayState(e){var t;return(t=this.variables[e])==null?void 0:t.dynamicVariablePlayState}setDynamicVariablePlayState(e,t){this.variables[e]!==void 0&&(this.variables[e].dynamicVariablePlayState=t)}getDynamicVariableToggleIsForward(e){var t;return(t=this.variables[e])==null?void 0:t.dynamicVariableToggleIsForward}setDynamicVariableToggleIsForward(e,t){this.variables[e]!==void 0&&(this.variables[e].dynamicVariableToggleIsForward=t)}resetLib(e){for(let[t,i]of Object.entries(e.images))this.addImage(t,i.asset);for(let[t,i]of Object.entries(e.audios))this.addAudio(t,i.asset);for(let[t,i]of Object.entries(e.particles))this.addParticle(t,i.asset);for(let[t,i]of Object.entries(e.colors))this.addColor(t,i.asset);for(let[t,i]of Object.entries(e.fonts))this.addFont(t,i.asset);for(let[t,i]of Object.entries(e.materials))this.addMaterial(t,i.asset);for(let[t,i]of Object.entries(e.videos))this.addVideo(t,i.asset);for(let[t,i]of Object.entries(e.variables))this.addVariableHolder(t,i.asset)}updateLibByOp(e,t){e.path[0]==="images"?e.path.length===1&&e.type===1?this.addImage(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteImage(e.id):e.path[0]==="videos"?e.path.length===1&&e.type===1?this.addVideo(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteVideo(e.id):e.path[0]==="audios"?e.path.length===1&&e.type===1?this.addAudio(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteAudio(e.id):e.path[0]==="particles"?e.path.length===1&&e.type===1?this.addParticle(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteParticle(e.id):e.path[0]==="colors"?e.path.length===1&&e.type===1?this.addColor(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteColor(e.id):e.path[0]==="materials"?e.path.length===1&&e.type===1?this.addMaterial(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteMaterial(e.id):e.path[0]==="fonts"?e.path.length===1&&e.type===1?this.addFont(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteFont(e.id):e.path[0]==="variables"?e.path.length===1&&e.type===1?this.addVariableHolder(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteVariable(e.id):e.path[0]==="components"&&t.updateByLibOp(e,this)}updateByOp(e,t,i){var n;if(this.data=t,e.path[0]==="images")e.path.length===2&&e.type===0?e.props.data&&this.getImage(e.path[1]).updateSrc(e.props.data):e.path.length===1&&e.type===1?this.addImage(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteImage(e.id);else if(e.path[0]==="videos")e.path.length===2&&e.type===0?e.props.data&&this.getVideo(e.path[1]).updateSrc(e.props.data):e.path.length===1&&e.type===1?this.addVideo(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteVideo(e.id);else if(e.path[0]==="audios")e.path.length===2&&e.type===0?e.props.data&&this.addAudio(e.path[1],t.audios[e.path[1]]):e.path.length===1&&e.type===1?this.addAudio(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteAudio(e.id);else if(e.path[0]==="particles")e.path.length===2&&e.type===0?e.props.data&&this.addParticle(e.path[1],t.particles[e.path[1]]):e.path.length===1&&e.type===1?this.addParticle(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteParticle(e.id);else if(e.path[0]==="colors")e.path.length===2&&e.type===0?this.updateColor(e.path[1],e.props):e.path.length===1&&e.type===1?this.addColor(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteColor(e.id);else if(e.path[0]==="materials")e.path.length===1&&e.type===1?this.addMaterial(e.id,e.data):e.path.length===1&&e.type===2?this.deleteMaterial(e.id):e.path.length>1&&this.getMaterial(e.path[1]).updateByOp(ma.drop(e,2),t.materials[e.path[1]],{shared:this,scene:i});else if(e.path[0]==="fonts")e.path.length===2&&e.type===0?this.updateFont(e.path[1],e,i):e.path.length===1&&e.type===1?this.addFont(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteFont(e.id);else if(e.path[0]==="variables")e.path.length===2&&e.type===0?"value"in e.props?this.updateVariable(e.path[1],e.props.value):"persistent"in e.props&&(this.variables[e.path[1]].persistent=e.props.persistent):e.path.length===1&&e.type===4?this.addVariableHolder(e.id,e.data):e.path.length===1&&e.type===5&&this.deleteVariable(e.id);else if(e.path[0]==="userAPIs"){if(e.path.length===1&&e.type===1)this.addUserAPI(e.id,e.data);else if(e.path.length===1&&e.type===2)this.deleteUserAPI(e.id);else if(typeof e.path[1]=="string"){let r=t.userAPIs[e.path[1]];if(r){let s=e.type===0&&e.props.debounce===void 0,a=this.getUserAPI(e.path[1]);a instanceof d7?a.update(r):a==null||a.update(r,this,s)}}}else if(e.path[0]==="userWebhooks"){if(e.path.length===1&&e.type===1)this.addUserWebhook(e.id,e.data);else if(e.path.length===1&&e.type===2)this.deleteUserWebhook(e.id);else if(typeof e.path[1]=="string"){let r=t.userWebhooks[e.path[1]];r&&((n=this.getUserWebhook(e.path[1]))==null||n.update(r))}}else e.path[0]==="lib"&&this.updateLibByOp(ma.drop(e,1),i)}updateFont(e,t,i){if(t.props.url){let n=this.getFont(e),r={...this.data.fonts[e],url:t.props.url};n.update(r),n.loadingPromise.then(()=>this.requestRender()),i.updateFont(e,this)}}addUserAPI(e,t){var i,n;return this.userAPIs[e]?(this.userAPIs[e].update(t,this),!0):((i=this.openAIRealtime)==null?void 0:i.id)===e?(this.openAIRealtime.update(t),!0):((n=t.integration)==null?void 0:n.type)==="VoiceAssistant"?(this.openAIRealtime=new d7(t,e,this),!1):(this.userAPIs[e]=new See(e,t,this),!1)}getUserAPI(e){var t;return((t=this.openAIRealtime)==null?void 0:t.id)===e?this.openAIRealtime:this.userAPIs[e]}getUserAPIs(){return this.userAPIs}deleteUserAPI(e){let t=this.userAPIs[e];t&&(t.dispose(),delete this.userAPIs[e])}addUserWebhook(e,t){return this.userWebhooks[e]?(this.userWebhooks[e].update(t),!0):(this.userWebhooks[e]=new lFe(e,t),!1)}getUserWebhook(e){return this.userWebhooks[e]}getUserWebhooks(){return this.userWebhooks}deleteUserWebhook(e){let t=this.userWebhooks[e];t&&(t.dispose(),delete this.userWebhooks[e])}get scene(){return this.entityOpContext.scene}};new L5(zc.emptyData());var Gb=class extends nl{updateByPatchedOp(e,t,i){if(super.updateByPatchedOp(e,t,i),CBe(e.path,["materials"])!==null&&e.type===0&&Array.isArray(this.material))for(let[n,r]of Object.entries(e.props)){let s=i.shared.material(r);this.material[Number(n)]=s}else if(cr(e.path,["material"])&&this.material instanceof sg)"material"in t&&typeof t.material!="string"&&this.material.updateByOp(ma.drop(e,1),t.material,i);else if(cr(e.path,["materials","*"])&&Array.isArray(this.material)){let n=e.path[1];if("materials"in t&&n<this.material.length){let r=t.materials[n];typeof r!="string"&&this.material[n].updateByOp(ma.drop(e,2),r,i)}}}get needsAO(){return this.material!==void 0?(Array.isArray(this.material)?this.material[0]:this.material).hasAO:!1}updateState(e,t){var r,s;super.updateState(e,t),e.castShadow!==void 0&&(this.castShadow=e.castShadow),e.receiveShadow!==void 0&&(this.receiveShadow=e.receiveShadow);let i=this.dataPatched;this.dataPatched.type==="Mesh"&&this.dataPatched.geometry.shapeBlendNode&&this.layers.set(9);let n;if(this.dataPatched.type==="Mesh"&&this.dataPatched.geometry.type==="ShapeBlendGeometry"&&(n={resolutionLevel:this.dataPatched.geometry.resolutionLevel,useChildrenColors:this.dataPatched.geometry.useChildrenColors}),((r=e.geometry)==null?void 0:r.type)!=="NonParametricGeometry"&&"material"in e&&e.material!==void 0&&(this.disposeMaterial(),this.material=t.shared.material(e.material).getFlavor(i.flatShading,i.side,i.wireframe,n),t.scene.markNeedsUpdateRendererDirty()),(((s=e.geometry)==null?void 0:s.type)==="NonParametricGeometry"||"materials"in e)&&("materials"in e&&e.materials!==void 0?(this.disposeMaterial(),this.material=e.materials.map(a=>t.shared.material(a).getFlavor(i.flatShading,i.side,i.wireframe)),t.scene.markNeedsUpdateRendererDirty()):"material"in e&&e.material!==void 0&&(this.disposeMaterial(),this.material=[t.shared.material(e.material).getFlavor(i.flatShading,i.side,i.wireframe)],t.scene.markNeedsUpdateRendererDirty())),e.flatShading!==void 0||e.wireframe!==void 0||e.side!==void 0)if(Array.isArray(this.material))for(let a=0;a<this.material.length;a++)this.material[a]=this.material[a].getFlavor(i.flatShading,i.side,i.wireframe);else this.material=this.material.getFlavor(i.flatShading,i.side,i.wireframe,n)}disposeMaterial(){this.material&&u$(this.material).forEach(e=>{e instanceof sg&&(e instanceof uz||e.nodeMaterialDispose())})}dispose(){this.disposeMaterial(),super.dispose()}},f7=new G,p7=new Di,m7=new Di,vFe=new G,g7=new Bt,Ds=class extends Gb{constructor(e,t,i){super(e,t),this.data=t,this.isSkinnedMesh=!1,this.localGeometry=void 0,t.bindMode&&t.bindMatrix&&(this.bindMode=t.bindMode,this.bindMatrix=new Bt().fromArray(t.bindMatrix),this.bindMatrixInverse=new Bt)}chooseGeoemtryCache(e){return e.geometryCache}markGeometryAsReachable(e){this.geometryCreateDeleyed instanceof ii&&this.chooseGeoemtryCache(e).markAsReachable(this.dataPatched.geometry,this.geometryCreateDeleyed)}get geometry(){if(this.localGeometry!==void 0)return this.localGeometry;if(this.geometryCreateDeleyed instanceof L5){let e=this.geometryCreateDeleyed,t=this.chooseGeoemtryCache(e);this.geometryCreateDeleyed=t.get(this.dataPatched.geometry,e,this)}return this.geometryCreateDeleyed}set geometry(e){this.localGeometry=e}get is2DAndNoDepth(){let e=this.dataPatched.geometry;return T3.is2DParametricMesh(e.type)&&e.depth===0}get is2DType(){return T3.is2DParametricMesh(this.geometry.userData.type)}get isNonParametric(){return this.geometry.userData.type==="NonParametricGeometry"}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),cr(e.path,["geometry"])&&this.updateByPatchedOpGeometry(ma.drop(e,1),t.geometry,i)}removeInteractionGeometry(e){var t;(t=this.localGeometry)==null||t.dispose(),this.localGeometry=void 0}updateGeometryInteractions(e,t){var n;this.invalidateDownstreamBooleanData();let i=this.data.geometry.type;if(i==="NonParametricGeometry"||i==="SubdivGeometry"){let r=e;if(this.localGeometry===void 0){let c={...this.data.geometry,...r};this.localGeometry=Bw(c,t,this.data.flatShading,this)}let s,a,o;r.scaleBaked?[s,a,o]=r.scaleBaked:{width:s,height:a,depth:o}=r;let l=this.localGeometry.userData;l.sxPrev!==void 0&&rz(this.localGeometry.attributes,s/l.sxPrev,a/l.syPrev,o/l.szPrev),l.sxPrev=s,l.syPrev=a,l.szPrev=o}else{let r={...this.data.geometry,...e};(n=this.localGeometry)==null||n.dispose(),this.localGeometry=Bw(r,t,this.data.flatShading,this)}}refreshAttachedClonersInteractions(){for(let e of this.attachedSurfaceCloners)e.update()}refreshAttachedCloners(e){for(let t of this.attachedSurfaceCloners)e.scene.addPendingUpdateCloner(t.object)}refreshAttachedPaths(e){for(let t of this.attachedPaths)e.scene.addPendingCommand(()=>t.updateShape())}createGeometryDelayed(e){this.geometryCreateDeleyed=e.shared,this.refreshAttachedCloners(e),this.refreshAttachedPaths(e)}updateByPatchedOpGeometry(e,t,i){var r;let n=!1;e.type===0&&e.path.length===0&&Object.keys(e.props).includes("scaleBaked")&&this.geometryCreateDeleyed instanceof qo&&this.chooseGeoemtryCache(i.shared).mutateIfUnique(this.geometryCreateDeleyed.data,t)===this.geometryCreateDeleyed&&(n=!0,this.geometryCreateDeleyed.mutateDirectlyScaleBaked(t,e.props.scaleBaked),this.refreshAttachedCloners(i),this.refreshAttachedPaths(i)),n||((r=i.scene)==null||r.markGeometryCacheDirty(),this.createGeometryDelayed(i)),this.resetBBoxNeedsUpdate(),this.invalidateDownstreamBooleanData()}updateGeometryOnStateUpdate(e,t){this.createGeometryDelayed(t)}updateState(e,t){e.geometry!==void 0&&this.updateGeometryOnStateUpdate(e.geometry,t);let i=e.morphTargetInfluences;if(i){this.updateMorphTargets(),this.geometry.morphTargetsRelative=!0;for(let{data:{name:n,value:r}}of i)this.updateMorphInfluences(n,t.shared.getVariable(r,[this.uuid,"morphTargetInfluences",n]))}super.updateState(e,t)}updateMorphInfluences(e,t){if(this.morphTargetDictionary===void 0)return;let i=this.morphTargetDictionary[e];i!==void 0&&(this.morphTargetInfluences[i]=t)}updateGeometryGroupsIfNeeded(){var e;Array.isArray(this.material)&&this.geometry.groups.length===0&&this.geometry.addGroup(0,Math.max(((e=this.geometry.getIndex())==null?void 0:e.count)??0,this.geometry.getAttribute("position").count),0)}updateEntityBoxSize(e,t){let i=this.geometry.userData.parameters;this.is2DType?e.set(0,0,i.depth*.5):this.isNonParametric?(e.setScalar(0),this.geometry.boundingSphere&&e.copy(this.geometry.boundingSphere.center),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)):i.centerOffset?e.fromArray(i.centerOffset):e.setScalar(0),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"&&this.bindMatrixInverse.copy(this.bindMatrix).invert()}bind(e,t){this.skeleton=e,this.isSkinnedMesh=!0,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(e){let t=new Di,i=this.geometry.attributes.skinWeight;for(let n=0,r=i.count;n<r;n++){t.fromBufferAttribute(i,n);let s=1/t.manhattanLength();s!==1/0?t.multiplyScalar(s):t.set(1,0,0,0),i.setXYZW(n,t.x,t.y,t.z,t.w)}}boneTransform(e,t){let i=this.skeleton;if(i===void 0)return;let n=this.geometry;p7.fromBufferAttribute(n.attributes.skinIndex,e),m7.fromBufferAttribute(n.attributes.skinWeight,e),f7.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let r=0;r<4;r++){let s=m7.getComponent(r);if(s!==0){let a=p7.getComponent(r);g7.multiplyMatrices(i.bones[a].matrixWorld,i.boneInverses[a]),t.addScaledVector(vFe.copy(f7).applyMatrix4(g7),s)}}return t.applyMatrix4(this.bindMatrixInverse)}};function yFe(e){var a,o;if(e.geometry.attributes.extrudeNormal||!e.geometry.attributes.position||!e.geometry.attributes.normal)return;let t=new Map,i=e.geometry.attributes,n=i.position.array,r=i.normal.array,s=new Float32Array(n.length);for(let l=0;l<n.length;l+=3){let c=`${n[l]}_${n[l+1]}_${n[l+2]}`,u=new G(r[l],r[l+1],r[l+2]);t.has(c)?(a=t.get(c))==null||a.normals.push(u):t.set(c,{normals:[u],result:new G})}t.forEach((l,c)=>{for(let u of l.normals)l.result.add(u);l.result.divideScalar(l.normals.length)});for(let l=0;l<n.length;l+=3){let c=`${n[l]}_${n[l+1]}_${n[l+2]}`,u=(o=t.get(c))==null?void 0:o.result;u&&(s[l]=u.x,s[l+1]=u.y,s[l+2]=u.z)}e.geometry.setAttribute("extrudeNormal",new Gt(s,3))}function xFe(e){if(e.geometry.attributes.extrudeNormals||!e.geometry.attributes.position)return;let t=e.geometry.attributes.position.array,i=new Float32Array(t.length),n=new G;for(let r=0;r<t.length;r+=3)n.set(t[r],t[r+1],t[r+2]).normalize(),i[r]=n.x,i[r+1]=n.y,i[r+2]=n.z;e.geometry.setAttribute("extrudeNormal",new Gt(i,3))}function U5(e){if(Array.isArray(e.material)){for(let t of e.material)if(t.getLayersOfType("outline").length===0)return}else if(!(e.material instanceof sg)||e.material.getLayersOfType("outline").length===0)return;e instanceof Ds&&e.is2DAndNoDepth?xFe(e):yFe(e)}function N5(e){if(!e.geometry.attributes.position)return;let t=e.geometry.attributes.position.array,i=new Float32Array(t.length),n=parseInt(e.uuid.replace(/\D/g,"")),r=[qt.seededRandom(n),qt.seededRandom(n+1e4),qt.seededRandom(n+2e4)];for(let s=0;s<t.length;s++)i[s]=r[s%3];e.geometry.setAttribute("randomColor",new vi(i,3))}var qh=new ps,k_=new G;function bFe(e){let t=!1;return e.scene.objects.traverse((i,n)=>{n.type==="Mesh"&&n.geometry.type==="SubdivGeometry"&&(t=!0)}),t}var Iw=class extends Ds{constructor(e,t,i){super(e,t,i),this.data=t,this.hiddenMatrixOld=new Bt,this.smoothShading=!0,this.skipReactionUpdate=!1}chooseGeoemtryCache(e){return this.dataPatched.flatShading?e.geometryCache:e.geometryCache2}get subdivPointerNew(){return this.localGeometry!==void 0?this.subdivPointer:this.geometry.ensureSubdivPointer()}get originalGeometryNew(){return this.localGeometry!==void 0?this.originalGeometry:this.geometry.originalGeometry}get phongAngle(){return this.data.geometry.phongAngle??45}updateEntityBoxSize(e,t){let i=this.geometry.userData.parameters;e.copy(this.originalGeometryNew.boundingSphere.center),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)}createGeometryByControls(e){var s,a,o;if(this.skipReactionUpdate===!0)return;let t=(s=this.localGeometry)==null?void 0:s.uuid,{originalGeometry:i,subdividedGeometry:n,subdivPointer:r}=qo.build(e,this.subdivPointer,this.smoothShading,this.hasNonUniformScale?this.shearScale:void 0);this.subdivPointer=r,i!==void 0&&((a=this.originalGeometry)==null||a.dispose(),this.originalGeometry=i),n!==void 0&&((o=this.subdividedGeometry)==null||o.dispose(),this.subdividedGeometry=n??void 0),this.localGeometry=this.subdividedGeometry??this.originalGeometry,U5(this),N5(this),this.calcBoundingBox(),t&&(this.localGeometry.uuid=t)}updateState(e,t){if(super.updateState(e,t),e.flatShading!==void 0){let i=this.material;this.material=Array.isArray(i)?i.map(n=>n.getFlavor(!1,n.side,n.wireframe)):i.getFlavor(!1,i.side,i.wireframe),this.smoothShading=!e.flatShading,this.createGeometryDelayed(t)}}updateMesh(e=!1){qo.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1,this.originalGeometry,e&&this.hasNonUniformScale?this.shearScaleInv:void 0),this.subdividedGeometry&&qo.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1,this.subdividedGeometry,e&&this.hasNonUniformScale?this.shearScaleInv:void 0)}updateTopology(){this.originalGeometry.dispose(),this.originalGeometry=qo.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1),this.subdividedGeometry&&(this.subdividedGeometry.dispose(),this.subdividedGeometry=qo.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1)),this.localGeometry=this.subdividedGeometry??this.originalGeometry}raycast(e,t){let i=this.localGeometry;this.localGeometry=this.originalGeometryNew,nl.prototype.raycast.call(this,e,t),this.localGeometry=i}activateSVDCompensation(){!this.hasNonUniformScale||(this.matrix.copy(this.matrixWorldRigid),this.hiddenMatrixOld.copy(this.hiddenMatrix),this.hiddenMatrix.copy(this.parent.matrixWorld).invert())}deactivateSVDCompensation(){!this.hasNonUniformScale||(this.updateMatrix(),this.hasNonUniformScale=void 0,this.hiddenMatrix.copy(this.hiddenMatrixOld))}calcBoundingBox(){let e=this.originalGeometry;e.boundingSphere===null&&(e.boundingSphere=new Ol,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=e.boundingSphere));let t=e.attributes.position,i=e.boundingSphere.center;qh.setFromBufferAttribute(t),qh.getCenter(i),e.boundingSphere.radius=i.distanceTo(qh.max),isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),qh.getSize(k_),this.hasNonUniformScale&&k_.divide(this.scale);let n={width:k_.x,height:k_.y,depth:k_.z};return this.geometry.userData.parameters=n,n}updateBoundingSphere(e){let t=this.originalGeometry;qh.min.set(e[0],e[2],e[4]),qh.max.set(e[1],e[3],e[5]),this.hasNonUniformScale&&(qh.min.applyMatrix4(this.shearScaleInv),qh.max.applyMatrix4(this.shearScaleInv)),t.boundingSphere===null&&(t.boundingSphere=new Ol);let i=t.boundingSphere.center;qh.getCenter(i),t.boundingSphere.radius=i.distanceTo(qh.max)}freeSubdivPointer(){var e,t;this.subdivPointer&&(qo.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0),this.localGeometry=void 0,(e=this.originalGeometry)==null||e.dispose(),(t=this.subdividedGeometry)==null||t.dispose()}dispose(){super.dispose(),this.freeSubdivPointer()}updateByPatchedOpGeometry(e,t,i){super.updateByPatchedOpGeometry(e,t,i),this.localGeometry&&this.createGeometryByControls(t)}},v7=-1,SFe=1,_Fe={x:[1,0,0],"-x":[-1,0,0],y:[0,1,0],"-y":[0,-1,0],z:[0,0,1],"-z":[0,0,-1]},AFe={polygon_center:0,edge:1,vertex:2},tC=(e,t)=>(i,n)=>!t||i===0||e===0?0:e*n/100,Hi=(e,t)=>{let i=Math.abs(t),n=i*-1;return(e-v7)*(i-n)/(SFe-v7)+n},wFe=new G,iC=new G,MFe=new G,EFe=new G;function I1(e,t){let i=MFe.fromArray(e),n=EFe.fromArray(t);iC.copy(n).sub(i);let r=iC.length();return iC.normalize().multiplyScalar(r*.5),wFe.copy(i).add(iC).toArray()}var Fc=new ka,nC=new G,j3=new G,Yv=new G;function TFe(e){let t=[];for(let i=0;i<=e.index.count;i++)if(nC.fromArray(e.index.array,i*3),Fc.setFromAttributeAndIndices(e.attributes.position,nC.x,nC.y,nC.z),Fc.getNormal(j3),Fc.getMidpoint(Yv),!(isNaN(Yv.x)||isNaN(Yv.y)||isNaN(Yv.z))){let{a:n,b:r,c:s}=Fc,a=n.toArray(),o=r.toArray(),l=s.toArray(),c=n.distanceTo(r),u=r.distanceTo(s),h=s.distanceTo(n),d=I1(a,o),p=I1(o,l),g=I1(l,a),x=[c,u,h],y=Math.max(...x),b=x.filter(E=>Math.round(E)===Math.round(y)).length>1,A=[],w=Fc.getMidpoint(Yv).toArray();y===c&&!b&&(A=[p,g,g],w=d),y===u&&!b&&(A=[d,g,g],w=p),y===h&&!b&&(A=[d,p,p],w=g),b&&(A=[d,p,g]),t.push({vertices:[a,o,l],faceCenters:A,midpoint:w,norm:Fc.getNormal(j3).toArray()})}return t}function CFe(e){let t=[],{position:i}=e.attributes;for(let n=0;n<i.count;n++){Fc.setFromAttributeAndIndices(i,n*3,n*3+1,n*3+2),Fc.getNormal(j3),Fc.getMidpoint(Yv);let r=Fc.a.toArray(),s=Fc.b.toArray(),a=Fc.c.toArray();t.push({vertices:[r,s,a],faceCenters:[I1(r,s),I1(s,a),I1(a,r)],midpoint:Yv.toArray(),norm:j3.toArray()})}return t}var DFe=4,RFe=.5,$I=e=>.5*(1-Math.cos(e*Math.PI)),PFe=class{constructor(){this.perlin=new Array(4096)}noise(e,t=0,i=0){if(this.perlin==null){this.perlin=new Array(4096);for(let y=0;y<4096;y++)this.perlin[y]=Math.random()}e<0&&(e=-e),t<0&&(t=-t),i<0&&(i=-i);let n=Math.floor(e),r=Math.floor(t),s=Math.floor(i),a=e-n,o=t-r,l=i-s,c,u,h=0,d=.5,p,g,x;for(let y=0;y<DFe;y++){let b=n+(r<<4)+(s<<8);c=$I(a),u=$I(o),p=this.perlin[b&4095],p+=c*(this.perlin[b+1&4095]-p),g=this.perlin[b+16&4095],g+=c*(this.perlin[b+16+1&4095]-g),p+=u*(g-p),b+=256,g=this.perlin[b&4095],g+=c*(this.perlin[b+1&4095]-g),x=this.perlin[b+16&4095],x+=c*(this.perlin[b+16+1&4095]-x),g+=u*(x-g),p+=$I(l)*(g-p),h+=p*d,d*=RFe,n<<=1,a*=2,r<<=1,o*=2,s<<=1,l*=2,a>=1&&(n++,a--),o>=1&&(r++,o--),l>=1&&(s++,l--)}return h}noiseSeed(e){let t=(()=>{let i,n;return{setSeed(r){n=i=(r??Math.random()*4294967296)>>>0},getSeed(){return i},rand(){return n=(1664525*n+1013904223)%4294967296,n/4294967296}}})();t.setSeed(e),this.perlin=new Array(4096);for(let i=0;i<4096;i++)this.perlin[i]=t.rand()}},OFe=PFe,y7=new G,x7=new Bt,b7=new Cb;function S7(e){let t=!1;return e.scene.objects.traverse((i,n)=>{n.type==="Mesh"&&(n.geometry.type==="TextGeometry"||n.geometry.type==="InputGeometry")&&(t=!0)}),t}var z5=class extends Ds{constructor(e,t,i){super(e,t,i),this.data=t}get textGeometry(){return this.geometry}get charWidths(){return this.textGeometry.charWidths}get charCoords(){return this.textGeometry.charCoords}get wrappedText(){return this.textGeometry.wrappedText}get font(){return this.textGeometry.font}get initialOffsetY(){var t;let e=this.dataPatched;return((t=this.font)==null?void 0:t.getLineInitialOffsetY(this.lineHeight,this.wrappedText.length,e.geometry.height,this.fontScale,e.geometry.verticalAlign))??0}get fontScale(){let e=this.dataPatched;return this.font?e.geometry.fontSize/this.font.unitsPerEm:1}get AD(){return Math.abs(this.ascender-this.descender)}get ascender(){var e;return(((e=this.font)==null?void 0:e.ascender)??1)*this.fontScale}get descender(){var e;return(((e=this.font)==null?void 0:e.descender)??1)*this.fontScale}get lineHeight(){let e=this.dataPatched;return e.geometry.fontSize*e.geometry.lineHeight}raycast(e,t){let{matrixWorld:i}=this;if(!(isNaN(e.ray.origin.x)||this.scale.x===0||this.scale.y===0||this.scale.z===0)&&(x7.copy(i).invert(),b7.copy(e.ray).applyMatrix4(x7),b7.intersectBox(this.singleBBox,y7))){let n=y7.applyMatrix4(i),r=e.ray.origin.distanceTo(n);t.push({distance:r,point:n.clone(),object:this})}}},Go=1e-4,Yh,mte,gte,vte,_7=new G,A7=new G;Eee.then(e=>{Yh=e,mte=[Yh.get_face_center,Yh.get_edge_midpoint,Yh.get_vertex_position],gte=[Yh.get_face_normal,Yh.get_edge_normal,Yh.get_vertex_normal],vte=[Yh.face_count,Yh.edge_count,Yh.vertex_count]});var BFe=new Bt,IFe=new Bt,vm=new G,rC=new G,j_=new G,eL=new G,LFe=new G,UFe=new G,NFe=class{constructor(e,t){this.data=e,this.is3D=t,this.perlin=new OFe,e.noiseType==="perlin"?(this.perlin.noiseSeed(e.seed),t?this.noise=(i,n,r)=>this.perlin.noise(i,n,r):this.noise=i=>this.perlin.noise(i)):t?this.noise=hLe((0,KN.default)(e.seed)):this.noise=uLe((0,KN.default)(e.seed))}},Wc=class extends x5(kn){constructor(e,t){super(),this.parameters=t,this.objectForSample=void 0,this._pendingMediaLoad=!1,this.random=null,this.object=e}resetOnMove(){this.removeFromParent(),this.parent=null}expandClones(e){if(this.parent===null)this.updateState(this.parameters,e);else for(let t of this.children)t instanceof qa&&t.expand()}invalidateTransform(e){this.matrixWorldNeedsUpdate=!0,this.traverse(t=>{t instanceof qa&&t.object===e&&(t.matrixWorldNeedsUpdate=!0)})}onObjUpdateMatrix(){this.parameters.type!=="toObject"&&(this.matrixWorldNeedsUpdate=!0)}update(){switch(this._updateCount(),this.parameters.type){case"radial":this._updateRadial(this.parameters);break;case"linear":this._updateLinear(this.parameters);break;case"grid":this._updateGrid(this.parameters);break;case"toObject":this._updateToObject(this.parameters)}for(let e of this.children)e.updateMatrix(),e.hasNonUniformScale&&(e.updateMatrixWorld(),e.updateMatrixWorldSVD())}_updateCount(e){let t;if(e!==void 0?t=e:t=this.parameters.type==="grid"?Math.round(this.parameters.grid.count[0])*Math.round(this.parameters.grid.count[1])*Math.round(this.parameters.grid.count[2]):this.parameters.count,this.parameters.type==="toObject"){if(!this.parameters.toObject.object)t=0;else if(e===void 0&&this.parameters.toObject.spreadType!=="random")return}if(this.parameters.type==="toObject"&&this.objectForSample){let i=this.children;if(i.length===t)return;if(i.length<t)for(let n=0,r=t-i.length;n<r;++n){let s=new qa(this.object);s.expand(),this.add(s)}else for(let n=0,r=i.length-t;n<r;++n)this.remove(i[n])}else{if(this.children.length===t)return;if(this.children.length<t)for(let i=0,n=t-this.children.length;i<n;++i){let r=new qa(this.object);r.expand(),this.add(r)}else for(let i=0,n=this.children.length-t;i<n;++i)this.remove(this.children[i])}}getRandom(e,t=!1){return(this.random===null||this.random.data.seed!==e.seed||this.random.is3D!==t)&&(this.random=new NFe(e,t)),this.random}_updateRadial(e){let t=e.radial,i=t.start*qt.DEG2RAD,n=t.end*qt.DEG2RAD,r=i-n,s=new qs(t.rotation[0],t.rotation[1],t.rotation[2]),a;switch(t.axis){case"z":a=new G(0,0,1);break;case"y":a=new G(0,1,0);break;default:case"x":a=new G(1,0,0);break}let o=e.randomnessObject??zm.defaultData([1,1,1]).randomnessObject,l=this.getRandom(o),c=tC(o.strength,this.parameters.randomness);for(let[u,h]of this.children.entries()){let d=u*(o.freqScale/10)+o.movement,p=l.noise(d,d,d),g=u+1;h.scale.x=t.scale[0]+c(g,Hi(p,o.scale[0]))||Go,h.scale.y=t.scale[1]+c(g,Hi(p,o.scale[1]))||Go,h.scale.z=t.scale[2]+c(g,Hi(p,o.scale[2]))||Go,h.position.setScalar(0);let x=r/e.count*u-i;switch(t.axis){case"x":h.rotation.set(0,x,0);break;case"y":h.rotation.set(0,0,x);break;case"z":h.rotation.set(x,0,0);break}h.translateOnAxis(a,t.radius),h.position.x+=t.position[0]+c(g,Hi(p,o.position[0])),h.position.y+=t.position[1]+c(g,Hi(p,o.position[1])),h.position.z+=t.position[2]+c(g,Hi(p,o.position[2]));let y=c(g,Hi(p,o.rotation[0])),b=c(g,Hi(p,o.rotation[1])),A=c(g,Hi(p,o.rotation[2]));t.alignment===!0?(h.rotation.x+=s.x+y,h.rotation.y+=s.y+b,h.rotation.z+=s.z+A):h.rotation.set(s.x+y,s.y+b,s.z+A)}}_updateLinear(e){if(e.type!=="linear")throw new Error;let t=e.linear,i=new qs(t.rotation[0],t.rotation[1],t.rotation[2]),n=e.randomnessObject??zm.defaultData([1,1,1]).randomnessObject,r=this.getRandom(n),s=tC(n.strength,this.parameters.randomness);for(let[a,o]of this.children.entries()){let l=a*(n.freqScale/10)+n.movement,c=r.noise(l,l,l),u=a+1,h=s(u,Hi(c,n.rotation[0])),d=s(u,Hi(c,n.rotation[1])),p=s(u,Hi(c,n.rotation[2]));o.scale.x=1+(t.scale[0]-1)*a+s(u,Hi(c,n.scale[0]))||Go,o.scale.y=1+(t.scale[1]-1)*a+s(u,Hi(c,n.scale[1]))||Go,o.scale.z=1+(t.scale[2]-1)*a+s(u,Hi(c,n.scale[2]))||Go,o.rotation.x=i.x*a+h,o.rotation.y=i.y*a+d,o.rotation.z=i.z*a+p,o.position.x=t.position[0]*a+s(u,Hi(c,n.position[0])),o.position.y=t.position[1]*a+s(u,Hi(c,n.position[1])),o.position.z=t.position[2]*a+s(u,Hi(c,n.position[2]))}}_updateGrid(e){let t=0,i=e.grid,n=e.randomnessObject??zm.defaultData([1,1,1]).randomnessObject,r=this.getRandom(n,!0),s=tC(n.strength,this.parameters.randomness);if(i.useCenter===!0){let a={x:i.count[0]%2===0?2:1,y:i.count[1]%2===0?2:1,z:i.count[2]%2===0?2:1},o=new G(i.size[0]*(i.count[0]-a.x)*.5,i.size[1]*(i.count[1]-a.y)*.5,i.size[2]*(i.count[2]-a.z)*.5);for(let l=0;l<i.count[0];l++)for(let c=0;c<i.count[1];c++)for(let u=0;u<i.count[2];u++){let h=r.noise((l+1)*(n.freqScale/10)+n.movement,(c+1)*(n.freqScale/10)+n.movement,(u+1)*(n.freqScale/10)+n.movement),d=this.children[t++];d.scale.x=1+s(t,Hi(h,n.scale[0]))||Go,d.scale.y=1+s(t,Hi(h,n.scale[1]))||Go,d.scale.z=1+s(t,Hi(h,n.scale[2]))||Go;let p=s(t,Hi(h,n.rotation[0])),g=s(t,Hi(h,n.rotation[1])),x=s(t,Hi(h,n.rotation[2]));d.rotation.set(p,g,x),d.position.x=i.size[0]*l-o.x+s(t,Hi(h,n.position[0])),d.position.y=i.size[1]*c-o.y+s(t,Hi(h,n.position[1])),d.position.z=i.size[2]*u-o.z+s(t,Hi(h,n.position[2]))}}else for(let a=0;a<i.count[0];a++)for(let o=0;o<i.count[1];o++)for(let l=0;l<i.count[2];l++){let c=r.noise((a+1)*(n.freqScale/10)+n.movement,(o+1)*(n.freqScale/10)+n.movement,(l+1)*(n.freqScale/10)+n.movement),u=this.children[t++];u.scale.x=1+s(t,Hi(c,n.scale[0]))||Go,u.scale.y=1+s(t,Hi(c,n.scale[1]))||Go,u.scale.z=1+s(t,Hi(c,n.scale[2]))||Go;let h=s(t,Hi(c,n.rotation[0])),d=s(t,Hi(c,n.rotation[1])),p=s(t,Hi(c,n.rotation[2]));u.rotation.set(h,d,p),u.position.x=i.size[0]*a+s(t,Hi(c,n.position[0])),u.position.y=-i.size[1]*o+s(t,Hi(c,n.position[1])),u.position.z=-i.size[2]*l+s(t,Hi(c,n.position[2]))}}_updateToObject(e){var u;if(e.type!=="toObject")throw new Error;let{toObject:t}=e,i=new qs(t.rotation[0],t.rotation[1],t.rotation[2]),n=e.randomnessObject??zm.defaultData([1,1,1]).randomnessObject,r=this.getRandom(n),s=tC(n.strength,this.parameters.randomness);if(!t.object){for(let[,h]of this.children.entries())h.position.set(0,0,0),h.scale.setScalar(1),h.rotation.set(0,0,0);this.objectForSample=void 0;return}if(!this.objectForSample)return;if(this.objectForSample instanceof z5)if(!((u=this.objectForSample.font)!=null&&u.isLoaded)||this.objectForSample.geometry.attributes.position===void 0){this._pendingMediaLoad=!0;return}else this._pendingMediaLoad=!1;if(this.objectForSample.geometry===void 0&&this.objectForSample.isAncestorOf(this.object.uuid)){console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) seem to be a child/descendant of the object it's being cloned to. Please re-parent it so that they are siblings instead.`);return}let a=this.getSubdivData();if(a.length>0){let h=Math.round(a.length*t.count/100);this._updateCount(h)}else{let h=this.objectForSample.geometry.getAttribute("position");if(!h||isNaN(h.count)||h.count===0){console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) cannot be cloned on the surface of "${this.objectForSample.name}" (${this.objectForSample.uuid}) because the latter does not have a valid geometry.`);return}}this.objectForSample.updateMatrixWorld();let o=new dLe(this.objectForSample).build(),l=_Fe[t.axis],c=this.children;o.setRandomGenerator((0,KN.default)(this.object.uuid+t.seed));for(let[h,d]of c.entries()){let p=h*(n.freqScale/10)+n.movement,g=r.noise(p,p,p),x=h+1,y=s(x,Hi(g,n.rotation[0])),b=s(x,Hi(g,n.rotation[1])),A=s(x,Hi(g,n.rotation[2]));t.spreadType==="random"?o.sample(j_,eL):(a.length&&(j_.fromArray(a[h].pos),eL.fromArray(a[h].norm)),this.objectForSample instanceof Iw&&j_.applyMatrix4(BFe.copy(this.objectForSample.matrixWorld).invert())),j_.applyMatrix4(this.object.hiddenMatrix.clone().invert()),d.position.copy(j_),vm.fromArray(l);let w=t.align==="normal"?eL:this.object.getWorldDirection(UFe),E=rC.fromArray(t.position);rC.x+=s(x,Hi(g,n.position[0])),rC.y+=s(x,Hi(g,n.position[1])),rC.z+=s(x,Hi(g,n.position[2]));let D=Math.acos(w.dot(vm)),T=LFe.crossVectors(vm,w).normalize(),I=IFe.makeRotationAxis(T,D),R=w.clone().cross(this.object.up).normalize(),O=R.clone().cross(w).normalize(),P=new Bt().makeBasis(R,w,O),U=new G(vm.y,vm.z,vm.x).normalize(),H=U.clone().cross(vm).normalize(),V=new Bt().makeBasis(U,vm,H).invert(),j=new Bt().multiplyMatrices(P,V);d.rotation.setFromRotationMatrix(j),E.applyMatrix4(I),d.position.add(E),d.rotation.x=d.rotation.x+i.x+y,d.rotation.y=d.rotation.y+i.y+b,d.rotation.z=d.rotation.z+i.z+A,d.scale.setScalar(1),d.scale.x=d.scale.x+t.scale[0]+s(x,Hi(g,n.scale[0]))||Go,d.scale.y=d.scale.y+t.scale[1]+s(x,Hi(g,n.scale[1]))||Go,d.scale.z=d.scale.z+t.scale[2]+s(x,Hi(g,n.scale[2]))||Go,d.scale.multiply(this.object.scale),d.hiddenMatrix=this.object.hiddenMatrix}}getSubdivData(){if(!this.objectForSample)return[];let e=this.parameters.toObject.spreadType,t=new Map,i=(r,s)=>{let a=Math.round(r[0]*1e4)+"_"+Math.round(r[1]*1e4)+"_"+Math.round(r[2]*1e4),o=t.get(a);o?(o.pos[0]+=r[0],o.pos[1]+=r[1],o.pos[2]+=r[2],o.norm[0]+=s[0],o.norm[1]+=s[1],o.norm[2]+=s[2],o.count+=1):t.set(a,{pos:[...r],norm:[...s],count:1})};if(e==="random")return[];if(this.objectForSample instanceof Iw){let r=this.objectForSample,s=AFe[e],a=vte[s],o=mte[s],l=gte[s],c=a(r.subdivPointerNew);for(let u=0;u<=c-1;u++){let h=o(r.subdivPointerNew,u),d=l(r.subdivPointerNew,u);_7.fromArray(h).applyMatrix4(r.matrixWorld),A7.fromArray(d),i(_7.toArray(),A7.toArray())}}else(this.objectForSample.geometry.index?TFe(this.objectForSample.geometry):CFe(this.objectForSample.geometry)).forEach((r,s)=>{e==="polygon_center"&&i(r.midpoint,r.norm),e==="vertex"&&(i(r.vertices[0],r.norm),i(r.vertices[1],r.norm),i(r.vertices[2],r.norm)),e==="edge"&&(i(r.faceCenters[0],r.norm),i(r.faceCenters[1],r.norm),i(r.faceCenters[2],r.norm))});let n=Array.from(t.values());for(let r of n)r.pos[0]/=r.count,r.pos[1]/=r.count,r.pos[2]/=r.count,r.norm[0]/=r.count,r.norm[1]/=r.count,r.norm[2]/=r.count;return n}updateState(e,t){var i;if(this.parameters=$R(e),this.parameters.type!=="toObject")(this.parent===null||this.parent!==this.object)&&(this.removeFromParent(),(i=this.object.parent)==null||i.add(this),this.matrix=this.object.matrix,this.hiddenMatrix=this.object.hiddenMatrix,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1);else if(this.parent===null||this.parent.uuid!==this.parameters.toObject.object){this.removeFromParent();let n=t.find(this.parameters.toObject.object);n instanceof nl?this.objectForSample=n:this.objectForSample=void 0,this.matrix=new Bt,this.hiddenMatrix=new Bt,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1,n&&n.add(this)}this.update()}get pendingMediaLoad(){return this._pendingMediaLoad}},mM=e=>{var t;return t=class extends e{},t.geometryHelper=new eh(30,30,30),t},sC=new Cb,tL=new Ol,w7=new Bt,gM=(e,t,i,n,r=!1,s=e)=>{let a=t,o=s.matrixWorld;if(a.boundingSphere===null&&a.computeBoundingSphere(),tL.copy(a.boundingSphere),tL.applyMatrix4(o),i.ray.intersectsSphere(tL)===!1||(w7.copy(o).invert(),sC.copy(i.ray).applyMatrix4(w7),a.boundingBox!==null&&sC.intersectsBox(a.boundingBox)===!1))return;let l,c,u,h,d=a.index,p=a.attributes.position,g=a.drawRange,x,y;if(r===!1){let A=Math.max(0,g.start),w=Math.min(d.count,g.start+g.count);for(x=A,y=w;x<y;x+=3)if(c=d.getX(x),u=d.getX(x+1),h=d.getX(x+2),l=b(e,i,sC,p,c,u,h),l){l.faceIndex=Math.floor(x/3),n.push(l);return}}else{let A=a.attributes.position,w=new G,E=new G,D=new G,T=new G,I=2,R=1/((s.scale.x+s.scale.y+s.scale.z)/3),O=R*R,P=Math.max(0,g.start),U=Math.min(A.count,g.start+g.count);for(let H=P,V=U-1;H<V;H+=I){if(w.fromBufferAttribute(A,H),E.fromBufferAttribute(A,H+1),sC.distanceSqToSegment(w,E,T,D)>O)continue;T.applyMatrix4(s.matrixWorld);let j=i.ray.origin.distanceTo(T);j<i.near||j>i.far||n.push({distance:j,point:D.clone().applyMatrix4(s.matrixWorld),object:e})}}function b(A,w,E,D,T,I,R){let O=new G,P=new G,U=new G,H=new G,V=new G;if(O.fromBufferAttribute(D,T),P.fromBufferAttribute(D,I),U.fromBufferAttribute(D,R),E.intersectTriangle(O,P,U,!1,H)===null)return null;V.copy(H),V.applyMatrix4(A.matrixWorld);let j=w.ray.origin.distanceTo(V);return j<w.near||j>w.far?null:{faceIndex:1,distance:j,point:V.clone(),object:A}}},aC=new G,Rc=new mg,zFe=class extends aM{constructor(e){let t=new ii,i=new gg({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],r=[],s={},a=new gi(15711266),o=new gi(15711266),l=new gi(2857471);c("n1","n2",a),c("n2","n4",a),c("n4","n3",a),c("n3","n1",a),c("f1","f2",a),c("f2","f4",a),c("f4","f3",a),c("f3","f1",a),c("n1","f1",a),c("n2","f2",a),c("n3","f3",a),c("n4","f4",a),c("p","n1",o),c("p","n2",o),c("p","n3",o),c("p","n4",o),c("u1","u2",l),c("u2","u3",l),c("u3","u1",l);function c(h,d,p){u(h,p),u(d,p)}function u(h,d){n.push(0,0,0),r.push(d.r,d.g,d.b),s[h]===void 0&&(s[h]=[]),s[h].push(n.length/3-1)}t.setAttribute("position",new Gt(n,3)),t.setAttribute("color",new Gt(r,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}update(){let e=this.geometry,t=this.pointMap;Rc.projectionMatrixInverse.elements=[.5112609807824982,-0,-0,-0,-0,.41421356237309503,-0,-0,-0,-0,-0,-.099999,-0,-0,-1.0000000000000002,.100001];let i=1,n=1,r=.8;Bu("n1",t,e,Rc,-1,-1,r),Bu("n2",t,e,Rc,i,-1,r),Bu("n3",t,e,Rc,-1,n,r),Bu("n4",t,e,Rc,i,n,r);let s=r;Bu("f1",t,e,Rc,-1,-1,s),Bu("f2",t,e,Rc,i,-1,s),Bu("f3",t,e,Rc,-1,n,s),Bu("f4",t,e,Rc,i,n,s);let a=s,o=.5;Bu("u1",t,e,Rc,i*.7*o,n*1.1,a),Bu("u2",t,e,Rc,-1*.7*o,n*1.1,a),Bu("u3",t,e,Rc,0,n*(1.1+.9*o),a),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function Bu(e,t,i,n,r,s,a){aC.set(r,s,a).unproject(n);let o=t[e];if(o!==void 0){let l=i.getAttribute("position");for(let c=0,u=o.length;c<u;c++)l.setXYZ(o[c],aC.x,aC.y,aC.z)}}var FFe=class extends mM(zFe){constructor(e){super(e),this.object=e,this.object=e,this.name=`CombinedCameraHelper: ${e.uuid}`}updateMatrixWorld(e){super.updateMatrixWorld(e),this.updateTarget()}updateTarget(){let e=this.object.getTarget();this.updateWorldMatrix(!0,!1),this.worldToLocal(e)}raycast(e,t){gM(this.object,this.geometry,e,t,!0)}},dz;(e=>e.is=t=>"objectHelper"in t)(dz||(dz={}));var kb=(e,t)=>class extends b5(e){constructor(){super(...arguments),this.objectHelper=new t(this),this.gizmos={}}get geometryHelper(){return t.geometryHelper}raycast(i,n){this.objectHelper.raycast(i,n)}showGizmos(){for(let i in this.gizmos){let n=this.gizmos[i];n instanceof l3&&(n.visible=!0)}}updateEntityBoxSize(i,n){this.objectHelper.visible&&this.geometryHelper instanceof eh?(i.setScalar(0),n.set(this.geometryHelper.parameters.width,this.geometryHelper.parameters.height,this.geometryHelper.parameters.height).multiplyScalar(.5)):super.updateEntityBoxSize(i,n)}hideGizmos(){for(let i in this.gizmos){let n=this.gizmos[i];n instanceof l3&&(n.visible=!1)}}},M7=790,jx=new G,iL=new G,nL=new Ei,rL=new G,W_=new G,sL=new G,xo=class extends kb(mg,FFe){constructor(e="",t={...Ew.defaultData,name:""}){super(),this._cameraType="OrthographicCamera",this.targetOffset=ab.DefaultTargetOffset,this.isUpVectorFlipped=!1,this.angleOffsetFromUp=0,this.wasMovedByUser=!1,this.wasMovedBySwitchCameraAction=!1,this.super_Entity(e,t),this.previousProjectionMatrix=new Bt,this.matrixAutoUpdate=!0,this.width=window.innerWidth,this.height=window.innerHeight;let i=this.width,n=this.height;this.orthoCamera=new kR(i*-.5,i*.5,n*.5,n*-.5,-5e4,1e4),this.perspCamera=new po(45,i/n,50,1e4),this.left=this.orthoCamera.left,this.right=this.orthoCamera.right,this.top=this.orthoCamera.top,this.bottom=this.orthoCamera.bottom,this.far=this.orthoCamera.far,this.view=this.orthoCamera.view,this.aspect=this.perspCamera.aspect,this.focus=this.perspCamera.focus,this.filmGauge=this.perspCamera.filmGauge,this.filmOffset=this.perspCamera.filmOffset,this.objectHelper.update()}get isPerspectiveCamera(){return this.cameraType==="PerspectiveCamera"}get isOrthographicCamera(){return!this.isPerspectiveCamera}get cameraType(){return this._cameraType}set fov(e){this.perspCamera.fov=e}get fov(){return this.perspCamera.fov}setNear(e,t){e==="PerspectiveCamera"?this.perspCamera.near=t:this.orthoCamera.near=t}setZoom(e,t){t>=0&&(e==="PerspectiveCamera"?this.perspCamera.zoom=t:this.orthoCamera.zoom=t)}set cameraType(e){e==="PerspectiveCamera"?this.toPerspective():e==="OrthographicCamera"&&this.toOrthographic()}get near(){return this._cameraType==="PerspectiveCamera"?this.perspCamera.near:this.orthoCamera.near}set near(e){this._cameraType==="PerspectiveCamera"?this.perspCamera.near=e:this.orthoCamera.near=e}get zoom(){return this._cameraType==="PerspectiveCamera"?this.perspCamera.zoom:this.orthoCamera.zoom}set zoom(e){e>=0&&(this._cameraType==="PerspectiveCamera"?this.perspCamera.zoom=e:this.orthoCamera.zoom=e)}lookAt(e,t,i){typeof e=="number"&&(e=new G(e,t,i)),super.lookAt(e),this.getWorldPosition(jx),this.targetOffset=jx.distanceTo(e)}getTarget(e=new G){return this.getWorldDirection(iL),this.getWorldPosition(jx),iL.multiplyScalar(this.targetOffset),e.copy(jx).add(iL),e}getDistanceToTarget(){let e=this.getTarget();return this.getWorldPosition(jx),jx.distanceTo(e)}updateUp(){this.getWorldQuaternion(nL),rL.set(0,0,1).applyQuaternion(nL),W_.copy(kn.DEFAULT_UP),this.isUpVectorFlipped&&W_.negate(),W_.applyQuaternion(nL),sL.copy(kn.DEFAULT_UP).projectOnPlane(rL),this.angleOffsetFromUp=sL.angleTo(W_),this.angleOffsetFromUp*=sL.cross(W_).dot(rL)>=0?1:-1}updateTransformState(e,t){let i=super.updateTransformState(e,t);return e.isUpVectorFlipped!==void 0&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateUp(),i}getViewFrontToObject(e){let t=e.getWorldPosition(new G),i=e.getWorldDirection(new G).multiplyScalar(this.targetOffset);return{position:t.clone().add(i),target:t}}getViewToTarget(e){let t=this.getWorldDirection(new G).multiplyScalar(this.targetOffset);return{position:e.clone().sub(t),target:e}}getViewToObject(e){let t=new G;return e.getWorldPosition(t),this.getViewToTarget(t)}setViewplaneSize(e,t,i=!1){if(this.aspect=e/t,i){let n=e>t?this.aspect:1,r=e>t?1:this.aspect;this.left=-790*.5*n,this.right=M7*.5*n,this.top=M7*.5*(1/r),this.bottom=-790*.5*(1/r)}else this.left=-e*.5,this.right=e*.5,this.top=t*.5,this.bottom=-t*.5;this.updateProjectionMatrix()}copyViewPlaneSize(e){this.aspect=e.aspect,this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.updateProjectionMatrix()}toOrthographic(){this.orthoCamera.left=this.left,this.orthoCamera.right=this.right,this.orthoCamera.top=this.top,this.orthoCamera.bottom=this.bottom,this.orthoCamera.view=this.view,this.orthoCamera.far=this.far,this.orthoCamera.updateProjectionMatrix(),this.projectionMatrix=this.orthoCamera.projectionMatrix,this.projectionMatrixInverse=this.orthoCamera.projectionMatrixInverse,this._cameraType="OrthographicCamera",this.objectHelper&&this.objectHelper.update()}toPerspective(){this.perspCamera.aspect=this.aspect,this.perspCamera.fov=this.fov,this.perspCamera.view=this.view,this.perspCamera.far=this.far,this.perspCamera.updateProjectionMatrix(),this.projectionMatrix=this.perspCamera.projectionMatrix,this.projectionMatrixInverse=this.perspCamera.projectionMatrixInverse,this._cameraType="PerspectiveCamera",this.objectHelper&&this.objectHelper.update()}setFocalLength(e){this.perspCamera.setFocalLength(e),this.toPerspective()}getFocalLength(){return this.perspCamera.getFocalLength()}getEffectiveFOV(){return this.perspCamera.getEffectiveFOV()}getFilmWidth(){return this.perspCamera.getFilmWidth()}getFilmHeight(){return this.perspCamera.getFilmHeight()}setViewOffset(e,t,i,n,r,s){this._cameraType==="PerspectiveCamera"?this.perspCamera.setViewOffset(e,t,i,n,r,s):this.orthoCamera.setViewOffset(e,t,i,n,r,s)}clearViewOffset(){this._cameraType==="PerspectiveCamera"?(this.perspCamera.clearViewOffset(),this.toPerspective()):(this.orthoCamera.clearViewOffset(),this.toOrthographic())}copyHistory(){this.previousProjectionMatrix&&this.previousProjectionMatrix.copy(this.projectionMatrix)}updateProjectionMatrix(){this._cameraType==="PerspectiveCamera"?this.toPerspective():this._cameraType==="OrthographicCamera"&&this.toOrthographic()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}copy(e,t){return super.copy(e,t),this.parent=e.parent,this.orthoCamera.copy(e.orthoCamera),this.perspCamera.copy(e.perspCamera),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.far=e.far,this.view=e.view===null?null:Object.assign({},e.view),this._cameraType=e._cameraType,this.aspect=e.aspect,this.fov=e.fov,this.focus=e.focus,this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this.targetOffset=e.targetOffset,this.updateProjectionMatrix(),this}toCameraState(e=[]){let t={type:this.cameraType,far:this.far,orthographic:{near:this.orthoCamera.near,zoom:this.orthoCamera.zoom},perspective:{near:this.perspCamera.near,fov:this.perspCamera.fov,zoom:this.perspCamera.zoom},up:this.up.toArray(),targetOffset:this.targetOffset,isUpVectorFlipped:this.isUpVectorFlipped};return sN(t,e)}updateCameraSubtype(e,t){let i=e==="perspective"?"PerspectiveCamera":"OrthographicCamera";t.zoom!==void 0&&this.setZoom(i,t.zoom),t.near!==void 0&&this.setNear(i,t.near),t.fov!==void 0&&i==="PerspectiveCamera"&&(this.fov=t.fov)}updateState(e,t){this.updateCameraState(e,t)}updateCameraState(e,t){this.updateState_Entity(e,t),e.far!==void 0&&(this.far=e.far),e.orthographic!==void 0&&this.updateCameraSubtype("orthographic",e.orthographic),e.perspective!==void 0&&this.updateCameraSubtype("perspective",e.perspective),e.type!==void 0&&(this.cameraType=e.type),e.up!==void 0&&this.up.fromArray(e.up),e.targetOffset!==void 0&&(this.targetOffset=e.targetOffset),e.isUpVectorFlipped!==void 0&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateProjectionMatrix()}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),e.path.length===1&&e.type===0&&this.updateCameraSubtype(e.path[0],e.props)}toState(e){return{...super.toState(e),...this.toCameraState(e),type:this.cameraType}}},Wx=new Bt,VFe=new Bt;function E7(e){let t=!1;return e.scene.objects.traverse((i,n)=>{var r;((r=n.geometry)==null?void 0:r.type)==="BooleanGeometry"&&(t=!0)}),t}var V0=class extends Gb{constructor(e,t,i){super(e,t),this.data=t,this.meshSetAddresses=[],this.needsTransformForDownstream=!1,this.geometry=new ii,this.onAfterRender=(n,r,s,a,o,l)=>{super.onAfterRender(n,r,s,a,o,l),this.recomputeBoolean()},this.geometry.userData.parameters={width:0,height:0,depth:0}}get booleanOp(){return this.data.geometry.operation}get phongAngle(){return this.data.geometry.phongAngle??45}get isLOD(){return this.recomputeBoolean(),!1}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),e.path.length===1&&e.path[0]==="geometry"&&e.type===0&&e.props.operation!==void 0&&(this.freeBooleanPointer(),this.resetBBoxNeedsUpdate())}freeBooleanPointer(){super.freeBooleanPointer(),this.geometry.dispose()}recomputeBoolean(e,t=!0){var n;if(this.booleanMeshSetAddress!==-1&&!e)return;for(let r=0;r<this.children.length;r++){let s=this.children[r];s instanceof V0&&s.dataPatched.visible===!0&&s.recomputeBoolean(e===!0,t)}this.meshSetAddresses=[];for(let r=0;r<this.children.length;r++){let s=this.children[r];if(s instanceof nl&&s.dataPatched.visible===!0&&((n=s.geometry.attributes.position)==null?void 0:n.count)>0&&s.geometry.drawRange.count>0&&s.booleanMeshSetAddress!==0){Wx.multiplyMatrices(s.hiddenMatrix,s.matrix);try{if(s.booleanMeshSetAddress===-1){if((s.geometry.index??s.geometry.getAttribute("position")).count/3<15e5&&(s.booleanMeshSetAddress=wf.getMeshSet(s.geometry,e===!0,t)),s.booleanMeshSetAddress===-1)return;wf.transformMeshSet(s.booleanMeshSetAddress,Wx),s.booleanMatrixInvOld.copy(Wx).invert(),s.booleanWasTransformed=!1}else s instanceof V0&&s.needsTransformForDownstream===!0?(wf.transformMeshSet(s.booleanMeshSetAddress,Wx),s.needsTransformForDownstream=!1):s.booleanWasTransformed===!0&&(wf.transformMeshSet(s.booleanMeshSetAddress,VFe.multiplyMatrices(Wx,s.booleanMatrixInvOld)),s.booleanMatrixInvOld.copy(Wx).invert(),s.booleanWasTransformed=!1)}catch(a){console.error(a),s.booleanMeshSetAddress=0,s.geometry.userData.booleanOperationDidFail=!0;continue}wf.hasOpenEdges(s.booleanMeshSetAddress)===!1||r===this.children.length-1&&this.booleanOp===2?(this.meshSetAddresses.push(s.booleanMeshSetAddress),s.geometry.userData.booleanOperationDidFail=!1):s.geometry.userData.booleanOperationDidFail="openEdges"}}if(this.meshSetAddresses.length===0){this.geometry.setAttribute("position",new Gt([],0)),this.geometry.setDrawRange(0,0);return}if(e===!0)return wf.calcBooleanTopological(this.meshSetAddresses,this.booleanOp);let i=this.geometry;i.dispose(),this.geometry=new ii,this.geometry.userData=i.userData,this.geometry.boundingSphere=i.boundingSphere;try{this.booleanMeshSetAddress=wf.calcBoolean(this.meshSetAddresses,this.booleanOp,this.geometry,this.phongAngle)}catch(r){this.booleanMeshSetAddress=0,this.geometry.userData.booleanOperationDidFail=!0,console.error(r)}this.booleanMatrixInvOld.copy(this.matrix).invert(),this.needsTransformForDownstream=!0,U5(this),N5(this)}dispose(){super.dispose(),this.geometry.dispose()}},fz;(e=>{function t(i){return dn.is(i)&&i instanceof cM}e.is=t})(fz||(fz={}));var F5=(e,t)=>class extends kb(e,t){updateState_Light(i,n){this.updateState_Entity(i,n),i.color!==void 0&&(this.color=n.shared.color(i.color)),i.intensity!==void 0&&(this.intensity=i.intensity),i.depth!==void 0&&(this.shadow.camera.far=i.depth,this.shadow.needsUpdate=!0),i.shadows!==void 0&&(this.castShadow=i.shadows)}},ku=e=>e instanceof nl,kf=e=>e!==null&&e instanceof V0,HFe=e=>e instanceof xo,GFe=e=>fz.is(e),pz=e=>dz.is(e),kFe=new G(1,1,1),T7=new G,jFe=new G,C7=new Ei,vM=class extends mM(OEe){constructor(e,t=15){super(t),this.object=e,this.dummy=new Hf,this.object.updateMatrixWorld(),this.name=`EmptyObjectHelper: ${e.uuid}`,this.matrix=this.dummy.matrixWorld,this.matrixAutoUpdate=!1,this.object.isBone&&(this.visible=!1)}raycast(e,t){gM(this.object,vM.geometryHelper,e,t,!1,this.dummy)}update(){}updateMatrix(){}updateMatrixWorld(e){this.object.matrixWorld.decompose(T7,C7,jFe),this.matrix.compose(T7,C7,kFe),super.updateMatrixWorld(e)}updateWorldMatrix(e,t){}},L1=class extends kb(Hf,vM){constructor(e,t){super(),this.super_Entity(e,t),this.objectHelper.update()}updateState(e,t){this.updateState_Entity(e,t),"buffer"in e&&Object.keys(e).length===1&&t.scene.reloadSplats()}},VA=class extends kb(Hf,vM){constructor(e,t,i){super(),this.super_Entity(e,t),this.context=i,this.objectHelper.update()}updateState(e,t){this.updateState_Entity(e,t)}},yte={RED:0,GREEN:1},yM="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",WFe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;uniform vec4 kernel64[32];varying vec2 vUv;void main(){
#ifdef FOREGROUND
vec2 CoCNearFar=texture2D(cocBuffer,vUv).rg;float CoC=CoCNearFar.r*scale;
#else
float CoC=texture2D(cocBuffer,vUv).g*scale;
#endif
if(CoC==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{
#ifdef FOREGROUND
vec2 step=texelSize*max(CoC,CoCNearFar.g*scale);
#else
vec2 step=texelSize*CoC;
#endif
vec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;}}`,oC=class extends vn{constructor(e=!1,t=!1){super({name:"BokehMaterial",defines:{PASS:e?"2":"1"},uniforms:{kernel64:new Ct(null),kernel16:new Ct(null),inputBuffer:new Ct(null),cocBuffer:new Ct(null),texelSize:new Ct(new Ae),scale:new Ct(1)},blending:Rs,depthWrite:!1,depthTest:!1,fragmentShader:WFe,vertexShader:yM}),this.toneMapped=!1,t&&(this.defines.FOREGROUND="1"),this.generateKernel()}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}set cocBuffer(e){this.uniforms.cocBuffer.value=e}setCoCBuffer(e){this.uniforms.cocBuffer.value=e}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(e){return this.uniforms.scale.value=e}setScale(e){this.uniforms.scale.value=e}generateKernel(){let e=2.39996323,t=new Float32Array(128),i=new Float32Array(32),n=0,r=0;for(let o=0;o<80;++o){let l=o*e,c=Math.sqrt(o)/Math.sqrt(80),u=c*Math.cos(l),h=c*Math.sin(l);o%5===0?(i[r++]=u,i[r++]=h):(t[n++]=u,t[n++]=h)}let s=[],a=[];for(let o=0;o<128;)s.push(new Di(t[o++],t[o++],t[o++],t[o++]));for(let o=0;o<32;)a.push(new Di(i[o++],i[o++],i[o++],i[o++]));this.uniforms.kernel64.value=s,this.uniforms.kernel16.value=a}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t)}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}};function D7(e,t,i){return e*(t-i)-t}function mz(e,t,i){return Math.min(Math.max((e+t)/(t-i),0),1)}var XFe=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform float focusDistance;uniform float focusRange;uniform float cameraNear;uniform float cameraFar;varying vec2 vUv;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}void main(){float depth=readDepth(vUv);
#ifdef PERSPECTIVE_CAMERA
float viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);
#else
float linearDepth=depth;
#endif
float signedDistance=linearDepth-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}`,qFe=class extends vn{constructor(e){super({name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new Ct(null),focusDistance:new Ct(0),focusRange:new Ct(0),cameraNear:new Ct(.3),cameraFar:new Ct(1e3)},blending:Rs,depthWrite:!1,depthTest:!1,fragmentShader:XFe,vertexShader:yM}),this.toneMapped=!1,this.uniforms.focalLength=this.uniforms.focusRange,this.adoptCameraSettings(e)}get near(){return this.uniforms.cameraNear.value}get far(){return this.uniforms.cameraFar.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=cp){this.depthBuffer=e,this.depthPacking=t}get focusDistance(){return this.uniforms.focusDistance.value}set focusDistance(e){this.uniforms.focusDistance.value=e}get worldFocusDistance(){return-D7(this.focusDistance,this.near,this.far)}set worldFocusDistance(e){this.focusDistance=mz(-e,this.near,this.far)}getFocusDistance(e){this.uniforms.focusDistance.value=e}setFocusDistance(e){this.uniforms.focusDistance.value=e}get focalLength(){return this.focusRange}set focalLength(e){this.focusRange=e}get focusRange(){return this.uniforms.focusRange.value}set focusRange(e){this.uniforms.focusRange.value=e}get worldFocusRange(){return-D7(this.focusRange,this.near,this.far)}set worldFocusRange(e){this.focusRange=mz(-e,this.near,this.far)}getFocalLength(e){return this.focusRange}setFocalLength(e){this.focusRange=e}adoptCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof po?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},YFe=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <encodings_fragment>
#include <dithering_fragment>
}`,QFe="uniform vec2 texelSize;uniform vec2 halfTexelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize*vec2(kernel)+halfTexelSize)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",R7=class extends vn{constructor(e=new Ae){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new Ct(null),texelSize:new Ct(new Ae),halfTexelSize:new Ct(new Ae),kernel:new Ct(0),scale:new Ct(1)},blending:Rs,depthWrite:!1,depthTest:!1,fragmentShader:YFe,vertexShader:QFe}),this.toneMapped=!1,this.setTexelSize(e.x,e.y)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.inputBuffer=e}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(){return this.uniforms.scale.value}setScale(e){this.uniforms.scale.value=e}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(e){this.uniforms.kernel.value=e}setKernel(e){this.kernel=e}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t),this.uniforms.halfTexelSize.value.set(e,t).multiplyScalar(.5)}setSize(e,t){let i=this.uniforms;i.texelSize.value.set(1/e,1/t),i.halfTexelSize.value.copy(i.texelSize.value).multiplyScalar(.5)}},KFe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <encodings_fragment>
}`,JFe=class extends vn{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new Ct(null),opacity:new Ct(1)},blending:Rs,depthWrite:!1,depthTest:!1,fragmentShader:KFe,vertexShader:yM}),this.toneMapped=!1}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}getOpacity(e){return this.uniforms.opacity.value}setOpacity(e){this.uniforms.opacity.value=e}},ZFe=`varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
#if EDGE_DETECTION_MODE == 1
#include <common>
#endif
#if EDGE_DETECTION_MODE == 0 || PREDICATION_MODE == 1
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}vec3 gatherNeighbors(){float p=readDepth(vUv);float pLeft=readDepth(vUv0);float pTop=readDepth(vUv1);return vec3(p,pLeft,pTop);}
#elif PREDICATION_MODE == 2
uniform sampler2D predicationBuffer;vec3 gatherNeighbors(){float p=texture2D(predicationBuffer,vUv).r;float pLeft=texture2D(predicationBuffer,vUv0).r;float pTop=texture2D(predicationBuffer,vUv1).r;return vec3(p,pLeft,pTop);}
#endif
#if PREDICATION_MODE != 0
vec2 calculatePredicatedThreshold(){vec3 neighbours=gatherNeighbors();vec2 delta=abs(neighbours.xx-neighbours.yz);vec2 edges=step(PREDICATION_THRESHOLD,delta);return PREDICATION_SCALE*EDGE_THRESHOLD*(1.0-PREDICATION_STRENGTH*edges);}
#endif
#if EDGE_DETECTION_MODE != 0
uniform sampler2D inputBuffer;
#endif
void main(){
#if EDGE_DETECTION_MODE == 0
const vec2 threshold=vec2(DEPTH_THRESHOLD);
#elif PREDICATION_MODE != 0
vec2 threshold=calculatePredicatedThreshold();
#else
const vec2 threshold=vec2(EDGE_THRESHOLD);
#endif
#if EDGE_DETECTION_MODE == 0
vec3 neighbors=gatherNeighbors();vec2 delta=abs(neighbors.xx-vec2(neighbors.y,neighbors.z));vec2 edges=step(threshold,delta);if(dot(edges,vec2(1.0))==0.0){discard;}gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 1
float l=luminance(texture2D(inputBuffer,vUv).rgb);float lLeft=luminance(texture2D(inputBuffer,vUv0).rgb);float lTop=luminance(texture2D(inputBuffer,vUv1).rgb);vec4 delta;delta.xy=abs(l-vec2(lLeft,lTop));vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}float lRight=luminance(texture2D(inputBuffer,vUv2).rgb);float lBottom=luminance(texture2D(inputBuffer,vUv3).rgb);delta.zw=abs(l-vec2(lRight,lBottom));vec2 maxDelta=max(delta.xy,delta.zw);float lLeftLeft=luminance(texture2D(inputBuffer,vUv4).rgb);float lTopTop=luminance(texture2D(inputBuffer,vUv5).rgb);delta.zw=abs(vec2(lLeft,lTop)-vec2(lLeftLeft,lTopTop));maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges.xy*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 2
vec4 delta;vec3 c=texture2D(inputBuffer,vUv).rgb;vec3 cLeft=texture2D(inputBuffer,vUv0).rgb;vec3 t=abs(c-cLeft);delta.x=max(max(t.r,t.g),t.b);vec3 cTop=texture2D(inputBuffer,vUv1).rgb;t=abs(c-cTop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}vec3 cRight=texture2D(inputBuffer,vUv2).rgb;t=abs(c-cRight);delta.z=max(max(t.r,t.g),t.b);vec3 cBottom=texture2D(inputBuffer,vUv3).rgb;t=abs(c-cBottom);delta.w=max(max(t.r,t.g),t.b);vec2 maxDelta=max(delta.xy,delta.zw);vec3 cLeftLeft=texture2D(inputBuffer,vUv4).rgb;t=abs(c-cLeftLeft);delta.z=max(max(t.r,t.g),t.b);vec3 cTopTop=texture2D(inputBuffer,vUv5).rgb;t=abs(c-cTopTop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#endif
}`,$Fe=`uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,0.0);vUv1=vUv+texelSize*vec2(0.0,-1.0);
#if EDGE_DETECTION_MODE != 0
vUv2=vUv+texelSize*vec2(1.0,0.0);vUv3=vUv+texelSize*vec2(0.0,1.0);vUv4=vUv+texelSize*vec2(-2.0,0.0);vUv5=vUv+texelSize*vec2(0.0,-2.0);
#endif
gl_Position=vec4(position.xy,1.0,1.0);}`,cP={COLOR:2},e4e={DISABLED:0},t4e=class extends vn{constructor(e=new Ae,t=cP.COLOR){super({name:"EdgeDetectionMaterial",defines:{THREE_REVISION:Tb.replace(/\D+/g,""),LOCAL_CONTRAST_ADAPTATION_FACTOR:"2.0",EDGE_THRESHOLD:"0.1",DEPTH_THRESHOLD:"0.01",PREDICATION_MODE:"0",PREDICATION_THRESHOLD:"0.01",PREDICATION_SCALE:"2.0",PREDICATION_STRENGTH:"1.0",DEPTH_PACKING:"0"},uniforms:{inputBuffer:new Ct(null),depthBuffer:new Ct(null),predicationBuffer:new Ct(null),texelSize:new Ct(e)},blending:Rs,depthWrite:!1,depthTest:!1,fragmentShader:ZFe,vertexShader:$Fe}),this.toneMapped=!1,this.edgeDetectionMode=t}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=cp){this.depthBuffer=e,this.depthPacking=t}get edgeDetectionMode(){return Number(this.defines.EDGE_DETECTION_MODE)}set edgeDetectionMode(e){this.defines.EDGE_DETECTION_MODE=e.toFixed(0),this.needsUpdate=!0}getEdgeDetectionMode(){return this.edgeDetectionMode}setEdgeDetectionMode(e){this.edgeDetectionMode=e}get localContrastAdaptationFactor(){return Number(this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR)}set localContrastAdaptationFactor(e){this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR=e.toFixed("6"),this.needsUpdate=!0}getLocalContrastAdaptationFactor(){return this.localContrastAdaptationFactor}setLocalContrastAdaptationFactor(e){this.localContrastAdaptationFactor=e}get edgeDetectionThreshold(){return Number(this.defines.EDGE_THRESHOLD)}set edgeDetectionThreshold(e){this.defines.EDGE_THRESHOLD=e.toFixed("6"),this.defines.DEPTH_THRESHOLD=(e*.1).toFixed("6"),this.needsUpdate=!0}getEdgeDetectionThreshold(){return this.edgeDetectionThreshold}setEdgeDetectionThreshold(e){this.edgeDetectionThreshold=e}get predicationMode(){return Number(this.defines.PREDICATION_MODE)}set predicationMode(e){this.defines.PREDICATION_MODE=e.toFixed(0),this.needsUpdate=!0}getPredicationMode(){return this.predicationMode}setPredicationMode(e){this.predicationMode=e}set predicationBuffer(e){this.uniforms.predicationBuffer.value=e}setPredicationBuffer(e){this.uniforms.predicationBuffer.value=e}get predicationThreshold(){return Number(this.defines.PREDICATION_THRESHOLD)}set predicationThreshold(e){this.defines.PREDICATION_THRESHOLD=e.toFixed("6"),this.needsUpdate=!0}getPredicationThreshold(){return this.predicationThreshold}setPredicationThreshold(e){this.predicationThreshold=e}get predicationScale(){return Number(this.defines.PREDICATION_SCALE)}set predicationScale(e){this.defines.PREDICATION_SCALE=e.toFixed("6"),this.needsUpdate=!0}getPredicationScale(){return this.predicationScale}setPredicationScale(e){this.predicationScale=e}get predicationStrength(){return Number(this.defines.PREDICATION_STRENGTH)}set predicationStrength(e){this.defines.PREDICATION_STRENGTH=e.toFixed("6"),this.needsUpdate=!0}getPredicationStrength(){return this.predicationStrength}setPredicationStrength(e){this.predicationStrength=e}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}},i4e=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if THREE_REVISION >= 137
vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}FRAGMENT_HEADvoid main(){FRAGMENT_MAIN_UVvec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGEgl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <encodings_fragment>
#endif
#include <dithering_fragment>
}`,n4e="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEADvoid main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORTgl_Position=vec4(position.xy,1.0,1.0);}",Iu={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},gz=class extends vn{constructor(e,t,i,n,r=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:Tb.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new Ct(null),depthBuffer:new Ct(null),resolution:new Ct(new Ae),texelSize:new Ct(new Ae),cameraNear:new Ct(.3),cameraFar:new Ct(1e3),aspect:new Ct(1),time:new Ct(0)},blending:Rs,depthWrite:!1,depthTest:!1,dithering:r}),this.toneMapped=!1,e&&this.setShaderParts(e),t&&this.setDefines(t),i&&this.setUniforms(i),this.adoptCameraSettings(n)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=cp){this.depthBuffer=e,this.depthPacking=t}setShaderParts(e){return this.fragmentShader=i4e.replace(Iu.FRAGMENT_HEAD,e.get(Iu.FRAGMENT_HEAD)).replace(Iu.FRAGMENT_MAIN_UV,e.get(Iu.FRAGMENT_MAIN_UV)).replace(Iu.FRAGMENT_MAIN_IMAGE,e.get(Iu.FRAGMENT_MAIN_IMAGE)),this.vertexShader=n4e.replace(Iu.VERTEX_HEAD,e.get(Iu.VERTEX_HEAD)).replace(Iu.VERTEX_MAIN_SUPPORT,e.get(Iu.VERTEX_MAIN_SUPPORT)),this.needsUpdate=!0,this}setDefines(e){for(let t of e.entries())this.defines[t[0]]=t[1];return this.needsUpdate=!0,this}setUniforms(e){for(let t of e.entries())this.uniforms[t[0]]=t[1];return this}setExtensions(e){this.extensions={};for(let t of e)this.extensions[t]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(e){this.encodeOutput!==e&&(e?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(e){return this.encodeOutput}setOutputEncodingEnabled(e){this.encodeOutput=e}get time(){return this.uniforms.time.value}set time(e){this.uniforms.time.value=e}setDeltaTime(e){this.uniforms.time.value+=e}adoptCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof po?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(e,t){let i=this.uniforms;i.resolution.value.set(e,t),i.texelSize.value.set(1/e,1/t),i.aspect.value=e/t}static get Section(){return Iu}},r4e=`#include <common>
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);l*=low*high;
#elif defined(THRESHOLD)
l=smoothstep(threshold,threshold+smoothing,l);
#endif
#ifdef COLOR
gl_FragColor=vec4(texel.rgb*l,l);
#else
gl_FragColor=vec4(l);
#endif
}`,s4e=class extends vn{constructor(e=!1,t=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:Tb.replace(/\D+/g,"")},uniforms:{inputBuffer:new Ct(null),threshold:new Ct(0),smoothing:new Ct(1),range:new Ct(null)},blending:Rs,depthWrite:!1,depthTest:!1,fragmentShader:r4e,vertexShader:yM}),this.toneMapped=!1,this.colorOutput=e,this.luminanceRange=t}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get threshold(){return this.uniforms.threshold.value}set threshold(e){this.smoothing>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=e}getThreshold(){return this.threshold}setThreshold(e){this.threshold=e}get smoothing(){return this.uniforms.smoothing.value}set smoothing(e){this.threshold>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=e}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(e){this.smoothing=e}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(e){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(e){e?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(e){return this.colorOutput}setColorOutputEnabled(e){this.colorOutput=e}get useRange(){return this.luminanceRange!==null}set useRange(e){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(e){e!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=e,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(e){this.luminanceRange=e}},a4e=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef MASK_PRECISION_HIGH
uniform mediump sampler2D maskTexture;
#else
uniform lowp sampler2D maskTexture;
#endif
#if MASK_FUNCTION != 0
uniform float strength;
#endif
varying vec2 vUv;void main(){
#if COLOR_CHANNEL == 0
float mask=texture2D(maskTexture,vUv).r;
#elif COLOR_CHANNEL == 1
float mask=texture2D(maskTexture,vUv).g;
#elif COLOR_CHANNEL == 2
float mask=texture2D(maskTexture,vUv).b;
#else
float mask=texture2D(maskTexture,vUv).a;
#endif
#if MASK_FUNCTION == 0
#ifdef INVERTED
mask=step(mask,0.0);
#else
mask=1.0-step(mask,0.0);
#endif
#else
mask=clamp(mask*strength,0.0,1.0);
#ifdef INVERTED
mask=1.0-mask;
#endif
#endif
#if MASK_FUNCTION == 2
gl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);
#else
gl_FragColor=mask*texture2D(inputBuffer,vUv);
#endif
}`,xte={DISCARD:0,MULTIPLY:1},o4e=class extends vn{constructor(e=null){super({name:"MaskMaterial",uniforms:{maskTexture:new Ct(e),inputBuffer:new Ct(null),strength:new Ct(1)},blending:Rs,depthWrite:!1,depthTest:!1,fragmentShader:a4e,vertexShader:yM}),this.toneMapped=!1,this.setColorChannel(yte.RED),this.setMaskFunction(xte.DISCARD)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}set maskTexture(e){this.uniforms.maskTexture.value=e,delete this.defines.MASK_PRECISION_HIGH,e.type!==bo&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}setMaskTexture(e){this.maskTexture=e}set colorChannel(e){this.defines.COLOR_CHANNEL=e.toFixed(0),this.needsUpdate=!0}setColorChannel(e){this.colorChannel=e}set maskFunction(e){this.defines.MASK_FUNCTION=e.toFixed(0),this.needsUpdate=!0}setMaskFunction(e){this.maskFunction=e}get inverted(){return this.defines.INVERTED!==void 0}set inverted(e){this.inverted&&!e?delete this.defines.INVERTED:e&&(this.defines.INVERTED="1"),this.needsUpdate=!0}isInverted(){return this.inverted}setInverted(e){this.inverted=e}get strength(){return this.uniforms.strength.value}set strength(e){this.uniforms.strength.value=e}getStrength(){return this.strength}setStrength(e){this.strength=e}},l4e=`#define sampleLevelZeroOffset(t, coord, offset) texture2D(t, coord + offset * texelSize)
#if __VERSION__ < 300
#define round(v) floor(v + 0.5)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D areaTexture;uniform lowp sampler2D searchTexture;uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}vec2 decodeDiagBilinearAccess(in vec2 e){e.r=e.r*abs(5.0*e.r-5.0*0.75);return round(e);}vec4 decodeDiagBilinearAccess(in vec4 e){e.rb=e.rb*abs(5.0*e.rb-5.0*0.75);return round(e);}vec2 searchDiag1(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 searchDiag2(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);coord.x+=0.25*texelSize.x;vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;e=decodeDiagBilinearAccess(e);coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 areaDiag(const in vec2 dist,const in vec2 e,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE_DIAG,AREATEX_MAX_DISTANCE_DIAG)*e+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.x+=0.5;texCoord.y+=AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTexture,texCoord).rg;}vec2 calculateDiagWeights(const in vec2 texCoord,const in vec2 e,const in vec4 subsampleIndices){vec2 weights=vec2(0.0);vec4 d;vec2 end;if(e.r>0.0){d.xz=searchDiag1(texCoord,vec2(-1.0,1.0),end);d.x+=float(end.y>0.9);}else{d.xz=vec2(0.0);}d.yw=searchDiag1(texCoord,vec2(1.0,-1.0),end);if(d.x+d.y>2.0){vec4 coords=vec4(-d.x+0.25,d.x,d.y,-d.y-0.25)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.xy=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).rg;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).rg;c.yxwz=decodeDiagBilinearAccess(c.xyzw);vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.z);}d.xz=searchDiag2(texCoord,vec2(-1.0,-1.0),end);if(sampleLevelZeroOffset(inputBuffer,texCoord,vec2(1,0)).r>0.0){d.yw=searchDiag2(texCoord,vec2(1.0),end);d.y+=float(end.y>0.9);}else{d.yw=vec2(0.0);}if(d.x+d.y>2.0){vec4 coords=vec4(-d.x,-d.x,d.y,d.y)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.x=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).g;c.y=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(0,-1)).r;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).gr;vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.w).gr;}return weights;}float searchLength(const in vec2 e,const in float offset){vec2 scale=SEARCHTEX_SIZE*vec2(0.5,-1.0);vec2 bias=SEARCHTEX_SIZE*vec2(offset,1.0);scale+=vec2(-1.0,1.0);bias+=vec2(0.5,-0.5);scale*=1.0/SEARCHTEX_PACKED_SIZE;bias*=1.0/SEARCHTEX_PACKED_SIZE;return texture2D(searchTexture,scale*e+bias).r;}float searchXLeft(in vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x>end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(-2.0,0.0)*texelSize+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.0)+3.25;return texelSize.x*offset+texCoord.x;}float searchXRight(vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x<end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(2.0,0.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.5)+3.25;return-texelSize.x*offset+texCoord.x;}float searchYUp(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.y>end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=-vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.0)+3.25;return texelSize.y*offset+texCoord.y;}float searchYDown(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;i++){if(!(texCoord.y<end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.5)+3.25;return-texelSize.y*offset+texCoord.y;}vec2 area(const in vec2 dist,const in float e1,const in float e2,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.y=AREATEX_SUBTEX_SIZE*offset+texCoord.y;return texture2D(areaTexture,texCoord).rg;}void detectHorizontalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,1)).r;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).r;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,-2)).r;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,-2)).r;weights*=clamp(factor,0.0,1.0);
#endif
}void detectVerticalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(1,0)).g;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).g;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(-2,0)).g;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(-2,1)).g;weights*=clamp(factor,0.0,1.0);
#endif
}void main(){vec4 weights=vec4(0.0);vec4 subsampleIndices=vec4(0.0);vec2 e=texture2D(inputBuffer,vUv).rg;if(e.g>0.0){
#if !defined(DISABLE_DIAG_DETECTION)
weights.rg=calculateDiagWeights(vUv,e,subsampleIndices);if(weights.r==-weights.g){
#endif
vec2 d;vec3 coords;coords.x=searchXLeft(vOffset[0].xy,vOffset[2].x);coords.y=vOffset[1].y;d.x=coords.x;float e1=texture2D(inputBuffer,coords.xy).r;coords.z=searchXRight(vOffset[0].zw,vOffset[2].y);d.y=coords.z;d=round(resolution.xx*d+-vPixCoord.xx);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.zy,vec2(1,0)).r;weights.rg=area(sqrtD,e1,e2,subsampleIndices.y);coords.y=vUv.y;detectHorizontalCornerPattern(weights.rg,coords.xyzy,d);
#if !defined(DISABLE_DIAG_DETECTION)
}else{e.r=0.0;}
#endif
}if(e.r>0.0){vec2 d;vec3 coords;coords.y=searchYUp(vOffset[1].xy,vOffset[2].z);coords.x=vOffset[0].x;d.x=coords.y;float e1=texture2D(inputBuffer,coords.xy).g;coords.z=searchYDown(vOffset[1].zw,vOffset[2].w);d.y=coords.z;d=round(resolution.yy*d-vPixCoord.yy);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.xz,vec2(0,1)).g;weights.ba=area(sqrtD,e1,e2,subsampleIndices.x);coords.x=vUv.x;detectVerticalCornerPattern(weights.ba,coords.xyxz,d);}gl_FragColor=weights;}`,c4e="uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void main(){vUv=position.xy*0.5+0.5;vPixCoord=vUv*resolution;vOffset[0]=vUv.xyxy+texelSize.xyxy*vec4(-0.25,-0.125,1.25,-0.125);vOffset[1]=vUv.xyxy+texelSize.xyxy*vec4(-0.125,-0.25,-0.125,1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*texelSize.xxyy*MAX_SEARCH_STEPS_FLOAT;gl_Position=vec4(position.xy,1.0,1.0);}",u4e=class extends vn{constructor(e=new Ae,t=new Ae){super({name:"SMAAWeightsMaterial",defines:{MAX_SEARCH_STEPS_INT:"16",MAX_SEARCH_STEPS_FLOAT:"16.0",MAX_SEARCH_STEPS_DIAG_INT:"8",MAX_SEARCH_STEPS_DIAG_FLOAT:"8.0",CORNER_ROUNDING:"25",CORNER_ROUNDING_NORM:"0.25",AREATEX_MAX_DISTANCE:"16.0",AREATEX_MAX_DISTANCE_DIAG:"20.0",AREATEX_PIXEL_SIZE:"(1.0 / vec2(160.0, 560.0))",AREATEX_SUBTEX_SIZE:"(1.0 / 7.0)",SEARCHTEX_SIZE:"vec2(66.0, 33.0)",SEARCHTEX_PACKED_SIZE:"vec2(64.0, 16.0)"},uniforms:{inputBuffer:new Ct(null),searchTexture:new Ct(null),areaTexture:new Ct(null),resolution:new Ct(t),texelSize:new Ct(e)},blending:Rs,depthWrite:!1,depthTest:!1,fragmentShader:l4e,vertexShader:c4e}),this.toneMapped=!1}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get searchTexture(){return this.uniforms.searchTexture.value}set searchTexture(e){this.uniforms.searchTexture.value=e}get areaTexture(){return this.uniforms.areaTexture.value}set areaTexture(e){this.uniforms.areaTexture.value=e}setLookupTextures(e,t){this.searchTexture=e,this.areaTexture=t}get orthogonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_INT)}set orthogonalSearchSteps(e){let t=Math.min(Math.max(e,0),112);this.defines.MAX_SEARCH_STEPS_INT=t.toFixed("0"),this.defines.MAX_SEARCH_STEPS_FLOAT=t.toFixed("1"),this.needsUpdate=!0}setOrthogonalSearchSteps(e){this.orthogonalSearchSteps=e}get diagonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_DIAG_INT)}set diagonalSearchSteps(e){let t=Math.min(Math.max(e,0),20);this.defines.MAX_SEARCH_STEPS_DIAG_INT=t.toFixed("0"),this.defines.MAX_SEARCH_STEPS_DIAG_FLOAT=t.toFixed("1"),this.needsUpdate=!0}setDiagonalSearchSteps(e){this.diagonalSearchSteps=e}get diagonalDetection(){return this.defines.DISABLE_DIAG_DETECTION===void 0}set diagonalDetection(e){e?delete this.defines.DISABLE_DIAG_DETECTION:this.defines.DISABLE_DIAG_DETECTION="1",this.needsUpdate=!0}isDiagonalDetectionEnabled(){return this.diagonalDetection}setDiagonalDetectionEnabled(e){this.diagonalDetection=e}get cornerRounding(){return Number(this.defines.CORNER_ROUNDING)}set cornerRounding(e){let t=Math.min(Math.max(e,0),100);this.defines.CORNER_ROUNDING=t.toFixed("4"),this.defines.CORNER_ROUNDING_NORM=(t/100).toFixed("4"),this.needsUpdate=!0}setCornerRounding(e){this.cornerRounding=e}get cornerDetection(){return this.defines.DISABLE_CORNER_DETECTION===void 0}set cornerDetection(e){e?delete this.defines.DISABLE_CORNER_DETECTION:this.defines.DISABLE_CORNER_DETECTION="1",this.needsUpdate=!0}isCornerRoundingEnabled(){return this.cornerDetection}setCornerRoundingEnabled(e){this.cornerDetection=e}setSize(e,t){let i=this.uniforms;i.texelSize.value.set(1/e,1/t),i.resolution.value.set(e,t)}},h4e=new mg,ym=null;function d4e(){if(ym===null){let e=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),t=new Float32Array([0,0,2,0,0,2]);ym=new ii,ym.setAttribute!==void 0?(ym.setAttribute("position",new vi(e,3)),ym.setAttribute("uv",new vi(t,2))):(ym.addAttribute("position",new vi(e,3)),ym.addAttribute("uv",new vi(t,2)))}return ym}var rl=class{constructor(e="Pass",t=new Pl,i=h4e){this.name=e,this.renderer=null,this.scene=t,this.camera=i,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){let t=this.getFullscreenMaterial();t!==null&&(t.needsUpdate=!0),this.rtt=!e}}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let t=this.screen;t!==null?t.material=e:(t=new fr(d4e(),e),t.frustumCulled=!1,this.scene===null&&(this.scene=new Pl),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,t=cp){}render(e,t,i,n,r){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,i){}dispose(){for(let e of Object.keys(this)){let t=this[e];if(t!==null&&typeof t=="object"&&typeof t.dispose=="function"){if(t instanceof Pl||t===this.renderer)continue;this[e].dispose()}}}},vz=class extends rl{constructor(e,t=!0){super("CopyPass"),this.fullscreenMaterial=new JFe,this.needsSwap=!1,this.renderTarget=e,e===void 0&&(this.renderTarget=new mn(1,1,{minFilter:Yi,magFilter:Yi,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=t}get resize(){return this.autoResize}set resize(e){this.autoResize=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(e){this.autoResize=e}render(e,t,i,n,r){this.fullscreenMaterial.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){this.autoResize&&this.renderTarget.setSize(e,t)}initialize(e,t,i){i!==void 0&&(this.renderTarget.texture.type=i,i!==bo?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":e.outputEncoding===Gi&&(this.renderTarget.texture.encoding=Gi))}},f4e=class extends rl{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(e,t,i,n,r){let s=e.state.buffers.stencil;s.setLocked(!1),s.setTest(!1)}},aL=new gi,V5=class extends rl{constructor(e=!0,t=!0,i=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=e,this.depth=t,this.stencil=i,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(e,t,i){this.color=e,this.depth=t,this.stencil=i}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(e){this.overrideClearColor=e}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(e){this.overrideClearAlpha=e}render(e,t,i,n,r){let s=this.overrideClearColor,a=this.overrideClearAlpha,o=e.getClearAlpha(),l=s!==null,c=a>=0;l?(aL.copy(e.getClearColor(aL)),e.setClearColor(s,c?a:o)):c&&e.setClearAlpha(a),e.setRenderTarget(this.renderToScreen?null:t),e.clear(this.color,this.depth,this.stencil),l?e.setClearColor(aL,o):c&&e.setClearAlpha(o)}},xm=-1,Rl=class extends Ka{constructor(e,t=xm,i=xm,n=1){super(),this.resizable=e,this.base=new Ae(1,1),this.preferred=new Ae(t,i),this.target=this.preferred,this.s=n}get width(){let{base:e,preferred:t,scale:i}=this,n;return t.width!==xm?n=t.width:t.height!==xm?n=Math.round(t.height*(e.width/Math.max(e.height,1))):n=Math.round(e.width*i),n}set width(e){this.preferredWidth=e}get height(){let{base:e,preferred:t,scale:i}=this,n;return t.height!==xm?n=t.height:t.width!==xm?n=Math.round(t.width/Math.max(e.width/Math.max(e.height,1),1)):n=Math.round(e.height*i),n}set height(e){this.preferredHeight=e}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(e){this.s!==e&&(this.s=e,this.preferred.setScalar(xm),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getScale(){return this.scale}setScale(e){this.scale=e}get baseWidth(){return this.base.width}set baseWidth(e){this.base.width!==e&&(this.base.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseWidth(){return this.base.width}setBaseWidth(e){this.base.width!==e&&(this.base.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get baseHeight(){return this.base.height}set baseHeight(e){this.base.height!==e&&(this.base.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(e){this.baseHeight=e}setBaseSize(e,t){(this.base.width!==e||this.base.height!==t)&&(this.base.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get preferredWidth(){return this.preferred.width}set preferredWidth(e){this.preferred.width!==e&&(this.preferred.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(e){this.preferredWidth=e}get preferredHeight(){return this.preferred.height}set preferredHeight(e){this.preferred.height!==e&&(this.preferred.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(e){this.preferredHeight=e}setPreferredSize(e,t){(this.preferred.width!==e||this.preferred.height!==t)&&(this.preferred.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}copy(e){this.base.set(e.getBaseWidth(),e.getBaseHeight()),this.preferred.set(e.getPreferredWidth(),e.getPreferredHeight()),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height)}static get AUTO_SIZE(){return xm}},oL=!1,P7=class{constructor(e=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(e),this.meshCount=0,this.replaceMaterial=t=>{if(t.isMesh){let i;if(t.material.flatShading)switch(t.material.side){case yo:i=this.materialsFlatShadedDoubleSide;break;case va:i=this.materialsFlatShadedBackSide;break;default:i=this.materialsFlatShaded;break}else switch(t.material.side){case yo:i=this.materialsDoubleSide;break;case va:i=this.materialsBackSide;break;default:i=this.materials;break}this.originalMaterials.set(t,t.material),t.isSkinnedMesh?t.material=i[2]:t.isInstancedMesh?t.material=i[1]:t.material=i[0],++this.meshCount}}}setMaterial(e){if(this.disposeMaterials(),this.material=e,e!==null){let t=this.materials=[e.clone(),e.clone(),e.clone()];for(let i of t)i.uniforms=Object.assign({},e.uniforms),i.side=Zu;t[2].skinning=!0,this.materialsBackSide=t.map(i=>{let n=i.clone();return n.uniforms=Object.assign({},e.uniforms),n.side=va,n}),this.materialsDoubleSide=t.map(i=>{let n=i.clone();return n.uniforms=Object.assign({},e.uniforms),n.side=yo,n}),this.materialsFlatShaded=t.map(i=>{let n=i.clone();return n.uniforms=Object.assign({},e.uniforms),n.flatShading=!0,n}),this.materialsFlatShadedBackSide=t.map(i=>{let n=i.clone();return n.uniforms=Object.assign({},e.uniforms),n.flatShading=!0,n.side=va,n}),this.materialsFlatShadedDoubleSide=t.map(i=>{let n=i.clone();return n.uniforms=Object.assign({},e.uniforms),n.flatShading=!0,n.side=yo,n})}}render(e,t,i){let n=e.shadowMap.enabled;if(e.shadowMap.enabled=!1,oL){let r=this.originalMaterials;this.meshCount=0,t.traverse(this.replaceMaterial),e.render(t,i);for(let s of r)s[0].material=s[1];this.meshCount!==r.size&&r.clear()}else{let r=t.overrideMaterial;t.overrideMaterial=this.material,e.render(t,i),t.overrideMaterial=r}e.shadowMap.enabled=n}disposeMaterials(){if(this.material!==null){let e=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(let t of e)t.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return oL}static set workaroundEnabled(e){oL=e}},p4e=class extends rl{constructor(e,t,i=null){super("RenderPass",e,t),this.needsSwap=!1,this.clearPass=new V5,this.overrideMaterialManager=i===null?null:new P7(i),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}get renderToScreen(){return super.renderToScreen}set renderToScreen(e){super.renderToScreen=e,this.clearPass.renderToScreen=e}get overrideMaterial(){let e=this.overrideMaterialManager;return e!==null?e.material:null}set overrideMaterial(e){let t=this.overrideMaterialManager;e!==null?t!==null?t.setMaterial(e):this.overrideMaterialManager=new P7(e):t!==null&&(t.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(e){this.overrideMaterial=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getSelection(){return this.selection}setSelection(e){this.selection=e}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(e){this.ignoreBackground=e}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(e){this.skipShadowMapUpdate=e}getClearPass(){return this.clearPass}render(e,t,i,n,r){let s=this.scene,a=this.camera,o=this.selection,l=a.layers.mask,c=s.background,u=e.shadowMap.autoUpdate,h=this.renderToScreen?null:t;o!==null&&a.layers.set(o.getLayer()),this.skipShadowMapUpdate&&(e.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(s.background=null),this.clearPass.enabled&&this.clearPass.render(e,t),e.setRenderTarget(h),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(e,s,a):e.render(s,a),a.layers.mask=l,s.background=c,e.shadowMap.autoUpdate=u}},O7=class extends rl{constructor(e,t,{resolutionScale:i=1,width:n=Rl.AUTO_SIZE,height:r=Rl.AUTO_SIZE,renderTarget:s}={}){super("DepthPass"),this.needsSwap=!1,this.renderPass=new p4e(e,t,new nZ({depthPacking:GJ}));let a=this.renderPass;a.skipShadowMapUpdate=!0,a.ignoreBackground=!0;let o=a.getClearPass();o.overrideClearColor=new gi(16777215),o.overrideClearAlpha=1,this.renderTarget=s,this.renderTarget===void 0&&(this.renderTarget=new mn(1,1,{minFilter:rn,magFilter:rn,stencilBuffer:!1}),this.renderTarget.texture.name="DepthPass.Target");let l=this.resolution=new Rl(this,n,r,i);l.addEventListener("change",c=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,i,n,r){let s=this.renderToScreen?null:this.renderTarget;this.renderPass.render(e,s)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height)}},Sn={SKIP:0,ADD:1,ALPHA:2,AVERAGE:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,EXCLUSION:8,LIGHTEN:9,MULTIPLY:10,DIVIDE:11,NEGATION:12,NORMAL:13,OVERLAY:14,REFLECT:15,SCREEN:16,SOFT_LIGHT:17,SUBTRACT:18},m4e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x+y,1.0)*opacity+x*(1.0-opacity);}",g4e="vec3 blend(const in vec3 x,const in vec3 y,const in float opacity){return y*opacity+x*(1.0-opacity);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){float a=min(y.a,opacity);return vec4(blend(x.rgb,y.rgb,a),max(x.a,a));}",v4e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y)*0.5*opacity+x*(1.0-opacity);}",y4e="float blend(const in float x,const in float y){return(y==0.0)?y:max(1.0-(1.0-x)/y,0.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",x4e="float blend(const in float x,const in float y){return(y==1.0)?y:min(x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",b4e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x,y)*opacity+x*(1.0-opacity);}",S4e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return abs(x-y)*opacity+x*(1.0-opacity);}",_4e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y-2.0*x*y)*opacity+x*(1.0-opacity);}",A4e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x,y)*opacity+x*(1.0-opacity);}",w4e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return x*y*opacity+x*(1.0-opacity);}",M4e="float blend(const in float x,const in float y){return(y>0.0)?min(x/y,1.0):1.0;}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",E4e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-abs(1.0-x-y))*opacity+x*(1.0-opacity);}",T4e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y*opacity+x*(1.0-opacity);}",C4e="float blend(const in float x,const in float y){return(x<0.5)?(2.0*x*y):(1.0-2.0*(1.0-x)*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",D4e="float blend(const in float x,const in float y){return(y==1.0)?y:min(x*x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",R4e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-(1.0-x)*(1.0-y))*opacity+x*(1.0-opacity);}",P4e="float blend(const in float x,const in float y){return(y<0.5)?(2.0*x*y+x*x*(1.0-2.0*y)):(sqrt(x)*(2.0*y-1.0)+2.0*x*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",O4e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x+y-1.0,0.0)*opacity+x*(1.0-opacity);}",B4e=new Map([[Sn.SKIP,null],[Sn.ADD,m4e],[Sn.ALPHA,g4e],[Sn.AVERAGE,v4e],[Sn.COLOR_BURN,y4e],[Sn.COLOR_DODGE,x4e],[Sn.DARKEN,b4e],[Sn.DIFFERENCE,S4e],[Sn.EXCLUSION,_4e],[Sn.LIGHTEN,A4e],[Sn.MULTIPLY,w4e],[Sn.DIVIDE,M4e],[Sn.NEGATION,E4e],[Sn.NORMAL,T4e],[Sn.OVERLAY,C4e],[Sn.REFLECT,D4e],[Sn.SCREEN,R4e],[Sn.SOFT_LIGHT,P4e],[Sn.SUBTRACT,O4e]]),I4e=class extends Ka{constructor(e,t=1){super(),this.f=e,this.opacity=new Ct(t)}getOpacity(){return this.opacity.value}setOpacity(e){this.opacity.value=e}get blendFunction(){return this.f}set blendFunction(e){this.f=e,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(e){this.blendFunction=e}getShaderCode(){return B4e.get(this.blendFunction)}},vd={NONE:0,DEPTH:1,CONVOLUTION:2},Pd=class extends Ka{constructor(e,t,{attributes:i=vd.NONE,blendFunction:n=Sn.SCREEN,defines:r=new Map,uniforms:s=new Map,extensions:a=null,vertexShader:o=null}={}){super(),this.name=e,this.renderer=null,this.attributes=i,this.fragmentShader=t,this.vertexShader=o,this.defines=r,this.uniforms=s,this.extensions=a,this.blendMode=new I4e(n),this.blendMode.addEventListener("change",l=>this.setChanged())}getName(){return this.name}setRenderer(e){this.renderer=e}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(e){this.attributes=e,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(e){this.fragmentShader=e,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(e){this.vertexShader=e,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(e,t=cp){}update(e,t,i){}setSize(e,t){}initialize(e,t,i){}dispose(){for(let e of Object.keys(this)){let t=this[e];if(t!==null&&typeof t=="object"&&typeof t.dispose=="function"){if(t instanceof Pl||t===this.renderer)continue;this[e].dispose()}}}};function B7(e,t,i){for(let n of t){let r="$1"+e+n.charAt(0).toUpperCase()+n.slice(1),s=new RegExp("([^\\.])(\\b"+n+"\\b)","g");for(let a of i.entries())a[1]!==null&&i.set(a[0],a[1].replace(s,r))}}function L4e(e,t,i,n,r,s,a){let o=new Map([["fragment",t.getFragmentShader()],["vertex",t.getVertexShader()]]),l=o.get("fragment")!==void 0&&/mainImage/.test(o.get("fragment")),c=o.get("fragment")!==void 0&&/mainUv/.test(o.get("fragment")),u=[],h=[],d=!1,p=!1;if(o.get("fragment")===void 0)console.error("Missing fragment shader",t);else if(c&&(a&vd.CONVOLUTION)!==0)console.error("Effects that transform UV coordinates are incompatible with convolution effects",t);else if(!l&&!c)console.error("The fragment shader contains neither a mainImage nor a mainUv function",t);else{let g=/(?:\w+\s+(\w+)\([\w\s,]*\)\s*{[^}]+})/g,x=gz.Section;if(c){let b=`	${e}MainUv(UV);
`;i.set(x.FRAGMENT_MAIN_UV,i.get(x.FRAGMENT_MAIN_UV)+b),d=!0}if(o.get("vertex")!==null&&/mainSupport/.test(o.get("vertex"))){let b=`	${e}MainSupport(`;b+=/mainSupport *\([\w\s]*?uv\s*?\)/.test(o.get("vertex"))?`vUv);
`:`);
`,i.set(x.VERTEX_MAIN_SUPPORT,i.get(x.VERTEX_MAIN_SUPPORT)+b),u=u.concat([...o.get("vertex").matchAll(/(?:varying\s+\w+\s+(\w*))/g)].map(A=>A[1])),h=h.concat(u).concat([...o.get("vertex").matchAll(g)].map(A=>A[1]))}h=h.concat([...o.get("fragment").matchAll(g)].map(b=>b[1])),h=h.concat([...t.defines.keys()].map(b=>b.replace(/\([\w\s,]*\)/g,""))),h=h.concat([...t.uniforms.keys()]),t.uniforms.forEach((b,A)=>s.set(e+A.charAt(0).toUpperCase()+A.slice(1),b)),t.defines.forEach((b,A)=>r.set(e+A.charAt(0).toUpperCase()+A.slice(1),b)),B7(e,h,r),B7(e,h,o);let y=t.blendMode;if(n.set(y.blendFunction,y),l){let b=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/,A=`${e}MainImage(color0, UV, `;(a&vd.DEPTH)!==0&&b.test(o.get("fragment"))&&(A+="depth, ",p=!0),A+=`color1);
	`;let w=e+"BlendOpacity";s.set(w,y.opacity),A+=`color0 = blend${y.blendFunction}(color0, color1, ${w});

	`,i.set(x.FRAGMENT_MAIN_IMAGE,i.get(x.FRAGMENT_MAIN_IMAGE)+A),A=`uniform float ${w};

`,i.set(x.FRAGMENT_HEAD,i.get(x.FRAGMENT_HEAD)+A)}i.set(x.FRAGMENT_HEAD,i.get(x.FRAGMENT_HEAD)+o.get("fragment")+`
`),o.get("vertex")!==null&&i.set(x.VERTEX_HEAD,i.get(x.VERTEX_HEAD)+o.get("vertex")+`
`)}return{varyings:u,transformedUv:d,readDepth:p}}var W3=class extends rl{constructor(e,...t){super("EffectPass"),this.fullscreenMaterial=new gz(null,null,null,e),this.effects=t.sort((i,n)=>n.attributes-i.attributes),this.skipRendering=!1,this.uniformCount=0,this.varyingCount=0,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(e){this.fullscreenMaterial.encodeOutput=e}get dithering(){return this.fullscreenMaterial.dithering}set dithering(e){let t=this.fullscreenMaterial;t.dithering=e,t.needsUpdate=!0}verifyResources(){let e=this.renderer.capabilities,t=Math.min(e.maxFragmentUniforms,e.maxVertexUniforms);this.uniformCount>t&&console.warn("The current rendering context doesn't support more than "+t+" uniforms, but "+this.uniformCount+" were defined"),t=e.maxVaryings,this.varyingCount>t&&console.warn("The current rendering context doesn't support more than "+t+" varyings, but "+this.varyingCount+" were defined")}updateMaterial(){let e=gz.Section,t=new Map([[e.FRAGMENT_HEAD,""],[e.FRAGMENT_MAIN_UV,""],[e.FRAGMENT_MAIN_IMAGE,""],[e.VERTEX_HEAD,""],[e.VERTEX_MAIN_SUPPORT,""]]),i=new Map,n=new Map,r=new Map,s=new Set,a=0,o=0,l=0,c=!1,u=!1;for(let d of this.effects)if(d.blendMode.blendFunction===Sn.SKIP)l|=d.getAttributes()&vd.DEPTH;else if((l&d.getAttributes()&vd.CONVOLUTION)!==0)console.error("Convolution effects cannot be merged",d);else{l|=d.getAttributes();let p="e"+a++,g=L4e(p,d,t,i,n,r,l);if(o+=g.varyings.length,c=c||g.transformedUv,u=u||g.readDepth,d.extensions!==null)for(let x of d.extensions)s.add(x)}let h=/\bblend\b/g;for(let d of i.values()){let p=d.getShaderCode().replace(h,`blend${d.blendFunction}`);t.set(e.FRAGMENT_HEAD,t.get(e.FRAGMENT_HEAD)+p+`
`)}(l&vd.DEPTH)!==0?(u&&t.set(e.FRAGMENT_MAIN_IMAGE,`float depth = readDepth(UV);

	`+t.get(e.FRAGMENT_MAIN_IMAGE)),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,c?(t.set(e.FRAGMENT_MAIN_UV,`vec2 transformedUv = vUv;
`+t.get(e.FRAGMENT_MAIN_UV)),n.set("UV","transformedUv")):n.set("UV","vUv"),t.forEach((d,p,g)=>g.set(p,d.trim().replace(/^#/,`
#`))),this.uniformCount=r.size,this.varyingCount=o,this.skipRendering=a===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderParts(t).setExtensions(s).setUniforms(r).setDefines(n)}recompile(){this.updateMaterial(),this.verifyResources()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(e,t=cp){this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.depthPacking=t;for(let i of this.effects)i.setDepthTexture(e,t)}render(e,t,i,n,r){for(let s of this.effects)s.update(e,t,n);if(!this.skipRendering||this.renderToScreen){let s=this.fullscreenMaterial;s.inputBuffer=t.texture,s.time+=n,e.setRenderTarget(this.renderToScreen?null:i),e.render(this.scene,this.camera)}}setSize(e,t){this.fullscreenMaterial.setSize(e,t);for(let i of this.effects)i.setSize(e,t)}initialize(e,t,i){this.renderer=e;for(let n of this.effects)n.initialize(e,t,i),n.addEventListener("change",r=>this.handleEvent(r));this.updateMaterial(),this.verifyResources(),i!==void 0&&i!==bo&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(let e of this.effects)e.dispose()}handleEvent(e){switch(e.type){case"change":this.recompile();break}}},U4e=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],H5=class extends rl{constructor({resolutionScale:e=.5,width:t=Rl.AUTO_SIZE,height:i=Rl.AUTO_SIZE,kernelSize:n=uP.LARGE}={}){super("KawaseBlurPass"),this.renderTargetA=new mn(1,1,{minFilter:Yi,magFilter:Yi,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";let r=this.resolution=new Rl(this,t,i,e);r.addEventListener("change",s=>this.setSize(r.baseWidth,r.baseHeight)),this.blurMaterial=new R7,this.ditheredBlurMaterial=new R7,this.ditheredBlurMaterial.uniforms.scale=this.blurMaterial.uniforms.scale,this.ditheredBlurMaterial.dithering=!0,this.dithering=!1,this.kernelSize=n}getResolution(){return this.resolution}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get scale(){return this.blurMaterial.scale}set scale(e){this.blurMaterial.scale=e}getScale(){return this.blurMaterial.scale}setScale(e){this.blurMaterial.scale=e}getKernelSize(){return this.kernelSize}setKernelSize(e){this.kernelSize=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,i,n,r){let s=this.scene,a=this.camera,o=this.renderTargetA,l=this.renderTargetB,c=U4e[this.kernelSize],u=this.blurMaterial,h=t,d,p;for(this.fullscreenMaterial=u,d=0,p=c.length-1;d<p;++d){let g=(d&1)===0?o:l;u.kernel=c[d],u.inputBuffer=h.texture,e.setRenderTarget(g),e.render(s,a),h=g}this.dithering&&(u=this.ditheredBlurMaterial,this.fullscreenMaterial=u),u.kernel=c[d],u.inputBuffer=h.texture,e.setRenderTarget(this.renderToScreen?null:i),e.render(s,a)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t);let n=i.width,r=i.height;this.renderTargetA.setSize(n,r),this.renderTargetB.setSize(n,r),this.blurMaterial.setSize(n,r),this.ditheredBlurMaterial.setSize(n,r)}initialize(e,t,i){i!==void 0&&(this.renderTargetA.texture.type=i,this.renderTargetB.texture.type=i,i!==bo?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.ditheredBlurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):e.outputEncoding===Gi&&(this.renderTargetA.texture.encoding=Gi,this.renderTargetB.texture.encoding=Gi))}static get AUTO_SIZE(){return Rl.AUTO_SIZE}},N4e=class extends rl{constructor({width:e=Rl.AUTO_SIZE,height:t=Rl.AUTO_SIZE,renderTarget:i,luminanceRange:n,colorOutput:r}={}){super("LuminancePass"),this.fullscreenMaterial=new s4e(r,n),this.needsSwap=!1,this.renderTarget=i,this.renderTarget===void 0&&(this.renderTarget=new mn(1,1,{minFilter:Yi,magFilter:Yi,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target",this.renderTarget.texture.generateMipmaps=!1);let s=this.resolution=new Rl(this,e,t);s.addEventListener("change",a=>this.setSize(s.baseWidth,s.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(e,t,i,n,r){let s=this.fullscreenMaterial;s.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height)}initialize(e,t,i){i!==void 0&&i!==bo&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},z4e=class extends rl{constructor(e,t){super("MaskPass",e,t),this.needsSwap=!1,this.clearPass=new V5(!1,!1,!0),this.inverse=!1}get inverted(){return this.inverse}set inverted(e){this.inverse=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(e){this.inverted=e}render(e,t,i,n,r){let s=e.getContext(),a=e.state.buffers,o=this.scene,l=this.camera,c=this.clearPass,u=this.inverted?0:1,h=1-u;a.color.setMask(!1),a.depth.setMask(!1),a.color.setLocked(!0),a.depth.setLocked(!0),a.stencil.setTest(!0),a.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),a.stencil.setFunc(s.ALWAYS,u,4294967295),a.stencil.setClear(h),a.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?c.render(e,null):(c.render(e,t),c.render(e,i))),this.renderToScreen?(e.setRenderTarget(null),e.render(o,l)):(e.setRenderTarget(t),e.render(o,l),e.setRenderTarget(i),e.render(o,l)),a.color.setLocked(!1),a.depth.setLocked(!1),a.stencil.setLocked(!1),a.stencil.setFunc(s.EQUAL,1,4294967295),a.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),a.stencil.setLocked(!0)}},Vc=class extends rl{constructor(e,t="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=e,this.inputBufferUniform=null,this.setInput(t)}setInput(e){if(this.inputBufferUniform=null,this.fullscreenMaterial!==null){let t=this.fullscreenMaterial.uniforms;t!==void 0&&t[e]!==void 0&&(this.inputBufferUniform=t[e])}}render(e,t,i,n,r){this.inputBufferUniform!==null&&t!==null&&(this.inputBufferUniform.value=t.texture),e.setRenderTarget(this.renderToScreen?null:i),e.render(this.scene,this.camera)}initialize(e,t,i){i!==void 0&&i!==bo&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},lL=1/1e3,F4e=1e3,V4e=class{constructor(){this.previousTime=0,this.currentTime=0,this.delta=0,this.fixedDelta=1e3/60,this.elapsed=0,this.timescale=1,this.fixedDeltaEnabled=!1,this.autoReset=!1}setFixedDeltaEnabled(e){return this.fixedDeltaEnabled=e,this}isAutoResetEnabled(e){return this.autoReset}setAutoResetEnabled(e){return typeof document<"u"&&document.hidden!==void 0&&(e?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this.autoReset=e),this}getDelta(){return this.delta*lL}getFixedDelta(){return this.fixedDelta*lL}setFixedDelta(e){return this.fixedDelta=e*F4e,this}getElapsed(){return this.elapsed*lL}getTimescale(){return this.timescale}setTimescale(e){return this.timescale=e,this}update(e){return this.fixedDeltaEnabled?this.delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=e!==void 0?e:performance.now(),this.delta=this.currentTime-this.previousTime),this.delta*=this.timescale,this.elapsed+=this.delta,this}reset(){return this.delta=0,this.elapsed=0,this.currentTime=performance.now(),this}handleEvent(e){document.hidden||(this.currentTime=performance.now())}dispose(){this.setAutoResetEnabled(!1)}},uP={MEDIUM:2,LARGE:3,HUGE:5},H4e=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=clamp(texture2D(map,uv)*intensity,0.0,1.0);}`,G4e=class extends Pd{constructor({blendFunction:e=Sn.SCREEN,luminanceThreshold:t=.9,luminanceSmoothing:i=.025,resolutionScale:n=.5,intensity:r=1,width:s=Rl.AUTO_SIZE,height:a=Rl.AUTO_SIZE,kernelSize:o=uP.LARGE}={}){super("BloomEffect",H4e,{blendFunction:e,uniforms:new Map([["map",new Ct(null)],["intensity",new Ct(r)]])}),this.renderTarget=new mn(1,1,{minFilter:Yi,magFilter:Yi,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.renderTarget.texture.generateMipmaps=!1,this.uniforms.get("map").value=this.renderTarget.texture,this.luminancePass=new N4e({renderTarget:this.renderTarget,colorOutput:!0}),this.luminanceMaterial.threshold=t,this.luminanceMaterial.smoothingFactor=i,this.blurPass=new H5({resolutionScale:n,width:s,height:a,kernelSize:o});let l=this.blurPass.getResolution();l.addEventListener("change",c=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}get resolution(){return this.blurPass.resolution}getResolution(){return this.blurPass.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get dithering(){return this.blurPass.dithering}set dithering(e){this.blurPass.dithering=e}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(e){this.blurPass.kernelSize=e}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(e){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(e){this.uniforms.get("intensity").value=e}getIntensity(){return this.intensity}setIntensity(e){this.intensity=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}update(e,t,i){let n=this.renderTarget;this.luminancePass.enabled?(this.luminancePass.render(e,t,n),this.blurPass.render(e,n,n)):this.blurPass.render(e,t,n)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height),this.luminancePass.resolution.copy(i)}initialize(e,t,i){this.blurPass.initialize(e,t,i),i!==void 0&&(this.renderTarget.texture.type=i,e.outputEncoding===Gi&&(this.renderTarget.texture.encoding=Gi))}},k4e="uniform float brightness;uniform float contrast;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=inputColor.rgb+vec3(brightness-0.5);if(contrast>0.0){color/=vec3(1.0-contrast);}else{color*=vec3(1.0+contrast);}outputColor=vec4(min(color+vec3(0.5),1.0),inputColor.a);}",j4e=class extends Pd{constructor({blendFunction:e=Sn.NORMAL,brightness:t=0,contrast:i=0}={}){super("BrightnessContrastEffect",k4e,{blendFunction:e,uniforms:new Map([["brightness",new Ct(t)],["contrast",new Ct(i)]])})}get brightness(){return this.uniforms.get("brightness").value}set brightness(e){this.uniforms.get("brightness").value=e}getBrightness(e){return this.brightness}setBrightness(e){this.brightness=e}get contrast(){return this.uniforms.get("contrast").value}set contrast(e){this.uniforms.get("contrast").value=e}getContrast(e){return this.contrast}setContrast(e){this.contrast=e}},W4e="void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=vec4(vec3(average(inputColor.rgb)),inputColor.a);}",X4e=class extends Pd{constructor(e=Sn.NORMAL){super("ColorAverageEffect",W4e,{blendFunction:e})}},q4e="varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=texture2D(inputBuffer,vUvR).ra;vec2 ba=texture2D(inputBuffer,vUvB).ba;outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}",Y4e="uniform vec2 offset;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vUvR=uv+shift;vUvB=uv-shift;}",Q4e=class extends Pd{constructor({blendFunction:e=Sn.NORMAL,offset:t=new Ae(.001,5e-4)}={}){super("ChromaticAberrationEffect",q4e,{vertexShader:Y4e,blendFunction:e,attributes:vd.CONVOLUTION,uniforms:new Map([["offset",new Ct(t)]])})}get offset(){return this.uniforms.get("offset").value}set offset(e){this.uniforms.get("offset").value=e}getOffset(){return this.offset}setOffset(e){this.offset=e}},K4e=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;
#else
uniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;
#endif
uniform lowp sampler2D nearCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);float CoCNear=texture2D(nearCoCBuffer,uv).r;CoCNear=min(CoCNear*scale,1.0);vec4 result=inputColor*(1.0-colorFar.a)+colorFar;result=mix(result,colorNear,CoCNear);outputColor=result;}`,J4e=class extends Pd{constructor(e,{blendFunction:t=Sn.NORMAL,worldFocusDistance:i,worldFocusRange:n,focusDistance:r=0,focalLength:s=.1,focusRange:a=s,bokehScale:o=1,width:l=Rl.AUTO_SIZE,height:c=Rl.AUTO_SIZE}={}){super("DepthOfFieldEffect",K4e,{blendFunction:t,attributes:vd.DEPTH,uniforms:new Map([["nearColorBuffer",new Ct(null)],["farColorBuffer",new Ct(null)],["nearCoCBuffer",new Ct(null)],["scale",new Ct(1)]])}),this.camera=e,this.renderTarget=new mn(1,1,{minFilter:Yi,magFilter:Yi,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="DoF.Intermediate",this.renderTarget.texture.generateMipmaps=!1,this.renderTargetMasked=this.renderTarget.clone(),this.renderTargetMasked.texture.name="DoF.Masked.Far",this.renderTargetNear=this.renderTarget.clone(),this.renderTargetNear.texture.name="DoF.Bokeh.Near",this.uniforms.get("nearColorBuffer").value=this.renderTargetNear.texture,this.renderTargetFar=this.renderTarget.clone(),this.renderTargetFar.texture.name="DoF.Bokeh.Far",this.uniforms.get("farColorBuffer").value=this.renderTargetFar.texture,this.renderTargetCoC=this.renderTarget.clone(),this.renderTargetCoC.texture.name="DoF.CoC",this.renderTargetCoCBlurred=this.renderTargetCoC.clone(),this.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",this.uniforms.get("nearCoCBuffer").value=this.renderTargetCoCBlurred.texture,this.cocPass=new Vc(new qFe(e));let u=this.cocMaterial;u.focusDistance=r,u.focusRange=a,i!==void 0&&(u.worldFocusDistance=i),n!==void 0&&(u.worldFocusRange=n),this.blurPass=new H5({kernelSize:uP.MEDIUM,width:l,height:c});let h=this.blurPass.getResolution();h.addEventListener("change",p=>this.setSize(h.getBaseWidth(),h.getBaseHeight())),this.maskPass=new Vc(new o4e(this.renderTargetCoC.texture));let d=this.maskPass.fullscreenMaterial;d.maskFunction=xte.MULTIPLY,d.colorChannel=yte.GREEN,this.bokehNearBasePass=new Vc(new oC(!1,!0)),this.bokehNearBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehNearFillPass=new Vc(new oC(!0,!0)),this.bokehNearFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehFarBasePass=new Vc(new oC(!1,!1)),this.bokehFarBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.bokehFarFillPass=new Vc(new oC(!0,!1)),this.bokehFarFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.target=null,this.bokehScale=o}get cocTexture(){return this.renderTargetCoC.texture}get cocMaterial(){return this.cocPass.fullscreenMaterial}get circleOfConfusionMaterial(){return this.cocMaterial}getCircleOfConfusionMaterial(){return this.circleOfConfusionMaterial}getBlurPass(){return this.blurPass}get resolution(){return this.blurPass.getResolution()}getResolution(){return this.blurPass.getResolution()}get bokehScale(){return this.uniforms.get("scale").value}set bokehScale(e){let t=[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];for(let i of t)i.fullscreenMaterial.setScale(e);this.maskPass.fullscreenMaterial.setStrength(e),this.uniforms.get("scale").value=e}getBokehScale(){return this.bokehScale}setBokehScale(e){this.bokehScale=e}getTarget(){return this.target}setTarget(e){this.target=e}calculateFocusDistance(e){let t=this.camera,i=t.position.distanceTo(e);return mz(-i,t.near,t.far)}setDepthTexture(e,t=cp){this.circleOfConfusionMaterial.depthBuffer=e,this.circleOfConfusionMaterial.depthPacking=t}update(e,t,i){let n=this.renderTarget,r=this.renderTargetCoC,s=this.renderTargetCoCBlurred,a=this.renderTargetMasked;if(this.target!==null){let o=this.calculateFocusDistance(this.target);this.circleOfConfusionMaterial.focusDistance=o}this.cocPass.render(e,null,r),this.blurPass.render(e,r,s),this.maskPass.render(e,t,a),this.bokehFarBasePass.render(e,a,n),this.bokehFarFillPass.render(e,n,this.renderTargetFar),this.bokehNearBasePass.render(e,t,n),this.bokehNearFillPass.render(e,n,this.renderTargetNear)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t);let n=i.width,r=i.height,s=[this.cocPass,this.blurPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];s.push(this.renderTargetCoC,this.renderTargetMasked),s.forEach(a=>a.setSize(e,t)),s=[this.renderTarget,this.renderTargetNear,this.renderTargetFar,this.renderTargetCoCBlurred],s.forEach(a=>a.setSize(n,r)),[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach(a=>a.fullscreenMaterial.setSize(n,r))}initialize(e,t,i){[this.cocPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach(n=>n.initialize(e,t,i)),this.blurPass.initialize(e,t,bo),i!==void 0&&(this.renderTarget.texture.type=i,this.renderTargetNear.texture.type=i,this.renderTargetFar.texture.type=i,this.renderTargetMasked.texture.type=i,e.outputEncoding===Gi&&(this.renderTarget.texture.encoding=Gi,this.renderTargetNear.texture.encoding=Gi,this.renderTargetFar.texture.encoding=Gi,this.renderTargetMasked.texture.encoding=Gi))}};new G;new Bt;var Z4e="uniform vec3 hue;uniform float saturation;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(dot(inputColor.rgb,hue.xyz),dot(inputColor.rgb,hue.zxy),dot(inputColor.rgb,hue.yzx));float average=(color.r+color.g+color.b)/3.0;vec3 diff=average-color;if(saturation>0.0){color+=diff*(1.0-1.0/(1.001-saturation));}else{color+=diff*-saturation;}outputColor=vec4(min(color,1.0),inputColor.a);}",$4e=class extends Pd{constructor({blendFunction:e=Sn.NORMAL,hue:t=0,saturation:i=0}={}){super("HueSaturationEffect",Z4e,{blendFunction:e,uniforms:new Map([["hue",new Ct(new G)],["saturation",new Ct(i)]])}),this.hue=t}get saturation(){return this.uniforms.get("saturation").value}set saturation(e){this.uniforms.get("saturation").value=e}getSaturation(){return this.saturation}setSaturation(e){this.saturation=e}get hue(){let e=this.uniforms.get("hue").value;return Math.acos((e.x*3-1)/2)}set hue(e){let t=Math.sin(e),i=Math.cos(e);this.uniforms.get("hue").value.set((2*i+1)/3,(-Math.sqrt(3)*t-i+1)/3,(Math.sqrt(3)*t-i+1)/3)}getHue(){return this.hue}setHue(e){this.hue=e}};new gi;var e5e=`void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 noise=vec3(rand(uv*time));
#ifdef PREMULTIPLY
outputColor=vec4(min(inputColor.rgb*noise,vec3(1.0)),inputColor.a);
#else
outputColor=vec4(noise,inputColor.a);
#endif
}`,t5e=class extends Pd{constructor({blendFunction:e=Sn.SCREEN,premultiply:t=!1}={}){super("NoiseEffect",e5e,{blendFunction:e}),this.premultiply=t}get premultiply(){return this.defines.has("PREMULTIPLY")}set premultiply(e){this.premultiply!==e&&(e?this.defines.set("PREMULTIPLY","1"):this.defines.delete("PREMULTIPLY"),this.setChanged())}isPremultiplied(){return this.premultiply}setPremultiplied(e){this.premultiply=e}},i5e="uniform bool active;uniform vec2 d;void mainUv(inout vec2 uv){if(active){uv=vec2(d.x*(floor(uv.x/d.x)+0.5),d.y*(floor(uv.y/d.y)+0.5));}}",n5e=class extends Pd{constructor(e=30){super("PixelationEffect",i5e,{uniforms:new Map([["active",new Ct(!1)],["d",new Ct(new Ae)]])}),this.resolution=new Ae,this.d=0,this.granularity=e}get granularity(){return this.d}set granularity(e){let t=Math.floor(e);t%2>0&&(t+=1),this.d=t,this.uniforms.get("active").value=t>0,this.setSize(this.resolution.width,this.resolution.height)}getGranularity(){return this.granularity}setGranularity(e){this.granularity=e}setSize(e,t){this.resolution.set(e,t),this.uniforms.get("d").value.setScalar(this.d).divide(this.resolution)}};new G;new G;var I7="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAYAAACm53kpAAAAeElEQVRYR+2XSwqAMAxEJ168ePEqwRSKhIIiuHjJqiU0gWE+1CQdApcVAMUAuARaMGCX1MIL/Ow13++9lW2s3mW9MWvsnWc/2fvGygwPAN4E8QzAA4CXAB6AHjG4JTHYI1ey3pcx6FHnEfhLDOIBKAmUBK6/ANUDTlROXAHd9EC1AAAAAElFTkSuQmCC",L7="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAYAAAABNmBHAAAgAElEQVR4Xuy9CbhlV1ktOvbpq09DkiIkUBI6kxASIH0DlAQiIK1wRfSJTx+i4JX7vKIigs8HXpXvqVcvrcC9agQ7IDTSSWgqCQQliDRBJKkkhDSkqVPNqVOnP+8b//rH3P+eZ+199tlznVTlvVrft7+1T7OaueZY42/m37QALKNk2wHg1pITlB17mC+Pp11W3X/LHyT32vhg48/5SOv+PnwpsHA70JoGlueB1iKApeqzvOzn44GatTB76Xzhd7suBR7+WWADgDEAwwCG/L54b/poDLrHuvvm70Z2Avhsc+PVcxscBU8F8C8ADg5+ipIjD/PlGwfgju8B924E5seARUfLsiNmqQW0IjL8+7L2NYD/7COBzfcCm+aB8SVgdAkYIRCXKyDax4EdAanL5PuNPllNvXDlAHwFgP8AcC2AhRIoDXbsYb48dl5WkVFTE3LGDcC9m4CZCWBuFFgeAZaGAYJQQCRqDHT+McJrVb8zwATUXH02MHYfMHEIGFsAxgjApQqACYQORjtd/B7Axt/z79sC0+cMPgjjlwPwVwHcA+DfAHzTxcVgWBroqMN8+cYBeM71wH0TwKExYHYUWCIAHYRLTlkCYgcIBcAgU/n3qy8GRu4HRgnAOWBkERhddPAJhGJDBxkvw7cqimr+zFM/ZLnZF64cgL8BYD+AWwB8x/dlWuWagHiYL984AJ/0RWBy1AE4AizyM1yxYAcTigW55xMbAkxEiwEdkJ/ZCQxPAiOHgBECcKEC4TBZcKkSv+mTieNcNPNC26mLNsj45QD8LQDTAO4GcJt/7iw2bfoG4WG+vAGwm9ExiEg69zpg/wgwPQLMjgALzn4E4aIzoJjQ9g4024uygkj+pyuAoX0VAIfngOH5NgCHMhAm8Sv2y3XDZeBhNIp8OzJE8OsBzAKYBHAXgDt8/4O+MVT0j4f58o0D8Pxrgf3DwMwIMEPQEYRkNwfgsuuDZLskip0No0gWMD/9HGDoADAkAC4Aw/wsAgZAgs2Z0ABI0GU6IVmKv+f28KDnHxkA/G0A8y6G73N9kOCjXnh/Ebb6OvgwX75xAF5wLTA1VIHPADgMLDj4yIA5AAm6aCUnv4oz46eeDwxNAUMzwJAz4BABSNDFTwSfg7DDKHE23MG5PqIY8A1u/dINs9dBdy8AgnGPM2NfUBrsnw7z5RsH4IXXAAcJviFgluAbygBINnSLWOAjGxJ4pgOKDV0v/OSLKp8iGXBovhLBBOCQM2ACoTOhnYrAdItYbCij5JFzRyIAqRccAnDAQUjg6UNQ7hsMXP0cRQAexss3DsCLCECCLwCQzMcPwUi2MwAScAKbfnY/YRLFQ8DHX+IAJAMSfDkAF13kLvleIjhjQQHxUVS3jjgGpKeeNzYVQEjgUS8k+PghONdhIwAP4+XXBYCHKIJbwJyDTgaIAdCBJx3Q2M8tYAHP9m4df/ylQOsQ0JqtRLCx30K1wtLBggScQOgsKBGcWHAJeOwRC0BSM1mQIKRbhh+Bj98JQP6t4U0APEyXXxcAEnxkQAFwoVUxID9kvQg+c1C7vidRbIDkc24B//hTQGumDcCWA5DgMxASdNIFBUI5pCML8v8API5zfEQx4BudgqiczviSnJhQwCP4BMCGl+wO8+U7AJi/W4O4YS6+pmK/2ciADsAOBhTIIiAJnPB7AvNjP+0AnANaYkAHX2JBAc+tYaJXOqBZv24Vc386XW5dtkHGW+4HFAJonpOe+YYQZAShgKjv3PNvPQaxVoI8zJdfFwASfPzMUwS3Kt1v0UFIlos6oDFdAGFcliMAP/ryAEAGNwQRnDOgLbdlIEwrIs6AZ/QgkMMHQF6ZAKQcJAsSYPwIeAIk9wJgoPK1gi7+PwF4GC/fOAAvIQPSs0URTPBJ/Pp3GSEGRHfBCIQ0xowBtUbcAj7ys5X4Jfu1HIAGQrIgQRXEsAFQIORDFhiDY/rMHmrU4QUgR08AkgUjCAW6CD6CkwBsAIQC4GG6fPMA3OXiNzCg2I9gNCMksmAAoemDzoimFwL48M85AKkiuQVMAAp8CYRRDAt8GQiJ67N6GJODAXAHlsGguscA2AJg1IPGYmxOpBxFWkRN9LsATgIwXnNs/v/5z/9XCf8BO3YAtxbc/46/KDt+5+ea1Yku2VUxHz/z0v24FwMGK1gWsK2OUUxHHdCBeRUB6OxHABr4ZICIBd0QWSF+XRdMTAjgCdTrG9cBNwE4F8CpDkICyYLGsuhFt6zs+gISwUen8zEAjgMw4cfx2H6O/90yAFo84Cbg4ID3/9TfLTt+5+ebnRABkODjx0SwPi5ec/FrYpmqSAxM8Dn60CsqAFI6GfhqAMiDE/gokmvEr0C4PgDkBQm40wE8zMFEUDKEVoxIMLl/KS73mE7H9d+vcKHQQcjwW0Yu9nP8m8sAmOIBuWY6wP2/4s0ezjjg8TuvaR6ABJ70vxUApGrm7EbGE+i472BAB+WHfqHS/eoAaEwY2E9+wLSXTqhI7CXgnB6LCoOJ4BiST+hTnG0HcCwAglCx3ARoZEVFXnBPp/O/A/hXACc7CPs9/i1lAOyIB+RDX+P9/+pbQjjjAMfv/PL6AFDs1wFAgs/9fgKfgdE/ZEpuiQlbwAde6QAMBgiRmsSwA9BY0JfjovGRDBMH4TlcXGhcBOc6HkF0gjPhZgchxTLZMAci/04W/B6Ab3t09EPXcPyflgFwRTwgJ2MN9/8bf5qFM67x+B/aW4XQz42FeL0YrRyikztUFw0704mf9kXgxhOAqc3AAsPyRxxQCs/PdXOFY0W1KHy3QIUGtx+6vdnx1vsB+dsTncm2AogglFgVEAlUWrOMB2RyEmMCGQ/Y7/HvKns6tfGAnJQ+r/9b76oJZ1zD8WdyQjYBh8aBhVEHjELouQ8ukQ7VRSCJAALwkr+sALhnGzDD3JAJYJHg9uhoi4bx8ytkWUtvHT/7+Zc4dw1uZ3612fH2dkQf7yxIEEockwkJQn4IQoq8unhAhmPRKKFx0uv4K8ueTs94wD7u//VX9ghn7OP4c+4G7h8HpseB+dF2AKlFLwuAIZ8jD6NPrOhAffmfA9/ZBuzZCkyRWSeqBCWyoYGQ5yQrBpDbum/ME1HoPo0XEkSD2zlfbna8q6+EUJcTCxKEtHL5EQjP6BEPyIgYAZBvYt3xHyx7OqvGA65y/7/9wVXCGVc5/sl7qxD66dEqiYgRzAqhN1A4CBNAAlDyAFI+iZ9/N3DLJuC+jcDUBmCWyUnOrmTYCMIOkNclLg0B8/RsNLg9+UvNjnd1APLmmQpFHyEBROuWACQT8nN+H/GAvY7/VNnT6SsesMf13/CpahGnZzhjj+PPmwX2MYdDIfQexWyBAwEUOQDrRDN/98p3A7dvAO6fAA5sqHJDBEAyoUVGkwEd6HR12XU4kwzfl6fCXTZzjy57vvnR513X7Hj7AyDvggAUi9EyFgiZqNxPQF6345nOWbD1HQ/Y5fpvuLa/2+82/vNHgAPDFQDnhoF5j2C2qBWCI8bw1eRw5CL5l94L3DEOTI4DB8Y9OWmsEu/zBJ3rgsaybqBob/7A4C7jtWcooRrczr+u2fH2D0AOQgAUCxKEP7aGgLy64+m6KdjWFA9Yc/03/Osa4glrjr+AupqHz1sEs0cxG0BC9HIePLoit9eNkVf9L+DuUWByDJgaq4ybGYLPAWgiXmLedUE7dwC7saL7CqfPKXi4NYdaykCD410bAHlDEsNiwZ9wAPYbkJcfz6T2gm3N8YDZ9d/wHxUA+739fPwXPrSKYGb+BuP3jAFDElFH9HIWwbzCIGkBr/or4J4RYO8oMOW6ZVcAuvi1Cgoha04BCwT5gfMKHm7NoRde2+x41w5A3hQZkADk5+cGiAeMx3+/7AENFA8Yrv/G71cAXFM4Yzj+otOAaQLQA0gZxaIIZtMDFTigKJV8H9Iq6aZ59ZXAvSPAvpEKgBTtBODcSCWCZeRYtpzrmLyeGNCAyFl1v+Hei8qeb370Rdc2O97BAMi7EgB/2QG41nhAHU9LuWAbOB7Qr//GPRUA13r7Gv9FZwIMoVcEswEwfDoimEP0shKKtIphaZQAXv1+YM+wA3DEdcvRKkGJADQQEsQuhi1Tjt95vBsh5nx2IO59SsHDrTmUOStNjndwAAqEry0IyCMICkOyiuIBNwBvPFQQT7gBuPjc9oRYAIHyOEL4vIFEYVNaOou5vCGE/tV/A0wOVcnpzI47NOri3QFIBpSeaSDUdYLOSWvYImSGgftpJDa4MWJbAGxivGUA5MAOc0Be6eVLj7/4Mk+hzCOYPYpZDBiNkLh+G/M3yFyv/ltgL3W3YQfgcFUhgRY2PwY+Z7/EhAR1SFyXCOb57r28QfQBsJQBMn5D4y0HYLPje9Cd7RIC0PM3EiMofF4gVCBp1P840ix/gyz56r+vAMjk9Gl375iB4+CzveuZdLkkEPJ8ZEfX/6R73vOjzT5Si9hucLxHAVg4PwJgRwh9CKOXK8YA4ZEqKZXSQWh5P+5AftXfA/uGKvYjCKn72cctbFrZNECka5L5CPwIPtMH3TVz17MLB5gdLgA2Nd6jACycHwLQxFEUSR5ASvARDB0h9AQb9bXIgCGk6lUfAPYTgEPAITKgg1BObk58srTJgG58WMkWMaAbQQT1nc8rHGANAJsc71EAFs4PAagQestgC1lsBJ4BMCSOK6dDUcwqqaFiQr/0QeAAAdjy+jBiQQeeMSBZT3nCPUDIa9z+/MIB1gCwyfEeBWDh/BCAeQSzgkjFfGLBBD5nxQ4DxN0wv3hVxX5TBGDwL5obxvVA5YqYL5BeMLd66YYxJpRB0gK+96LCAdYAsMnxHgVg4fwIgMrhUPKQ2C+Bz0PmBTqBMQehAbDlIjj4F80KJguSVZ0FuXpjoCOgXawLjALhbT9eOMAuAGxqvEcBWDg/l1IE05Ed0ygZnyHdz0VwCqEPIfNyx0QQvvLDFQCp+8nfZk5und8tXwIgWcHSNX0N2CJmnAl3v6RwgNnhl17T7HiPArBwfghAS7mV/hey2JS9FvM3BLpUUi1YwDRMXvkRYJoAlAh2l0dcZ04s6JUTDIjyBcrl4yDc/dLCAdYAsMnxHgVg4fxwKVwJgGEJNmWtxpQMpX9on2eRhVA+O56AjMfnP+e3Xvf3NwG4xIPTleiY55bpGh6UbafNU0l0z0p+5Jh5HqYJ6b51nP6XP8cx12XNHQVgIQB/bFPVg2OC7Q+WgVFWng/FvtWLI06uWh5oguKEcXVS/9sEAF//VGD7t4ETDgJbF4CNi8CGZWBs2fPL/H6Vwp2KEtVk4fJ+v/EIYPN9wKa5qu+IncfPwXHVZe/aOL3EbwS7xv8A1rQvnO0j8PArTgTGZ4BxFv9mIxhOCGsv+0OPYDRghcLfkWkEuq0+G00x4OtfDGz+d2DbHmDLjL8si8AYP/7CGIAiEEMTG92zXqSbH+d9R2aA0XnvO+JjthiIrOVDHHPOkBrzUQAWAPsZp3oPDpa/Xag6EVkLBK+5rAnJC3/nYk/APD704WiEAV8OTHwX2LQH2DgFbJgFNrBhjd8r79deGoEwsllgNBOzy8CdjweG9wBj08AIAci2D6HafmyAk4/Z7SJ72hGYRwFYAMDLTwOGp4FRFgD3HhzqRGQiyeurqOdG6r0Rm8IEZjzRlkiqCWoEgK8Axm4BJu4HJhyAbFhDxmbDGnZO4j0SgLGDkpibgEq66TJw/1nA0F5gdLpq+zDqFfd5LMeWqu5HNST0uJOIllg+qgMWgI+HPv0xwLA3gWHpW2sC441gCECbmKziaGrnUdMO4aHeh6MxAP4SMHI7ML4HGD8AjHvHJGNAgpDgY/ck3stipRemvVhc+uASMPUEYGh/9dIRgGx8Y+MNbR/00uVtH0wEx94j/v0oAxaA8Ed+GBieAYZZg5kADC0QWGOFzGJlcGPzl1BxNLXD8sk4xftwNAbA/wwM3wGMUmxOOQBnHXzetIYvibonmSiuYTNjriVg7glAiwBk0fNZH6+PmX9P6kfNmCXGpftJ7TgKwBIAnln14BAAYxMYm5C6RjCyCoOyr0qkD/c+HI0B8DXA8N3AyCQwesD1VQKH7EcASm1Q+y4CkN9pUKiVF5nLvy+fBbTUd8QBaH1HvNBROiZvfsNnrF4kcvPwpdsBLBeU18Nf7AB23Dp4ecHC8oBgUlJJecLS+7+WOpE3gbE+HKw+yoevCYkMGKqPJrdEKARutaFYRs1fiEZ0wP8CDN8LDO8FRqYq3W10pgKgfYLaYCzootgA6KXaTA90y374TKB1sBozy77xHFZ536utRgAmEaw6g5kUSFZwSXnA330qsOlfgHMPDlZesLA8IOjoLypPWHj/11EnCiVwkz7kAExtsGraYUWdSDX5TmsagL8KDBGA7Bd30JsW0oWivnEOQNP7yGTSBR101AlZSUtGyfgZDkCWY1HnJdcBVe6325hTvelg2CQjZNDygG/2An0j1wKnL6y9vGBheUC8prQ8YeH9X39OVQSc7Mc6fCaKvAeHdCIVf4yMYCynTpX+nb97NJmlSQb8r8DQHm9YOFUZTKOzoXGhs6AxF0HIexcLBvWBuiHN8s2ne98R3qc6L4Vyb2oBVjfm9MIFHbjDCh6kPOBbQoG+oW8CO5bWVl6wsDwgfr20PGHh/X/1iaEIuDcCTIW/1Q4rFv8OnYiW3c+W2iKwUjKbyjQNwL1uuR6sAEgDgq1brXOmV81PxhNB6DUDBSYzQJwFtz623XcktX1Q1VWKaTF/zZhVazBVYA1tX5MazsGvobwe/jQr0Ne6BTh5uf/ygoXlAfG60vKEhff/rSe1i4DnTWDUACY1guFTDqLYdCBvf6DJYSMYATBfOx1kLfj1v1axH10nQ3Sd0GUkBnTfpemtBJgseIKQAHLQcVxa2TnuMW0Aqui5es8xBIegVdVVE8VhzHnLh65WMB9An+X18K6aAn2tO4ETl6vqbKuVFywsDwhevqg8YeH93/Rk70JE90nowxZbIJjvS3WYNSGUwGHJTpPxwwcbBuBrgRYBeKACn7VtpdUu/c0NJxO9BIxcKu4TTODzbkonPLoaL0vyUQRb2y8HsL1ckfWzMeuFi40Qezqi+yiPhyt7FOjr6/gCFwgP7Xb5vssTFt7/nQRg6MGRWmDRoeyTlpgw68GRTwgZgo1gGmXAX6/8dtaylSKY/koyID9BhzML3q1gAos2AcOrZYSoq/pJp1VtODRm9Z3LS/7WjVkvXOzEtOpKyGrlAT+4SoG+VY8vBGCvy/dVnrDw/vee65NBJiAjBIVcAJQjOm+DkCZEeiGAMw6sAwDZsJrAdhFM9rPGhd4904Co5oVuCZPV6kD40Ec6+9W8dBTBsfdc3nkpvnB82fp2RPcs79dHgb51LA9ofsDV6vut5/3PnxcAmLVBiDqgevDaJLkYrpuQxzcNwN8AWgIgRbB8loEBzXDwl4cGiDGft58SCOWGedgjvOJ+bPvgRkiuA+ZjzhnQQOiFNVbloa7l/fos0LdO5QENgEXlCfs8Qbf7HyMA3QVjYihYhLENgjX9y/qwxQmRU/asfd0ZcLU2CHVGyusJQLKfVi98CS12T5f7iECkHpsMkAhCF8+nshWH2I/jXsOYO144GV/9ApAIrS3vt4YCfetQHtAA2G+/4PW4/2PPbzMgmUMi2NoeSCRxIt2/FvuxWURIWCXg357gfTjEDNIHnTRXRCpH5ugKwGl3HpMBXQc0v6WLYVm/5limj04rG762K2uYY9jBkr9+rI03NL5ZbczS/dJ+LQyoga4o77fGAn0NlwdMAOy3vl/T938KAcj121z8Bn+Y9eWQJRz8Y6kNagDh2ey5EvxjxQD8TWdAuneCCO4An1vw5vdzQMmdktwq7pLZQR+dM34+ZumAxvY1Y04uqOAJ6FsExzeto7zfAAX6GiwPaLWR1lrfr8n7f/Rl3QGzmsis+/uO71V9OFgP2gpPhgr7TGRqRUT6dyvr4aIs/pm/2zVUNbBSv6G8e5pEv0Cvec7Po7+bTtjlBRlkvAMBkDeQyvsNWKCvofKACYBrre/X1P0/oWEAnnFD1YdjhtXxR73mX10FfCHHE9pVWcGAI/S0gKsfA2y+twrFZw6Hxf/F0Pk8Ri/kpGSnMuDx5T0iACgQHioo0NdAecBUHW6QdsV2/cL7v/Cyqr5gnc42CCOcfX1VIZ/V8We9IDmTzVXwPDJiXuKXPxtDBma8+lzP4WAgKkPxCUAPE4v5GzEuMX0PYJPLhB6FJsc7MAMmkVxaYC/K9gG+F1++8AQ7Gwbgk78I7GFpXgIwFiRXOwaJZPUbiR0yCUDRk+cHf+YpwMj9HgfI8ClGPyvsSiH0WSKRuYlitLb/zHM/JOSs5C/YIC9cMQDZr/dwxgOW9gtGYUBi0wA8l304vDQvAchilFbpIBQhZ7Ejq6ZQ0/Yhil8y4j89Axie9DAsD6FX9HOK3QtROTFkviN83kG4felIY8DCeLrSeMDSfsEovAECUFsTjHD+tcB+tkFgcXKvBRir7qtFl9owmO4Xy/1G3bAFfPrZHorFNWBFwHjQAFctIghj2kBarw06If/+MM9ZqTN6DgsDojCerjQesLRfMApvoGkAWh8Ob/tgAPSKWCp8ngNQtadjmTdltvNvn3peFYhgQQgh+iUmEaUAUoXM1yRLmWuFLaE9Z+XIAWBhPF1pPGBpv2AU3kDTALzwmqo6qtVh9kJErAudABia38TC5wJgS2xIhAwBn3yhByL4EhzXfRXxYsDTJ4IvrNN2JFMxZcBzVo4cABbG05XGA5b2C0bhDTQNQLZBYH1AVsQSAAU+imI1obHyblnjG/kJk3U8BHz8xVUQAhnQIl5CyNgKAGp5LKSSCoAySh5Jj79vTagcxUaIBeRNe79g9gq+DXig4wGzy+PONfT7RWFA4noAkGXZVAhcBckJQgNgrLiaNb3paIDo1vHHX+oA9LQBi4DxJcOUPJUnTgU2NJUyROs8irGARxQAC+PpCtsFd40H/AEf0gMQkLgeACT41PiGoLOKqyrJq3K/Ya9mNyr5FusN/uPLPIeDa8Bc+w3rtyl4VFHaMZc3i9RWBM9jjzgAFsbTFbYLRmm/YBTeQNMAtD4cBKDXBTQGdAB2MGBo8SCLmEuS1AFVAJ3A/NhPt0PoCcA8bSDG76XI7aySg6JYuGfKwJHFgH0E5B3ueMCe/Y4L+xVHAOZ+9EHcEgQgwbeiEYx6jwTdz4qfu7EhEJqxGqruf/RnHIAEnxgwBM0aC8aUAYWNBRCmoIll4HTqO122QcZbrgMWxtMVtgvuOx6wa7/jwhtoGoDWh4MBJ16WN4lfr8AqI0TVV1O1fa9BbQzovkAy4Ed+NgCQUSxZCFWvCOaOFREXyUwZOPIA2GdA3uGOB6wPaOz+QPv5S+MA3OXiN9aclghW+d3IgupBF2pPqxcxGenDPxfSRh2ASiKKiVP2PaZScvAKoA0VDc6cOlIB2GdA3uGOB1zR77iwX/F6AFB9ONSOQW0frA50sILVcckWJyIDSgwPAVcJgFbYuZ3FJvAlEHbJ3IsgJLGedeBIA+AAAXmHOx6wo99xYb/i9QKg2iAIfDJEJHqj4SExbEty0gkdhB/6P9oZbBZIGiKYVb9GKaN50lRHBLOvhDxh/5EKwDUG5B3ueMB2QGM/grb7/6wHAPNGMAY+GSGUjC52VX2f2CD4+HO0gqkZfegXKgBaHkcWtS0AWii9xG1ImrLlN5XR8L8fmQD05BVrmEENmpYSP9QX+KHiqj2/82+HqqDWwnbBRfGATdzAegGwru2DpRq7Mzq2fpAf0Nq0Rl2wBXzglZ4yUAPAmDSVWDBPHQjLcgTqOZ6zUvdKHh4ruDCerox/Dnu7YqwXAC1NI/QcEQuK6WK/kdgCTGC0PYAP/KIDMBgglq+hIkrOfsaCviLSofcJgJ5AdM7kkSaCj/HqQKVIGvD4swF8bcBjmzjsaQ2H5D/6acBd9wALB4DFWWB5AVherMp4GKIYEOp7+26UF0aSfT/xYuDG7wDjrIpAERytXf2vajj7ueryQXSFl10K/ON3gIWDwCLvjfGB8Z54O+Ee4ve6513uB2R1yzsqC+twbC8HcNVhfAeaBuDP/TvwtS3A/ePAIfYFVlPq2HHTuyulZCTlhbjhETF5yxTQGgPGhoHhIWC4VSXGD3n0tLkMHXHxu+YyB+MlPwDuZs5K6FlsbCzdVO9DuKfkHM8AEkP7B8fOkwDcD+B7np42+JkGOvKdAL4E4K8P0zvQdET0b14D3DgB3D0B7B8HZka9WzrD88N6sFm+YcUjrn7E1ZDvMtF9DBgeAYaHgSGB0PNHCD4BLwLRsByAyX/ij0/dDUxuqlIG5hix7eFhvLcOVUAtyPSydAFmOQNe6EYGV/9ZESiKgIEgtbaD/gHALQC4ovY5r5KwtjOU/XfTAHzzLuCmIeDuMWDvKHBwpMoN0WQzNtAaYSs0K4ZlOSAjGG9kPjCBRwZ0ABKEBJexYAZEAU3A7Oi1BeDym4EDnjQ1TwCGWMW8MXcKks0YOyZNlQOQjcgYIUHllEzYQ0ktm+r6oz8G4F4AXwXwRd8/kO9A0wB8y65KmPxgGJgcqYJTKYpTv2CCzyddQJRDOjKivn+Deh8BF8BnwBtaCUA+YYEyAU8h+c6Az9gNHHRmrgOgmDA3jHQ+iWupCeUAvNSrA9HNwqx+muk9nJVNg/CTfrmbAPwbgK8D+PcHkIibjob5o13A3XypWsAkG1cPA9PDFQDZM1id0i1KxsWfOrKnAFXlifCFFMMRcASigOcs2MGAIfE9iWXplS6On7UbmPaUUTXQrgsVMzcRj5Folg2V5ayUA5BWYKwOxKUafnosWjcJwk+7W5F2EKvlE3xcXaNYfiCYsGkA/smuqug6hcleAnAImPbO6YwRpMgjCAVAm/yQmKTv5hNsAf/i7SyNBSl2a8Qv/4/M1yF+BZSYlNQCnnVrpbC+mToAACAASURBVJcaI7sOSEY2NpaDXLqpR+vE/OVksDgImgGgghHoYJbTWc7oJtFWc65/cg2AYvh2ALsB3AzgVv95nS/f4QdsIkT9T3cBrGtITWZfC5hqtQHInsEGQn3UDDvEDEY/ICf7SxMOrAg8T+c00JGkvHGd2DABUYZIAONzCUDppCFhSukCBsLQrFtZe/IixYQpSyEoJoqnuPWrVRAubQh83HNlZB23z7j1ywmj6CIIqUPxw2Xeu9bx2jx10wz4Z7sqTYZaDD8EIDuoE3hMVEphWg66JIp90k0sBxBcy+iPIIaT1RtEsHS/yIAqw+VSNPWQfe5tlVEk8auXgVa5BUsEJuT5uoliAbE5AGotmIAjCPnR9xDG3TQernYAUupTdBGEFMf83OkApHG+XlvTAPwfuyrgSZOhas3u6cwTsUBVn2gTwyFMi8wjHZAA1M9fYGHDULJD1m8Cpa8fRxDad+l+Ykf/3XNvd11U+qiL39SxXevSsshdDFvgbI1O2AwAtRZMZzTBRuDFjxe1Xg8QEIB8yyj5yYIUxfQIkfkIRnmHCM712JoG4FsdgHHp3ACoMH2G6jM4lWzoQarSvwQ6MSB/vporVaFkh+mCLlpVR8Z+dqDZLoDOpHSiQeAFDkBjPrlgCHgCUaFifg67H/9uYjn4Ai1vpTERTAASBaoQJBAKeNqHlL6mwPDZYAOROag/EYRkPX34MwHIvzW9rQcA+TLpI22G7EcQKlJGsYIJhC6ClUMiXfBTbFUQAej6nPS/OuAl9pOOqIc2BLzg++3VmWgIEUz82cRuCAtLIHQQm0gO52uOAb22sC3JEWgRfPpZf2sQBQIgLydPEIFGwPEj8MlF2bSbsulghLftqsCXq9HGgHysznrGgi5qzTUTFH8FLhAUn3hIJwCN0HLncw37qaF2zoYvuKNivmQIuUNc7GvWt6sHNs26twA6vhyq8NEMAHlyntFrDCcQehyaPTl+FwAbXDcmAKMRThakEk8Q8kPg8SPL0qzLBl+A9QCgR6uZGs3vfHz8TtBZvkgGQrEPBVAUg2Sij50QAOjiVKI3saADJRm7dSLYWfSFDkCem/dhZeMy9pPY5QvSDYQyUJoDIK8qMezh3wY6fSL49PcGgCAA8pScJLIgAUYQEmz8RPA17StvGoBv39W24eREiBoNQSgWNI1HBkdgxJSw1AI+dFIbgOYmkjimQ1r6XXC3rAbCHycAgytohf8vsB/r2KRaRq7zpZ+D37HMX0s3DDcCUGLYaw53MJ4YUODzusqlGCQAOQCejuxA8UULUkxIwAmMAp8Wa3qkN/R9W+sBwOhIEPjk5SLr8HeKFbTQfb77csPIMHGl/4MPbReslPhNe4+MiTpi9AFGV4nI7MfvagNQLh/pfrYnDAS8aJQ42A2w4em2cAyWQUuJVQTGWLs1uL7DG9J1RjhA+jvYk4t3KXeMqijpzrud4At9z3XtP16yGfjKZmCGooYh1tZzvv8xXPFl4PoJYC97k9FlwZWD+Azi/deMZWeP13eQCGEyoERudChIjbb3mJYwH7V0QIKuCwj/gfMj0asn2I0FXRSHXfL/iRkNgLyeVj8ccMY//J1fyxzTAXT2+xoQViKYD/1hDqLxPiYxTgSvQrphphG97tz4Slqafnj7uk1kIQDZrvWTw8B3jwEW+RLxPgSiCERdPwPR7+wCPg/gulFgfruDkOMQkFc5x84e708JAMmCuRNBXi4TIg5CGRzGiBGE/D4E/C2r2vcAYJoify62i0aJSMhB+2IHoNwu0fkcjQ85pu3ack5nIBREqneYFyWLkAXIJHESe00Cyx5QyeL6F/tyEcDcrOW2n7fX8df0mME+/vQ/PQjhoy3gzo3AISYf80MQaQx1peH9wb7v2mrtmCBkIMMejp3jIJD1MsaxaMZ8v5N/67INAsB3BAYU4JL4DSo1J15AFPAEwuQHZJzkKfUAtOHLJSOQRWndBYQvCQA01cfnNopfsaCJaD2baBn79QjSTiOEP1EcawIpkq2kegBTNgHWEpOKF8Uwq2NRFPM4AqCf46/rA2U9/uVDvurB01zvAJpiiwOl3fEeciCGF+Ij11f+QkbSfMPfIzqw57mEFZ9Dl3Ps5HXWAYByHJAJKV7N+s0cCQQhwSlfm4lGZ0KB8C/rABgZUS6ZHITBSEhCowUYAAksF7cStWREyxRwtuPpOlgw+5s9sq6OaIJIIlUgEhA1edoTgHxa9HVw5jibZNF+j/9yGQA/7pbujZ4bwv2+cWB6tFo0NzYnkxFA+cvEAo43VBoEo2e+48EMXEOmD9F6xhCE8RwZEJ80VblKvDlmzwicfqy93/o+8K8TwB2jVSgW138FrJQTXBNlnJgmrjZwanow9CBP/rL9wF0jwAGWDtFyoN9PHutnIHT05mPXz93dMGQAPniJsjiBXiTbxDZFMF9NLUPQxKR5qezz1Y6/YZDH0D6GkdAkYJIvRalAdHAMmPZoYhb6NhDWvEyf/ma737CXN7R1ZC7hUbPgcFgqt/ZZjADnM1xqEVhYBpb4CUk5UsL7jQvj///5buDrLeCOEeD+YQchYwG9VIfyg1NaZszFiCH6DkRGLze5/dgk8IMWcMCjdCiCzR8od1B8OTwvJM8JEShFut1fzMhi+eRJr6LI7hYP2M/xVLwKNoZjUTwRMAQQmYyhWGQxsSADOflZ4kukj7PhZ75bETjBpkAGahMkcrGgwhsXeCyBHBj1wmOBQwvAwqKzoFeRV8ZaerjKYAuirmPY/o9X7q5Cyr7fAvYMAftCPGAEoYlBiVtFwLjtp2U4irj7yOANbi+crHyrfCbTquJV44O0F1FrwQGIMZFqdQDyP/gGSZ8TC0ZRRsOlVzzgasd/u+zpMByLehAfCgMQCDyGZJHFCCgLZ2f8mgI5qauEcVx9e5vACTgCTwEMWr5TdIpWKJb5MvrnoocDswvAPAG4VLGg6UKeqmi4iuDz4er30oX0FP7u5moMvIf7W8B+jwlUNAzFnlZCIhvGFRCeWzrgXSSIBreXTFZSgVLHAp4UHOFuociEEsn2PJwl/XEk0dzfSojeerFg1IOo5BKAveIBex1P67lgUzgWQaJwLAKRH04i14ItgDKEtGsRnWx49b2Vkk9wUefTGrKCF7R0JxZMqxN8cmPAxWcAcxGABKEAKPA5u9lEaAbCmKMI+sDN1X3z+ro24wEZFc0VEE64ABgT180PF9ZdBcDb6JpqcPtPk+1ACbmKjJnllwyuILunEAWjZHkBsrsRUnfD0qEiC5IJfyisgMhzWhcP2O14Ro4WbASgAMQJ48SJwchmBCDFa8qpyBbSP7OvU4PQ0p2W7+LSnSJUFOrI4V7w5IoBTQQTfJ6oTSYk2mQcpGRyH2syGjIF6EM3V/fM++C1CfwUExhCsmzCaQT43lZC3e1hBpEHh36XEqrB7Scmq5dV0XZxmV8WuDFzAF9iwhow9seAGoBcGtKjqAc+1l9rLb/1igesO55ysmCrC8ei6IxRMAKTWNBi6Xw98xNTFUi0jEcmpYgRAPhddpVi9OIEPP5cYD4CcLkCooHPwaW9kV+iwWrQHT8uA1fd3F7DFvgUHUP2k8jTiogAqLoxFpDgbMj9jXSuN7i9dLIdaxzBp5XVBMIMgFEnFAPKT9qPd6A9BIGI7MfPmf4U+40HzI8nWgq2PBxL4FEkjKJixGRRFyQQPzzd1iAUzCAQas1YOmAEoFjwkecDC/PAwhKw6CxIkCXwOdVJLxTobMjBdyIgfvimNvNJ7Evf4jWtdnRYD1YNGVuG93VWuWs4Jf+mlZCCZxwP/cnJ6mXVKk2+tK8lQQVHRTGc64SDAZB3Ey3JcxyACkToJx4wHl+YwqloGDICmYmTFgMQFBET8yyYzyAG/AfWX8mCGQg0BTRoHwt9KVaPE/HQ890AIfgWK+CRAaMRYnVdxHbhdY8Wslw1V93UDsmPIj9GxgiAioRRMIJNvoti+SW/Ikd0gwAU8+XxJcbGITJPDvI6XdCFREFSknTB83xka40H1PGF9dnycCxFwygkK0bASJQSVAbAYeD98xUAe5U3jKIwBosSgNsuABYogl3/IwgFPrOIg1Xc4ZrpAsSrvruykl2ucykapkMMh4CExD5DwJfWAYAxwk4MKPAJgOIjGSEGwuCakRhemw6Yv0UUwRf7L00L9pnsNx6Qx4feY4O8pDEcixOjsoTKKpMYjSFYYjOC8Eq3Wnnr0YYS+0Tmi2HysrPGLqwASNYzBnT2Mz2QD91laxLB0gs12GAh81cf/o/OcHyJ+qj0S/zxnhUZbSyYWaL8+Rq2S29wowiWkJPan4MvgrDDGAlRe7KIywDIgR3meEDWg9HbJgApNTkXo8o0i7oVgxnEgFr8F7jEdnU5GvqfJQKQKyEOPlsNIQvyvupAGHS/Okv4qv9oh+PHxMLk8ggBCRxvAmEN+AiEzz2iQfQBeNmkh4K52hJBKOaNe/FSLobLRXCz43rQnu2yi9oMSMDxs2jo8303ERz1wsCGZECF4kd3DwEYYwJjhoNlQrgIjlYodbBPrwMAZfEmyzcIv27gs6XDzC/IR1DOgA9a6DRz4wZAsZ+LYXvQYsHoD4ziOFklna6YD3+nnU6dZ7bGDAcBUImIAmEUw/zbJ1i/scGNDJiLXmle3RhQ+l/aq57gUQCWzwwBKPeLsZ/LFrGg/ShRXAe64Ajkv30kALAjF8R11Dy3K7KRwJcsUTaqWScARou3w/INVnCH+A36n8RvM3nB5XP4oD6DATBYwGb5ajlOLOh6X8JaBKRG77+7ygGYp1bn+V25/01AzBnwQ1ypanD7KWfA1QDYC3zJIj7KgOUzc9nFbetX/r+O5biwNhyX5uSEDr5o0xsJwLp8/m4A7GaJUv/j3/5+HQFYJ3oFPPkho/hNeqBcMkcB2BAA6XrxmMBkfFAci/m0JpwzXw0TXvXtzrz+PKc/Ml/ugzM9MDqCAbz/keVjjGcQA/YLvjoguo1mRslRI6RwfsiA5nqhL5D6nscF8gfTdfxpS+/hLzvWfzMQCoB1Fq/8b3VWaPIDZqsRV64DALsZHVHs1gEvsqFAeBSApQC8pHK90Oql4UEAyvCwNeGcBXNLOPMLftgZsI75ouUr9ousp2TEyIJ/sU4AzC1e+WIFshyAHPZREVwItrrD3wGAhibTYBhxVpe/xePyrNBuWaoNp3DgFwC81O+RAepK/a5Lfe51jxr7JwA83nPXYgq1asl0yX5N48+f4VEGLATlK1vAo5YB1gBSRmsM+NFE57lcfPD5pPFWCJImtyvGgGfOAacBYO59zFglgHgPefZsXV6/gPXBYeC0RVgyJNOGYuJjPka9eHWgjL9bWzhWk0/n/wPn+k8bgFNmgYcsVflZnBRmIShtJM/m7JGibGBoOIIez9wKPP4AcNpylfbNlGfdI+9NjBjz8JVzppckZuJ+dBw4aQ44drk6j1LIY9JkPD7P4s2lwVEGLHwJnncscNIh4Nh5YMsSsHm5ndOu1BGFThJ8/K6JrZtoslST2+XHA6ftB05ZAE5crgAups5TfaL6EF+UyIif3gAcOwtsXep82eIYY9JkXpMgMp/AeZQBC2b8OduBYw8C2+aALQvARgJwGZhY7swEzbNa88IRvAVO1qkF91J36DNOBE7eD2yfB45fqphLnevzdGeBKBfL8UX5/CZgyyyweRHYsFwxYHzRNK6oetSBMDLjUQAWTPqPngpsnQK2zgKbCMAlYMMSME4ALrcnR6JYQIwsoUnjpDRstOLy7cBJB4CHUGwuAtuW2nUDVH1EFUhycSwWjGD64mZg0xywcaECoI0z5P3X5P6nWlHdgHgUgAUAfOYOYMtBYNMssHEe2LgITBCADkIzSJZXpCOnIg25uPrhgnupO/TyhwLHHwSOmwW2LVSik2pCrDsQskzNIBGIpBdGI+VfNgMb5oENCxX4yPRjPj4xaJ0+WGeEHRXBDUz2Mx4FbDoIbJypADixUAFwzAFI8KUJChMV2SUaAGc1cE/xFJef3FYRti64nkqWDrqqEhbrsm5zvZCdPCd8nHzJOLZuABRz9hTHZwPL7LnLnoNMIY2VyaKcjtZLHOAbNgNPngKe4BacfGF1pnydD+hphQ/8XV5UiEueLGnDN1tWXj/3/4cTwAUzwGPcRcFJiDpPt3FLmf5vjwE2HAQ2zPrEzDv7OQg5OSM+ScYQy5Xbo8465u/ZfLTJ7fKHAdumKxVh8wKwealSE6inEoSy2MWCdbUHIghv3AqMzwHji9VLZuDzD8cXxxWZs5c7apmW0fMBnIHKn5X7d6I5npvRz94O7LgXuGIReJSb+Xl1tzqflybwRwqf9i97BQRWomWJQ7oZVFtJoqDX/b/oGODsvcBTATB9gsfGqmzdjtVz+G+PAyamgYmZCoDjFE2anCVg1CeJwOMnTRB/DmUINVkkgia3y08BtkwDW+YqAFJFMD1VAAw6XG61R31O9/fdrcDYPDDmY0zjc1UjivBuAMx1QdMB+WAYXU8dhEU16dOSkppbcHFSrng8MHwnsGMPcN5ypURHp2xMIa7zDz2z8Gn/kVe0YomO0wEwBYKujL7v/zHA6C3AxfOVh58g5AsZxx4fZM7sf3h6BcDxWWeGBZ+cMEFiwGEHHRnDzun7ONHs/djkRgBunql0VDOSHIDU3cxSD4aEajhFXS4H4S1bgVGN0V8we7E0Fh9jVDG6Obr1LJMRwn+kOCaTEYT0dsfqZHXl/p7PrLi9wIY7gO0H2yAgCAWCWCowKrYE8nMLn/a7PQn9X7zIJPPkCcK+758y7x7guNsB6l98gZjLLYet3Ay5n0sv4R+fCYxPA2MOwLEAQLIDPyP8uBg2cRYmzFweAYilKkn+OC8/Fdh0CNhEA4nGA40kd6FES13WLO8v1qHKAfh9B+DoYjU2Ak/js/8NAIwg7OUb7LCC+WAfB4CpBJoIiTRNRmS1l13kqWh3Adv2A8cdqqp1MB+aIOSxWv6pq5D2kkIAvt8rF7BLJksN/jMqfa7v+7/Ak4B3A6ceqpasKMq5akAmlLWY37t8ZW97PDB2qALg2BxgAFwANEGcnI5JcrDZRPlkaXL4u1KJUAfAjbTQ59x6dSvdLPXAgGYshZWR6JIRaXB/NwFI8C1WwLMXzMeSwLfcXuKrA2G+wrLCDcN/IIg4ERRn0qvyySAQX6mG1XuA4fuAbTOVwktRRr2MLCoQyvEZ/UY/WwjAj3jtFJZkU79g1ghkgEBf98+0Umb/3A2M3lkBl/fOcdMok2EjkZyv8773LAfgHDDKjwNwxEUw9yailpwdxBAEYhBbAuGzG3aKkQEJwAkCkOCjlb7Y6SYyf2UwlAS+vKYnAXjfNmDEX7DEfA5CjUcsnzvbu1nDtUMmCDkRZEEyGdlAk6G6lQTSa6m0MP6HuY73AxNTlcJLZ6WOJYC5/CNxLpHMgdKIKNl69Qvu6/75AjHOiTU87gKOOViJb748BKCWrnK/maTA+58AjM0Ao7PA6Lx/xBAupoYDC9okBRAmPdBZ47lNA/DhwMRsxX7mPgl+SrmK5EaRNRslXFQ9CKB9DkADn79cZtkHFkysJ103eBbqlh97DpmTQTYgk9VNxu+xYbXKU3lhFoJPOgdFGY+lPkgQxokkgF9Xgj4AvfoFs84eX4Ke9x9fIC+tRfDxvvniif358sSir2LCj5wNjBKAc8CIi2AxxLCzIAGY9L7AhGIKgpATw4l8wToB0JjPrfTkp+SLQbHrOqm5jNyajS6VCMIpApDAWwQ4LrGgXqzIfnq5cv0vN0ZXHTInME5GBNLb1DGdOYQsI7AfGKFjlgqve8wJwG4T+fuFAFytXzCLb+VgWnH/fIGYfc46Hs7iHC8ZkPcdXx4VfVXJw8+cA4wIgM6AHSLKWZCTESfLfg7WsIyRF3ckiRQ+HACXkwHptyP4KHrpJvKVGnOhRF9eBF9wE0mUEogz2wC+WGI/vVxiQQIxAs9+rmHA6E1YFYB8DJwQMZl0OrLZ++i7sfT8zroYHLS9df4RACWKxSZvLXzG/fQLZqk2gqn2/vUCUQ9UZaM9wDaPeSPrC4A5C1KV+NITKwCS/SiCR/jRBDlLmP7nHynsxno1IPwJSyRpbiMADXzuPDYfZfBTEoAmcuVQdiaW0zwXwQsCYDYmMaDA1wG8TBSvaoR0G77EcGSET6hjOvVApfRPAUN0zjr45JzVcSqiTxD+VeGzXku/4Nr7JwDJOkxFIwt6j6+RqUrlkO4bXzp1gCAAv04AzgLDDsBhKugLFUvQUhTwCEKbnKCw14HwJ9cDgGQ9WegRgDI8XEcVEDvAl7lVlglAgi+I4CR+Zf1mLGgMmDFhBGFfDCicRJFERviSABjLS7FC0MFKMU+07wOPE0kGvaoQgGvtF9z1/iODkwn3VWoEXxres5ib9xx1wZufBAwLgAQexbAD0JiQwJOuJBA68/H3Zhk6+3CifqqwWNMKN8wjKgbk6gWJgC+FMaBb5vJVmsUbV2vCqo3cRWZcCIACoax53+ulkqNd7iqOcU1WcC9cxEm5kQBUdZ+sTnSL/jEtTWngi21jhJNJBivZBukXvOL+yYBkcOqxKjJ4AGgxzMrBVwdAMmHrZOAYF2l6y/mwV6xD17zmWo6MbRyeWtOHwxJ91IIhr6rqZS70DPPLXDVUrfBwzHKr1EUp6/h0T/6L/GcCqslt4IhoTcwdAqDSs7I60WQH6R329pHuFyuXDJmEjuOSbdB+wSvuP5bGUjmsA5XoUvcvBXKKAQnApUdXwah0b8jXR2YzJTsC0ZHB33FL+2yiX3h/1YeD1fFZGT81g/H6yqkVa9YEpqMhTADle8erHA6t7Mh6j4ZBXdBGjFyO4CSIm9wGBiBvgqxwIAJQlXIyEJLyI/i0SkAG/FbhaEr6BXfcv+5dLKhCg4z1C1HEBJ8+BODQGZXfk/quAZC6ketAZEQCTWAU8PIJt0fgwHzZvVWNaKqi7JLOmtDWFy42g1FxH/XfqGkII0C+a0tnDkfsGxQjn3VPsk7tXmuy+Xp0JhtoJosAaFcUAJUYKiYJxcqHqKAH9rPlG2cMrmCUbMX9guMLpGTcCMKDlZGhMK8IPnPIn1X5PA2AwegwEEYmDGBMjOI5whGQP3NPBT7VJlRNaKvF4t2IWHbDErtDlSk1p4lJ7/zd246tglGZryIfrFhQ7pU8WCAX0ZENG+57U14Z4YrCeLrSxXdev6TfLwrbxT7znMrfKQXfHLQCnyvmRIv0Q3430ezMmL98P393G3wqz6am1NYzzoGn+svqRmTAU2citctqAX/2EI8F9ACEmLHXLZGoFxtSl2xyK2bAYwrj6Xr12+1noL/jUTCD9vvFrn6u0v1/nvGkaoVBAQi0eummMAuXQHMWJAA7gCixG8U0gFfcXdlBKk4Z6zELgAJfZEKrxpC1xOIl/+Sk7jkcdYlSco90y9+gK6vJrRiADD0piad7RuFo3udNCgft94vCdrGXn+tujgV3QAcHLcFnroelivHkchEL8ue0uQ74S3eubAITS3IQhKkMRjBMokgWG3L//2z3VSnP4VDgQWxUEEUxAZFHL0eR3HDfm3IRbDHkBfF0zy4EIKNhSvr9goGEBdvTz/MIYQLQdVsTwRTFDj5jQmdArRDYJQNDSs961R3tPhx5NXoVgoxleHnarjohgLec3D2HI492yQNvIwvqO9fJm9zKGbAwnu6FhaP5pFuMg/b7tTbpBdvTz68cz/zI8azVj8iAHTqgmFHXDUB89R2dtaC7tUGw4kDOgFb0R2wYRDGZ8g9O8aU4XwPOczhiwGlMjqqLWiFYGu570wADFsbTvaxg8nkow7E8nM/atfKzln6/1mS4YHv6BQ4+Z0BbqHcd0NwwYbVD3+1yWhXJxPBrbq8AqE/XApSqAxiBV2MZ/54DMOZwKE00rnDUWcR5KiV/brjtSAMALIyn+/mCyeehjIYp6fdrvVELth8RAClyHXxmhPi6r1m8FM0ucgk8+y4RHC1kAK/5XgW+2hZYofafWcPq1B5AqDqEYsQ3nepR2gqhV2yiol1COkD0C+aOaoGx4aL7DQCwMJ7uVwomn4fm7VrX2u/XAlELth+5sHPtN+l/Ap6sX2dCsZ/phZkIJgv9l++1wbcq+2WFv2NXIjNKAPzuw7MUAV8DTuynFIEsQy83RgTAhiv+NgBABaQOGE/3mwWTLwAqHnaQfr9GnwUbARgDNBUlkpzQboyYCyYDYdILdf0l4NduW9kGoa4geNdazLElKoA3Prx7DofiETtC6XvE7hGEzJlpcis3Qgrj6d5UOJoYDcMglrX2+y0NPtl5UZUjkfx/Hqbecoe0OZzdF1gHQrln9Bhee4s3f3Zxm4MvAk9VSFdUIw0i+Q2PaBtISiBSSFgCYMjMW00MP7pwvvLDmwFgQTzdHxcOSGvBg/b7ZRZByWYAlOERluKM3Ra9CKWc0q73dTBhMFT4ZwIw9l5Lrpes+HjeBiGCUOKXeuBvPcKTiEIOR0f+RhDBMYi0Lhea4GTaa5NbOQAVDzhgPB1La5RssV3rIP1+7yy5OAADoAchEHBkFbKfGRpiweAPtMs5IFNokyOGk/7rAYC9OhBFwNXVY1at5tftCBHaWVS2AJdEcEinrDNC+Lumiyc1B8AB4+muLARAXTDCWvr93lR4/Z0Xt6ODFQkj8WtumEwHTKDLQejAfN3uds/dfjoQdatGLxb8jQBAYz6/boxiFgAVudzNIc2/s3xLk1szAORoB4yn+2DhaATAGJCtbpkCYq9+v4V+aBgAQ4i66XtaC85YkDog/zdZvzUgfN1N7a633Xqv6fe9msDIHfNaB6Ay2JRE1AHAEDIfI5nzZCLeN4Nbm9yaA+CA8XSsul6yqV0rJ2WQfr+splCyCYBR/HJyKX4phs0PKBZ0lqOYTpvniAiUAmAd+HKjo1cvDjHgr+3wPJQsVCymUZrPMuRsRBDG4AQCsunyJtFGHwAAIABJREFUcc0BUJlxQoH62q8ST8cggpKNAFRGwCD9fkuvbwAkyGgJE3C+Nz1P1q9/T3F1EZBxvZh50s6AEYC5yyUHXt5/Q8zI5/KrAmAIkkipkyGPYwXz1aRT8v5ZO6jJrRyAvKOvNXlLazsXs9bo/ztc29Pohgotp5J49Rcj/pzfIwGS//3OM4CNd1dpntQpFUmjEH4LYIgnyn/OLjL8FeDGhwJbNgFjI8DIEDA8BAy1PFK7FSKf43cNKrvHx+8C/vmxwMgmYHgEaA35J0StpvvzL/nP8RbLAfhyT207TChgDRiu/ZL9DsfWNABvYzbhCDBKoBAk/pEobGWTqp819hzQ1/0k0PoaMDEJbJjxVZFgDad0SaUO5LksWVj+XScDmw5UEUDJ6U4d0nVbC91S3ovfVHp5al64cgC+k7mZAP768KCA0WD3A/ieLz090CDceVmlAuhBljLgrfcAw6PAyDAwPFwBkCAbItM4a/FiNtERjBl76W9ffD2AbwJDdwFj+6syImRXrd5Y2FjIYcnzWPLEqnsfC0zsr6qBMQmfIDR/pyJ6xMhKyMrSDiKD2xja6TADTt0/AGAs1KcAUCFrOLF6tbtiRVFavT/wuMCa7MfVTlH098YBeBcwNAIMEYAUlS4uBULOmK3LCnwOPANlEIOSoF9+C4DvVoWXhvdWZVOYqWgi3vOXDUQhgieB0EElViMYJ08HxqeqnG8D4IIDkAzo51DKQQJvBKUmKACzbM4+5hUivwrgiwC4LzvjmgCh6nBcgiMTcv9Abo0D8E6g5eCjfpUA6AxoQIzgi8ALmWwC4z//DxcPPwBak8DQFDB8yJPpPZHeGCyC0KN5DFCByfh9/+OAsekKgEzCTwD047X0SCPM1IYQjCv2E/MJoGVwUUQoPboq0MdqkWVn7RtDDMahB4g+P6qhXFpjVtkDtRGA2nKjos7IyOyHFUbIrXe0FXsTuzIYfNb4O2M3ATGIYQOmPn6hG6gi3eUkQQAeAIYOAUOzALMVh2pAlESqGFBAXAYOMQVjxll03iO/yYKRAT0FQXkwZkjp1pz51LO2XAT3KtD3AIAwj4Wg05kfiuUHYlsXAJLVnP0INLM0OYFx78AzcRySeTsw2AJueI+Dj2Fne4EWKz5MA0MzDkCCkAByUWqsJzarEanzj2zXwjEGFHuGY+pYsMojzZL1G9EBexXou339IRBrC3lJGmNDuSHX+w7WC4Cm6wWxm8DngLTImgC8pBcGBuTXf/1fXnyTugnFwxTQOgi0CECyIFlsvvJfEnh0mhsYI/s5uxFYi1xZof7oOqSAawwYjRGBzYGXbtWXaCIrlvHUagX6SP/ruMVYCEbEqECXAMjfree2HgA0ESur1/0vtnNwGSsG0RsZME20/+/XWH6Mugk/yngPAGy5GDYALjiIHIgRUIrsZjM7Ax+BSx1S4pfffQVIep8dL7dMDsTGjJB+CvQxTHmdtrw4l0CovFruC2NOe975egDQsCXRK/eK634JhBK90q2C7I1i+Gt0jxF40k1cPJAB7UP2m3MGJAAFQrGei9iUTH9yBUDTHfU3B5+BOIKQ43BWtNtPcWIOzEZE8FoK9K0DCGNxLi3FqaKA9gTgeoFwPQAoI0OulWT11oEwiFz7cwbErzNxWtEYBB+VY76Vh4DWrH8IOoGQ7Ocg1CqMRLPltmxvs1/SHaP4dcAJePYyyUCRIzrTB8tE8FoL9DUMwl61kQQ87Rmy2PS2rgB0a1ci18RudEJH57OsY02y/+83/sZdBKr4FXQTApBvprGgQCg9UEAM+h9F6ugJDkC3gJPBEvRGrYoYCBX9IxEcS5K4i6cZAHIw8oXQ4mLBb35YH5d7OekadtTV1UZSjaEIPH4nQzYNwgjAHNwDuWGYpZc7lzPfX1cQur5oBorfzDf+zi0yVTuSkuxBI2Q+PhQDIUEnMLo1TBCZLufGw/ixbQa0KB8CTODjPohdY78IQmfDjmW7Yo/doAX6GqIiAtDHaYswSmeMubV81kp11L6hy2PdAcgblfslOKC1IiKRmyRxZgV/8++DS8BFrxXi5Hd/U6MeSKdqEsEKhpBRsgRMbAtuG4KU/+9ry5brzP/lPVMv1EPOQegharrVcgZUhVHFxNPcp9VFtlOWkL437C0WABWypFRGsV0sb5Hn2zYBwvUGoKl10v1knDgo0y7XA8Pfv0UACnjaK33Co9gJQAOe64FkNvtZAHQdjz9v2Nz2GSa3jYej2W3KGuZ9ixGdIVSoKT13B2s5AHkGheST6qn0erHv5AIgAAU+LVfw/wq3CEAV7clBKDDGZG9/5oVXx/oyYARczcqH5GyH8eFplTawFvAtrtXLGpNrQDGbejupB3omlIHQGc/ErzOcGSRs8zrhAbbuL1Tco/JfbLlNwHOmi2kIcs3owbdwNpYtynDQhsFcgvuG9/YapGFvYX22zZcAU0/GwA2LJ/4AmGF9mwEbBu98Y3cMF+uAGQCj2HVp3BbPuo3IlqxAy5wHAq4OfARmEBXGfNIBa0BIsG0ecwC67merHgRpZLwocrWaovuTxew/V0txJQ2DWeae3WAGbdhb2DB4+wRw7w5g8Qpv88liyGtoWHzMi4C9fAEHbBi8kwUKu2xNAdBxaGBLbJdZux1LwAGECYAEm6wyfpelJrEgFnRDxESwgyUxIUsVMwjVy5AYO0bG89Auu1/5BF38KqjBHlUAYXsteNCGwTeWNuwtk4JMkrlzGNizA1hm69g1Nix+zDOBW0aBeRZZGqBh8M4emfWNADDT+zqMjQyESdQFHfDbZECCLRgdHeCTe8CBaKJY1rDnBRCIAuGW4TYAZeFG8ZuMkGiQ1IEwGCJtHZBmy1obBsvVMnDD3jIAerti3LEBOMjGcOpa3WfD4ic9t6oveDtLfw7QMHjnH6wPAybW6yaG4+8D4HIQfvtDIVtLejpBFsVvUI7NIBHw3DUjRzL3rDVtsYPOkAScuX3coNDynT2VYJCkn+PjqvUD8hVbS8NgjphGxcANe8sAGNoVY/824BCBtIaGxRe8pLKZdpMkTvXiJ2toGHzSNHDPScAyq3er4qPyGaNc7JCRXWLT2TjwGmCOeQashq6+qSpZmp8vojQpheF58ncdZVjLnjWPHr4VWKTKxrHGUqq97qXu3jp0wPy+eEC/DYNZsZAO6IEb9pY9lNCuGPcNV830ZmkM9dmw+OKfbdcXvJMPdY0Ng0/7GnDXKcDMccBS7MwdKz8KCAKQIgY0MWGCtr4TOHAasMwOkTqf6unyuLykfd254nkb7qsw/iVg7jhgmSX31Vpd9yRHeLx+zRhjEGRbB6wDYT8NdymyubzDzCCGfpMJWfSRYfr9HP/aMgBm7YoxNQHMbQHm+ID6aFh8yS93tAvGQb7da2gYfPoXgbtPAqaPA+a3AEubgGU1RM6B060fgkRoCzj+TcD+04CFE4BldZdRc4/YxlxgjJMewSiwN1zWfsOngdljq3EmY08vm5i/7j5yIMqpvupKyGoNg9lngYosl9wY/0dZdrMzYl8Ne8sAWNOu2MA3zw/F2CoNiy99XbvftrcLriz6PhsGn3U9cM9xMODObQYWCMANwPJ49UliuW6SaqqBn/gGYP8pwPyJwNIxwDK76ahDeN6uXYCuYyABkEza4LbpY5WEWdSLxjF26/dQB0SJ6r4ByAN6NQxmkWcqrnQ00x1DEDJFjR8CcNWGvWVPp6ZdMQ6OVOCb3wAscPJ6NCy+7PerkP5Q3tBY1PrT9tEw+JwbgPu2AlNbgVkCcCOwtAFYcgAuiwWlM/XqDjMEbP9t4MB2YO54YJFMo/5gHIcALV1TRZ17FXOhPtvgtvkqf9H4kvHDlyKK4l6VzvVSBF22uwjOb7pbw+CfcwBSkyeFEHAUx/yw9JTyEbo27C17Ol3aFWNuAlgIn9QxO2tYfNlbK6MvaxeMRYquvL9rTcPgJ30TuH8LcHAzMOugX3QALo21WXBZLEHwRF1OgHS2eOgbgIPHA7PHAezNu7QFWFZ7JnXJ5rnqxHEulvlzwyVNN3+wern5Yovl7SXLGwvn4riLWO4fgMRJXcPd/+pmOymELEhRzBxJAo9gVL4kwVnbsLccgHEpWi3epocCAMeBRU5eTcPiy/6qtl0wpvhA+2gYfO7NwOQm4OBGYGaDs+5ExYDGgqP+ccAkINaVpB8GTv4d4OBxwNw2YGFrxYCmV0YxLNYheCXau7EhV3ga3Lb8g4+R45uoGLADgHWqhsBXA8K1AZADyRvuvtkBSArh+i9DsQhCOtf0UUgW/7aiYW/Z0+nRrhizoxXwFhyAi5y4rGHxU66qAFhT3rDSIVdpGHzencDejcDBDcDsBDBP1uX1CMJRwFiQIBzxieL3KIY1YW5MPOxNwLRb8gs0aghAss1GZ1O+SFHsdRPt0i/PLHu++dFb/x4mXfhcbWxhfCtYMFr/uWvKxfDaAcg7ipPCvFOVpuo3HrCjYW/ZA+rRrti6TS6MVQ+L4NPH2nx698GnXF0BsKa8Iab4dFZpGHz+JLBvApieqAA4J8CPOQuOBBAOV0CUYbIskRkAecrvAdNbXc/aDCxSpyT4CEIyTgRgneiLIp3nP6fs+a4A4N8B8/48CUC+ZGJA29fpuLmxJW+5h5kNFg2jiWHSi0r0Uv4pCoZsxw8DUfnhd4Vk0XGdGvaWPaBV2hVjdjgA0BlpkQ/K9bmn/HOVqtClvKEBqlfD4AtmgP3jDsBxB6DA7tdbcvYzJvQJkii2n4NOeMpbgJktbYPGACiF3wFoEx1ZMNe/4jnPLXu+KwD4t/5SO/iMBcXuesHylyACMBPDgzGg7opM8mEHIGdwrfGA1rC37AH10a64Yr4APvvOSdwEPOVbKxu+K2pdKRTmdI3dqkPPVgbSTBGAY8AsATjWniBdx0QxJylOFCcr6HBiw1P/CDgU3EgEIMW52M8YkLolQRddIN1AyKWiBretf9MJQN6HsaCPxe4rvgDdHOcOxDIAcmDFDXvLnk4f7Yqt63gEIB/Yoj+4p9xaAbBHeUPM8qF2aRh84QQwNQYcGgdmx4C50WqCFngNsgSvQ+Dxu4MuiawhwIAXVk1O+e/A7CZgThY1dcno1nHL2oDIyZULpBsAFTBZ9pjT0QQgn2V6ufRicS8QRgbs5ZYpEsENDejBfpoLrwAOjgIzZMBRZ0AHoUC+SOA56xJwNlEyTFw5FxBPeWvlzpnbANCdQ1eSGTRybMuydgMggVBsKmtYoC6Mt8znZxsZMLzAxoAOvsh+ydDqtXx4FIDl8L/omQ7A0QqA82S/ERdTI22mNfaTuBIIxR4BhKe+y61punQC+MytI/Zz/c9EuvyBeetLAfGZ5WOMZ9j2/gqABB1fMLsHAVBqhfTcyH5d9MByEdzs+B50Z7voGZX+NzNSsd8cwUcG5ASRKYbdHRNYwhhDIHRgGmO0gFP+HJh15jOXjnyKblVT5Cbfoq+yJOszF8P8+VnNPlICkMAzds/YLxlYznrJwIpO6egTPMqA5ZNDAB6iCCYAyYBcBqTRQ0e4630SxZyQJQIvMJ8mSeLrYe+p/GzGfnTpEIBy6US/out+K1wg+brs88rHmDOgAVCMnrEfxxMte1Mt6j7u9zzKgIXzczEBOJIB0BnCJoqgIfDEhM58SWzJEPGJe9hfVH42un/Mfxl9bgSiBySIBWnAJBDGEDAB8QWFA8wO3/a+wH4+rg4RLPYLul8tCI8CsJmJMQAOuwFC9qMI9g9Z0CxhZz65K0wfFBPqu7PEyVdWAOTHVlTcpxhXHZLz1w0ZA6EDLhkCskRf0sw4dRYC0PQ/vVSRAYPo7QCdj7GqVOSMeBSAzUzMxZcDMwLgcKX/zbv45SQlHXDIgagJc+bjZBqAWhUoH/Y+B2D0J7rFa6LYDRmzomsAaOeKqxEvbWacHQB08JkRIteSXiSBLYJOLB+X4xrzAzY7vgfd2S4RAKkDDgPzNEAIxMASSWF38WsgkuXLyXTRSRCe/DduSZMBMwe6ObTd8JBj24Aot07uDObPP9XsIzUGFPs5+JJ/M6oT4buxHv9X7BeY8KgOWDg/Z58GTC9Xq5FxTXOw9c3Cm6k5fPcjgbHbgAlvVG2tH1T3Oavoq6BlniZ+12n5u/2sDbOvasqoFg8x2Lnbcd1GdhSAhXN+7qMrAC4sA8sORJ6yHwD28z+Ft4fdv8UyqUDrDmCEBcpZ39kLS6aq9l4D2rLb/KYsFTPWdfbvh86vQu2s1K/K+zIjTsXIVQ9a59Egs4Y6sZfIA/EcSp/jEXv8BWcAhxaA+SVgSQAkGAMICcwVlNLlqTc9Gbv/HAA7MrL4+f1VlXwrUq7SvCoyGcrrWpGhuur2fNGYwM8YT67hT3s1LaZvqn5MLM0bzmHMmIFSgdFNj/mIBct63NhFZwEzDsBFgpDPeanNgATfCtGsX9TIKwNrg9tuVkhlng7TI/YArX1VkXKrEe1l2SynN1RCsFJsqnQv3UIMxhwIRjU5AGN9QUteVz3BUAvahuNgjC3HxLAND7nBp/cgONXF5wCz8xUDGgCjKPbvevlzcKUHH2ag6cnYzepYBB9Zi2FxDJdjoXJv1WDFiLJ6MKqKZUzoQFTfj2HmwTKcTpVWvcxHKm6kKgoORAEvVclPD6NdzLXpMT8IYNPcLV7yJGB2AVhYrAC4SNA5AxKM9ryDPE5fs6eeVKWGZ2M3S3MQfEyJUKV8L1ZpJXpVJ9pLilmlAxWkVJHKwIhjjD9TtVXVm1HdOy/pJiaMFRWM+bo0rWl4yM1N7oPhTJecC8wRgAttBjQWdBBGESwgSiV0Pb9DRgu0TY19N+M1mRKh8niqFx3rRDsLqjgl9yaGXT80vcL1wnE252PAZCzAHQCoiqoW3yYWFIt664fUpKaREr1NPakH6XkuOQ+YDwy4FMSwgU8GSRSz0UJx3Vx/5vFNbrs/EiLRY+v4ACITww6iJEodQKwBIyBRv9vwhKzUW6z66TUGEwhDS3ezqusAyNxnJn8xa1KRPSFts9YfFB/QDZcAm78CnDBT5U8rCqjfc3yh8Gn/hGd/MsKf1+QzYJ4891Jye13iy1cAE9cDJ+6FpYrEkidxDN3OtXR+FwBGMezoMmxJLOumAuD4J4rxJrfdH/XCoLGFVKiUbw+LAPQqWWaMMLrd6/+JycSIm85w9lOpt1j1MwAwFTiqAWEUxeYH5ENn/jInUVHeMXQ/f/jRePvCa4DhTwLHfBc4frGqqaNJzLPw6iZxV+HTplFGvZrXZT45N39+HW3TujlZv8D6fp8HRq8Dts9XIOR5YtakgBgdrrrt5Qsq8Ssd0BhQ4HMwmVitAWHAY/LbLDQNQDaTVJ8Q6W4qVB51OOqDZDPVB3TLOBepW5jmqaLbec3jGgBGMSxvvemDYkQ9GoKF1ShUCSKCqBeQrvmfVZPC1keBjXcCmw911tTJ8q5XgOLaQgA+x/OdWA2EGZ98gbjleTHdQHQN+2iwls3nK3/Zhj3VeQhovYzdxmArSwQgDRA3QiSCJUrTnjfl4KozRCSCCeYmt90EoJJbVCk/1+FiCwFZxLk4dRfLFia6x8LbYkD9v9cXtLG6+O4AYQRfrgPygVIcqyhTXcWFOJH8fh3rz7EKwnUArq8mcGwK2MCC1i7WY7Zenh56feHT/jE3yliE4TZncd636gPFCKWavGhcRx2J+cvs9MlSw0Ty3cCm+c7n0G0MExdW4BMIbTXE9UCynvyCCX+Ovm4gbByA/xisVgJPpXrzLj4EoRJjJIZrWHArS9iprK+KcefgiyB0XVKGjOmCmW9xhRVMUSyRFnNeFGEdI2q+/HFXclkp9WsAbgTG9wGj08CI64WxRk/OTDcUAvBHXSLQxcVCDMQSWbzv+1e7WVbz+k5w2tJtsbcCYV6WJY7hmAsDA7r1Sz3OgOgoM+KTOJbcjSI5yGIaNE1uuwlAAU/MF+tF5/0sIghVLdVdM2S0bSzHx2Mi+FTxXf8X925NC4BycK8QwfmgVX1LlcFiykEMcL2BndJJ7aQfijKfxLGDwAhByM7aC5U4qwPzNwufNnNuOH4VZaCPlPo2AahqFqoPVFc14ga2m+WEEL0cAz9kdPrOmMu8r1o/rTsXz7f9oswFs+jO6LAqkvC3Ggg5Fg6mwW03CUI6X12h8lyfcz3QHqr3DIl64DbqaQKc9mI87QXACD6vpJqY0EVxz2CEyCI5eMSGX2e7VtI5J4yTRyZhscrvt1nQuivOAaNLlYESwcySgiVbr37Bfd0/u31yEgg2FVaiPCeVOguqAfGov0iR0R9JABJ0bnwk9nMxw+fOh55EbgRhzozrBUA1polN9CLwok5HEEUQBjFMQB7D+j656PW+IrJ8O/bBCo4sGFdGejqiyYCx3mKe9/JtTiBvmI5OFiTisg9LtJFF7gZGDrUbHKs79+hyu5hSaUvh1foFr3r/6vZJCiXgCDwVVFJ7MVmRLsrGltuFCc68yFdACMDAflwR4QM3HPoKgIExt4gz42SuaQb8hBOE2oZmlu+KFlKR3QSssMJxDPWbbjpfLoJrxG8CYT8MKGZSVTCxYFTIb84nkCxCIPLDiby30gXFghaF4c2ReR466Uu2fvoFr3r/fKAEFxvpqMcd9yonIrkuK5LLV7MVCM+/uDJCyIC2J8a0z1iwqyESgMl15Sa33QKgmtPEBnp11mwuXgO70Ud4DHWzfgDYC3zBEOk7HlA6XKyHQzb8HgGoCSQLqsxorIy1Bxie7Wx0rFaf+wr9Xv32C+56/7HbJ5VHtRYT+GJrsehHcya57PyKAQk6+vBkBZPpjPEExlwU59awg3C24W6KBsC6tqHR+MidyVG3i3rdAnAsH2T093XT+zLr197MTA80h3SfsZP2UqpCrPQ46oF317VrpeiKXTJ9MhMLkgGdCacKG/mupV9w1/vnwyGgCDCKWzJe3lqsyzLWZWe6/kc/oKzgKH4jC7oolhdC4jiuzM0WPo+cPQ2AsX1obFCTO5Jzn566PwbReiwnfTWjI4KvDoh1juh+aT+WKSYD3i8Aql2rJk+VsVQly5kkddv2FvHT61icqO7Fr71/IkLNXOi0FQjV0046oBy6wZ922Q95ICqDEaL4XWw3COcf9Mw73DFB9AqE6wZAAS8XuzGQIDKf+oVkqxt00ttAc+YT0PJ9qRFSB8xoye5Xu1ZVeCSgCLbYLVNswoncHxoeLwCzBGjBNki/4BX3z9lXgUCyIIGmhova83cRgO5Te9yLgP3MfmsBS8xs8/U67ePQOqy9umBUruDchqo8sHSd3PMfT5ifo+ack8eFHI6QEcnT5GvdOnVdXof+ptJ+BVPWceiaRHA8Us/nkACo8mzqlqmWrbFDppT5A5UIZm7CPA2Vgm3QfsEd909kKIqB1qJAKCBG8ZstZz3xHOAAiwmpDIdng1maZQAkZzsHZ537YfQrwNyxoQ+HakrnS0h1mUA1C96TdJTmORyhC3oeqdwROi+GDhkFI6bYNrcNDEDeAkXwQizPRpmnIs3OdqZPSaRFUcbchHlgie6agq2kX7Dd/+d8lUJVXuUzk8ERmS+2vfd4uvN2VOV5rSwb0y3JhgIh9wJeN3YMQCIgR78Q+nDEVYBYZUrUpbXFnM7COSdf7N4IPvtDnT2BY/h8Chh10MXQeYGS+7GGjaQiABpuNIFiECnzdWJMIUHcazLptC7YivsF8/7FgLFMqpiQL5TuNbKfA/DC46rqqAbAwIKWK+timRUBEiNGsOQsyQm+Gpjd4n046hbT84KPuYjOmHHyp92gcgDS2OoIuVIeh/xyUkaVwyEWdLrewHE3uBUDcKIwnq40HpDXL+n3CzbaKdguel5VnFJl2awaghLQBTzteZ0cjLq2A2n0M6EPh2pC57Wg41poLzZsAZNso0Hw6eVR/J8bF9YjWGmVCpGKwQLBRCcrbiSxNLgVAxCF8XSl8YDHHFPW7xeFBRwv/rGqOKUBkODzqgdWPYAM53vTASMQu4Bx9J+69OHIF+N71F1O1gUB+AsBfFqKC+4Wi4BWX+CYgOTAU36wdMVNVKka3MoBWBhPxyiuko3xkSX9fvGMkqsDlzzHC1N6SQ4DoINOe7KelWWTheziObeKCdARApD1AdVnRH048gKUAmAEYi6Oh4DJV4VoGDWqjq4XLbO5o1jBoimEPhPJmwu9FvnTLgdgYTwd2wyXbMyRKen3i2eXXB245FlVYUpVxUpGiLtmGBlrTEhVUwV8dEkVKAq3MHJ1uzRbRx+OOgDWFX6MsXJU/36lJoEoA2AKvw8+uwTEDIBbStdOs8ddDsDCeDom7ZdszBIs6fcL9ror2C75US9IxJJsEsHdGFBil4yYuUwknofJgF4XcEUfjrz+X7fKo4EJJ//PkMORO6FrVjQMeL5kJhZMMXzLwNZCt1nzDFgYT8cQwpLt4hDON0i/X7ys5OrAJVe0S/ISgFY7j9ZvnQ7I3+lyqpYaL98CWp/N+nDkZdhi6bW8An1kP3fRTLKVWlwF6RZCH2L4zDDR0k1IqeTNb2OQSYNbOQMWxtMxeqtkY6I+ny9VEz6btfb7xc+XXB249AoXv85+tIBVgJJ6n4lf6oV+mfjdDJNMH0wAVFX90GMk1f5TxlS3Fggh92DyN0IORy5665KIfCktsl+K3VsGtpVOWOMiuDCerlSnjQ2rB+n3C+pIBdulz8wqonrNPLKgwKaC5B3s53qhXVq6oDNg6sOhqvqhEr3V2VNLBjmnSSNdrOLJ1zkAu6VPRjFcFz4fXDJ8i45hG94Gt3IGjOFYA8TTlQZ/qGH1oP1+8ZtlT1MAtHK8mQg25zOZUSCLIliWcbw8wfW5Ln04ssqnHX04euiCk6/3de66MPpuAQVZAEFkw2MKFw6a1wEL4+lSBvmAOMhD8vkOkFX77feLNw14YT/ssmc4A6oOdHBEkwXlgjH2k4Nal6wB4fIuX9LzZjAmorNeHMo5Tc0OewHwDTUh9HXxfGJsYkAbAAAgAElEQVS/uvCpoAcew6zBBrdyBlQwwoDxdLZWXLDFkHyF8xGE/fb7xR8XXByAAVC1oB18HQYIT+8uGfP75SCUs1o64he8v4j6cIQ+IqkPhxrBCHjdjBH6AblQkAeY1ondukSiELmsUPpjbyp7XuvDgAXxdNZVvWCLIfmKg6Bbhrjup98v3lVwcQLw8gqA5v9zC9jErutltg8gMxDWWMBaMVkmANWFyEV6R0uH2I1IzW7ypbkQOTP5f2ch9KsFkwp0kQlDAOmxzHpscGuGAQvi6VD4RgmAg/b7xZVlT5MATNXwqQc6KGwf2U2uGV2uzg3D4ua7fDnPwZcKgIdq9GaIBPZb0YdD7hgyIFWMXiH0eQ5vXS5HcMkc++9lz2t9GLAgns7KxxZsCkgdtN8vWD+vYDMAUpcja7lOR9eLVcIP4tcuob/3AOHCdW02VTX62ApB4Mv1v24gnPy9HiH03fJ366KYHYTHsgBBg1s5AxbG0+HLZaOp65i+ln6/YM5EwdYBwGj1cmUkE7+8THLNdAHhwrUOXtcrO/pwhF4cct2oN68BMDCfmsJM/n6PEPoYPp8bH3kCkbtjji2tJJA962YAWBBPZ0WBCrbYsFoOf9pDAiENk179fkuvf9nTXewKcBSjsn7ldonWbgQpx+26otaLIwAlfi2QQSJY3Yjy5i9dmsFM/oEDMM/Z7Uf0RiYUA7J+ToNbOQC3e0WBBm9qLad6HICG1ZK1XB5PoxnuOOIcxSXe/Of8xHV/P+FpwN47gKUpYHmuSve0pKZgCKSq5wqniWE1WZz/xouBm74KTMwBI17lVBXwtWSs+8/vL45Ff3vhpcAnvwos8d48DZX3M2hx9XIAnu0IIO0chu35AOgLL0yuG/jOmwbg028G/mNz1YWdETbm4I5BrFlov+EtD2wIo7l+Atg8D2xY7iw3V5diEqO54mnj6XdMAYcU+6gon7A3NSO2qFjlyZYDkAX6uD5Iam44YaUfVNDNxaJcLIPXcGGpfi6PnZdVD1wPspQBX/wl4OaNwN6Jqg+xwrxslcVFuYJblehkcYYZGPS3L20BxueBcS8nwg5H5kZkx6TQSbXFZcCQKadx5Cz5mPurAFxrRaa17pAR2PFC+ElSHKQ/0QjQcgCyGyM9v3SnsDBRJgL6msWCf6IfWeUJac8UFlpY8500DcCfvgb43hiwZwyYVhd2D/VSrKGAmIDnBkiafEcN9cprHgKMzgNjS1V7rRjRlceyrqif6KAkMgXIM+6tAnDl+zSL36O9+U8p9jGHQo285/2XA/AnXeNnKAorDXH/AILwbSvLEz6Ql2+cAf/3XcCdw8DkKHBwpOpFbE2wadzIdyh3jjNQirYWEwYq+/zJwMh8pf+xKNSwM6DZMmzNRRbM2K+2Ii6TlFrAWfd5V3i/F7IgT2LBF5LbIdkqxLPWvtzlAGQ3RpU3Y7AiixMxLOUB2t7pKQ8M0qCTnp8HkojJgNqaMEJesQv4AR3Iw8DB4QqAs+6SWRiqgJgY0HVDAdBA4Ba4xN7ndlSFAAjAYX4IPO5dBDMAdS2i+Jx7XTf1eEdTDfgAQnR34p/wQkRmjNAoByDT/ugFphXAmjAEn8qaPQAgZCs0lSckCNmVigEbFMsPBBE3DcBX7gLuawH7hoAD7EM8DMw48AhATrjtQwiXoqkTEwWd7LOneXNCbz6Tiq/TInb2M8ZzIFrTQbGiy92oGz7pXl/7jvdAJnb2470IbB3T77Sai+hyAP5voTqW6sKwFAc/TAdc5+3dvcsTrvPVYSK4SQb8xV3+6IaAqSHg0FDVh3iOIFTIFxtit9orL5Z/LD1Q4s+B8OnHVuXwhhdd5DoLGsgCCJ04q66X/Ju/vSaeAxDPvbdtmdtKDV90gVEPIl/xySkviOhmAEjrlzSkwj40SlQZYZ39I+8JBMx8mZryhOsKwqYB+KpdVSDFvhYwPVR9BD7uyX4SwRS59nNI+bRck/DzJ05v12M0nY8fAk8iWL5BB5qASPGRCi8EVjzv3mqpkC9ACrrwhKukB67GhpqRRowQMqCiYbj8oOoHeUWpdYIBAUj8c8WjrjyhNIJ1unzjDPjqXdUjJAAP8TMEzLYq9uOHICQALe/EwWe+QgddAqCzzD8+vgIgg0qp+5nYjaDzCgjmnCYone0klqP4JSgvvK+6LoFPoFMlkPGh+0rPWta4RHTNJJQz4M8EAGoNTPVU8opS64CC9zoAWTFChcq7lCdch6s3L4J/2QFIEBKA1P9mHIBmhPh3Ai354RyAAmWsR/PRs6vOR8Z8FMPS97yxtIlYgVB/I7jC0rIKSfLXF1EEB+BFFjQ3jCLA49OWsRTTEPzvzQEwry7VrZ5KwzAQAPssT9jw1dcHgCrORQCS/bgn+1HsCYQSveaHkzvGv1scgU/6R55Y1YIxhvOm1EZekQWl8wVDxJgwc88QiJc6AKX/meHDawX9z16M/Em7bO8Q08GBP/jEkAEVjMBoAFWXUjRA3KtNwOBXW3EkAZhrALktpC6lKtTV4OU7RHB+3kHWgv/zrnYZl2kCkF4uF8MGQGc+MqEYUCA0n1tkwxbw4ScHAHr71Q7W4++c8czwcBAmHVB/c7Bcek9b3FuwbdD/kjGWgzJjQ3thGmVA3jhfOyU+RxB6FamOFp8NrhsTgLy8Cpzm5QlVptAU+6CiNgXCaIQ0BcDYV8b0P4pi30vfIxD5+w72C9aliegW8MHzqrmh/meuFhYi0pKbs6D9fsh/n1XFMrYMbPgUByCZz6J+uEknDA9AornWFRb01WZEsACoHhOqyC7wdetT0QAK2KqOb5MCUvPyhLE0oQxzqaYNXL5xBvyVXe12vByLADjXAvgxBvSPGFGMIjCmJbEW8HfntxtQmxT0cmxp9UPAdKAZ1upA6EB7qgDo6oCUxXRtPVSpAwJpnUhuxAqWCCYK1MBExZljY5S8SYr+pxAFAuBayhNG26jw8usCQLX0SAAkwwcAEngyQizaXoziIli+Oe7/9kJvNk1LmBMe9ECO3XRB7aPeF0EYHNVPdT8gj016YBcWtBfBVYJuz7mF7VgGY/pO8f5WdQ1/7U67nIKNS7j0wIbDPFZsyNHHY7od/xdlEHj8CcC3TgCWHgGAPSxiSdt4312u/8SPAl8/Dlh4pDeZW2PD4J1c9+uyDaIDkgEJQKnTfG/N8nUAmu5HUnMW5ARbPfEuIHy/ACjRK7FL5pOR4RaxgTHofKl8r/S1ZWBnAGDKefbn3AFIPRPXB7sFiVQimKVgGdl5ooNwLQ1/1U+DQGSXQ9r5Evy1q9rZbP1lGQDZsPpzI8APHgXgod7qUx11YtBbFzC+/C+BL7SAWwhgdoLkONSLqy5oLogYft3ZI1F7EAC+phsAnekokhP4HIzml/PvthQWmPB9LJ7jxkcSr14jWj4/0wFlgJD5eoDw6fe4DzAYPHokWhHJZ3TFSkn4h7YOSOBwEtiMTv1aY0uktFYTmI2/43EMQmCuAJmUE0gmVD8EFdPpdnxhVhqzDr8F4NMtYM9Jfg98EVTeNu9Q2OFZBX7vr9vtgm/lcezczZ61ZNN8DCvilYCdPXqNDQpAlfGTKm0M6AA0PTAyoMSx64cRfPQHXsniOTI+fEWDFGp+Qb9BeySRBV2kpl0QxxGAlHDmkI56X6z+EP7UDYSdRgh/IouwIZ36lHabBE0GJ0r10Rgb/xA/tt/j/6aMAf+7R4CxzuBXWRGULwBfIrY6UNfpvLae7n0I+LO/reoLMqiVMbW38oUhkNkQIzZO7tIweGePcmWlAFTjAYHPVGwXxWoLYblEDkLuTT8MDPhXLJ4jALpaJB+ggU6xfgJknT7IKXIQXh4Y0FZCog+wxiUTwSkXUbSMV1rB/A31OXWuFpPUda/mRHKi1e6U+hA7Zq7l+A+UAfDtHg/LrptkQpZ727cRWOL9542Pa3rOvuOqagUltgtmJM08j4/PILbIDKz6w5PAHsbraTnMGdZWIwIzxIfeK0rn578J3LAVuH8CODRahV/FFQ/1IumIvXP1QudNfyNT8oVqcHviPcBd48A0g2RDuoDqHdb2SalZAdG9dnfDkAE0gXnH5ijWCDbKCq5/MRiV0QD8HgHQ63jG0hdsLGxA3x9Bw1Asli7hO3BwApgng/Gjvq01IHrXJ7q3Cz7E++YziF2rs1ZLZ+8H9jJsSoECWXj6igmR87aLgfbGq4GvbgLu2gjsHwdmCEIPSI1h+SkCRjpfUC3iNWcpoRrcnrYbuGsUOMBo7QBCxSTG/igxVcBIVGPWM1h1JYQPnyKNExGZMDIJ9b66eEBGxPDY1Y5nv+GCjfGAxD+DDpiawphABWZPjwNzNLAEIH4XCH0M7/5c93bBfI8Yk2cgVAdvdT10ifDkBWC/r9lGH51NhIsnsWHOfPmEUKT94WeAG8eAO8aAfWPAwVEHISNQlKQUglJjJExqC+H6Nq93kOpUg9szbwLuHa66QzFWkaFieXxi6hgVHOMCYGRuJ+5V4jYJIDKI9KlsAvFDq8QDrnb8NWVPh9EwdFkQ79TlSMIsN0Mi5s9MoOGno4U6f3YAvefL7Y7rvdoFLxOANSA8f7xSgWmd0kCQbmZ6mTLEnJ0UqWLhUkxlrBn6n3wWuGkYuGukCsufGq2iojnRFpafsU7MDxErJuZhYCsJosHtWTcBe1oeq+hxigJgXBrMmTBPnJKLrr+VED54ibHYvZos8sO+DNcrHrDX8YVVyglAKud0LtMjFPtNMz6QLDY7VomLJd671AEH4Xu+3g7nWq28ISvX58/hguOBg8vtFQvV/hEzxfqOevuTfpjri8vAWz8L3NYCfjBc6ZYHmBcitnFd06pxyb8W4gPlgonBqffTtdTg9pybqiVNBssyUsdUD7eGO9amnf3sXtxQipl7Wg/sD4A8AwHIyZMYky50Tp/xgN2OL8y051qw2hXzwRCEdT2nmck1RxHG+w5jeO9NFQBpR6ldMIMXlFWgVndqF2dVFsJzuOgRwMElB6DcI6rznemD0RnbwQiSRS3g7Z+tVIl7PC9kahiYZm6IizuLigliT/VoUog+p8P9l3wJ7qGEanB77k3VczroUToWLCsABud4ypaLCUoxf9i/9w9ADiICULrQRWuIB6w7nuZrwaZwLBGwClSqSyz3AhHbaRGEFGOmC44D72UVgjW2C2Z4lIF4ArjodODQcqUGqAxfcpG4mJVuVqcL5tbs2z/veV0tYK/nhTAqesYNHdO5PCJZos+WuzxHJIViuXFyJxupNLg976ZK2lizUKodilGUgzyGhokF8yw5Mf+qRkjdjfuDtwkkm7DTkNaBaQ2ox1q3eMD8+B6O3H6em8Kx1Ccx9ptWl9iYIUAAWrI3I3nHgPdOtsO5eOuxXXBdj0V1vOL/so3Cxef60tlSpYwveKf0pAu6ohfdJ8k4CUqgvr5jV6VGTBKALeCAh+VbZLTnh5gu6D44A6H8cVlkNK95O1WkBrfn31R5HSy+JCwPplAxRegE/2T+AloGncNmbQyogUQx/KwB4gHj8YWNTwRAOW0FIIIndoqNkTAxz/bd09XDGLBdMM6/pLKi5whAX60gCK2ujxzEAqGL2pQ1Jis5AJEAFHvTujYAKjRf+SEugm1d2COQLU/DAwQ44caEw8AtZzSIPgAvuKkdrWMM6M7xCMBoiBn4YpCE2NCfxWAA5MEuwvCCEICwlnhAHV+YORfDsWJGgPpMKwg1b9QpFnzHbD2BK2JGul9s8KkYW17vLALQRTCBpzXZpS4gtCXXMAkduuAy8E7PijPWprXJ5CR38ygw1fJDohh2BlRAgq2OeN7uTWc1D0AFNtmL54ESBsCaJcLkDajxj5ZXRiCIGA0waDwgjy8sk5+HY+X9ppUbJSCp6TnFCMXwny1WAFQ8rUAc2wUrRL6mXTAefWnFfnz3FpbagQKLAqAzoZjAKkkpXkNO5GCEvOMLFXOnnC4xIKOjnQGNdWSM+GqHQGd7JSsxUf+JzQLwhTdV4je1nQvr1MkPGtlf9yP2Dy+gAqZ6rQytfvdHSDxgLwBF8AmAYjHWluEDiKGMiqOVvtejXTBOuRSYJwDJAARgZAGWL9Nk+IM3SzgTydE4eec1nZHbtDaNAf1Dpd/SMx2END6kD0oXtFhBXmcY+OY6AFChnKnzl7NfdMR3qCAae2B+VVMYXASvDs3/X/zHJZcB84vuiqABEo0QPnhnwqQLyRURmZBPytnwHde0M1vN2lR6picoKULaxHDIEdHkW2iWg4/7b5zb7DSQAVd0/griV2JYojfpwRGEYsGBrOBmx/OgP5sAKANkcbFzNWTRnX/GSGImMYH/LYlk+gGvdT+bW+SWH+Ig1GqL5QeTtR2EYj5LVHfjw/ZDwL8yJ6TB7UU3VVoTjTYxYDK+Ivv7dzNAZIxpZSiU8jjKgIWTcykZkBawDBBnQdMr5QeTKI5iWCB09AmEb7+ucnOQ/aTPWn6wuzyS4u+R0Ob6CUGqJpIDA97AdqINbgRgBJ69CG4Jp6q/ckjXqB/RKla4WpkO2ODgHoynigA0JiLwaNiEt95YQKJ4FRC+7brKzRH9jZbN6iJYuSHm9I5iOAOhHNJfZkh+gxsBKPbLu3+JgaWDdojhMO5kkDWSlNTg4B6MpyIAjf3IggJgMD4MCARjFMU9QCgAykhSKnUCYHB9JB0wy5aTRUxmup4h+Q1uAmDs+hpXgFLnB6ULONOn5xACNJqxghsc3IPxVBGAiQG9aLeilWUJW1FvVXEN0TKp1C6At19TMSCBpz1dHtT/JH7N9yaxp6QkF73KBxYIr10nAMproB44qQGTj6sjUrtOFPtLeFQHLES9AdDFrq1E6M13MaxVCTNAXNFThIylLcor40zxtgDAPKuVwDMrOKw+SBTbtR2MND7sZwC7Qvm4wqHa4T/uIrhb+7n0EgbQdTijoyg+agWXT8llDsAFWr/B8qP1K7bT0pvtVwHhW6+t2C/m8svvZlawi2CKe37nhFtapkDnILRqBQA+v04AjMyn79EIkXO/DnzyCBwVweX4wxs9B4rRZgyPVFqykgDd+5JSpBU5r0vHyHz+jsc3ub0KABsZMCyQgeExKyFPVIz3lmcM6OfPAGCADYPE67Jfs6h7G0o+xvi7oyK4cLZfOgpsXwC2Lq9MwuuVERonKn4nSJrcXnQKcM7dwMMXgYcsVxkSebJgzOWPqdB1ad2f3gpsnwK2LXWeR9m3danUIV1lBSCPArBwtp+7DThuBti6UDWDmWA/DvXk8LRptfPtNUlihYZTOPCi04GH3wFsnwGOW6iAs5n3GeJJ+KLoE+9VDClQ8R6vOQHYegDYwuY3S6H/iJ8jb11ck0q9Qhoc9QMWgPBZJwFbpoFN88DGRWBiqQIgWyJY3lPozaGJ1KTEPh36zpTkJrcXPRE44S7g+Cng2DlgyyKwaclfFoIwvCwx9Zn3Q1DmIPx/2/sSaMuusszvjfXq1ZRUElJkKsBEGQyYhJCBSkUqAW1tsBdpuxEVaBzowXZqe1g90G2LotjQdmMjKqtBxQERdAWUAkUlZNBGkQRNyIAEMAkxpFKpqjfUG3t9//m/c/+737njPq9uVeqcte66b7jnnn32/s6///3v//++Tz0dmD0KzC4DM6vAFpd/0L3Gh6yTDgnvLwKzAWDGiH/ThcC2OWDrErB1pRgQisIQhAa+AED+HEEY6uNLyrRnZLSl6tSbrgLOeBQ44yiw8ziwfaV4UGbdegmA5QMTLFlqsfn7XecDW+eAmePAltXiXnkuZSBkRcm4UGXtU2uo3xsAZgz6y54JzMwDWzkgBOAqMMVBCSAUObh8QuN/CiTgcWAuyWhL1amvvBbY+VgxbW477paa7gIBqCnUrbUBiQuhAKDUot13IbBlDtiyBEyvtO5VDxvvVfxW/JkWNFrCeK8NAGsY7BsvKQC4hQCkJNaKy2LRIsg6SJ3IQSe1onKKC2CsOYMeN+0Dtj0ObDsGbFsEZmWp5S74g2Ir2uA22BScAJGA+dJFwPQ8ML0ETAUAkgDTPq9zdK/+sMWpPF19NxYwA4g3PtsHxAE4SQC6FdSgmGWRRIJLZJll8EGKjHiX1jwaN10HzD4BbD0GzC4WrsKMW2pNobZoCu6CLCDfCTqzgg6sr+wFphaAKQfgZHKvpRSYg7HN5XCL2AbAZwPrZGaj6ippXhgn0kqmU1woxnHedg5AATuWHig2FE1uVRwoxoX+Wcbg89S3AqCKPONcCi8oPtVP+9++G3j+oSK2xRBFDElUxbTS+3nvc4FpDsjxllXQoJg8FgdCQoGJJTTicLcQ6vPL6wbg9cDM4cJv27oAzFA5ky9/UOSvmg8oP86n0dICBn25JwjARWDSAUgBHN6vfdbv10AbARh8X91vDM2ss+NvAECKPVLCsHoyUgRqrlbnRwB933OBc+4DXrIC0IEmiLnE75di8HsyAcjzWUVGUi6uICMpVwwJVMXdeOk3XAxc+Hng+vV2esAYw+sWoP31r3eLcLwQBeQUrEHh4Jo2h4vDmJPuAyMLGAeEn7uqbgB+I7DlSWBGCwe31Gb9aL20kGDb/EGRxY6WTz8f2wtM8l4pgL1SgM8esHCvsuylME4nn9cfQLtldg6TZ0kUKorAfij23vAPCmqp3fcCl60XFINid1PlZrf41/dnApB6wSQjutUfIDJR8CGIQOwWEH7DywpKrWc8CFzqRLHkVYrB2jS2FQH5vkuBycXCAlIUUAAkCM2iRBA6+ARCe7DjYmQduLYTleiQ/XTTS4DpI+6nLhZW2nzVCEBaMLd+soIGqjD1ampdugiYWCpeBKA9bBJC9ActAk8LES26SqsftInLZ44dQif4Igdhym5WLrPDyuYH/7HTCNwDnPko8LXrBccjQaioe6BiKad3+QY/MGTH6rS3OBvCnQDuAIyqhiDkQ9RX+29yE3on8IwjxQPI8zkTiApGU3oVkD/4fGDieAuAdMw5MFQjEgg1DYsUku+a3uI0TGBfV7PotwHwaOEmbHEATvuDIutni6UAQoFRIFRYhfe/dhEw7tbe9Of0Si1g8HkrwRcevDajz07gIJ7n05rYyWIpb4ya/7vv8PRdFpj/LXDmkQLAnA4jCCOlTBRN/rFMAJKgkkVHpGUjySSBSFeg7/azqk8EgbSEq8UDRACLKDXSyaQ7Br//DcA4LSCtwnKhTEkQcmAIQhtM+Uaajl0uS9NatITXWzpzfcdNB4DpY+6nBgDaCtanYLN6fCj4u1ay0QIqtML/EYC61wSA9tAJeP6eWsAoDysFpg1eB0HIQRCIIkVeCqQf/05P3WCB+UPA+CPAzvmCaFWDKEuYcl1yMN+Y2dckqGTeHPEvvWDSNhOAfbefX0A6rS8CUw8X9066bFIfdqMHJID++DJgLACQumyc3gyAEYRRKFCLD1eu5ODLF6QvXedx0w3A1BwwxdAJLTXjd8seQnGrZ9bPFxLyA7WIKON63tYtCQBN/sv9QPm6BkLp0vl9t/m6ietR6fbyBA4gnXtORwRRpNnTtPpW6gWLH83lKqcOFTEnDiKtoHwy8RNFhrefyeztbnrBfbWfgttsP+kIyO32ELD1cHHvInrlvWs6TsnB7qAUlg/suFtAWkE55zYQ0QpqcALoNCXTEt7A3KoaDwGQfqoAOEUBa7fUbKctltwCajVbxvSiyvoasM0BaBKwwdKb9fN7NfcqBWGiSWykWXER0umeacUEonQgCKRfIgDFjya5yq8Wfsfs8dYgiuMxgpAg/vnMzu6mF0z6Zj5APdvPQec0TEosnvQosGOhaLuIYvnwEYSithE52F1XFAA0p5yigD4otCqygFKnpHUpLYP0OcKURYv6Mj4MNR433QhM0gL6QongawOg+6rl9CswKoSkEIxPyTsuAPigCYBmAXVfYcVf+n0SRYw6dP1YwNgHsgSajiJP429RrpWOM6cxDiJB6NINM4w7LbUGMQUwB/M9mZ3dSy+YVG0EoBiDBST5ddZ+PkCsAiIlQZDa3LVatJ0WXG2PbL98AB+4omB3oP/HgTUhmGgBfRqWf2TTrUSjExDSP/qWzQDgfAFAWyzR8rkFtDAKX75jo6nUguZxZ8NByHbvvqBQ36T1swcsBaBAGGRg40Ir+rt9WUDhQ5ZAU7Es2e9LLzglqHRxNkbeuW+oQRRls5jaMjnK0a9ecNf2R4LAwO829kQB3LTtEYQPUwzQAWgW0AGo8AQH0ljp/V17pm0KRcEifGuNOnocO1rACQbKPXhs8TtNwVr5uh+n6Zf3wDgu29g2FdMtOc8B6PdpFj08ZFrplw+ZA5FTvAQQ0/BT36FPDkRqBT9Jag7xYlQItY0f88j78sZzCcKPZlrAQfSCK9uvB4h577SCotUiEJ8opq8IQFl/PUBPEoBLxbRE62LSqG4dFB8r5bHcOtiOQSqT5T7RKzYDgJx+BUCCTxZQCwhaQc9oKcEnEBKknj5FsJ1LAPo9xoWWPWDy+6IIoqbeaO0VA+zHB0zxIQDKkn1GgtXiRxMIAx0Vn0Db+lkuFjLRCt5WEwD71Qvu2H5OfekD5FaciQay/GIbFgBXriwAyGmJADR1ck3DwTE3TQ4B0LetzBJErTYAr2BBSI3HTS8tLKBZPo/fWQDZp197Z3scjGb5BDp/L3+njMweB6B83Gj9wj3atOsPWin9WgXCFlVO/3ctf4iD8XkBkH5USlAZlNPZAQqARr5vxu1yjmH0givbX0UQKI63o0Wun/xHuR8E4VnPK5JQLd4VNttTBvK2uoiKOUf/f+GjwMNBh0NMV6J0c0NpcRv7mrYv3kh8/uHxYp+bVpwLp3R7sts2YzouSq3KGa+q7+x7Co4nazAerRKsVlV1QitF59dyyFZaYY0HMu9mWL3gtvZXMbymBIFMZ1ov2h0B+LTLisxgW+Eq5uU92iZ72ud9vvR+4JFp4NjkRh2ONi0OB1/UBCkvEYRhfuNs4OmhhiPKnFQlx6aAjMnSXJUAACAASURBVPjmz1w41nnwO4cCIBvBwZgTAOUHRq3gyDExD4zRGVYEnpm5LqmQc0M5esFt7acFl0SlHiBxuTkYxxdaihUC4QVXFu5FCUD5QtJl85sjGA0ziQxqeu/fem+hw0F2fLLQGxFlYMRvo7v1WmIVtpt1DFkXvOR7LwJ2HSkyoZmEypoVVe8p7b6qEMnidGG/Vl/L2aPOIwuA1pAIQE3DAmFa4j9f7CPaFpCHKujr5xzZesGdHqAqKz5X+FLRAl58le+jui+kTBALMcgZ73CDBkpN2/7+bfcWOhwUyCEAjQTcAVhKdjkPc2RajewKyu/n1//qJcA2uhBMRGXQOcn9U6JIOjXHQqSYOsVoQp1HNgAvz8yny80H5PVz9H6RqVd849WtXQ/zA0Ow2ayGLJ474L0G79vvbulwkJi8BGCg4S01SKqofoNvSIC+5zkhFUupV8rUTpJN06KpaBkFQm5M1HlkA3AyM5/u9Zl38zrk6f0iU6/4hmscgK5ISUtCTowyDqb7UxwsqFJW3fo/vbuIBJEZ1YRgyHwQKNi0KEl1OKTCZJdxtPDn//v8ooaDaVgqFyiTD2IKfcjZS4Fo+7g+HXOPv84jG4DIzKfLzQf8KVfI/FNKrQ6h94tfz+vOA9cGAAbrpylY2SDlVTTt+uCnV3/V3a7DQQAysJAwobZJgUXi78Qayhd812WeiOAZzEyUiAkHMeu5BF5FwZQAWLPwknkLQy9CrPMy8+lIHZFzvN3T+YbV+8X7c64OHHix74V6zIxB+RJ0wQ+UU992tYoFy3fcXcTDxQkoPsCUhFIczKVCegSg5B8A/PILN9ZwxBSxtiKiUAOi7JW0dLTustF8AGbm0/1o3vjjnSGdj+lYlGwdRO8XN+c1wABIoHk6k61yuSCJITq3jDY9Vx0BqK++uwAfX6JkI/hME0SC1EGguiQ+isqcQRLrF6/0jO2w+6FMnZhyZYsQ1W50qOHgPX1NXndtODsfgMwHzMin+0+ZN0S9YOllMzWfLwKQSS396P3iY3kNOLDPM1y065H4gOW3p4uTDkB8zWdb7FgbdDhEgJkCUDRvogTmd/vPv3BVAUBuvylNzAAYi4hisVQnEHoIqWblrxqm4Mx8ujfljT+YjsWBYgIOc0oJPsq1slCpH71fKybJOEoAuuVTRSCnYlmU6P/Z4iSJEcbLv+Yu9/1EAh7JKEXDKxq4ChUiKymRbwjgHdcUWTARgLYXHSr2LOU+BV7MVwzxwOfkOWybYAGZD5iRT0edjpxD6VhcOQ6j94tP51wdOHBdMeXa9OqWRcmWXA1XLUIUH6zyCwlAs3z+YBkfs1u+VIejJEF3ckrjI9T0y/aMA2+/tgAg08VURKT8vbKMUgAMIGzzAcOi5HknHQAz8+l+MW/829KxhtH7tTz+jIMAJPCYMULAWd6fvi+EY9ouoZBM/Kx/4LUBgFLgNC5o16FrE8JJVJgkiFhaQQBv3+dVbMrWVsC8UxFRkjjaVsW2DtRdOJ/vAyohVYK7A+bTvTdj8HlqTMcaRu/XxHkzjgNkIOWuDr8jnYYDKDutgpUhra0uAlAyCCUAK8BXcjBXgLCk/h0D/hcByDxFAdAzoFUqUBYRJTUcMWdPP7ONL6i5bLQeALJRQ+bT/W7G4AuAOXq/lsGdcRgAY+glLkYclJVTsa6ptCX3uQjAKINQstFrAZKIwWxQIhIJuovB/Nx+r2LzFCwlj8Y0evl/MYk0kieVtcvrwGUnHQCVjjVkPl3mItQsIPuElx9G79dOzDgMgGkAWlNyBJn8xKprBRC+zgEo4LWRgcdVcOCjjlNvmx84DrzNAahaFZWLygKWxUNibIhTcPD9BMLLa65bzreAMSGVoXvJ/Cgh1WUfO+XTZS5CDYDs9GH1fnOrIDcAkABTTDCCLYK0Cwi/586WcKJUiEpC8CCBYDsiiSplqUIUmOjf+o2tIiKVUJbgU5uSWl4DWwX4+PcXnrQATBNS+8yny1yEopdcay+930y5YhgAg+9n2OoUeI5TdQer+32fdhmGoOBZanBo+g1yEKU4dYgFSvqB//vZBIBt9RshkTbW8ZZZ2hUgvDL3iU3uux4LSBM0ZD7dPRnTH08VAIfV+2XAOucQAMuVcKfFSD/+IAABsEoGwYAoHZIKEEYxRIHwLS8pUuhjFVs6/ZZhIVWyxVKBBIRXnbQATBNS+8ynI4tBzkEACv+chlUVIKE/5cRGsWmlKfIzudc3APLQSlg3E2OCyVRc1kpU3DgBmKoQsWtlBcswjPu+nfTYtBL+GQdgOf16GCZW6pXlBCqWSgqJypoOAFfXXDifbwFJLvi5HAjlnUsiIe6AjOp4iQNQHRlT2PlgJCUbbc2s+v/hFwFb/q7gm6HlYpBbmTV2sscQyy/qFBj2v0/cAdz/HGD7NDA1AUyOOU+1CwWOewNjKj6/O03F1/WuugW4/XJgfBoYmwDGdH7IxB5kLPIB+I8AfNwZgga5ck2fJbEm8V9zNWPfrasbgMuPAcuseJ8Exsb9FdBhA+7gaQNKB6TfcgCYug+YJT+g89aoBDMmIMScP12uTKj13uDv8zsKig/uJ1uQOsnojm3qB5P5ACRBH3OhPuzzRN9DV88HqQLEWPJnvTy5nm/t/1s4BcuSpRZtGAu4fi+wtBVYEyccrYwn6hF8/FkJp9bKxAKVFsn/d8urgbHPA9NPOEOWl4+2cfoFHhfVrJTZPKHSj5daOtup6JyCpPx8rHWRVQ7WOlrYCMx8AHIzlxkALPD9c0VB+x/A3E/+E2fUYHXdF7KTGwdvTd0AHP9r4PgWYG0KWBdfsBdsMPfPrKKsoL9XAVLAvO2fFylCE4cKliyrDVZNcGS1CqEYhWFiAZV+XntaURdTLmpCEbpchTYLqi6NrkMCzLzt5Xc4HwyJmmkJ+Z73jQOh4NWeDUZiK1K08f0EXt7CMHVawIk7gaVpYJUA9LI1Ao8bzKX1cytoFtFfpdCIWz7rgzHgth8u0oPGDwETc8CEMySUzFaikgtlpW1Ta8JqNba7lVljSRgW+Q6ZP/57WQvj6fydBjXfAjKbgEvMLwWCvhNoipgNpnQshlS4IGFWzIk6ylWwAz93ETLxGWB5ClidLABoIOS7pmGfG+33YAG5mND0G8F4678vkiPJczNOAC4UyQm2N8w94kirFlfIAl7i402d6dbPWWAtrsjOFiuCvAJZOQE0pHTFsckHYDeCvhNgipQNxoAz8/8IPr5nbvH2jd+6AThJAE4AqwTdZKEBLDoDgU4+YVkPHIBoPwareOt/BkDexsMFAFnbzNJYm0IDnVwbt4uyur1kwL7Tp+iZM/08WT9Rc7DHUmuYTr/x+6o4ovvu9fjBbgR9JyA+omwwxvZI5ULg6ZW7y9FPf9QNwKm/CgCcKABovh8ByVy/UCtJq2f+X1yYJPGU27lIZLbuEWDsWBHesZeDz4iURLUWa1TE47LqK12fZmd3OXidFctqm92KatVs1jAEsNv6sdymaa2g8+xUL4I+Pn2beCgbLGWHI/h8G3oTr45iK86POlbBU9yKI/AcfLR+ouQwH9BfmmbLlTHboOnZ/T9+5vaf8FUaAThXsFOQ45mUcgZCWTAxe0UQ+urYMO1/37GtxQmoLCBtRSp30LrDp2SFdzYMgk/R+VNwvwR9mwQDsaspGSfJgYDYNTbp8psCQFJxEIBkQjDrxt8dXCUIY+COH5MVFPi8SOn2n/QYLZ9Gp0cxANIP5IvAkzVzxivRydnKNzBa8fddM84b6AFyAriMF2pajk9kYIeoClXmA3AQgr5NQEHMBqMVFMNaIOayNRL/vhlH3RZwmhbQQUcAasrVVGz4EtjCu/3dfb/ID3PbT7uKAZ/MhcIC0vqRTo4W0IBIEAmEtFwCYqjW03bcmdwBYeoWgetUbrR8snrloiR2drpACf+rD4D9EvTVjIJu7HBV+781X752Czj9lwUZkTEgcPoNPp5Nv4oBRhCG6dd+1DkMz1JIhR1BAHJ7zwqO3fIRRM5tmDK5CoQKsSgOeBYBKFZULTqcB9r6Ni5KYmd3WKDUA0BlhNLM8EbT1QBXBU72aI5ZjUcVOxz7WLkQ8d37vsart/uA6RcPsxNSAtAXHDYNC1AEpf9s01kKwuBwGU7HgVt/1jtD1e60fgQigSe/j5bQp+KYpGB+H62jT7P8/ZypBIC8Dhcx8eY9wF015abhmnoAyJ5WSrKeNgKO9SHxnT/LSasJBim5lRjWBEIVeROInKL1qunybRawLgASdEy74qjaNNzJCgqEEYzBGvK0297mAFSHEIB6ebKDgc8J1ksmV8t29f1en6L5v6cxIK5iK6Xne/5jCTiFcTqVn/r/tWDPWwXnEPTVgIKUHU7ljASawKefIwDpMdRxRB+wFgD+RREDJABpwSzz2c0LfxczVjkVKwaYgtBBezu3SvX08d39P5uO3QKahXMQciourZRAGKZWar/YZ1xXRPe8wQr2AUK7TvbOVTZBXx4MBECRnConUBSFEXT6mf/TK+/qmzAF/0UBOPqBZYF52HrTFCw2LH5G8UCzJEko5nZqmRnPh/uCXmpnVpDTsIPPwKApOaSA2QLDLSHf97iPx0tpISLfz7bl4iFfsUsnj+HZWEeOYDCDnDmCvZkEgedcCjxGseIhBYt3vx049HwMLRh8gA9gh2MoH9ABqKJzxf0McO7XlSAU4HzhYYFq+5D7hwBu/98OQLlIBCKnW39SlXNY+nqeiq2dkQg+gnGPb9/ZpT0lq6MV5D96gLCwgDmCwbdnCvZmCgY/dxy47xxg5SWuUjigYPHFbwA+fyGwfr2rXrMvPB+vp3L3GHCgi9JOHQCkRVPppeUBigXLFymyejYTB4YsgfA20ofRAlYB0FfAlvQqP0/TsX5PLOB5DNu471cmIwiBaRww/F01J+mz2pqChxUMZvpJlmBv3iTocsW4dzewfhkGFix+2febXDAeJO/YEILBB7pU1g8LQFo98QASVGYNQ6DZfEG3fnEqrgLhbf/HV15anbkFNCvohWSl9XPQ2XTM/2s3I4DwPIZwBEDfgitH0Ek6N6x+u/iD7T4g/YdBBYPpWHEaHlqwNw+AQa4Yj54JrJO+aQDB4pt+oCAyYvOPEIQDCgYfeF/9U3AbAMX7ItAlVtAspKZdz5SOlvA2pstxjES3wJ+92NgAGK2gwi78QoVfEhBeQACqNNP1RdoA18kKdgDhxkUI/zKIYDCnqyzB3jwAJnLFOEIW7QEEi1/1Y21ywVglCAcQDD5/Efj7M4CVrZ5AKlkhxeQUaxBI4nvFzxf8IfCVC4HV7cC6ZEX5nen3VX1vAGLZq8ysrvHY+QBwbGfI2E6JpLvdX+ksthpUvQrmX/sVDGZVUJZgb17vJHLFeGQcmCdVb5+Cxd/5xjZ6QzzMLOQBBIOfTV2Ps4HFHQ7CLQUQmUrV0rgKJMsCjsxGAqTn/hzw0EXA4tnAyg5gbTYBorKkUyLnkB9YVhTxu+kT13iccwtwdBewPAus+b2ar9xJAafqfgMQO4dh+J9+BHe5gqZZZzYok1JJUcpaR6bp93P+W/N6p0KuGIemgEWKgPQhWPxdP7NBLhiHKYHUp2DwpZ8rLOD8tmJQVplOLxAqmbRKC6EDYC7/CeCRPcCx3cDSrsISrs04CPm9ArZk55UvKAspYLqPaPdR4/H0g8DRHcDyVr/X6VabLHk2PhjpPVZY7d5xwF6CwS9y/4LbbVyQsEKIufGiKe0p2JvXOx3kinF0GjhOQY+oNRtljji9TQPf/fOV9IZY4Gq4D8Hgy/4W+Oo2YG5bUUy04vUcLCqSJVRWszJbNgxSmMau+q/Ao2cBR88EjtOqbgNWWaTkIFz3YiWrF4nAjtN0nBZrJnU+/8PA3CxwfMYB6LUra3oglL0tps6wlVha5rLiqd9AdDfB4Je6U0s/0BXTDYh80Sr2FOzNA2AXuWIszABL1JaKWq1R+nwGeM17OsoFY5XTVw/B4Cv+Djg0C8xvLYqJCECzgsxmZlq9T8e0XGUyaUizavPtxoFr/zvw2BnA0Z3A8e2FVV3x6c4sqwObckeyhiXAowUSADhD1XhceDMwx37lvU4XxVN2n3rJIocygkr/Vbs7fe+EdBLcfaXXQ3IPWIrpBB6XlnwpR76jYG9e7/SQKzarxM7qJFj8mg8UarMV9IZ4gvNDD8HgKx8HDs8A8zMFAFnPYQPDl0Co2g4fpDZLqKCxT0/7fhJ4fCdwbFvhRiwRgJruCOwUgCpeCvUjZmEFxhfk9W969kW/B8xvKQqnVgg+B6CB0MsI7P70AHgmd2n1NQ0rv7FvALIlVYK73MnQCDLThSGZoDpuP7uCeuX5n8zroB5yxThGnQ0CgyBMxY63Aq/5aBHG6EBviDlOLV0Eg1+0AByZLgbl+HRxnZXJoqqttA4ODovlJZVuSjTQFtq+NwNPbHMAzramdVpVs6wEoPtdNg37wJfvsYiJP9NFqvHY+7vAwjSwxAeNxVO8T6aNVRRRlT6hHrJ0Ovaw0WDJCKng7g86APvNB9wg2JvXO33IFWOBgn8EIf2nRLD4tbe1+AU7yAWbZeskGHwVdd2mgAUCcNKnJgLQrZ/V9/Jnn5JUYmnAE3hCmv3+t8AWQfSzyPK/POOgJgDdsgqA5nfJAvLdLV+bz0kK4RqPZ3wQWJxyAPqDVhZQyQr7gyaXI9axWCFVAGLvRUhV46PgLnUWBs0HbBPszeudPuWKsTRZAJDTo8l8ui/42juL5veQC7ZpsEow+OrZQlqVVuH4FLA8WVyDAOTAmHUQCAWQkOlsQAwDt/9/AE8SgPQpNa07+AhAA6HLXbb5Xr4IaAMfv/eGvP5NzyYA7UGjBWTWjh40v9fSyscHLtaxhJWxFVsNNAXH1khw983+DYPmA5aCvXkdNIBccemfceooAfhAAcA+6A2xLuAGucxrzgKOMexDfV9OwbS2BB/BEoqLSrBoYGgJ3E8qLcIEsP/ngCPuUy7S13L3wb6PU56/m/Xj4Ps0TKCXQA6AXuNeZY3HMz5QANAeND1kwcKXlj6wOZQ+b7R+Pi0PD0DeFAfk590CKg8qncfoFzIRVWVqfFfBhgn25vXOAHLFWCDbvPstBsJZ4LUPt+jdesgFg+qVptWq11bg2gtgfuLiRAAgQeg+oEmsOujsXb5SsAoCIN/3vx04OlNM6Yv0tdx1MKvK7/TFjVmeCD4HQQQhf159eV7/pmc/kwCcKABoeYvR0oept7SEoZQ0Tr1lPuPQFlAtO0nyAcWhpzw/FSjFzGjLx+RGvxzoSeC1hwsA9klvaFN5FAy+9mJgnhaQ0qqagglADo4c9AhCDpJPl5ZommQ8738HcGw6AJBW1VecZv0cePwOY0/wl1lAD/WUCx0mMlDLr8bjmb+Dwp3x4nkDYbD0thIO5aNtfmDi/xGEeRawxhs7Vb/q2huABQJwAlhyy2cC0xoggjAAUCWWAkksOiIY978TmOOqeqqwqAx3WGhHK06n7TDwOcAV/iipPAKjwgrZm2o8nkUA0gKmAHTrp+o9MTrEYvq44o9pZIOtgmu8mafCV72YAKT/RwAy5OPOuVlAAk9Oule6xQRTWUKlWtkU/IvAHAHti5oIwDK841ZPFtCmdr0U8PaC9hVultd4CIC8P2Ztt/m5/qC11TJXlJDGGpfGAmYODgFoCxACkLpuWh3KCgqE8gNVZK4KtxgjJAB/2X1Krao1rfN7CWZf3LSBT4uAEIyWBVpipL7GgwA0AW25GbGENBTRx3rm1M2w39mmrFVwjTd1Kn+VAZALEE5LtIDyMWUBvbLNLGHgd5H/V07BDp7r3uU+Jadgn3ptxekA5MBri0/Wp4wzBjDbCnkMWMqVpE8GJwLQqvfc0pqbkVj5aNk7gbCxgJno30cAjntowtXNaZ1suvSKNhsYTcVKmw9F5xGE+94dfEoP+JYhD/8OC8eIPUsUHokVVKB78XszbzAF4Pvd//PCKVGIpOAr78mn4DZOm8YC1jco+w6EFTDDPJqeCEBZBa5GffVbhmQ8DtZW5TYOvPhXip0GTuu22lTMLSw+aAVl9QhEWjurI/aQiLJkTMLsX9R3r/ymZ73fp1+37OU9hunXSkdl7T3QrhKCtlCM59k2i5CMMSIAGdqxEIwrmptzTsCEut5yilKoJLAcxCq3fe8tLCDBFwO+tKjyuxSCMdYEXoeDrHcHvu0tTwLzmwHA4N/Gh6zNCqqeOSxC2lb8tQSiMwbuqXIqAcjFh2JjBKGJyShQG6ygVbfJegULWBYcMR3rvb6oCRaQwFPgl1M5rR7/JtBZOIZWx/0+s4QeY5z/1/X2tFnAxPpFELaVkdLN8MWGVr4pCBsfMHN8bmTKfCjZ0Ncp456/x58zLzfw6Qf3ABd8pUgEYmqk5bGyek06IQl1bkXScnlN/u8L24Gdx1qVq91KQvrpgwaAAw9p+wnXPw1YjyWMGtDo2ASOFGMU7SIEUzdYD34vMPmXwLbHgdkFYAtlGiim6DpxJtvq9LtlVr/aWKEB8pUXAOOPAFPzwBTZ9r04vdQ9Ts4pAZ3cd+yHxgfMAOH+vcA69/9Uxijmz/AerYpdar1lNSMYzV+vWY/34I8DY58Gph8Bpo8A04vAFEFIknIHohGVR62QhFRSYjQE6qFri2z3iaPAhHNNlxKwArI0Q1IAxwfReacbC5gBPp66/5ICgLKCtqnsrKKlrFZUFPKOr7osMTtdsxzqQRZ93Q1MPARMPllohUxRqkEK6gShOP0S+dY2hlRv99y+ovRi7IiTnTvLqmg6xDPYpqAUgRgsoR7MxgJmgHD/c4E1FXu7FRRbvEgd7evXWlbPpp9EgUjiJpwe6zwOMlvpAWCMVusJYPIYMOlSDZRpoGiNxKzbdIQlXONMWJbGtw4svdgz3El47nzTRvPrrKptAJT6ZrzfintvAJgx4vsvdQvIXK5VYF3sUZxmJUvgA1FOvwF8spKyBtM1y6EepI4LqVMedbEaTp0EIKdPKh5FqYYqSxgo2jgFr13j6XXHnOiSZOeBVSvyC8qC2r05FVvVw9cAMAOA178AWPMp2LJaaekiCPXExwHw660n1oB/niGQazwOkkSepbJ/72I1x4CJ+cJ6lYI1riccrVicUuVSmIW82pkwnHHVOKbFsOozQGkFkwewnBES37ABYMaAX39ZAUCCb82nIlo+40p2gNnvsoKunxH1xGwA/LOzdQOQJPIuHzV2GBg7Cow7AI0l33XfjOsv6oVodes6ISbBsAZMX+kJxU56KY7pkmFVhOciuvTzSt05v0+ryuT/9gDrZNe4wPMsI7VJP3GcP7gUOOdvgL1rRYJ0ZI5IV3hV4/wrGYPPU3/AiRhYusy2K7mU999P+z90ObD7LuBZK0Xdkeq9NSX2+o4HLwfWlopFCC0fgciBMtAFC8CGrYXVoVjnU2G7rTXrzh4kfRzLY1kyGwBoeiGcPiXb5eAzdXWnazPCSScb4j3xfmav8Cx2p50lAMW0VXINitCogl2r9H2dcctWwQxQsn6ZTBbMNtcgdKIbiZj51VcBk38CXPxoQcfCUg8pjcYgZScw/momACnXyr4leBhs5QaBTHpf7X8dMPYJYO8XgAv9e8QJlAZZq8D4xSuANYKPJQn0AR2AHKy1MACKe9nfFI6IEqduEWoHIJ9wlsVKLekoMCa9EAegSTYQeM4TXco2SEMkAHEbBZoj4bbYtdyCVrFqGXgTSxgXYTZeHLi9AMjEQRCVUXP/n4KUaaT8vVTi+Rtg7GPAuYcAWlMCgUVkQfJ2Q12yBvPXMwHImhDWwf81imsTiLSEvHZkr+jY/p9CQRD4p8DOBwteItai05qn31FFdfLlFxYWgCDUIkRkj/TxbCEi/89jfPZ3X2VqYSJQbmUNQY3HQT7hbv2sLoerVwKQHNEEoCsm8R4MhPRjXUGzVEIKIoY7yaEYuY4dgGb5RXruoSgtSCLLarkICQ9f6QNykGjFdjsIBaI4kGlt8W+Rg5g0HJ8qAp47nihAzFpuWtPIMBZJlASILvR6fQ0DCVbJCkJOJCqnk4pGpb99tZ8MopyiKDX7WWDiwYKXiEQOehCrgKh+eJQ+EQHo1Lby/zRlyf8TIbf9XS5ftIb8I92YugH4ay2pLusorl7dAoonWtMwQSTdOFuQSLTGHyIC8kxSIQuA4hwU2WUAoO4/grBcDbsfWElSzg+JCoYDoEGM1ixSkHzgF/wG7y8sIa3J7JPAGWuFJSQIaU01iJHUiYP4e33BrPOHmG/JMaOfTZVYRhwGav87vWKPJ9/rSH4IOGO5sITqg/ggxXs4TOaBAECbeoOsgfl+DrQShFqcEIhyyt0MbMusEkx76iAZXKM8BvXiZAGlF+KaIbaadYpem4aDgpJZQz6YJABV5VcHAJZ0v4FxX6KG5UpYs0KnqjhRuagEVgPglYAl9ciHf8mdUrJh0Qx9vkDBzBywfbkYQIGwahA/kglATsHsDzKA0BATiPyZ4NEDwIeoa/uFYKKXL2f24nQoIgd9R3yQCMTFqwIAfdBWI7+yB5ZLECYLETd85YJl+2YAUNosLIel/xYlu4Jsl6bhNhD6it4WJCvA2Zc4Gxo73RcgJeOqFmGR6rcChLYACyGojmEYdj59KnZ+tIQRhH9IvWA2hiREjDeRI9Cly7fMF3EtWRFawhQIf5IJwE56wdTIYdt7tp9ys1K8JnoJvod9Wn682PNkP4hUy1ndWgstAtBDMLYN5/6PAc5DGNoF4SrZfN+4+IhT8jqwg2Cp8ThIJ5vfSWBXAVCrWN9SMxDK+skaOvhoAc8me654pmUB3f0wyt+E8FyRAGmPlOEoiSD2qgvmAKoOm52fAuiTDHSyIRxx+lI0QxxADubfF5vffMmSajrWlP7nmZ3dSy+4r/ZzAUEHnQ8R70HsXlK+PgJsW68G4XYGZj0EY2EYATCAT6tAhmE0DXcC4faapcwMgAIfLb0kuzT9Qmw5uwAAIABJREFUSi+EfeALkSrpBovbrQDnkm8wAo8/E3i+CCsZ98NCpAp8cUekZyBavI4ET/TnaAk/RQCyAXy6uNSPA0i+wMeB6ePA5HFgZq2wpNGK3FUDAHmv3fSCe7afX8CB4UNEEOolVi/3obastNwJ9cO5BOBKEQMsAcifHWzRAigWWAlCn5K2bQYAOe1KMjTIR2kRUhKVS7IrLia0v+3xwHMZMCbYNP0KfG79zAqK5DxOvyEuWu6VD5KSHy2YAEQAfpaRdl5UkuUctIpBnCIIl4psD03FtIIP1ADAlBuJM47EqqUX3LX9kSBQcuuyftK78xUkHyQ+RLqHZ3Fv1KcgLj5kAQ1s0Qo6IA1nHhNLQzA8ZxvBXuNx8DcS5UYpNnoYxsCnUIqvZo0F3wPTMa7Hv53HOJVbS/l+5bumX7d+5WLE44hxIRJB2NMCqj9ixwuE90svWCaIA6bAp959EKeWChAyA0PTOV2unGMQveCO7bfqHbcS4rJR7Ewqnw5AWhLuImg2uFQAXAVs8RGmntW4+g2hB3P79L/EJ9zGvqrxOPibiVihAOgrWQOf/EBfBcsPNBBqW9Hv6zzGqFzmoXz3B9AePgXiq6bgiv4YOB9QHS8AfpkAFMMjrWAcQA0iO9XJiQyAnos2vV7ESHOOQfWCO7Zf7F40mZFQScRKAYBaSU6vAVcTgN7xXHiUFpDTMK2dFh56912BTiDcvpkATIXzCL4g3WXTZ4jpGfjoF/oihL+fx+0yWUABLwIwtYKKIabgCzHQvi2ggBKn0McEQDaKT5cGkIOo6SuyYzEfjQB0EM5nZgAPoxe8of3sgSqCQM3jkdFLvpRvR13+7UVRuhUFSavNO6otwp88ZZ3+t4M6HLtch6OT9AG/q9cmtf//gV1JDYcnQ2zY6/YakfSrU+Pg1M45NqPt3IEtoM7WFHokyrWKkooglCMWLYjiUXMtK3g8Uzd1WL3gDe3vRRCoUEYCwGtYFxxqgA2E/jI20F5hhmQod98BHNnlxOTig1aGiDanO21yV4DygWuB8YeB6fnC9WEtiKVVKeE0ZGiXWczeJoWMIig5a9V5DA1ANoKDeDylZ9NSXxyAsiKawrQqmCv2HVf5e8aRoxfc1n7xs+khItAUvojvyWryxVcWJZksVSyZoQRA3dcAoHzax4Gj2wtu6FVKM7gMgti02jbV476oUJJs1j/AbA1mQ3Pm8eTRsoZDtR+xZKCiEKmMXTIeXHPGdhYArX8FwG4DGMEnAHIK4yvT58nWC2b73cexaZgWWaEKgU1gjNbPP7PvOYGsUSBkv3hBtmRWNzxjTk9RWktvxp6POj0vARjY9sWkFel8RWxegjIF4RjwAOnZWMPBTGjqvHmszxJOBUD3xyznL2bqROvoP3N3q84jG4C7M/PpcvMBef0cvV9k6hXv+2Yno5QfGArRbaCC0mWv2YtF3ecerNDhkNZIIsXQRv5dlTtGADJSz2gEE1EJQM//026HdIEZLC8B6A0tk0g1Ja8DuzJdphS82QBEZj5dbj7gxZN5er/IZI+67pscgE7QaDOUMyC0Wb8+gXjuR4F5J6YsaXnFhBoAGEVvUhb60jISgCQnoh/OLBgvIrL8v7DdFkEYM5dtNg97tvz5zJqzdfIBmJlPl5sP+DJP5xtW7xffnzeh7H+Z+3+RpkyWT1YxuURJYVtx6T0fCTocouQV85VkHRIGegEuEv/YKpkA/JceVmL8kv6t5/9pu62tfiPWcFQVEa0DZ9WcLJEPwMx8uvfnjT9IgZyj94t/ldeA/S9tMaGa9SNdmsIxbvVscVJ1GScoMt4UPwhAsmMZ0aXzQBsvdGRBjQz0FUpEJRAJQOq4KAnBdz+sfiPJ3bOYn8fsykyVWMfiN3BOzckS+QDMzKe7OW/88aqQzsfE5kH1fvGjeQ0wADodmVGwOeiMsUqHrGOnS4UFy9P/wAEojkEnI+IqOIJQNLgpCXhcmLAtD/D+kgQE235L93tj+YBqgTX9BiCeW/NedT4AmQ+YkU/3sbzxBymQuZhm8g1T+QbV+wWFdjKO/Te2mEFNlCb6gPF708VJ1TXHgKd91GnZpDfi1k/gM2vqU3DUnCuBmNQe3P9vw6pe229KOvB0K1k+ZS+rnrfM2AlA3JMZtah/EZKZT3drxuDz1O/yxAwu9JgJxr3lQfR+8aa8Buy/wdWQZAVl+ZzCrG3q9c/YrkmHy3IRYryAAqAkEBIlopJxNNUbER+fA/H+/+AAdP9PmS9dazicJybm7mlB8nR2dI1HvgVkOlZGPt2nM29GCamcGZjAwlQ+vvrV+8X/zGsAAUiLVPp/wd+zaTMFWw+/kAA0GQQnpCw5mDsAMIrcRB5mC/+MAffTwgfwKY2KfmCZ6ZIkUShrxXxBX4yYaV8Hzmcn13jUA8CMfDqWYeQcSkhVOl8U6uxH7xekrsg49h8oiCENgC5TUG5vKxxT8f2aRtOtcAKQ1s8soPuOVUIwpchNlEEIOyNSIrrvv3hwnckWIZPZsnbcDyzTpvg3lU8mpZQqozyfK74aj3wAKh1LgrsD5tMxiz/nkGD1sHq/YNFOxkEAcuW7oqmXlisuQOT7VV2jwi/kTgj1RkoZhBje8Z83SCAEEJZW0C3gff8tADCt4VASaWIBK0HI9q8BF5yUAMzIp8tNx5Jg9bB6v/jdDPSRns0BWIZeUitIo9IhHmhXTvzCPQddccnZ76U1V/IvC4SBCFyg26DFNg7c++Mhhb6qiCikT7WVUmr6lYn2nRKyrdZ51GMBlZIc07GUBdMjny6XCiUmpA6j94vMZbgBMFo552pu27PXAqXTyAUQcitOQjAm9xX0N9pIwIPmSCmH5QuPqER0L4kDYgp9zOUL6fYxkbZcFceyAreAF3GlV+NRDwAz8uksnT3jiILVSmpWNlhMze+k94vMZfgGAPJeHDjpCrgM01Tdry9OzvmYAzAqLVWIwEShwzbRwwSEn+MqP6bQK5tZlWyhjCCCsC19Xv7gOnBRbgp7cu/5AOyVjqVMmA75dJZ9nHF0yohWNlhMxKnS+0XmMtwAmFq4imnYbrEqNJPc+9kfd62RKh0On8qV9hXZ9askEPgAfI56ziocUgVbzGT28lEtRMoKtg7lBHtznfZNA+CQ+XQWM8k4uglWK/NLYKzS+8U9GReXD0g/Tyvh4Ne17Yb4Zbr6g6y7/aNWcoPpjKRTsJIags5IJwkEAv6en05S6GUBfRWsUExZyVZVQCQwrgN7Wfdd41GPBczIp8ODeXfTSbBa6YYxlY8/p3q/udc3C+jTbtvqt2oadnB2m4oNgMn0W0p+hYWHWbwg9yU/0Kb9EIy+5y2hiCit4UgKyTeAkN8Valk4Le/ldlONRz4AWWBRM6fdIPfHstw/G+SE5rMnVQ/kA5AkLHS0ak7V7reXfhgACaBqDtD3e/nmc5k9kA/A80JReq+U38zGVp3ObJo/BvAOD3dtwiWar9zEHsgHIGlFubqSx7+Jja36anLLcDvvgwA+NDpDfILv+qlzuXwAXuSjrkKemlO2e3U1uWUYnL8dwB/5e2apca9LNv+vsQfyAUheX4VguB+mzIsaG9ntqxhF4Xbe3QD+n7/uHLAW9wQ1tblMRQ/UA0CaHC7plXEh+q4T0OWcfhleYTSHBK0EH/mi+fcRuKQn4I6fWpeoB4AevCz3HOOm9yb3F5mBlZBNclYCj1aRfyfrbgPCTR6AzK+vD4CyglX7jpmN7HY66d1E0ctdIrEEE4wEIMlam+Pk7YF6AMj7EwAVbU82vTerCwhAXopJN9zVI+AYrOeULLZgErY2x8nZA/kAJGWr0naUWdFpy2cT+oCWjpdjLFxE5UzYIBBpEUX5nLnlvAktb76SPVAfAOUHpiAMm96bsVtCAMaKALICMyxDq6cXfycA+b/mOLl6oF4AiqBRIEzBp7/X2Af0+fi1XIioMIlAI+AIPIGPmeROWV3j1Zuvyu2B+gHoFfZiDS2lC0LiY52WUADkQoTTMH1BFSYRdHoRfKSu5v9qrizMHYPT+vx6ARhSuDcAzzmDo5ZGHT1PAKYMwQxME2jiSo/gEwBrrq+u41ZOy++oD4BaCcsXTPiSI3ey8s4KGoG8QwCMFM+0ggQhLR0BF19SXuD/ayakz7uR0/TsMcxg3SjfqWNA0hsrga/ojaq/8WPcC+YIk4Ke4CMSuB2XVht1Oj8zIfXlU8BtU8DhmYRXWdfrdF1fgr3+S8At48CD04DVjXQSDO70PTUnaJ5uOCwsIIFHSSFy1pKPWCDsZxCpw8UVgKSPxLXM937OzxxAljzcPAbcswU4Qh4V3UN8mKoeKm/bu78IfKJQa8VD48CylHQiL3O3/qg5Rf30BKACMtJXjXKQcfBSK8Dfqc3KVCwuN2VFGRnm/yKZtq4Re5ifyQQgM2A+BeB3GHaZBo5MAIue0l7Kt3cC4xhw+5eL7TuCkJk1jBtyerbUfYG5ExjZ/pqrxE5fAOrOq5SmowVIrRp1IyT2R6+fg0bgVYG4CsyZe2UsaiOGKXr4Sfp9k8CxCYAFSKyvXeY1o1BxQux91yMtfsHPutgnnyUuUvhc0ZsgUXib+nVkq6+ZKaABIHsgVZnuwD9sVo66rrR4ImdhLGSQ8zPL/JgBQxeU1ouWkO9PTgDzbgmXxrzMkatl3keivfG5x4r4IRcz5BfkO5vEZ0kgpIfBZ8yKjlL17syy0tMNcOn9dl4Fy6dLFabj1Mpvow9Ify+I4Nlo9Xt+ZqU9VdJpqZh4QDDyxUyYOYJwHDg+DhgI/WUVZl7aSEt93+GO9Ia2iuZKOfA7lhp9JpvAVy61w2mOwO5hmCgMHC1H9O24gu6UD9jP+ZmbtLRaSsei9SL4XDPbAEh/kGQ/pSUcc0lbApFWb67lQUhpVnLBsoKqqZclFMmUtrxPcwxl3X7vOCAtYLSCcugFQmqhdssH7HU+RznjiOlYXA8wqkOfkItTAom+oKygca4ES8jY+N3z7fSG4hfUtp3ihUHruVSsFy1iRvNP+1N7A5BdJACmVpAgZPhGOyCigEjlPLudn7kvFtOxuB4g6OjD8UWLRkCZFRwrLCEXJQQhp2K+37lQeBCRX1A7KPQto1prFEmSYn2mB9EAsO+kYfk8KQhZF8yjVz5gp/MztyOUjiW9bCUhEBhKRCCgSis45uQ/PhX/xfFWMgOnWu2gxB0TF/o0kEZ/kCDM1Ts+3RHYnwVUL6XhDFrAswfIB6w6P1MrTulY0sum1VICglKwCEACqvQFCUK3gHcsFQCM/ILayqP1k9JshVqrncMalOYYvgcGAyCvIwuod8YBJQmZpmGJeyRwkGw4n8jJOJQNw3idLFhMRNB0SgASTJyKoy/4ieXCeFfJBUeV2SoAclFyR0bbm1OHTUiN0/DTAwD7zQeM52dqj8VsGEkVE2jKetG7AEhQ0frJAv6RC0trC1skl+IWlNinGLbSaZg7Mc0xfA8MbgF1LQV1z08A2G8+oM7PVF9Ms2GUE0gQyp+Lwu2yagLgR9ZaYpkSypQ6a6Q2DCqzpkvietXIFdoZfuieGmcOD0DeP0HEbBhNwYPmA/L8zJQsATAKnguEqS+XTqkE4YfWWwCUFZTksYAYwZfIBeN9Tw0cjOwu8gDIZqsoSSvhEeQDiiGYFoyWiSDRypWgi69UP5sc5fIcquSCNeXqe2X9ZAHfM7Khe2pcOB+AT41+aO5iRD3QAHBEHd9ctuiBBoANEkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cvAFgg4GR9kADwJF2f3PxBoANBkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cfOxqYJ2au9RdPtdp/khoEOlglDYT39V1PzQFXLsMXAlgt9PCxJKPbufyf8/KHIPfBPAZABf79Xc5XQ0ZQ1Q7360NbxoHrlsDvs5ZRsgo0une06by6X1mZvtP99PNAp4F4LsBXA5gjw8EGTeqaGF4QhzQF80CX7cAvGIdeDYAfhdZ2sTKUcVrpE7nd31N5gj8e2dIo2osk7NZpMdK0Z19tv+bJ4F9K8D1ACj8yfNSikHeg+5Z969m57Y/8/ZP+dPLKZhP/rcA+AYAF7g1oRUhEMUzFMt6eSJfX78b2DkPfM0i8GIAX+uWlAMppreUUErn8p2gzTl+2flg/sDbTkvIOik+CP20//mzwAXzwDcCuNTPJeFXpEpM6QEjIHm/zTF8D7T5gATYNQCe69aAloRTGulfBESBSYNyxR5g/Bhw7hKwZwl4vk9LnM5JmsBzUyDGAX3B8G23Mz/g9BuUa/0IiutfMkj7zwKmngAuXSvOpUvAWYBtF4BTnspIj/O8zPaf7qdvWITw6eZA0JLQEhKEGgxZhUj/dz3NzSKwbR44exnYvVKcy+mM5Km0JhxInUtrGkmzCPicg3W5LMGkQiZZTm9xS9Z3+4m2o8C5c4X15pTKW2Lb+fCx7WLtjYxzqiql29Icw/dA5SqYf6RTTilg+lYCIXmICKQ4IK9wxfSJY8AZK8CuFWDnanEua9ZTAMsaCog3Dt92O/MvnRGBtGwkqKRmMEkqCaa+2k+0LQDTh4rP88UHj74kF1WaATo9QHQ7mmP4HugYhtEKj4PB6ZQ+FS0hQahpldPya1kXTOqNY8DscgG+HavAttUCvBxInitrkgL4lcO33c7spBdM3kAuSnq2nx9gQfAh4JyVwvrxwel2z3p4aMlzH6DM2z/lT+8aB+Q/OT4EEqckWQSBkGD6EQKQnDCLwBSnYgcf32fXioGUFawC4esyu7CXXnDP9tOCsyD4KLB1rmgvX7zfbu2WG/Jtme0/3U/vKxBNAMoi0KcjkATCN3HOEr3UAjDrwOP71rXixYEkeKMFlSX8ocwR6KUXTJ7AaNE2tF8WfA4Ye7Kw1mwvX/yZn+eKnvcrfzC6IK/ObP/pfnpfAGQnySoISBqUXyAASS1AK0JfagWYcRDOrAF66TxZQU7jBOEbM0egH71gcgXSFZAV54NQtj9YcNIpbONCyh8Ygi8CVospApDuB63g92W2/3Q/vW8AsqM4gLIKBBIH8bcJwMCNMX68BTqBb8s6sGWtsIA6jwDk662ZI9CvXjA5A6NVa2t/IAicnC/aGV+8T74IQPm/AmGuBc+8/VP+9IEAyLslAKMV/LgAyIUInfnjwPQqMOOgI/DstQ5Mr7UAqMF8V2YXDqoXXNl+EQQ6N9v29aKdesUpWJZbAPyPme0/3U8fGIDssDid/pUASCvCaXgJmFguAEfgEXT27gDkuwaUg/nbmSMwjF7whvbLhSDL5TwwvdRqo9oqHzACkCB8U2b7T/fThwIgO01T1IMCoAZxGRhbKoAXQUcQTjkI+a4B5e5FzjGsXvCG9gdqrLGFYrpVG/UuHzBOw2/LaXxzbh43DKeoJwlAHqLndSs4udoCoIBHQE45EPk3DuitmYOQoxdctp8+rFwIWsGFYiFFoLGNchcEQC6e+OJC5J2Z7T/dTx/aApYdJ37AyJK/DIwvFxYvWr0IwEn/H1Opco5sveDUhSAAF4HJpQJkWixp6k2n4IYfMGf0amDHev2I8+l4/UbvNw8Eozw72wJePOJ8und7EkKj9ztKGA1/7WwATo44n45pWI3e7/AAGPWZ2QBkYHCU+XTMfGGQmYIxjd7vqOE0+PXzATjifDrKtTZ6v4MP/MlyRj4AR5xPF+VaqZLJF1UzKdPV6P2eLDDr3I58AI44n07ZMARbo/d78gMubWE+AEecT8e9YOn2Uheu0fs9tUCYD8AR59MpG6bR+z21gKfW1gNAz4geRT5dTEZo9H5PPRDmAzBmRM8BJzqfLiYjSKKr0fs9dYBYDwBHmE9XtRfMsIz04aQZ1+j9npygrA+Akqs8wfl0BCCTWRq935MTYL1aVQ8Ao1zlAnAi8+kEQGZTNXq/vYb75Pt/fQAcUT5dBGCj93vyAaxXi+oDoFLyT3A+3Rcavd9eY3xS/z8fgCQX/LPR3SOzkon55jg1eyAfgD8M4NcAPD6aDmBtB1e4NMDNcer1QD4AbwbwxwDe4UvRE9wHZG1gNSXDLlwLNcep1QP5APxzzwj9IIAPnXhT5ORc5EYCA9HNcWr1QD4AmRH6FQBMTSZZH98ZmD5Bh5g1FopiNns1x6nTA/kAvAfAEwDudnI+EvQxPfkEzYfaCXRSBluQMB7YHKdGD+QDsBNBH/9+AkAobqTADGK7Inw1x8nfA/kA7EXQt8kgrGAGMfBxZ5Cv5ji5eyAfgL0I+r68uR0QmUFoBQU8vfNvzXHy9kA9AORoMw7CdGQCjoUZDwL4kv/+8OZ1gJhBIjGDgMh3vTavBc035/RAPgD7JegjODfhiMwgoqeJwNPPTaB6Ezq/hq+sB4AcXeXEP+ZhGVo9vRimIQD5v5oPAZCupgDI9wg8/qz/1Xz55usyeyAfgMMQ9GU2Op4eAchpOIJQQEz/VuPlm6/K7IH6AMjgGzdl6QtyX5jWjpQFevF3lq3xf6yhrOlIAUgQCojR8gmE+l9Nl2++JrMH6gEgR5UA5KYsc+AZmCbQCDi+IvgEQMob1XBEAHIajgBMLV+0kCdws6aGu3zqfkV9AGTwjftg3JRVVRAtHQEXX/wbAcoXP5d5CID8GoJKvqDAloKOoIz/y7x8c3pmD4zhaqwjRzCYyQg5gr2ZgsFTLweWr8XQgsXjbwLWrnNtMlKgNoLBmZAa7PTCAuYIBlMvlWQswwr2UlUw45jdDSx8HbD+Ctd+HVCwePKbgJV9aASDM8Yg59TWFDysYPBtmYK91IbNOHaPA/M7gUXKXA4hWDz79cA8+W0aweCMURj+1HYfcBjBYO54MMY3tGDv8I3nmWSHOzYOLJ0LLPGXAQWLz3oB8MQUsEa16kYwOG8whjh74yJkUMFgbsNlCfYO0epwissVY34bsHw2sEIRkAEEi/dcU0SP5qhF1ggG5w3GEGdXr4L5134Fg4kAjuDQgr1DtDqcUmZETwArZwAru4BVqsv0KVh8/o3F4v0QXZBGMDhvMIY4u3MYhv95Zh+Cu1xBcxuOU/HfeDIq5cv7FuwdotXhlCBXjOXZAnyrO4BV6in0IVh8wStLuWCsUAyvEQzOG5ABz+4eB+R/ewnu/kOP/3G/l4kJTERlljQtIot2e53/IwO2OPl4FLtcnCqAp9cahT56CBZf+LpSLhhz1N5qBIPzBmTAs/sLRHcTDKbiNHdBGGymOC/3hglEvgjAnoK9A7Y4+XgiV4zVWYDAs/etxaubYPFFP1QkLtCIP8neaASD8wZkwLP7AyC/tJNg8L/xLNBu+YBdBXsHbHEFAINcMVamgdWZAoRrfPdXm8KitLdmgYveWAq+2y7iMqfuRjA4b1AGOLt/APJLqwSD3+y5T1yI0AoSbAxMMzGV1o8/My2ro2DvAK2t+GgiV4zj4+3AIwDXtwBrVJeuECze+9aW4Dut4PxkIhYsdetGMDhvoDqcPRgA+SWp4O4veQ5Uv/mAGwR78+6rQq4Yq9PAOi2fA4/vBkKudKVU7VZw77uKvWFuZbtcMNb5v0YwOG9g+jx7cADyi6Pg7gccgIxlcA5TKhaD01yYKBmVFpBZMfx/m2Bvny3t8LGqoqTliZbVI+gMgHwnMAnCIFi897cLAAZ6QyzFzzSCwXkD1OPs4QDIL5XgLmk5JHk/SD5gKdibd38VcsVYGmuBTaAzEHLHgyCcaokB7/1IkUET5IKxwF5pBIPzBqbPs4cHIC/AaeqvPL9pmHxAE+zts6VdLCD/lcgVY3UyWD0Bj1ZwqgCggXA7sPfWAoAJvaEtZBrB4Lyx6efsPADyCtmCvf00s/NnOsgVY3m8BTRZPZuGBUACdArY+5lWDqGmYbIrLHEx0ggG5w1OH2fnA7CPizQfaXqgUw80AGywMdIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0BxoAjrT7m4s3AGwwMNIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0B8ZYNMbkX+ZekpuIiOQrPar+xs889HJg6jZg5jAwvVZ8B+ll9PlO5/Fc/o+ECjnHfi8zYfkvM5ulmp4qJXVqx5deD4zfAkw/CGxdAZgoHfuh131QkaI5hu8Bs4Ds8B0AWLnIRGCBsFfn87JffDMwdjOw5R5g8giwZa34jnQQUwDo99wBfJ4TM7COiNdlaj2rA/jeV/vfDeATAP4UGH8I2Lrc6gc+SHqY4oMZ74VSKM0xfA+UUzB/oBUUCKMl6zSQ/PsXqZD5KQC/A0w/DEwcAcYXgYnVwppwADuBkefnCim90FmBWXwnK87Uen53BI8sbuwqaz9p5UgnQhBS+ZN1zE8Ak0utviCwq8DI8/nx5hi+Bzb4gJzKZE1SEFZZgS9/2pWR/gTAJ4HJQ8DEMWB8ARhfBsaWCwDquwQKvvNgHXvOcYVbPFJPkw+dDxC/W1Y4tWDpw/Rlgo4lo1T4/KxTihDNpJwj3/UiMLXemprjffC7eWpzDN8DlYsQDiKtVxzEqoHkyX9HRizW+nIgaQnvAiaeBCbmC0s4tgSMu2rMePAR9X252jXklaTFU108K0MHav/nvJ6ZxVVk9OI7GR2IZoGQNc/HgbHgIwqILIVujuF7oOMqWFawCoRxkfEIB5CWgkREBCNf9wMTc8A4QciBWyoGz16rwNgaML5eWKpctYZL3N+TWLX0gvtuP0HHk2n16JDyxXmVhfU0qywbJbr5GSuXKxA/sV5Y9UYWdnjwyS3qKKgarWA69Wg6fjQOIK0HadnIjPVFB+AiME4AuiUkCFnESyCSkmAuU7Cjm15wX+2X2ifBRn9A8mKcW2UFjULVQcgVDl80u40SYh763FfvquhLCxitoBYUsoJfjXKttByMq9CKcHn4sPuCbgXNJwyWkECcz5Q376UX3LNncZyQAAADEklEQVT9fFgIJs6lBBwtn3Tt6FpIz4RWnuQxPh2XIGzm4CwQ9hWIFgBTK0gQHiIAJddKq0ELQh+KL1qUR4MvSEsoENIKrgALHNiMox+94K7tl9qnnMio8MSf6SNwGpYVjCDk/Ju7isq496fCqX0BkDeqlWwKwic1gAQSpzGREnFgREz01eALLvvq2Kfi45m6cf3qBXdsfxRbJMho8dimqOhEK8cXQRr9QVpvPoDNMXQP9A3ACELFxPh+jACkP0fLIKFCCRRqKuPUdqjlC9o07JZwKVNHeBC94DQcZO0XAAkmgotAk9QYrR9f/BvByYfMSATDVMzwTXMM3QMDAVAgVHCZ7/MaQK4QZUHiNCbBQlqUw74YCb7gcmYkelC9YFlwvVv7RRAorTuBkECU9asCID9/x9B935zYzyKkqpfiNHxcA0gLQgvBAaPVkCqm3h2AtC5m/RyEqzw/4xhGL3hD++MmslgqCbgUfLKAcRrmTlBzDN0DA1tAXUlWcDm1IOIIJAjlT/Fd05lbFQFwjdtgGcewesFt7Rc/Gx8iWjUCjGCT1YvWT1MwgUqrf3NG45tTbcu0aximWx9xENcEQHGbcYAEwtSXSqY0gnCdgeuMI0cvuGx/FUGgFhwEYrR80QckWN+X0fjm1DwAWv8RgJFilJZBznz0pQg+AZAAlVWh1GvGka0XzB0cCQi30aSGVa9AF62fLOB7MhrfnJoPwPER59Px+o3e76mL5Kwp2G57xPl0kxc3er+nLvyKtLmhfUC78RHn081ONnq/pzcAR5xPR9mRRu/31IVgvgUccT4dNaobvd/TGYAjzqejumqj93s6A3DE+XRUg2VSCjdaGr3fUw+I+VPwiPPpqJjO8J1Nw43e7ymHwHoAKMFd7QErAeEE5NNJMb3R+z3lsGcNzgfgiPPpomJ6o/d76oGwPgCOKJ8uKqY3er+nKwBHmE+noqRG7/fUA199U/AI8+kEwEbv93QHoEhZTnA+nYqSGr3fBoAtaiqBUImdm5hPJwA2er+nKwBHnE+X1gUzSbnR+z11wPj/AeCpPDD3t7rvAAAAAElFTkSuQmCC",r5e="uniform sampler2D weightMap;varying vec2 vOffset0;varying vec2 vOffset1;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 a;a.x=texture2D(weightMap,vOffset0).a;a.y=texture2D(weightMap,vOffset1).g;a.wz=texture2D(weightMap,uv).rb;vec4 color=inputColor;if(dot(a,vec4(1.0))>=1e-5){bool h=max(a.x,a.z)>max(a.y,a.w);vec4 blendingOffset=vec4(0.0,a.y,0.0,a.w);vec2 blendingWeight=a.yw;movec(bvec4(h),blendingOffset,vec4(a.x,0.0,a.z,0.0));movec(bvec2(h),blendingWeight,a.xz);blendingWeight/=dot(blendingWeight,vec2(1.0));vec4 blendingCoord=blendingOffset*vec4(texelSize,-texelSize)+uv.xyxy;color=blendingWeight.x*texture2D(inputBuffer,blendingCoord.xy);color+=blendingWeight.y*texture2D(inputBuffer,blendingCoord.zw);}outputColor=color;}",s5e="varying vec2 vOffset0;varying vec2 vOffset1;void mainSupport(const in vec2 uv){vOffset0=uv+texelSize*vec2(1.0,0.0);vOffset1=uv+texelSize*vec2(0.0,1.0);}",Qv={LOW:0,MEDIUM:1,HIGH:2,ULTRA:3},bte=class extends Pd{constructor({preset:e=Qv.MEDIUM,edgeDetectionMode:t=cP.COLOR,predicationMode:i=e4e.DISABLED}={}){super("SMAAEffect",r5e,{vertexShader:s5e,blendFunction:Sn.NORMAL,attributes:vd.CONVOLUTION|vd.DEPTH,uniforms:new Map([["weightMap",new Ct(null)]])});let n,r;arguments.length>1&&(n=arguments[0],r=arguments[1],arguments.length>2&&(e=arguments[2]),arguments.length>3&&(t=arguments[3])),this.renderTargetEdges=new mn(1,1,{minFilter:Yi,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetEdges.texture.name="SMAA.Edges",this.renderTargetWeights=this.renderTargetEdges.clone(),this.renderTargetWeights.texture.name="SMAA.Weights",this.uniforms.get("weightMap").value=this.renderTargetWeights.texture,this.clearPass=new V5(!0,!1,!1),this.clearPass.overrideClearColor=new gi(0),this.clearPass.overrideClearAlpha=1,this.edgeDetectionPass=new Vc(new t4e),this.edgeDetectionMaterial.edgeDetectionMode=t,this.edgeDetectionMaterial.predicationMode=i,this.weightsPass=new Vc(new u4e);let s=new _Z;s.onLoad=()=>{let a=new Hr(n);a.name="SMAA.Search",a.magFilter=rn,a.minFilter=rn,a.generateMipmaps=!1,a.needsUpdate=!0,a.flipY=!0,this.weightsMaterial.searchTexture=a;let o=new Hr(r);o.name="SMAA.Area",o.magFilter=Yi,o.minFilter=Yi,o.generateMipmaps=!1,o.needsUpdate=!0,o.flipY=!1,this.weightsMaterial.areaTexture=o,this.dispatchEvent({type:"load"})},s.itemStart("search"),s.itemStart("area"),n!==void 0&&r!==void 0?(s.itemEnd("search"),s.itemEnd("area")):typeof Image<"u"&&(n=new Image,r=new Image,n.addEventListener("load",()=>s.itemEnd("search")),r.addEventListener("load",()=>s.itemEnd("area")),n.src=I7,r.src=L7),this.applyPreset(e)}get edgesTexture(){return this.renderTargetEdges.texture}getEdgesTexture(){return this.edgesTexture}get weightsTexture(){return this.renderTargetWeights.texture}getWeightsTexture(){return this.weightsTexture}get edgeDetectionMaterial(){return this.edgeDetectionPass.fullscreenMaterial}get colorEdgesMaterial(){return this.edgeDetectionMaterial}getEdgeDetectionMaterial(){return this.edgeDetectionMaterial}get weightsMaterial(){return this.weightsPass.fullscreenMaterial}getWeightsMaterial(){return this.weightsMaterial}setEdgeDetectionThreshold(e){this.edgeDetectionMaterial.edgeDetectionThreshold=e}setOrthogonalSearchSteps(e){this.weightsMaterial.orthogonalSearchSteps=e}applyPreset(e){let t=this.edgeDetectionMaterial,i=this.weightsMaterial;switch(e){case Qv.LOW:t.edgeDetectionThreshold=.15,i.orthogonalSearchSteps=4,i.diagonalDetection=!1,i.cornerDetection=!1;break;case Qv.MEDIUM:t.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=8,i.diagonalDetection=!1,i.cornerDetection=!1;break;case Qv.HIGH:t.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=16,i.diagonalSearchSteps=8,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0;break;case Qv.ULTRA:t.edgeDetectionThreshold=.05,i.orthogonalSearchSteps=32,i.diagonalSearchSteps=16,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0;break}}setDepthTexture(e,t=cp){this.edgeDetectionMaterial.depthBuffer=e,this.edgeDetectionMaterial.depthPacking=t}update(e,t,i){this.clearPass.render(e,this.renderTargetEdges),this.edgeDetectionPass.render(e,t,this.renderTargetEdges),this.weightsPass.render(e,this.renderTargetEdges,this.renderTargetWeights)}setSize(e,t){this.edgeDetectionMaterial.setSize(e,t),this.weightsMaterial.setSize(e,t),this.renderTargetEdges.setSize(e,t),this.renderTargetWeights.setSize(e,t)}dispose(){let{searchTexture:e,areaTexture:t}=this.weightsMaterial;e!==null&&t!==null&&(e.dispose(),t.dispose()),super.dispose()}static get searchImageDataURL(){return I7}static get areaImageDataURL(){return L7}},a5e=`uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;
#if VIGNETTE_TECHNIQUE == 0
float d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));
#else
vec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));
#endif
outputColor=vec4(color,inputColor.a);}`,lC={DEFAULT:0,ESKIL:1},o5e=class extends Pd{constructor({blendFunction:e=Sn.NORMAL,technique:t=lC.DEFAULT,eskil:i=!1,offset:n=.5,darkness:r=.5}={}){super("VignetteEffect",a5e,{blendFunction:e,defines:new Map([["VIGNETTE_TECHNIQUE",t.toFixed(0)]]),uniforms:new Map([["offset",new Ct(n)],["darkness",new Ct(r)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(e){this.technique!==e&&(this.defines.set("VIGNETTE_TECHNIQUE",e.toFixed(0)),this.setChanged())}get eskil(){return this.technique===lC.ESKIL}set eskil(e){this.technique=e?lC.ESKIL:lC.DEFAULT}getTechnique(){return this.technique}setTechnique(e){this.technique=e}get offset(){return this.uniforms.get("offset").value}set offset(e){this.uniforms.get("offset").value=e}getOffset(){return this.offset}setOffset(e){this.offset=e}get darkness(){return this.uniforms.get("darkness").value}set darkness(e){this.uniforms.get("darkness").value=e}getDarkness(){return this.darkness}setDarkness(e){this.darkness=e}},up=class{constructor(e,t){this.enabled=!1,this.effect=new e(t),Object.defineProperty(this,"opacity",{enumerable:!0,set(i){this.effect.blendMode.opacity.value=i},get(){return this.effect.blendMode.opacity.value}}),Object.defineProperty(this,"blendFunction",{enumerable:!0,set(i){this.effect.blendMode.setBlendFunction(Number(i))},get(){return this.effect.blendMode.blendFunction}}),this.blendFunction=Sn.NORMAL}},l5e=class extends up{constructor(){super(G4e),this.blendFunction=Sn.SCREEN}set intensity(e){this.effect.intensity=e}get intensity(){return this.effect.intensity}set luminanceThreshold(e){this.effect.luminanceMaterial.threshold=e}get luminanceThreshold(){return this.effect.luminanceMaterial.threshold}set luminanceSmoothing(e){this.effect.luminanceMaterial.smoothing=e}get luminanceSmoothing(){return this.effect.luminanceMaterial.smoothing}set blurScale(e){this.effect.blurPass.scale=e}get blurScale(){return this.effect.blurPass.scale}set kernelSize(e){this.effect.blurPass.kernelSize=e}get kernelSize(){return this.effect.blurPass.kernelSize}},c5e=class extends up{constructor(){super(j4e)}set contrast(e){this.effect.uniforms.get("contrast").value=e}get contrast(){return this.effect.uniforms.get("contrast").value}set brightness(e){this.effect.uniforms.get("brightness").value=e}get brightness(){return this.effect.uniforms.get("brightness").value}},u5e=class extends up{constructor(){super(Q4e),this.effect.offset=new Ae(.01,.01)}set offset(e){this.effect.offset.set(e[0]/1e3,e[1]/1e3)}get offset(){return[this.effect.offset.x*1e3,this.effect.offset.y*1e3]}},h5e=class extends up{constructor(){super(X4e)}},d5e=class extends up{constructor(){super($4e),this._hue=0}set hue(e){this._hue=e,this.effect.setHue(e)}get hue(){return this._hue}set saturation(e){this.effect.uniforms.get("saturation").value=e}get saturation(){return this.effect.uniforms.get("saturation").value}},f5e=class extends up{constructor(){super(t5e),this.blendFunction=Sn.OVERLAY}},p5e=class extends up{constructor(){super(o5e)}get eskil(){return this.effect.eskil}set eskil(e){this.effect.eskil=e}get darkness(){return this.effect.uniforms.get("darkness").value}set darkness(e){this.effect.uniforms.get("darkness").value=e}get offset(){return this.effect.uniforms.get("offset").value}set offset(e){this.effect.uniforms.get("offset").value=e}},m5e=class extends up{constructor(e){super(J4e)}set focalLength(e){this.effect.circleOfConfusionMaterial.uniforms.focalLength.value=e/2e3}get focalLength(){return this.effect.circleOfConfusionMaterial.uniforms.focalLength.value}set focusDistance(e){this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value=this.isPerspectiveCamera?e/2e3:(e+992)/2e3}get focusDistance(){return this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value}get bokehScale(){return this.effect.bokehScale}set bokehScale(e){this.effect.bokehScale=e}setCamera(e){let t=!1;(e.isPerspectiveCamera&&this.isPerspectiveCamera===!1||!e.isPerspectiveCamera&&this.isPerspectiveCamera===!0)&&(t=!0),e.isPerspectiveCamera?(this.effect.circleOfConfusionMaterial.adoptCameraSettings(e.perspCamera),this.isPerspectiveCamera=!0):(this.effect.circleOfConfusionMaterial.adoptCameraSettings(e),this.isPerspectiveCamera=!1),t&&this.effect.setChanged()}},g5e=class extends up{constructor(){super(n5e)}get granularity(){return this.effect.getGranularity()}set granularity(e){this.effect.setGranularity(e)}},v5e=`#define GLSLIFY 1
varying vec2 vUv;varying vec2 vTexCoords[9];uniform vec2 resolution;void main(){vUv=position.xy*0.5+0.5;vec2 texelSize=vec2(1.0)/resolution;vTexCoords[0]=vUv+vec2(-texelSize.x,-texelSize.y);vTexCoords[1]=vUv+vec2(0.0,-texelSize.y);vTexCoords[2]=vUv+vec2(texelSize.x,-texelSize.y);vTexCoords[3]=vUv+vec2(-texelSize.x,0.0);vTexCoords[4]=vUv+vec2(0.0,0.0);vTexCoords[5]=vUv+vec2(texelSize.x,0.0);vTexCoords[6]=vUv+vec2(-texelSize.x,texelSize.y);vTexCoords[7]=vUv+vec2(0.0,texelSize.y);vTexCoords[8]=vUv+vec2(texelSize.x,texelSize.y);gl_Position=vec4(position.xy,1.0,1.0);}`,y5e=`#define GLSLIFY 1
#include <common>
varying vec2 vUv;varying vec2 vTexCoords[9];uniform sampler2D inputBuffer;uniform sampler2D historyBuffer;uniform sampler2D velocityBuffer;uniform sampler2D depthBuffer;uniform vec2 resolution;
#define USE_YCOCG
#define USE_CATMULL_ROM
const float feedback_min=0.5;const float feedback_max=0.95;vec3 RGB_YCoCg(vec3 c){return vec3(c.x/4.0+c.y/2.0+c.z/4.0,c.x/2.0-c.z/2.0,-c.x/4.0+c.y/2.0-c.z/4.0);}vec3 YCoCg_RGB(vec3 c){return clamp(vec3(c.x+c.y-c.z,c.x+c.z,c.x-c.y-c.z),vec3(0.0),vec3(1.0));}vec4 sample_color(sampler2D tex,vec2 uv){
#ifdef USE_YCOCG
vec4 c=texture(tex,uv);return vec4(RGB_YCoCg(c.rgb),c.a);
#else
return texture(tex,uv);
#endif
}vec4 sample_catmull_rom(sampler2D tex,vec2 uv,vec2 texSize){vec2 samplePos=uv*texSize;vec2 texPos1=floor(samplePos-0.5)+0.5;vec2 f=samplePos-texPos1;vec2 w0=f*(-0.5+f*(1.0-0.5*f));vec2 w1=1.0+f*f*(-2.5+1.5*f);vec2 w2=f*(0.5+f*(2.0-1.5*f));vec2 w3=f*f*(-0.5+0.5*f);vec2 w12=w1+w2;vec2 offset12=w2/(w1+w2);vec2 texPos0=texPos1-1.0;vec2 texPos3=texPos1+2.0;vec2 texPos12=texPos1+offset12;texPos0/=texSize;texPos3/=texSize;texPos12/=texSize;vec4 result=vec4(0.0);result+=texture2D(tex,vec2(texPos12.x,texPos0.y))*w12.x*w0.y;result+=texture2D(tex,vec2(texPos0.x,texPos12.y))*w0.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos12.y))*w12.x*w12.y;result+=texture2D(tex,vec2(texPos3.x,texPos12.y))*w3.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos3.y))*w12.x*w3.y;return result;}vec3 choose_motion_vector(){
#ifdef CHOOSE_LONGEST_MOTION_VECTOR
float longest=-1.0;vec3 v_choose=vec3(-1.0);for(int i=0;i<9;i++){vec3 v=texture2D(velocityBuffer,vTexCoords[i]).rgb;float l=length(v.xy);if(l>longest){longest=l;v_choose=v;}}return v_choose;
#else
float closest_depth=1000.0;vec2 closest_uv_offset=vec2(0.0);for(int i=0;i<9;i++){float neighbor_depth=texture2D(depthBuffer,vTexCoords[i]).r;if(neighbor_depth<closest_depth){closest_uv_offset=vTexCoords[i];closest_depth=neighbor_depth;}}return texture2D(velocityBuffer,closest_uv_offset).rgb;
#endif
}vec4 clipAabb(vec3 aabb_min,vec3 aabb_max,vec4 avg,vec4 input_texel){const float FLT_EPS=0.00000001;vec3 p_clip=0.5*(aabb_max+aabb_min);vec3 e_clip=0.5*(aabb_max-aabb_min)+FLT_EPS;vec4 v_clip=input_texel-vec4(p_clip,avg.w);vec3 v_unit=v_clip.xyz/e_clip;vec3 a_unit=abs(v_unit);float ma_unit=max(a_unit.x,max(a_unit.y,a_unit.z));if(ma_unit>1.0){return vec4(p_clip,avg.w)+v_clip/ma_unit;}else{return input_texel;}}vec3 clip_aabb_variance(in vec3 cOld,in vec3 cNew,in vec3 centre,in vec3 halfSize){if(all(lessThanEqual(abs(cOld-centre),halfSize))){return cOld;}vec3 dir=(cNew-cOld);vec3 near=centre-sign(dir)*halfSize;vec3 tAll=(near-cOld)/dir;float t=0.0001;for(int i=0;i<3;i++){if(tAll[i]>=0.0&&tAll[i]<t){t=tAll[i];}}if(t>=0.0001){return cOld;}return cOld+dir*t;}void main(){vec3 v=choose_motion_vector();vec2 velocity=v.rg;vec2 previousPixelPos=vUv-velocity;vec4 currentColor=sample_color(inputBuffer,vUv);
#ifdef USE_CATMULL_ROM
vec4 previousColor=sample_catmull_rom(historyBuffer,previousPixelPos,resolution);
#else
vec4 previousColor=sample_color(historyBuffer,previousPixelPos);
#endif
#ifdef USE_YCOCG
previousColor=vec4(RGB_YCoCg(previousColor.rgb),previousColor.a);
#endif
vec4 ctl=sample_color(inputBuffer,vTexCoords[0]);vec4 ctc=sample_color(inputBuffer,vTexCoords[1]);vec4 ctr=sample_color(inputBuffer,vTexCoords[2]);vec4 cml=sample_color(inputBuffer,vTexCoords[3]);vec4 cmc=sample_color(inputBuffer,vTexCoords[4]);vec4 cmr=sample_color(inputBuffer,vTexCoords[5]);vec4 cbl=sample_color(inputBuffer,vTexCoords[6]);vec4 cbc=sample_color(inputBuffer,vTexCoords[7]);vec4 cbr=sample_color(inputBuffer,vTexCoords[8]);vec4 cmin=min(ctl,min(ctc,min(ctr,min(cml,min(cmc,min(cmr,min(cbl,min(cbc,cbr))))))));vec4 cmax=max(ctl,max(ctc,max(ctr,max(cml,max(cmc,max(cmr,max(cbl,max(cbc,cbr))))))));vec4 cavg=(ctl+ctc+ctr+cml+cmc+cmr+cbl+cbc+cbr)/9.0;vec4 cmin5=min(ctc,min(cml,min(cmc,min(cmr,cbc))));vec4 cmax5=max(ctc,max(cml,max(cmc,max(cmr,cbc))));vec4 cavg5=(ctc+cml+cmc+cmr+cbc)/5.0;cmin=0.5*(cmin+cmin5);cmax=0.5*(cmax+cmax5);cavg=0.5*(cavg+cavg5);
#ifdef USE_YCOCG
vec2 chroma_extent=vec2(0.25*0.5*(cmax.r-cmin.r));vec2 chroma_center=currentColor.gb;cmin.yz=chroma_center-chroma_extent;cmax.yz=chroma_center+chroma_extent;cavg.yz=chroma_center;
#endif
vec4 previousColorClipped=clamp(previousColor,cmin,cmax);
#ifdef LUMINANCE_DIFFERENCES
#ifdef USE_YCOCG
float lum0=currentColor.r;float lum1=previousColorClipped.r;
#else
float lum0=luminance(currentColor.rgb);float lum1=luminance(previousColorClipped.rgb);
#endif
float unbiased_diff=abs(lum0-lum1)/max(lum0,max(lum1,0.2));float unbiased_weight=1.0-unbiased_diff;float unbiased_weight_sqr=unbiased_weight*unbiased_weight;float k_feedback=mix(feedback_min,feedback_max,unbiased_weight_sqr);vec4 result=mix(currentColor,previousColorClipped,vec4(k_feedback));
#else
const float alpha=0.1;vec4 result=mix(currentColor,previousColorClipped,1.0-alpha);
#endif
#ifdef USE_YCOCG
gl_FragColor=vec4(YCoCg_RGB(result.rgb).rgb,result.a);
#else
gl_FragColor=result;
#endif
}`,x5e=`#define GLSLIFY 1
varying vec2 vUv;void main(){gl_Position=vec4(position.xy,1.0,1.0);vUv=position.xy*0.5+0.5;}`,b5e=`#define GLSLIFY 1
layout(location=1)out vec4 gVelocity;varying vec2 vUv;uniform sampler2D inputBuffer;void main(){gl_FragColor=texture2D(inputBuffer,vUv);gVelocity=vec4(0.0);}`,yz=class extends vn{constructor(){super({name:"PassthroughMaterial",uniforms:{inputBuffer:new Ct(null)},blending:Rs,depthWrite:!1,depthTest:!1,vertexShader:x5e,fragmentShader:b5e})}set inputBuffer(e){this.uniforms.inputBuffer.value=e}},S5e=class extends rl{constructor(){super("TAAResolvePass"),this.MRTCompatible=!0,this.needsSwap=!1,this.passThroughMaterial=new yz,this.resolutionVector=new Ae,this.resolveMaterial=new vn({name:"TAAResolveMaterial",uniforms:{inputBuffer:new Ct(null),historyBuffer:new Ct(null),velocityBuffer:new Ct(null),depthBuffer:new Ct(null),resolution:new Ct(new Ae)},blending:Rs,depthWrite:!1,depthTest:!1,vertexShader:v5e,fragmentShader:y5e}),this.historyRenderTarget=new mn(1024,1024,{minFilter:Yi,stencilBuffer:!1,depthBuffer:!1}),this.historyRenderTarget.texture.name="TAA.History",this.resultRenderTarget=new mn(1024,1024,{minFilter:Yi,stencilBuffer:!1,depthBuffer:!1}),this.resultRenderTarget.texture.name="TAA.Output"}setSize(e,t){this.historyRenderTarget.setSize(e,t),this.resultRenderTarget.setSize(e,t)}render(e,t){this.fullscreenMaterial=this.resolveMaterial,this.resolveMaterial.uniforms.inputBuffer.value=t.texture[0],this.resolveMaterial.uniforms.velocityBuffer.value=t.texture[1],this.resolveMaterial.uniforms.depthBuffer.value=t.depthTexture,this.resolveMaterial.uniforms.historyBuffer.value=this.historyRenderTarget.texture,this.resolveMaterial.uniforms.resolution.value.set(t.width,t.height),e.setRenderTarget(this.resultRenderTarget),e.render(this.scene,this.camera),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,e.setRenderTarget(this.historyRenderTarget),e.render(this.scene,this.camera);let i=this.renderToScreen?null:t;this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,e.setRenderTarget(i),e.render(this.scene,this.camera)}dispose(){this.resultRenderTarget.dispose(),this.historyRenderTarget.dispose(),this.resolveMaterial.dispose(),this.passThroughMaterial.dispose()}},_5e=class extends rl{constructor(e,t,i){super("TransmissionPass",void 0,t),this.MRTCompatible=!0,this.depthPass=new O7(e,t,{renderTarget:i.transmissionDepthTarget}),this.passThroughMaterial=new yz,this.splineScene=e,this.needsSwap=!1}updatePasses(e){this.passThroughMaterial=new yz,this.depthPass=new O7(this.splineScene,this.camera,{renderTarget:e.transmissionDepthTarget})}setCamera(e){this.camera=e}setScene(e){this.splineScene=e}render(e,t,i){let n=this.camera.layers.mask,r=e;r.setRenderTarget(r.transmissionRenderTarget),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=t.texture[0],r.clear(),r.render(this.scene,this.camera),this.camera.layers.disable(3),this.depthPass.render(e,t,i),r.shadowMap.needsUpdate=!1,r.shadowMap.autoUpdate=!1;let s=this.renderToScreen?null:t;this.camera.layers.set(3),e.setRenderTarget(s),e.render(this.splineScene,this.camera),this.camera.layers.mask=n}},U7=new Pl,A5e=new vn({transparent:!0,vertexShader:`
        void main() {
            gl_Position = vec4(0.0);
        }
    `,fragmentShader:`
        layout(location = 1) out vec4 gVelocity;

        void main() {
            gl_FragColor = vec4(0.0);
			gVelocity = vec4(0.0);
        }
    `}),xz=class extends rl{constructor(e,t,i){super("OpaquePass",t??U7,i),this.MRTCompatible=!0,this.originalMaterials=[],this.hasTransmissionPass=!1,this.clear=!0,this.clearColorOnly=!1,this.clearDepth=!1,this.needsSwap=!1,this.MRTCompatible=e}setCamera(e){this.camera=e}setScene(e){this.scene=e??U7}getScene(){return this.scene}render(e,t){this.camera.layers.enable(3),this.hasTransmissionPass&&(this.originalMaterials.length=0,this.scene.traverse(n=>{n.layers.isEnabled(3)&&n instanceof nl&&(this.originalMaterials.push([n,n.material]),n.material=A5e)}),e.shadowMap.needsUpdate=!0,e.shadowMap.autoUpdate=!0),this.camera.layers.enable(8);let i=this.renderToScreen?null:t;e.setRenderTarget(i),this.clearColorOnly&&e.clear(!0,!1,!0),this.clear&&e.clear(),e.render(this.scene,this.camera),this.clearDepth&&e.clear(!1,!0,!1),this.hasTransmissionPass&&this.originalMaterials.forEach(n=>{n[0].material=n[1]})}},w5e=class{constructor(e,{depthBuffer:t=!0,stencilBuffer:i=!1,multisampling:n=0,frameBufferType:r=0}={}){this.renderer=e,this.helperStartIndex=0,this.copyPass=new vz,this.depthTexture=null,this.timer=new V4e,this._width=1,this._height=1,this.passes=[],this.helperPasses=[],this.autoRenderToScreen=!0,this.inputBuffer=this.createBuffer(t,i,r,n,!0,"input buffer mrt"),this.inputBufferSingle=this.createBuffer(t,i,r,n,!1," input buffer single"),this.inputBufferSingle.texture.dispose(),this.inputBufferSingle.depthTexture.dispose(),this.inputBufferSingle.texture=this.inputBuffer.texture[0],this.inputBufferSingle.depthTexture=this.inputBuffer.depthTexture,this.outputBuffer=this.inputBuffer.clone(),this.outputBuffer.name="output buffer mrt",this.outputBufferSingle=this.createBuffer(t,i,r,n,!1,"output buffer single"),this.outputBufferSingle.texture.dispose(),this.outputBufferSingle.depthTexture.dispose(),this.outputBufferSingle.texture=this.outputBuffer.texture[0],this.outputBufferSingle.depthTexture=this.outputBuffer.depthTexture,this.setRenderer(e)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(e){let t=this.inputBuffer,i=this.multisampling;i>0&&e>0?(this.inputBuffer.samples=e,this.outputBuffer.samples=e,this.inputBuffer.dispose(),this.outputBuffer.dispose()):i!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("creating new input buffer"),this.inputBuffer=this.createBuffer(t.depthBuffer,t.stencilBuffer,t.texture.type,e,!0,"new input buffer"),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(e){var t;if(this.renderer=e,e!==null){let i=e.getSize(new Ae),n=((t=e.getContext().getContextAttributes())==null?void 0:t.alpha)??!1,r=this.inputBuffer.texture[0].type;r===bo&&e.outputEncoding===Gi&&(this.inputBuffer.texture[0].encoding=Gi,this.outputBuffer.texture[0].encoding=Gi,this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("doing some kinda dispose??")),e.autoClear=!1,this.setSize(i.width,i.height,!1);for(let s of this.passes)s.initialize(e,n,r)}}replaceRenderer(e,t=!0){let i=this.renderer,n=i.domElement.parentNode;return this.setRenderer(e),t&&n!==null&&(n.removeChild(i.domElement),n.appendChild(e.domElement)),i}createDepthTexture(){let e=this.depthTexture=new tb(this._width,this._height);return this.inputBuffer.depthTexture=e,this.inputBuffer.stencilBuffer?(e.format=L0,e.type=b0):e.type=Ff,e}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(let e of this.passes)e.setDepthTexture(null)}}createBuffer(e,t,i,n,r,s){let a=this.renderer,o=a===null?new Ae:a.getDrawingBufferSize(new Ae),l={minFilter:Yi,magFilter:Yi,wrapS:Ar,wrapT:Ar,stencilBuffer:t,depthBuffer:e},c;return n>0?(c=new mn(o.width,o.height,l),c.samples=n):(r?(c=new QJ(o.width,o.height,2,l),c.texture[1].type=ip):c=new mn(o.width,o.height,l),c.depthTexture=new tb(2048,2048),c.depthTexture.type=Zn),i===bo&&a!==null&&a.outputEncoding===Gi&&(Array.isArray(c.texture)?c.texture.forEach(u=>u.encoding=Gi):c.texture.encoding=Gi),Array.isArray(c.texture)?c.texture.forEach((u,h)=>{u.name=`EffectComposer.Buffer ${r} ${h}`,u.generateMipmaps=!1}):(c.texture.name=`EffectComposer.Buffer ${r}`,c.texture.generateMipmaps=!1),c.name=s,c}addPass(e,t){var o;let i=this.passes,n=this.renderer,r=n.getDrawingBufferSize(new Ae),s=((o=n.getContext().getContextAttributes())==null?void 0:o.alpha)??!1,a;if(e.MRTCompatible&&(a=this.inputBuffer.texture[0].type),e.MRTCompatible||(a=this.inputBuffer.texture.type),e.setRenderer(n),e.setSize(r.width,r.height),e.initialize(n,s,a),this.autoRenderToScreen&&(i.length>0&&(i[i.length-1].renderToScreen=!1),e.renderToScreen&&(this.autoRenderToScreen=!1)),t!==void 0?i.splice(t,0,e):i.push(e),this.autoRenderToScreen&&(i[i.length-1].renderToScreen=!0),e.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){let l=this.createDepthTexture();for(e of i)e.setDepthTexture(l)}else e.setDepthTexture(this.depthTexture)}setHelperStartIndex(e){this.helperStartIndex=e}removePass(e){let t=this.passes,i=t.indexOf(e);if(i!==-1&&t.splice(i,1).length>0){if(this.depthTexture!==null){let n=(r,s)=>r||s.needsDepthTexture;t.reduce(n,!1)||e.getDepthTexture()===this.depthTexture&&e.setDepthTexture(null)}this.autoRenderToScreen&&i===t.length&&(e.renderToScreen=!1,t.length>0&&(t[t.length-1].renderToScreen=!0))}}removeAllPasses(){let e=this.passes;e.length>0&&(this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!1),this.passes=[])}render(e){let t=this.renderer,i=this.copyPass,n=this.inputBuffer,r=this.outputBuffer,s=this.inputBufferSingle,a=this.outputBufferSingle,o=!1,l,c,u,h;e===void 0&&(e=this.timer.update().getDelta());for(let d of this.passes)d.enabled&&(d.MRTCompatible?d.render(t,n,r,e,o):d.render(t,s,a,e,o),d.needsSwap&&(o&&(i.renderToScreen=d.renderToScreen,l=t.getContext(),c=t.state.buffers.stencil,c.setFunc(l.NOTEQUAL,1,4294967295),i.render(t,n,r,e,o),c.setFunc(l.EQUAL,1,4294967295)),u=n,h=s,n=r,s=a,r=u,a=h),d instanceof z4e?o=!0:d instanceof f4e&&(o=!1))}setSize(e,t,i){let n=this.renderer;if(this._width=e,this._height=t,e===void 0||t===void 0){let s=n.getSize(new Ae);e=s.width,t=s.height}n.setSize(e,t,i);let r=n.getDrawingBufferSize(new Ae);this.inputBuffer.setSize(r.width,r.height),this.outputBuffer.setSize(r.width,r.height),this.inputBufferSingle.setSize(r.width,r.height),this.outputBufferSingle.setSize(r.width,r.height);for(let s of this.passes)s.setSize(r.width,r.height)}reset(){let e=this.timer.isAutoResetEnabled();this.dispose(),this.autoRenderToScreen=!0,this.timer.setAutoResetEnabled(e)}dispose(){for(let e of this.passes)e.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.inputBufferSingle!==null&&this.inputBufferSingle.dispose(),this.outputBufferSingle!==null&&this.outputBufferSingle.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose()}},M5e=new vn({name:"CombineMaterial",uniforms:{inputBufferA:new Ct(null),inputBufferB:new Ct(null)},blending:Rs,depthWrite:!1,depthTest:!1,vertexShader:`
varying vec2 vUv;
void main() {
    gl_Position = vec4(position.xy, 1.0, 1.0);
    vUv = position.xy * 0.5 + 0.5;
}
`,fragmentShader:`
    varying vec2 vUv;
    uniform sampler2D inputBufferA;
    uniform sampler2D inputBufferB;

    // TODO: Why do we need these when postpro of framemode is enabled???
    layout(location = 1) out vec4 gVelocity;

    void main() {
	vec4 resA = texture2D(inputBufferA, vUv);
	vec4 resB = texture2D(inputBufferB, vUv);
    float a = resA.a + resB.a * ( 1.0 - resA.a );

	vec4 res;
	res.rgb =  resA.rgb + (resB.rgb * (1.0 - resA.a));
	res.a = resA.a + resB.a * (1.0 - resA.a);
	gl_FragColor = res;
    gVelocity = vec4(0.0);
    }
`}),E5e=class extends rl{constructor(e){super("HelperPass",void 0,e),this.MRTCompatible=!1,this.fullscreenMaterial=M5e,this.helperPass=new xz(!1,void 0,this.camera),this.helperPass.hasTransmissionPass=!1,this.helperPass.clear=!1,this.helperPass.renderToScreen=!1,this.helperPassOnTop=new xz(!1,void 0,this.camera),this.helperPassOnTop.hasTransmissionPass=!1,this.helperPassOnTop.clear=!1,this.helperPassOnTop.renderToScreen=!1;let t=new bte({preset:Qv.LOW,edgeDetectionMode:cP.COLOR});this.effectPass=new W3(this.camera,t),this.rt=new mn(10,10,{minFilter:Yi,magFilter:Yi,wrapS:Ar,wrapT:Ar,depthBuffer:!0})}setSize(e,t){this.rt.setSize(e,t),this.effectPass.setSize(e,t)}set sceneHelpers(e){this.helperPass.setScene(e)}get sceneHelpers(){return this.helperPass.getScene()}set sceneHelpersOnTop(e){this.helperPassOnTop.setScene(e)}get sceneHelpersOnTop(){return this.helperPassOnTop.getScene()}setCamera(e){this.helperPass.setCamera(e),this.helperPassOnTop.setCamera(e)}initialize(e,t,i){super.initialize(e,t,i),this.effectPass.initialize(e,t,i)}dispose(){super.dispose(),this.rt.dispose(),this.effectPass.dispose()}render(e,t,i){this.rt.depthTexture=t.depthTexture;let n=e.getClearAlpha();e.setClearAlpha(0),this.helperPass.clearDepth=!0,this.helperPass.clearColorOnly=!0,this.helperPass.render(e,this.rt),this.helperPassOnTop.render(e,this.rt),this.effectPass.renderToScreen=!1,this.effectPass.render(e,this.rt,i),this.fullscreenMaterial.uniforms.inputBufferA.value=i.texture,this.fullscreenMaterial.uniforms.inputBufferB.value=t.texture,e.setClearAlpha(n),e.setRenderTarget(null),e.clear(),e.render(this.scene,this.camera)}},T5e=`#define GLSLIFY 1
#include <skinning_pars_vertex>
#include <morphtarget_pars_vertex>
out vec3 n;void main(){
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
vec4 view_space=viewMatrix*modelMatrix*vec4(transformed,1.0);gl_Position=projectionMatrix*view_space;n=normalize(transformedNormal);}`,C5e=`#define GLSLIFY 1
in vec3 n;void main(){gl_FragColor=vec4(n,1.0);}`,D5e=`#define GLSLIFY 1
out vec2 v_uv;void main(){v_uv=uv;gl_Position=vec4(position.xy,1.0,1.0);}`,R5e=`#define GLSLIFY 1
in vec2 v_uv;const float pi=3.14159265;const float num_steps=4.0;const float num_directions=4.0;uniform float near;uniform float far;uniform float fov;uniform vec4 proj_info;uniform bool is_ortho;uniform vec2 resolution;uniform float radius_of_influence;uniform float radius_in_screen_space;uniform float exponent;uniform vec3 ao_color;uniform float bias;uniform sampler2D texture_depth;uniform sampler2D texture_normals;uniform sampler2D texture_blue_noise;uniform sampler2D texture_blue_noise_in_disk;uniform sampler2D texture_color_pass;uniform int frame_index;uniform bool fog_enabled;uniform float fog_near;uniform float fog_far;vec3 uv_to_view_space(vec2 uv,float eye_z){return vec3((uv*proj_info.xy+proj_info.zw)*(is_ortho ? 1.0 : eye_z),eye_z);}float linearize_depth(float depth_sampled){float z=is_ortho ? depth_sampled : depth_sampled*2.0-1.0;return mix((2.0*near*far)/(far+near-z*(far-near)),near+z*(far-near),float(is_ortho));}vec3 get_view_position(vec2 uv_coords){float linear_depth=linearize_depth(texture(texture_depth,uv_coords).x);return uv_to_view_space(uv_coords,linear_depth);}vec3 min_difference(vec3 p,vec3 right,vec3 left){vec3 v1=right-p;vec3 v2=p-left;return(dot(v1,v1)<dot(v2,v2))? v1 : v2;}vec3 rebuild_normal(in vec2 uv,in vec3 p){vec2 one_over_resolution=1.0/resolution;vec3 r=get_view_position(uv+vec2(one_over_resolution.x,0));vec3 l=get_view_position(uv+vec2(-one_over_resolution.x,0));vec3 t=get_view_position(uv+vec2(0,one_over_resolution.y));vec3 b=get_view_position(uv+vec2(0,-one_over_resolution.y));return normalize(cross(min_difference(p,r,l),min_difference(p,t,b)));}float falloff(float distance_squared){float neg_inv_r2=-1.0/(radius_of_influence*radius_of_influence);return distance_squared*neg_inv_r2+1.0;}float ao_contribution(vec3 P,vec3 N,vec3 S){vec3 to_sample=S-P;float norm_squared=dot(to_sample,to_sample);float norm=sqrt(norm_squared);float cos_theta=dot(N,to_sample)/norm;return clamp(cos_theta-bias,0.0,1.0)*clamp(falloff(norm_squared),0.0,1.0);}float compute_ambient_occlusion(vec2 uv,float radius_in_screen_space,vec3 pc,vec3 view_space_n){vec2 one_over_resolution=1.0/resolution;ivec2 noise_uv=ivec2(int(mod(gl_FragCoord.x,128.0)),int(mod(gl_FragCoord.y,128.0)));float noise=texelFetch(texture_blue_noise,noise_uv,0).r;noise=fract(noise+0.61803398875*float(frame_index));float theta=noise*2.0*3.1415;float ct=cos(theta);float st=sin(theta);float step_size=radius_in_screen_space/(num_steps+1.0);const float angle_step=2.0*pi/num_directions;float contribution=0.0;for(int i=0;i<int(num_directions);++i){float current_pixel=step_size+1.0;for(int j=0;j<int(num_steps);++j){int index=i*int(num_steps)+j;vec2 blue_noise_sample=texelFetch(texture_blue_noise_in_disk,ivec2(index,0),0).rg;vec2 disk_point;disk_point.x=blue_noise_sample.x*ct-blue_noise_sample.y*st;disk_point.y=blue_noise_sample.x*st+blue_noise_sample.y*ct;vec2 sample_direction=disk_point;vec2 snapped_uv=round(current_pixel*sample_direction)*one_over_resolution+uv;vec3 ps=get_view_position(snapped_uv);current_pixel+=step_size;contribution+=ao_contribution(pc,view_space_n,ps);}}float mult=1.0/(1.0-bias);contribution*=mult/(num_directions*num_steps);return clamp(1.0-contribution*2.0,0.0,1.0);}
#define USE_GBUFFER_NORMALS
void main(){vec3 view_space_p=get_view_position(v_uv);
#ifdef USE_GBUFFER_NORMALS
vec3 view_space_n=texture(texture_normals,v_uv).rgb;view_space_n.z*=-1.0;
#else
vec3 view_space_n=-rebuild_normal(v_uv,view_space_p);
#endif
float radius_ss=radius_in_screen_space/(is_ortho ? 1.0 : view_space_p.z);float ao=compute_ambient_occlusion(v_uv,radius_ss,view_space_p,view_space_n);float final=pow(ao,exponent);if(view_space_p.z>=far){final=1.0;}vec3 color=mix(ao_color,vec3(1.0),final);if(fog_enabled){float fog_factor=smoothstep(fog_near,fog_far,view_space_p.z);color=mix(color,vec3(1.0),fog_factor);}gl_FragColor=vec4(color,1.0);}`,P5e=`#define GLSLIFY 1
out vec2 v_uv;void main(){gl_Position=vec4(position.xy,1.0,1.0);v_uv=uv;}`,O5e=`#define GLSLIFY 1
in vec2 v_uv;uniform sampler2D texture_ao_lrez;uniform sampler2D texture_depth_lrez;uniform sampler2D texture_depth_hrez;uniform float near;uniform float far;float linearize_depth(float depth_sampled){float z=depth_sampled*2.0-1.0;return(2.0*near*far)/(far+near-z*(far-near));}vec2 nearest_depth_filter(in vec2 uv){vec2 resolution=vec2(textureSize(texture_depth_lrez,0));vec2 texel_size=1.0/resolution;vec2 offset=uv-0.5*texel_size;float d_hrez=texture(texture_depth_hrez,uv).r;float a=abs(d_hrez-texture(texture_depth_lrez,offset).r);float b=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,0.0)).r);float c=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(0.0,texel_size.y)).r);float d=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,texel_size.y)).r);float min_diff=min(a,min(b,min(c,d)));if(min_diff==a)return offset;if(min_diff==b)return offset+vec2(texel_size.x,0.0);if(min_diff==c)return offset+vec2(0.0,texel_size.y);if(min_diff==d)return offset+vec2(texel_size.x,texel_size.y);}void main(){
#ifdef DEBUG
float d_lrez=texture(texture_depth_lrez,v_uv).r;float d_hrez=texture(texture_depth_hrez,v_uv).r;float output_d=mix(linearize_depth(d_lrez)/far,linearize_depth(d_hrez)/far,step(0.5,v_uv.x));gl_FragColor=vec4(vec3(output_d),1.0);
#else
vec2 filtered_uv=nearest_depth_filter(v_uv);vec4 ao=texture(texture_ao_lrez,filtered_uv);gl_FragColor=vec4(ao.rgb,1.0);gl_FragColor=ao;
#endif
}`,X_=[[.478712,.875764],[-.337956,-.793959],[-.955259,-.028164],[.864527,.325689],[.209342,-.395657],[-.106779,.672585],[.156213,.235113],[-.413644,-.082856],[-.415667,.323909],[.141896,-.93998],[.954932,-.182516],[-.766184,.410799],[-.434912,-.458845],[.415242,-.078724],[.728335,-.491777],[-.058086,-.066401],[.20299,.686837],[-.808362,-.556402],[.507386,-.640839],[-.723494,-.22924],[.48974,.317826],[-.622663,.765301],[-.01064,.929347],[.663146,.647618],[-.096674,-.413835],[.525945,-.321063],[-.122533,.366019],[.195235,-.687983],[-.563203,.098748],[.418563,.561335],[-.378595,.800367],[.826922,.001024],[-.085372,-.766651],[-.92192,.183673],[-.590008,-.721799],[.167751,-.164393],[.032961,-.56253],[.6329,-.107059],[-.46408,.569669],[-.173676,-.958758],[-.242648,-.234303],[-.275362,.157163],[.382295,-.795131],[.562955,.115562],[.190586,.470121],[.770764,-.297576],[.237281,.93105],[-.666642,-.455871],[-.905649,-.298379],[.33952,.157829],[.701438,-.7041],[-.062758,.160346],[-.220674,.957141],[.642692,.432706],[-.77339,-.015272],[-.671467,.24688],[.158051,.062859],[.806009,.527232],[-.05762,-.247071],[.333436,-.51671],[-.550658,-.315773],[-.652078,.589846],[.008818,.530556],[-.210004,.519896]],B5e=new vn({vertexShader:T5e,fragmentShader:C5e}),Xx=new vn({vertexShader:P5e,fragmentShader:O5e,uniforms:{texture_ao_lrez:new Ct(null),texture_depth_lrez:new Ct(null),texture_depth_hrez:new Ct(null),near:new Ct(null),far:new Ct(null)}}),I5e=class extends rl{constructor(e,t){super("AmbientOcclusionPass",void 0,t),this.fogEnabled=!1,this.fogNear=1,this.fogFar=1e3,this.frameIndex=0,this._runHalfRes=!0,this._width=1,this._height=1;let i=1024,n=1024;this.gBuffer=new mn(i,n,{type:dM?ip:Zn,depthTexture:new tb(i,n),minFilter:Yi,magFilter:Yi}),this.depthBufferHighRes=new mn(i,n,{depthTexture:new tb(i,n)}),this.aoBuffer=new mn(i,n,{minFilter:Yi,magFilter:Yi}),this.splineScene=e,this.splineCamera=t;let r=new Float32Array(X_.length*2);for(let a=0;a<X_.length;a++){let o=a*2;r[o+0]=X_[a][0],r[o+1]=X_[a][1]}this.blueNoiseInDiskTexture=new Zo(r,X_.length,1,QD,Zn),this.blueNoiseInDiskTexture.wrapS=zf,this.blueNoiseInDiskTexture.wrapT=zf,this.blueNoiseInDiskTexture.needsUpdate=!0,this.hbaoMaterial=new vn({vertexShader:D5e,fragmentShader:R5e,uniforms:{near:new Ct(null),far:new Ct(null),fov:new Ct(null),proj_info:new Ct(new Di),is_ortho:new Ct(!1),resolution:new Ct(new Ae),radius_of_influence:new Ct(8),radius_in_screen_space:new Ct(1),exponent:new Ct(1),ao_color:new Ct(new G),bias:new Ct(.5),texture_depth:new Ct(null),texture_normals:new Ct(null),texture_blue_noise:new Ct(null),texture_blue_noise_in_disk:new Ct(this.blueNoiseInDiskTexture),frame_index:new Ct(0),fog_enabled:new Ct(!1),fog_near:new Ct(1),fog_far:new Ct(1e3)}}),this.radius=128,this.aoColor={r:0,g:0,b:0},this.bias=.5,this.hbaoMaterial.uniforms.texture_depth.value=this.gBuffer.depthTexture,this.hbaoMaterial.uniforms.texture_normals.value=this.gBuffer.texture,this.needsSwap=!0,this.aaBuffer=new mn(i,n,{minFilter:Yi,magFilter:Yi,wrapS:Ar,wrapT:Ar,depthBuffer:!1,type:Zn});let s=new bte({preset:Qv.ULTRA,edgeDetectionMode:cP.COLOR});this.effectPass=new W3(this.camera,s)}initialize(e,t,i){super.initialize(e,t,i),this.effectPass.initialize(e,t,i)}setBlueNoiseTexture(e){this.hbaoMaterial.uniforms.texture_blue_noise.value=e}setSize(e,t){this._width=e,this._height=t,this.depthBufferHighRes.setSize(e,t);let i=this._runHalfRes?.5:1,n=e*i,r=t*i;this.gBuffer.setSize(n,r),this.aoBuffer.setSize(n,r),this.hbaoMaterial.uniforms.resolution.value.set(n,r),this.aaBuffer.setSize(n,r),this.effectPass.setSize(n,r)}get runHalfRes(){return this._runHalfRes}set runHalfRes(e){this._runHalfRes=e,this.setSize(this._width,this._height)}setCamera(e){this.splineCamera=e}setScene(e){this.splineScene=e}setDepthTexture(e){this.depthBufferHighRes.depthTexture=e,Xx.uniforms.texture_depth_hrez.value=e,Xx.needsUpdate=!0}render(e,t,i){this.splineScene.overrideMaterial=B5e;let n=this.splineCamera.layers.mask;if(this.splineCamera.layers.set(5),e.setRenderTarget(this.gBuffer),e.clear(),e.render(this.splineScene,this.splineCamera),e.setRenderTarget(this.depthBufferHighRes),e.clear(),e.render(this.splineScene,this.splineCamera),this.splineScene.overrideMaterial=null,this.splineCamera.layers.mask=n,this.hbaoMaterial.uniforms.radius_of_influence.value=this.radius,this.hbaoMaterial.uniforms.ao_color.value.set(this.aoColor.r,this.aoColor.g,this.aoColor.b),this.hbaoMaterial.uniforms.bias.value=this.bias,this.hbaoMaterial.uniforms.fog_enabled.value=this.fogEnabled,this.hbaoMaterial.uniforms.fog_near.value=this.fogNear,this.hbaoMaterial.uniforms.fog_far.value=this.fogFar,this.hbaoMaterial.uniforms.frame_index.value=this.frameIndex,this.frameIndex++,this.splineCamera.isPerspectiveCamera){this.hbaoMaterial.uniforms.near.value=this.splineCamera.perspCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.perspCamera.far;let r=this.splineCamera.perspCamera.projectionMatrix.elements,s=2/r[0],a=2/r[5],o=-(1-r[8])/r[0],l=-(1+r[9])/r[5];this.hbaoMaterial.uniforms.proj_info.value.set(s,a,o,l);let c=this.splineCamera.perspCamera.fov*(Math.PI/180),u=this.hbaoMaterial.uniforms.resolution.value.y/(Math.tan(c*.5)*2),h=this.hbaoMaterial.uniforms.radius_of_influence.value*.5*u;this.hbaoMaterial.uniforms.radius_in_screen_space.value=h,this.hbaoMaterial.uniforms.is_ortho.value=!1}else{this.hbaoMaterial.uniforms.near.value=this.splineCamera.orthoCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.orthoCamera.far;let r=this.splineCamera.orthoCamera.projectionMatrix.elements,s=2/r[0],a=2/r[5],o=-(1+r[12])/r[0],l=-(1-r[13])/r[5];this.hbaoMaterial.uniforms.proj_info.value.set(s,a,o,l);let c=.5*(this.hbaoMaterial.uniforms.resolution.value.y/a),u=this.hbaoMaterial.uniforms.radius_of_influence.value*c;this.hbaoMaterial.uniforms.radius_in_screen_space.value=u,this.hbaoMaterial.uniforms.is_ortho.value=!0}this.runHalfRes?(this.fullscreenMaterial=this.hbaoMaterial,e.setRenderTarget(this.aoBuffer),e.clear(),e.render(this.scene,this.camera),this.fullscreenMaterial=Xx,Xx.uniforms.texture_ao_lrez.value=this.aoBuffer.texture,Xx.uniforms.texture_depth_lrez.value=this.gBuffer.depthTexture,Xx.uniforms.texture_depth_hrez.value=this.depthBufferHighRes.depthTexture,e.setRenderTarget(e.aoRenderTarget),e.clear(),e.render(this.scene,this.camera)):(this.fullscreenMaterial=this.hbaoMaterial,e.setRenderTarget(this.aaBuffer),e.clear(),e.render(this.scene,this.camera),this.effectPass.renderToScreen=!1,this.effectPass.render(e,this.aaBuffer,e.aoRenderTarget))}dispose(){this.gBuffer.dispose(),this.depthBufferHighRes.dispose(),this.aoBuffer.dispose()}},L5e=`
varying vec2 vUv;
void main() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,U5e=`
uniform sampler2D tInput;
uniform sampler2D tMap;
uniform vec2 resolution;
varying vec2 vUv;

uniform vec2 uResolution;
uniform vec2 uCoords;

// Draws a rectangle at center <st> with size <size>
float rectangle(vec2 st, vec2 size) {
    size = vec2(0.5) - size * 0.5;
    vec2 uv = vec2(step(size.x, st.x), step(size.y, st.y));
    uv *= vec2(step(size.x, 1.0 - st.x), step(size.y, 1.0 - st.y));

    return uv.x * uv.y;
}

uniform vec2 uSize;
uniform float uScale;
uniform float uDPR;
uniform float uCurrent;
uniform vec3 uSceneColor;

void main() {
    vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
    screenUv *= 1.0 / uDPR;

    vec2 center = vec2(0.5, -0.5);
    vec2 outsideUv = screenUv;
    outsideUv += center;
    outsideUv -= uCoords.xy / uResolution.xy;
    outsideUv = (outsideUv - 0.5) + 0.5;
    outsideUv -= center;
    vec2 s = (uSize / uResolution) * uScale;
    float isOutside = 1.0 - rectangle(outsideUv, s);
    
    vec2 mid = vec2(0.5);
    vec2 insideUv = (screenUv - mid + s * mid) / s;
    vec4 background = texture2D(tInput, screenUv);
    vec4 image = texture2D(tMap, insideUv);
    gl_FragColor = mix(image, background, isOutside);
}
`,N5e=class extends Vc{constructor(){super(new vn({vertexShader:L5e,fragmentShader:U5e,uniforms:{tInput:new Ct(null),tMap:new Ct(null),uResolution:new Ct(new Ae),uSize:new Ct(new Ae),uCoords:new Ct(new Ae),uScale:new Ct(1),uSceneColor:new Ct(new gi(16711680)),uDPR:new Ct(1),uCurrent:new Ct(0)}}),"tInput"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.tMap.value}set texture(e){this.uniforms.tMap.value=e}},z5e=`
void main() {
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,F5e=`
uniform sampler2D toScene;
uniform sampler2D fromScene;
uniform vec2 resolution;

uniform vec2 uResolution;
uniform float uDPR;

uniform float mixRatio;
uniform sampler2D tMixTexture;
uniform int useTexture;
uniform float threshold;

void main() {
	vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
	screenUv *= 1.0 / uDPR;

	vec4 texel1 = texture2D( fromScene, screenUv );
	vec4 texel2 = texture2D( toScene, screenUv );

	if (useTexture==1) {
		
		vec4 transitionTexel = texture2D( tMixTexture, screenUv );
		float r = mixRatio * (1.0 + threshold * 2.0) - threshold;
		float mixf=clamp((transitionTexel.r - r)*(1.0/threshold), 0.0, 1.0);
		
		gl_FragColor = mix( texel1, texel2, mixf );
	} else {
		
		gl_FragColor = mix( texel1, texel2, mixRatio );
		
	}
}
`,V5e=[],H5e=class extends Vc{constructor(){super(new vn({vertexShader:z5e,fragmentShader:F5e,uniforms:{toScene:new Ct(null),fromScene:new Ct(null),uResolution:new Ct(new Ae),uDPR:new Ct(1),mixRatio:new Ct(0),threshold:new Ct(.1),useTexture:new Ct(0),tMixTexture:{value:V5e[0]}}}),"toScene"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.fromScene.value}set texture(e){this.uniforms.fromScene.value=e}},G5e=`
void main() {
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,k5e=`
uniform sampler2D inputBuffer;
uniform sampler2D blurredInputBuffer;
uniform sampler2D overlay;
uniform float blurIntensity;

uniform vec2 uResolution;
uniform float uDPR;

void main() {
	vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
	screenUv *= 1.0 / uDPR;

	vec4 texel1 = texture2D( overlay, screenUv );
	vec4 texel2 = texture2D( inputBuffer, screenUv );
	vec4 texel3 = texture2D( blurredInputBuffer, screenUv );

	float blurMask2 = max(sign(texel1.a), 0.0) * blurIntensity;
    gl_FragColor = mix( mix(texel2, texel3, blurMask2), texel1, texel1.a );
}
`,j5e=class extends Vc{constructor(){super(new vn({vertexShader:G5e,fragmentShader:k5e,uniforms:{inputBuffer:new Ct(null),blurredInputBuffer:new Ct(null),overlay:new Ct(null),uResolution:new Ct(new Ae),uDPR:new Ct(1),blurIntensity:new Ct(0)}})),this._blurEnabled=!1,this.blurTarget=new mn(1,1,{minFilter:Yi,magFilter:Yi,wrapS:Ar,wrapT:Ar}),this.blurPass=new H5({width:window.innerWidth,height:window.innerHeight,kernelSize:uP.HUGE,resolutionScale:.25}),this.blurPass.renderToScreen=!1,this.uniforms.blurredInputBuffer.value=this.blurTarget.texture}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.overlay.value}set texture(e){this.uniforms.overlay.value=e}setResolution(e,t,i=1){this.uniforms.uResolution.value.set(e,t),this.uniforms.uDPR.value=i,this.blurPass.setSize(e,t),this.blurTarget.setSize(e,t),this.blurPass.setSize(e,t)}get uiCanvas(){return this._uiCanvas}set uiCanvas(e){this._uiCanvas=e,e.texture&&(this.uniforms.overlay.value=e.texture);let t=e.frame;if(t){let i=t.data.backgroundBlur,n=i.radius;this._blurEnabled=i.enabled,this.uniforms.blurIntensity.value=this._blurEnabled?1:0,this.blurPass.scale=n/3}}render(e,t,i,n,r){this._blurEnabled&&(this.blurPass.setDepthTexture(this.getDepthTexture()),this.blurPass.render(e,t,this.blurTarget,n,r)),super.render(e,t,i,n,r)}},W5e=`
varying vec2 vUv;
void main() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,X5e=`
uniform sampler2D tInput;
uniform sampler2D tOverlayImage;
varying vec2 vUv;
uniform vec2 uResolution;
uniform vec2 uRightBottom;
uniform vec2 uImageSize;
uniform float uScale;
uniform float uDPR;

vec3 blendNormal(vec3 base, vec3 blend) {
	return blend;
}

vec3 blendNormal(vec3 base, vec3 blend, float opacity) {
	return (blendNormal(base, blend) * opacity + base * (1.0 - opacity));
}

vec4 drawFixedSizeImage(sampler2D image, vec2 screenUV, vec2 imageSize, vec2 imageCoords, vec2 screenSize, float dpr) {
	vec2 uv = (screenUV * screenSize * dpr - imageCoords) / (imageSize * dpr);
	if (uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0 || uv.y > 1.0) {
		return vec4(0.0);
	}
	return texture2D(image, uv);
}

void main() {
    vec2 screenUV = gl_FragCoord.xy / (uResolution.xy * uDPR);
	vec2 imageCoords = vec2(uResolution.x * uDPR - uImageSize.x * uScale * uDPR - uRightBottom.x * uDPR, uRightBottom.y * uDPR);
    vec4 background = texture2D(tInput, screenUV);
    vec4 image = drawFixedSizeImage(tOverlayImage, screenUV, uImageSize * uScale, imageCoords, uResolution, uDPR);
    gl_FragColor = vec4(blendNormal(background.rgb, image.rgb, image.a), max(background.a, image.a));
}
`,q5e=class extends Vc{constructor(){super(new vn({vertexShader:W5e,fragmentShader:X5e,uniforms:{tInput:new Ct(null),tOverlayImage:new Ct(null),uResolution:new Ct(new Ae),uImageSize:new Ct(new Ae),uRightBottom:new Ct(new Ae(20,20)),uScale:new Ct(.25),uDPR:new Ct(1)}}),"tInput")}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.tOverlayImage.value}set texture(e){this.uniforms.tOverlayImage.value=e,this.uniforms.uImageSize.value.set(e.image.width,e.image.height)}};function N7(e,t){return t&&t.enabled&&e.push(t.effect),e}var Y5e=e=>Object.values(Sn).includes(e)?e:Sn.NORMAL,Q5e=class extends Ka{constructor(e,t){super(),this._needsDOFResize=t,this.postprocessingState=C3.defaultData,this._scene=new Pl,this._camera=new xo,this.effects=new Map,this.blueNoiseTexture=new Zo,this._renderToScreen=!0,this._isUIOverlayEnabled=!1,this.clock=new mEe,this.renderer=e,this.debug=!1,this.effects.set("bloom",new l5e),this.effects.set("chromaticAberration",new u5e),this.effects.set("vignette",new p5e),this.effects.set("noise",new f5e),this.effects.set("colorAverage",new h5e),this.effects.set("hueSaturation",new d5e),this.effects.set("brightnessContrast",new c5e),this.effects.set("depthOfField",new m5e),this.effects.set("pixelation",new g5e),this.effectComposer=new w5e(this.renderer),this.effectComposer.autoRenderToScreen=!1,this.opaquePass=new xz(!0,this.scene,this.camera),this.opaquePass.clear=!0,this.transmissionPass=new _5e(this.scene,this.camera,this.renderer),this.aoPass=new I5e(this.scene,this.camera),this.taaPass=new S5e,this.taaPass.renderToScreen=!1,this.helperPass=new E5e(this.camera),this.helperPass.renderToScreen=!1,this.stylesOverlayPass=new N5e,this.stylesOverlayPass.enabled=!1,this.uiOverlayPass=new j5e,this.uiOverlayPass.enabled=!1,this.logoOverlayPass=new q5e,this.logoOverlayPass.enabled=!1,this.sceneTransitionPass=new H5e,this.sceneTransitionPass.enabled=!1,this._initCopyPass(),this._initPasses()}set overlayTexture(e){e!==void 0?(this.stylesOverlayPass.texture=e,this.stylesOverlayPass.enabled=!0):this.stylesOverlayPass.enabled=!1}get overlayTexture(){return this.stylesOverlayPass.texture}set sceneHelpers(e){this.helperPass.sceneHelpers=e}get sceneHelpers(){return this.helperPass.sceneHelpers}set sceneHelpersOnTop(e){this.helperPass.sceneHelpersOnTop=e}get sceneHelpersOnTop(){return this.helperPass.sceneHelpersOnTop}get scene(){return this._scene}set scene(e){this._scene=e,this.opaquePass.setScene(e),this.transmissionPass.setScene(e),this.aoPass.setScene(e)}get camera(){return this._camera}set camera(e){let t=this._camera!==e;this._camera=e,this.opaquePass.setCamera(e),this.transmissionPass.setCamera(e),t&&this.transmissionPass.updatePasses(this.renderer),this.aoPass.setCamera(e),this.helperPass.setCamera(e),this.effects.get("depthOfField").setCamera(e)}updateRenderToScreen(){let e=!1;for(let t=this.effectComposer.passes.length-1;t>=0;t--){let i=this.effectComposer.passes[t];if(i.enabled===!0&&!e&&this._renderToScreen){i.renderToScreen=!0,e=!0;continue}i.renderToScreen=!1}}get isUIOverlayEnabled(){return this._isUIOverlayEnabled}disableUIOverlay(){this._isUIOverlayEnabled=!1}enableUIOverlay(){this._isUIOverlayEnabled=!0}disableHelpers(){this.helperPass.enabled=!1,this.updateRenderToScreen()}enableHelpers(){this.helperPass.enabled=!0,this.updateRenderToScreen()}updateBlueNoiseTexture(e){this.blueNoiseTexture=new Zo(e,128,128),this.blueNoiseTexture.wrapS=zf,this.blueNoiseTexture.wrapT=zf,this.blueNoiseTexture.minFilter=rn,this.blueNoiseTexture.magFilter=rn,this.blueNoiseTexture.needsUpdate=!0}setAmbientOcclusionParams(e,t,i,n,r,s,a,o){this.aoPass.enabled=e,this.aoPass.radius=t,this.aoPass.bias=i,this.aoPass.aoColor=n,this.aoPass.fogEnabled=r,this.aoPass.fogNear=s,this.aoPass.fogFar=a,this.aoPass.runHalfRes!==!o&&(this.aoPass.runHalfRes=!o)}setTransmissionPassEnabled(e){this.transmissionPass.enabled=e,this.opaquePass.hasTransmissionPass=e}_initPasses(){var e,t,i;if((e=this.uvEffectPass)==null||e.dispose(),(t=this.effectPass)==null||t.dispose(),this.effectComposer.removeAllPasses(),this.transmissionPass.updatePasses(this.renderer),this.effectComposer.addPass(this.aoPass),this.effectComposer.addPass(this.opaquePass),this.effectComposer.addPass(this.transmissionPass),this.effectComposer.addPass(this.taaPass),this.postprocessingState.enabled){let n=[this.effects.get("pixelation")].reduce(N7,[]);n.length>0&&(this.uvEffectPass=new W3(this.camera,...n),this.uvEffectPass.renderToScreen=!1,this.effectComposer.addPass(this.uvEffectPass));let r=[this.effects.get("chromaticAberration"),this.effects.get("bloom"),this.effects.get("depthOfField"),this.effects.get("colorAverage"),this.effects.get("hueSaturation"),this.effects.get("brightnessContrast"),this.effects.get("vignette"),this.effects.get("noise")].reduce(N7,[]);if(r.length>0&&(this.effectPass=new W3(this.camera,...r),this.effectPass.renderToScreen=!1,this.effectComposer.addPass(this.effectPass),this._needsDOFResize&&((i=this.effects.get("depthOfField"))==null?void 0:i.enabled)&&window!==void 0)){let s=this.renderer.viewportWidth,a=this.renderer.viewportHeight;this.renderer.setSize(s-1,a-1),this.renderer.setSize(s,a)}}this.effectComposer.addPass(this.stylesOverlayPass),this.effectComposer.addPass(this.uiOverlayPass),this.effectComposer.addPass(this.sceneTransitionPass),this.effectComposer.addPass(this.helperPass),this.effectComposer.addPass(this.logoOverlayPass)}_initCopyPass(){if(this._savePass)return;let e=new Ae;this.renderer.getDrawingBufferSize(e),this._rt=new mn(e.x,e.y,{depthBuffer:!1,stencilBuffer:!1,wrapS:zf,wrapT:zf}),this._rt.samples=0,this._savePass=new vz(this._rt,!1),this._savePass.renderToScreen=!1}setCopyPass(e){this._rt=e,this._savePass=new vz(this._rt,!1),this.renderToScreen=!1}get renderToScreen(){return this._renderToScreen}set renderToScreen(e){if(this._renderToScreen===e)return;let t=this.effectComposer;!t||(e===!0?t.removePass(this._savePass):t.addPass(this._savePass),this._renderToScreen=e,this.updateRenderToScreen())}set sceneTransitionFromTexture(e){e!==this.sceneTransitionPass.texture&&(e!==null?this.sceneTransitionPass.enabled=!0:(this.sceneTransitionPass.enabled=!1,this.updateRenderToScreen()),this.sceneTransitionPass.texture=e)}setWatermark(e){this.logoOverlayPass.enabled=e!==null,e&&(this.logoOverlayPass.texture=e)}get texture(){return this._rt&&this._rt.texture}get renderTarget(){return this._rt}updatePostprocessing(e){let{enabled:t,...i}=e,n=!1;t!==this.postprocessingState.enabled&&(n=!0);for(let r of Object.entries(i)){let s=r[1],a=this.effects.get(r[0]);if(a){a.enabled!==s.enabled&&(n=!0),a.enabled=s.enabled;for(let[o,l]of Object.entries(s))o==="blendFunction"?a.blendFunction=Y5e(l):a[o]=l}}this.postprocessingState=e,n&&this._initPasses()}render(){this.effectComposer.render(this.clock.getDelta())}setScissor(e,t,i,n){e instanceof Di?(this.effectComposer.inputBuffer.scissor.set(e.x,e.y,e.z,e.w),this.effectComposer.outputBuffer.scissor.set(e.x,e.y,e.z,e.w)):(this.effectComposer.inputBuffer.scissor.set(e,t,i,n),this.effectComposer.outputBuffer.scissor.set(e,t,i,n));let r=this.renderer.getPixelRatio();this.effectComposer.inputBuffer.scissor.multiplyScalar(r),this.effectComposer.outputBuffer.scissor.multiplyScalar(r),this.renderer.setScissor(e,t,i,n)}setScissorTest(e){this.effectComposer.inputBuffer.scissorTest=e,this.effectComposer.outputBuffer.scissorTest=e,this.renderer.setScissorTest(e)}setViewport(e,t,i,n){e instanceof Di?(this.effectComposer.inputBuffer.viewport.copy(e),this.effectComposer.outputBuffer.viewport.copy(e)):(this.effectComposer.inputBuffer.viewport.set(e,t,i,n),this.effectComposer.outputBuffer.viewport.set(e,t,i,n))}resize(e,t,i){if(this.effectComposer.setSize(e,t,i),this._rt){let n=this.renderer.getPixelRatio();this._rt.setSize(e*n,t*n)}}dispose(){var e,t;(e=this.uvEffectPass)==null||e.dispose(),(t=this.effectPass)==null||t.dispose(),this.effectComposer.dispose()}},K5e=e=>`

// PCSS implementation based on:
// https://www.gamedev.net/articles/programming/graphics/contact-hardening-soft-shadows-made-fast-r4906/
// NOTE: This number affects how big the shadow blur can
// possibly get. Bigger number == bigger blur, but less precise results

const float  gPenumbraFilterSize = 80.0;
const int   gPenumbraSamples = ${e};
const int gShadowSamples = ${e};
const float gShadowSamplesRpc = 1.0f / float(gShadowSamples);

#ifdef USE_SHADOWMAP
    #if NUM_DIR_LIGHT_SHADOWS > 0

        uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
        varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];

        struct DirectionalLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
        };

        uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];

    #endif

    #if NUM_SPOT_LIGHT_SHADOWS > 0

        uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
        varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_SHADOWS ];

        struct SpotLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
        };

        uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];

    #endif

    #if NUM_POINT_LIGHT_SHADOWS > 0

        uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
        varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];

        struct PointLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
            float shadowCameraNear;
            float shadowCameraFar;
        };

        uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];

    #endif

    /*
    #if NUM_RECT_AREA_LIGHTS > 0

        // TODO (abelnation): create uniforms for area light shadows

    #endif
    */

float computePenumbra(int index, sampler2D shadowMap, float temporalAngle, float texelSize, vec2 uv, float compare, float texelScalar, float shadowRadius)
{
    float penumbra = 1.0;
    float blockerDepthAvg = 0.0;
    float blockerCount = 0.0;

    #pragma unroll_loop_start
    for(int i = 0; i < gPenumbraSamples; i ++)
    {
        vec2 offset = (vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize) * texelScalar;
        float depth = unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) );

        if(depth < compare + 0.0001)
        {
            blockerDepthAvg += depth;
            blockerCount++;
        }
    }
    #pragma unroll_loop_end

    if (blockerCount > 0.0)
    {
        blockerDepthAvg /= blockerCount;

        // Compute penumbra
        penumbra = (compare - blockerDepthAvg) / (blockerDepthAvg);
        penumbra *= penumbra;
        penumbra *= 200.0 * penumbraSize[min(index, 5 - 1)]; // Magic number that affects how quickly the penumbra grows

        return clamp(penumbra, 0.00, 1.0);
    }
    return 0.0;
}

float vogelShadow(int index, sampler2D shadowMap, vec2 uv, float texelSize, float compare, float shadowRadius)
{
    float shadow         = 0.0f;

    // NOTE: When using TAA, we should use screen space interleaved gradient noise
    vec2 halton = haltonSequence[frameIndex];
    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
    float temporalAngle  = temporalOffset * PI2;

    float texelScalar = (gPenumbraFilterSize) / (texelSize * 1024.);
    float penumbra = computePenumbra(index, shadowMap, temporalAngle, texelSize, uv, compare, texelScalar, shadowRadius);
    if (penumbra == -1.0) {
        return 1.0;
    }

    #pragma unroll_loop_start
    for (int i = 0; i < gShadowSamples; i++)
    {
        vec2 vogelSample =  vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;
        // Overall blurring offset
        vec2 offset = vogelSample * (shadowRadius * 2.);

        // Penumbra offset
        offset += vogelSample * (penumbra * texelScalar);

        shadow += step( compare, unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) ) );
    }
    #pragma unroll_loop_end

    return shadow * gShadowSamplesRpc;
}


    float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {

        return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );

    }

    vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {

        return unpackRGBATo2Half( texture2D( shadow, uv ) );

    }

    float VSMShadow (sampler2D shadow, vec2 uv, float compare ){

        float occlusion = 1.0;

        vec2 distribution = texture2DDistribution( shadow, uv );

        float hard_shadow = step( compare , distribution.x ); // Hard Shadow

        if (hard_shadow != 1.0 ) {

            float distance = compare - distribution.x ;
            float variance = max( 0.00000, distribution.y * distribution.y );
            float softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality
            softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed
            occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );

        }
        return occlusion;

    }

    float getShadow( int i, sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {

        float shadow = 1.0;

        shadowCoord.xyz /= shadowCoord.w;
        shadowCoord.z += shadowBias;

        // if ( something && something ) breaks ATI OpenGL shader compiler
        // if ( all( something, something ) ) using this instead

        bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
        bool inFrustum = all( inFrustumVec );

        bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );

        bool frustumTest = all( frustumTestVec );

        if ( frustumTest ) {

        #if defined( SHADOWMAP_TYPE_PCF )

            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
            return vogelShadow(i, shadowMap, shadowCoord.xy, texelSize.x, shadowCoord.z, shadowRadius );

        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )

            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
            float dx = texelSize.x;
            float dy = texelSize.y;

            vec2 uv = shadowCoord.xy;
            vec2 f = fract( uv * shadowMapSize + 0.5 );
            uv -= f * texelSize;

            shadow = (
                texture2DCompare( shadowMap, uv, shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
                mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
                     f.x ) +
                mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
                     f.x ) +
                mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
                     f.y ) +
                mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
                     f.y ) +
                mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
                          f.x ),
                     mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
                          f.x ),
                     f.y )
            ) * ( 1.0 / 9.0 );

        #elif defined( SHADOWMAP_TYPE_VSM )

            shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );

        #else // no percentage-closer filtering:

            shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );

        #endif

        }

        return shadow;

    }

    // cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D
    // vector suitable for 2D texture mapping. This code uses the following layout for the
    // 2D texture:
    //
    // xzXZ
    //  y Y
    //
    // Y - Positive y direction
    // y - Negative y direction
    // X - Positive x direction
    // x - Negative x direction
    // Z - Positive z direction
    // z - Negative z direction
    //
    // Source and test bed:
    // https://gist.github.com/tschw/da10c43c467ce8afd0c4

    vec2 cubeToUV( vec3 v, float texelSizeY ) {

        // Number of texels to avoid at the edge of each square

        vec3 absV = abs( v );

        // Intersect unit cube

        float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
        absV *= scaleToCube;

        // Apply scale to avoid seams

        // two texels less per square (one texel will do for NEAREST)
        v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );

        // Unwrap

        // space: -1 ... 1 range for each square
        //
        // #X##         dim    := ( 4 , 2 )
        //  # #         center := ( 1 , 1 )

        vec2 planar = v.xy;

        float almostATexel = 1.5 * texelSizeY;
        float almostOne = 1.0 - almostATexel;

        if ( absV.z >= almostOne ) {

            if ( v.z > 0.0 )
                planar.x = 4.0 - v.x;

        } else if ( absV.x >= almostOne ) {

            float signX = sign( v.x );
            planar.x = v.z * signX + 2.0 * signX;

        } else if ( absV.y >= almostOne ) {

            float signY = sign( v.y );
            planar.x = v.x + 2.0 * signY + 2.0;
            planar.y = v.z * signY - 2.0;

        }

        // Transform to UV space

        // scale := 0.5 / dim
        // translate := ( center + 0.5 ) / dim
        return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );

    }

    float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {

        float shadow = 1.0;
        vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );

        // for point lights, the uniform @vShadowCoord is re-purposed to hold
        // the vector from the light to the world-space position of the fragment.
        vec3 lightToPosition = shadowCoord.xyz;

        // dp = normalized distance from light to fragment position
        float compare = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?
        compare += shadowBias;

        // bd3D = base direction 3D
        vec3 bd3D = normalize( lightToPosition );

        vec2 halton = haltonSequence[frameIndex];
        float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
        float temporalAngle  = temporalOffset * PI2;

        #if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_VSM )
            for (int i = 0; i < gShadowSamples; i++) {
                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;

                // Overall blurring offset
                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);

                // NOTE: Removed for now
                // Penumbra offset
                //offset += vec3(vogelSample.x, vogelSample.y, vogelSample.y)  * (penumbra * gPenumbraFilterSize);

                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );

            }
            return shadow * gShadowSamplesRpc;

        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )
            for (int i = 0; i < 16; i++) {
                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;

                // Overall blurring offset
                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);

                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );

            }
            return shadow * (1.0 / 16.0);
        #else // no percentage-closer filtering

            return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), compare );

        #endif

    }

#endif
`,J5e=Xi.lights_fragment_begin,Z5e=Xi.shadowmask_pars_fragment,z7=null,$5e=e=>{switch(e){case"low":return 8;case"medium":return 16;case"high":return 32;default:return 16}},eVe=(e="medium")=>{if(z7===e)return!1;z7=e;let t=$5e(e);Xi.shadowmap_pars_fragment=K5e(t);let i=J5e.slice();i=i.replace("getShadow( spotShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX + 3, spotShadowMap[ i ]"),i=i.replace("getShadow( directionalShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX, directionalShadowMap[ i ]"),Xi.lights_fragment_begin=i;let n=Z5e.slice();return n=n.replaceAll("getShadow(","getShadow( UNROLLED_LOOP_INDEX, "),Xi.shadowmask_pars_fragment=n,!0},tVe=`
attribute vec3 randomColor;
varying vec3 vNormal;
flat out vec3 vColor;
#include <skinning_pars_vertex>
#include <morphtarget_pars_vertex>
	
void main()
{
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
vec3 transformed = vec3(position);
#include <morphtarget_vertex>
#include <skinning_vertex>

vNormal = normal;
vColor = randomColor;
gl_Position = projectionMatrix * (modelViewMatrix * vec4(transformed, 1.0));
}
`,iVe=`
uniform float depthContrast;
varying vec3 vNormal;
flat in vec3 vColor;
void main()
{
vec3 normal = (normalize(vNormal)).rgb;

float contrastDepth = (gl_FragCoord.z - 0.5) * depthContrast + 0.5;

vec3 resultColor = mix(mix(vColor, normal, 0.2), vec3(contrastDepth), 0.4);
gl_FragColor = vec4(resultColor, vColor.r);
gl_FragColor = vec4(resultColor, vColor.r);
}
`,cL=new vn({vertexShader:tVe,fragmentShader:iVe,uniforms:{depthContrast:{value:1}}}),F7=new Hr,V7=new Ae,nVe=class extends rZ{constructor(e){super(e),this._pixelRatio=this.getPixelRatio(),this.viewportWidth=1,this.viewportHeight=1,this.resolution=new Ae,this.dummyCamera=new xo,this.sceneTransitionDuration=0,this.sceneTransitionTimeRemaining=-1,this.isXRCopyPassSet=!1,this.clear=(r=!0,s=!0,a=!0)=>{let o=this.getContext(),l=0;r&&(l|=o.COLOR_BUFFER_BIT),s&&(l|=o.DEPTH_BUFFER_BIT),a&&(l|=o.STENCIL_BUFFER_BIT),o.clear(l),o.clearBufferfv(o.COLOR,1,[0,0,0,1])},this.pipeline=new Q5e(this,(e==null?void 0:e.needsDOFResize)??!1),this.autoClear=!1;let t=this.setPixelRatio.bind(this),i=this.setSize.bind(this);this.shadowMap.enabled=!0,this.shadowMap.type=T4,this.dummyCamera.matrixAutoUpdate=!1,this.domElement.removeAttribute("data-engine");let n=this.getContext();if(n&&"drawingBufferColorSpace"in n)try{n.drawingBufferColorSpace="display-p3"}catch(r){console.warn(r)}this.setPixelRatio=r=>{this._pixelRatio!==r&&(this._pixelRatio=r,t(r))},this.setSize=(r,s,a=!0)=>{var o,l;(this.viewportWidth!==r||this.viewportHeight!==s)&&(this.viewportWidth=r,this.viewportHeight=s,i(r,s,a),(o=this.normalRenderTarget)==null||o.setSize(r*this._pixelRatio,s*this._pixelRatio),this._resizeTransmission(r,s),(l=this.transmissionDepthTarget)==null||l.setSize(r*this._pixelRatio/2,s*this._pixelRatio/2),this.pipeline.resize(r,s,a))},this._superDispose=this.dispose,this.dispose=this._currentDispose}createAORenderTarget(){this.aoRenderTarget===void 0&&(this.aoRenderTarget=new mn(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:Yi,magFilter:Yi,wrapS:Ar,wrapT:Ar,depthBuffer:!1}))}_resizeTransmission(e,t){var i,n;(i=this.transmissionRenderTarget)==null||i.setSize(e*this._pixelRatio/(this.hdTransmission?1:2),t*this._pixelRatio/(this.hdTransmission?1:2)),(n=this.aoRenderTarget)==null||n.setSize(e*this._pixelRatio/1,t*this._pixelRatio/1)}get hdTransmission(){return xi.transmissionLod.value===1}set hdTransmission(e){xi.transmissionLod.value=e===!0?1:2,this._resizeTransmission(this.viewportWidth,this.viewportHeight)}createTransmissionRenderTarget(){this.transmissionRenderTarget===void 0&&(this.transmissionRenderTarget=new mn(this.viewportWidth*this._pixelRatio/(this.hdTransmission?1:2),this.viewportHeight*this._pixelRatio/(this.hdTransmission?1:2),{generateMipmaps:!0,minFilter:$1,magFilter:Yi,wrapS:Ar,wrapT:Ar,depthBuffer:!1}),this.transmissionDepthTarget=new mn(this.viewportWidth*this._pixelRatio/2,this.viewportHeight*this._pixelRatio/2,{minFilter:rn,magFilter:rn,depthBuffer:!1}))}createNormalRenderTarget(){this.normalRenderTarget===void 0&&(this.normalRenderTarget=new mn(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:rn,magFilter:rn,type:Zn,depthTexture:new tb(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio)}))}renderNormal(e,t,i){this.normalRenderTarget&&(this.setClearColor(0),i.layers.enable(8),i.layers.disable(0),i.layers.disable(3),t.traverseEntity(n=>{n.layers.isEnabled(8)&&(n.copyPreviousMatrix=!1)}),this.setRenderTarget(this.normalRenderTarget),this.clear(),i instanceof xo?cL.uniforms.depthContrast.value=(i.far-i.near)/1e4:cL.uniforms.depthContrast.value=1,t.overrideMaterial=cL,this.render(t,i),this.setClearColor(t.bgColor,t.bgColor.a),this.setRenderTarget(null),t.overrideMaterial=e.wireframeState?Ez:null,i.layers.enable(0),i.layers.enable(3),t.traverseEntity(n=>{n.layers.isEnabled(8)&&(n.copyPreviousMatrix=!0)}))}renderSplineSceneWithDummyCamera(e,t,i=1){this.dummyCamera.updateCameraState(t.dataPatched),this.dummyCamera.matrix.copy(t.matrixWorld);let n=t.height,r=t.width,s=this.viewportWidth/this.viewportHeight;r<n?r=n*s:n=r/s,this.dummyCamera.setViewplaneSize(r,n);for(let a=0;a<i;a++)this.renderSplineScene(e,this.dummyCamera)}renderSplineScene(e,t,{sceneHelpers:i=this.sceneHelpers,sceneHelpersOnTop:n=this.sceneHelpersOnTop,overrideTransmission:r=void 0,overrideNormal:s=void 0}={}){var d;let a=e instanceof Q5?e.activePage:e,o=a.visible;a.visible=!0;let l=a.scene;this.xr.enabled&&(this.isXRCopyPassSet===!1&&this.getRenderTarget()!==null&&(this.pipeline.setCopyPass(this.getRenderTarget()),this.isXRCopyPassSet=!0),this.xr.updateCamera(t)),this.setClearColor(a.bgColor,a.bgColor.a),a.penumbraSizeArray.forEach((p,g)=>{xi.penumbraSize.value[g]=p}),xi.pixelRatioNode.value=this.getPixelRatio(),this.resolution.x!==0&&this.resolution.y!==0?xi.resolution.value.set(this.resolution.x,this.resolution.y):xi.resolution.value.set(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio),s!==void 0?(xi.normalRenderTarget.value=s,xi.normalRenderTargetDepth.value=F7):l.needsNormal()&&(this.createNormalRenderTarget(),xi.normalRenderTarget.value=this.normalRenderTarget.texture,xi.normalRenderTargetDepth.value=this.normalRenderTarget.depthTexture,this.renderNormal(l,a,t));let c=a.data.ao,u=c.occlusion;if(u&&(this.createAORenderTarget(),xi.aoRenderTarget.value=this.aoRenderTarget.texture),xi.aoEnabled.value=u,this.pipeline.setAmbientOcclusionParams(c.occlusion,c.radius,c.bias,a.aoColor,a.fog!==null,a.backupFog.near,a.backupFog.far,c.aoFullRes&&!dM),this.pipeline.aoPass.setBlueNoiseTexture(this.pipeline.blueNoiseTexture),this.pipeline.isUIOverlayEnabled&&((d=a.uiCanvas)==null?void 0:d.enabled)&&a.uiCanvas.texture&&a.uiCanvas.texture.image.width>0){let p=this.getSize(V7),g=this.getPixelRatio();(a.uiCanvas.width!==this.viewportWidth||a.uiCanvas.height!==this.viewportHeight||a.uiCanvas.dpr!==g)&&a.uiCanvas.applySize({width:this.viewportWidth,height:this.viewportHeight},g),a.uiCanvas.render(this),this.pipeline.uiOverlayPass.uiCanvas=a.uiCanvas,this.pipeline.uiOverlayPass.enabled=!0,this.pipeline.uiOverlayPass.setResolution(p.x,p.y,g),this.pipeline.updateRenderToScreen()}else this.pipeline.uiOverlayPass.enabled=!1,this.pipeline.updateRenderToScreen();if(this.pipeline.logoOverlayPass.enabled){let p=this.getSize(V7),g=this.getPixelRatio();this.pipeline.logoOverlayPass.uniforms.uResolution.value.set(p.x,p.y),this.pipeline.logoOverlayPass.uniforms.uDPR.value=g}let h=!1;if(r!==void 0)xi.transmissionRenderTarget.value=r,xi.transmissionRenderTargetDepth.value=F7,this.pipeline.setTransmissionPassEnabled(!1);else{let p=l.needsTransmission();p&&(this.transmissionRenderTarget===void 0&&(h=!0),this.createTransmissionRenderTarget(),xi.transmissionRenderTarget.value=this.transmissionRenderTarget.texture,xi.aspectRatio.value=XNe(this.viewportWidth,this.viewportHeight),xi.transmissionRenderTargetDepth.value=this.transmissionDepthTarget.texture),this.pipeline.setTransmissionPassEnabled(p)}t.layers.enable(3),t.layers.enable(8),this.pipeline.sceneHelpers=i,this.pipeline.sceneHelpersOnTop=n,this.pipeline.scene=a,this.pipeline.camera=t,h&&this.pipeline.transmissionPass.updatePasses(this),this.pipeline.postprocessingState!==a.postprocessing&&(this.pipeline.updatePostprocessing(a.postprocessing),!i&&!n&&this.pipeline.disableHelpers()),this.clearAlphaOverride!==void 0&&this.setClearAlpha(this.clearAlphaOverride),l.shapeBlendIntances.forEach(p=>{p.onBeforeShadowPass(this)}),a.overrideMaterial=l.wireframeState?Ez:null,this.pipeline.render(),xi.frameIndex.value=(xi.frameIndex.value+1)%16,t instanceof xo&&t.copyHistory(),a.visible=o}renderFromSceneForSceneTransitionPass(e,t,i){this.pipeline.renderToScreen=!1,this.pipeline.renderTarget,this.renderSplineScene(e,t),this.pipeline.sceneTransitionFromTexture=this.pipeline.renderTarget.texture,this.sceneTransitionDuration=i,this.sceneTransitionTimeRemaining=i,this.pipeline.renderToScreen=!0;let n=this.pipeline.sceneTransitionPass.uniforms;n.uDPR.value=window.devicePixelRatio,n.uResolution.value.set(this.domElement.width,this.domElement.height).divideScalar(window.devicePixelRatio)}_currentDispose(){var e,t,i,n,r,s;this._superDispose(),this.pipeline.dispose(),(e=this.aoRenderTarget)==null||e.dispose(),(t=this.transmissionRenderTarget)==null||t.dispose(),(i=this.transmissionDepthTarget)==null||i.dispose(),(n=this.normalRenderTarget)==null||n.dispose(),(s=(r=this.normalRenderTarget)==null?void 0:r.depthTexture)==null||s.dispose()}},Ste=class extends mM(PEe){constructor(e,t=15,i=10066329){super(e,t,i),this.object=e,this.added=!1,this.name=`DirectionalLightHelper: ${e.uuid}`}raycast(e,t){gM(this.object,Ste.geometryHelper,e,t)}},_te=class extends mM(REe){constructor(e,t=15,i=6710886){super(e,t,i),this.object=e,this.name=`PointLightHelper: ${e.uuid}`}raycast(e,t){gM(this.object,_te.geometryHelper,e,t)}},bz=class extends mM(DEe){constructor(e,t=6710886){super(e,t),this.object=e,this.name=`SpotLightHelper: ${e.uuid}`}raycast(e,t){gM(this.object,bz.geometryHelper,e,t)}update(){if(this.object!==void 0){let e=bz._vector,t=this.object.distance?this.object.distance:1e3,i=t*Math.tan(this.object.angle);this.cone.scale.set(i,i,t),e.setFromMatrixPosition(this.object.target.matrixWorld),this.cone.lookAt(e);let n=this.color!==void 0?this.color:this.light.color;if(this.cone.material instanceof Array)for(let r=0,s=this.cone.material.length;r<s;r++)this.cone.material[r].color.set(n);else this.cone.material.color.set(n)}}},Ate=bz;Ate._vector=new G;var wte=class extends Hf{constructor(){super(),this.caretIndex=0,this._caretVisibleAlpha=1,this._selectionVisibleAlpha=.3,this.current={start:0,end:void 0},this.matrixAutoUpdate=!1,this.caretMesh=new fr(new Ad(1,1),new np({transparent:!0,opacity:0,side:yo})),this.add(this.caretMesh),this.selectionMesh=new fr(new Ad(1,1),new np({color:2857471,transparent:!0,depthTest:!1,depthWrite:!1,opacity:0,side:yo})),this.add(this.selectionMesh),this.hide()}get caretHeight(){var e;return((e=this.object)==null?void 0:e.AD)??0}show(e){this.visible=!0,this.object=e,this.caretMesh.scale.set(1,this.caretHeight,1),this.caretMesh.position.y=-this.caretHeight*.5,this.setCaretPosition(this.caretIndex),this.update()}hide(){this.visible=!1}update(){if(this.object===void 0)return;this.updateHelperMatrix();let{depth:e}=this.object.geometry.userData.parameters;this.caretMesh.position.z=e,this.selectionMesh.position.z=e}updateHelperMatrix(){if(this.object===void 0)return;let e=this.object,t=e.parent;t!==null&&t.updateWorldMatrix(!0,!1),e.matrixAutoUpdate&&e.updateMatrix(),t!==null?(this.matrixWorld.multiplyMatrices(t.matrixWorld,e.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,e.matrix)):this.matrixWorld.multiplyMatrices(e.hiddenMatrix,e.matrix),this.matrix.copy(this.matrixWorld);for(let i of this.children)i.matrixWorld.copy(this.matrixWorld);e.updateWorldMatrix(!0,!0)}setCaretColor(e){let t=this.caretMesh.material;t.color.setRGB(e.r,e.g,e.b);let i=this._caretVisibleAlpha===t.opacity;this._caretVisibleAlpha=e.a,i&&(t.opacity=this._caretVisibleAlpha)}setSelectionColor(e){this.selectionMesh.material.color.setRGB(e.r,e.g,e.b)}setCaretPosition(e,t={}){if(this.object===void 0)return;this.caretIndex=e;let i=this.object.wrappedText,[n,r]=X3(i,e),[s,a]=e>0?X3(i,e-1):[null,null];(e>0&&i.length?i[s].charAt(a):null)===`
`&&(n++,r=0),this.current.start=e,this.current.end=void 0;let[o,l]=uL(this.object,n,r),{AD:c,descender:u}=this.object,h=u+c*.5,{width:d,height:p,depth:g}=this.object.geometry.userData.parameters,x=typeof d=="string"?0:d,y=typeof p=="string"?0:p;this.caretMesh.scale.set(1,this.caretHeight,1),this.caretMesh.position.set(o-x*.5,l+h+y*.5,g),this.hideSelectionMesh(),this.showCaretMesh()}setSelection(e,t){if(this.object===void 0)return;let i=this.object.wrappedText;this.current.start=e,this.current.end=t;let n=[],r=[],s=rVe(i,e,t),{lineHeight:a,AD:o,descender:l}=this.object,c=l+o*.5-a*.5;for(let[y,b,A]of s)if(b!==A){let[w,E]=uL(this.object,y,b),[D,T]=uL(this.object,y,A);E+=c,T+=c,T+=a;let I=n.length/3;n.push(w,E,0),n.push(D,E,0),n.push(D,T,0),n.push(w,T,0),r.push(I+0,I+1,I+2),r.push(I+2,I+3,I+0)}let u=new ii;u.setIndex(r),u.setAttribute("position",new Gt(n,3));let{width:h,height:d,depth:p}=this.object.geometry.userData.parameters,g=typeof h=="string"?0:h,x=typeof d=="string"?0:d;this.selectionMesh.geometry.dispose(),this.selectionMesh.geometry=u,this.selectionMesh.position.x=-g*.5,this.selectionMesh.position.y=x*.5,this.selectionMesh.position.z=p,this.showSelectionMesh(),this.hideCaretMesh()}getSelectionFromPosition(e,t,i="previous"){if(this.object===void 0||this.object.font===void 0)return;let n=this.object.wrappedText,r=n.length,s=this.object.lineHeight,a=r*s,{height:o,verticalAlign:l}=this.object.geometry.userData.parameters,c=typeof o=="string"?0:o,u=0;l===3?u=c-a:l===2&&(u=c*.5-a*.5);let h=Math.min(Math.floor(Math.max(Math.min(-t-u,a),0)/s),r-1),d=this.object.charCoords[h],p=this.object.charWidths[h],g=0,x=!1;if(i==="previous"){for(let y=0;y<d.length;y++)if(d[y][0]+p[y]*.5-e>0){g=y,x=!0;break}}else if(i==="closest"){let y=1/0;for(let b=0;b<d.length;b++){let A=d[b][0]+p[b]*.5,w=Math.abs(A-e);w<y&&(y=w,g=b,x=!0)}}else for(let y=0;y<d.length;y++){let b=d[y][0],A=d[y][0]+p[y];if(e>=b&&e<A){g=y,x=!0;break}}return x||(g=d.length),{index:this.getGlobalIndexFromLineAndCharIndexes(n,h,g),lineIndex:h,characterIndex:g}}getGlobalIndexFromLineAndCharIndexes(e,t,i){return e.slice(0,t).reduce((n,r)=>n+=r.length,0)+i}showSelectionMesh(){this.selectionMesh.material.opacity=this._selectionVisibleAlpha}hideSelectionMesh(){this.selectionMesh.material.opacity=0}showCaretMesh(){this.caretMesh.material.opacity=this._caretVisibleAlpha}hideCaretMesh(){this.caretMesh.material.opacity=0}};function uL(e,t,i){let{charCoords:n,charWidths:r,initialOffsetY:s,lineHeight:a}=e;if(n[t]&&n[t].length===0||n.length===0){let u=0,{horizontalAlign:h}=e.data.geometry,d=e.wrappedText,{width:p}=e.geometry.userData.parameters;return d.length===1&&d[0].length===0&&(h===3?u=p*.5:h===2&&(u=p)),[u,s-a*t]}let o=n[t];if(o===void 0||o.length===0)return[0,0];let[l,c]=o[Math.min(i,o.length-1)];return i>=o.length&&(l+=r[t][i-1]),[l,c]}function X3(e,t){var n;let i=0;for(let r=0;r<e.length;r++){let s=e[r],a=t-i;if(a<=s.length)return[r,a];i+=s.length}return[Math.max(0,e.length-1),((n=e[e.length-1])==null?void 0:n.length)??0]}function rVe(e,t,i){let[n,r]=X3(e,t),[s,a]=X3(e,i),o=[];r>=e[n].length&&(n++,r=0);for(let l=n;l<=s;l++){let c=e[l],u=l===n?r:0,h=l===s?a:c.length;o.push([l,u,h])}return o}function sVe(e,t){let i=Ha.fromHex(3223857),n=.8;for(let r of e.layers){if(r.data.type==="light"||r.data.type==="displace"||r.data.type==="fresnel"||r.data.type==="matcap"||r.data.type==="texture"||r.data.type==="toon"||r.data.type==="outline"||r.data.type==="transmission"||r.data.type==="noise")continue;let s=typeof r.data.alpha=="string"?Number(t.getVariable(r.data.alpha)):r.data.alpha;if(r.data.type==="color"&&s>.3){i=aVe(r.data.color,t),n=s;break}else if((r.data.type==="depth"||r.data.type==="gradient")&&s>.3){let a=oVe(r.data);i={r:a[0],g:a[1],b:a[2]},n=typeof r.data.alpha=="string"?1:r.data.alpha;break}}return{...i,a:n}}function aVe(e,t){return typeof e=="string"?t.data.colors[e]:e}function oVe(e){return e.colors[0]}function lVe(e,t){e.shadow.camera.right=t/2,e.shadow.camera.left=-t/2,e.shadow.camera.top=t/2,e.shadow.camera.bottom=-t/2,e.shadow.needsUpdate=!0}var Mte=class extends F5(pEe,Ste){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=2048,this.shadow.mapSize.height=2048,this.shadow.normalBias=1,this.layers.enable(3);let n=this.shadow.camera;n.top=1250,n.bottom=-1250,n.right=1250,n.left=-1250,n.near=-1e4,n.far=2500;let r=new o3(this.shadow.camera);r.visible=!1,this.gizmos.shadowmap=r}update(){this.shadow.camera.updateProjectionMatrix();for(let e in this.gizmos){let t=this.gizmos[e];t instanceof o3&&t.update()}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t);let i=e.depth!==void 0&&e.depth!==this.shadow.camera.far||e.size!==void 0&&e.size/2!==this.shadow.camera.right;e.size!==void 0&&lVe(this,e.size),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null)),e.penumbraSize!==void 0&&t.scene.markPenumbraSizeDirty(),i&&this.update()}},H7=new G,G7=new G,k7=new Ei,Ete=class extends F5(uEe,Ate){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let n=this.shadow.camera;n.fov=qt.RAD2DEG*2*this.angle,n.aspect=1,n.near=100,n.far=2500;let r=new o3(this.shadow.camera);r.visible=!1,this.gizmos.shadowmap=r,this.update()}update(){this.shadow.camera.updateProjectionMatrix();for(let e in this.gizmos){let t=this.gizmos[e];t instanceof o3&&t.update()}}updateMatrixWorld(e){super.updateMatrixWorld(e),G7.setFromMatrixPosition(this.matrixWorld),k7.setFromRotationMatrix(this.matrixWorld),H7.copy(this.up).applyQuaternion(k7).negate().multiplyScalar(this.distance),this.target.position.copy(G7).add(H7),this.target.updateMatrixWorld(),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t),e.distance!==void 0&&(this.distance=e.distance),e.decay!==void 0&&(this.decay=e.decay),e.angle!==void 0&&(this.angle=e.angle),e.penumbra!==void 0&&(this.penumbra=e.penumbra),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.penumbraSize!==void 0&&t.scene.markPenumbraSizeDirty(),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}};function cVe(e){let t=(e[0][0]+e[1][1])/2,i=(e[0][0]-e[1][1])/2,n=(e[1][0]+e[0][1])/2,r=(e[1][0]-e[0][1])/2,s=Math.sqrt(t*t+r*r),a=Math.sqrt(i*i+n*n),o=s+a,l=s-a,c=Math.atan2(n,i),u=Math.atan2(r,t),h=(u-c)/2,d=(u+c)/2,p=[[Math.cos(d),Math.sin(d)],[-Math.sin(d),Math.cos(d)]],g=[[o,0],[0,l]],x=[[Math.cos(h),Math.sin(h)],[-Math.sin(h),Math.cos(h)]];return p[0][0]*=-1,p[0][1]*=-1,x[0][0]*=-1,x[1][0]*=-1,[p,g,x]}function GC(e,t){return[[e[0][0]*t[0][0]+e[0][1]*t[1][0],e[0][0]*t[0][1]+e[0][1]*t[1][1]],[e[1][0]*t[0][0]+e[1][1]*t[1][0],e[1][0]*t[0][1]+e[1][1]*t[1][1]]]}function j7(e){return[[e[0][0],e[1][0]],[e[0][1],e[1][1]]]}function uVe(e){let[t,i,n]=cVe(e),r=GC(t,j7(n)),s=GC(GC(n,i),j7(n)),a=Math.atan2(r[1][0],r[0][0]),o=[s[0][0],s[1][1]],l=[s[0][1]/s[1][1],s[1][0]/s[0][0]];return{rotation:a,scale:o,shear:l}}function hVe({rotation:e,scale:t,shear:i}){let n=Math.cos(e),r=Math.sin(e),s=[[n,-r],[r,n]],a=[[t[0],i[0]*t[1]],[i[1]*t[0],t[1]]],o=GC(s,a);return[o[0][0],o[1][0],o[0][1],o[1][1]]}var Tn;(e=>{function t(){return[1,0,0,0,1,0,0,0,1]}e.identity=t;function i(T,I=e.identity()){for(let R=0,O=T.length;R<O;R++)I[R]=T[R];return I}e.copy=i;function n(T,I,R,O,P,U){return e.setAbcdef(e.identity(),T,I,R,O,P,U)}e.create=n;function r(T,I,R,O,P,U,H){return T[0]=I,T[1]=O,T[2]=U,T[3]=R,T[4]=P,T[5]=H,T}e.setAbcdef=r;function s(T,I){let[R,O,P,U,H,V]=o(T),[j,J,F,X,W,ne]=o(I),Y=j*R+J*P,$=j*O+J*U,se=F*R+X*P,fe=F*O+X*U,te=W*R+ne*P+H,de=W*O+ne*U+V;return e.create(Y,$,se,fe,te,de)}e.append=s;function a(T,I){let[R,O,P,U,H,V]=o(T),[j,J,F,X,W,ne]=o(I),Y=R,$=O,se=P,fe=U;(j!==1||J!==0||F!==0||X!==1)&&(Y=R*j+O*F,$=R*J+O*X,se=P*j+U*F,fe=P*J+U*X);let te=H*j+V*F+W,de=H*J+V*X+ne;return e.create(Y,$,se,fe,te,de)}e.prepend=a;function o(T){return[T[0],T[3],T[1],T[4],T[2],T[5]]}e.getAbcdef=o;function l(T){let[I,R,O,P,U,H]=e.getAbcdef(T),V=I*P-R*O,j=P/V,J=-R/V,F=-O/V,X=I/V,W=(O*H-P*U)/V,ne=-(I*H-R*U)/V;return e.create(j,J,F,X,W,ne)}e.invert=l;function c([T,I],R){let[O,P,U,H,V,j]=e.getAbcdef(R);return[O*T+U*I+V,P*T+H*I+j]}e.apply=c;function u(T,I){let[R,O,P,U,H,V]=e.getAbcdef(I),j=1/(R*U+P*-O),[J,F]=T;return[U*j*J+-P*j*F+(V*P-H*U)*j,R*j*F+-O*j*J+(-V*R+H*O)*j]}e.applyInverse=u;function h(T,I,R=I){let[O,P,U,H,V,j]=e.getAbcdef(T);return e.setAbcdef(T,O*I,P*R,U*I,H*R,V*I,j*R),T}e.scale=h;function d(T,I){let R=Math.cos(I),O=Math.sin(I),[P,U,H,V,j,J]=e.getAbcdef(T);return e.setAbcdef(T,P*R-U*O,P*O+U*R,H*R-V*O,H*O+V*R,j*R-J*O,j*O+J*R),T}e.rotate=d;function p(T,I,R){let[O,P]=R,U=e.translate(T,-O,-P);return U=e.rotate(U,I),U=e.translate(U,O,P),U}e.rotateAround=p;function g(T,I,R){let[O,P,U,H,V,j]=e.getAbcdef(T);return e.setAbcdef(T,O,P,U,H,V+I,j+R),T}e.translate=g;function x(T,I,R){let[O,P,U,H]=e.getAbcdef(T);return e.setAbcdef(T,O,P,U,H,I,R),T}e.setTranslate=x;function y(T,I,R){let[O,P,U,H]=e.getAbcdef(T);return e.setAbcdef(T,O,P,U,H,I,R),T}e.setPosition=y;function b(T){let[I,R,O,P]=e.getAbcdef(T),U=Math.sqrt(I*I+R*R),H=Math.sqrt(O*O+P*P);return[U,H]}e.getScale=b;function A(T){let[,,,,I,R]=e.getAbcdef(T);return[I,R]}e.getPosition=A;function w(T,I){return e.decompose(T,I).rotation}e.getRotation=w;function E(T,I){let[R,O,P,U,H,V]=e.getAbcdef(T),{rotation:j,scale:J,shear:F}=uVe([[R,P],[O,U]]);return{position:[H+(I[0]*R+I[1]*P)-I[0],V+(I[0]*O+I[1]*U)-I[1]],scale:J,rotation:j,shear:F,pivot:I}}e.decompose=E;function D(T,I,R,O,P=[0,0]){let[U,H]=T,[V,j]=O,[J,F,X,W]=hVe({rotation:R,scale:I,shear:P}),ne=U-(V*J+j*X)+V,Y=H-(V*F+j*W)+j;return e.create(J,F,X,W,ne,Y)}e.compose=D})(Tn||(Tn={}));var dVe=Math.PI/180;function fVe(e,t,i,n,r,s){let a=e-i,o=t-n;return a*a/(r*r)+o*o/(s*s)<=1}function pVe(e){return e*dVe}var _a=class{constructor(e,t,i){this.uuid=e,this.data=t,this.localMatrix=Tn.identity(),this.worldMatrix=Tn.identity(),this.ignoreCameraZoom=!1,this.visible=!0,this._singleBBox=new Sz,this._recursiveBBox=new Sz,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this.stateSelection=null,this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this.name="",this.position=[0,0],this.scale=[1,1],this.rotation=0,this.shear=[0,0],this.emitter=oP(),this.dpr=i.dpr??1,this.dataPatched=t}project(e,t){let i=this.worldMatrix;return t&&(i=Tn.append(t.worldMatrix,i)),Tn.applyInverse(e,i)}intersects(e,t,i,n=!1){return this.visible&&!this.data.raycastLock&&this.intersectsInLocalSpace(...this.project([e,t],i),n)}intersectsInLocalSpace(e,t,i=!1){let{min:n,max:r}=i?this.recursiveBBox:this.singleBBox;return e>=n[0]&&e<=r[0]&&t>=n[1]&&t<=r[1]}applyTransforms(e){e.setTransform(this.worldMatrix,this.ignoreCameraZoom)}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges()),this._recursiveBBox}updateLocalMatrix(){this.localMatrix=Tn.compose(this.position,this.scale,pVe(this.rotation),w0.getPivot(this.dataPatched),this.shear)}updateWorldMatrix(e,t,i){let n=this.parent;t&&n!==null&&n!==void 0&&n.updateWorldMatrix(e,!0,!1),e&&this.updateLocalMatrix(),this.parent?this.worldMatrix=Tn.append(this.parent.worldMatrix,this.localMatrix):this.worldMatrix=Tn.copy(this.localMatrix),this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}get pivot(){return w0.getPivot(this.data)}getCenter(){return[0,0]}getHalfSize(){return[0,0]}get id(){return this.uuid}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors(e=>{e.resetBBoxNeedsUpdateSelf()})}updateTransformState(e){let t=!1;e.position!==void 0&&(t=!0,this.position=e.position),e.rotation!==void 0&&(t=!0,this.rotation=e.rotation),e.scale!==void 0&&(t=!0,this.scale=e.scale),e.shear!==void 0&&(t=!0,this.shear=e.shear),t&&(this.updateWorldMatrix(!0,!1,!0),this.resetBBoxNeedsUpdate())}updateByOp(e,t,i){e.type===0&&e.props.visible!==void 0&&(this.visible=e.props.visible),this.data=t,this.data=t;let n=e,r=cr(e.path,["states","*"]);if(r!==null){if(e.type===0){let[s]=r;if((this==null?void 0:this.stateSelection)===s){let a={...e.props};if(delete a.name,Object.values(e.props).some(o=>o===void 0)){let o=this.data;if(o!==void 0){let l=Ys.zoom(o,e.path.slice(2));if(l)for(let c in e.props)e.props[c]===void 0&&c in l&&(a[c]=l[c])}}n={...e,props:a,path:e.path.slice(2)}}}}else if(e.type===0){let s=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(s!==void 0){if(e.props.name!==void 0&&s.name){let{name:o,...l}=s;s=l}let a=Ys.removeOverridden(e.path,e.props,s);n={...e,props:a}}}this.updateByPatchedOpBase(n,c0.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),i)}changeSelectedState(e,t,i=!1){if(!(this.data.states.length===0&&!i)){for(let n of this.data.states)c0.toOps(this.data,n.data).forEach(r=>{let s=y3.replaceProps(r,this.data);this.dataPatched=this.data,this.updateByPatchedOp(s,this.data,t)});if(e!==null){let n=this.data.states.data(e);n&&(this.dataPatched=c0.patch(this.data,n),c0.toOps(this.data,n).forEach(r=>{this.updateByPatchedOp(r,this.dataPatched,t)}))}i&&this.updateTransformState(this.dataPatched),this.stateSelection=e}}updateState(e,t){e.name!==void 0&&(this.name=e.name),e.visible!==void 0&&(this.visible=e.visible),this.updateTransformState(e)}updateByPatchedOpBase(e,t,i){this.dataPatched=t,this.updateByPatchedOp(e,t,i)}updateByPatchedOp(e,t,i){e.path.length===0&&e.type===0&&this.updateState(e.props,i),this.requestRender()}traverseFrameAncestors(e){this.traverseAncestors(t=>{t.data.type==="frame2d"&&e(t)})}traverseAncestors(e){let t=this.parent;for(;t;)e(t),t=t.parent}requestRender(){this.traverseFrameAncestors(e=>{e.requestRender()})}clone(e){let t=new _a(this.uuid,this.data,e);return t.parent=void 0,t}addEventListener(e,t){this.emitter.on(e,t)}removeEventListener(e,t){this.emitter.off(e,t)}dispatchEvent(e){this.emitter.emit(e.type,{...e,target:e.target??this})}traverseSortNextHelper(){let e=this.parent;if(e){let t=e.children;if(t){let i=t.indexOf(this)+1;return t[i]?t[i]:e.traverseSortNextHelper()}}}sortNext(){let e=this.children;return e&&e.length>0&&e[0]?e[0]:this.traverseSortNextHelper()}isDescendantOf(e){e instanceof _a&&(e=e.uuid);let t=this;for(;t.parent;){if(t.parent.uuid===e)return!0;t=t.parent}return!1}},ju=class extends _a{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.context=i,this.children=[]}add(e){e.parent&&e.parent instanceof ju&&e.parent.remove(e),this.children.push(e),e.parent=this}remove(e){let t=this.children.indexOf(e);t>=0&&(this.children.splice(t,1),e.parent=void 0)}traverse(e){let t=e(this);if(t!==!0)for(let i of this.children)i instanceof ju?i.traverse(e):t=e(i)}intersectsChildrenHelper(e,t,i,n,r){for(let s of this.children)if(s.intersects(e,t,i,!1)&&(r.push(s),n)||s instanceof ju&&s.intersectsChildrenHelper(e,t,i,n,r))return!0;return!1}intersectsChildren(e,t,i,n=!1,r=[],s=!1){return this.intersectsChildrenHelper(e,t,i,n,r),r}intersectsChildrenHelperReverse(e,t,i,n,r){for(let s of this.children)if(s instanceof ju&&s.intersectsChildrenHelperReverse(e,t,i,n,r)||s.intersects(e,t,i,!1)&&(r.push(s),n))return!0;return!1}intersectsChildrenReverse(e,t,i,n=!1,r=[],s=!1){return this.intersectsChildrenHelperReverse(e,t,i,n,r),r}updateWorldMatrix(e,t,i){if(super.updateWorldMatrix(e,t,i),i&&this.children)for(let n of this.children)n.updateWorldMatrix(e,!1,!0)}find(e){let t;return this.traverse(i=>{i.uuid===e&&(t=i)}),t}innerDrawChildren(e){for(let t=this.children.length-1;t>=0;t--)this.children[t].draw(e)}resetBBoxNeedsUpdate(){super.resetBBoxNeedsUpdate(),this.traverse(e=>{e.resetBBoxNeedsUpdateSelf()})}clone(e){let t=new ju(this.uuid,this.data,e);t.parent=void 0;for(let i of this.children)t.add(i.clone(e));return t}},ag=class extends ju{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.updateState(t,i)}draw(e){!this.visible||(e.save(),this.applyTransforms(e),this.innerDrawChildren(e),e.restore())}clone(e){let t=new ag(this.uuid,this.data,e);t.parent=void 0;for(let i of this.children)t.add(i.clone(e));return t}};function mVe(e,t){let[[i,n],[r,s]]=e,[[a,o],[l,c]]=t,u=(i-r)*(o-c)-(n-s)*(a-l);if(u===0)return!1;let h=((i-a)*(o-c)-(n-o)*(a-l))/u,d=-((i-r)*(n-o)-(n-s)*(i-a))/u;return h>=0&&h<=1&&d>=0&&d<=1}var Tte=[[-1,1],[-1,-1],[1,-1],[1,1]],W7=(e,t,i)=>{let n=e.getCenter(),r=e.getHalfSize(),s=Tn.append(t,e.worldMatrix);r[0]===0&&r[1]===0?i.push(Tn.apply(n,s)):Tte.forEach(a=>{let o=[a[0]*r[0]+n[0],a[1]*r[1]+n[1]];i.push(Tn.apply(o,s))})},Sz=class{constructor(){this.matrix=Tn.identity(),this.min=[1/0,1/0],this.max=[-1/0,-1/0],this.vertices=[],this.edges=[]}setFromObjectSize(e,t=!1){e.updateWorldMatrix(),this.makeEmpty(),Tn.copy(e.worldMatrix,this.matrix);let i=Tn.invert(e.worldMatrix);this.expandByObjectSize(e,i,t)}expandByObjectSize(e,t,i=!1){let n=[];i===!0&&e instanceof ju?e.traverse(r=>{r.visible&&W7(r,t,n)}):W7(e,t,n),this.setFromPoints(n)}setFromSize(e,t,i){this.makeEmpty(),Tn.copy(i,this.matrix),this.expandBySize(e,t,i)}expandBySize(e,t,i){[Tn.apply([0,0],i),Tn.apply([0,t],i),Tn.apply([e,t],i),Tn.apply([e,0],i)].forEach(n=>this.expandByPoint(n))}getCenter(){let[e,t]=this.min,[i,n]=this.getHalfSize();return Tn.apply([e+i,t+n],this.matrix)}getSize(){return[this.max[0]-this.min[0],this.max[1]-this.min[1]]}getHalfSize(){return[(this.max[0]-this.min[0])*.5,(this.max[1]-this.min[1])*.5]}makeEmpty(){this.min=[1/0,1/0],this.max=[-1/0,-1/0]}setFromPoints(e){this.makeEmpty();for(let t of e)this.expandByPoint(t)}expandByPoint(e){this.min=[Math.min(this.min[0],e[0]),Math.min(this.min[1],e[1])],this.max=[Math.max(this.max[0],e[0]),Math.max(this.max[1],e[1])]}computeVertices(){let[e,t]=this.getHalfSize(),i=this.getCenter(),[n,r,s,a]=Tn.getAbcdef(this.matrix),o=Tn.create(n,r,s,a,i[0],i[1]);this.vertices=Tte.map(([l,c])=>Tn.apply([l*e,c*t],o))}computeEdges(){this.edges=[];for(let e=0,t=this.vertices.length;e<t;++e)this.edges.push([this.vertices[e],this.vertices[(e+1)%t]])}project(e,t){let i=this.matrix;return t&&(i=Tn.append(t.worldMatrix,i)),Tn.applyInverse(e,i)}intersects(e,t,i){return this.intersectsInLocalSpace(...this.project([e,t],i))}intersectsInLocalSpace(e,t){let{min:i,max:n}=this;return e>=i[0]&&e<=n[0]&&t>=i[1]&&t<=n[1]}containsPoint(e){let[t,i]=e,[n,r]=this.min,[s,a]=this.max;return t>=n&&t<=s&&i>=r&&i<=a}intersectsBBox2D(e){for(let t=0,i=this.edges.length;t<i;t++){let n=this.edges[t];for(let r=0,s=e.edges.length;r<s;r++){let a=e.edges[r];if(mVe(n,a))return!0}}for(let t=0,i=e.vertices.length;t<i;t++){let n=e.vertices[t];if(this.containsPoint(n))return!0}return!1}ensureMinMax(){let e=this.min,t=this.max;this.min=[Math.min(e[0],t[0]),Math.min(e[1],t[1])],this.max=[Math.max(e[0],t[0]),Math.max(e[1],t[1])]}copy(e){this.min=[...e.min],this.max=[...e.max],Tn.copy(e.matrix,this.matrix),this.computeVertices(),this.computeEdges()}clone(){let e=new Sz;return e.copy(this),e}},Cte,gVe=new Promise(e=>{Cte=e}),X7=!1,cC;function vVe(){if(X7)return;if(cC)return cC;async function e(){let t=await dg(()=>import("./ui-Ds7EeOeb.js"),[]);Cte(t.default??t),X7=!0}return cC=e(),cC}function q7(e){let t=!1;return e.scene.objects.traverse((i,n)=>{(n.type==="Mesh"&&n.geometry.type==="UIGeometry"||n.type==="Page"&&n.uiFrame!==void 0)&&(t=!0)}),t}var Ui,hL;async function yVe(e){let t=await gVe;Ui||(hL||(hL=t({locateFile:()=>e})),Ui=await hL)}var Y7=Tn.identity(),Dte=class{constructor(e,t=1){this.canvas=e,this._dpr=t,this._width=0,this._height=0,this._strokeMode="inside",this._layerBlur=0,this._backgroundBlur=0,this._dropShadowBlur=0,this._dropShadowOffsetX=0,this._dropShadowOffsetY=0,this._dropShadowColor=er.transparent,this._innerShadowBlur=0,this._innerShadowOffsetX=0,this._innerShadowOffsetY=0,this._innerShadowSpread=0,this._innerShadowColor=er.transparent,this._fonts=new Map,this._isSizeDirty=!1;try{let i=e.getBoundingClientRect();e.width=i.width*t,e.height=i.height*t}catch{console.log(e.width,t)}this._currentM3Transform=Y7,this._currentTransform=new Float32Array(Y7)}get dpr(){return this._dpr}set dpr(e){this._dpr=e,this._isSizeDirty=!0}async init(){var e,t;if(!this.wasmURL)throw Error("Your must set the wasm binary url with renderer.wasmURL = ... before you can call renderer.init");await yVe(this.wasmURL),this._surface=Ui.MakeWebGLCanvasSurface(this.canvas),this.ctx=(e=this._surface)==null?void 0:e.getCanvas(),this._paint=new Ui.Paint,this._paint.setAntiAlias(!0),this._paintFill=this._paint.copy(),this._paintFill.setStyle(Ui.PaintStyle.Fill),this._paintStroke=this._paint.copy(),this._paintStroke.setStyle(Ui.PaintStyle.Stroke),(t=this.ctx)==null||t.scale(this.dpr,this.dpr)}get currentTransform(){return this._currentM3Transform}get currentTransformBuffer(){return this._currentTransform}set currentTransform(e){this._currentM3Transform=e,this._currentTransform.set(e)}async loadFont(e,t){let i=await(await fetch(e)).arrayBuffer();this.registerFont(i,t)}registerFont(e,t){if(this._fonts.has(t))return;let i=Ui.FontMgr.FromData(e);if(i)this._fonts.set(t,i);else throw new Error("Invalid font data for "+t)}get width(){return this._width}get height(){return this._height}set strokeColor(e){this._paintStroke&&this._paintStroke.setColor(uC(e),Ui.ColorSpace.DISPLAY_P3)}set fillColor(e){this._paintFill&&this._paintFill.setColor(uC(e),Ui.ColorSpace.DISPLAY_P3)}set lineWidth(e){this._paintStroke&&this._paintStroke.setStrokeWidth(this._strokeMode==="center"?e:e*2)}set strokeMode(e){this._strokeMode=e}set dropShadowBlur(e){this._dropShadowBlur=e}set dropShadowColor(e){this._dropShadowColor=e}set dropShadowOffsetX(e){this._dropShadowOffsetX=e}set dropShadowOffsetY(e){this._dropShadowOffsetY=e}set innerShadowBlur(e){this._innerShadowBlur=e}set innerShadowColor(e){this._innerShadowColor=e}set innerShadowOffsetX(e){this._innerShadowOffsetX=e}set innerShadowOffsetY(e){this._innerShadowOffsetY=e}set innerShadowSpread(e){this._innerShadowSpread=e}set layerBlur(e){this._layerBlur=e}set backgroundBlur(e){this._backgroundBlur=e}clear(){var e;(e=this.ctx)==null||e.clear(Ui.TRANSPARENT)}save(){var e;(e=this.ctx)==null||e.save()}restore(){var e;(e=this.ctx)==null||e.restore()}beginPath(){var e;(e=this._currentPath)==null||e.delete(),this._currentPath=new Ui.Path}closePath(){let e=this._currentPath;if(e){if(e.isEmpty())return;let t=e.getBounds();(t[3]-t[1]||t[2]-t[0])&&e.close()}}fill(){this._paintInner(this._paintFill,!0)}stroke(){this._paintInner(this._paintStroke,!1)}clipRect(e,t,i,n,r=0,s=0,a=0,o=0){var c,u;let l=Ui.XYWHRect(e,t,i,n);if(r===0&&s===0&&o===0&&a===0)(c=this.ctx)==null||c.clipRect(l,Ui.ClipOp.Intersect,!0);else{let h=Ui.RRectXY(l,r,r);h[4]=h[5]=r,h[6]=h[7]=s,h[8]=h[9]=a,h[10]=h[11]=o,(u=this.ctx)==null||u.clipRRect(h,Ui.ClipOp.Intersect,!0)}}_applyShadowOffsetMatrix(){if(this.ctx){let e=Tn.invert(this.currentTransform);this.ctx.concat(e);let t=Tn.translate(Tn.identity(),this._dropShadowOffsetX,this._dropShadowOffsetY);this.ctx.concat(t),this.ctx.concat(this._currentTransform)}}_applyEffectsToPaint(e,t,i=!0){var n,r,s,a;if(this.ctx&&this._currentPath){let o,l=!1;if(i&&this._hasDropShadow()){let c=e.copy();c.setColor(uC(this._dropShadowColor));let u;this._dropShadowBlur>0&&(u=Ui.MaskFilter.MakeBlur(Ui.BlurStyle.Normal,this._dropShadowBlur*this.dpr*(((n=this.camera)==null?void 0:n.scale)??1),!1),c.setMaskFilter(u)),this.ctx.save(),this.ctx.clipPath(this._currentPath,Ui.ClipOp.Difference,!0),this._applyShadowOffsetMatrix(),t(c),this.ctx.restore(),c.delete(),u==null||u.delete()}if(this._backgroundBlur>0&&i){this.ctx.save(),this.ctx.clipPath(this._currentPath,Ui.ClipOp.Intersect,!0);let c=Ui.ImageFilter.MakeBlur(this._backgroundBlur,this._backgroundBlur,Ui.TileMode.Clamp,null),u=e.copy();u.setImageFilter(c),u.setAlphaf(1);let h=this._currentPath.computeTightBounds();this.ctx.saveLayer(u,h,null,Ui.SaveLayerInitWithPrevious),this.ctx.drawColor(e.getColor()),this.ctx.restore(),this.ctx.restore(),u.delete(),c.delete(),l=!0}if(this._layerBlur>0){let c=e.copy();o=Ui.MaskFilter.MakeBlur(Ui.BlurStyle.Normal,this._layerBlur*this.dpr*(((r=this.camera)==null?void 0:r.scale)??1),!1),c.setMaskFilter(o),t(c),c.delete(),o.delete(),l=!0}if(l||t(e),i&&this._hasInnerShadow()){let c=new Ui.Paint;c.setAntiAlias(!0),c.setStyle(Ui.PaintStyle.Fill),c.setColor(uC(this._innerShadowColor));let u;this._innerShadowBlur>0&&(u=Ui.MaskFilter.MakeBlur(Ui.BlurStyle.Normal,this._innerShadowBlur*this.dpr*(((s=this.camera)==null?void 0:s.scale)??1),!1),c.setMaskFilter(u));let h=this._currentPath.computeTightBounds(),[d,p,g,x]=h,y=g-d,b=x-p;this.ctx.save(),this.ctx.clipPath(this._currentPath,Ui.ClipOp.Intersect,!0),this.ctx.saveLayer(c,h,null,Ui.SaveLayerInitWithPrevious),(a=this.ctx)==null||a.translate(this._innerShadowOffsetX,this._innerShadowOffsetY),this.ctx.drawRect(Ui.XYWHRect(-1e3-this._innerShadowOffsetX,-1e3-this._innerShadowOffsetY,2e3+y+Math.abs(this._innerShadowOffsetX*2),2e3+b+Math.abs(this._innerShadowOffsetY*2)),c),c.setBlendMode(Ui.BlendMode.Clear),this.ctx.drawPath(this._currentPath,c),this.ctx.restore(),this.ctx.restore(),c.delete(),u==null||u.delete()}}}_paintInner(e,t=!0){if(this.ctx&&this._currentPath&&e){let i=this.ctx,n=this._currentPath;this._applyEffectsToPaint(e,r=>{let s=!1;!t&&this._strokeMode!=="center"&&(i.save(),i.clipPath(n,this._strokeMode==="outside"?Ui.ClipOp.Difference:Ui.ClipOp.Intersect,!0),s=!0),i.drawPath(n,r),s&&i.restore()},t)}}_hasDropShadow(){var e;return((e=this._dropShadowColor)==null?void 0:e.a)>0}_hasInnerShadow(){var e;return((e=this._innerShadowColor)==null?void 0:e.a)>0}path(e){var t;(t=this._currentPath)==null||t.addPath(Ui.Path.MakeFromSVGString(e))}ellipse(e,t,i,n,r,s,a,o){var c;if(!Q7([e,t,i,n])||!this._currentPath)return;if(i<0||n<0)throw Error("radii cannot be negative");let l=Ui.XYWHRect(e-i,t-n,i*2,n*2);(c=this._currentPath)==null||c.addOval(l)}rect(e,t,i,n,r=0,s=0,a=0,o=0){var c,u;let l=Ui.XYWHRect(e,t,i,n);if(Q7(l))if(r===0&&s===0&&o===0&&a===0)(c=this._currentPath)==null||c.addRect(l);else{let h=Ui.RRectXY(l,r,r);h[4]=h[5]=r,h[6]=h[7]=s,h[8]=h[9]=a,h[10]=h[11]=o,(u=this._currentPath)==null||u.addRRect(h)}}getHorizontalAlign(e){switch(e){case 2:return Ui.TextAlign.Right;case 3:return Ui.TextAlign.Center;case 4:return Ui.TextAlign.Justify;case 1:default:return Ui.TextAlign.Left}}drawTextInner(e,t,i,[n,r,s,a],o,l,c=!0){let u=0,{ctx:h}=this;if(!h)return u;let d=l.copy(),p=l.copy();return p.setAlphaf(0),this._applyEffectsToPaint(d,g=>{t.pushPaintStyle(i,g,p),t.addText(e);let x=t.build();x.layout(s);let y=r;o===2?y+=(a-x.getHeight())/2:o===3&&(y+=a-x.getHeight()),h.drawParagraph(x,n,y),u=x.getHeight(),t.reset(),x.delete()},c),d.delete(),p.delete(),u}drawText(e,t){let i=0,n=this._fonts.get(t.font),{ctx:r,_paintFill:s,_paintStroke:a}=this;if(n&&r){let o=new Ui.TextStyle({fontFamilies:[t.font],fontSize:t.fontSize,heightMultiplier:t.lineHeight,letterSpacing:t.letterSpacing}),l=new Ui.ParagraphStyle({textStyle:o,textAlign:this.getHorizontalAlign(t.horizontalAlign)}),c=Ui.XYWHRect(t.x,t.y,t.width,t.height),u=Ui.ParagraphBuilder.Make(l,n);s&&(i=this.drawTextInner(e,u,o,c,t.verticalAlign,s,!0)),a&&(i=this.drawTextInner(e,u,o,c,t.verticalAlign,a,!1)),u.delete()}return{height:i}}render(){var e;(e=this._surface)==null||e.flush()}moveTo(e,t){var i;(i=this._currentPath)==null||i.moveTo(e,t)}lineTo(e,t){var i;(i=this._currentPath)==null||i.lineTo(e,t)}bezierCurveTo(e,t,i,n,r,s){var a;(a=this._currentPath)==null||a.cubicTo(e,t,i,n,r,s)}quadraticCurveTo(e,t,i,n){var r;(r=this._currentPath)==null||r.quadTo(e,t,i,n)}setTransform(e,t=!1){var r,s,a,o,l;if(!this.ctx)return;let i=this.ctx.getTotalMatrix(),n=Tn.invert(i);if(n&&this.ctx.concat(n),(r=this.ctx)==null||r.scale(this.dpr,this.dpr),((s=this.camera)==null?void 0:s.enabled)&&((a=this.ctx)==null||a.concat(this.camera.worldMatrix),t)){let c=Tn.getScale(this.camera.worldMatrix);(o=this.ctx)==null||o.scale(1/c[0],1/c[1])}(l=this.ctx)==null||l.concat(e),this.currentTransform=e}transform(e){var t;(t=this.ctx)==null||t.concat(e)}setSize(e,t){var i;!this._isSizeDirty&&e===this._width&&t===this._height||(this._isSizeDirty=!1,this._width=e,this._height=t,this.canvas.style.width=e+"px",this.canvas.style.height=t+"px",this.canvas.width=e*this.dpr,this.canvas.height=t*this.dpr,this._surface&&(this._surface=Ui.MakeWebGLCanvasSurface(this.canvas),this.ctx=(i=this._surface)==null?void 0:i.getCanvas()))}};function Q7(e){for(let t=0;t<e.length;t++)if(e[t]!==void 0&&!Number.isFinite(e[t]))return!1;return!0}function uC({r:e,g:t,b:i,a:n}){return Ui.Color4f(e,t,i,n)}var K7=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.color=er.transparent,this.blurRadius=0,this.offset=[0,0],this.spread=0,this.update(t)}update(e){e.color!==void 0&&(this.color=e.color),e.enabled!==void 0&&(this.enabled=e.enabled),e.blurRadius!==void 0&&(this.blurRadius=e.blurRadius),e.offset!==void 0&&(this.offset=e.offset),e.spread!==void 0&&(this.spread=e.spread)}},J7=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.radius=0,this.update(t)}update(e){e.enabled!==void 0&&(this.enabled=e.enabled),e.radius!==void 0&&(this.radius=e.radius)}},xVe=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.color=er.transparent,this.update(t)}update(e){e.enabled!==void 0&&(this.enabled=e.enabled),e.color!==void 0&&(this.color=e.color)}},bVe=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.color=er.transparent,this.thickness=0,this.mode="inside",this.update(t)}update(e){e.enabled!==void 0&&(this.enabled=e.enabled),e.color!==void 0&&(this.color=e.color),e.thickness!==void 0&&(this.thickness=e.thickness),e.mode!==void 0&&(this.mode=e.mode)}},pa=class extends _a{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.autoClose=!0,this.fill=new xVe(e+"-fill",t.fill,i),this.stroke=new bVe(e+"-stroke",t.stroke,i),this.dropShadow=new K7(e+"-dropShadow",t.dropShadow,i),this.innerShadow=new K7(e+"-innerShadow",t.innerShadow,i),this.backgroundBlur=new J7(e+"-backgroundBlur",t.backgroundBlur,i),this.layerBlur=new J7(e+"-layerBlur",t.layerBlur,i)}applyFillStroke(e){e.fillColor=this.fill.enabled?this.fill.color:er.transparent,e.strokeColor=this.stroke.enabled&&this.stroke.thickness>0?this.stroke.color:er.transparent,e.strokeMode=this.stroke.mode,e.lineWidth=this.stroke.thickness}applyFilters(e){this.layerBlur.enabled?e.layerBlur=this.layerBlur.radius*5:e.layerBlur=0,this.backgroundBlur.enabled?e.backgroundBlur=this.backgroundBlur.radius*5:e.backgroundBlur=0,this.dropShadow.enabled?(e.dropShadowBlur=this.dropShadow.blurRadius*5,e.dropShadowColor=this.dropShadow.color,e.dropShadowOffsetX=this.dropShadow.offset[0],e.dropShadowOffsetY=this.dropShadow.offset[1]):e.dropShadowColor=er.transparent,this.innerShadow.enabled?(e.innerShadowSpread=this.innerShadow.spread,e.innerShadowBlur=this.innerShadow.blurRadius*5,e.innerShadowColor=this.innerShadow.color,e.innerShadowOffsetX=this.innerShadow.offset[0],e.innerShadowOffsetY=this.innerShadow.offset[1]):e.innerShadowColor=er.transparent}innerDraw(e){}draw(e){!this.visible||(e.save(),this.applyTransforms(e),this.applyFilters(e),this.applyFillStroke(e),e.beginPath(),this.innerDraw(e),this.autoClose&&e.closePath(),this.fill.enabled&&e.fill(),this.stroke.enabled&&e.stroke(),e.restore())}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),e.type===0&&(cr(e.path,["fill"])?this.fill.update(e.props):cr(e.path,["stroke"])?this.stroke.update(e.props):cr(e.path,["dropShadow"])?this.dropShadow.update(e.props):cr(e.path,["innerShadow"])?this.innerShadow.update(e.props):cr(e.path,["layerBlur"])?this.layerBlur.update(e.props):cr(e.path,["backgroundBlur"])?this.backgroundBlur.update(e.props):this.resetBBoxNeedsUpdate())}updateState(e,t){super.updateState(e,t),e.fill!==void 0&&this.fill.update(e.fill),e.stroke!==void 0&&this.stroke.update(e.stroke),e.dropShadow!==void 0&&this.dropShadow.update(e.dropShadow),e.innerShadow!==void 0&&this.innerShadow.update(e.innerShadow),e.layerBlur!==void 0&&this.layerBlur.update(e.layerBlur),e.backgroundBlur!==void 0&&this.backgroundBlur.update(e.backgroundBlur)}clone(e){let t=new pa(this.uuid,this.data,e);return t.parent=void 0,t}},G5=class extends pa{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.width=0,this.height=0,this.updateState(t,i)}innerDraw(e){e.ellipse(this.width*.5,this.height*.5,this.width*.5,this.height*.5,0,0,Math.PI*2)}intersectsInLocalSpace(e,t){return fVe(e,t,this.width*.5,this.height*.5,this.width*.5,this.height*.5)}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateSizeState(e){let t=!1;e.width!==void 0&&(this.width=typeof e.width=="number"?e.width:this.width,t=!0),e.height!==void 0&&(this.height=typeof e.height=="number"?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateState(e,t){super.updateState(e,t),this.updateSizeState(e)}clone(e){let t=new G5(this.uuid,this.data,e);return t.parent=void 0,t}},xM=class extends pa{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.width=0,this.height=0,this.cornerRadius=[0,0,0,0],this.updateState(t,i)}innerDraw(e){e.rect(0,0,this.width,this.height,...this.cornerRadius)}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateCornerState(e){e.cornerRadius!==void 0&&(this.cornerRadius=e.cornerRadius)}updateSizeState(e){let t=!1;e.width!==void 0&&(this.width=typeof e.width=="number"?e.width:this.width,t=!0),e.height!==void 0&&(this.height=typeof e.height=="number"?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateState(e,t){super.updateState(e,t),this.updateSizeState(e),this.updateCornerState(e)}clone(e){let t=new xM(this.uuid,this.data,e);return t.parent=void 0,t}},k5=class extends pa{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this._textHeight=0,this._textHeightDirty=!0,this.width=0,this.height=0,this.updateState(t,i)}get textHeight(){return this._textHeight}applyFillStroke(e){e.fillColor=this.fill.enabled?this.fill.color:er.transparent,e.strokeColor=this.stroke.enabled&&this.stroke.thickness>0?this.stroke.color:er.transparent,e.strokeMode="center",e.lineWidth=this.stroke.thickness}innerDraw(e){var s;(s=this._fontHolder)!=null&&s.arrayBuffer&&this._fontHolder.arrayBuffer.byteLength>1&&this.data.font&&e.registerFont(this._fontHolder.arrayBuffer,this.data.font);let t=this.data.textTransform,i=this.data.text.textValue.toString(),n=t===2?i.toUpperCase():t===3?i.toLowerCase():i,{height:r}=e.drawText(n,{x:0,y:0,width:this.width,height:this.height,fontSize:this.data.fontSize,lineHeight:this.data.lineHeight??1,letterSpacing:this.data.letterSpacing??0,horizontalAlign:this.data.horizontalAlign,verticalAlign:this.data.verticalAlign,font:this.data.font});this._textHeight=r}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateSizeState(e){let t=!1;e.width!==void 0&&(this.width=typeof e.width=="number"?e.width:this.width,t=!0),e.height!==void 0&&(this.height=typeof e.height=="number"?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateFontState(e,{shared:t}){e.font!==void 0&&(this._fontHolder=t.getFont(e.font),this._fontHolder&&!this._fontHolder.isLoaded&&this._fontHolder.loadingPromise.then(()=>{this.requestRender()}))}updateState(e,t){super.updateState(e,t),this.updateSizeState(e),this.updateFontState(e,t)}clone(e){let t=new k5(this.uuid,this.data,e);return t.parent=void 0,t}},Rte=class extends pa{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.curves=[],this.extremasBBox={min:[0,0],max:[0,0]},this.updateState(t,i)}computeExtremas(){this.curves.length===0&&this.computeCurves();let e=this.curves.map(n=>q3.extremas(n)),t=[1/0,1/0],i=[-1/0,-1/0];for(let n=0,r=e.length;n<r;n++){let s=e[n];s[0][0]<t[0]&&(t[0]=s[0][0]),s[0][1]<t[1]&&(t[1]=s[0][1]),s[1][0]>i[0]&&(i[0]=s[1][0]),s[1][1]>i[1]&&(i[1]=s[1][1])}return this.extremasBBox.min=[t[0],t[1]],this.extremasBBox.max=[i[0],i[1]],this.extremasBBox}computeCurves(){this.curves=[];for(let i=1,n=this.data.points.length;i<n;i++){let r=this.data.points[i].data,s=this.data.points[i-1].data,a={start:s.position,cp1:s.controlNext.position,cp2:r.controlPrevious.position,end:r.position};this.curves.push(a)}let e=this.data.points[0].data,t=this.data.points[this.data.points.length-1].data;if(this.data.isClosed){let i={start:t.position,cp1:t.controlNext.position,cp2:e.controlPrevious.position,end:e.position};this.curves.push(i)}}getCenter(){let[e,t]=this.extremasBBox.min,[i,n]=this.getHalfSize();return[e+i,t+n]}getHalfSize(){let{min:e,max:t}=this.extremasBBox;return[(t[0]-e[0])*.5,(t[1]-e[1])*.5]}innerDraw(e){for(let n=0,r=this.data.points.length;n<r;n++){let s=this.data.points[n].data;if(n===0){let[a,o]=s.position;e.moveTo(a,o)}else{let a=this.data.points[n-1].data,[o,l]=a.controlNext.position,[c,u]=s.controlPrevious.position,[h,d]=s.position,p={start:a.position,cp1:a.controlNext.position,cp2:s.controlPrevious.position,end:s.position};q3.derive(p),e.bezierCurveTo(o,l,c,u,h,d)}}let t=this.data.points[0].data,i=this.data.points[this.data.points.length-1].data;if(this.data.isClosed){let[n,r]=i.controlNext.position,[s,a]=t.controlPrevious.position,[o,l]=t.position;e.bezierCurveTo(n,r,s,a,o,l)}}updateState(e,t){super.updateState(e,t),this.computeExtremas()}clone(e){let t=new Rte(this.uuid,this.data,e);return t.parent=void 0,t}},q3;(e=>{function t(a){let o=a.start,l=a.cp1,c=a.cp2,u=a.end,h=[3*(l[0]-o[0]),3*(l[1]-o[1])],d=[3*(c[0]-l[0]),3*(c[1]-l[1])],p=[3*(u[0]-c[0]),3*(u[1]-c[1])],g={start:h,cp:d,end:p};return a.derivative=g,g.derivative=_z.derive(g),g}e.derive=t;function i(a,o,l,c=!1){let u=a-2*o+l;if(u!==0){let h=-Math.sqrt(Math.abs(o*o-a*l)),d=-a+o,p=-(h+d)/u,g=-(-h+d)/u;return[p,g]}else if(o!==l&&u===0)return[(2*o-l)/(2*(o-l))];return[]}function n(a){let o=a.derivative??e.derive(a),l=o.start,c=o.cp,u=o.end;return[i(l[0],c[0],u[0]),i(l[1],c[1],u[1])]}e.droot=n;function r(a){let[o,l]=e.droot(a),c=[a.start[0],a.end[0]],u=[a.start[1],a.end[1]];for(let h of o)c.push(e.compute(a,Math.min(1,Math.max(0,h)))[0]);for(let h of l)u.push(e.compute(a,Math.min(1,Math.max(0,h)))[1]);return c.sort((h,d)=>h-d),u.sort((h,d)=>h-d),[[c[0],u[0]],[c[c.length-1],u[u.length-1]]]}e.extremas=r;function s(a,o){if(o===0)return[...a.start];if(o===1)return[...a.end];let l=1-o,c=l*l,u=o*o,h=c*l,d=c*o*3,p=l*u*3,g=o*u;return[h*a.start[0]+d*a.cp1[0]+p*a.cp2[0]+g*a.end[0],h*a.start[1]+d*a.cp1[1]+p*a.cp2[1]+g*a.end[1]]}e.compute=s})(q3||(q3={}));var _z;(e=>{function t(r){let s=r.start,a=r.cp,o=r.end,l=[2*(a[0]-s[0]),2*(a[1]-s[1])],c=[2*(o[0]-a[0]),2*(o[1]-a[1])],u={start:l,end:c};return u.derivative=Az.derive(u),r.derivative=u,u}e.derive=t;function i(r){let s=r.derivative??e.derive(r),a=s.start,o=s.end;return[a[0]!==o[0]?a[0]/(a[0]-o[0]):0,a[1]!==o[1]?a[1]/(a[1]-o[1]):0]}e.droot=i;function n(r,s){if(s===0)return[...r.start];if(s===1)return[...r.end];let a=1-s,o=a*a,l=s*s,c=o,u=a*s*2,h=l;return[c*r.start[0]+u*r.cp[0]+h*r.end[0],c*r.start[1]+u*r.cp[1]+h*r.end[1]]}e.compute=n})(_z||(_z={}));var Az;(e=>{function t(n){let r=n.start,s=n.end,a=[s[0]-r[0],s[1]-r[1]];return n.derivative=a,n.derivative}e.derive=t;function i(n,r){if(r===0)return[...n.start];if(r===1)return[...n.end];let s=n.start,a=n.end;return[s[0]+(a[0]-s[0])*r,s[1]+(a[1]-s[1])*r]}e.compute=i})(Az||(Az={}));var yd=class extends ju{constructor(e,t,i){super(e,t,i),this.uuid=e,this.width=0,this.height=0,this.clipped=!0,this.background=new xM(e+"-background",Dw.defaultData,i),this.background.parent=this,this.updateState(t,i)}get fill(){return this.background.fill}get stroke(){return this.background.stroke}get backgroundBlur(){return this.background.backgroundBlur}get layerBlur(){return this.background.layerBlur}get dropShadow(){return this.background.dropShadow}get innerShadow(){return this.background.innerShadow}get cornerRadius(){return this.background.cornerRadius}set cornerRadius(e){this.background.cornerRadius=e}updateLocalMatrix(){var e;super.updateLocalMatrix(),(e=this.background)==null||e.updateLocalMatrix()}updateWorldMatrix(e,t,i){var n;super.updateWorldMatrix(e,t,i),(n=this.background)==null||n.updateWorldMatrix(e,t,i)}draw(e){if(!this.visible)return;e.save();let t=this.width,i=this.height;this.applyTransforms(e),this.background.width=t,this.background.height=i,this.background.draw(e),this.clipped&&e.clipRect(0,0,t,i,...this.cornerRadius),this.innerDrawChildren(e),e.restore()}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateCornerState(e){e.cornerRadius!==void 0&&(this.cornerRadius=e.cornerRadius)}updateSizeState(e){let t=!1;e.width!==void 0&&(this.width=typeof e.width=="number"?e.width:this.width,t=!0),e.height!==void 0&&(this.height=typeof e.height=="number"?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateState(e,t){super.updateState(e,t),this.updateSizeState(e),this.updateCornerState(e),e.fill!==void 0&&this.fill.update(e.fill),e.stroke!==void 0&&this.stroke.update(e.stroke),e.dropShadow!==void 0&&this.dropShadow.update(e.dropShadow),e.innerShadow!==void 0&&this.innerShadow.update(e.innerShadow),e.layerBlur!==void 0&&this.layerBlur.update(e.layerBlur),e.backgroundBlur!==void 0&&this.backgroundBlur.update(e.backgroundBlur),e.clipped!==void 0&&(this.clipped=e.clipped)}requestRender(){super.requestRender(),this.dispatchEvent({type:"render"})}dispose(){this.removeEventListener("render")}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),e.type===0&&(cr(e.path,["fill"])?this.fill.update(e.props):cr(e.path,["stroke"])?this.stroke.update(e.props):cr(e.path,["dropShadow"])?this.dropShadow.update(e.props):cr(e.path,["innerShadow"])?this.innerShadow.update(e.props):cr(e.path,["layerBlur"])?this.layerBlur.update(e.props):cr(e.path,["backgroundBlur"])?this.backgroundBlur.update(e.props):this.resetBBoxNeedsUpdate())}clone(e){let t=new yd(this.uuid,this.data,e);t.parent=void 0;for(let i of this.children)t.add(i.clone(e));return t}},SVe=pg(BJ(),1),hP=class extends pa{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this._pathBBox=new DOMRect,this.path="",this.updateState(t,i),this.autoClose=!1,this.computeSVGBBox()}computeSVGBBox(){let e=document.createElementNS("http://www.w3.org/2000/svg","svg"),t=document.createElementNS("http://www.w3.org/2000/svg","path");document.body.appendChild(e),t.setAttribute("d",this.path),e.appendChild(t),this._pathBBox=t.getBBox(),e.remove()}innerDraw(e){e.path(this.path)}intersectsInLocalSpace(e,t){return e>=this._pathBBox.x&&e<=this._pathBBox.x+this._pathBBox.width&&t>=this._pathBBox.y&&t<=this._pathBBox.y+this._pathBBox.height}getCenter(){return[(this._pathBBox.x+this._pathBBox.width)/2,(this._pathBBox.y+this._pathBBox.height)/2]}getHalfSize(){return[(this._pathBBox.x+this._pathBBox.width)/2,(this._pathBBox.y+this._pathBBox.height)/2]}updateState(e,t){super.updateState(e,t),e.path!==void 0&&(this.path=e.path,this.computeSVGBBox())}clone(e){let t=new hP(this.uuid,this.data,e);return t.parent=void 0,t}};function _Ve(e,t=1,i=1){if(t<=0||i<=0)return e;let n=(0,SVe.parseSVG)(e).map(r=>{let s={...r};return"x"in s&&(s.x=s.x*t),"y"in s&&(s.y=s.y*i),"x1"in s&&(s.x1=s.x1*t),"x2"in s&&(s.x2=s.x2*t),"y1"in s&&(s.y1=s.y1*i),"y2"in s&&(s.y2=s.y2*i),"rx"in s&&(s.rx=s.rx*t),"ry"in s&&(s.ry=s.ry*i),s});return AVe(n)}function AVe(e){let t=["rx","ry","xAxisRotation","largeArc","sweep","x1","y1","x2","y2","x","y"],i;return e.map(n=>{let r=[];t.forEach(a=>{if(a in n){let o=n[a]*1;r.length&&o>=0&&r.push(","),r.push(o)}});let s=(i===n.code?r[0]<0?"":",":n.code)+r.join("");return i=n.code,s}).join("")}function wVe(e,t,i){switch(t.type){case"ellipse2d":return new G5(e,t,i);case"rectangle2d":return new xM(e,t,i);case"text2d":return new k5(e,t,i);case"vector2d":return new Rte(e,t,i);case"path2d":return new hP(e,t,i);case"frame2d":return new yd(e,t,i);case"group2d":default:return new ag(e,t,i)}}var Pte=class{constructor(e,t,i){this.uuid=e,this.data=t,this.group=new ag(Pte.GROUP_ID,{...N3.defaultData},i),this.createChildrenObjects(t.objects,this.group,i)}createObject(e,t,i,n,r,s){let a=wVe(e,t,s);a&&(n.add(a),n.children.splice(r,0,n.children.pop()),a.updateWorldMatrix(),i.length>0&&(a instanceof ag||a instanceof yd)&&this.createChildrenObjects(i,a,s))}createChildrenObjects(e,t,i){let n=0;for(let r of e)this.createObject(r.id,r.data,r.children,t,n,i),n+=1}draw(e){this.group.draw(e)}updateEntityByOp(e,t,i,n){let r=this.find(e);if(r)try{r.updateByOp(t,i,{shared:n})}catch(s){console.error(s)}}updateTreeByOp(e,t){if(e.path.length===0&&e.type===7){let i=e.parent===null?this.group:this.find(e.parent);i!==void 0&&i instanceof ju&&(this.createObject(e.id,e.data,e.children,i,e.localIndex,t),i.requestRender())}else if(e.path.length===0&&e.type===8){let i=this.find(e.id);if(i!==void 0&&i.parent!==void 0&&i.parent instanceof ju){let n=i.parent;i.resetBBoxNeedsUpdate(),n==null||n.remove(i),n==null||n.requestRender()}}else if(e.path.length===0&&e.type===9){let i=this.find(e.id);if(i!==void 0){let n=i.parent,r=e.parent===null?this:this.find(e.parent);if(r instanceof ju||r===this){r.add(i);let s=e.localIndex;r.children.splice(s,0,r.children.pop()),i.updateWorldMatrix(!0,!1,!0),n==null||n.requestRender(),i.requestRender()}i.resetBBoxNeedsUpdate()}}}add(e){this.group.add(e)}remove(e){this.group.remove(e)}traverse(e){this.group.traverse(t=>{t!==this.group&&e(t)})}intersectsChildren(e,t,i,n=!1,r=[]){return this.group.intersectsChildren(e,t,i,n,r,!0)}intersectsChildrenReverse(e,t,i,n=!1,r=[]){return this.group.intersectsChildrenReverse(e,t,i,n,r,!0)}find(e){return this.group.find(e)}get children(){return this.group.children}project(e,t){return this.group.project(e,t)}getWithSortKey(e){let t=this.find(e);if(t===void 0)return;let i=[],n=t;for(;n!==this.group;){let r=n;n=n.parent;let s=n.children.indexOf(r);i.splice(0,0,s)}return{entity:t,sortKey:i}}getAllSorted(e){let t=[];for(let i of e){let n=this.getWithSortKey(i.id);n!==void 0&&t.push(n)}return t.sort((i,n)=>h$(i.sortKey,n.sortKey)),t.map(i=>i.entity)}},j5=Pte;j5.GROUP_ID="scene2d";function Ote({constraints:e,newParentWidth:t,newParentHeight:i,initialParentWidth:n,initialParentHeight:r,objectInitialWidth:s,objectInitialHeight:a,objectInitialPosition:o}){let{horizontalConstraint:l,verticalConstraint:c}=e,u=t-n,h=i-r,d=s,p=a,g=o[0],x=o[1];if(l!==0){if(l===1)g+=u;else if(l===3)g+=u/2;else if(l===2)d=Math.max(1,d+u);else if(l===4){let y=t/n;d*=y,g*=y}}if(c!==0){if(c===1)x+=h;else if(c===3)x+=h/2;else if(c===2)p=Math.max(1,p+h);else if(c===4){let y=i/r;p*=y,x*=y}}return{width:d,height:p,position:[g,x]}}pg(BJ(),1);var MVe=`
	varying vec2 vUv;
	void main() {
		vUv = uv;
		gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
	}`,EVe=`
	uniform sampler2D tDiffuse;
	varying vec2 vUv;
	void main() {
		vec4 texel = texture2D( tDiffuse, vUv );
		gl_FragColor = texel;
	}`,TVe=new kR(-1,1,1,-1,0,1),CVe=class extends ii{constructor(){super(),this.setAttribute("position",new Gt([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Gt([0,2,0,0,2,0],2))}},DVe=new CVe,RVe=class{constructor(e){this._mesh=new fr(DVe,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,TVe)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}},Bte=new vn({defines:{},uniforms:{tDiffuse:new Ct(null)},vertexShader:MVe,fragmentShader:EVe}),PVe=new RVe(Bte),dL=null,fL=null,OVe=()=>(dL===null&&(dL=document.createElement("canvas")),dL),BVe=e=>(fL===null&&(fL=new Dte(e)),fL),IVe=Tn.identity(),Ite=class{constructor(e,t,i,n){this.uuid=e,this.width=t,this.height=i,this.context=n,this.enabled=!0,this.isScreenSpace=!1,this.dpr=window.devicePixelRatio,this.isFrameDirty=!1,this.onRenderRequestedDownstream=()=>{this.isFrameDirty=!0,this.context.shared.requestRender()},this._innerApplySize=()=>{let r=this.width,s=this.height,a=this.dpr;this.renderer.dpr=this.isScreenSpace?a:Math.floor(2048/Math.max(r,s)),this.renderer.setSize(r,s)},this.onFrameOverrideObjectEvent=r=>{var s,a;if(((s=r.target)==null?void 0:s.uuid)!==void 0){let o=(a=this.frameRoot)==null?void 0:a.find(r.target.uuid);o&&o.dispatchEvent({...r,target:o})}},this.scene2d=new j5(qt.generateUUID(),XN.defaultData,{dpr:window.devicePixelRatio,shared:n.shared}),this.canvas=OVe(),this.renderer=BVe(this.canvas),this.promise=this.init(),this.renderTarget=new mn(1,1,{type:ip,stencilBuffer:!1,depthBuffer:!1}),n.shared.addUIBuffer(this.uuid,this.renderTarget),this.textureHolder=n.shared.uiBuffer(this.uuid)}get canvasTexture(){return this._canvasTexture||(this._canvasTexture=new _Me(this.canvas)),this._canvasTexture}async init(){this.renderer instanceof Dte&&(this.renderer.wasmURL=nte.skiaWasmUrl),await this.renderer.init()}render(e){var t,i;if(this.isFrameDirty){this.isFrameDirty=!1,this._innerApplySize(),this.renderer.clear(),(t=this.frameOverride)==null||t.draw(this.renderer),this.renderer.render(),Bte.uniforms.tDiffuse.value=this.canvasTexture,this.canvasTexture.needsUpdate=!0;let n=e.getRenderTarget();e.setRenderTarget(this.renderTarget),e.clear(),PVe.render(e),e.setRenderTarget(n),(i=this.textureHolder)==null||i.setNeedsUpdate(!0)}}updateEntity2DByOp(e,t,i,n){this.scene2d.updateEntityByOp(e,t,i,n),this.applySize()}updateTreeByOp(e,t){this.scene2d.updateTreeByOp(e,t),this.applySize()}applyOverrides(e){if(this.frameOverride&&this.frameRoot){this.frameOverride.position=[0,0],this.frameOverride.rotation=0;let t=(e==null?void 0:e.width)??this.width,i=(e==null?void 0:e.height)??this.height;this.frameOverride.width=t,this.frameOverride.height=i,this.frameOverride.localMatrix=IVe,this.isScreenSpace&&(this.frameOverride.fill.color=er.from0to1([0,0,0,0])),this.frameOverride.data={...this.frameOverride.data,width:t,height:i},Lte({objectOverride:this.frameOverride,objectRoot:this.frameRoot,newParentWidth:this.frameOverride.width,newParentHeight:this.frameOverride.height,initialParentWidth:this.frameRoot.width,initialParentHeight:this.frameRoot.height}),this.frameOverride.updateWorldMatrix(!0,!1,!0)}}applySize(e,t=window.devicePixelRatio){var o,l;let i=Math.max(1,(e==null?void 0:e.width)??this.width),n=Math.max(1,(e==null?void 0:e.height)??this.height);this.dpr=t,this.width=i,this.height=n,this._innerApplySize();let r=1,s=512,a=512;(i*t<s||n*t<a)&&(r=Math.max(s/(i*t),a/(n*t))),this.renderTarget.setSize(i*t*r,n*t*r),(o=this._canvasTexture)==null||o.dispose(),this._canvasTexture=void 0,this.applyOverrides(e),(l=this.frameOverride)==null||l.requestRender()}applyFrame(e){var i,n;let t=this.context.scene.find2D(e);if(!(!t||!(t instanceof yd)))return this.disposeFrameOverride(),this.frameRoot=t,this.frameOverride=t.clone({dpr:this.renderer.dpr,shared:this.context.shared}),this.scene2d.add(this.frameOverride),this.applySize(),(i=this.frame)==null||i.addEventListener("render",this.onRenderRequestedDownstream),this.frameOverride.traverse(r=>{r.addEventListener("beginState",this.onFrameOverrideObjectEvent)}),this.frameOverride.traverse(r=>{r.addEventListener("completeState",this.onFrameOverrideObjectEvent)}),(n=this.frame)==null||n.requestRender(),t}get frame(){return this.frameOverride}get frameId(){var e;return(e=this.frame)==null?void 0:e.uuid}find(e){return this.scene2d.find(e)}get texture(){var e;return(e=this.textureHolder)==null?void 0:e.getTexture(1001)}disposeFrameOverride(){var e,t,i;(e=this.frameOverride)==null||e.removeEventListener("render",this.onRenderRequestedDownstream),(t=this.frameOverride)==null||t.traverse(n=>{n.removeEventListener("beginStateChange",this.onFrameOverrideObjectEvent)}),(i=this.frameOverride)==null||i.traverse(n=>{n.removeEventListener("completeState",this.onFrameOverrideObjectEvent)}),this.frameOverride&&this.scene2d.remove(this.frameOverride)}};function Lte({objectOverride:e,objectRoot:t,newParentWidth:i,newParentHeight:n,initialParentWidth:r,initialParentHeight:s}){if(e instanceof yd&&t instanceof yd||e instanceof ag&&t instanceof ag)for(let a=0,o=e.children.length;a<o;a++){let l=e.children[a],c=t.children[a];l&&c&&l.uuid===c.uuid&&UVe({objectOverride:l,objectRoot:c,newParentWidth:i,newParentHeight:n,initialParentWidth:r,initialParentHeight:s})}}function LVe(e){if(wz(e))return[e.width,e.height];if(e instanceof hP){let[t,i]=e.getHalfSize();return[t*2,i*2]}else if(e instanceof ag){let[t,i]=e.recursiveBBox.getHalfSize();return[t*2,i*2]}return[0,0]}function UVe({objectOverride:e,objectRoot:t,newParentWidth:i,newParentHeight:n,initialParentWidth:r,initialParentHeight:s}){let[a,o]=LVe(t),{width:l,height:c,position:u}=Ote({constraints:e.data,newParentWidth:i,newParentHeight:n,initialParentWidth:r,initialParentHeight:s,objectInitialWidth:a,objectInitialHeight:o,objectInitialPosition:t.position});if(e.position=u,e.data={...e.data,position:u},e.states)for(let h in e.states)NVe({stateId:h,objectOverride:e,objectRoot:t,newParentWidth:i,newParentHeight:n,initialParentWidth:r,initialParentHeight:s});if(wz(e)||e instanceof ag)wz(e)&&(e.width=l,e.height=c,e.data={...e.data,width:l,height:c}),Lte({objectOverride:e,objectRoot:t,newParentWidth:l,newParentHeight:c,initialParentWidth:a,initialParentHeight:o});else if(e instanceof hP){let h=t,d=a!==0?l/a:1,p=o!==0?c/o:1;e.path=_Ve(h.path,d,p),e.data={...e.data,path:e.path}}}function NVe({stateId:e,objectOverride:t,objectRoot:i,newParentWidth:n,newParentHeight:r,initialParentWidth:s,initialParentHeight:a}){var c,u;let o=(c=t.states)==null?void 0:c[e],l=(u=i.states)==null?void 0:u[e];if(o&&l){let{width:h,height:d,position:p}=Ote({constraints:t.data,newParentWidth:n,newParentHeight:r,initialParentWidth:s,initialParentHeight:a,objectInitialWidth:w0.isResizeable(l)?l.width:0,objectInitialHeight:w0.isResizeable(l)?l.height:0,objectInitialPosition:l.position});Object.assign(t.states[e],{position:p}),w0.isResizeable(o)&&Object.assign(t.states[e],{width:h,height:d})}}function wz(e){return e instanceof xM||e instanceof yd||e instanceof G5||e instanceof k5}var fa=class extends b5(Pl){constructor(e,t,i){super(),this.data=t,this.bgColor=new Qa(1,1,1,1),this.fog=null,this.backupFog=new sZ(16777215,.1,2e3),this.fogUseBGColor=!1,this.isActive=!1,this.aoColor=new gi,this.penumbraSizeArrayCache=null,this.super_Entity(e,t),this.personalCamera=new xo(Fb,{...Ew.defaultData,...t.camera,name:"Personal Camera"}),this.personalCamera.objectHelper.visible=!1,this.add(this.personalCamera),this.activeCamera=this.personalCamera,this.ambientLight=new lEe(13882323,8553090,.75),this.ambientLight.name="Default Ambient Light",this.ambientLight.layers.enable(3),this.ambientLight.removeFromParent(),this.add(this.ambientLight),t.uiScene?this.uiScene=new j5((Array.isArray(e)?e[0]:e)+"-ui",t.uiScene,{dpr:window.devicePixelRatio,shared:i.shared}):t.uiFrame&&this.createUICanvas(t.uiFrame,i)}get scene(){return this.parent}get postprocessing(){return this.data.postprocessing}get frameId(){return this.data.uiFrame}get frame(){var e;return(e=this.uiCanvas)==null?void 0:e.frame}createUICanvas(e,t){this.uiCanvas=new Ite(this.uuid+"-uiscreen",window.innerWidth,window.innerHeight,t),this.uiCanvas.isScreenSpace=!0,this.uiCanvas.promise.then(()=>{var i,n;(i=this.uiCanvas)==null||i.applyFrame(e),(n=this.uiCanvas)==null||n.applySize()})}updateVisible(){}setBackgroundColor(e){this.bgColor=e,this.fogUseBGColor===!0&&(this.backupFog.color=e)}entityChildrenCount(){return this.uiScene?this.uiScene.children.length:super.entityChildrenCount()}updateAmbientLight(e,t){e.color!==void 0&&(this.ambientLight.color=$o(e.color,t)),e.intensity!==void 0&&(this.ambientLight.intensity=e.intensity),e.enabled!==void 0&&(e.enabled?this.add(this.ambientLight):this.remove(this.ambientLight))}onDeactive(){this.isActive=!1}onActive(e){this.isActive=!0,e.fog=this.fog,this.traverseEntity(t=>{t instanceof V0&&t.recomputeBoolean()}),this.updateShadow(this.data.shadow)}forceMaterialsUpdate(){this.traverseEntity(e=>{if(e instanceof Gb)if(Array.isArray(e.material))for(let t of e.material)t.needsUpdate=!0;else e.material.needsUpdate=!0,e.material.dispose()})}updateShadow(e){e.softShadowQuality!==void 0&&this.isActive&&eVe(e.softShadowQuality)&&this.forceMaterialsUpdate()}updateFog(e,t){if(e.enabled?this.fog=this.backupFog:this.fog=null,this.isActive){let i=this.scene;i.fog=this.fog}this.fogUseBGColor=e.useBackgroundColor,e.useBackgroundColor?this.backupFog.color.set(this.bgColor):this.backupFog.color=$o(e.color,t),this.backupFog.near=e.near,this.backupFog.far=e.far}updateAo(e,t){e.aoColor!==void 0&&(this.aoColor=$o(e.aoColor,t))}updateByOp(e,t,i,n){let r=this.data.uiFrame;super.updateByOp(e,t,i,n);let s=t;cr(e.path,["fog"])?this.updateFog(s.fog,i.shared):cr(e.path,["ao"])?this.updateAo(s.ao,i.shared):cr(e.path,["ambient"])?this.updateAmbientLight(s.ambient,i.shared):cr(e.path,["shadow"])?this.updateShadow(s.shadow):e.type===0&&e.path.length===0&&(e.props.uiFrame!==void 0||r!==s.uiFrame)&&this.updateUIFrame(e.props.uiFrame,i)}updateUIFrame(e,t){e?(this.uiCanvas||this.createUICanvas(e,t),this.uiCanvas.enabled=!0,this.uiCanvas.applyFrame(e)):this.uiCanvas&&(this.uiCanvas.enabled=!1)}updateState(e,t){this.updateState_Entity(e,t),e.backgroundColor!==void 0&&this.setBackgroundColor($o(e.backgroundColor,t.shared)),e.fog!==void 0&&this.updateFog(e.fog,t.shared),e.ambient!==void 0&&this.updateAmbientLight(e.ambient,t.shared),e.ao!==void 0&&this.updateAo(e.ao,t.shared),e.shadow!==void 0&&this.updateShadow(e.shadow)}createFrame(e,t){}raycast(e,t){super.raycast(e,t)}switchActiveCamera(e){e&&e.isDescendantOf(this)&&(this.activeCamera!==this.personalCamera&&(this.activeCamera.objectHelper.visible=!0),this.activeCamera=e,e.objectHelper.visible=!1)}get playCamera(){var e;return((e=this.scene)==null?void 0:e.find(this.data.publish.playCamera))??this.personalCamera}switchToPlayCamera(){this.switchActiveCamera(this.playCamera)}get penumbraSizeArray(){return this.penumbraSizeArrayCache===null&&this.updatePenumbraSizeArray(),this.penumbraSizeArrayCache}updatePenumbraSizeArray(){this.penumbraSizeArrayCache=new Array(5).fill(.5);let e=0,t=0;this.traverseEntity(i=>{if(!i.visible)return!0;i instanceof Mte&&i.visible&&e<3&&(this.penumbraSizeArrayCache[e]=i.data.penumbraSize??.5,e+=1),i instanceof Ete&&i.visible&&e<2&&(this.penumbraSizeArrayCache[3+t]=i.data.penumbraSize??.5,t+=1)})}raycastWithClones(e){let t=[],i=n=>{for(let r of n.children){let s=r.cloner;dn.is(r)&&(r.visible||s!=null&&s.object.data.visible)&&((ku(r)||pz(r)&&this.scene.enableHelpers&&r.objectHelper.visible)&&(e.intersectObject(r,!1,t),Mz(r,e,t,!0)),i(r))}};return i(this),t}updateEntity2DByOp(e,t,i,n){var r;(r=this.uiCanvas)==null||r.updateEntity2DByOp(e,t,i,n)}},zVe=class extends F5(dEe,_te){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let n=this.shadow.camera;n.fov=90,n.aspect=1,n.near=100,n.far=2500;let r=new G(-n.far+this.position.x,-n.far+this.position.y,-n.far+this.position.z),s=new G(n.far+this.position.x,n.far+this.position.y,n.far+this.position.z),a=new ps(r,s),o=new l3(a,new gi(16755200));o.visible=!1,this.gizmos.shadowmap=o,this.update()}update(){if(this.shadow&&(this.shadow.camera.updateProjectionMatrix(),this.gizmos))for(let e in this.gizmos){let t=this.gizmos[e];if(t instanceof l3){let i=this.shadow.camera,n=new G(-i.far+this.position.x,-i.far+this.position.y,-i.far+this.position.z),r=new G(i.far+this.position.x,i.far+this.position.y,i.far+this.position.z);t.box.set(n,r),t.updateMatrixWorld(!0)}}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t),e.distance!==void 0&&(this.distance=e.distance),e.decay!==void 0&&(this.decay=e.decay),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}},FVe=class extends Ds{get forceComputeSize(){return!0}get shape(){return this.geometry.userData.shape}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");i!==void 0?C5(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},W5=class extends Ds{constructor(e,t,i){super(e,t,i),this._shapeId=null,this._context=i}updateState(e,t){super.updateState(e,t),this.updateShape(),this.refreshAttachedCloners(t)}updateShape(){var n;let e={...this.data.geometry.extrusion.shape};for(let r in e)typeof e[r]=="string"&&(e[r]=this._context.shared.getVariable(e[r],[this.uuid,"geometry","extrusion","shape",r]));let t;if(e.type==="Custom"){let r=e.shapeId;if(r!==this._shapeId&&this.detachShape(),r){this._shapeId=r;let s=this._context.scene.find(r);s!=null&&s.data&&(s.attachedPaths.add(this),t=(n=s.geometry.userData)==null?void 0:n.shape),t||this._context.scene.addPendingCommand(()=>this.updateShape())}}else{let r;switch(e.type){case"Rectangle":r=T5;break;case"Ellipse":r=E5;break;case"Polygon":r=xee;break;case"Star":r=bee;break;default:throw new Error(`Unknown shape type: ${e.type}`)}t=r.create({parameters:e}).userData.shape}let i=this.geometry;t&&i.inputs&&(i.inputs.shapeData=t,i.build())}detachShape(){var e;this._shapeId!==null&&((e=this._context.scene.find(this._shapeId))==null||e.attachedPaths.delete(this))}createGeometryDelayed(e){this.geometryCreateDeleyed=e.shared,this.updateShape(),this.refreshAttachedPaths(e)}updateTransformState(e,t){return super.updateTransformState(e,t)}updateGeometryInteractions(e,t){super.updateGeometryInteractions(e,t),this.updateShape()}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");i!==void 0?C5(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},X5=class extends z5{constructor(e,t,i){super(e,t,i),this.data=t}},U1=class extends kb(Hf,vM){constructor(e,t,i){super(),t.type==="Instance"&&typeof e=="string"&&(t=this.transformAssignData(t,i)),this.super_Entity(e,t),this.objectHelper.update()}get isComponentRoot(){return this.data.type==="Component"&&typeof this.identity=="string"}get isInstanceRoot(){return this.data.type==="Instance"&&typeof this.identity=="string"}transformAssignData(e,t){let i=B3.getComponentData({scene:t.scene.data,shared:t.shared.data},e.component);if(i){let n,r;for(let s of Fm.rootOverrideProps)e[s]===void 0?(n===void 0&&(n={...e}),n[s]=i.data[s]):(r===void 0&&(r={}),r[s]=e[s],n===void 0&&(n={...e}),n[s]=Xm.apply(i.data[s],e[s]));return this.overrideData=r,n}else return{...Qs.defaultData,...e,...gd(Qs.defaultData,Fm.rootOverrideProps)}}updateByOp(e,t,i,n){let r;if(this.isInstanceRoot&&!n){if(t=this.transformAssignData(t,i),e.type===0&&e.path.length===0&&this.component)for(let s of Fm.rootOverrideProps)s in e.props&&e.props[s]===void 0&&(r===void 0&&(r={...e,props:{...e.props}}),r.props[s]=this.component.data[s]);else if(e.type===0&&e.path.length>0&&Fm.rootOverrideProps.includes(e.path[0])){let s=e.path[0];r===void 0&&(r={...e,path:[],props:{[s]:t[s]}})}}super.updateByOp(r??e,t,i,n)}updateState(e,t){this.updateState_Entity(e,t)}expandInstanceChildren(e){let t=this.data;if(this.component===void 0){let i=e.scene.find(t.component)??null,n=!1;if(i!==this.oldComponent){if(this.oldComponent){let r=0;for(let s of this.children)if(dn.is(s))e.scene.disposeAndUnregisterEntityRecursivelyIfNotReregistered(s),q5(s),r+=1;else break;this.children.splice(0,r)}n=!0}if(i){let r={};Ute(e,[this.uuid],t.overrides,this,i,i,0,n,r);for(let s of this.children)if(dn.is(s)){let a=s.data;a.type==="Empty"&&a.animations&&s.traverseEntity(o=>{let l=o.dataPatched;if(o instanceof Ds&&l.bones&&l.boneInverses){let c=o.dataPatched;if(c.bones&&c.boneInverses){let u=c.bones.map(p=>e.scene.find(r[p])),h=c.boneInverses.map(p=>new Bt().fromArray(p)),d=new L4(u,h);o.bind(d,o.bindMatrix)}}else o.matrixAutoUpdate=!0})}}this.oldComponent=this.component}}};function q5(e){if(e.component){let t=e.component.instances.indexOf(e);t>=0&&e.component.instances.splice(t,1);for(let i of e.children)dn.is(i)&&q5(i)}}function Z7(e,t,i,n){return e.component===t&&o5(e.identity,n)?e.overrideData===i?2:1:0}function Ute(e,t,i,n,r,s,a,o,l){if(a>50)return!1;if(n.component!==r){if(n.component){let u=n.component.instances.indexOf(n);u>=0&&n.component.instances.splice(u,1)}r.instances.find(u=>u===n)||r.instances.push(n),n.component=r}r instanceof U1&&r.isInstanceRoot&&r.expandInstanceChildren(e);let c=0;for(let u of r.children)if(dn.is(u)){let h=[...t,...typeof u.identity=="string"?[u.identity]:u.identity],d=D3.resolve(i,h,1);d!=null&&!(d instanceof Ps)&&(Object.setPrototypeOf(d,Ps.prototype),console.error("wrong prototype"));let p=null,g;if(!o){let x=n.children[c];if(p=dn.is(x)?x:null,p!==null){let y=Z7(p,u,d,h);g=y>=1?p.stateSelection:void 0,y!==2&&(p=null)}if(p===null&&(p=e.scene.findInstance(h)??null,p!==null)){let y=Z7(p,u,d,h);if(g=y>=1?p.stateSelection:void 0,y!==2)p=null;else{let b=p.parent.children.indexOf(p);p.parent.children.splice(b,1),n.children.splice(c,0,p),p.parent===n?b<=c&&console.error("not possible"):(p.parent=n,p.matrixWorldNeedsUpdate=!0,p.resetBBoxNeedsUpdate(),p.updateVisible(),e.pendingDeletes.delete(p))}}}if(p===null){let x=d?Xm.apply(u.data,d):u.data;N0.is(x.type)&&(x={...x,type:"Empty"}),p=Hm.createEntity(h,x,e),p.overrideData=d,n.add(p),n.children.splice(n.children.length-1,1),n.children.splice(c,0,p),p.updateState(p.data,e),g&&p.changeSelectedState(g,e),e.scene.registerInstanceAndSetUuid(p)}if(p.isBone){let x=p.identity[p.identity.length-1];l[x]=p.uuid}c+=1,Ute(e,t,i,p,u,s,a+1,o,l)}if(!o){let u=c;for(;;){let h=n.children[c];if(dn.is(h))e.pendingDeletes.add(h);else break;c+=1}n.children.splice(u,c-u)}return!0}var VVe=class extends kb(aZ,vM){constructor(e,t){super(),this.super_Entity(e,t),this.objectHelper.update(),this.matrixAutoUpdate=!0}updateState(e,t){this.updateState_Entity(e,t)}},mo=class extends Ds{constructor(e,t,i){super(e,t,i),this.onBeforeRender=n=>{this.uiCanvas.render(n)},this.uiCanvas=new Ite(e+"-canvas",t.geometry.width,t.geometry.height,i),this.uiCanvas.promise.then(()=>{this.applyFrame(this.dataPatched.geometry.frame,i.shared)})}updateByPatchedOpGeometry(e,t,i){super.updateByPatchedOpGeometry(e,t,i),e.type===0&&(e.props.frame!==void 0&&this.applyFrame(e.props.frame,i.shared),(e.props.width!==void 0||e.props.height!==void 0)&&this.applySize(e.props,i.shared))}applySize(e,t){let i=(e==null?void 0:e.width)??this.dataPatched.geometry.width,n=(e==null?void 0:e.height)??this.dataPatched.geometry.height;this.uiCanvas.applySize({width:i,height:n}),this.applyGeometryParametersFromFrame(t)}applyFrame(e,t){this.uiCanvas.applyFrame(e),this.applyGeometryParametersFromFrame(t),this.applyMaterialParametersFromFrame({shared:t})}applyGeometryParametersFromFrame(e){var i;let t=this.frame;t&&(Object.assign(this.data,{geometry:Object.assign(this.data.geometry,{cornerRadius:t.cornerRadius,cornerType:0})}),Object.assign(this.dataPatched,{geometry:Object.assign(this.dataPatched.geometry,{cornerRadius:t.cornerRadius,cornerType:0})}),(i=this.localGeometry)==null||i.dispose(),this.localGeometry=Bw(this.dataPatched.geometry,e,this.data.flatShading,this))}applyMaterialParametersFromFrame(e){let t=this.frame;if(t){let i=t.data.backgroundBlur;Object.assign(this.data.material.layers[0].data.texture,{image:this.uiCanvas.uuid}),Object.assign(this.data.material.layers[1].data,{roughness:i.radius,alpha:i.enabled?1:0}),Object.assign(this.dataPatched.material.layers[0].data.texture,{image:this.uiCanvas.uuid}),Object.assign(this.dataPatched.material.layers[1].data,{roughness:i.radius,alpha:i.enabled?1:0}),this.material.reset(this.dataPatched.material,e,!0)}}updateEntity2DByOp(e,t,i,n){this.uiCanvas.updateEntity2DByOp(e,t,i,n),e===this.frameId&&t.type===0&&(t.props.cornerRadius!==void 0?this.applyGeometryParametersFromFrame(n):cr(t.path,["backgroundBlur"])&&this.applyMaterialParametersFromFrame({shared:n}))}get frame(){return this.uiCanvas.frame}get frameId(){var e;return(e=this.frame)==null?void 0:e.uuid}removeInteractionGeometry(e){super.removeInteractionGeometry(e),this.applySize({},e)}updateGeometryInteractions(e,t){super.updateGeometryInteractions(e,t),this.applySize({width:e.width,height:e.height},t)}},HVe=class{constructor(e,t,i){this.variables=[],this.currentTextureIndex=0;let n=Zn,r=new Pl,s=new mg;s.position.z=1;let a={passThruTexture:{value:null}},o=u(d(),a),l=new fr(new Ad(2,2),o);r.add(l),this.setDataType=function(p){return n=p,this},this.addVariable=function(p,g,x){let y=this.createShaderMaterial(g),b={name:p,initialValueTexture:x,material:y,dependencies:null,renderTargets:[],wrapS:null,wrapT:null,minFilter:rn,magFilter:rn};return this.variables.push(b),b},this.setVariableDependencies=function(p,g){p.dependencies=g},this.init=function(){if(i.capabilities.isWebGL2===!1&&i.extensions.has("OES_texture_float")===!1)return"No OES_texture_float support for float textures.";if(i.capabilities.maxVertexTextures===0)return"No support for vertex shader textures.";for(let p=0;p<this.variables.length;p++){let g=this.variables[p];g.renderTargets[0]=this.createRenderTarget(e,t,g.wrapS,g.wrapT,g.minFilter,g.magFilter),g.renderTargets[1]=this.createRenderTarget(e,t,g.wrapS,g.wrapT,g.minFilter,g.magFilter),this.renderTexture(g.initialValueTexture,g.renderTargets[0]),this.renderTexture(g.initialValueTexture,g.renderTargets[1]);let x=g.material,y=x.uniforms;if(g.dependencies!==null)for(let b=0;b<g.dependencies.length;b++){let A=g.dependencies[b];if(A.name!==g.name){let w=!1;for(let E=0;E<this.variables.length;E++)if(A.name===this.variables[E].name){w=!0;break}if(!w)return"Variable dependency not found. Variable="+g.name+", dependency="+A.name}y[A.name]={value:null},x.fragmentShader=`
uniform sampler2D `+A.name+`;
`+x.fragmentShader}}return this.currentTextureIndex=0,null},this.compute=function(){let p=this.currentTextureIndex,g=this.currentTextureIndex===0?1:0;for(let x=0,y=this.variables.length;x<y;x++){let b=this.variables[x];if(b.dependencies!==null){let A=b.material.uniforms;for(let w=0,E=b.dependencies.length;w<E;w++){let D=b.dependencies[w];A[D.name].value=D.renderTargets[p].texture}}this.doRenderTarget(b.material,b.renderTargets[g])}this.currentTextureIndex=g},this.getCurrentRenderTarget=function(p){return p.renderTargets[this.currentTextureIndex]},this.getAlternateRenderTarget=function(p){return p.renderTargets[this.currentTextureIndex===0?1:0]},this.dispose=function(){l.geometry.dispose(),l.material.dispose();let p=this.variables;for(let g=0;g<p.length;g++){let x=p[g];x.initialValueTexture&&x.initialValueTexture.dispose();let y=x.renderTargets;for(let b=0;b<y.length;b++)y[b].dispose()}};function c(p){p.defines.resolution="vec2( "+e.toFixed(1)+", "+t.toFixed(1)+" )"}this.addResolutionDefine=c;function u(p,g){g=g||{};let x=new vn({uniforms:g,vertexShader:h(),fragmentShader:p});return c(x),x}this.createShaderMaterial=u,this.createRenderTarget=function(p,g,x,y,b,A){return p=p||e,g=g||t,x=x||Ar,y=y||Ar,b=b||rn,A=A||rn,new mn(p,g,{wrapS:x,wrapT:y,minFilter:b,magFilter:A,format:Rr,type:n,depthBuffer:!1})},this.createTexture=function(){let p=new Float32Array(e*t*4),g=new Zo(p,e,t,Rr,Zn);return g.needsUpdate=!0,g},this.renderTexture=function(p,g){a.passThruTexture.value=p,this.doRenderTarget(o,g),a.passThruTexture.value=null},this.doRenderTarget=function(p,g){let x=i.getRenderTarget(),y=i.xr.enabled,b=i.shadowMap.autoUpdate,A=i.outputEncoding,w=i.toneMapping;i.xr.enabled=!1,i.shadowMap.autoUpdate=!1,i.outputEncoding=$u,i.toneMapping=md,l.material=p,i.setRenderTarget(g),i.render(r,s),l.material=o,i.xr.enabled=y,i.shadowMap.autoUpdate=b,i.outputEncoding=A,i.toneMapping=w,i.setRenderTarget(x)};function h(){return`void main()	{

	gl_Position = vec4( position, 1.0 );

}
`}function d(){return`uniform sampler2D passThruTexture;

void main() {

	vec2 uv = gl_FragCoord.xy / resolution.xy;

	gl_FragColor = texture2D( passThruTexture, uv );

}
`}}},La=new ka,hC=new G,GVe=class{constructor(e){let t=e.geometry;if(!t.isBufferGeometry||t.attributes.position.itemSize!==3)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");t.index&&(console.warn("THREE.MeshSurfaceSampler: Converting geometry to non-indexed BufferGeometry."),t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.colorAttribute=this.geometry.getAttribute("color"),this.weightAttribute=null,this.distribution=null}setWeightAttribute(e){return this.weightAttribute=e?this.geometry.getAttribute(e):null,this}build(){let e=this.positionAttribute,t=this.weightAttribute,i=new Float32Array(e.count/3);for(let r=0;r<e.count;r+=3){let s=1;t&&(s=t.getX(r)+t.getX(r+1)+t.getX(r+2)),La.a.fromBufferAttribute(e,r),La.b.fromBufferAttribute(e,r+1),La.c.fromBufferAttribute(e,r+2),s*=La.getArea(),i[r/3]=s}this.distribution=new Float32Array(e.count/3);let n=0;for(let r=0;r<i.length;r++)n+=i[r],this.distribution[r]=n;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t,i){let n=this.distribution[this.distribution.length-1],r=this.binarySearch(this.randomFunction()*n);return this.sampleFace(r,e,t,i)}binarySearch(e){let t=this.distribution,i=0,n=t.length-1,r=-1;for(;i<=n;){let s=Math.ceil((i+n)/2);if(s===0||t[s-1]<=e&&t[s]>e){r=s;break}else e<t[s]?n=s-1:i=s+1}return r}sampleFace(e,t,i,n){let r=this.randomFunction(),s=this.randomFunction();return r+s>1&&(r=1-r,s=1-s),La.a.fromBufferAttribute(this.positionAttribute,e*3),La.b.fromBufferAttribute(this.positionAttribute,e*3+1),La.c.fromBufferAttribute(this.positionAttribute,e*3+2),t.set(0,0,0).addScaledVector(La.a,r).addScaledVector(La.b,s).addScaledVector(La.c,1-(r+s)),i!==void 0&&La.getNormal(i),n!==void 0&&this.colorAttribute!==void 0&&(La.a.fromBufferAttribute(this.colorAttribute,e*3),La.b.fromBufferAttribute(this.colorAttribute,e*3+1),La.c.fromBufferAttribute(this.colorAttribute,e*3+2),hC.set(0,0,0).addScaledVector(La.a,r).addScaledVector(La.b,s).addScaledVector(La.c,1-(r+s)),n.r=hC.x,n.g=hC.y,n.b=hC.z),this}};function kVe(e){let t=new Float32Array(e*e*2);for(let i=0;i<e;i++)for(let n=0;n<e;n++){let r=i*e+n;t[r*2+0]=i/(e-1),t[r*2+1]=n/(e-1)}return t}function jVe(e){let t=Math.ceil(Math.sqrt(e));return Math.max(t,1)}function WVe(e,t){let i=new fr(e.geometry,e.material),n=[],r=[],s=new G,a=new G;i.geometry.index!==null&&(i.geometry=i.geometry.toNonIndexed());let o=new GVe(i).build();for(let u=0;u<t;u++)o.sample(s,a),n.push(s.x,s.y,s.z),r.push(a.x,a.y,a.z);let l=new Float32Array(n),c=new Float32Array(r);return{positions:l,normals:c}}function $7(e,t){let i=e,n=new Float32Array(4*t*t);for(let s=0;s<t*t;s++)n[4*s]=i[3*s],n[4*s+1]=i[3*s+1],n[4*s+2]=i[3*s+2],n[4*s+3]=0;let r=new Zo(n,t,t,Rr,Zn);return r.needsUpdate=!0,r}function XVe({size:e}){let t=new Float32Array(4*e*e);for(let n=0;n<e*e;n++)t[4*n]=n,t[4*n+1]=0,t[4*n+2]=0,t[4*n+3]=0;let i=new Zo(t,e,e,Rr,Zn);return i.needsUpdate=!0,i}function qVe(e){let t=new Float32Array(4*e*e);for(let n=0;n<e*e;n++)t[4*n]=0,t[4*n+1]=0,t[4*n+2]=0,t[4*n+3]=0;let i=new Zo(t,e,e,Rr,Zn);return i.needsUpdate=!0,i}var YVe=`
// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU
uniform sampler2D uOriginalPosition;
uniform float uTime;
uniform float uSpeed;     // update speed of the particles
uniform vec3 uWorldOffset;    
uniform vec4 uWorldQuaternion;
uniform float uMaxLifeTime;
uniform vec3 uEmitterSize;
uniform float uFPSRatio;     // 1  for 60 FPS

float random (vec2 st) {
    return fract(sin(dot(st.xy,
        vec2(12.9898,78.233)))*
        43758.5453123);
}
vec3 applyQuaternionToVector( vec4 q, vec3 v ){
    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
}

vec3 applyForce(vec3 force, float mass) {
    vec3 acceleration = force / mass;
    
    return acceleration;
  }
  

void main() {
    vec2 vUv = gl_FragCoord.xy / resolution.xy;
    vec3 position = texture2D( uCurrentPosition, vUv ).xyz;
    float currentLife = texture2D( uCurrentPosition, vUv ).w;   // from 1 to 0
    float isSpawning = texture2D( uCurrentEmissionRate, vUv ).r;        // 1. = spawning, 0. = not spawning
    float isActive = texture2D( uCurrentEmissionRate, vUv ).g;          // 1. = active, 0. = not active
    float timeStart = texture2D( uCurrentEmissionRate, vUv ).b;         // timeStart in seconds when the particle was emitted
    vec3 originalPosition = ((texture2D( uOriginalPosition, vUv ).xyz) * uEmitterSize);
    vec3 velocity = texture2D( uCurrentVelocity, vUv ).xyz;
    float collisionFlag = texture2D( uCurrentVelocity, vUv ).w;             // 1. = collided, 0. = not collided
    float lifeTime = uMaxLifeTime;

    // Calculate the position adjustment based on collision
    //     if (collisionFlag > .5) {  
    float isColliding = step(0.5, collisionFlag); // 1.0 if collisionFlag > 0.5, otherwise 0.0
    float bounceOffset = 3.0 * isColliding; // Becomes 3.0 if colliding, 0.0 otherwise
    vec3 collisionAdjustedVelocity = velocity * (1.0 + bounceOffset);

    // Update position based on collision or normal movement
    vec3 fpsVelocity = velocity * min(uFPSRatio, 5.0);
    position += mix(fpsVelocity, collisionAdjustedVelocity, isColliding);

    // EMISSION RATE - BIRTH
    // if (isSpawning == 1.0) {
    // Better Approach to avoid If statement
    vec3 newPosition = applyQuaternionToVector(uWorldQuaternion, originalPosition) + uWorldOffset;
    originalPosition = mix(originalPosition, newPosition, isSpawning);
    position = mix(position, originalPosition, isSpawning);;
    timeStart = mix(timeStart, uTime, isSpawning);

    // Calculate timeLeft for life normalization
    float timeLeft = max(lifeTime - (uTime - timeStart), 0.0);
    float life_Normalize = timeLeft / lifeTime;

    // Use isActive to blend between the calculated color and black
    vec4 activeColor = vec4(position, life_Normalize);
    // if (isActive == 1.0) {
    gl_FragColor = mix(vec4(0.0), activeColor, isActive);

}
`,QVe=`

    vec3 mod289(vec3 x) {
      return x - floor(x * (1.0 / 289.0)) * 289.0;
    }
    
    vec4 mod289(vec4 x) {
    return x - floor(x * (1.0 / 289.0)) * 289.0;
    }
    
    vec4 permute(vec4 x) {
        return mod289(((x*34.0)+1.0)*x);
    }
    
    vec4 taylorInvSqrt(vec4 r)
    {
    return 1.79284291400159 - 0.85373472095314 * r;
    }
    
    vec3 fade(vec3 t) {
  return t*t*t*(t*(t*6.0-15.0)+10.0);
}

    float snoise(vec3 v)
    {
    const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
    const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
    vec3 i  = floor(v + dot(v, C.yyy) );
    vec3 x0 =   v - i + dot(i, C.xxx) ;
    vec3 g = step(x0.yzx, x0.xyz);
    vec3 l = 1.0 - g;
    vec3 i1 = min( g.xyz, l.zxy );
    vec3 i2 = max( g.xyz, l.zxy );
    vec3 x1 = x0 - i1 + C.xxx;
    vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y
    vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y
    
    // Permutations
    i = mod289(i);
    vec4 p = permute( permute( permute(
                i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
              + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))
              + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
    
    // Gradients: 7x7 points over a square, mapped onto an octahedron.
    // The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)
    float n_ = 0.142857142857; // 1.0/7.0
    vec3  ns = n_ * D.wyz - D.xzx;
    
    vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)
    
    vec4 x_ = floor(j * ns.z);
    vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)
    
    vec4 x = x_ *ns.x + ns.yyyy;
    vec4 y = y_ *ns.x + ns.yyyy;
    vec4 h = 1.0 - abs(x) - abs(y);
    
    vec4 b0 = vec4( x.xy, y.xy );
    vec4 b1 = vec4( x.zw, y.zw );
    
    vec4 s0 = floor(b0)*2.0 + 1.0;
    vec4 s1 = floor(b1)*2.0 + 1.0;
    vec4 sh = -step(h, vec4(0.0));
    
    vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
    vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
    
    vec3 p0 = vec3(a0.xy,h.x);
    vec3 p1 = vec3(a0.zw,h.y);
    vec3 p2 = vec3(a1.xy,h.z);
    vec3 p3 = vec3(a1.zw,h.w);
    
    //Normalise gradients
    vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
    p0 *= norm.x;
    p1 *= norm.y;
    p2 *= norm.z;
    p3 *= norm.w;
    
    // Mix final noise value
    vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
    m = m * m;
    return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),
                                  dot(p2,x2), dot(p3,x3) ) );
    }
    
    vec3 snoiseVec3( vec3 x ){
    
      float s  = snoise(vec3( x ));
      float s1 = snoise(vec3( x.y - 19.1 , x.z + 33.4 , x.x + 47.2 ));
      float s2 = snoise(vec3( x.z + 74.2 , x.x - 124.5 , x.y + 99.4 ));
      vec3 c = vec3( s , s1 , s2 );
      return c;
    
    }
    
      
    vec3 curlNoise( vec3 p, float seed){
      p += seed;
      const float e = .1;
      vec3 dx = vec3( e   , 0.0 , 0.0 );
      vec3 dy = vec3( 0.0 , e   , 0.0 );
      vec3 dz = vec3( 0.0 , 0.0 , e   );
    
      vec3 p_x0 = snoiseVec3( p - dx );
      vec3 p_x1 = snoiseVec3( p + dx );
      vec3 p_y0 = snoiseVec3( p - dy );
      vec3 p_y1 = snoiseVec3( p + dy );
      vec3 p_z0 = snoiseVec3( p - dz );
      vec3 p_z1 = snoiseVec3( p + dz );
    
      float x = p_y1.z - p_y0.z - p_z1.y + p_z0.y;
      float y = p_z1.x - p_z0.x - p_x1.z + p_x0.z;
      float z = p_x1.y - p_x0.y - p_y1.x + p_y0.x;
    
      const float divisor = 1.0 / ( 2.0 * e );
      return normalize( vec3( x , y , z ) * divisor );
    
    }


// Classic Perlin noise
float cnoise(vec3 P)
{
  vec3 Pi0 = floor(P); // Integer part for indexing
  vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1
  Pi0 = mod289(Pi0);
  Pi1 = mod289(Pi1);
  vec3 Pf0 = fract(P); // Fractional part for interpolation
  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0
  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
  vec4 iy = vec4(Pi0.yy, Pi1.yy);
  vec4 iz0 = Pi0.zzzz;
  vec4 iz1 = Pi1.zzzz;

  vec4 ixy = permute(permute(ix) + iy);
  vec4 ixy0 = permute(ixy + iz0);
  vec4 ixy1 = permute(ixy + iz1);

  vec4 gx0 = ixy0 * (1.0 / 7.0);
  vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;
  gx0 = fract(gx0);
  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
  vec4 sz0 = step(gz0, vec4(0.0));
  gx0 -= sz0 * (step(0.0, gx0) - 0.5);
  gy0 -= sz0 * (step(0.0, gy0) - 0.5);

  vec4 gx1 = ixy1 * (1.0 / 7.0);
  vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;
  gx1 = fract(gx1);
  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
  vec4 sz1 = step(gz1, vec4(0.0));
  gx1 -= sz1 * (step(0.0, gx1) - 0.5);
  gy1 -= sz1 * (step(0.0, gy1) - 0.5);

  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);

  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
  g000 *= norm0.x;
  g010 *= norm0.y;
  g100 *= norm0.z;
  g110 *= norm0.w;
  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
  g001 *= norm1.x;
  g011 *= norm1.y;
  g101 *= norm1.z;
  g111 *= norm1.w;

  float n000 = dot(g000, Pf0);
  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
  float n111 = dot(g111, Pf1);

  vec3 fade_xyz = fade(Pf0);
  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); 
  return 2.2 * n_xyz;
}


vec3 fbm_vec3(vec3 p, float frequency, float offset)
{
  return vec3(
    cnoise((p+vec3(offset))*frequency),
    cnoise((p+vec3(offset+20.0))*frequency),
    cnoise((p+vec3(offset-30.0))*frequency)
  );
}

`,KVe=`
  #ifdef USE_COLLIDER
    float restitution = max(uBounce * 2., .01); // Energy Loss
    // SPHERE COLLIDER
    // **************************************************************
    #ifdef USE_SPHERE_COLLIDER       
      // Convert collider size to radii (assuming uColliderSize is the diameter in each axis)
      vec3 radii = uColliderSize;
      // Adjust position relative to collider
      vec3 relPos = position - uColliderPos;
      // Apply rotation of the collider to the relative position
      relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            
      // Scale relative position by radii (for ellipsoid collision detection)
      vec3 scaledPos = relPos / radii;
      // Calculate ellipsoidal distance
      float dist = length(scaledPos); // Distance in terms of ellipsoid
      
      // Check for collision
      if (dist <= 1. + particleSize / length(radii) && collisionFlag == 0.0) {
          // Compute the normal at the collision point, accounting for particle size
        vec3 adjustedPos = scaledPos * (1.0 + particleSize / length(radii));          
        // Compute the normal at the collision point
        vec3 normal = ellipsoidNormal(adjustedPos, radii);
        // Rotate the normal back to world space
        normal = applyQuaternionToVector(uColliderQuaternion, normal);
        // Reflect the velocity vector off the normal
        velocity = reflect(velocity, normal) * restitution;

        collisionFlag = 1.0;
      } else {
        collisionFlag = 0.0;
      }
    #endif

    // BOX COLLIDER or PLANE COLLIDER 
    // **************************************************************
    #ifdef USE_BOX_COLLIDER
      // Box dimensions and repulsion variables
      vec3 boxHalfSize = uColliderSize / 2.0;
      // Convert world position to box's local space
      vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      
      // Collision detection
      vec3 localDistance = abs(localPos) - boxHalfSize;
      float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));    

      // Collision Detected
      if (distToSurface <= particleSize * 0.5 && collisionFlag == 0.0) {      
        // Find the nearest face normal for bounce direction
        vec3 normal;
        if (localDistance.x > localDistance.y && localDistance.x > localDistance.z) {
            normal = vec3(sign(localPos.x), 0.0, 0.0);
        } else if (localDistance.y > localDistance.z) {
            normal = vec3(0.0, sign(localPos.y), 0.0);
        } else {
            normal = vec3(0.0, 0.0, sign(localPos.z));
        }            
        // Rotate normal back to world space
        normal = applyQuaternionToVector(uColliderQuaternion, normal);      
        // Reflect velocity and apply repulsion force
        velocity = reflect(velocity, normal) * restitution;
        
        collisionFlag = 1.0;
      } else {
        collisionFlag = 0.0;
      }
    #endif      
  #endif      
  // END COLLIDER    
`,JVe=`
  #ifdef USE_ATTRACTOR

      #ifdef USE_SPHERE_COLLIDER      
        // Convert collider size to radii (assuming uColliderSize is the diameter in each axis)
        vec3 radii = uColliderSize;
        // Adjust position relative to collider
        vec3 relPos = position - uColliderPos;
        // Apply rotation of the collider to the relative position
        relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            
        // Scale relative position by radii (for ellipsoid collision detection)
        vec3 scaledPos = relPos / radii;
        // Calculate ellipsoidal distance
        float distToSurface = length(scaledPos); // Distance in terms of ellipsoid
        float insideCheck = 1.0;

      #endif


      #ifdef USE_BOX_COLLIDER
        // Box dimensions
        vec3 boxHalfSize = uColliderSize / 2.0;
        // Convert world position to box's local space
        vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      
        vec3 localDistance = abs(localPos) - boxHalfSize;
        float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));
        float insideCheck = particleSize;
      #endif      
  
      // Apply vortex force inside the Helper
      #ifdef USE_FORCE_LOCAL_SPACE
        if (distToSurface <= insideCheck ) {    
            // Define parameters for the attractor field
            #ifdef USE_SPHERE_COLLIDER      
              float attractorStrength = (1.0 - distToSurface ) * uForceIntensity; // Adjust as needed
            #endif

            #ifdef USE_BOX_COLLIDER
              float attractorStrength = max((1.0 - insideCheck / distToSurface), 0.) * uForceIntensity; // Adjust as needed
              #endif

            float attractorDamping = uForceDamping;  // Adjust as needed (higher values will attenuate velocity more)
          
            // Use the same radii calculation code as for the collider
            vec3 attractorRadii = uColliderSize;
            // Adjust position relative to attractor center
            vec3 relPos = position - uColliderPos;
            // Apply rotation of the collider to the relative position
            relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            
            // Scale relative position by radii (for ellipsoid attraction)
            vec3 scaledPos = relPos / attractorRadii;

            // Calculate ellipsoidal distance as attractor radius
            float attractorRadius = length(scaledPos);
            // Calculate the distance from the attractor center
            vec3 relativePosition = position - uColliderPos;
            // Calculate the force vector towards the attractor center
            vec3 attractorForce = normalize(relativePosition) * attractorStrength;
            // Apply the attractor force to the particle
            velocity -= attractorForce;
            // Attenuate the particle's velocity
            velocity *= attractorDamping;
        }
      #else 
            // Calculate the distance from the attractor center
            vec3 relativePosition = position - uColliderPos;
            // Calculate the force vector towards the attractor center
            vec3 attractorForce = normalize(relativePosition) * uForceIntensity;
            // Apply the attractor force to the particle
            velocity -= attractorForce;
            // Attenuate the particle's velocity
            velocity *= uForceDamping;
      #endif    
  #endif      
`,ZVe=`
  #ifdef USE_VORTEX
    // Box dimensions
    vec3 boxHalfSize = uColliderSize / 2.0;
    // Convert world position to box's local space
    vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      
    vec3 localDistance = abs(localPos) - boxHalfSize;
    float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));

    // Apply vortex force inside the box
    if (distToSurface <= particleSize) {
      float vortexStrength = uForceIntensity;
      vec3 localTopCenter = vec3(0.0, 0., 0.0);

      // Transform the local top center to the world space
      vec3 vortexCenter = uColliderPos + applyQuaternionToVector(uColliderQuaternion, localTopCenter);
      // Calculate the vector from particle to vortex center
      vec3 vortexVector = vortexCenter - position;

      // Calculate the rotation axis from the inverse of the collider's quaternion and the fixed up vector
      // Note: important to add a tiny z component to the up vector to avoid instability
      vec3 upVector = vec3(0.0, 1.0, 0.01);
      vec3 rotationAxis = cross(upVector, applyQuaternionToVector(uColliderQuaternion, vortexVector));
      rotationAxis = normalize(rotationAxis);

      // Add rotational component to velocity
      float rotationSpeed = length(vortexVector * vortexStrength * 3.0) ; 

      vec3 rotationVelocity = rotationAxis * rotationSpeed;
      // velocity += rotationVelocity * 0.005 ;
      velocity = rotationVelocity * 0.005 ;

      // Calculate vortex force
      // vec3 vortexForce = normalize(vortexVector) * uSpeed * .1 ;
      // Apply the vortex force to the particle
      vec3 originDirection = applyQuaternionToVector(uWorldQuaternion, directions);
      velocity += applyForce( originDirection * uSpeed * (1. - uForceDamping) , mass * .5);
    }
  #endif      
`,$Ve=`
// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU
uniform sampler2D uOriginalPosition;
uniform sampler2D uDirections;     
uniform vec3 uDirectionsAxis;
uniform vec4 uWorldQuaternion;
uniform vec3 uGravity;        
uniform float uNoiseStrength;     // Variation of the noise
uniform float uNoiseScale;        // Scale of the noise
uniform float uNoiseSeed;         // Seed of the noise
uniform float particleSize;
uniform float uSpeed;     // update speed of the particles
uniform float uRandomMassFactor;

// COLLIDER
uniform vec3 uColliderPos;                // Collider Position
uniform vec3 uColliderSize;               // Collider Dimension
uniform vec4 uColliderQuaternion;         // Collider Rotation
uniform vec4 uColliderQuaternionInvert;   // Collider Rotation
uniform float uBounce;                    // Bounce factor
uniform float uForceDamping;
uniform float uForceIntensity;


`+QVe+`
float rand(vec2 co){
    return fract(sin(dot(co, vec2(12.9898, 78.233))) * 43758.5453);
}
vec3 applyQuaternionToVector( vec4 q, vec3 v ){
    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
 } 
vec3 applyForce(vec3 force, float mass) {
  vec3 acceleration = force / mass;
  
  return acceleration;
}

vec4 conjugate(vec4 q) {
  return vec4(q.w, -q.x, -q.y, -q.z);
}

// Function to compute the normal of the ellipsoid at a given point
vec3 ellipsoidNormal(vec3 p, vec3 radii) {
  return normalize(p / (radii * radii));
}

float friction = .3;

void main() {
    vec2 vUv = gl_FragCoord.xy / resolution.xy;
    vec3 position = texture2D( uCurrentPosition, vUv ).xyz;
    vec3 originalPosition = texture2D( uOriginalPosition, vUv ).xyz;
    float timeLeft = texture2D( uCurrentPosition, vUv ).w;
    vec3 directions = texture2D( uDirections, vUv ).xyz;    
    vec3 velocity = texture2D( uCurrentVelocity, vUv ).xyz;
    float mass = rand(originalPosition.xy) * 0.5 + 0.5;
    float isSpawning = texture2D( uCurrentEmissionRate, vUv ).x;        // 1. = spawning, 0. = not spawning
    float isActive = texture2D( uCurrentEmissionRate, vUv ).y;          // 1. = active, 0. = not active
    float collisionFlag =texture2D( uCurrentVelocity, vUv ).w;          // Indicate collision

    // Randomness Mass
    mass = (1.0 - (uRandomMassFactor * mass));
    
    if (isActive == 1.0) {
      // **************************************************************
      // FORCES NOISES
      // **************************************************************
      #ifdef USE_CURL_NOISE
        if (uNoiseScale > 0.0 ) {
          velocity = curlNoise(position * uNoiseScale * .002, uNoiseSeed) * ( uNoiseStrength + 1.0) * .05 * uSpeed;
        }
        // Variation of the noise Over Time
        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0 ) {
          velocity += curlNoise( position, uNoiseSeed)  * uNoiseStrength * 0.05 * uSpeed;
        }
      #endif
      // **************************************************************
      #ifdef USE_SIMPLEX_NOISE
        if (uNoiseScale > 0.0 ) {
          velocity = vec3(snoise(position * uNoiseScale * .001) * ( uNoiseStrength + 1.0) * .1);
          velocity *= uSpeed;
        }
        // Variation of the noise Over Time
        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0) {
          velocity += vec3(snoise(position * uNoiseStrength * .001) * .05 * uSpeed);
        }
      #endif
      // ************************************************************** 
      #ifdef USE_FBM_NOISE
        if (uNoiseScale > 0.0 ) {
          velocity = fbm_vec3(position * uNoiseScale * .001, ( uNoiseStrength + 1.0), uNoiseSeed);
          velocity *= uSpeed;
        }
        // Variation of the noise Over Time
        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0 ) {      
          velocity += fbm_vec3(position * uNoiseStrength * .001, ( uNoiseStrength + 1.0), uNoiseSeed) * .1 * uSpeed;
        }
      #endif

      // COLLIDER
      ${KVe}
      // ATTRACTION
      ${JVe}  
      // VORTEX
      ${ZVe}
    } 
    // End isActive

    // SPAWN BIRTH 
    // **************************************************************
    // if (isSpawning == 1.)
    #ifdef USE_NORMALS
      velocity = mix(velocity, applyQuaternionToVector(uWorldQuaternion, directions) * uSpeed, isSpawning);
    #else
      velocity = mix(velocity, applyQuaternionToVector(uWorldQuaternion, uDirectionsAxis) * uSpeed, isSpawning);    
    #endif
    
    // if (collisionFlag == 0.0)
    velocity += applyForce(uGravity, mass * .5) * (1.0 - collisionFlag);

    gl_FragColor = vec4(velocity, collisionFlag);
}
`,Nte=`

  // Linear Fade In
  float linearFadeIn(float t) {
    return t;
  }


  // linear fade out
  float linearFadeOut(float t) {
    return 1.0 - t;
  }
  
  float linearInOut(float t) {
    return t < 0.5 ? t :  (1.0 - t);  
  }

    // lerp
    float lerp(float a, float b, float t) {
      return a + (b - a) * t;
    }

  // Ease In Out Quart
  float exponentialInOut(float t) {
    return t < 0.4 ? lerp(0.0, 1.0, t / 0.4) :
    t > 0.6 ? lerp(1.0, 0.0, (t - 0.6) / 0.4) :
    1.0;
   }

  // constant
  float constant(float t) {
    return 1.0;
  } 
`,eHe=`

float rand(vec3 co){
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

vec3 applyQuaternionToVector( vec4 q, vec3 v ){
  return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
}

vec3 applyForce(vec3 force, float mass) {
  vec3 acceleration = force / mass;
    
  return acceleration;
}
`,tHe=`
vec3 rgb2xyz (in vec3 rgb) {
    float r = rgb.r;
	float g = rgb.g;
	float b = rgb.b;

	r = r > 0.04045 ? pow(((r + 0.055) / 1.055), 2.4) : (r / 12.92);
	g = g > 0.04045 ? pow(((g + 0.055) / 1.055), 2.4) : (g / 12.92);
	b = b > 0.04045 ? pow(((b + 0.055) / 1.055), 2.4) : (b / 12.92);

	float x = (r * 0.4124) + (g * 0.3576) + (b * 0.1805);
	float y = (r * 0.2126) + (g * 0.7152) + (b * 0.0722);
	float z = (r * 0.0193) + (g * 0.1192) + (b * 0.9505);
    
    vec3 xyz = vec3(
        (r * 0.4124) + (g * 0.3576) + (b * 0.1805) * 100.0,
        (r * 0.2126) + (g * 0.7152) + (b * 0.0722) * 100.0,
        (r * 0.0193) + (g * 0.1192) + (b * 0.9505) * 100.0
    );
    return(xyz);
}

vec3 xyz2lab (in vec3 xyz) {
	float x = xyz.x / 95.047;
	float y = xyz.y / 100.0;
	float z = xyz.z / 108.883;

	x = x > 0.008856 ? pow(x, 1.0 / 3.0) : (7.787 * x) + (16.0 / 116.0);
	y = y > 0.008856 ? pow(y, 1.0 / 3.0) : (7.787 * y) + (16.0 / 116.0);
	z = z > 0.008856 ? pow(z, 1.0 / 3.0) : (7.787 * z) + (16.0 / 116.0);

    vec3 lab = vec3((116.0 * y) - 16.0, 500.0 * (x - y), 200.0 * (y - z));
    return(lab);
}

vec3 rgb2lab(in vec3 rgb) {
    vec3 xyz = rgb2xyz(rgb);
    vec3 lab = xyz2lab(xyz);
    return(lab);
}

vec3 xyz2rgb (in vec3 xyz) {
	float x = xyz.x / 100.0;
	float y = xyz.y / 100.0;
	float z = xyz.z / 100.0;
	
    
	float r = (x *  3.2406) + (y * -1.5372) + (z * -0.4986);
	float g = (x * -0.9689) + (y *  1.8758) + (z *  0.0415);
	float b = (x *  0.0557) + (y * -0.2040) + (z *  1.0570);

	r = r > 0.0031308 ? ((1.055 * pow(r, 1.0 / 2.4)) - 0.055) : r * 12.92;
	g = g > 0.0031308 ? ((1.055 * pow(g, 1.0 / 2.4)) - 0.055) : g * 12.92;
	b = b > 0.0031308 ? ((1.055 * pow(b, 1.0 / 2.4)) - 0.055) : b * 12.92;

	r = min(max(0.0, r), 1.0);
	g = min(max(0.0, g), 1.0);
	b = min(max(0.0, b), 1.0);

	return(vec3(r, g, b));
}

vec3 lab2xyz (in vec3 lab) {
    float l = lab.x;
	float a = lab.y;
	float b = lab.z;

  	float y = (l + 16.0) / 116.0;
	float x = a / 500.0 + y;
	float z = y - b / 200.0;

	float y2 = pow(y, 3.0);
	float x2 = pow(x, 3.0);
	float z2 = pow(z, 3.0);

  	y = y2 > 0.008856 ? y2 : (y - 16.0 / 116.0) / 7.787;
	x = x2 > 0.008856 ? x2 : (x - 16.0 / 116.0) / 7.787;
	z = z2 > 0.008856 ? z2 : (z - 16.0 / 116.0) / 7.787;

	x *= 95.047;
	y *= 100.0;
	z *= 108.883;

	return(vec3(x, y, z));
}
vec3 lab2rgb (in vec3 lab) {
    vec3 xyz = lab2xyz(lab);
    vec3 rgb = xyz2rgb(xyz);
    return(rgb);
}

`,iHe=`
  uniform sampler2D uPosition;
  uniform float uSize;
  uniform float uSizeEnd;
  uniform vec3 uWorldOffset;
  uniform vec4 uWorldQuaternion;
  // Billboard Behavior - Currently at Zero, but we can change that
  uniform float uRotation;
  uniform float uRotationEnd;
  uniform vec2 center;

  // Randomness
  uniform float uRandScaleFactor;
  uniform float uRandRotationFactor;

  attribute vec2 ref;

  varying float v_LifeLeft;    // normalized lifetime 1 to 0
  varying vec2 vUv;
  varying vec2 vRef;

  ${eHe}
  ${Nte}
`,nHe=({easeSize:e="linearFadeOut"})=>`
  vUv = uv;  
  vRef = ref;
  // Normalized LifeTime 1 to 0
  float lifeLeft = texture2D(uPosition, ref).w;
  v_LifeLeft = lifeLeft;
  // Position From DataTexture Simulation
  vec3 pos = texture2D(uPosition, ref).rgb - uWorldOffset;
  // Apply World Quaternion
  pos = applyQuaternionToVector(uWorldQuaternion, pos);  
            
  #ifdef  USE_SIZE_END
    // Scaled Over Time
    float t = 1. - lifeLeft;
    float currentSize = mix(uSize, uSizeEnd, t); // Linearly interpolate between uSize and uSizeEnd
    vec3 scaledPosition = position * vec3(currentSize);
  #else
    // Change Size Behavior over LifeTime
    float easeSize = ${e}(1. - lifeLeft);
    // Scaled Over Time
    vec3 scaledPosition = position * vec3(uSize * easeSize);
  #endif

  // Billboard Behavior
  vec2 scale;
  scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
  scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );    
  // Randomness 
  float randRef = rand(ref);
  scale *= (1.0 - (uRandScaleFactor * randRef));
  // Rotation
  float randRotation =  2.0 * PI * ( uRandRotationFactor * randRef);
  float originalRotation = (1.0 - uRotation) * 2.0 * PI;
  float originalRotationEnd = (1.0 - uRotationEnd) * 2.0 * PI;
  // OverTime
  float finalRotation = mix(originalRotation + randRotation, originalRotationEnd + randRotation, lifeLeft);

  vec2 alignedPosition = ( scaledPosition.xy - ( center - vec2( 0.5 ) ) ) * scale;
  vec2 rotatedPosition;
  rotatedPosition.x = cos( finalRotation ) * alignedPosition.x - sin( finalRotation ) * alignedPosition.y;
  rotatedPosition.y = sin( finalRotation ) * alignedPosition.x + cos( finalRotation ) * alignedPosition.y;
  
  mat4 instanceMatrix = mat4(
    vec4(1.0, 0.0, 0.0, 0.0),
    vec4(0.0, 1.0, 0.0, 0.0),
    vec4(0.0, 0.0, 1.0, 0.0),
    vec4(pos.x, pos.y, pos.z, 1.0)
  );  

  mvPosition = modelViewMatrix * instanceMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
  mvPosition.xy += rotatedPosition;
  gl_Position = projectionMatrix  * mvPosition;   
`,rHe=`
  uniform vec4 uColor;                // start color
  uniform vec4 uColor2;               // end color
  uniform sampler2D uTexture;         // texture
  varying float v_LifeLeft;   // normalized lifetime 1 to 0
  varying vec2 vUv;
  varying vec2 vRef;

  float random(vec2 co) {
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
  }
  `+Nte+`  
  ${tHe}

`,sHe=({easeOpacity:e="linearFadeOut"})=>`  
  // if Particle is dead, hide it
  if (v_LifeLeft <= 0.005 ) {
    discard;
  }

  #ifdef USE_RANDOM_COLORING
    float randVal = random(vRef); // Generate a random value based on the reference
    vec4 color = mix(uColor, uColor2, randVal); // Interpolate between the two colors
  #else
    vec4 color = mix(uColor, uColor2, 1. - v_LifeLeft);
  #endif

  // Opacity over Life Time
  float finalAlpha = ${e}(1. - v_LifeLeft);  
  vec4 textureColor = texture2D(uTexture, vUv).rgba; 
  finalColor = textureColor.rgb * color.rgb;
  finalAlpha = color.a * textureColor.a * finalAlpha;
  
  gl_FragColor = vec4(finalColor, finalAlpha);     

`,aHe=class extends vn{constructor(e,t){super(),this.needsJitter=!0,this.type="ParticleMaterial",this.easeOpacity="linearFadeIn",this.easeSize="linearFadeIn",this.useSizeEnd=!1,this.isColoringRandom=!1,this.init(e,t),this.context=t}reset(){}init(e,t){this.transparent=!0,this.depthTest=!0,this.depthWrite=!1,this.easeOpacity=e.ease,this.easeSize=e.easeSize,this.layers=[],Xs.startContext(Xs.globalContext),this.lightLayer=new id(0,"",{...da.defaultData("light","phong"),visible:!1},new O5,{},t.shared),Xs.endContext(Xs.globalContext),this.build()}updateState(e){e.coloring!==void 0&&(this.isColoringRandom=e.coloring==="random"),e.color!==void 0&&(e.color instanceof Array?this.uniforms.uColor.value=e.color:this.uniforms.uColor.value=this.context.shared.color(e.color)),e.color2!==void 0&&(e.color2 instanceof Array?this.uniforms.uColor2.value=e.color2:this.uniforms.uColor2.value=this.context.shared.color(e.color2)),e.size!==void 0&&(this.uniforms.uSize.value=e.size[0],this.uniforms.uSizeEnd.value=e.size[1],e.size[0]!==e.size[1]?this.useSizeEnd=!0:this.useSizeEnd=!1),e.ease!==void 0&&(this.easeOpacity=e.ease,this.build()),e.easeSize!==void 0&&(this.easeSize=e.easeSize,this.build()),this.needsUpdate=!0}onBeforeCompile(e){this.build(),e.defines=this.defines,e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader}build(){let e=new Lee;return e.needsJitter=this.needsJitter,e.addFragmentParsCode(NNe),e.buildShader("vertex",this.fragment),e.buildShader("fragment",this.fragment),e.addFragmentFinalCode(zNe),this.isColoringRandom&&e.define("USE_RANDOM_COLORING"),this.useSizeEnd&&e.define("USE_SIZE_END"),e.addVertexParsCode(iHe),e.addFragmentParsCode(rHe),e.addVertexFinalCode(nHe({easeSize:this.easeSize})),e.addFragmentFinalCode(sHe({easeOpacity:this.easeOpacity})),this.vertexShader=e.getCode("vertex"),this.fragmentShader=e.getCode("fragment"),this.defines=e.defines,this.uniforms={...e.uniforms,...this.uniforms},this.extensions=e.extensions,this}get nodeMaterial(){return this}get fragment(){return this.lightLayer.node}getDefines(){return this.defines}nodeMaterialDispose(){this.layers.forEach(e=>e.dispose()),super.dispose()}},pL=class{constructor(e,t,i,n){this.type="SphereEmitterShape",this.targetMesh=void 0,this.size=e,this.type=i,this.textureSize=jVe(t);let r=1;this.targetMesh=(n==null?void 0:n.geometry.type)==="BufferGeometry"||(n==null?void 0:n.type)==="Mesh"&&n&&n.geometry.hasAttribute("position")&&n.geometry.hasAttribute("normal")?n:this.getMesh(i,r);let{positions:s,dataTexture:a,dataTextureNormals:o}=this.createPositions(this.textureSize,this.targetMesh??this.getMesh(i,r));this.positionsTexture=a,this.positionsAttribute=s,this.directionsTexture=o}createPositions(e,t){let{positions:i,normals:n}=WVe(t,e*e),r=$7(i,e),s=$7(n,e);return{dataTexture:r,positions:i,dataTextureNormals:s}}getMesh(e,t){let i=null;switch(e){case"SphereEmitterShape":{i=new E1(t*.5,32,32);break}case"TorusEmitterShape":{i=new gZ(t*.5,.3,15,40);break}case"ConeEmitterShape":{i=new F4(t,t,15);break}case"BoxEmitterShape":{i=new eh(t,t,t);break}case"PlaneEmitterShape":{i=new Ad(t,t),i.rotateX(-Math.PI/2);break}case"MeshEmitterShape":{i=new E1(t,32,32);break}default:{i=new E1(t,32,32);break}}return new fr(i,new np({color:16711680}))}applyToShader(e,t){this.size=new G().fromArray(t.size),e.uEmitterSize.value=this.size}dispose(){this.positionsTexture.dispose(),this.directionsTexture.dispose(),this.positionsAttribute=new Float32Array}};function r1(e){let t={...e},i=A3.defaultData;t.forceFieldObjectId&&(t.colliderEntityId=t.forceFieldObjectId);let n={...i.shape,...t.shape},r={...i.renderMaterial,...t.renderMaterial};return{...i,...t,shape:n,renderMaterial:r}}var oHe=`
// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU

uniform sampler2D uIndex; // Texture with corresponding index
uniform float uLastIndexEmitted; // Last emitted index
uniform float uParticlesToEmit; // Number of particles to emit on that frame
uniform float uTime;

void main() {
    vec2 vUv = gl_FragCoord.xy / resolution.xy;
    float particleIndex = texture(uIndex, vUv).x;
    float timeLeft = texture2D( uCurrentPosition, vUv ).w;
    float isActive = texture2D( uCurrentEmissionRate, vUv ).g;    // 1. = active, 0. = not active
    float timeStart = texture2D( uCurrentEmissionRate, vUv ).b;


    // ********** Detect Colision to Create a flag and use it in position **********
    // We are doing this here, so

    // ********** Emit Particles **********
    // X = isSpawning 0.0 or 1.0
    // Y = isActive 0.0 or 1.0
    // Check if the vertex index is between the first value and the last value
    // if (particleIndex >= uLastIndexEmitted && particleIndex < uLastIndexEmitted + uParticlesToEmit) {
    //     // Emit a particle by writing 1 to the red channel of the color output
    //     // r: 1. == emit the particle
    //     // g: 1. == particle is now active
    //     timeStart = uTime;
    //     gl_FragColor = vec4(1.0, 1.0, timeStart, 1.0);
    // } else {
    //     // The Particle is either already emitted or not in the range of the particles to emit
    //     // Do not emit a particle by writing 0 to the red channel of the color output        
    //     gl_FragColor = vec4(0.0, isActive, timeStart, 1.0);
    // }
    // Determine if the particle is within the emission range
    float emitLowerBound = step(uLastIndexEmitted, particleIndex);
    float emitUpperBound = step(particleIndex, uLastIndexEmitted + uParticlesToEmit - 1.0);
    float emitParticle = emitLowerBound * emitUpperBound; // 1.0 if in range, 0.0 otherwise

    // Set timeStart and color
    timeStart = mix(timeStart, uTime, emitParticle);
    gl_FragColor = vec4(emitParticle, mix(isActive, 1.0, emitParticle), timeStart, 1.0);


}
`,mL=10,lHe=class extends kn{constructor(e,t){super(),this.type="ParticleEmitter",this.debugMode=!1,this.worldSpace=!0,this.rootObject=null,this.gpuCompute=null,this.positionSimRT=null,this.velocitySimRT=null,this.emissionRateSimRT=null,this.emitterShape=void 0,this.isEmitting=!1,this.hasBeenReset=!1,this.emittedParticlesAmount=0,this.lastEmitTime=0,this.globalTime=0,this.targetFPS=60,this.previousRatio=1,this.lerpFactor=.4,this.particlesAmount=0,this.noiseStrength=0,this.noiseScale=0,this.isBillboardBased=!0,this.simFeaturesDefinition={USE_COLLIDER:!1,USE_ATTRACTOR:!1,USE_VORTEX:!1,USE_SPHERE_COLLIDER:!1,USE_BOX_COLLIDER:!1,USE_FORCE_LOCAL_SPACE:!1,USE_NORMALS:!1,USE_CURL_NOISE:!0,USE_SIMPLEX_NOISE:!1,USE_FBM_NOISE:!1},this.textureLoader=new oEe,this.currentWorldPosition=new G,this.systemQuaternion=new Ei,this.worldGravity=new G(0,0,0),this.directionAxis=new G(0,0,0),this.colliderV3=new G(0,0,0),this.colliderQuaternion=new Ei(0,0,0,1),this.matrixAutoUpdate=!0,this.renderer=e,this.system=t,this.shared=t.context.shared;let i=t.data;this.material=new aHe(i.renderMaterial,t.context),this.material.uniforms={uSize:{value:0},uSizeEnd:{value:0},uColor:{value:i.renderMaterial.color},uColor2:{value:i.renderMaterial.color2},uPosition:{value:new G(0,0,0)},uEmissionData:{value:new G(0,0,0)},uTexture:{value:this.defaultTexture},uWorldOffset:{value:new G(0,0,0)},uWorldQuaternion:{value:new Di(0,0,0,1)},uRandScaleFactor:{value:i.randomScale??0},uRandRotationFactor:{value:i.randomRotation??0},uRotation:{value:i.renderMaterial.spriteRotation[0]??0},uRotationEnd:{value:i.renderMaterial.spriteRotation[1]??0}},this.setTexture(this.material.uniforms,i.renderMaterial.texture),this.init(i)}setTexture(e,t){let i=t.data;if(typeof t=="string"){let n=this.shared.image(t),r=new Hr(n.img);r.needsUpdate=!0,e.uTexture.value=r;return}if(typeof i!="string"){let n=new Image;n.onload=()=>{let a=new Hr(n);a.needsUpdate=!0,e.uTexture.value=a};let r=new Blob([i],{type:"image/*"}),s=URL.createObjectURL(r);n.src=s}}updateGeometryAttributes(e,t){var n;let i=kVe(t);!((n=this.emitterShape)!=null&&n.positionsAttribute)||e.geometry.setAttribute("ref",new mw(i,2))}applyWorldSpace(){if(!this.system.started||!this.worldSpace||!this.positionSimRT||!this.velocitySimRT)return;let e=this.system;e.getWorldQuaternion(this.systemQuaternion),this.systemQuaternion.invert(),e.getWorldPosition(this.currentWorldPosition),this.material.uniforms.uWorldOffset.value=this.currentWorldPosition,this.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize()),this.positionSimRT.material.uniforms.uWorldOffset.value=this.currentWorldPosition,this.systemQuaternion.invert(),this.positionSimRT.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize()),this.velocitySimRT.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize())}update(e,t){var a;if(!this.gpuCompute||!this.positionSimRT||!this.velocitySimRT||!this.emissionRateSimRT||this.hasBeenReset)return;if(this.checkIfAllParticlesAreDead()&&!this.hasBeenReset){this.reset();return}this.applyWorldSpace(),this.globalTime=e,this.positionSimRT.material.uniforms.uTime.value=e,this.emissionRateSimRT.material.uniforms.uTime.value=e;let i=1e3/t,n=this.targetFPS/i,r=this.previousRatio+(n-this.previousRatio)*this.lerpFactor;this.positionSimRT.material.uniforms.uFPSRatio.value=r,this.previousRatio=r;let s=this.isEmitting?this.GoEmitSomeParticles(e,this.system.data.birthRatePerSec):0;this.emissionRateSimRT.material.uniforms.uLastIndexEmitted.value=this.emittedParticlesAmount,this.emissionRateSimRT.material.uniforms.uParticlesToEmit.value=s,this.material.uniforms.uPosition.value=(a=this.gpuCompute.getCurrentRenderTarget(this.positionSimRT))==null?void 0:a.texture,this.system.colliderEntities.length>0&&this.renderColliders(),this.gpuCompute.compute()}renderColliders(){if(!this.velocitySimRT)return;let e=this.system.colliderEntities[0],t=this.simFeaturesDefinition.USE_COLLIDER||this.simFeaturesDefinition.USE_ATTRACTOR||this.simFeaturesDefinition.USE_VORTEX;if(e.destroyedInAction&&t&&this.init(r1({...this.system.data,colliderEntityId:null})),!e||e.destroyedInAction)return;e.getWorldPosition(this.colliderV3),this.colliderV3.y===0&&(this.colliderV3.y=1e-4),this.velocitySimRT.material.uniforms.uColliderPos.value.copy(this.colliderV3);let i=e.data.size;this.colliderV3.fromArray(i),this.velocitySimRT.material.uniforms.uColliderSize.value.copy(this.simFeaturesDefinition.USE_SPHERE_COLLIDER?this.colliderV3.multiplyScalar(.5):this.colliderV3),e.getWorldQuaternion(this.colliderQuaternion),this.velocitySimRT.material.uniforms.uColliderQuaternion.value.copy(this.colliderQuaternion.normalize()),this.velocitySimRT.material.uniforms.uColliderQuaternionInvert.value.copy(this.colliderQuaternion.normalize().invert())}updateState(e){!this.velocitySimRT||!this.positionSimRT||(e.renderMaterial&&this.updateMaterialState(e.renderMaterial),this.updateParticleState(e))}updateVariableState(e,t){if(!this.velocitySimRT||!this.positionSimRT)return;t[2]==="size"&&this.material.updateState({size:[e,this.material.uniforms.uSizeEnd.value]}),t[2]==="sizeEnd"&&this.material.updateState({size:[this.material.uniforms.uSize.value,e]});let i=(n,r)=>{let s=[...this.system.data.shape.size];s[n]=r,this.updateParticleState({shape:{...this.system.data.shape,size:s}})};t[2]==="shape_size_0"&&i(0,e),t[2]==="shape_size_1"&&i(1,e),t[2]==="shape_size_2"&&i(2,e),t[2]==="speed"&&(this.velocitySimRT.material.uniforms.uSpeed.value=e/mL),t[2]==="gravity"&&this.worldGravity.set(0,e/100,0),t[2]==="noiseStrength"&&(this.noiseStrength=e,this.velocitySimRT.material.uniforms.uNoiseStrength.value=this.noiseStrength),t[2]==="noiseScale"&&(this.noiseScale=e,this.velocitySimRT.material.uniforms.uNoiseScale.value=this.noiseScale),t[2]==="direction_x"&&(this.directionAxis=this.getDirectionAxis([Number(e),this.system.data.direction[1],this.system.data.direction[2]])),t[2]==="direction_y"&&(this.directionAxis=this.getDirectionAxis([this.system.data.direction[0],Number(e),this.system.data.direction[2]])),t[2]==="direction_z"&&(this.directionAxis=this.getDirectionAxis([this.system.data.direction[0],this.system.data.direction[1],Number(e)]))}updateMaterialState(e){this.material.updateState({...e,size:e.size?[Number(this.shared.getVariable(e.size[0],[this.uuid,"particles","size"])),Number(this.shared.getVariable(e.size[1],[this.uuid,"particles","sizeEnd"]))]:[0,0]}),e.texture&&(this.setTexture(this.material.uniforms,e.texture),this.material.needsUpdate=!0)}updateParticleState(e){var t,i,n;if(!(!this.positionSimRT||!this.velocitySimRT)){if(this.shouldReInitGPUCompute(e)&&this.init(r1(this.system.data)),e.life!==void 0&&(this.positionSimRT.material.uniforms.uMaxLifeTime.value=e.life),e.speed!==void 0&&(this.velocitySimRT.material.uniforms.uSpeed.value=Number(this.shared.getVariable(e.speed,[this.uuid,"particles","speed"]))/mL),e.collisionBounce!==void 0&&(this.velocitySimRT.material.uniforms.uBounce.value=e.collisionBounce),e.noiseStrength!==void 0&&(this.noiseStrength=Number(this.shared.getVariable(e.noiseStrength,[this.uuid,"particles","noiseStrength"])),this.velocitySimRT.material.uniforms.uNoiseStrength.value=this.noiseStrength),e.noiseScale!==void 0&&(this.noiseScale=Number(this.shared.getVariable(e.noiseScale,[this.uuid,"particles","noiseScale"])),this.velocitySimRT.material.uniforms.uNoiseScale.value=this.noiseScale),e.noiseSeed!==void 0&&(this.velocitySimRT.material.uniforms.uNoiseSeed.value=e.noiseSeed),e.randomMass!==void 0&&(this.velocitySimRT.material.uniforms.uRandomMassFactor.value=e.randomMass),((t=e.renderMaterial)==null?void 0:t.size)!==void 0){let r=this.shared.getVariable(e.renderMaterial.size[0],[this.uuid,"particles","size"]);this.velocitySimRT.material.uniforms.particleSize.value=Number(r)}if(((i=e.renderMaterial)==null?void 0:i.spriteRotation)!==void 0&&(this.material.uniforms.uRotation.value=e.renderMaterial.spriteRotation[0],this.material.uniforms.uRotationEnd.value=e.renderMaterial.spriteRotation[1]),e.shape!==void 0){let r=e.shape.size??this.system.data.shape.size,s=[Number(this.shared.getVariable(r[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(r[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(r[2],[this.uuid,"particles","shape_size_2"]))],a={...r1(this.system.data).shape,size:s};(n=this.emitterShape)==null||n.applyToShader(this.positionSimRT.material.uniforms,a)}if(e.gravity!==void 0&&(this.worldGravity.set(0,Number(this.shared.getVariable(this.system.data.gravity,[this.uuid,"particles","gravity"]))/100,0),this.velocitySimRT.material.uniforms.uGravity={value:this.worldGravity}),e.direction!==void 0){let r=this.getDirectionFromVariable(e.direction);this.directionAxis=this.getDirectionAxis(r),this.velocitySimRT.material.uniforms.uDirectionsAxis.value=this.directionAxis}e.randomRotation!==void 0&&(this.material.uniforms.uRandRotationFactor.value=e.randomRotation),e.randomScale!==void 0&&(this.material.uniforms.uRandScaleFactor.value=e.randomScale)}}updateForceFieldParameters(e){!this.velocitySimRT||(e.forceIntensity!==void 0&&(this.velocitySimRT.material.uniforms.uForceIntensity.value=e.forceIntensity),e.forceDambing!==void 0&&(this.velocitySimRT.material.uniforms.uForceDamping.value=e.forceDambing))}getDirectionAxis(e){let t=[Number(e[0])*qt.DEG2RAD,Number(e[1])*qt.DEG2RAD,Number(e[2])*qt.DEG2RAD],i=new qs(t[0],t[1],t[2],"XYZ");return this.directionAxis.set(0,1,0).applyEuler(i).normalize(),this.velocitySimRT&&(this.velocitySimRT.material.uniforms.uDirectionsAxis.value=this.directionAxis),this.directionAxis}shouldReInitGPUCompute(e){let{birthRatePerSec:t,rootObjectType:i,colliderEntityId:n,shape:r,emitTimeDuration:s,emitTimeCycle:a,life:o,directionMode:l,noiseType:c}=e;return t!==void 0||i!==void 0||n||n===null||a!==void 0||r!==void 0||o!==void 0||s!==void 0||l!==void 0||c!==void 0}init(e){this.dispose(),this.particlesAmount=this.getMaxParticlesAmount({birthRatePerSecond:e.birthRatePerSec,particleMaxLifeTime:e.life,loopDuration:e.emitTimeCycle==="infinity"?0:e.emitTimeDuration}),this.particlesAmount>1e5&&(console.warn("The maximum number of particles is limited to 100000."),this.particlesAmount=1e5),this.emitterShape=this.createShape(e.shape,this.particlesAmount);let t=setInterval(()=>{if(this.emitterShape)if(isNaN(this.emitterShape.positionsTexture.source.data.data[0])){this.init(e);return}else clearInterval(t)},100);if(!this.emitterShape)return;let i=new HVe(this.emitterShape.textureSize,this.emitterShape.textureSize,this.renderer),n=this.updateSimulationDefinition(e),r=i.addVariable("uCurrentPosition",n+YVe,this.emitterShape.positionsTexture),s=i.addVariable("uCurrentVelocity",n+$Ve,this.emitterShape.directionsTexture),a=i.addVariable("uCurrentEmissionRate",oHe,qVe(this.emitterShape.textureSize));i.setVariableDependencies(r,[r,s,a]),i.setVariableDependencies(s,[r,s,a]),i.setVariableDependencies(a,[r,s,a]);let o=XVe({size:this.emitterShape.textureSize}),l={uOriginalPosition:{value:this.emitterShape.positionsTexture},uWorldOffset:{value:new G(0,0,0)},uWorldQuaternion:{value:new Di(0,0,0,1)},uTime:{value:0},uFPSRatio:{value:1},uMaxLifeTime:{value:e.life},uEmitterSize:{value:new G(Number(this.shared.getVariable(e.shape.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(e.shape.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(e.shape.size[2],[this.uuid,"particles","shape_size_2"])))},particleSize:{value:0}};r.material.uniforms=l;let c=this.getDirectionFromVariable(e.direction);this.directionAxis=this.getDirectionAxis(c),this.worldGravity.set(0,Number(this.shared.getVariable(this.system.data.gravity,[this.uuid,"particles","gravity"]))/100,0),this.noiseStrength=Number(this.shared.getVariable(e.noiseStrength,[this.uuid,"particles","noiseStrength"])),this.noiseScale=Number(this.shared.getVariable(e.noiseScale,[this.uuid,"particles","noiseScale"]));let u=e.colliderEntityId&&this.system.getColliderData(e.colliderEntityId),h={uOriginalPosition:{value:this.emitterShape.positionsTexture},uDirections:{value:this.emitterShape.directionsTexture},uDirectionsAxis:{value:this.directionAxis},uWorldQuaternion:{value:new Di(0,0,0,1)},uColliderPos:{value:new G(0,0,0)},uColliderSize:{value:new G(0,0,0)},uForceIntensity:{value:u?u.forceIntensity:0},uForceDamping:{value:u?u.forceDambing:0},uColliderQuaternion:{value:new Di(0,0,0,1)},uColliderQuaternionInvert:{value:new Di(0,0,0,1)},particleSize:{value:0},uGravity:{value:this.worldGravity},uNoiseStrength:{value:this.noiseStrength},uNoiseScale:{value:this.noiseScale},uNoiseSeed:{value:e.noiseSeed},uRandomMassFactor:{value:e.randomMass},uBounce:{value:e.collisionBounce},uSpeed:{value:Number(this.shared.getVariable(e.speed,[this.uuid,"particles","speed"]))/mL}};s.material.uniforms=h;let d={uIndex:{value:o},uTime:{value:0},uLastIndexEmitted:{value:0},uParticlesToEmit:{value:0}};a.material.uniforms=d;let p=[Number(this.shared.getVariable(e.shape.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(e.shape.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(e.shape.size[2],[this.uuid,"particles","shape_size_2"]))],g={...r1(this.system.data).shape,size:p};this.emitterShape.applyToShader(r.material.uniforms,g),i.init(),this.gpuCompute=i,this.positionSimRT=r,this.velocitySimRT=s,this.emissionRateSimRT=a,this.rootObject=this.createPrimaryEmitter(this.emitterShape.textureSize),this.add(this.rootObject),this.material.needsUpdate=!0}getDirectionFromVariable(e){let t=Number(this.shared.getVariable(e[0],[this.uuid,"particles","direction_x"])),i=Number(this.shared.getVariable(e[1],[this.uuid,"particles","direction_y"])),n=Number(this.shared.getVariable(e[2],[this.uuid,"particles","direction_z"]));return[t,i,n]}updateSimulationDefinition(e){if(this.simFeaturesDefinition.USE_COLLIDER=!1,this.simFeaturesDefinition.USE_ATTRACTOR=!1,this.simFeaturesDefinition.USE_VORTEX=!1,this.simFeaturesDefinition.USE_SPHERE_COLLIDER=!1,this.simFeaturesDefinition.USE_BOX_COLLIDER=!1,this.simFeaturesDefinition.USE_FORCE_LOCAL_SPACE=!1,this.simFeaturesDefinition.USE_NORMALS=!1,this.simFeaturesDefinition.USE_CURL_NOISE=!1,this.simFeaturesDefinition.USE_SIMPLEX_NOISE=!1,this.simFeaturesDefinition.USE_FBM_NOISE=!1,e.colliderEntityId&&this.system.colliderEntities.length>0){let i=this.system.getColliderData(e.colliderEntityId);switch(i==null?void 0:i.forceType){case"attractor":this.simFeaturesDefinition.USE_ATTRACTOR=!0;break;case"collider":this.simFeaturesDefinition.USE_COLLIDER=!0;break;case"vortex":this.simFeaturesDefinition.USE_VORTEX=!0;break}let n=i==null?void 0:i.colliderType;n==="sphere"&&(this.simFeaturesDefinition.USE_SPHERE_COLLIDER=!0),n==="box"&&(this.simFeaturesDefinition.USE_BOX_COLLIDER=!0),(i==null?void 0:i.forceRange)==="helper"&&(this.simFeaturesDefinition.USE_FORCE_LOCAL_SPACE=!0)}e.directionMode==="normals"&&(this.simFeaturesDefinition.USE_NORMALS=!0),e.noiseType==="curl"&&(this.simFeaturesDefinition.USE_CURL_NOISE=!0),e.noiseType==="simplex"&&(this.simFeaturesDefinition.USE_SIMPLEX_NOISE=!0),e.noiseType==="fbm"&&(this.simFeaturesDefinition.USE_FBM_NOISE=!0);let t="";for(let[i,n]of Object.entries(this.simFeaturesDefinition))n&&(t+=`#define ${i}
`);return t}createShape(e,t){this.emitterShape&&this.emitterShape.dispose();let i=new G(Number(this.shared.getVariable(e.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(e.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(e.size[2],[this.uuid,"particles","shape_size_2"])));if(e.type==="MeshEmitterShape"){let n=null;return this.system.context.scene.traverseEntity(r=>{r.uuid===e.fromMeshId&&(n=r)}),n?new pL(i,t,e.type,n):new pL(i,t,"SphereEmitterShape")}else return new pL(i,t,e.type)}createPrimaryEmitter(e){let t,i=e*e;return t=new bMe(new Ad(1,1,1),this.material,i),this.updateGeometryAttributes(t,e),this.material.needsUpdate=!0,t.onBeforeRender=()=>{this.applyWorldSpace()},t}getMaxParticlesAmount({birthRatePerSecond:e,particleMaxLifeTime:t,loopDuration:i=0}){return Math.ceil(e*(t+i))}dispose(){var e,t,i;!this.gpuCompute||((t=(e=this.rootObject)==null?void 0:e.parent)==null||t.remove(this.rootObject),this.gpuCompute.dispose(),this.material.nodeMaterialDispose(),(i=this.emitterShape)==null||i.dispose())}GoEmitSomeParticles(e,t){let i=e-this.lastEmitTime,n=1/t;if(i>=n){let r=Math.max(1,Math.floor(i/n));return this.lastEmitTime=e,this.emittedParticlesAmount+r>this.particlesAmount&&(this.emittedParticlesAmount=0),this.emittedParticlesAmount+=r,r}return 0}checkIfAllParticlesAreDead(){return this.lastEmitTime+this.system.data.life+1<this.globalTime}reset(){this.hasBeenReset=!0,this.lastEmitTime=0,this.emittedParticlesAmount=0,this.gpuCompute&&this.init(r1(this.system.data))}startEmitting(e){this.isEmitting=!0,this.hasBeenReset=!1,this.lastEmitTime=e}stopEmitting(){this.isEmitting=!1}},HA=class extends nl{constructor(e,t,i){super(e,t),this.type="ParticleSystem",this.geometry=new ii,this.actualTime=0,this.currentLoopTime=0,this.started=!1,this.stopped=!1,this.timeoutId=void 0,this.isFrozen=!1,this.isIdle=!0,this.emitter=null,this.colliderEntities=[],this.renderer=null,this.isPreWarm=!1,this._hasOnAfterRenderBeenCalled=!1,this.onAfterRender=n=>{this._hasOnAfterRenderBeenCalled||(this._hasOnAfterRenderBeenCalled=!0,this.init(n))},this.context=i,this.data={...t,...r1(t)},this.geometry.setAttribute("position",new Gt([],3)),this.material=new np({colorWrite:!1}),this.frustumCulled=!1}init(e){this.renderer=e,this.emitter=new lHe(e,this),this.add(this.emitter),this.updateParticleState(this.data)}update(e){if(!this.isReady||!this.started||this.isFrozen||this.isIdle)return;this.actualTime+=e,this.stopped||(this.currentLoopTime+=e);let t=this.data.emitTimeCycle==="one_time";if((this.data.emitTimeCycle==="loop"||t)&&this.currentLoopTime>this.data.emitTimeDuration*1e3&&(this.stopped||(this.stop(),t||this.start(this.data.emitTimeDelay*1e3))),this.emitter&&this.started){let i=this.actualTime/1e3;this.emitter.update(i,e)}this.scale.set(1,1,1),this.updateMatrix()}isReady(){return!!this.emitter}hasCollider(e){return this.colliderEntities.some(t=>t.identity===e)}getColliderData(e){let t=this.colliderEntities.find(i=>i.identity===e);return t?t.data:null}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),cr(e.path,["renderMaterial"])&&this.updateParticleState({renderMaterial:{...this.data.renderMaterial,...ma.drop(e,1).props}}),cr(e.path,["shape"])&&this.updateParticleState({shape:{...this.data.shape,...ma.drop(e,1).props}})}updateState(e,t){super.updateState(e,t),this.updateParticleState(e)}updateParticleState(e){if(this.emitter){if(e.colliderEntityId!==void 0&&e.colliderEntityId!==null){let t=this.context.scene.find(e.colliderEntityId);this.colliderEntities=t?[t]:[]}e.colliderEntityId===null&&(this.colliderEntities=[]),this.emitter.updateState(e),e.emitTimeCycle&&this.started&&this.start()}}updateFromColliderEntity(e){!this.emitter||(this.emitter.updateForceFieldParameters(e),this.stop(),this.start())}start(e=0){var t;if(this.currentLoopTime=0,e){this.timeoutId=window.setTimeout(()=>{this.start(0)},e);return}this.started=!0,this.stopped=!1,this.isFrozen=!1,(t=this.emitter)==null||t.startEmitting(this.actualTime/1e3)}froze(){this.isFrozen=!0}unFroze(){this.isFrozen=!1}stop(){var e;this.stopped=!0,this.currentLoopTime=0,(e=this.emitter)==null||e.stopEmitting(),clearTimeout(this.timeoutId)}reset(){var e;this.started=!1,this.stopped=!1,(e=this.emitter)==null||e.reset()}wakeUp(){this.isIdle=!1}sleep(){this.isIdle=!0,this.reset()}};function cHe(){try{let e=window.location.href;if(e.includes("reducesubdiv=")){let t=e.indexOf("reducesubdiv=")+13;return parseInt(e.slice(t,t+1))}}catch{}}var gL=cHe();function uHe(e,t,i){var r;gL!==void 0&&(((r=t==null?void 0:t.geometry)==null?void 0:r.subdivisions)??0)>gL&&(console.log("reducing subdivisions",t.name,t.geometry.subdivisions),t.geometry.subdivisions=gL);let n;return t.geometry.type==="TextGeometry"?new z5(e,t,i):t.geometry.type==="InputGeometry"?new X5(e,t,i):(t.geometry.type==="SubdivGeometry"?n=new Iw(e,t,i):t.geometry.type==="PathGeometry"?n=new W5(e,t,i):t.geometry.type==="VectorGeometry"?n=new FVe(e,t,i):t.geometry.type==="BooleanGeometry"?n=new V0(e,t,i):t.geometry.type==="ShapeBlendGeometry"?n=new H0(e,t,i):t.geometry.type==="UIGeometry"?n=new mo(e,t,i):n=new Ds(e,t,i),n)}function Y5(e,t,i){return console.assert(t.type!==void 0),t.type==="Mesh"?uHe(e,t,i):t.type==="Empty"?new L1(e,t):t.type==="Particle"?new HA(e,t,i):t.type==="ParticleCollider"?new VA(e,t,i):t.type==="Splat"?new L1(e,t):t.type==="Bone"?new VVe(e,t):t.type==="Page"?new fa(e,t,i):t.type==="PointLight"?new zVe(e,t,i):t.type==="SpotLight"?new Ete(e,t,i):t.type==="DirectionalLight"?new Mte(e,t,i):t.type==="Component"||t.type==="Instance"?new U1(e,t,i):N0.is(t.type)?new xo(e,t):(console.error(t),new L1(e,t))}Hm.createEntity=Y5;function hHe(e,t,i){let n=Y5(e.identity,t,i),r=e.children,s=e.attachedPaths,a=e.parent,o=e.component,l=e.instances,c=e.overrideData,u=e.uuid,h=e.stateSelection;e.dispose();for(let d of Object.keys(e))delete e[d];Object.setPrototypeOf(e,Object.getPrototypeOf(n));for(let d of Object.keys(n))e[d]=n[d];e.children=[...e.children,...r],e.attachedPaths=s,e.parent=a,e.component=o,e.instances=l,e.uuid=u,e.overrideData=c,e.updateState(e.data,i),h&&e.changeSelectedState(h,i),e.resetBBoxNeedsUpdate()}Hm.changeEntityProptotype=hHe;Hm.Cloner=Wc;function dHe(e,t,i,n){e.updateByOp(t,i,n,!1)}var Kv=5,GA=new ii;GA.setAttribute("position",new vi(new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),3));var kC=class extends JMe{constructor(e){super({...e,depthTest:!1,depthWrite:!1,glslVersion:GU,vertexShader:`
				precision highp float;
				in vec3 position;
				void main() {
					gl_Position = vec4(position, 1);
				}
			`})}customProgramCacheKey(){return""}};function fHe(){return{shapeInput:()=>`
			const float posRowCoord = ${.5/Kv};  // vec4: px py pz opType
			const float quatRowCoord = ${1.5/Kv};  // vec4: qx qy qz qw
			const float param1RowCoord = ${2.5/Kv};// vec4: type param1 param2 param3
			const float param2RowCoord = ${3.5/Kv};// vec4: blendRange roundness scale param4
			const float colorRowCoord = ${4.5/Kv}; // vec4: r g b a
			uniform sampler2D shapesDataTexture;
			vec4 shapePos(float iin) { 
				vec4 r = texture(shapesDataTexture, vec2(iin, posRowCoord));
				return r;
			}
			vec4 shapeQuat(float iin) {
				vec4 r = texture(shapesDataTexture, vec2(iin, quatRowCoord));
				return r;
			}
			vec4 shapeParams1(float iin) {
				vec4 r = texture(shapesDataTexture, vec2(iin, param1RowCoord));
				return r;
			}
			vec4 shapeParams2(float iin) {
				vec4 r = texture(shapesDataTexture, vec2(iin, param2RowCoord));
				return r;
			}
			vec4 shapeColor(float iin) {
				vec4 r = texture(shapesDataTexture, vec2(iin, colorRowCoord));
				return r;
			}
		`,getxyzi:`
			// this code must complement lookup
			float xi = mod(gl_FragCoord.x - 0.5, VOXEL_RESOLUTION);
			float yi = mod(gl_FragCoord.y - 0.5, VOXEL_RESOLUTION);
			float zi = floor((gl_FragCoord.x - 0.5) * INV_VOXEL_RESOLUTION) + floor((gl_FragCoord.y - 0.5) * INV_VOXEL_RESOLUTION) * Z_LAYERS_PER_ROW;
		`,lookup:`
			uniform sampler2D potentialPassTexture;
			uniform sampler2D voxelPassTexture; // includes normal (in xyz) and key (in w)
			
			// box or marching cube lookup value in value texture, integer box coord inputs
			// this code must complement codebits.getxyzi
			vec4 look(float xi, float yi, float zi, sampler2D rt) {// range 0 .. numv etc
				vec2 uv = vec2(
					mod(zi, Z_LAYERS_PER_ROW) + (xi + 0.5) / VOXEL_RESOLUTION,
					floor(zi / Z_LAYERS_PER_ROW) + (yi + 0.5) / VOXEL_RESOLUTION
				); 
				uv /= Z_LAYERS_PER_ROW;
				return texture(rt, uv);
			}
		`,getpart:`
			float getpart(inout float a, float b) {
				float t = floor(a/b);
				float r = a - t*b;
				a = t;
				return r;
			}
		`,triTable:new Float32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,1,1,8,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,2,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,10,2,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,2,9,9,2,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,2,8,10,2,8,9,10,-1,-1,-1,-1,-1,-1,-1,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,11,0,0,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,11,3,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,11,1,11,9,1,11,8,9,-1,-1,-1,-1,-1,-1,-1,1,10,3,3,10,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,10,0,10,8,0,10,11,8,-1,-1,-1,-1,-1,-1,-1,0,9,3,9,11,3,9,10,11,-1,-1,-1,-1,-1,-1,-1,10,8,9,11,8,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,4,4,3,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,0,7,4,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,4,1,7,4,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,2,1,7,4,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,4,3,4,0,3,10,2,1,-1,-1,-1,-1,-1,-1,-1,10,2,9,2,0,9,7,4,8,-1,-1,-1,-1,-1,-1,-1,9,10,2,7,9,2,3,7,2,4,9,7,-1,-1,-1,-1,7,4,8,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,4,11,4,2,11,4,0,2,-1,-1,-1,-1,-1,-1,-1,1,0,9,7,4,8,11,3,2,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,9,2,11,9,1,2,9,-1,-1,-1,-1,1,10,3,10,11,3,4,8,7,-1,-1,-1,-1,-1,-1,-1,10,11,1,11,4,1,4,0,1,4,11,7,-1,-1,-1,-1,8,7,4,11,0,9,10,11,9,3,0,11,-1,-1,-1,-1,11,7,4,9,11,4,10,11,9,-1,-1,-1,-1,-1,-1,-1,4,5,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,5,9,3,8,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,5,0,0,5,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,5,8,5,3,8,5,1,3,-1,-1,-1,-1,-1,-1,-1,10,2,1,4,5,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,3,10,2,1,5,9,4,-1,-1,-1,-1,-1,-1,-1,10,2,5,2,4,5,2,0,4,-1,-1,-1,-1,-1,-1,-1,5,10,2,5,2,3,4,5,3,8,4,3,-1,-1,-1,-1,4,5,9,11,3,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,11,0,11,8,0,5,9,4,-1,-1,-1,-1,-1,-1,-1,4,5,0,5,1,0,11,3,2,-1,-1,-1,-1,-1,-1,-1,5,1,2,8,5,2,11,8,2,5,8,4,-1,-1,-1,-1,11,3,10,3,1,10,4,5,9,-1,-1,-1,-1,-1,-1,-1,5,9,4,1,8,0,1,10,8,10,11,8,-1,-1,-1,-1,0,4,5,11,0,5,10,11,5,3,0,11,-1,-1,-1,-1,8,4,5,10,8,5,11,8,10,-1,-1,-1,-1,-1,-1,-1,8,7,9,9,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,9,3,5,9,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,7,0,7,1,0,7,5,1,-1,-1,-1,-1,-1,-1,-1,3,5,1,7,5,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,7,9,7,5,9,2,1,10,-1,-1,-1,-1,-1,-1,-1,2,1,10,0,5,9,0,3,5,3,7,5,-1,-1,-1,-1,2,0,8,5,2,8,7,5,8,2,5,10,-1,-1,-1,-1,5,10,2,3,5,2,7,5,3,-1,-1,-1,-1,-1,-1,-1,5,9,7,9,8,7,2,11,3,-1,-1,-1,-1,-1,-1,-1,7,5,9,2,7,9,0,2,9,11,7,2,-1,-1,-1,-1,11,3,2,8,1,0,8,7,1,7,5,1,-1,-1,-1,-1,1,2,11,7,1,11,5,1,7,-1,-1,-1,-1,-1,-1,-1,8,5,9,7,5,8,3,1,10,11,3,10,-1,-1,-1,-1,0,7,5,9,0,5,0,11,7,10,0,1,0,10,11,-1,0,10,11,3,0,11,0,5,10,7,0,8,0,7,5,-1,5,10,11,5,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,6,10,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,0,9,6,10,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,1,8,9,1,6,10,5,-1,-1,-1,-1,-1,-1,-1,5,6,1,1,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,6,1,6,2,1,8,0,3,-1,-1,-1,-1,-1,-1,-1,5,6,9,6,0,9,6,2,0,-1,-1,-1,-1,-1,-1,-1,8,9,5,2,8,5,6,2,5,8,2,3,-1,-1,-1,-1,11,3,2,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,11,0,2,11,5,6,10,-1,-1,-1,-1,-1,-1,-1,9,1,0,11,3,2,6,10,5,-1,-1,-1,-1,-1,-1,-1,6,10,5,2,9,1,2,11,9,11,8,9,-1,-1,-1,-1,11,3,6,3,5,6,3,1,5,-1,-1,-1,-1,-1,-1,-1,11,8,0,5,11,0,1,5,0,6,11,5,-1,-1,-1,-1,6,11,3,6,3,0,5,6,0,9,5,0,-1,-1,-1,-1,9,5,6,11,9,6,8,9,11,-1,-1,-1,-1,-1,-1,-1,6,10,5,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,4,3,7,4,10,5,6,-1,-1,-1,-1,-1,-1,-1,0,9,1,6,10,5,7,4,8,-1,-1,-1,-1,-1,-1,-1,5,6,10,7,9,1,3,7,1,4,9,7,-1,-1,-1,-1,2,1,6,1,5,6,8,7,4,-1,-1,-1,-1,-1,-1,-1,5,2,1,6,2,5,4,0,3,7,4,3,-1,-1,-1,-1,7,4,8,5,0,9,5,6,0,6,2,0,-1,-1,-1,-1,9,3,7,4,9,7,9,2,3,6,9,5,9,6,2,-1,2,11,3,4,8,7,5,6,10,-1,-1,-1,-1,-1,-1,-1,6,10,5,2,7,4,0,2,4,11,7,2,-1,-1,-1,-1,9,1,0,8,7,4,11,3,2,6,10,5,-1,-1,-1,-1,1,2,9,2,11,9,11,4,9,4,11,7,6,10,5,-1,7,4,8,5,11,3,1,5,3,6,11,5,-1,-1,-1,-1,11,1,5,6,11,5,11,0,1,4,11,7,11,4,0,-1,9,5,0,5,6,0,6,3,0,3,6,11,7,4,8,-1,9,5,6,11,9,6,9,7,4,9,11,7,-1,-1,-1,-1,9,4,10,10,4,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,10,4,10,9,4,3,8,0,-1,-1,-1,-1,-1,-1,-1,1,0,10,0,6,10,0,4,6,-1,-1,-1,-1,-1,-1,-1,1,3,8,6,1,8,4,6,8,10,1,6,-1,-1,-1,-1,9,4,1,4,2,1,4,6,2,-1,-1,-1,-1,-1,-1,-1,8,0,3,9,2,1,9,4,2,4,6,2,-1,-1,-1,-1,4,2,0,6,2,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,4,2,8,6,2,4,-1,-1,-1,-1,-1,-1,-1,9,4,10,4,6,10,3,2,11,-1,-1,-1,-1,-1,-1,-1,2,8,0,11,8,2,10,9,4,6,10,4,-1,-1,-1,-1,2,11,3,6,1,0,4,6,0,10,1,6,-1,-1,-1,-1,1,4,6,10,1,6,1,8,4,11,1,2,1,11,8,-1,4,6,9,6,3,9,3,1,9,3,6,11,-1,-1,-1,-1,1,11,8,0,1,8,1,6,11,4,1,9,1,4,6,-1,6,11,3,0,6,3,4,6,0,-1,-1,-1,-1,-1,-1,-1,8,4,6,8,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,10,7,10,8,7,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,7,0,7,10,0,10,9,0,10,7,6,-1,-1,-1,-1,7,6,10,7,10,1,8,7,1,0,8,1,-1,-1,-1,-1,7,6,10,1,7,10,3,7,1,-1,-1,-1,-1,-1,-1,-1,6,2,1,8,6,1,9,8,1,7,6,8,-1,-1,-1,-1,9,6,2,1,9,2,9,7,6,3,9,0,9,3,7,-1,0,8,7,6,0,7,2,0,6,-1,-1,-1,-1,-1,-1,-1,2,3,7,2,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,3,2,8,6,10,9,8,10,7,6,8,-1,-1,-1,-1,7,0,2,11,7,2,7,9,0,10,7,6,7,10,9,-1,0,8,1,8,7,1,7,10,1,10,7,6,11,3,2,-1,1,2,11,7,1,11,1,6,10,1,7,6,-1,-1,-1,-1,6,9,8,7,6,8,6,1,9,3,6,11,6,3,1,-1,1,9,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,6,0,7,0,11,3,0,6,11,-1,-1,-1,-1,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,3,6,7,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,0,6,7,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,8,1,3,8,6,7,11,-1,-1,-1,-1,-1,-1,-1,2,1,10,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,2,1,8,0,3,7,11,6,-1,-1,-1,-1,-1,-1,-1,0,9,2,9,10,2,7,11,6,-1,-1,-1,-1,-1,-1,-1,7,11,6,3,10,2,3,8,10,8,9,10,-1,-1,-1,-1,3,2,7,7,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,7,0,6,7,0,2,6,-1,-1,-1,-1,-1,-1,-1,6,7,2,7,3,2,9,1,0,-1,-1,-1,-1,-1,-1,-1,2,6,1,6,8,1,8,9,1,6,7,8,-1,-1,-1,-1,6,7,10,7,1,10,7,3,1,-1,-1,-1,-1,-1,-1,-1,6,7,10,10,7,1,7,8,1,8,0,1,-1,-1,-1,-1,7,3,0,10,7,0,9,10,0,7,10,6,-1,-1,-1,-1,10,6,7,8,10,7,9,10,8,-1,-1,-1,-1,-1,-1,-1,4,8,6,6,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,6,3,6,0,3,6,4,0,-1,-1,-1,-1,-1,-1,-1,11,6,8,6,4,8,1,0,9,-1,-1,-1,-1,-1,-1,-1,6,4,9,3,6,9,1,3,9,6,3,11,-1,-1,-1,-1,4,8,6,8,11,6,1,10,2,-1,-1,-1,-1,-1,-1,-1,10,2,1,11,0,3,11,6,0,6,4,0,-1,-1,-1,-1,8,11,4,11,6,4,9,2,0,9,10,2,-1,-1,-1,-1,3,9,10,2,3,10,3,4,9,6,3,11,3,6,4,-1,3,2,8,2,4,8,2,6,4,-1,-1,-1,-1,-1,-1,-1,2,4,0,2,6,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,4,3,2,6,4,2,8,3,4,-1,-1,-1,-1,4,9,1,2,4,1,6,4,2,-1,-1,-1,-1,-1,-1,-1,3,1,8,1,6,8,6,4,8,1,10,6,-1,-1,-1,-1,0,1,10,6,0,10,4,0,6,-1,-1,-1,-1,-1,-1,-1,3,6,4,8,3,4,3,10,6,9,3,0,3,9,10,-1,4,9,10,4,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,9,4,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,5,9,4,6,7,11,-1,-1,-1,-1,-1,-1,-1,1,0,5,0,4,5,11,6,7,-1,-1,-1,-1,-1,-1,-1,6,7,11,4,3,8,4,5,3,5,1,3,-1,-1,-1,-1,4,5,9,2,1,10,11,6,7,-1,-1,-1,-1,-1,-1,-1,7,11,6,10,2,1,3,8,0,5,9,4,-1,-1,-1,-1,11,6,7,10,4,5,10,2,4,2,0,4,-1,-1,-1,-1,8,4,3,4,5,3,5,2,3,2,5,10,6,7,11,-1,3,2,7,2,6,7,9,4,5,-1,-1,-1,-1,-1,-1,-1,4,5,9,6,8,0,2,6,0,7,8,6,-1,-1,-1,-1,2,6,3,6,7,3,0,5,1,0,4,5,-1,-1,-1,-1,8,2,6,7,8,6,8,1,2,5,8,4,8,5,1,-1,4,5,9,6,1,10,6,7,1,7,3,1,-1,-1,-1,-1,10,6,1,6,7,1,7,0,1,0,7,8,4,5,9,-1,10,0,4,5,10,4,10,3,0,7,10,6,10,7,3,-1,10,6,7,8,10,7,10,4,5,10,8,4,-1,-1,-1,-1,5,9,6,9,11,6,9,8,11,-1,-1,-1,-1,-1,-1,-1,11,6,3,3,6,0,6,5,0,5,9,0,-1,-1,-1,-1,8,11,0,11,5,0,5,1,0,11,6,5,-1,-1,-1,-1,3,11,6,5,3,6,1,3,5,-1,-1,-1,-1,-1,-1,-1,10,2,1,11,5,9,8,11,9,6,5,11,-1,-1,-1,-1,3,11,0,11,6,0,6,9,0,9,6,5,10,2,1,-1,5,8,11,6,5,11,5,0,8,2,5,10,5,2,0,-1,3,11,6,5,3,6,3,10,2,3,5,10,-1,-1,-1,-1,9,8,5,8,2,5,2,6,5,2,8,3,-1,-1,-1,-1,6,5,9,0,6,9,2,6,0,-1,-1,-1,-1,-1,-1,-1,8,5,1,0,8,1,8,6,5,2,8,3,8,2,6,-1,6,5,1,6,1,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,3,1,10,6,1,6,8,3,9,6,5,6,9,8,-1,0,1,10,6,0,10,0,5,9,0,6,5,-1,-1,-1,-1,8,3,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,5,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,11,11,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,11,5,7,11,0,3,8,-1,-1,-1,-1,-1,-1,-1,7,11,5,11,10,5,0,9,1,-1,-1,-1,-1,-1,-1,-1,5,7,10,7,11,10,1,8,9,1,3,8,-1,-1,-1,-1,2,1,11,1,7,11,1,5,7,-1,-1,-1,-1,-1,-1,-1,3,8,0,7,2,1,5,7,1,11,2,7,-1,-1,-1,-1,5,7,9,7,2,9,2,0,9,7,11,2,-1,-1,-1,-1,2,5,7,11,2,7,2,9,5,8,2,3,2,8,9,-1,10,5,2,5,3,2,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,2,8,2,5,8,5,7,8,5,2,10,-1,-1,-1,-1,1,0,9,3,10,5,7,3,5,2,10,3,-1,-1,-1,-1,2,8,9,1,2,9,2,7,8,5,2,10,2,5,7,-1,5,3,1,5,7,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,1,7,0,5,7,1,-1,-1,-1,-1,-1,-1,-1,3,0,9,5,3,9,7,3,5,-1,-1,-1,-1,-1,-1,-1,7,8,9,7,9,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,5,8,10,5,8,11,10,-1,-1,-1,-1,-1,-1,-1,4,0,5,0,11,5,11,10,5,0,3,11,-1,-1,-1,-1,9,1,0,10,4,8,11,10,8,5,4,10,-1,-1,-1,-1,4,11,10,5,4,10,4,3,11,1,4,9,4,1,3,-1,1,5,2,5,8,2,8,11,2,8,5,4,-1,-1,-1,-1,11,4,0,3,11,0,11,5,4,1,11,2,11,1,5,-1,5,2,0,9,5,0,5,11,2,8,5,4,5,8,11,-1,5,4,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,2,2,5,3,5,4,3,4,8,3,-1,-1,-1,-1,2,10,5,4,2,5,0,2,4,-1,-1,-1,-1,-1,-1,-1,2,10,3,10,5,3,5,8,3,8,5,4,9,1,0,-1,2,10,5,4,2,5,2,9,1,2,4,9,-1,-1,-1,-1,5,4,8,3,5,8,1,5,3,-1,-1,-1,-1,-1,-1,-1,5,4,0,5,0,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,4,8,3,5,8,5,0,9,5,3,0,-1,-1,-1,-1,5,4,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,11,4,11,9,4,11,10,9,-1,-1,-1,-1,-1,-1,-1,3,8,0,7,9,4,7,11,9,11,10,9,-1,-1,-1,-1,11,10,1,4,11,1,0,4,1,11,4,7,-1,-1,-1,-1,4,1,3,8,4,3,4,10,1,11,4,7,4,11,10,-1,7,11,4,4,11,9,11,2,9,2,1,9,-1,-1,-1,-1,4,7,9,7,11,9,11,1,9,1,11,2,3,8,0,-1,4,7,11,2,4,11,0,4,2,-1,-1,-1,-1,-1,-1,-1,4,7,11,2,4,11,4,3,8,4,2,3,-1,-1,-1,-1,10,9,2,9,7,2,7,3,2,9,4,7,-1,-1,-1,-1,7,10,9,4,7,9,7,2,10,0,7,8,7,0,2,-1,10,7,3,2,10,3,10,4,7,0,10,1,10,0,4,-1,2,10,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,4,7,1,4,3,1,7,-1,-1,-1,-1,-1,-1,-1,1,9,4,7,1,4,1,8,0,1,7,8,-1,-1,-1,-1,3,0,4,3,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,10,9,8,11,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,3,11,9,3,10,9,11,-1,-1,-1,-1,-1,-1,-1,10,1,0,8,10,0,11,10,8,-1,-1,-1,-1,-1,-1,-1,10,1,3,10,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,2,1,9,11,1,8,11,9,-1,-1,-1,-1,-1,-1,-1,9,0,3,11,9,3,9,2,1,9,11,2,-1,-1,-1,-1,11,2,0,11,0,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,2,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,10,8,2,9,8,10,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,10,8,2,8,1,0,8,10,1,-1,-1,-1,-1,2,10,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),numTrisTable:new Float32Array([0,1,1,2,1,2,2,3,1,2,2,3,2,3,3,2,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,2,3,4,4,3,3,4,4,3,4,5,5,2,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,4,2,3,3,4,3,4,2,3,3,4,4,5,4,5,3,2,3,4,4,3,4,5,3,2,4,5,5,4,5,2,4,1,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,4,3,4,4,5,3,2,4,3,4,3,5,2,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,4,3,4,4,3,4,5,5,4,4,3,5,2,5,4,2,1,2,3,3,4,3,4,4,5,3,4,4,5,2,3,3,2,3,4,4,5,4,5,5,2,4,3,5,4,3,2,4,1,3,4,4,5,4,5,3,4,4,5,5,2,3,4,2,1,2,3,3,2,3,4,2,1,3,2,4,1,2,1,1,0])}}var jC=new mg,pHe=class{constructor(){this.pyramidPassScene=new Pl,this.pyramidPassMaterial=new kC({name:"PyramidPass"}),this.pyramidPassUniforms={inputTexture:{value:void 0},inputWidth:{value:0},inputHeight:{value:0},inputShiftX:{value:0},outputShiftX:{value:0}},this.pyramidTopLevelReadPixelBuffer=new Float32Array(4);let e=`
			precision highp float;
			precision highp sampler2D;
			layout(location = 0) out vec4 pc_FragColor;
			uniform sampler2D inputTexture;
			uniform float inputWidth;
			uniform float inputHeight;
			uniform float inputShiftX;
			uniform float outputShiftX;
			const vec2 half_unit_coord = vec2(0.5);
			const vec4 one = vec4(1.0);
			void main() {
				vec2 inputSize = vec2(inputWidth, inputHeight);
				vec2 input_pixel_uv = 1. / inputSize;
				vec2 coord = gl_FragCoord.xy - half_unit_coord;
				coord.x -= outputShiftX;
				coord = coord * 2. + half_unit_coord;
				coord.x += inputShiftX;

				// sample bottom left corner
				vec2 input_uv = coord / inputSize;
				float bl = texture(inputTexture, input_uv).r;

				// sample bottom right corner
				input_uv.x += input_pixel_uv.x;
				float br = texture(inputTexture, input_uv).r;

				// sample top right corner
				input_uv.y += input_pixel_uv.y;
				float tr = texture(inputTexture, input_uv).r;

				// sample top left corner
				input_uv.x -= input_pixel_uv.x;
				float tl = texture(inputTexture, input_uv).r;

				pc_FragColor.a = bl;
				pc_FragColor.b = pc_FragColor.a + br;
				pc_FragColor.g = pc_FragColor.b + tr;
				pc_FragColor.r = pc_FragColor.g + tl; 
			}
		`;this.pyramidPassMaterial.fragmentShader=e,this.pyramidPassMaterial.uniforms=this.pyramidPassUniforms,this.pyramidPassMaterial.depthTest=!1,this.pyramidPassMaterial.depthWrite=!1;let t=new fr(GA,this.pyramidPassMaterial);t.frustumCulled=!1,this.pyramidPassScene.add(t)}renderPyramid(e,t,i,n,r){new j4().min.setScalar(0);let s=t.length-1,a=new Di;i.getViewport(a),this.pyramidPassUniforms.inputShiftX.value=0,this.pyramidPassUniforms.outputShiftX.value=0;let o=s-1;for(let c=o;c>=0;c--){let u=c%2===o%2?r[0]:r[1],h=c===o?n:c%2===o%2?r[1]:r[0];this.pyramidPassUniforms.inputTexture.value=Array.isArray(h.texture)?h.texture[1]:h.texture,this.pyramidPassUniforms.inputWidth.value=h.width,this.pyramidPassUniforms.inputHeight.value=h.height,i.setRenderTarget(u);let d=t[c],p=i.getPixelRatio();i.setViewport(this.pyramidPassUniforms.outputShiftX.value/p,0,d/p,d/p),c===2&&e%2!==0&&i.setViewport(this.pyramidPassUniforms.outputShiftX.value/p,0,3/p,3/p),i.render(this.pyramidPassScene,jC);let g=this.pyramidPassUniforms.inputShiftX.value;this.pyramidPassUniforms.inputShiftX.value=this.pyramidPassUniforms.outputShiftX.value,this.pyramidPassUniforms.outputShiftX.value=g,c<o&&(this.pyramidPassUniforms.outputShiftX.value+=t[c+1])}i.setViewport(a);let l=t.length%2===0?0:1;return i.readRenderTargetPixelsAsync(r[l],r[l].width-1,0,1,1,this.pyramidTopLevelReadPixelBuffer).then(()=>this.pyramidTopLevelReadPixelBuffer[0])}},Lu=24,Na=96,Qh=fHe(),mf=2,zte=class extends Ds{constructor(e,t,i){super(e,t,i),this.data=t,this.needsRebuild=!0,this.customDepthMaterialNeedsUpdate=!1,this._npart=-1,this.spatialn=1,this.drawRangeNeedsForceUpdate=!0,this._resolutionLevel=-1,this.resolution=64,this.spatialDivisions=25,this.zLayersPerRow=8,this.basePyramidSize=512,this.pyramidTexture1Width=341,this.pyramidTexture1Height=256,this.pyramidTexture2Width=170,this.pyramidTexture2Height=128,this.numLevels=9,this.pyramidLevelSizes=[1,2,4,8,16,32,64,128,256,512],this.bboxSize=0,this.bboxOffset=0,this.shapesDataTexture={value:void 0},this.spatialscene=new Pl,this.potentialPassScene=new Pl,this.voxelPassScene=new Pl,this._spatialPassRenderTargets=[],this._potentialPassRenderTargets=[],this._voxelPassRenderTargets=[],this._pyramidRenderTargets=[],this.geometry=new ii,this.geometry.drawRange.count=0,this.spatialPassUniforms={span:{value:-1},shapesDataTexture:this.shapesDataTexture,npart:{value:this.npart},spatialn:{value:this.spatialn}},this.spatialMesh=new fr(GA,this.spatialPassMaterial()),this.spatialMesh.frustumCulled=!1,this.spatialscene.add(this.spatialMesh);let n=new Zo(Qh.triTable,16,256,OC,Zn);n.needsUpdate=!0;let r=new Zo(Qh.numTrisTable,256,1,OC,Zn);r.needsUpdate=!0,this.voxelPassUniforms={potentialPassTexture:{value:void 0},numTrisTable:{value:r}},this.voxelMesh=new fr(GA,this.voxelPassMaterial()),this.voxelMesh.frustumCulled=!1,this.voxelPassScene.add(this.voxelMesh),this.potentialPassUniforms={shapesDataTexture:this.shapesDataTexture,spatialPassTexture:{value:void 0},npart:{value:this.npart},spatialn:{value:this.spatialn}},this.potentialMesh=new fr(GA,this.potentialPassMaterial()),this.potentialMesh.frustumCulled=!1,this.potentialPassScene.add(this.potentialMesh),this.marchPassUniforms={triTable:{value:n},potentialPassTexture:{value:void 0},voxelPassTexture:{value:void 0},pyramidTexture1:{value:void 0},pyramidTexture1Size:{value:void 0},pyramidTexture2:{value:void 0},pyramidTexture2Size:{value:void 0}},this.frustumCulled=!1,this.onBeforeShadowPass=s=>{if(xHe.call(this),this.npart===0){this.geometry.drawRange.count=0;return}let a=this.material.root;if(!a.shadersPatchedForShapeBlend)this.patchVertexShaderForShapeBlend(a),a.shadersPatchedForShapeBlend=!0,this.customDepthMaterialNeedsUpdate=!0;else if(this.customDepthMaterialNeedsUpdate){this.customDepthMaterialNeedsUpdate=!1,this.customDepthMaterial=new vn({vertexShader:a.vertexShader,fragmentShader:`
						#include <packing>
						void main()
						{
							gl_FragColor = packDepthToRGBA(gl_FragCoord.z);
						}
					`,uniforms:a.uniforms,defines:this.material.defines}),this.isMeshDepthMaterial=!0,this.customDistanceMaterial=new vn({vertexShader:a.vertexShader,fragmentShader:`
					#include <common>
					#include <packing>
					uniform vec3 referencePosition;
					uniform float nearDistance;
					uniform float farDistance;
					// World-space position
					varying vec3 vWPosition;
					void main()
					{
						float dist = length(vWPosition - referencePosition);
						dist = (dist - nearDistance) / (farDistance - nearDistance);
						dist = saturate(dist);
						// Required by Three.js for this to work
						gl_FragColor = packDepthToRGBA( dist );
					}`,uniforms:{nearDistance:{value:0},farDistance:{value:0},referencePosition:{value:new G},opacity:{value:0},...a.uniforms},defines:this.material.defines});let c=this.customDistanceMaterial;c.referencePosition=new G,c.nearDistance=0,c.farDistance=0,c.opacity=1,c.isMeshDistanceMaterial=!0}if(this.spatialPassUniforms.npart.value=this.npart,this.spatialPassUniforms.spatialn.value=this.spatialn,this.potentialPassUniforms.npart.value=this.npart,this.potentialPassUniforms.spatialn.value=this.spatialn,this.needsRebuild){this.needsRebuild=!1,this.spatialMesh.material.defines.RES=this.resolutionLevel,this.spatialMesh.material.needsUpdate=!0,this.potentialMesh.material.defines.RES=this.resolutionLevel,this.potentialPassUniforms.spatialPassTexture.value=this.spatialPassRenderTarget.texture,this.potentialMesh.material.needsUpdate=!0,this.voxelMesh.material.defines.RES=this.resolutionLevel,this.voxelMesh.material.needsUpdate=!0,this.voxelPassUniforms.potentialPassTexture.value=this.potentialPassRenderTarget.texture,this.marchPassUniforms.potentialPassTexture.value=this.potentialPassRenderTarget.texture,this.marchPassUniforms.voxelPassTexture.value=this.voxelPassRenderTarget.texture[0],this.material.defines.RES=this.resolutionLevel,this.material.defines.LEVELS=this.pyramidLevelSizes.length,this.material.defines.LOOP=this.pyramidLevelSizes.length%2===0?this.pyramidLevelSizes.length-3:this.pyramidLevelSizes.length-2,this.material.defines.HALF=this.pyramidLevelSizes.length%2===0?1:0,this.material.needsUpdate=!0;let c=this.pyramidLevelSizes.length%2===0?0:1,u=this.pyramidLevelSizes.length%2===0?1:0;this.marchPassUniforms.pyramidTexture2.value=this.pyramidRenderTarget[c].texture,this.marchPassUniforms.pyramidTexture2Size.value=new Ae(this.pyramidRenderTarget[c].width,this.pyramidRenderTarget[c].height),this.marchPassUniforms.pyramidTexture1.value=this.pyramidRenderTarget[u].texture,this.marchPassUniforms.pyramidTexture1Size.value=new Ae(this.pyramidRenderTarget[u].width,this.pyramidRenderTarget[u].height),Object.assign(this.material.uniforms,this.marchPassUniforms)}let o=s.shadowMap.enabled;s.shadowMap.enabled=!1;let l=s.getRenderTarget();s.setRenderTarget(this.spatialPassRenderTarget),s.render(this.spatialscene,jC),s.setRenderTarget(this.potentialPassRenderTarget),s.render(this.potentialPassScene,jC),s.setRenderTarget(this.voxelPassRenderTarget),s.render(this.voxelPassScene,jC),zte.streamCompaction.renderPyramid(this.resolutionLevel,this.pyramidLevelSizes,s,this.voxelPassRenderTarget,this.pyramidRenderTarget).then(c=>{this.material.wireframe&&(c*3>this.geometry.attributes.position.count||this.drawRangeNeedsForceUpdate)&&(this.geometry.dispose(),this.geometry=new ii,this.geometry.userData.parameters={width:this.bboxSize,height:this.bboxSize,depth:this.bboxSize,centerOffset:[this.bboxOffset,this.bboxOffset,this.bboxOffset]},this.geometry.attributes.position=new vi(new Float32Array(c*3*2),3)),(c*3>this.geometry.drawRange.count||this.drawRangeNeedsForceUpdate)&&(this.geometry.drawRange.count=Math.floor(c*1.2)*3),this.drawRangeNeedsForceUpdate=!1}),s.shadowMap.enabled=o,s.setRenderTarget(l)}}set npart(e){e!==this._npart&&(this.drawRangeNeedsForceUpdate=!0,this._npart=e,this.spatialn=Math.ceil(e/(4*Lu)))}get npart(){return this._npart}set resolutionLevel(e){let t=Math.min(8,Math.max(5,e));if(t!==this._resolutionLevel){switch(this._resolutionLevel=t,this.resolution=Math.pow(2,t),this.resolutionLevel){case 5:this.pyramidLevelSizes=[1,2,4,6,12,24,48,96,192],this.bboxSize=31*8*mf,this.bboxOffset=8*mf*-1/2;break;case 6:this.pyramidLevelSizes=[1,2,4,8,16,32,64,128,256,512],this.bboxSize=63*4*mf,this.bboxOffset=4*mf*-1/2;break;case 7:this.pyramidLevelSizes=[1,2,4,6,12,24,48,96,192,384,768,1536],this.bboxSize=127*2*mf,this.bboxOffset=2*mf*-1/2;break;case 8:this.pyramidLevelSizes=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096],this.bboxSize=255*mf,this.bboxOffset=mf*-1/2;break}this.pyramidTexture1Width=0,this.pyramidTexture2Width=0,this.pyramidTexture1Height=this.pyramidLevelSizes[this.pyramidLevelSizes.length-2],this.pyramidTexture2Height=this.pyramidLevelSizes[this.pyramidLevelSizes.length-3];for(let i=this.pyramidLevelSizes.length-2;i>=0;i--)(this.pyramidLevelSizes.length-2)%2===i%2?this.pyramidTexture1Width+=this.pyramidLevelSizes[i]:this.pyramidTexture2Width+=this.pyramidLevelSizes[i];this.basePyramidSize=this.pyramidLevelSizes[this.pyramidLevelSizes.length-1],this.zLayersPerRow=this.basePyramidSize/this.resolution,this.numLevels=this.pyramidLevelSizes.length-1,this.geometry.userData.parameters={width:this.bboxSize,height:this.bboxSize,depth:this.bboxSize,centerOffset:[this.bboxOffset,this.bboxOffset,this.bboxOffset]},this.needsRebuild=!0}}get resolutionLevel(){return this._resolutionLevel}get spatialPassRenderTarget(){let e=this._spatialPassRenderTargets[this.resolutionLevel];return e||(e=new mn(this.spatialDivisions*this.spatialn,this.spatialDivisions**2,{format:Rr,type:Zn,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1,minFilter:rn,magFilter:rn}),this._spatialPassRenderTargets[this.resolutionLevel]=e),e}get potentialPassRenderTarget(){let e=this._potentialPassRenderTargets[this.resolutionLevel];return e||(e=new mn(this.basePyramidSize,this.basePyramidSize,{format:Rr,type:Zn,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1,minFilter:rn,magFilter:rn}),this._potentialPassRenderTargets[this.resolutionLevel]=e),e}get voxelPassRenderTarget(){let e=this._voxelPassRenderTargets[this.resolutionLevel];return e||(e=new QJ(this.basePyramidSize,this.basePyramidSize,2,{stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1,minFilter:rn,magFilter:rn}),e.texture[0].format=Rr,e.texture[0].type=Zn,e.texture[1].format=OC,e.texture[1].type=Zn,this._voxelPassRenderTargets[this.resolutionLevel]=e),e}get pyramidRenderTarget(){let e=this._pyramidRenderTargets[this.resolutionLevel];if(!e){let t=new mn(this.pyramidTexture1Width,this.pyramidTexture1Height,{format:Rr,type:Zn,stencilBuffer:!1,depthBuffer:!1,magFilter:rn,minFilter:rn}),i=new mn(this.pyramidTexture2Width,this.pyramidTexture2Height,{format:Rr,type:Zn,stencilBuffer:!1,depthBuffer:!1,magFilter:rn,minFilter:rn});e=[t,i],this._pyramidRenderTargets[this.resolutionLevel]=e}return e}updateState(e,t){let i=this.material;super.updateState(e,t),i!==this.material&&(this.needsRebuild=!0),e.geometry&&(this.resolutionLevel=e.geometry.resolutionLevel,this.geometry.userData.parameters={width:this.bboxSize,height:this.bboxSize,depth:this.bboxSize,centerOffset:[this.bboxOffset,this.bboxOffset,this.bboxOffset]}),e.wireframe&&!this.geometry.getAttribute("position")?this.geometry.setAttribute("position",new vi(new Float32Array(this.geometry.drawRange.count*3),3)):!e.wireframe&&this.geometry.getAttribute("position")&&this.geometry.deleteAttribute("position")}spatialPassMaterial(){let e=`
			precision highp float;
			out vec4 pc_FragColor;
			const float spatialDivisions = ${this.spatialDivisions}.;
			uniform float span;
			uniform float npart;
			uniform float spatialn;
			${Qh.shapeInput()}

			vec3 low, high;     // range of current div; subset of -1 .. 1 with span border

			// lookup one element/channel's worth of spheres for current division
			// stating with low sphere number lowi
			// gives a key to which spheres from lowi..lowi+23 are active within given div (low..high)
			float spatialKey(float lowi) {
				float t = 0.;
				for (float ii = ${Lu-1}.; ii >= 0.; ii--) {
					float i = ii + lowi;
					float iin = (i + 0.5) / ${Na}.;
					vec4 shape = shapePos(iin);
					vec3 d = shape.xyz;
					float op = shape.w;
	
					t *= 2.;
					t += (
						low.x < d.x && d.x < high.x &&
						low.y < d.y && d.y < high.y &&
						low.z < d.z && d.z < high.z &&
						i < npart || op == -2. // always include if op is -2, which is the intersection operation
					) ? 1. : 0.;
				}
				return t;
			}

			${Qh.getpart}

			void main() {               // spatialial fragment shader
				// find active div
				vec3 div;                               // which div is current
				// out holds x=> x, lowi faster moving and y=> z, y faster moving
				float yz = float(gl_FragCoord.y - 0.5);     // contains  z, y faster moving
				div.y = getpart(yz, spatialDivisions);
				div.z = yz; // getpart(yz, spatialDivisions.z); // what's left, should be the same as getpart

				float lx = float(gl_FragCoord.x - 0.5);     // contains x, lowi faster moving
				float lowi = getpart(lx, spatialn) * ${4*Lu}.;
				div.x = lx;

				low = div / spatialDivisions * 2. - 1. - span;
				high = (div+1.) / spatialDivisions * 2. - 1. + span;

				// find active range of spheres
				pc_FragColor.x = spatialKey(lowi);
				pc_FragColor.y = spatialKey(lowi+${Lu}.);
				pc_FragColor.z = spatialKey(lowi+${2*Lu}.);
				pc_FragColor.w = spatialKey(lowi+${3*Lu}.);
			}
		`;return new kC({name:"Spatial Pass",fragmentShader:e,uniforms:this.spatialPassUniforms})}potentialPassMaterial(){let e=`
			precision highp float;
			out vec4 pc_FragColor;

			${Qh.shapeInput()}
			uniform sampler2D spatialPassTexture;

			const float res = float(RES);
			const float VOXEL_RESOLUTION = pow(2., res);
			const float Z_LAYERS_PER_ROW = ceil(pow(2., res / 2.));
			const float VOXEL_RESOLUTION_SUB1 = VOXEL_RESOLUTION - 1.;
			const float INV_VOXEL_RESOLUTION = 1.0 / VOXEL_RESOLUTION;

			uniform float npart;
			uniform float spatialn;
			const float spatialDivisions = ${this.spatialDivisions}.;
			const float spatialDivisions2 = spatialDivisions * spatialDivisions;
			const float spatialDivisionsSub1 = spatialDivisions - 1.;

			${Qh.getpart}

			vec3 packRGBAToVec3(vec4 color) {
				uint r = uint(color.r * 255.);
				uint g = uint(color.g * 255.);
				uint combined = (r << 8) | g; 
				return vec3(float(combined) * 0.00001525902, color.b, color.a); // 1/65535
			}

			void applyQuaternionToVector(in vec4 q, inout vec3 v) {
				v += 2.0 * cross(q.xyz, cross(q.xyz, v) + q.w * v);
			}

			/**
			 * SDF functions (reference: https://iquilezles.org/articles/distfunctions/)
			 */

			// branchless version of "Smooth Union, Subtraction and Intersection - bound, bound, bound" in above reference
			float smoothOperation(float op, float sdf, float d, float k) {
			  //        union: op =  1 => signSubtract =  1, signIntersection =  1
			  //     subtract: op = -1 => signSubtract = -1, signIntersection =  1
				// intersection: op = -2 => signSubtract = -1, signIntersection = -1

				float signSubtract = clamp(op, -1., 1.);
				float signIntersection = 2. * (op - signSubtract) + 1.;
				float h = clamp(
					0.5 + signSubtract * 0.5 * (sdf - signSubtract * signIntersection * d) / k,
					0.0,
					1.0
				);
				return mix(sdf, signSubtract * signIntersection * d, h) - 
							 signSubtract * k * h * (1.0 - h);
			}

			float sdSphere( vec3 p, float s )
			{
				return length(p)-s;
			}

			float sdEllipsoid( vec3 p, vec3 r )
			{
				float k0 = length(p/r);
				float k1 = length(p/(r*r));
				return k0*(k0-1.0)/k1;
			}

			float sdBox( vec3 p, vec3 b )
			{
				vec3 q = abs(p) - b;
				return length(max(q,0.0)) + min(max(q.x,max(q.y,q.z)),0.0);
			}

			float sdTorus( vec3 p, vec2 t )
			{
				vec2 q = vec2(length(p.xy)-t.x,p.z);
				return length(q)-t.y;
			}

			float sdCappedTorus( vec3 p, vec2 sc, float ra, float rb)
			{
				p.x = abs(p.x);
				float k = (sc.y*p.x>sc.x*p.y) ? dot(p.xy,sc) : length(p.xy);
				return sqrt( dot(p,p) + ra*ra - 2.0*ra*k ) - rb;
			}

			float dot2( in vec2 v ) { return dot(v,v); }
			float sdCappedCone( vec3 p, float h, float r1, float r2 )
			{
				vec2 q = vec2( length(p.xz), p.y );
				vec2 k1 = vec2(r2,h);
				vec2 k2 = vec2(r2-r1,2.0*h);
				vec2 ca = vec2(q.x-min(q.x,(q.y<0.0)?r1:r2), abs(q.y)-h);
				vec2 cb = q - k1 + k2*clamp( dot(k1-q,k2)/dot2(k2), 0.0, 1.0 );
				float s = (cb.x<0.0 && ca.y<0.0) ? -1.0 : 1.0;
				return s*sqrt( min(dot2(ca),dot2(cb)) );
			}

			float sdCappedCylinder( vec3 p, float h, float r )
			{
				vec2 d = abs(vec2(length(p.xz),p.y)) - vec2(r,h);
				return min(max(d.x,d.y),0.0) + length(max(d,0.0));
			}

			float maxBlend = 0.0;
			// compute potential from A (=24) spheres, using the bit flags in 'activeKey'
			// to avoid lookup/compute for inactive spheres
			// return field potential, side effect updates track,
			// compute and return +ve and -ve values separately
			void fillSpatialInner(
				float ii,
				float activeKey,
				vec3 corner,
				inout float sdf,
				inout float colorDivisor,
				inout vec4 trackColor
			) {
				for (float i = 0.; i < ${Lu}.; i++) {
					if (activeKey < 1.) break; // activeKey exhausted, no more active spheres
					activeKey *= 0.5;
					if (fract(activeKey) < 0.5) continue;

					float iin = (i + ii + 0.5) * ${1/Na};
					vec4 shape = shapePos(iin);
					vec4 quat = shapeQuat(iin);
					vec4 params1 = shapeParams1(iin);
					vec4 params2 = shapeParams2(iin);

					vec3 p = corner - shape.xyz;
					applyQuaternionToVector(quat, p);
					p /= params2.z; // scale
					float d; // d in -1..1 coordinates
					switch (int(params1.x)) {
						case 0: d = sdSphere(p, params1.y); break;
						case 1: d = sdEllipsoid(p, params1.yzw); break;
						case 2: d = sdBox(p, params1.yzw); break;
						case 3: d = sdCappedCylinder(p, params1.y, params1.z); break;
						case 4: d = sdCappedCone(p, params1.y, params1.z, params1.w); break;
						case 5: d = sdTorus(p, params1.yz); break;
						case 6: d = sdCappedTorus(p, params1.yz, params1.w, params2.w); break;
					}
					d -= params2.y; // rounded edge
					d *= params2.z; // scale

					float k = params2.x;
					float op = shape.w;

					sdf = smoothOperation(shape.w, sdf, d, k);

					float isNegativeOne = step(-1.5, op) * step(op, -0.5); // 1 when op == -1, 0 otherwise
					float colorCull = smoothstep(maxBlend, 0., -d);
					float cullFactor = mix(1.0, colorCull, isNegativeOne);
					trackColor *= cullFactor;
					colorDivisor *= cullFactor;

					maxBlend = max(maxBlend, k);

					k += 2. * INV_VOXEL_RESOLUTION; // avoid division by zero, and other color artifacts with very small k
					float nearness = smoothstep(k, 0., d);

					vec4 color = shapeColor(iin);
					nearness *= float(color.a >= 0.);

					colorDivisor += nearness;
					trackColor += color * nearness;
				}
			}

			vec3 div;
			// compute potential from all spheres; collect +ve and =ve values separately
			// work in blocks of A*4 (=96) spheres, using the bit flags in 4 float channel 'activeKey' values
			// TODO check if extra vec3 output useful, not really used at present
			float fillSpatial(vec3 corner, inout vec4 trackColor) {
				float sdf = 1e3; // hack: initialize to large value
				float colorDivisor = 0.;
				// spatialPassTexture holds x=> lowi, x faster moving and y=> z, y faster moving
				float divyz = (div.y + div.z * spatialDivisions + 0.5) / (spatialDivisions2);
				for (float ii = 0.; ii < spatialn; ii++) {
					float i = ii * ${4*Lu}.;

					vec4 activeKey = texture(spatialPassTexture, vec2((div.x * spatialn + ii + 0.5)/(spatialn * spatialDivisions), divyz));
					fillSpatialInner(i, activeKey.x, corner, sdf, colorDivisor, trackColor);
					fillSpatialInner(i+${Lu}., activeKey.y, corner, sdf, colorDivisor, trackColor);
					fillSpatialInner(i+${2*Lu}., activeKey.z, corner, sdf, colorDivisor, trackColor);
					fillSpatialInner(i+${3*Lu}., activeKey.w, corner, sdf, colorDivisor, trackColor);
				}

				trackColor /= colorDivisor;
				return mix(sdf, 0.0, step(1e20 - 0.1, sdf));
			}

			void main() {
				${Qh.getxyzi}    // get xi yi zi from 2d position

				vec3 xyzi = vec3(xi,yi,zi);
				vec3 corner = xyzi / VOXEL_RESOLUTION_SUB1 * 2. - 1.;  // -1..1 coords

				div = floor(xyzi / VOXEL_RESOLUTION_SUB1 * spatialDivisionsSub1);

				vec4 c = vec4(0.);
				float t = fillSpatial(corner, c);

				pc_FragColor = vec4(t, packRGBAToVec3(c)); // RGB texture
			}
		`;return new kC({name:"PotentialPass",fragmentShader:e,uniforms:this.potentialPassUniforms})}voxelPassMaterial(){let e=`
			precision highp float;
			layout(location = 0) out vec4 pc_FragColor;
			layout(location = 1) out vec4 numTris;

			const float res = float(RES);
			const float VOXEL_RESOLUTION = pow(2., res);
			const float VOXEL_RESOLUTION_SUB1 = VOXEL_RESOLUTION - 1.; 
			const float Z_LAYERS_PER_ROW = ceil(pow(2., res / 2.));
			const float INV_VOXEL_RESOLUTION = 1.0 / VOXEL_RESOLUTION;
			uniform sampler2D numTrisTable; // 256 x 1

			float keyi(float f000, float f100, float f010, float f110, float f001, float f101, float f011, float f111) {
				return (float(f000 < 0.) * 1.) +
							 (float(f100 < 0.) * 2.) +
							 (float(f010 < 0.) * 8.) +
							 (float(f110 < 0.) * 4.) +
							 (float(f001 < 0.) * 16.) +
							 (float(f101 < 0.) * 32.) +
							 (float(f011 < 0.) * 128.) +
							 (float(f111 < 0.) * 64.);
			}

			${Qh.lookup}

			vec3 compNormi(float xi, float yi, float zi) {
				float dx = look(xi + 1., yi, zi, potentialPassTexture).r - look(xi - 1., yi, zi, potentialPassTexture).r;
				float dy = look(xi, yi + 1., zi, potentialPassTexture).r - look(xi, yi - 1., zi, potentialPassTexture).r;
				float dz = look(xi, yi, zi + 1., potentialPassTexture).r - look(xi, yi, zi - 1., potentialPassTexture).r;
				// if we allow (common) 0,0,0 case through then NaN can spread
				// eg r = vec4(compNorm i(???), 1.) will pollute r.w
				if (dx == 0.0 && dy == 0.0 && dz == 0.0) {
					return vec3(0.199, 0.299, 0.399);
				}
				return normalize(vec3(dx, dy, dz));
			}

			void main() {
				${Qh.getxyzi}    // get xi yi zi from 2d

				vec3 normal = compNormi(xi, yi, zi);  // even if our key is -1 this may be needed by a neighbouring voxel

				if (xi >= VOXEL_RESOLUTION_SUB1 || yi >= VOXEL_RESOLUTION_SUB1 || zi >= VOXEL_RESOLUTION_SUB1) {
					pc_FragColor = vec4(normal, 0.);
					numTris = vec4(0.);
					return;
				}

				float
					f000 = look(xi, yi, zi, potentialPassTexture).r,
					f100 = look(xi+1., yi, zi, potentialPassTexture).r,
					f010 = look(xi, yi+1., zi, potentialPassTexture).r,
					f110 = look(xi+1., yi+1., zi, potentialPassTexture).r,
					f001 = look(xi, yi, zi+1., potentialPassTexture).r,
					f101 = look(xi+1., yi, zi+1., potentialPassTexture).r,
					f011 = look(xi, yi+1., zi+1., potentialPassTexture).r,
					f111 = look(xi+1., yi+1., zi+1., potentialPassTexture).r;
				float key = keyi(f000, f100, f010, f110, f001, f101, f011, f111);

				pc_FragColor = vec4(normal, key);

				numTris = texture(numTrisTable, vec2((key + 0.5) / 256., 0.5));
			}
		`;return new kC({name:"VoxelPass",fragmentShader:e,uniforms:this.voxelPassUniforms})}patchVertexShaderForShapeBlend(e){let t=`
		#ifdef SHAPEBLEND 
			precision highp sampler2D;

			uniform float isol;

			uniform sampler2D triTable;     // 256 x 16
			uniform sampler2D pyramidTexture1;
			uniform vec2 pyramidTexture1Size;
			uniform sampler2D pyramidTexture2;
			uniform vec2 pyramidTexture2Size;

			const vec2 halfPixelOffset = vec2(0.5, 0.5);

			const vec2 rShift = vec2(0., 1.);
			const vec2 gShift = vec2(1., 1.);
			const vec2 bShift = vec2(1., 0.);

			const float res = float(RES);
			const float VOXEL_RESOLUTION = pow(2., res);
			const float Z_LAYERS_PER_ROW = ceil(pow(2., res / 2.));
			const float INV_VOXEL_RESOLUTION = 1.0 / VOXEL_RESOLUTION;

			const float scale_factor = ${mf}.;

			#if SHAPEBLEND == 5
				const float levelShiftX[7] = float[7](4., 6., 12., 24., 48., 96., 192.);
				const float scale = 8. * scale_factor;
				const vec3 originOffset = vec3(16.);
			#elif SHAPEBLEND == 7
				const float levelShiftX[10] = float[10](4., 6., 12., 24., 48., 96., 192., 384., 768., 1536.); 
				const float scale = 2. * scale_factor;
				const vec3 originOffset = vec3(64.);
			#elif SHAPEBLEND == 8
				const float levelShiftX[11] = float[11](4., 8., 16., 32., 64., 128., 256., 512., 1024., 2048., 4096.);
				const float scale = scale_factor;
				const vec3 originOffset = vec3(128.);
			#else
				const float levelShiftX[8] = float[8](4., 8., 16., 32., 64., 128., 256., 512.);
				const float scale = 4. * scale_factor;
				const vec3 originOffset = vec3(32.);
			#endif

			${Qh.lookup}

			const vec3 offsets[24] = vec3[](
				vec3(0., 0., 0.), vec3(1., 0., 0.),
				vec3(1., 0., 0.), vec3(1., 1., 0.),
				vec3(0., 1., 0.), vec3(1., 1., 0.),
				vec3(0., 0., 0.), vec3(0., 1., 0.),
				vec3(0., 0., 1.), vec3(1., 0., 1.),
				vec3(1., 0., 1.), vec3(1., 1., 1.),
				vec3(0., 1., 1.), vec3(1., 1., 1.),
				vec3(0., 0., 1.), vec3(0., 1., 1.),
				vec3(0., 0., 0.), vec3(0., 0., 1.),
				vec3(1., 0., 0.), vec3(1., 0., 1.),
				vec3(1., 1., 0.), vec3(1., 1., 1.),
				vec3(0., 1., 0.), vec3(0., 1., 1.)
			);

			vec2 computeShiftedPosition1(vec2 xy, float levelOriginX) {
				vec2 xyShifted = xy;
				xyShifted.x += levelOriginX;
				return (xyShifted + halfPixelOffset) / pyramidTexture1Size;
			}

			vec2 computeShiftedPosition2(vec2 xy, float levelOriginX) {
				vec2 xyShifted = xy;
				xyShifted.x += levelOriginX;
				return (xyShifted + halfPixelOffset) / pyramidTexture2Size;
			}

			vec4 unpackVec3ToRGBA(vec3 vec) {
				uint combined = uint(vec.x * 65535.0 + 0.5); // Add 0.5 for rounding
				float g = float(combined & uint(0xFF)) * 0.00392156862; // 1/255
				float r = float((combined >> 8) & uint(0xFF)) * 0.00392156862; 
		
				return vec4(r, g, vec.y, vec.z);
			}

			out vec4 marchColor;
			// end of marchvertPre
		#endif
		`,i=`
		#ifdef SHAPEBLEND
			float triIndex = floor(float(gl_VertexID/3));
			float vertexIndex = float(gl_VertexID);
			
			// Initial pyramid lookup
			float levelOriginX1 = pyramidTexture1Size.x - 2.;
			float levelOriginX2 = pyramidTexture2Size.x - 1.;
			vec2 xy = vec2(0.);
			vec4 lookUp = texture(pyramidTexture2, computeShiftedPosition2(xy, levelOriginX2));
			
			// Early exit check
			if (triIndex >= lookUp.r) return;
			
			// Optimize loop variables
			float start = 0.;
			vec4 triIndexVec = vec4(triIndex);
			
			// Main position computation loop
			for (int i = 0; i < LOOP;) {
				// Compute boundaries
				vec4 ends = lookUp + vec4(start);
				vec4 starts = vec4(ends.gba, start);
				vec4 check = vec4(greaterThanEqual(triIndexVec, starts)) * 
											vec4(lessThan(triIndexVec, ends));
				
				// Update position
				xy *= 2.;
				xy += check.r * rShift + check.g * gShift + check.b * bShift;
				
				// Update loop variables
				start = dot(check, starts);
				levelOriginX2 -= levelShiftX[i];
				
				// Update lookup
				lookUp = texture(pyramidTexture1, computeShiftedPosition1(xy, levelOriginX1));
				i++;

				ends = lookUp + vec4(start);
				starts = vec4(ends.gba, start);
				check = vec4(greaterThanEqual(triIndexVec, starts)) * 
											vec4(lessThan(triIndexVec, ends));
				
				// Update position
				xy *= 2.;
				xy += check.r * rShift + check.g * gShift + check.b * bShift;
				
				// Update loop variables
				start = dot(check, starts);
				levelOriginX1 -= levelShiftX[i];
				
				// Update lookup
				lookUp = texture(pyramidTexture2, computeShiftedPosition2(xy, levelOriginX2));

				i++;
			}

			#if HALF == 1
				vec4 ends = lookUp + vec4(start);
				vec4 starts = vec4(ends.gba, start);
				vec4 check = vec4(greaterThanEqual(triIndexVec, starts)) * vec4(lessThan(triIndexVec, ends));
			
				// Update position
				xy *= 2.;
				xy += check.r * rShift + check.g * gShift + check.b * bShift;
			
				// Update loop variables
				start = dot(check, starts);
			#endif
			
			// Compute final coordinates
			vec3 gridPos;
			gridPos.x = mod(xy.x, VOXEL_RESOLUTION);
			gridPos.y = mod(xy.y, VOXEL_RESOLUTION);
			gridPos.z = floor(xy.x * INV_VOXEL_RESOLUTION) + 
									floor(xy.y * INV_VOXEL_RESOLUTION) * Z_LAYERS_PER_ROW;
			
			// Vertex key computation
			vertexIndex -= start * 3.;
			float vk = vertexIndex * 0.0625 + 0.03125; // Optimized division by 16 and addition of 1/32
			
			// Voxel lookup and edge computation
			vec4 voxel = look(gridPos.x, gridPos.y, gridPos.z, voxelPassTexture);
			float key = (voxel.w + 0.5) * 0.00390625; // Optimized division by 256
			
			// Edge lookup and offset computation
			float edgeNum = texture(triTable, vec2(vk, key)).x;
			int edgeIndex = int(edgeNum) * 2;
			
			// Compute edge positions
			vec3 p1 = gridPos + offsets[edgeIndex];
			vec3 p2 = gridPos + offsets[edgeIndex + 1];
			
			// Compute potentials and normals
			vec4 potential1 = look(p1.x, p1.y, p1.z, potentialPassTexture);
			vec4 potential2 = look(p2.x, p2.y, p2.z, potentialPassTexture);
			
			// Final position and normal computation
			float mu = potential1.r / (potential1.r - potential2.r);

			marchColor = mix(
				unpackVec3ToRGBA(potential1.gba),
				unpackVec3ToRGBA(potential2.gba),
				mu
			);

			transformed = p1 + (p2 - p1) * mu;
			transformed -= originOffset;
			transformed *= scale;
			vec4 data1 = look(p1.x, p1.y, p1.z, voxelPassTexture);
			vec4 data2 = look(p2.x, p2.y, p2.z, voxelPassTexture);
			objectNormal = normalize(mix(data1.xyz, data2.xyz, mu));
			transformedNormal = normalMatrix * objectNormal;
			#ifndef FLAT_SHADED
				vNormal = transformedNormal;
			#endif
		#endif
		`;e.vertexShader=t+e.vertexShader.replace("#include <project_vertex>",i+`
#include <project_vertex>`);let n=e.fragmentShader.match(/vec3 diffuseColor[^\n]*\n/);if(!n)return;let r=`
		#ifdef SHAPEBLEND_C
			#if SHAPEBLEND_C == 1
				${n[0].replace(/nodeU0,/g,"marchColor.rgb,").replace(/nodeU\d+(?=,g_uid\d+_calpha\))/g,"marchColor.a")}
			#else
				${n[0]}
			#endif
		#else
			${n[0]}
		#endif
		`;e.fragmentShader=`in vec4 marchColor;
`+e.fragmentShader.replace(n[0],r),Object.assign(e.uniforms,this.marchPassUniforms)}initDebugPass(e){console.log("fboToDebug.width",e.width,e.height),this.geometry=new Ad(e.width,e.height),this.geometry.userData={parameters:{width:4,height:4}};let t={inputTexture:{value:Array.isArray(e.texture)?e.texture[1]:e.texture},pyramidTextureSize:{value:void 0}},i=n=>{n.vertexShader=`
				precision highp float;

				varying vec2 vUv;

				void main() {
						gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
						vUv = uv;
				}
			`,n.fragmentShader=`
				layout(location = 1) out vec4 gVelocity;

				precision highp float;
				
				uniform sampler2D inputTexture;
				varying vec2 vUv;

				uniform vec2 pyramidTextureSize;

				void main() {
						// Sample the input texture using UV coordinates
						gl_FragColor = texture(inputTexture, vUv);
						gVelocity = vec4(0.0);
				}
			`,t.pyramidTextureSize.value=new Ae(this.pyramidRenderTarget.width,this.pyramidRenderTarget.height),Object.assign(n.uniforms,t)};this.material.shapeBlendhack=i,this.material.root.shapeBlendhack=i}},H0=zte;H0.streamCompaction=new pHe;var mHe=new Bt,gHe=new Bt,qx=new Ei,bm=new G,dC=new G,vHe=new Ei;function yHe(e,t=0){let i=this.children.length;for(;i--;){let n=this.children[i];z0.is(n)&&Fte.call(n,e,t+1)}}function Fte(e,t=0){if(e(this,t)!==!0){let i=this.children.length;for(;i--;){let n=this.children[i];z0.is(n)&&Fte.call(n,e,t+1)}}}function xHe(){if(this.shapesDataTexture.value===void 0){let a=new Zo(new Float32Array(4*Na*Kv),Na,Kv,Rr,Zn);this.shapesDataTexture.value=a}let e=this.shapesDataTexture.value,t=e.image.data;e.needsUpdate=!0;let i=0,n=this.data.geometry.blendRange,r=mHe.copy(this.matrixWorld).invert(),s=0;yHe.call(this,a=>{var b;if(a.visible===!1)return!0;let o;if(a instanceof Wc||a instanceof VA||a instanceof HA)return;a instanceof qa?o=a.object:o=a;let l=(b=a.data)==null?void 0:b.cloner;if(dn.is(a)&&l&&!l.hideBase&&l.type!=="radial"&&l.disabled!==!0||!(o instanceof Ds))return;let c=o.geometry.userData.parameters,u=c.shapeBlendNode;if(u===void 0)return;if(gHe.multiplyMatrices(r,a.matrixWorld).decompose(dC,qx,bm),c.type==="TorusGeometry"&&c.arc!==360){let A=c.arc*Math.PI/180;A=A/4,qx.multiply(vHe.set(0,0,Math.sin(A),Math.cos(A)))}let h=u.overrideGlobalBlend?u.blendRange:n;h=h/this.bboxSize*2,t[s*4]=(dC.x-this.bboxOffset)/this.bboxSize*2,t[s*4+1]=(dC.y-this.bboxOffset)/this.bboxSize*2,t[s*4+2]=(dC.z-this.bboxOffset)/this.bboxSize*2,t[s*4+3]=u.operation===0?1:u.operation===2?-1:-2,t[Na*4+s*4]=-qx.x,t[Na*4+s*4+1]=-qx.y,t[Na*4+s*4+2]=-qx.z,t[Na*4+s*4+3]=qx.w;let d=new Float32Array(4),p=0;if(c.type==="SphereGeometry")c.width===c.height&&c.width===c.depth?d[0]=0:d[0]=1,d[1]=c.width/this.bboxSize,d[2]=c.height/this.bboxSize,d[3]=c.depth/this.bboxSize,i=Math.max(i,d[1]*bm.x+h,d[2]*bm.x+h,d[3]*bm.x+h);else if(c.type==="CubeGeometry"){p=c.cornerRadius;let A=c.width,w=c.height,E=c.depth;d[0]=2,d[1]=(A-2*p)/this.bboxSize,d[2]=(w-2*p)/this.bboxSize,d[3]=(E-2*p)/this.bboxSize,i=Math.max(i,Math.sqrt(A**2+w**2+E**2)/this.bboxSize*bm.x+h)}else if(c.type==="CylinderGeometry"){p=c.cornerRadius;let A=c.height,w=c.radiusBottom,E=c.radiusTop;if(E>=w){let D=Math.atan2(E-w,A),T=(Math.PI/2-D)/2;E-=p/Math.tan(T),w-=p*Math.tan(T)}else if(w>E){let D=Math.atan2(w-E,A),T=(Math.PI/2-D)/2;E-=p*Math.tan(T),w-=p/Math.tan(T)}d[1]=(c.height-2*p)/this.bboxSize,w===E?(d[0]=3,d[2]=w/this.bboxSize*2):(d[0]=4,d[2]=w/this.bboxSize*2,d[3]=E/this.bboxSize*2),i=Math.max(i,d[1]*4*bm.x+h)}else if(c.type==="TorusGeometry"){if(d[0]=5,d[1]=(c.width-c.depth)/this.bboxSize,d[2]=c.depth/this.bboxSize,c.arc!==360){d[0]=6,d[3]=d[1],t[Na*12+s*4+3]=d[2];let A=2*Math.atan2(d[2]/2,d[1]),w=c.arc*Math.PI/180/2-A;d[1]=Math.sin(w),d[2]=Math.cos(w)}i=Math.max(i,c.width*bm.x/this.bboxSize+h)}t.set(d,Na*8+s*4),t[Na*12+s*4]=h,t[Na*12+s*4+1]=p/this.bboxSize*2,t[Na*12+s*4+2]=bm.x;let g=o.material,x=g.uniforms.nodeU0.node.value,y=g.uniforms.nodeU1.value;u.operation!==0&&!u.useColor&&(y=-1),t[Na*16+s*4]=x.r,t[Na*16+s*4+1]=x.g,t[Na*16+s*4+2]=x.b,t[Na*16+s*4+3]=y,y<1&&this.material.defines.SHAPEBLEND_C===1&&(this.material.transparent=!0),s++}),this.npart=s,this.spatialPassUniforms.span.value=i*1.4}var Vte=512;function eX(e,t){let i=!1,n=e.layers.mask&Vte,r=t.getLayersOfType("transmission"),s=t.getLayersOfType("outline");return s.length>0&&(e.layers.set(8),r.length>0&&e.layers.enable(3),i=!0,N5(e),U5(e)),r.length===0&&s.length===0&&e.layers.set(0),n&&e.layers.set(9),e instanceof Gb&&e.needsAO&&e.layers.enable(5),i}function tX(e,t){if(!t.layers)return!1;let i=e.layers.mask&Vte,n=!1,r=t.getLayersOfType("transmission").filter(a=>a.data.visible),s=t.getLayersOfType("outline").filter(a=>a.data.visible);return r.length>0&&(e.layers.set(3),s.length>0&&e.layers.enable(8),n=!0),r.length===0&&s.length===0&&e.layers.set(0),i&&e.layers.set(9),e.needsAO&&e.layers.enable(5),n}function bHe(e){let t=!1;return e.traverseEntity(i=>{if(i instanceof Gb)if(Array.isArray(i.material))for(let n=0;n<i.material.length;n++)eX(i,i.material[n])&&(t=!0);else eX(i,i.material)&&(t=!0)}),t}function SHe(e){let t=!1;return e.traverseEntity(i=>{if(i instanceof Gb)if(Array.isArray(i.material))for(let n=0;n<i.material.length;n++)tX(i,i.material[n])&&(t=!0);else tX(i,i.material)&&(t=!0)}),t}var _He=new MZ,AHe=new Bt,wHe=new Cb;function Mz(e,t,i,n=!1){let r=e.cloner;if(r)for(let s of r.children){let a=AHe.copy(s.matrixWorld).invert(),o=wHe.copy(t.ray).applyMatrix4(a),l=e.matrixWorld;o.applyMatrix4(l);let c=_He;c.set(o.origin,o.direction),c.near=t.near,c.far=t.far;let u=c.intersectObject(e,!1);u.length>0&&i.push({...u[0],object:n?s:e})}}var MHe=class{constructor(){this._constraints=new Map}setConstraint(e,t){t===null?this._constraints.delete(e):this._constraints.set(e,t)}removeDependencies(e){this._constraints.delete(e)}applyConstraints(e){let t=new Set;this._constraints.forEach((i,n)=>{let r=[n,i],s=i;for(;this._constraints.has(s);){if(s=this._constraints.get(s),r.includes(s)){console.warn(`circular dependency detected: ${r.join(" -> ")}`);break}t.has(s)||r.push(s)}for(let a=r.length-2;a>=0;a--)if(!t.has(r[a])){let o=e.find(r[a]);o?o.applyPathSnapping(e):console.warn(`missing entity ${r[a]}`),t.add(r[a])}})}findDependency(e,t){let i=e;for(;this._constraints.has(i);)if(i=this._constraints.get(i),i===t)return!0;return!1}},EHe="AGFzbQEAAAAADwhkeWxpbmsuMAEEAAAAAAETA2AAAGAIf39/f39/f38AYAABfwISAQNlbnYGbWVtb3J5AgMAgIAEAwQDAAECBzkDEV9fd2FzbV9jYWxsX2N0b3JzAAALc29ydEluZGV4ZXMAARNlbXNjcmlwdGVuX3Rsc19pbml0AAIK3gMDAwABC9IDAwF/BnwBfgJAIAdFDQAgAysDUCEMIAMrAzAhDSADKwMQIQ5BACEDRP///////+9/IQtEAAAAAAAAEAAhCgNAIAIgA0ECdGoCfyAOIAEgA0EMbGoiCCoCALuiIA0gCCoCBLuioCAMIAgqAgi7oqBEAAAAAAAAsECiIgmZRAAAAAAAAOBBYwRAIAmqDAELQYCAgIB4CzYCACAJIAsgCSALYxshCyAJIAogCSAKZBshCiADQQFqIgMgB0cNAAsgB0UNACAGuCAKIAuhoyEJQQAhAwNAAn8gCSACIANBAnRqIgEoAgC3IAuhoiIKmUQAAAAAAADgQWMEQCAKqgwBC0GAgICAeAshCCABIAg2AgAgBCAIQQJ0aiIBIAEoAgBBAWo2AgAgA0EBaiIDIAdHDQALCyAGQQJPBEAgBCgCACEIQQEhAwNAIAQgA0ECdGoiASABKAIAIAhqIgg2AgAgA0EBaiIDIAZHDQALCyAHQQFrIgGtIQ8DQCAEIAIgD6dBAnQiA2ooAgBBAnRqIgcgBygCAEEBayIHNgIAIAUgASAHa0ECdGogACADaigCADYCACAPUCEDIA9CAX0hDyADRQ0ACyAGBEAgBEEAIAZBAnT8CwALCwQAQQAL",km=class{};sA(km,"DepthMapRange",65536),sA(km,"MemoryPageSize",65536),sA(km,"BytesPerFloat",4),sA(km,"BytesPerInt",4);function THe(e){let t,i,n,r,s,a,o,l,c,u,h,d,p,g,x,y;function b(U){let H=new Float64Array(u,a,16);for(let j=0;j<16;j++)H[j]=U[j];let V;if(n>1){t.exports.sortIndexes(r,s,c,a,o,l,d.DepthMapRange,n);let j=new Uint32Array(n);V=j.buffer,j.set(new Uint32Array(u,l,n))}else if(n===1){let j=new Uint32Array(n);j[0]=new Uint32Array(u,r,i)[0],V=j.buffer}else V=new ArrayBuffer(0);e.postMessage({sortDone:!0,indexesBuffer:V},[V])}function A(U,H,V){let j=new Float32Array(u,s,i*3);n=0;let J=new Uint32Array(u,r,i);for(let F=0;F<V.length-1;F++){let X=H[F],W=U[F].elements,ne=X.filter($=>$.enabled&&$.mode==="Include").map($=>$.type==="Box"?T($):O($)),Y=X.filter($=>$.enabled&&$.mode==="Exclude").map($=>$.type==="Box"?T($):O($));for(let $=V[F];$<V[F+1];$++){let se=p[$*3],fe=p[$*3+1],te=p[$*3+2];if((ne.length===0||E(se,fe,te,ne))&&(Y.length===0||!E(se,fe,te,Y))){let de=1/(W[3]*se+W[7]*fe+W[11]*te+W[15]);j[n*3]=(W[0]*se+W[4]*fe+W[8]*te+W[12])*de,j[n*3+1]=(W[1]*se+W[5]*fe+W[9]*te+W[13])*de,j[n*3+2]=(W[2]*se+W[6]*fe+W[10]*te+W[14])*de,J[n]=$,n++}}}}function w(U,H){let V=[],j=H.filter(X=>X.enabled&&X.mode==="Include").map(X=>X.type==="Box"?T(X):O(X)),J=H.filter(X=>X.enabled&&X.mode==="Exclude").map(X=>X.type==="Box"?T(X):O(X)),F=U.length;for(let X=0;X<F;X+=3){let W=U[X],ne=U[X+1],Y=U[X+2];(j.length===0||E(W,ne,Y,j))&&(J.length===0||!E(W,ne,Y,J))||V.push(X/3)}return V}function E(U,H,V,j,J){return j[J==="Intersect"?"every":"some"](F=>{let X=D(U,H,V,F.invRotationMatrix,F.cropCenter);return Array.isArray(F)?R(X.x,X.y,X.z,F):P(X.x,X.y,X.z,F)})}function D(U,H,V,j,J){let F=U-J[0],X=H-J[1],W=V-J[2],ne=1/(j[3]*F+j[7]*X+j[11]*W+j[15]);return{x:(j[0]*F+j[4]*X+j[8]*W+j[12])*ne+J[0],y:(j[1]*F+j[5]*X+j[9]*W+j[13])*ne+J[1],z:(j[2]*F+j[6]*X+j[10]*W+j[14])*ne+J[2]}}function T(U){let H=U.cropSize[0]/2,V=U.cropSize[1]/2,j=U.cropSize[2]/2,J=[U.cropCenter[0]-H,U.cropCenter[1]-V,U.cropCenter[2]-j,U.cropCenter[0]+H,U.cropCenter[1]+V,U.cropCenter[2]+j],F=I(U.cropRotation);return Object.assign(J,{invRotationMatrix:F,cropCenter:U.cropCenter})}function I(U){let H=[],V=U[0]*Math.PI/180,j=U[1]*Math.PI/180,J=U[2]*Math.PI/180,F=Math.cos(V),X=Math.sin(V),W=Math.cos(j),ne=Math.sin(j),Y=Math.cos(J),$=Math.sin(J),se=F*Y,fe=F*$,te=X*Y,de=X*$;return H[0]=W*Y,H[1]=-W*$,H[2]=ne,H[4]=fe+te*ne,H[5]=se-de*ne,H[6]=-X*W,H[8]=de-se*ne,H[9]=te+fe*ne,H[10]=F*W,H[12]=0,H[13]=0,H[14]=0,H[3]=0,H[7]=0,H[11]=0,H[15]=1,H}function R(U,H,V,j){return U>=j[0]&&U<=j[3]&&H>=j[1]&&H<=j[4]&&V>=j[2]&&V<=j[5]}function O(U){let H=2/U.cropSize[0],V=2/U.cropSize[1],j=2/U.cropSize[2],J=I(U.cropRotation);return{invRadiusX:H,invRadiusY:V,invRadiusZ:j,cropCenter:U.cropCenter,invRotationMatrix:J}}function P(U,H,V,j){let J=(U-j.cropCenter[0])*j.invRadiusX,F=(H-j.cropCenter[1])*j.invRadiusY,X=(V-j.cropCenter[2])*j.invRadiusZ;return J*J+F*F+X*X<=1}e.onmessage=U=>{if(U.data.getCroppedIndexes){let H=new Uint32Array(w(new Float32Array(U.data.positions),U.data.crops)).buffer;e.postMessage({outOfBoundsIndexes:H},[H])}else if(U.data.positions)h=U.data.positions,p=new Float32Array(h),x=U.data.meshMatrixWorlds,y=U.data.cropsArray,g=U.data.meshIndexIntervals,A(x,y,g),e.postMessage({sortSetupComplete:!0});else if(U.data.sort||U.data.newMatrixWorlds||U.data.newCropsArray)(U.data.newMatrixWorlds||U.data.newCropsArray)&&(y=U.data.newCropsArray||y,x=U.data.newMatrixWorlds||x,A(x,y,g)),b(U.data.sort.view,U.data.sort.cameraPosition);else if(U.data.init){d=U.data.init.Constants,i=U.data.init.splatCount;let H=d.BytesPerInt,V=d.BytesPerFloat*3,j=new Uint8Array(U.data.init.sorterWasmBytes),J=H+V,F=i*J,X=i*d.BytesPerInt*2+d.DepthMapRange*d.BytesPerInt*2,W=d.MemoryPageSize*32,ne=F+X+W,Y=Math.floor(ne/d.MemoryPageSize)+1,$={module:{},env:{memory:new WebAssembly.Memory({initial:Y*2,maximum:Y*3,shared:!0})}};WebAssembly.compile(j).then(se=>WebAssembly.instantiate(se,$)).then(se=>{t=se,r=0,s=i*H,a=s+i*V,c=a+16*d.BytesPerFloat*2,o=c+i*d.BytesPerInt,l=o+d.DepthMapRange*d.BytesPerInt,u=$.env.memory.buffer,e.postMessage({sortSetupPhase1Complete:!0})})}}}function CHe(e){let t=new Worker(URL.createObjectURL(new Blob(["(",THe.toString(),")(self)"],{type:"application/javascript"}))),i=atob(EHe),n=new Uint8Array(i.length);for(let r=0;r<i.length;r++)n[r]=i.charCodeAt(r);return t.postMessage({init:{sorterWasmBytes:n.buffer,splatCount:e,Constants:{BytesPerFloat:km.BytesPerFloat,BytesPerInt:km.BytesPerInt,DepthMapRange:km.DepthMapRange,MemoryPageSize:km.MemoryPageSize}}}),t}var vL=function(){let e=new Float32Array(1),t=new Int32Array(e.buffer);return function(i){return e[0]=i,t[0]}}(),DHe=function(e,t,i,n){return e+(t<<8)+(i<<16)+(n<<24)},fC=new Ae;function iX(e){let t=!1;return e.scene.objects.traverse((i,n)=>{if(n.visible===!1)return!0;n.type==="Splat"&&(t=!0)}),t}var WC=class extends fr{constructor(e,t,i,n,r=!1,s=1,a,o){super(i,n),this.splatCount=t,this.meshIndexIntervals=a,this.meshMatrixWorlds=o,this.splatBuffers=e,this.geometry=i,this.material=n,this.splatDataTextures=null,this.halfPrecisionCovariancesOnGPU=r,this.devicePixelRatio=s,this.resetLocalSplatDataAndTexturesFromSplatBuffer()}static buildMesh(e,t,i=!1,n=1,r,s){let a=WC.buildGeomtery(t),o=WC.buildMaterial(r);return new WC(e,t,a,o,i,n,r,s)}static buildMaterial(e){let t=`
            precision highp float;
            #include <common>

            attribute uint splatIndex;

            uniform highp sampler2D covariancesTexture;
            uniform highp usampler2D centersColorsTexture;
            uniform vec2 focal;
            uniform vec2 viewport;
            uniform vec2 basisViewport;
            uniform vec2 covariancesTextureSize;
            uniform vec2 centersColorsTextureSize;
						uniform highp sampler2D meshMatrixWorldsTexture;
						uniform uint meshIndexIntervals[257];
						uniform float orthoZoom;

            varying vec4 vColor;
            varying vec2 vUv;

            varying vec2 vPosition;

            const vec4 encodeNorm4 = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0);
            const uvec4 mask4 = uvec4(uint(0x000000FF), uint(0x0000FF00), uint(0x00FF0000), uint(0xFF000000));
            const uvec4 shift4 = uvec4(0, 8, 16, 24);
            vec4 uintToRGBAVec (uint u) {
               uvec4 urgba = mask4 & u;
               urgba = urgba >> shift4;
               vec4 rgba = vec4(urgba) * encodeNorm4;
               return rgba;
            }

            vec2 getDataUV(in int stride, in int offset, in vec2 dimensions) {
                vec2 samplerUV = vec2(0.0, 0.0);
                float d = float(splatIndex * uint(stride) + uint(offset)) / dimensions.x;
                samplerUV.y = float(floor(d)) / dimensions.y;
                samplerUV.x = fract(d);
                return samplerUV;
            }

            void main () {
                uvec4 sampledCenterColor = texture(centersColorsTexture, getDataUV(1, 0, centersColorsTextureSize));
                vec3 splatCenter = uintBitsToFloat(uvec3(sampledCenterColor.gba));
                vColor = uintToRGBAVec(sampledCenterColor.r);

                vPosition = position.xy * 2.0;

								uint meshIndex;
								for (int i = 1; i < 257; i++) {
									if (splatIndex < meshIndexIntervals[i]) {
										meshIndex = uint(i - 1);
										break;
									}
								}

								float strideMulmeshIndex = float(4u*meshIndex);
								float meshMatrixWorldsTextureLength = float(256*4);

								mat4 modelMat = mat4(
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+0.0)/meshMatrixWorldsTextureLength, 0)),
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+1.0)/meshMatrixWorldsTextureLength, 0)),
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+2.0)/meshMatrixWorldsTextureLength, 0)),
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+3.0)/meshMatrixWorldsTextureLength, 0))
								);
								mat4 modelViewMat = viewMatrix * modelMat;
								vec4 viewCenter = modelViewMat * vec4(splatCenter, 1.0); 
                vec4 clipCenter = projectionMatrix * viewCenter;

                vec2 sampledCovarianceA = texture(covariancesTexture, getDataUV(3, 0, covariancesTextureSize)).rg;
                vec2 sampledCovarianceB = texture(covariancesTexture, getDataUV(3, 1, covariancesTextureSize)).rg;
                vec2 sampledCovarianceC = texture(covariancesTexture, getDataUV(3, 2, covariancesTextureSize)).rg;

                vec3 cov3D_M11_M12_M13 = vec3(sampledCovarianceA.rg, sampledCovarianceB.r);
                vec3 cov3D_M22_M23_M33 = vec3(sampledCovarianceB.g, sampledCovarianceC.rg);

                // Compute the 2D covariance matrix from the upper-right portion of the 3D covariance matrix
                mat3 Vrk = mat3(
                    cov3D_M11_M12_M13.x, cov3D_M11_M12_M13.y, cov3D_M11_M12_M13.z,
                    cov3D_M11_M12_M13.y, cov3D_M22_M23_M33.x, cov3D_M22_M23_M33.y,
                    cov3D_M11_M12_M13.z, cov3D_M22_M23_M33.y, cov3D_M22_M23_M33.z
                );
                float s = 1.0 / (viewCenter.z * viewCenter.z);

                mat3 W = transpose(mat3(modelViewMat));
                mat3 T = orthoZoom > 0.0 ? W : W * mat3(
									focal.x / viewCenter.z, 0., -(focal.x * viewCenter.x) * s,
									0., focal.y / viewCenter.z, -(focal.y * viewCenter.y) * s,
									0., 0., 0.
								);
                mat3 cov2Dm = transpose(T) * Vrk * T;
                cov2Dm[0][0] += 0.3;
                cov2Dm[1][1] += 0.3;

                // We are interested in the upper-left 2x2 portion of the projected 3D covariance matrix because
                // we only care about the X and Y values. We want the X-diagonal, cov2Dm[0][0],
                // the Y-diagonal, cov2Dm[1][1], and the correlation between the two cov2Dm[0][1]. We don't
                // need cov2Dm[1][0] because it is a symetric matrix.
                vec3 cov2Dv = vec3(cov2Dm[0][0], cov2Dm[0][1], cov2Dm[1][1]);

                vec3 ndcCenter = clipCenter.xyz / clipCenter.w;

                // We now need to solve for the eigen-values and eigen vectors of the 2D covariance matrix
                // so that we can determine the 2D basis for the splat. This is done using the method described
                // here: https://people.math.harvard.edu/~knill/teaching/math21b2004/exhibits/2dmatrices/index.html
                //
                // This is a different approach than in the original work at INRIA. In that work they compute the
                // max extents of the 2D covariance matrix in screen space to form an axis aligned bounding rectangle
                // which forms the geometry that is actually rasterized. They then use the inverse 2D covariance
                // matrix (called 'conic') to determine fragment opacity.
                float a = cov2Dv.x;
                float d = cov2Dv.z;
                float b = cov2Dv.y;
                float D = a * d - b * b;
                float trace = a + d;
                float traceOver2 = 0.5 * trace;
                float term2 = sqrt(trace * trace / 4.0 - D);
                float eigenValue1 = traceOver2 + term2;
								float eigenValue2 = max(traceOver2 - term2, 0.00); // prevent negative eigen value

                const float maxSplatSize = 1024.0;
                vec2 eigenVector1 = normalize(vec2(b, eigenValue1 - a));
                // since the eigen vectors are orthogonal, we derive the second one from the first
                vec2 eigenVector2 = vec2(eigenVector1.y, -eigenVector1.x);
                vec2 basisVector1 = eigenVector1 * min(sqrt(2.0 * eigenValue1), maxSplatSize);
                vec2 basisVector2 = eigenVector2 * min(sqrt(2.0 * eigenValue2), maxSplatSize);

                vec2 ndcOffset = vec2(vPosition.x * basisVector1 + vPosition.y * basisVector2) * basisViewport;

								if (orthoZoom > 0.0) {
									ndcOffset *= orthoZoom;
								}

                gl_Position = vec4(ndcCenter.xy + ndcOffset, ndcCenter.z, 1.0);
            }`,i=`
            precision highp float;
            #include <common>

            uniform vec3 debugColor;

            varying vec4 vColor;
            varying vec2 vUv;

            varying vec2 vPosition;
						layout(location = 1) out vec4 gVelocity; 

            void main () {
                // compute the negative squared distance from the center of the splat to the
                // current fragment in the splat's local space.
                float A = -dot(vPosition, vPosition);
                if (A < -4.0) discard;
                vec3 color = vColor.rgb;
                A = exp(A) * vColor.a;
                gl_FragColor = vec4(color.rgb, A);
								gVelocity = vec4(0.0); // so it is ignored by TAA
            }`,n={covariancesTexture:{type:"t",value:null},centersColorsTexture:{type:"t",value:null},meshIndexIntervals:{value:e},meshMatrixWorldsTexture:{type:"t",value:null},focal:{type:"v2",value:new Ae},viewport:{type:"v2",value:new Ae},basisViewport:{type:"v2",value:new Ae},debugColor:{type:"v3",value:new gi},covariancesTextureSize:{type:"v2",value:new Ae(1024,1024)},centersColorsTextureSize:{type:"v2",value:new Ae(1024,1024)},orthoZoom:{type:"f",value:-1}};return new vn({uniforms:n,vertexShader:t,fragmentShader:i,transparent:!0,alphaTest:1,blending:x0,depthTest:!0,depthWrite:!1,side:yo})}static buildGeomtery(e){let t=new ii;t.setIndex([0,1,2,0,2,3]);let i=new Float32Array(4*3),n=new vi(i,3);t.setAttribute("position",n),n.setXYZ(0,-1,-1,0),n.setXYZ(1,-1,1,0),n.setXYZ(2,1,1,0),n.setXYZ(3,1,-1,0),n.needsUpdate=!0;let r=new AZ().copy(t),s=new Uint32Array(e),a=new mw(s,1,!1);return a.setUsage(sbe),r.setAttribute("splatIndex",a),r.instanceCount=e,r}resetLocalSplatDataAndTexturesFromSplatBuffer(){this.updateLocalSplatDataFromSplatBuffer(),this.allocateAndStoreLocalSplatDataInTextures()}updateLocalSplatDataFromSplatBuffer(){this.splatBuffers.forEach(n=>n.buildPreComputedBuffers()),this.covariances=new Float32Array(this.splatCount*6),this.colors=new Uint8Array(this.splatCount*4),this.centers=new Float32Array(this.splatCount*3);let e=0,t=0,i=0;for(let n of this.splatBuffers){let r=n.nsplats;this.colors.subarray(e,e+r*4).set(n.colorsA),e+=r*4,this.centers.subarray(t,t+r*3).set(n.decoded.xyz.denormDequant().data),t+=r*3,this.covariances.subarray(i,i+r*6).set(new Float32Array(n.precomputedCovarianceBufferData)),i+=r*6}}allocateAndStoreLocalSplatDataInTextures(){let e=this.splatCount,t=new Ae(4096,1024);for(;t.x*t.y*2<e*6;)t.y*=2;let i=new Ae(4096,1024);for(;i.x*i.y*4<e*4;)i.y*=2;let n,r;if(this.halfPrecisionCovariancesOnGPU){r=new Uint16Array(t.x*t.y*2);for(let u=0;u<this.covariances.length;u++)r[u]=UEe.toHalfFloat(this.covariances[u]);n=new Zo(r,t.x,t.y,QD,ip)}else r=new Float32Array(t.x*t.y*2),r.set(this.covariances),n=new Zo(r,t.x,t.y,QD,Zn);n.needsUpdate=!0,this.material.uniforms.covariancesTexture.value=n,this.material.uniforms.covariancesTextureSize.value.copy(t);let s=new Uint32Array(i.x*i.y*4);for(let u=0;u<e;u++){let h=u*4,d=u*3,p=u*4;s[p]=DHe(this.colors[h],this.colors[h+1],this.colors[h+2],this.colors[h+3]),s[p+1]=vL(this.centers[d]),s[p+2]=vL(this.centers[d+1]),s[p+3]=vL(this.centers[d+2])}let a=new Zo(s,i.x,i.y,FJ,Ff);a.internalFormat="RGBA32UI",a.needsUpdate=!0,this.material.uniforms.centersColorsTexture.value=a,this.material.uniforms.centersColorsTextureSize.value.copy(i);let o=256*4,l=new Float32Array(256*16);for(let u=0;u<this.meshMatrixWorlds.length;u++)l.set(this.meshMatrixWorlds[u].elements,u*16);let c=new Zo(l,o,1,Rr,Zn);c.needsUpdate=!0,this.material.uniforms.meshMatrixWorldsTexture.value=c,this.material.uniformsNeedUpdate=!0,this.splatDataTextures={covariances:{data:r,texture:n,size:t},centerColors:{data:s,texture:a,size:i},meshMatrixWorlds:{data:l,texture:c}}}updateIndexes(e){let t=this.geometry;t.attributes.splatIndex.set(e),t.attributes.splatIndex.needsUpdate=!0,t.instanceCount=e.length}updateUniforms(e,t,i,n){this.splatCount>0&&(fC.set(e.x*this.devicePixelRatio,e.y*this.devicePixelRatio),this.material.uniforms.viewport.value.copy(fC),this.material.uniforms.basisViewport.value.set(2/fC.x,2/fC.y),this.material.uniforms.focal.value.set(t,i),this.material.uniforms.orthoZoom.value=n,this.material.uniformsNeedUpdate=!0)}getSplatDataTextures(){return this.splatDataTextures}getSplatCount(){return this.splatCount}getCenters(){return this.centers}getColors(){return this.colors}getCovariances(){return this.covariances}dispose(){this.geometry.dispose(),this.material.dispose(),this.splatDataTextures&&(this.splatDataTextures.covariances.texture.dispose(),this.splatDataTextures.centerColors.texture.dispose(),this.splatDataTextures.meshMatrixWorlds.texture.dispose()),this.removeFromParent()}},Hte,RHe=new Promise(e=>{Hte=e}),nX=!1,pC;function PHe(){if(nX)return;if(pC)return pC;async function e(){let t=await dg(()=>import("./gaussian-splat-compression-BblNKJdU.js"),[]);Hte(t),nX=!0}return pC=e(),pC}var Gte;RHe.then(e=>Gte=e);var OHe=class{constructor(e={}){sA(this,"updateView",function(){let t=new Bt,i=[],n=new G(0,0,-1),r=new G(0,0,-1),s=new G,a=new G;return function(o=!1,l){let c=this.updateMatrixWorldsInWorkerIfNeeded(),u=this.cropsChanged();if(!o){r.set(0,0,-1).applyQuaternion(l.quaternion);let d=!1,p=!1;if(r.dot(n)<=.95&&(d=!0),a.copy(l.position).sub(s).length()>=1&&(p=!0),!d&&!p&&!c&&!u&&!this.needsInitialRender)return}this.needsInitialRender=!1,s.copy(l.position),n.copy(r),t.copy(l.matrixWorld).invert(),t.premultiply(this.dummyPerspectiveMatrix),i[0]=l.position.x,i[1]=l.position.y,i[2]=l.position.z;let h={sort:{view:t.elements,cameraPosition:i,splatRenderCount:this.splatRenderCount,splatSortCount:this.splatRenderCount},...c?{newMatrixWorlds:this.meshMatrixWorlds}:{},...u?{newCropsArray:this.cropsArray}:{}};this.sortRunning?this.queuedMessage=h:(this.queuedMessage=null,this.sortRunning=!0,this.sortWorker.postMessage(h))}}()),this.scene=e.scene,this.currentPage=null,this.devicePixelRatio=window.devicePixelRatio,this.sortWorker=null,this.splatRenderCount=0,this.splatSortCount=0,this.splatMesh=null,this.sortRunning=!1,this.meshMatrixWorlds=null,this.meshMatrixWorldsOld=null,this.cropsArray=null,this.splatEntries=null,this.queuedMessage=null,this.needsInitialRender=!0,this.dummyPerspectiveMatrix=new Bt().makePerspective(-1,1,-1,1,.1,1e3)}updateSplatMeshUniforms(e,t){let i=new Ae;this.splatMesh!==null&&this.splatMesh.getSplatCount()>0&&(e.getSize(i),this.cameraFocalLengthX=t.projectionMatrix.elements[0]*this.devicePixelRatio*i.x*.45,this.cameraFocalLengthY=t.projectionMatrix.elements[5]*this.devicePixelRatio*i.y*.45,this.splatMesh.updateUniforms(i,this.cameraFocalLengthX,this.cameraFocalLengthY,t.isPerspectiveCamera?-1:t.zoom*this.devicePixelRatio))}loadSplat(e={}){this.activePage=this.scene.activePage,e.position&&(e.position=new G().fromArray(e.position)),e.orientation&&(e.orientation=new Ei().fromArray(e.orientation)),e.halfPrecisionCovariances=!!e.halfPrecisionCovariances;let t=[];if(this.splatEntries=t,this.activePage.traverseVisibleEntity(s=>{s.data.type==="Splat"&&t.push(s)}),this.splatMesh&&this.splatMesh.dispose(),t.length===0)return this.splatMesh=null,!1;this.meshMatrixWorlds=t.map(s=>s.matrixWorld),this.meshMatrixWorldsOld=t.map(s=>s.matrixWorld.clone()),this.cropsArray=t.map(s=>s.data.crops.map(a=>a.data));let i=t.map(s=>new Gte.GSplineBuffer(new Uint8Array(s.data.buffer).buffer)),n=0,r=[0];for(let s of i)n+=s.getSplatCount(),r.push(n);return this.setupSplatMesh(i,n,e.position,e.orientation,e.halfPrecisionCovariances,this.devicePixelRatio,r,this.meshMatrixWorlds),this.setupSortWorker(n),!0}updateMatrixWorldsInWorkerIfNeeded(){let e=this.splatDataTextures.meshMatrixWorlds.data;for(let t=0;t<this.meshMatrixWorlds.length;t++)e.set(this.meshMatrixWorlds[t].elements,t*16);return this.splatDataTextures.meshMatrixWorlds.texture.needsUpdate=!0,this.meshMatrixWorlds.every((t,i)=>t.equals(this.meshMatrixWorldsOld[i]))?!1:(this.meshMatrixWorldsOld=this.meshMatrixWorlds.map(t=>t.clone()),!0)}cropsChanged(){let e=!1;return this.splatEntries.forEach((t,i)=>{var n;t.data.crops.forEach((r,s)=>{this.cropsArray[i][s]===void 0?(e=!0,this.cropsArray[i][s]=r.data):Object.entries(r.data).forEach(([a,o])=>{var l;Array.isArray(o)&&o.some((c,u)=>c!==this.cropsArray[i][s][a][u])?(e=!0,this.cropsArray[i][s][a]=o):o!==((l=this.cropsArray[i][s])==null?void 0:l[a])&&(e=!0,this.cropsArray[i][s][a]=o)})}),t.data.crops.length!==((n=this.cropsArray[i])==null?void 0:n.length)&&(this.cropsArray[i].length=t.data.crops.length,e=!0)}),e}setupSplatMesh(e,t,i=new G,n=new Ei,r=!1,s=1,a,o){this.splatMesh=WC.buildMesh(e,t,r,s,a,o),this.splatMesh.position.copy(i),this.splatMesh.quaternion.copy(n),this.splatMesh.frustumCulled=!1,this.splatMesh.renderOrder=99999,this.splatRenderCount=t,this.splatMesh.onBeforeRender=(l,c,u)=>this.update(l,u)}setupSortWorker(e){this.sortWorker=CHe(e),this.sortWorker.onmessage=t=>{var i;t.data.sortDone?(this.sortRunning=!1,(i=this.splatMesh)==null||i.updateIndexes(new Uint32Array(t.data.indexesBuffer)),this.lastSortTime=t.data.sortTime,this.queuedMessage&&(this.sortWorker.postMessage(this.queuedMessage),this.queuedMessage=null)):t.data.sortCanceled?this.sortRunning=!1:t.data.sortSetupPhase1Complete?this.sortWorker.postMessage({positions:this.splatMesh.getCenters().buffer,meshMatrixWorlds:this.splatMesh.meshMatrixWorlds,meshIndexIntervals:this.splatMesh.meshIndexIntervals,cropsArray:this.cropsArray}):t.data.sortSetupComplete&&(this.splatDataTextures=this.splatMesh.getSplatDataTextures(),this.scene.activePage.add(this.splatMesh),this.needsInitialRender=!0)}}update(e,t){this.splatMesh!==null&&(this.updateSplatMeshUniforms(e,t),this.updateView(!1,t))}getSplatMesh(){return this.splatMesh}},Ez=new np;Ez.wireframe=!0;var rX=new G,Q5=class extends Pl{constructor(e,t){super(),this.data=e,this.sharedAssets=t,this.enableHelpers=!1,this.wireframeState=!1,this.needsTransmissionDirty=!0,this.needsNormalDirty=!0,this._needsTransmission=!1,this._needsNormal=!1,this.geometryCacheChanged=!1,this.splatViewer=null,this.shapeBlendIntances=[],this.entityByUuid={},this.entityIdentityToEntity={},this.toExpandCloner=new Set,this.toUpdateCloner=new Set,this.pendingCommands=[],this.pathConstraints=new MHe,this.invisibleObjects=new L1("jflkdsafjasdifjaslk",{...BN.defaultData,visible:!1,name:"buildin invisible"}),this.needsRecomputeInstances=!1,this.init(e,t),this.matrixAutoUpdate=!1,this.errorPage=new fa("fdasfa",{...ub.defaultData,name:""},{shared:t,scene:this})}markGeometryCacheDirty(){this.geometryCacheChanged=!0}markNeedsUpdateRendererDirty(){this.needsTransmissionDirty=!0,this.needsNormalDirty=!0}needsTransmission(){return this.needsTransmissionDirty&&(this._needsTransmission=SHe(this),this.needsTransmissionDirty=!1),this._needsTransmission}needsNormal(){return this.needsNormalDirty&&(this._needsNormal=bHe(this),this.needsNormalDirty=!1),this._needsNormal}registerInstanceAndSetUuid(e){let t=e.identity.join("-"),i=this.entityIdentityToEntity[t];i&&(e.uuid=i.uuid),this.entityIdentityToEntity[t]=e,this.entityByUuid[e.uuid]=e}markPenumbraSizeDirty(){for(let e of this.children)e instanceof fa&&(e.penumbraSizeArrayCache=null)}findInstance(e){return this.entityIdentityToEntity[e.join("-")]}get bgColor(){return this.activePage.bgColor}get postprocessing(){return this.activePage.data.postprocessing}getWithSortKey(e){let t=this.find(e);if(t===void 0)return;let i=[],n=t;for(;n!==this;){let r=n;n=n.parent;let s=n.children.indexOf(r);i.splice(0,0,s)}return{entity:t,sortKey:i}}getAllSorted(e){let t=[];for(let i of e){let n=this.getWithSortKey(i.id);n!==void 0&&t.push(n)}return t.sort((i,n)=>h$(i.sortKey,n.sortKey)),t.map(i=>i.entity)}nonExistOrDescendantOf(e,t){let i=this.find(e);if(i===void 0)return!0;for(;i;){if(i.uuid===t)return!0;i=i.parent}return!1}find(e){if(this.activePage&&this.activePage.personalCamera.parent){if(e==="f23858d0-4a3b-4bd8-8173-66ed0af7f6fb-personalCamera")return this.activePage.personalCamera;if(e===Fb)return this.activePage.personalCamera}if(e===""||e===void 0)return;let t=this.entityByUuid[e];return t===void 0?this.getObjectByProperty("uuid",e):t}find2D(e){for(let t of this.children)if(t instanceof fa&&t.uiScene){let i=t.uiScene.find(e);if(i)return i}}findScene2DfromObject2D(e){for(let t of this.children)if(t instanceof fa&&t.uiScene&&t.uiScene.find(e))return t.uiScene}find2DInUIObjects(e){let t;return this.traverseEntity(i=>{t===void 0&&i instanceof mo&&(t=i.uiCanvas.find(e))}),t}traverse2D(e){for(let t of this.children)t instanceof fa&&t.uiScene&&t.uiScene.traverse(e)}debugEnsureEntity(e){let t=this.find(e);if(t){if(Array.isArray(t.identity)&&this.findInstance(t.identity)===void 0){console.error("not found instance");debugger}}else{console.error("not found");debugger}}addPendingExpandCloner(e){this.toExpandCloner.add(e)}addPendingUpdateCloner(e){this.toUpdateCloner.add(e)}markToExpandCloner(e){this.toExpandCloner.add(e),e.traverseEntityAncestors(t=>{this.toExpandCloner.add(t)})}doPendingExpandCloner(){this.toExpandCloner.forEach(e=>{e.expandCloner(this)}),this.toExpandCloner.clear()}doPendingUpdateCloner(){this.toUpdateCloner.forEach(e=>{var t;(t=e.cloner)==null||t.update()}),this.toUpdateCloner.clear()}doPendingUpdates(){this.doPendingExpandCloner(),this.doPendingUpdateCloner(),this.applyPendingCommands()}addPendingCommand(e){this.pendingCommands.push(e)}applyPendingCommands(){this.pendingCommands.forEach(e=>e()),this.pendingCommands.length=0}updateByLibOp(e,t){e.path.length===1&&e.path[0]==="components"&&e.type===1&&this.createChildrenObjects([{...e.data.asset,id:e.id}],this.invisibleObjects,t)}updateTreeByOp(e,t){var i;if(e.path.length===0&&e.type===7){let n=e.parent===null?this:this.find(e.parent);if(n===void 0)throw new Error("unexpected");let r=this.createObject(e.id,e.data,e.children,n,e.localIndex,t);r.updateVisible(this),r.resetBBoxNeedsUpdate(),ku(r)&&kf(r.parent)&&(r.invalidateUpstreamBooleanData(),r.parent.invalidateDownstreamBooleanData().recomputeBoolean()),this.markNeedsRecomputeInstancesForAncessors(n),this.markNeedsRecomputeInstancesForChildren(r),this.markToExpandCloner(r),this.markPenumbraSizeDirty(),r.updatePathSnapping()}else if(e.path.length===0&&e.type===8){let n=this.find(e.id);if(n===void 0)throw new Error("unexpected");n.traverseEntity(s=>{s instanceof H0&&(this.shapeBlendIntances=this.shapeBlendIntances.filter(a=>a!==s))}),this.markToExpandCloner(n),n.resetBBoxNeedsUpdate(),this.unregisterObject(n);let r=n.parent;this.markNeedsRecomputeInstancesForAncessors(r),this.markNeedsRecomputeInstancesForChildren(n),this.markPenumbraSizeDirty(),n.parent.remove(n),kf(n.parent)&&(n.parent.invalidateUpstreamBooleanData(),n.parent.invalidateDownstreamBooleanData().recomputeBoolean()),ku(n)&&(n.freeBooleanPointer(),r instanceof V0&&r.invalidateDownstreamBooleanData().recomputeBoolean()),n instanceof W5&&n.detachShape(),this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(n),this.pathConstraints.removeDependencies(n.uuid),n.updatePathSnapping()}else if(e.path.length===0&&e.type===9){let n=this.find(e.id);if(n===void 0)throw new Error("unexpected");this.markNeedsRecomputeInstancesForChildren(n);let r=n.parent;this.markNeedsRecomputeInstancesForAncessors(r),(i=n.cloner)==null||i.resetOnMove(),this.markToExpandCloner(n);let s=e.parent===null?this:this.find(e.parent);if(s===void 0)throw new Error("unexpected");s.add(n),this.markNeedsRecomputeInstancesForAncessors(s),this.markToExpandCloner(n),n.invalidateClonerTransform(n),n.updateVisible(this),n.resetBBoxNeedsUpdate(),this.markPenumbraSizeDirty();let a=e.localIndex;s.children.splice(a,0,s.children.pop()),ku(n)&&(n.invalidateUpstreamBooleanData(),kf(n.parent)?n.parent.invalidateDownstreamBooleanData().recomputeBoolean():r instanceof V0&&r.invalidateDownstreamBooleanData().recomputeBoolean()),n.updatePathSnapping()}this.markNeedsUpdateRendererDirty(),this.markGeometryCacheDirty()}get playPage(){return this.find(this.data.publish.playPage)??this.errorPage}updatePage(e){var t;this.activePage&&this.activePage.onDeactive(),this.activePage=this.errorPage;for(let i of this.children)i instanceof fa&&(i.visible=i.uuid===e,i.visible&&(this.activePage=i,this.activePage.onActive(this)));this.activePage!==((t=this.splatViewer)==null?void 0:t.activePage)&&this.reloadSplats()}updateEntityByOp(e,t,i,n){if(t.type===0){if(("overrides"in t.props||"component"in t.props)&&this.markNeedsRecomputeInstances(),"visible"in t.props&&this.markPenumbraSizeDirty(),t.path.includes("overrides")&&"states"in t.props){let{rest:s}=t.props;t={...t,props:s},this.markNeedsRecomputeInstances()}t.path[0]==="pathSnapping"&&t.props.pathId!==void 0&&this.pathConstraints.setConstraint(e,t.props.pathId)}let r=this.find(e);if(r)try{dHe(r,t,i,{scene:this,shared:n}),r instanceof Ds&&r.updateGeometryGroupsIfNeeded()}catch(s){console.error(s)}}updateEntity2DByOp(e,t,i,n,r,s=[]){e.updateEntityByOp(t,i,n,r),this.traverseEntity(a=>{(a instanceof mo||a instanceof fa)&&(s.includes(a.frameId??"")||a.frameId===t)&&a.updateEntity2DByOp(t,i,n,r)})}get activeCamera(){return this.activePage.activeCamera}switchActiveCamera(e){this.activePage.switchActiveCamera(e)}isInvisibleObjects(e){return e===this.invisibleObjects||e.hasAnccestor(this.invisibleObjects)}init(e,t){let i=Object.entries(t.data.lib.components).map((n,r)=>({data:n[1].asset.data,children:n[1].asset.children,id:n[0],fi:r}));this.invisibleObjects.updateState(this.invisibleObjects.data,{scene:this,shared:t}),this.add(this.invisibleObjects),this.createChildrenObjects(i,this.invisibleObjects,t),this.createChildrenObjects(e.objects,this,t),this.updatePage(e.publish.playPage),this.activePage.switchToPlayCamera(),this.expandInstances(t,!0),this.traverseEntity(n=>{n instanceof xo&&n.updateUp()}),this.doPendingExpandCloner(),this.applyPendingCommands()}markNeedsRecomputeInstances(){this.needsRecomputeInstances=!0}markNeedsRecomputeInstancesForChildren(e){e.traverseEntity(t=>{(t.data.type==="Component"||t.data.type==="Instance")&&this.markNeedsRecomputeInstances()})}markNeedsRecomputeInstancesForAncessors(e){dn.is(e)&&(e.data.type==="Component"&&this.markNeedsRecomputeInstances(),e.traverseAncestors(t=>{dn.is(t)&&t.data.type==="Component"&&this.markNeedsRecomputeInstances()}))}relativeizeInner(e,t,i,n,r,s,a){if(e){let o=n.find(e);o&&o!==n&&r.forInstancesRec(l=>{l.data=Mw(l.data,c=>{let u=c.events.data(a.id),h=l.goUp(s);if(h){let d=[...u$(h.identity),e].join("-"),p=this.entityIdentityToEntity[d];if(p){let g=p.uuid,x=Ys.zoom(u,t);x[i]=g}else console.warn("cannot find instance")}}).data})}}rewriteActions(e,t,i,n,r,s){e.forEach(a=>{a.data.type==="Transition"?this.relativeizeInner(a.data.object,[...t,a.id],"object",i,n,r,s):a.data.type==="Animation"?this.relativeizeInner(a.data.object,[...t,a.id],"object",i,n,r,s):a.data.type==="Conditional"&&(this.rewriteActions(a.data.ifActions,[...t,a.id,"ifActions"],i,n,r,s),this.rewriteActions(a.data.elseActions,[...t,a.id,"elseActions"],i,n,r,s))})}rewriteEventsBeforeGoToPlayMode(){this.traverseEntity(e=>{if(e instanceof U1&&typeof e.identity=="string"&&e.data.type==="Component")return e.traverseEntity((t,i)=>{t.data.events.forEach(n=>{if(n.data.type==="GameControl"){let r=!1;if(t.forInstancesRec(s=>{s.data=Mw(s.data,a=>{s.isInstanceRoot||(a.events.delete(n.id),r=!0)}).data}),r===!1)for(let s of P3.list)this.rewriteActions(n.data.gameActions[s],["gameActions",s],e,t,i,n)}else n.data.type==="Conditional"?(n.data.condition.type==="Distance"?(this.relativeizeInner(n.data.condition.fromObject,["condition"],"fromObject",e,t,i,n),this.relativeizeInner(n.data.condition.toObject,["condition"],"toObject",e,t,i,n)):n.data.condition.type==="State"?this.relativeizeInner(n.data.condition.object,["condition"],"object",e,t,i,n):n.data.condition.type==="Comparison"&&(n.data.condition.lOperand.type==="Property"&&this.relativeizeInner(n.data.condition.lOperand.value[0],["condition","lOperand","value"],0,e,t,i,n),n.data.condition.rOperand.type==="Property"&&this.relativeizeInner(n.data.condition.rOperand.value[0],["condition","rOperand","value"],0,e,t,i,n)),this.rewriteActions(n.data.inActions,["inActions"],e,t,i,n),this.rewriteActions(n.data.outActions,["outActions"],e,t,i,n)):"actions"in n.data&&this.rewriteActions(n.data.actions,["actions"],e,t,i,n)})}),!0})}expandInstances(e,t,i){let n=new Set;this.traverseEntity(r=>{if(r instanceof U1&&r.isInstanceRoot)return r.expandInstanceChildren({scene:this,shared:e,pendingDeletes:n}),t||r.resetBBoxNeedsUpdate(),i&&r.traverseEntity(s=>{i.addClip(s)}),!0});for(let r of n)this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(r),q5(r)}recomputeInstances(e,t){this.needsRecomputeInstances&&(this.needsRecomputeInstances=!1,this.traverseEntity(i=>{i instanceof U1&&i.isInstanceRoot&&(i.component=void 0)}),this.expandInstances(e,!1,t))}disposeAndUnregisterEntityRecursivelyIfNotReregistered(e){e.traverseEntity(t=>{let i=typeof t.identity=="string"?t.identity:t.identity.join("-");this.entityIdentityToEntity[i]===t&&(delete this.entityByUuid[t.uuid],delete this.entityIdentityToEntity[i]),t.dispose()})}clearScene(){for(let e of this.children)dn.is(e)&&e.disposeRecursively();this.children.length=0}resetAfterClear(e,t){this.init(e,t)}raycast(e){return this.raycast1(e,!1)}raycast1(e,t){let i=[],n=r=>{for(let s of r.children){let a=s.cloner;if(dn.is(s)&&!s.raycastLock&&(s.visible||a!=null&&a.object.data.visible))if(t===!0&&s.isInstanceRoot){let o=[];if(e.intersectObject(s,!0,o),o.length){let l=o[0];l.object=s,l.point.applyMatrix4(l.object.matrixWorld);let c=s.matrixWorld.clone().invert();l.point.applyMatrix4(c),i.push(l)}}else(ku(s)||pz(s)&&this.enableHelpers&&s.objectHelper.visible)&&(e.intersectObject(s,!1,i),Mz(s,e,i)),n(s)}};return n(this.activePage),i}raycastWithClones(e){let t=[],i=n=>{for(let r of n.children){let s=r.cloner;dn.is(r)&&(r.visible||s!=null&&s.object.data.visible)&&((ku(r)||pz(r)&&this.enableHelpers&&r.objectHelper.visible)&&(e.intersectObject(r,!1,t),Mz(r,e,t,!0)),i(r))}};return i(this),t}forEachEntity(e){for(let t of this.children)dn.is(t)&&e(t)}traverseConcreteEntity(e){for(let t of this.children)dn.is(t)&&t.isConcreteEntity&&t.traverseEntity(e)}traverseEntity(e){for(let t of this.children)dn.is(t)&&t.traverseEntity(e)}updateFont(e,t){this.traverseEntity(i=>{if(i instanceof Ds&&i.data.type==="Mesh"&&(i.data.geometry.type==="TextGeometry"||i.data.geometry.type==="InputGeometry")&&i.data.geometry.font===e){let n=i.geometry,r=i.data.geometry;n.updateFont(e,t).then(()=>{n.update(r);let s=i.invalidateDownstreamBooleanData();kf(s)&&s.recomputeBoolean()})}})}traverseObject(e){for(let t of this.children)z0.is(t)&&t.traverseObject(e)}traverseVisibleEntity(e){for(let t of this.children)dn.is(t)&&t.visible&&t.traverseVisibleEntity(e)}dispose(){this.clearScene()}createChildrenObjects(e,t,i){let n=0;for(let r of e)this.createObject(r.id,r.data,r.children,t,n,i),n+=1}registerObjectCreatedInLegacy(e){this.entityByUuid[e.uuid]=e}unregisterObject(e){delete this.entityByUuid[e.uuid];for(let t of e.children)this.unregisterObject(t)}createObject(e,t,i,n,r,s){var l;let a={scene:this,shared:s},o=Y5(e,t,a);return o instanceof H0&&this.shapeBlendIntances.push(o),o&&(this.entityByUuid[e]=o,n.add(o),n.children.splice(r,0,n.children.pop()),i.length>0&&(o.isInstanceRoot?console.error("instance should not have children!"):this.createChildrenObjects(i,o,s)),o.updateState(t,a),o instanceof Ds&&o.updateGeometryGroupsIfNeeded(),o.updateVisible(this),o.cloner&&this.toExpandCloner.add(o),(l=t.pathSnapping)!=null&&l.pathId&&this.pathConstraints.setConstraint(e,t.pathSnapping.pathId)),t.type==="Empty"&&t.animations&&o.traverseEntity(c=>{let u=c.dataPatched;if(c instanceof Ds&&u.bones&&u.boneInverses){let h=u.bones.map(g=>this.find(g)),d=u.boneInverses.map(g=>new Bt().fromArray(g)),p=new L4(h,d);c.bind(p,c.bindMatrix)}else c.matrixAutoUpdate=!0}),o}getCenter(e){let t=[];for(let n=0,r=e.length;n<r;++n){let{id:s,recursive:a}=e[n],o=this.find(s),l=a?o.recursiveBBox:o.singleBBox;t.push(...l.vertices)}let i=new ps;return i.setFromPoints(t),i.getCenter(rX),rX}copyMatrixWorld(e,t){if(e===null){t.identity();return}let i=this.find(e);i?t.copy(i.matrixWorld):t.identity()}copyParentMatrixWorld(e,t){var n;if(e===null){t.identity();return}let i=(n=this.find(e))==null?void 0:n.parent;i?t.copy(i.matrixWorld):t.identity()}traverseMaterial(e){this.traverseEntity(t=>{if(t instanceof nl)if(Array.isArray(t.material))for(let i=0;i<t.material.length;i++)t.material[i]instanceof sg&&e(t.material[i]);else t.material instanceof sg&&e(t.material)})}updateViewPlaneSize(e,t,i=!1){this.traverseConcreteEntity(n=>{n instanceof xo&&n.setViewplaneSize(e,t,i)})}initializeSplatViewer(){this.splatViewer=new OHe({scene:this}),this.reloadSplats()}reloadSplats(){var e;(e=this.splatViewer)==null||e.loadSplat()}},XC=(e,t)=>{let i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)},BHe=(e,t)=>{let i=t.x-e.x,n=t.y-e.y;return LHe(Math.atan2(n,i))},IHe=(e,t,i)=>{let n={x:0,y:0};return i=Tz(i),n.x=e.x-t*Math.cos(i),n.y=e.y-t*Math.sin(i),n},Tz=e=>e*(Math.PI/180),LHe=e=>e*(180/Math.PI),UHe=e=>isNaN(e.buttons)?e.pressure!==0:e.buttons!==0,yL=new Map,sX=e=>{yL.has(e)&&clearTimeout(yL.get(e)),yL.set(e,setTimeout(e,100))},Y3=(e,t,i)=>{let n=t.split(/[ ,]+/g),r;for(let s=0;s<n.length;s+=1)r=n[s],e.addEventListener?e.addEventListener(r,i,!1):e.attachEvent&&e.attachEvent(r,i)},aX=(e,t,i)=>{let n=t.split(/[ ,]+/g),r;for(let s=0;s<n.length;s+=1)r=n[s],e.removeEventListener?e.removeEventListener(r,i):e.detachEvent&&e.detachEvent(r,i)},kte=e=>(e.preventDefault(),e.type.match(/^touch/)?e.changedTouches:e),oX=()=>{if(typeof window>"u")return;let e=window.pageXOffset!==void 0?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,t=window.pageYOffset!==void 0?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return{x:e,y:t}},Cz=(e,t)=>{t.top||t.right||t.bottom||t.left?(e.style.top=t.top,e.style.right=t.right,e.style.bottom=t.bottom,e.style.left=t.left):(e.style.left=t.x+"px",e.style.top=t.y+"px")},K5=(e,t,i)=>{let n=jte(e);for(let r in n)if(n.hasOwnProperty(r))if(typeof t=="string")n[r]=t+" "+i;else{let s="";for(let a=0,o=t.length;a<o;a+=1)s+=t[a]+" "+i+", ";n[r]=s.slice(0,-2)}return n},NHe=(e,t)=>{let i=jte(e);for(let n in i)i.hasOwnProperty(n)&&(i[n]=t);return i},jte=e=>{let t={};return t[e]="",["webkit","Moz","o"].forEach(function(i){t[i+e.charAt(0).toUpperCase()+e.slice(1)]=""}),t},xL=(e,t)=>{for(let i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},zHe=(e,t)=>{let i={};for(let n in e)e.hasOwnProperty(n)&&t.hasOwnProperty(n)?i[n]=t[n]:e.hasOwnProperty(n)&&(i[n]=e[n]);return i},Dz=(e,t)=>{if(e.length)for(let i=0,n=e.length;i<n;i+=1)t(e[i]);else t(e)},FHe=(e,t,i)=>({x:Math.min(Math.max(e.x,t.x-i),t.x+i),y:Math.min(Math.max(e.y,t.y-i),t.y+i)});typeof window<"u"&&(Wte="ontouchstart"in window,Xte=!!window.PointerEvent,qte=!!window.MSPointerEvent);var Wte,Xte,qte,q_={touch:{start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},pointer:{start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"},MSPointer:{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}},x1,Lw={};Xte?x1=q_.pointer:qte?x1=q_.MSPointer:Wte?(x1=q_.touch,Lw=q_.mouse):x1=q_.mouse;function Z0(){}Z0.prototype.on=function(e,t){var i=this,n=e.split(/[ ,]+/g),r;i._handlers_=i._handlers_||{};for(var s=0;s<n.length;s+=1)r=n[s],i._handlers_[r]=i._handlers_[r]||[],i._handlers_[r].push(t);return i};Z0.prototype.off=function(e,t){var i=this;return i._handlers_=i._handlers_||{},e===void 0?i._handlers_={}:t===void 0?i._handlers_[e]=null:i._handlers_[e]&&i._handlers_[e].indexOf(t)>=0&&i._handlers_[e].splice(i._handlers_[e].indexOf(t),1),i};Z0.prototype.trigger=function(e,t){var i=this,n=e.split(/[ ,]+/g),r;i._handlers_=i._handlers_||{};for(var s=0;s<n.length;s+=1)r=n[s],i._handlers_[r]&&i._handlers_[r].length&&i._handlers_[r].forEach(function(a){a.call(i,{type:r,target:i},t)})};Z0.prototype.config=function(e){var t=this;t.options=t.defaults||{},e&&(t.options=zHe(t.options,e))};Z0.prototype.bindEvt=function(e,t){var i=this;return i._domHandlers_=i._domHandlers_||{},i._domHandlers_[t]=function(){typeof i["on"+t]=="function"?i["on"+t].apply(i,arguments):console.warn('[WARNING] : Missing "on'+t+'" handler.')},Y3(e,x1[t],i._domHandlers_[t]),Lw[t]&&Y3(e,Lw[t],i._domHandlers_[t]),i};Z0.prototype.unbindEvt=function(e,t){var i=this;return i._domHandlers_=i._domHandlers_||{},aX(e,x1[t],i._domHandlers_[t]),Lw[t]&&aX(e,Lw[t],i._domHandlers_[t]),delete i._domHandlers_[t],this};var J5=Z0;function ia(e,t){return this.identifier=t.identifier,this.position=t.position,this.frontPosition=t.frontPosition,this.collection=e,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(t),this.options.mode==="dynamic"&&(this.options.restOpacity=0),this.id=ia.id,ia.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}ia.prototype=new J5;ia.constructor=ia;ia.id=0;ia.prototype.buildEl=function(e){return this.ui={},this.options.dataOnly?this:(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front),this)};ia.prototype.stylize=function(){if(this.options.dataOnly)return this;var e=this.options.fadeTime+"ms",t=NHe("borderRadius","50%"),i=K5("transition","opacity",e),n={};return n.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},n.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:"rgba(255, 255, 255, .4)",border:"solid 2px rgba(0, 0, 0, .1)"},n.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:"rgba(255, 255, 255, .8)",border:"solid 2px rgba(0, 0, 0, .1)"},xL(n.el,i),this.options.shape==="circle"&&xL(n.back,t),xL(n.front,t),this.applyStyles(n),this};ia.prototype.applyStyles=function(e){for(var t in this.ui)if(this.ui.hasOwnProperty(t))for(var i in e[t])this.ui[t].style[i]=e[t][i];return this};ia.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)?this:(this.options.zone.appendChild(this.ui.el),this)};ia.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)?this:(this.options.zone.removeChild(this.ui.el),this)};ia.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()};ia.prototype.show=function(e){var t=this;return t.options.dataOnly||(clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.addToDom(),t.restCallback(),setTimeout(function(){t.ui.el.style.opacity=1},0),t.showTimeout=setTimeout(function(){t.trigger("shown",t.instance),typeof e=="function"&&e.call(this)},t.options.fadeTime)),t};ia.prototype.hide=function(e){var t=this;if(t.options.dataOnly)return t;if(t.ui.el.style.opacity=t.options.restOpacity,clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.removeTimeout=setTimeout(function(){var i=t.options.mode==="dynamic"?"none":"block";t.ui.el.style.display=i,typeof e=="function"&&e.call(t),t.trigger("hidden",t.instance)},t.options.fadeTime),t.options.restJoystick){let i=t.options.restJoystick,n={};n.x=i===!0||i.x!==!1?0:t.instance.frontPosition.x,n.y=i===!0||i.y!==!1?0:t.instance.frontPosition.y,t.setPosition(e,n)}return t};ia.prototype.setPosition=function(e,t){var i=this;i.frontPosition={x:t.x,y:t.y};var n=i.options.fadeTime+"ms",r={};r.front=K5("transition",["top","left"],n);var s={front:{}};s.front={left:i.frontPosition.x+"px",top:i.frontPosition.y+"px"},i.applyStyles(r),i.applyStyles(s),i.restTimeout=setTimeout(function(){typeof e=="function"&&e.call(i),i.restCallback()},i.options.fadeTime)};ia.prototype.restCallback=function(){var e=this,t={};t.front=K5("transition","none",""),e.applyStyles(t),e.trigger("rested",e.instance)};ia.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}};ia.prototype.computeDirection=function(e){var t=e.angle.radian,i=Math.PI/4,n=Math.PI/2,r,s,a;if(t>i&&t<i*3&&!e.lockX?r="up":t>-i&&t<=i&&!e.lockY?r="left":t>-i*3&&t<=-i&&!e.lockX?r="down":e.lockY||(r="right"),e.lockY||(t>-n&&t<n?s="left":s="right"),e.lockX||(t>0?a="up":a="down"),e.force>this.options.threshold){var o={},l;for(l in this.direction)this.direction.hasOwnProperty(l)&&(o[l]=this.direction[l]);var c={};this.direction={x:s,y:a,angle:r},e.direction=this.direction;for(l in o)o[l]===this.direction[l]&&(c[l]=!0);if(c.x&&c.y&&c.angle)return e;(!c.x||!c.y)&&this.trigger("plain",e),c.x||this.trigger("plain:"+s,e),c.y||this.trigger("plain:"+a,e),c.angle||this.trigger("dir dir:"+r,e)}else this.resetDirection();return e};var VHe=ia;function ms(e,t){var i=this;i.nipples=[],i.idles=[],i.actives=[],i.ids=[],i.pressureIntervals={},i.manager=e,i.id=ms.id,ms.id+=1,i.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},i.config(t),(i.options.mode==="static"||i.options.mode==="semi")&&(i.options.multitouch=!1),i.options.multitouch||(i.options.maxNumberOfNipples=1);let n=getComputedStyle(i.options.zone.parentElement);return n&&n.display==="flex"&&(i.parentIsFlex=!0),i.updateBox(),i.prepareNipples(),i.bindings(),i.begin(),i.nipples}ms.prototype=new J5;ms.constructor=ms;ms.id=0;ms.prototype.prepareNipples=function(){var e=this,t=e.nipples;t.on=e.on.bind(e),t.off=e.off.bind(e),t.options=e.options,t.destroy=e.destroy.bind(e),t.ids=e.ids,t.id=e.id,t.processOnMove=e.processOnMove.bind(e),t.processOnEnd=e.processOnEnd.bind(e),t.get=function(i){if(i===void 0)return t[0];for(var n=0,r=t.length;n<r;n+=1)if(t[n].identifier===i)return t[n];return!1}};ms.prototype.bindings=function(){var e=this;e.bindEvt(e.options.zone,"start"),e.options.zone.style.touchAction="none",e.options.zone.style.msTouchAction="none"};ms.prototype.begin=function(){var e=this,t=e.options;if(t.mode==="static"){var i=e.createNipple(t.position,e.manager.getIdentifier());i.add(),e.idles.push(i)}};ms.prototype.createNipple=function(e,t){var i=this,n=i.manager.scroll,r={},s=i.options,a={x:i.parentIsFlex?n.x:n.x+i.box.left,y:i.parentIsFlex?n.y:n.y+i.box.top};if(e.x&&e.y)r={x:e.x-a.x,y:e.y-a.y};else if(e.top||e.right||e.bottom||e.left){var o=document.createElement("DIV");o.style.display="hidden",o.style.top=e.top,o.style.right=e.right,o.style.bottom=e.bottom,o.style.left=e.left,o.style.position="absolute",s.zone.appendChild(o);var l=o.getBoundingClientRect();s.zone.removeChild(o),r=e,e={x:l.left+n.x,y:l.top+n.y}}var c=new VHe(i,{color:s.color,size:s.size,threshold:s.threshold,fadeTime:s.fadeTime,dataOnly:s.dataOnly,restJoystick:s.restJoystick,restOpacity:s.restOpacity,mode:s.mode,identifier:t,position:e,zone:s.zone,frontPosition:{x:0,y:0},shape:s.shape});return s.dataOnly||(Cz(c.ui.el,r),Cz(c.ui.front,c.frontPosition)),i.nipples.push(c),i.trigger("added "+c.identifier+":added",c),i.manager.trigger("added "+c.identifier+":added",c),i.bindNipple(c),c};ms.prototype.updateBox=function(){var e=this;e.box=e.options.zone.getBoundingClientRect()};ms.prototype.bindNipple=function(e){var t=this,i,n=function(r,s){i=r.type+" "+s.id+":"+r.type,t.trigger(i,s)};e.on("destroyed",t.onDestroyed.bind(t)),e.on("shown hidden rested dir plain",n),e.on("dir:up dir:right dir:down dir:left",n),e.on("plain:up plain:right plain:down plain:left",n)};ms.prototype.pressureFn=function(e,t,i){var n=this,r=0;clearInterval(n.pressureIntervals[i]),n.pressureIntervals[i]=setInterval((function(){var s=e.force||e.pressure||e.webkitForce||0;s!==r&&(t.trigger("pressure",s),n.trigger("pressure "+t.identifier+":pressure",s),r=s)}).bind(n),100)};ms.prototype.onstart=function(e){var t=this,i=t.options,n=e;e=kte(e),t.updateBox();var r=function(s){t.actives.length<i.maxNumberOfNipples?t.processOnStart(s):n.type.match(/^touch/)&&(Object.keys(t.manager.ids).forEach(function(a){if(Object.values(n.touches).findIndex(function(l){return l.identifier===a})<0){var o=[e[0]];o.identifier=a,t.processOnEnd(o)}}),t.actives.length<i.maxNumberOfNipples&&t.processOnStart(s))};return Dz(e,r),t.manager.bindDocument(),!1};ms.prototype.processOnStart=function(e){var t=this,i=t.options,n,r=t.manager.getIdentifier(e),s=e.force||e.pressure||e.webkitForce||0,a={x:e.pageX,y:e.pageY},o=t.getOrCreate(r,a);o.identifier!==r&&t.manager.removeIdentifier(o.identifier),o.identifier=r;var l=function(u){u.trigger("start",u),t.trigger("start "+u.id+":start",u),u.show(),s>0&&t.pressureFn(e,u,u.identifier),t.processOnMove(e)};if((n=t.idles.indexOf(o))>=0&&t.idles.splice(n,1),t.actives.push(o),t.ids.push(o.identifier),i.mode!=="semi")l(o);else{var c=XC(a,o.position);if(c<=i.catchDistance)l(o);else{o.destroy(),t.processOnStart(e);return}}return o};ms.prototype.getOrCreate=function(e,t){var i=this,n=i.options,r;return/(semi|static)/.test(n.mode)?(r=i.idles[0],r?(i.idles.splice(0,1),r):n.mode==="semi"?i.createNipple(t,e):(console.warn("Coudln't find the needed nipple."),!1)):(r=i.createNipple(t,e),r)};ms.prototype.processOnMove=function(e){var t=this,i=t.options,n=t.manager.getIdentifier(e),r=t.nipples.get(n),s=t.manager.scroll;if(!UHe(e)){this.processOnEnd(e);return}if(!r){console.error("Found zombie joystick with ID "+n),t.manager.removeIdentifier(n);return}if(i.dynamicPage){var a=r.el.getBoundingClientRect();r.position={x:s.x+a.left,y:s.y+a.top}}r.identifier=n;var o=r.options.size/2,l={x:e.pageX,y:e.pageY};i.lockX&&(l.y=r.position.y),i.lockY&&(l.x=r.position.x);var c=XC(l,r.position),u=BHe(l,r.position),h=Tz(u),d=c/o,p={distance:c,position:l},g,x;if(r.options.shape==="circle"?(g=Math.min(c,o),x=IHe(r.position,g,u)):(x=FHe(l,r.position,o),g=XC(x,r.position)),i.follow){if(c>o){let w=l.x-x.x,E=l.y-x.y;r.position.x+=w,r.position.y+=E,r.el.style.top=r.position.y-(t.box.top+s.y)+"px",r.el.style.left=r.position.x-(t.box.left+s.x)+"px",c=XC(l,r.position)}}else l=x,c=g;var y=l.x-r.position.x,b=l.y-r.position.y;r.frontPosition={x:y,y:b},i.dataOnly||Cz(r.ui.front,r.frontPosition);var A={identifier:r.identifier,position:l,force:d,pressure:e.force||e.pressure||e.webkitForce||0,distance:c,angle:{radian:h,degree:u},vector:{x:y/o,y:-b/o},raw:p,instance:r,lockX:i.lockX,lockY:i.lockY};A=r.computeDirection(A),A.angle={radian:Tz(180-u),degree:180-u},r.trigger("move",A),t.trigger("move "+r.id+":move",A)};ms.prototype.processOnEnd=function(e){var t=this,i=t.options,n=t.manager.getIdentifier(e),r=t.nipples.get(n),s=t.manager.removeIdentifier(r.identifier);!r||(i.dataOnly||r.hide(function(){i.mode==="dynamic"&&(r.trigger("removed",r),t.trigger("removed "+r.id+":removed",r),t.manager.trigger("removed "+r.id+":removed",r),r.destroy())}),clearInterval(t.pressureIntervals[r.identifier]),r.resetDirection(),r.trigger("end",r),t.trigger("end "+r.id+":end",r),t.ids.indexOf(r.identifier)>=0&&t.ids.splice(t.ids.indexOf(r.identifier),1),t.actives.indexOf(r)>=0&&t.actives.splice(t.actives.indexOf(r),1),/(semi|static)/.test(i.mode)?t.idles.push(r):t.nipples.indexOf(r)>=0&&t.nipples.splice(t.nipples.indexOf(r),1),t.manager.unbindDocument(),/(semi|static)/.test(i.mode)&&(t.manager.ids[s.id]=s.identifier))};ms.prototype.onDestroyed=function(e,t){var i=this;i.nipples.indexOf(t)>=0&&i.nipples.splice(i.nipples.indexOf(t),1),i.actives.indexOf(t)>=0&&i.actives.splice(i.actives.indexOf(t),1),i.idles.indexOf(t)>=0&&i.idles.splice(i.idles.indexOf(t),1),i.ids.indexOf(t.identifier)>=0&&i.ids.splice(i.ids.indexOf(t.identifier),1),i.manager.removeIdentifier(t.identifier),i.manager.unbindDocument()};ms.prototype.destroy=function(){var e=this;e.unbindEvt(e.options.zone,"start"),e.nipples.forEach(function(i){i.destroy()});for(var t in e.pressureIntervals)e.pressureIntervals.hasOwnProperty(t)&&clearInterval(e.pressureIntervals[t]);e.trigger("destroyed",e.nipples),e.manager.unbindDocument(),e.off()};var HHe=ms;function Aa(e){var t=this;t.ids={},t.index=0,t.collections=[],t.scroll=oX(),t.config(e),t.prepareCollections();var i=function(){var r;t.collections.forEach(function(s){s.forEach(function(a){r=a.el.getBoundingClientRect(),a.position={x:t.scroll.x+r.left,y:t.scroll.y+r.top}})})};if(typeof window>"u")return t.collections;Y3(window,"resize",function(){sX(i)});var n=function(){t.scroll=oX()};return Y3(window,"scroll",function(){sX(n)}),t.collections}Aa.prototype=new J5;Aa.constructor=Aa;Aa.prototype.prepareCollections=function(){var e=this;e.collections.create=e.create.bind(e),e.collections.on=e.on.bind(e),e.collections.off=e.off.bind(e),e.collections.destroy=e.destroy.bind(e),e.collections.get=function(t){var i;return e.collections.every(function(n){return i=n.get(t),!i}),i}};Aa.prototype.create=function(e){return this.createCollection(e)};Aa.prototype.createCollection=function(e){var t=this,i=new HHe(t,e);return t.bindCollection(i),t.collections.push(i),i};Aa.prototype.bindCollection=function(e){var t=this,i,n=function(r,s){i=r.type+" "+s.id+":"+r.type,t.trigger(i,s)};e.on("destroyed",t.onDestroyed.bind(t)),e.on("shown hidden rested dir plain",n),e.on("dir:up dir:right dir:down dir:left",n),e.on("plain:up plain:right plain:down plain:left",n)};Aa.prototype.bindDocument=function(){var e=this;e.binded||(e.bindEvt(document,"move").bindEvt(document,"end"),e.binded=!0)};Aa.prototype.unbindDocument=function(e){var t=this;(!Object.keys(t.ids).length||e===!0)&&(t.unbindEvt(document,"move").unbindEvt(document,"end"),t.binded=!1)};Aa.prototype.getIdentifier=function(e){var t;return e?(t=e.identifier===void 0?e.pointerId:e.identifier,t===void 0&&(t=this.latest||0)):t=this.index,this.ids[t]===void 0&&(this.ids[t]=this.index,this.index+=1),this.latest=t,this.ids[t]};Aa.prototype.removeIdentifier=function(e){var t={};for(var i in this.ids)if(this.ids[i]===e){t.id=i,t.identifier=this.ids[i],delete this.ids[i];break}return t};Aa.prototype.onmove=function(e){var t=this;return t.onAny("move",e),!1};Aa.prototype.onend=function(e){var t=this;return t.onAny("end",e),!1};Aa.prototype.oncancel=function(e){var t=this;return t.onAny("end",e),!1};Aa.prototype.onAny=function(e,t){var i=this,n,r="processOn"+e.charAt(0).toUpperCase()+e.slice(1);t=kte(t);var s=function(o,l,c){c.ids.indexOf(l)>=0&&(c[r](o),o._found_=!0)},a=function(o){n=i.getIdentifier(o),Dz(i.collections,s.bind(null,o,n)),o._found_||i.removeIdentifier(n)};return Dz(t,a),!1};Aa.prototype.destroy=function(){var e=this;e.unbindDocument(!0),e.ids={},e.index=0,e.collections.forEach(function(t){t.destroy()}),e.off()};Aa.prototype.onDestroyed=function(e,t){var i=this;if(i.collections.indexOf(t)<0)return!1;i.collections.splice(i.collections.indexOf(t),1)};var GHe=Aa,lX=new GHe,kHe={create:function(e){return lX.create(e)},factory:lX},Yte=new Map,kA=new Map,h0=class{constructor(e,t,i,n){this.data=t;let{audio:r,volume:s,delay:a,loop:o}=t;if(!r)throw new Error("Missing property");let l=typeof r=="string"?n.getAudio(r).src:r.data;this.audioPlayer=new mA({src:l,volume:s,delay:a,loop:o}),kA.has(i.uuid)?kA.get(i.uuid).push(this):kA.set(i.uuid,[this]),Yte.set(e,this)}playByToggle(){this.data.toggle==="stop"?this.audioPlayer.status==="playing"?this.audioPlayer.stop():(this.audioPlayer.stop(),this.audioPlayer.play()):this.data.toggle==="pause"?this.audioPlayer.status==="playing"?this.audioPlayer.pause():this.audioPlayer.play():(this.audioPlayer.stop(),this.audioPlayer.play())}dispose(){this.audioPlayer.stop()}},Rz=class{constructor(e){this.data=e}dispatch(){this.data.playAudio?this.pauseAudio(this.data.playAudio):this.data.object?this.pauseAllAudiosFromObject(this.data.object):this.pauseAllAudios()}pauseAudio(e){let t=Yte.get(e);!t||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.audioPlayer[this.data.interaction](),this.disposeDelay()},this.data.delay)):t.audioPlayer[this.data.interaction]())}pauseAllAudiosFromObject(e){let t=kA.get(e);!(t!=null&&t.length)||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.forEach(i=>i.audioPlayer[this.data.interaction]()),this.disposeDelay()},this.data.delay)):t.forEach(i=>i.audioPlayer[this.data.interaction]()))}pauseAllAudios(){let e=[...kA.values()];!e.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e.forEach(t=>{t.forEach(i=>{i.audioPlayer[this.data.interaction]()})}),this.disposeDelay()},this.data.delay)):e.forEach(t=>{t.forEach(i=>{i.audioPlayer[this.data.interaction]()})}))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},Qte=class{constructor(e,t,i,n,r){if(this.data=t,this.shared=n,this.condition=r,t.interaction==="play")this.interaction=new h0(e,t,i,n);else if(t.interaction==="pause"||t.interaction==="stop")this.interaction=new Rz(t);else throw new Error("Missing property")}dispatchBasic(){if(yr(this.shared,this.condition)===!1)return!1;this.interaction instanceof h0?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if(yr(this.shared,this.condition)===!1)return!1;this.interaction instanceof h0?this.interaction.audioPlayer.play():this.interaction.dispatch()}dispatchGameControl(e){if(yr(this.shared,this.condition)===!1)return!1;this.interaction instanceof h0&&(e==="start"?this.interaction.audioPlayer.play():this.interaction.audioPlayer.stop())}dispose(){this.interaction.dispose()}},Kte=class{constructor(e,t,i,n){this.data=e,this.page=t,this.shared=i,this.condition=n,this.delay=0,this.emission=e.emission,e.delay!==void 0&&(this.delay=e.delay),this.particleSystem=this.page.scene.find(this.data.emitterObjectId)}toggleEmitting(){this.particleSystem.started&&!this.particleSystem.stopped?this.stop(this.delay):this.start(this.delay)}toggleFroze(){this.particleSystem.started&&!this.particleSystem.isFrozen?this.freeze(this.delay):this.unFreeze(this.delay)}start(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.start(0),this.clearDelay()},e);return}this.particleSystem.start()}stop(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.stop(0),this.clearDelay()},e);return}this.particleSystem.stop()}freeze(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.freeze(0),this.clearDelay()},e);return}this.particleSystem.froze()}unFreeze(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.unFreeze(0),this.clearDelay()},e);return}this.particleSystem.unFroze()}reset(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.reset(0),this.clearDelay()},e);return}this.particleSystem.reset()}reverseFromCurrent(){switch(this.emission){case"emitToggle":this.toggleEmitting();break;case"pauseToggle":this.toggleFroze();break}}dispatchBasic(){if(yr(this.shared,this.condition)===!1||!this.particleSystem)return!1;switch(this.emission){case"start":this.start(this.delay);break;case"emitToggle":this.toggleEmitting();break;case"pause":this.freeze(this.delay);break;case"pauseToggle":this.toggleFroze();break;case"stop":this.stop(this.delay);break;case"reset":this.reset(this.delay);break}}dispatchConditional(){if(yr(this.shared,this.condition)===!1||!this.particleSystem)return!1;switch(this.emission){case"start":this.start(this.delay);break;case"stop":this.stop(this.delay);break;case"reset":this.reset(this.delay);break}}dispatchGameControl(e){if(yr(this.shared,this.condition)===!1||!this.particleSystem)return!1;e==="start"?this.start(this.delay):this.stop(this.delay)}dispose(){!this.particleSystem||(this.particleSystem.reset(),this.clearDelay())}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}},jHe="text/plain",WHe="us-ascii",cX=(e,t)=>t.some(i=>i instanceof RegExp?i.test(e):i===e),XHe=(e,{stripHash:t})=>{let i=/^data:(?<type>[^,]*?),(?<data>[^#]*?)(?:#(?<hash>.*))?$/.exec(e);if(!i)throw new Error(`Invalid URL: ${e}`);let{type:n,data:r,hash:s}=i.groups,a=n.split(";");s=t?"":s;let o=!1;a[a.length-1]==="base64"&&(a.pop(),o=!0);let l=(a.shift()||"").toLowerCase(),c=[...a.map(u=>{let[h,d=""]=u.split("=").map(p=>p.trim());return h==="charset"&&(d=d.toLowerCase(),d===WHe)?"":`${h}${d?`=${d}`:""}`}).filter(Boolean)];return o&&c.push("base64"),(c.length>0||l&&l!==jHe)&&c.unshift(l),`data:${c.join(";")},${o?r.trim():r}${s?`#${s}`:""}`};function qHe(e,t){if(t={defaultProtocol:"http:",normalizeProtocol:!0,forceHttp:!1,forceHttps:!1,stripAuthentication:!0,stripHash:!1,stripTextFragment:!0,stripWWW:!0,removeQueryParameters:[/^utm_\w+/i],removeTrailingSlash:!0,removeSingleSlash:!0,removeDirectoryIndex:!1,sortQueryParameters:!0,...t},e=e.trim(),/^data:/i.test(e))return XHe(e,t);if(/^view-source:/i.test(e))throw new Error("`view-source:` is not supported as it is a non-standard protocol");let i=e.startsWith("//");!i&&/^\.*\//.test(e)||(e=e.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,t.defaultProtocol));let n=new URL(e);if(t.forceHttp&&t.forceHttps)throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");if(t.forceHttp&&n.protocol==="https:"&&(n.protocol="http:"),t.forceHttps&&n.protocol==="http:"&&(n.protocol="https:"),t.stripAuthentication&&(n.username="",n.password=""),t.stripHash?n.hash="":t.stripTextFragment&&(n.hash=n.hash.replace(/#?:~:text.*?$/i,"")),n.pathname){let s=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g,a=0,o="";for(;;){let c=s.exec(n.pathname);if(!c)break;let u=c[0],h=c.index,d=n.pathname.slice(a,h);o+=d.replace(/\/{2,}/g,"/"),o+=u,a=h+u.length}let l=n.pathname.slice(a,n.pathname.length);o+=l.replace(/\/{2,}/g,"/"),n.pathname=o}if(n.pathname)try{n.pathname=decodeURI(n.pathname)}catch{}if(t.removeDirectoryIndex===!0&&(t.removeDirectoryIndex=[/^index\.[a-z]+$/]),Array.isArray(t.removeDirectoryIndex)&&t.removeDirectoryIndex.length>0){let s=n.pathname.split("/"),a=s[s.length-1];cX(a,t.removeDirectoryIndex)&&(s=s.slice(0,-1),n.pathname=s.slice(1).join("/")+"/")}if(n.hostname&&(n.hostname=n.hostname.replace(/\.$/,""),t.stripWWW&&/^www\.(?!www\.)[a-z\-\d]{1,63}\.[a-z.\-\d]{2,63}$/.test(n.hostname)&&(n.hostname=n.hostname.replace(/^www\./,""))),Array.isArray(t.removeQueryParameters))for(let s of[...n.searchParams.keys()])cX(s,t.removeQueryParameters)&&n.searchParams.delete(s);if(t.removeQueryParameters===!0&&(n.search=""),t.sortQueryParameters){n.searchParams.sort();try{n.search=decodeURIComponent(n.search)}catch{}}t.removeTrailingSlash&&(n.pathname=n.pathname.replace(/\/$/,""));let r=e;return e=n.toString(),!t.removeSingleSlash&&n.pathname==="/"&&!r.endsWith("/")&&n.hash===""&&(e=e.replace(/\/$/,"")),(t.removeTrailingSlash||n.pathname==="/")&&n.hash===""&&t.removeSingleSlash&&(e=e.replace(/\/$/,"")),i&&!t.normalizeProtocol&&(e=e.replace(/^http:\/\//,"//")),t.stripProtocol&&(e=e.replace(/^(?:https?:)?\/\//,"")),e}var YHe=class{constructor({url:e,context:t},i,n,r){if(this.controlsManager=i,this.shared=n,this.condition=r,!e)throw new Error("Missing property");this.url=e.startsWith("mailto:")?e:qHe(e,{removeTrailingSlash:!1,removeSingleSlash:!1,stripWWW:!1}),this.context=t??"tab"}dispatch(){var e;if(yr(this.shared,this.condition)===!1)return!1;dM?window.location.assign(this.url):(this.context==="tab"||c$&&this.context==="none"?window.open(this.url,"_blank"):this.context==="window"?window.open(this.url,"_blank",`width=${window.innerWidth}, height=${window.innerHeight}`):window.open(this.url,"_parent"),(e=this.controlsManager.orbitControls)==null||e.onPointerUp(Si[0]),uBe())}},Jte=class{constructor(e,t,i,n,r){this.data=e,this.page=t,this.controlsManager=i,this.shared=n,this.condition=r,this.timeoutIdQueue=[],this.dispatchInner=()=>{this.objects.forEach(this.destroyCallback)},this.destroyCallback=s=>{var c,u;this.timeoutIdQueue.shift();let a=this.page.scene.find(s);if(a===void 0)return;let o=this.controlsManager.sharedGameControlGlobals.rapierWorld,l=o?(c=a.dataPatched.physics)==null?void 0:c.fusedBody:!0;if(a.cloner){for(let h of a.cloner.children)l?(h.playModeVisible=!1,h.rigidBody&&((u=a.dataPatched.physics)==null?void 0:u.rigidBody)==="positioned"&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(h.rigidBody.collider(0).handle),o.removeRigidBody(h.rigidBody),h.rigidBody=void 0),h.bvhGeometry&&(h.bvhGeometry=void 0)):this.clone===void 0||this.clone===h?(h.playModeVisible=!1,h.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(h.rigidBody.collider(0).handle),o.removeRigidBody(h.rigidBody),h.rigidBody=void 0)):h.playModeVisible===void 0&&(h.playModeVisible=!0);(l||this.clone===void 0||this.clone===!1)&&(a.visible=!1,a.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(a.rigidBody.collider(0).handle),o.removeRigidBody(a.rigidBody),a.rigidBody=void 0),a.bvhGeometry&&(a.bvhGeometry=void 0))}else a.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(a.rigidBody.collider(0).handle),o.removeRigidBody(a.rigidBody),a.rigidBody=void 0),a.bvhGeometry&&(a.bvhGeometry=void 0),a.visible=!1;o===void 0?this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim=this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter(h=>h.bvhGeometry!==void 0):this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim=this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter(h=>h.rigidBody!==void 0),a.destroyedInAction=!0,this.controlsManager.requestRender()},this.objects=[...e.objects]}dispatch(e){if(yr(this.shared,this.condition)===!1)return!1;this.clone=e,this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3)):this.dispatchInner()}dispatchFromStart(){if(yr(this.shared,this.condition)===!1)return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3))}dispose(){this.timeoutIdQueue.forEach(e=>window.clearTimeout(e))}},Zte=class{constructor(e,t,i,n,r){this.data=e,this.page=t,this.shared=i,this.eventManager=n,this.condition=r,this.shared=i}dispatch(){if(yr(this.shared,this.condition)===!1)return!1;clearTimeout(this.timeoutId),delete this.timeoutId,this.timeoutId=window.setTimeout(()=>{var e;this.shared.reset(this.shared.data,!0),lV(this.page,this.shared,!0),this.eventManager.reset(),(e=this.eventManager.controlsManager.gameControl)==null||e.reset(!0),this.page.switchToPlayCamera(),this.eventManager.controlsManager.requestRender(),delete this.timeoutId},(this.data.delay??0)*1e3)}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},$te={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,timelineChangeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0,rewind:!0},Z5={duration:1e3,delay:0,endDelay:0,startOnceDelay:0,pingPongDelayCorrection:0,pingPongEndDelayCorrection:0,easing:"easeOutElastic(1, .5)",round:0},QHe=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective","matrix","matrix3d"],Q3={CSS:{},springs:{}};function Yu(e,t,i){return Math.min(Math.max(e,t),i)}function jA(e,t){return e.indexOf(t)>-1}function bL(e,t){return e.apply(null,t)}var Ti={arr:function(e){return Array.isArray(e)},obj:function(e){return jA(Object.prototype.toString.call(e),"Object")},pth:function(e){return Ti.obj(e)&&e.hasOwnProperty("totalLength")},svg:function(e){return e instanceof SVGElement},inp:function(e){return e instanceof HTMLInputElement},dom:function(e){return!("isNode"in e)&&(e.nodeType||Ti.svg(e))},str:function(e){return typeof e=="string"},fnc:function(e){return typeof e=="function"},und:function(e){return typeof e>"u"},hex:function(e){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)},rgb:function(e){return/^rgb/.test(e)},hsl:function(e){return/^hsl/.test(e)},col:function(e){return Ti.hex(e)||Ti.rgb(e)||Ti.hsl(e)},key:function(e){return!$te.hasOwnProperty(e)&&!Z5.hasOwnProperty(e)&&e!=="targets"&&e!=="keyframes"}};function eie(e){var t=/\(([^)]+)\)/.exec(e);return t?t[1].split(",").map(function(i){return parseFloat(i)}):[]}function tie(e,t){var i=eie(e),n=Yu(Ti.und(i[0])?1:i[0],.1,100),r=Yu(Ti.und(i[1])?100:i[1],.1,100),s=Yu(Ti.und(i[2])?10:i[2],.1,100),a=Yu(Ti.und(i[3])?0:i[3],.1,100),o=Math.sqrt(r/n),l=s/(2*Math.sqrt(r*n)),c=l<1?o*Math.sqrt(1-l*l):0,u=1,h=l<1?(l*o+-a)/c:-a+o;function d(g){var x=t?t*g/1e3:g;return l<1?x=Math.exp(-x*l*o)*(u*Math.cos(c*x)+h*Math.sin(c*x)):x=(u+h*x)*Math.exp(-x*o),g===0||g===1?g:1-x}function p(){var g=Q3.springs[e];if(g)return g;for(var x=1/6,y=0,b=0;;)if(y+=x,d(y)===1){if(b++,b>=16)break}else b=0;var A=y*x*1e3;return Q3.springs[e]=A,A}return t?d:p}function KHe(e){return e===void 0&&(e=10),function(t){return Math.ceil(Yu(t,1e-6,1)*e)*(1/e)}}var JHe=function(){var e=11,t=1/(e-1);function i(u,h){return 1-3*h+3*u}function n(u,h){return 3*h-6*u}function r(u){return 3*u}function s(u,h,d){return((i(h,d)*u+n(h,d))*u+r(h))*u}function a(u,h,d){return 3*i(h,d)*u*u+2*n(h,d)*u+r(h)}function o(u,h,d,p,g){var x,y,b=0;do y=h+(d-h)/2,x=s(y,p,g)-u,x>0?d=y:h=y;while(Math.abs(x)>1e-7&&++b<10);return y}function l(u,h,d,p){for(var g=0;g<4;++g){var x=a(h,d,p);if(x===0)return h;var y=s(h,d,p)-u;h-=y/x}return h}function c(u,h,d,p){if(!(0<=u&&u<=1&&0<=d&&d<=1))return;var g=new Float32Array(e);if(u!==h||d!==p)for(var x=0;x<e;++x)g[x]=s(x*t,u,d);function y(b){for(var A=0,w=1,E=e-1;w!==E&&g[w]<=b;++w)A+=t;--w;var D=(b-g[w])/(g[w+1]-g[w]),T=A+D*t,I=a(T,u,d);return I>=.001?l(b,T,u,d):I===0?T:o(b,A,A+t,u,d)}return function(b){return u===h&&d===p||b===0||b===1?b:s(y(b),h,p)}}return c}(),iie=function(){var e={linear:function(){return function(n){return n}}},t={Sine:function(){return function(n){return 1-Math.cos(n*Math.PI/2)}},Circ:function(){return function(n){return 1-Math.sqrt(1-n*n)}},Back:function(){return function(n){return n*n*(3*n-2)}},Bounce:function(){return function(n){for(var r,s=4;n<((r=Math.pow(2,--s))-1)/11;);return 1/Math.pow(4,3-s)-7.5625*Math.pow((r*3-2)/22-n,2)}},Elastic:function(n,r){n===void 0&&(n=1),r===void 0&&(r=.5);var s=Yu(n,1,10),a=Yu(r,.1,2);return function(o){return o===0||o===1?o:-s*Math.pow(2,10*(o-1))*Math.sin((o-1-a/(Math.PI*2)*Math.asin(1/s))*(Math.PI*2)/a)}}},i=["Quad","Cubic","Quart","Quint","Expo"];return i.forEach(function(n,r){t[n]=function(){return function(s){return Math.pow(s,r+2)}}}),Object.keys(t).forEach(function(n){var r=t[n];e["easeIn"+n]=r,e["easeOut"+n]=function(s,a){return function(o){return 1-r(s,a)(1-o)}},e["easeInOut"+n]=function(s,a){return function(o){return o<.5?r(s,a)(o*2)/2:1-r(s,a)(o*-2+2)/2}}}),e}();function $5(e,t){if(Ti.fnc(e))return e;var i=e.split("(")[0],n=iie[i],r=eie(e);switch(i){case"spring":return tie(e,t);case"cubicBezier":return bL(JHe,r);case"steps":return bL(KHe,r);default:return bL(n,r)}}function nie(e){try{var t=document.querySelectorAll(e);return t}catch{return}}function dP(e,t){for(var i=e.length,n=arguments.length>=2?arguments[1]:void 0,r=[],s=0;s<i;s++)if(s in e){var a=e[s];t.call(n,a,s,e)&&r.push(a)}return r}function fP(e){return e.reduce(function(t,i){return t.concat(Ti.arr(i)?fP(i):i)},[])}function uX(e){return Ti.arr(e)?e:(Ti.str(e)&&(e=nie(e)||e),e instanceof NodeList||e instanceof HTMLCollection?[].slice.call(e):[e])}function eV(e,t){return e.some(function(i){return i===t})}function tV(e){var t={};for(var i in e)t[i]=e[i];return t}function Pz(e,t){var i=tV(e);for(var n in e)i[n]=t.hasOwnProperty(n)?t[n]:e[n];return i}function pP(e,t){var i=tV(e);for(var n in t)i[n]=Ti.und(e[n])?t[n]:e[n];return i}function ZHe(e){var t=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g.exec(e);return t?"rgba("+t[1]+",1)":e}function $He(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,i=e.replace(t,function(o,l,c,u){return l+l+c+c+u+u}),n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(i),r=parseInt(n[1],16),s=parseInt(n[2],16),a=parseInt(n[3],16);return"rgba("+r+","+s+","+a+",1)"}function eGe(e){var t=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(e)||/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g.exec(e),i=parseInt(t[1],10)/360,n=parseInt(t[2],10)/100,r=parseInt(t[3],10)/100,s=t[4]||1;function a(d,p,g){return g<0&&(g+=1),g>1&&(g-=1),g<1/6?d+(p-d)*6*g:g<1/2?p:g<2/3?d+(p-d)*(2/3-g)*6:d}var o,l,c;if(n==0)o=l=c=r;else{var u=r<.5?r*(1+n):r+n-r*n,h=2*r-u;o=a(h,u,i+1/3),l=a(h,u,i),c=a(h,u,i-1/3)}return"rgba("+o*255+","+l*255+","+c*255+","+s+")"}function tGe(e){if(Ti.rgb(e))return ZHe(e);if(Ti.hex(e))return $He(e);if(Ti.hsl(e))return eGe(e)}function Qf(e){var t=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(e);if(t)return t[1]}function iGe(e){if(jA(e,"translate")||e==="perspective")return"px";if(jA(e,"rotate")||jA(e,"skew"))return"deg"}function Oz(e,t){return Ti.fnc(e)?e(t.target,t.id,t.total):e}function cd(e,t){return e.getAttribute(t)}function iV(e,t,i){var n=Qf(t);if(eV([i,"deg","rad","turn"],n))return t;var r=Q3.CSS[t+i];if(!Ti.und(r))return r;var s=100,a=document.createElement(e.tagName),o=e.parentNode&&e.parentNode!==document?e.parentNode:document.body;o.appendChild(a),a.style.position="absolute",a.style.width=s+i;var l=s/a.offsetWidth;o.removeChild(a);var c=l*parseFloat(t);return Q3.CSS[t+i]=c,c}function rie(e,t,i){if(t in e.style){var n=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),r=e.style[t]||getComputedStyle(e).getPropertyValue(n)||"0";return i?iV(e,r,i):r}}function nV(e,t){if(Ti.dom(e)&&!Ti.inp(e)&&(cd(e,t)||Ti.svg(e)&&e[t]))return"attribute";if(Ti.dom(e)&&eV(QHe,t))return"transform";if(Ti.dom(e)&&t!=="transform"&&rie(e,t))return"css";if(e[t]!=null)return"object"}function sie(e){if(Ti.dom(e)){for(var t=e.style.transform||"",i=/(\w+)\(([^)]*)\)/g,n=new Map,r;r=i.exec(t);)n.set(r[1],r[2]);return n}}function nGe(e,t,i,n){var r=jA(t,"scale")?1:0+iGe(t),s=sie(e).get(t)||r;return i&&(i.transforms.list.set(t,s),i.transforms.last=t),n?iV(e,s,n):s}function rV(e,t,i,n){switch(nV(e,t)){case"transform":return nGe(e,t,n,i);case"css":return rie(e,t,i);case"attribute":return cd(e,t);default:return e[t]||0}}function sV(e,t){var i=/^(\*=|\+=|-=)/.exec(e);if(!i)return e;var n=Qf(e)||0,r=parseFloat(t),s=parseFloat(e.replace(i[0],""));switch(i[0][0]){case"+":return r+s+n;case"-":return r-s+n;case"*":return r*s+n}}function aie(e,t){if(Ti.col(e))return tGe(e);if(/\s/g.test(e))return e;var i=Qf(e),n=i?e.substr(0,e.length-i.length):e;return t?n+t:n}function aV(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function rGe(e){return Math.PI*2*cd(e,"r")}function sGe(e){return cd(e,"width")*2+cd(e,"height")*2}function aGe(e){return aV({x:cd(e,"x1"),y:cd(e,"y1")},{x:cd(e,"x2"),y:cd(e,"y2")})}function oie(e){for(var t=e.points,i=0,n,r=0;r<t.numberOfItems;r++){var s=t.getItem(r);r>0&&(i+=aV(n,s)),n=s}return i}function oGe(e){var t=e.points;return oie(e)+aV(t.getItem(t.numberOfItems-1),t.getItem(0))}function lie(e){if(e.getTotalLength)return e.getTotalLength();switch(e.tagName.toLowerCase()){case"circle":return rGe(e);case"rect":return sGe(e);case"line":return aGe(e);case"polyline":return oie(e);case"polygon":return oGe(e)}}function lGe(e){var t=lie(e);return e.setAttribute("stroke-dasharray",t),t}function cGe(e){for(var t=e.parentNode;Ti.svg(t)&&Ti.svg(t.parentNode);)t=t.parentNode;return t}function cie(e,t){var i=t||{},n=i.el||cGe(e),r=n.getBoundingClientRect(),s=cd(n,"viewBox"),a=r.width,o=r.height,l=i.viewBox||(s?s.split(" "):[0,0,a,o]);return{el:n,viewBox:l,x:l[0]/1,y:l[1]/1,w:a/l[2],h:o/l[3]}}function uGe(e,t){var i=Ti.str(e)?nie(e)[0]:e,n=t||100;return function(r){return{property:r,el:i,svg:cie(i),totalLength:lie(i)*(n/100)}}}function hGe(e,t){function i(o){o===void 0&&(o=0);var l=t+o>=1?t+o:0;return e.el.getPointAtLength(l)}var n=cie(e.el,e.svg),r=i(),s=i(-1),a=i(1);switch(e.property){case"x":return(r.x-n.x)*n.w;case"y":return(r.y-n.y)*n.h;case"angle":return Math.atan2(a.y-s.y,a.x-s.x)*180/Math.PI}}function hX(e,t){var i=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g,n=aie(Ti.pth(e)?e.totalLength:e,t)+"";return{original:n,numbers:n.match(i)?n.match(i).map(Number):[0],strings:Ti.str(e)||t?n.split(i):[]}}function uie(e){var t=e?fP(Ti.arr(e)?e.map(uX):uX(e)):[];return dP(t,function(i,n,r){return r.indexOf(i)===n})}function hie(e){var t=uie(e);return t.map(function(i,n){return{target:i,id:n,total:t.length,transforms:{list:sie(i)}}})}function dGe(e,t){var i=tV(t);if(/^spring/.test(i.easing)&&(i.duration=tie(i.easing)),Ti.arr(e)){var n=e.length,r=n===2&&!Ti.obj(e[0]);r?e={value:e}:Ti.fnc(t.duration)||(i.duration=t.duration/n)}var s=Ti.arr(e)?e:[e];return s.map(function(a,o){var l=Ti.obj(a)&&!Ti.pth(a)?a:{value:a};return Ti.und(l.delay)&&(l.delay=o?0:t.delay),Ti.und(l.endDelay)&&(l.endDelay=o===s.length-1?t.endDelay:0),l}).map(function(a){return pP(a,i)})}function fGe(e){for(var t=dP(fP(e.map(function(s){return Object.keys(s)})),function(s){return Ti.key(s)}).reduce(function(s,a){return s.indexOf(a)<0&&s.push(a),s},[]),i={},n=function(s){var a=t[s];i[a]=e.map(function(o){var l={};for(var c in o)Ti.key(c)?c==a&&(l.value=o[c]):l[c]=o[c];return l})},r=0;r<t.length;r++)n(r);return i}function pGe(e,t){var i=[],n=t.keyframes;n&&(t=pP(fGe(n),t));for(var r in t)Ti.key(r)&&i.push({name:r,tweens:dGe(t[r],e)});return i}function mGe(e,t){var i={};for(var n in e){var r=Oz(e[n],t);Ti.arr(r)&&(r=r.map(function(s){return Oz(s,t)}),r.length===1&&(r=r[0])),i[n]=r}return i.duration=parseFloat(i.duration),i.delay=parseFloat(i.delay),i}function gGe(e,t){var i;return e.tweens.map(function(n){var r=mGe(n,t),s=r.value,a=Ti.arr(s)?s[1]:s,o=Qf(a),l=rV(t.target,e.name,o,t),c=i?i.to.original:l,u=Ti.arr(s)?s[0]:c,h=Qf(u)||Qf(l),d=o||h;return Ti.und(a)&&(a=c),r.from=hX(u,d),r.to=hX(sV(a,u),d),r.start=i?i.end:0,r.end=r.start+r.delay+r.duration+r.endDelay,r.easing=$5(r.easing,r.duration),r.isPath=Ti.pth(s),r.isColor=Ti.col(r.from.original),r.isColor&&(r.round=1),i=r,r})}var die={css:function(e,t,i){return e.style[t]=i},attribute:function(e,t,i){return e.setAttribute(t,i)},object:function(e,t,i){return e[t]=i},transform:function(e,t,i,n,r){if(n.list.set(t,i),t===n.last||r){var s="";n.list.forEach(function(a,o){s+=o+"("+a+") "}),e.style.transform=s}}};function fie(e,t){var i=hie(e);i.forEach(function(n){for(var r in t){var s=Oz(t[r],n),a=n.target,o=Qf(s),l=rV(a,r,o,n),c=o||Qf(l),u=sV(aie(s,c),l),h=nV(a,r);die[h](a,r,u,n.transforms,!0)}})}function vGe(e,t){var i=nV(e.target,t.name);if(i){var n=gGe(t,e),r=n[n.length-1];return{type:i,property:t.name,animatable:e,tweens:n,duration:r.end,delay:n[0].delay,endDelay:r.endDelay}}}function yGe(e,t){return dP(fP(e.map(function(i){return t.map(function(n){return vGe(i,n)})})),function(i){return!Ti.und(i)})}function pie(e,t){var i=e.length,n=function(s){return s.timelineOffset?s.timelineOffset:0},r={};return r.duration=i?Math.max.apply(Math,e.map(function(s){let a=s.startOnceDelay??0,o=s.pingPongDelayCorrection??0,l=s.pingPongEndDelayCorrection??0;return n(s)+a+o+l+s.duration*(s.loop??1)})):t.duration,r.delay=i?Math.min.apply(Math,e.map(function(s){let a=s.startOnceDelay??0,o=s.pingPongDelayCorrection??0;return n(s)+a+o+s.delay})):t.delay,r.endDelay=i?r.duration-Math.max.apply(Math,e.map(function(s){let a=s.startOnceDelay??0,o=s.pingPongDelayCorrection??0,l=s.pingPongEndDelayCorrection??0;return n(s)+a+o+s.duration*(s.loop??1)-s.endDelay-l})):t.endDelay,r}var dX=0;function xGe(e){var t=Pz($te,e),i=Pz(Z5,e),n=pGe(i,e),r=hie(e.targets),s=yGe(r,n),a=pie(s,i),o=dX;return dX++,pP(t,{id:o,children:[],animatables:r,animations:s,duration:a.duration,delay:a.delay,endDelay:a.endDelay,startOnceDelay:i.startOnceDelay,pingPongDelayCorrection:i.pingPongDelayCorrection,pingPongEndDelayCorrection:i.pingPongEndDelayCorrection})}var Qc=[],fX=[],qC,bGe=function(){function e(){qC=requestAnimationFrame(t)}function t(i){var n=Qc.length;if(n){for(var r=0;r<n;){var s=Qc[r];s.paused?(Qc.splice(r,1),n-=1):(s.tick(i),r++)}e()}else qC=cancelAnimationFrame(qC)}return e}();function SGe(e){document.hidden?(Qc.forEach(function(t){return t.pause(e.timeStamp)}),fX=Qc.slice(0),fs.running=Qc=[]):fX.forEach(function(t){return t.play(e.timeStamp)})}typeof document<"u"&&document.addEventListener("visibilitychange",SGe);function fs(e){e===void 0&&(e={});var t=0,i=0,n=0,r,s,a=0,o=null;function l(T){var I=window.Promise&&new Promise(function(R){return o=R});return T.finished=I,I}var c=xGe(e);l(c);function u(){var T=c.direction;T!=="alternate"&&(c.direction=T!=="normal"?"normal":"reverse"),c.reversed=!c.reversed,s.forEach(function(I){(I.loop===1||I.loop%2===0)&&(I.reversed=c.reversed)})}function h(){c.direction="normal",c.reversed=!1,s.forEach(function(T){return T.reversed=!1})}function d(T){return c.reversed?c.duration-T:T}function p(){t=0,i=d(c.currentTime)*(1/fs.speed)}function g(T,I,R=!1){I&&(c.reversed?I.seek(I.duration*I.loop-(T-I.timelineOffset-I.pingPongDelayCorrection),R):I.seek(T-I.timelineOffset-I.startOnceDelay-I.pingPongDelayCorrection,R))}function x(T,I=!1){if(c.reversed)for(var R=a;R--;)g(T,s[R],I);else for(var O=0;O<a;O++)g(T,s[O],I)}function y(T){var _e,be,we,Me,Ne,Ge,We,ae,He,Ke;var I=0,R=c.animations,O=R.length;for(c.direction!=="alternate"&&((_e=c.parent)==null?void 0:_e.direction)==="alternate"?((be=c.parent)==null?void 0:be.rewind)===!1&&c.reversePlayback===!0&&c.rewind===!1&&((we=c.parent)!=null&&we.reversed&&c.direction==="alternate"?T=c.duration-c.delay+c.endDelay-T:T=c.duration+c.delay-c.endDelay-T):E(!1,(Me=c.parent)==null?void 0:Me.rewind,c.rewind,(Ne=c.parent)==null?void 0:Ne.reversePlayback,c.reversePlayback)&&((Ge=c.parent)!=null&&Ge.reversed&&c.direction==="alternate"?T=c.duration-c.delay+c.endDelay-T:T=c.duration+c.delay-c.endDelay-T);I<O;){var P=R[I],U=P.animatable,H=P.tweens,V=H.length-1,j=H[V];V&&(j=dP(H,function(Oe){return T<Oe.end})[0]||j);let je;(We=c.parent)!=null&&We.reversed&&c.direction==="alternate"?je=Yu(T-j.start-j.endDelay,0,j.duration)/j.duration:je=Yu(T-j.start-j.delay,0,j.duration)/j.duration;for(var J=isNaN(je)?1:j.easing(je),F=j.to.strings,X=j.round,W=[],ne=j.to.numbers.length,Y=void 0,$=0;$<ne;$++){var se=void 0;let Oe,Qe;c.direction!=="alternate"?((ae=c.parent)==null?void 0:ae.rewind)===!1&&c.reversePlayback===!0&&c.rewind===!1?(Oe=j.to.numbers[$],Qe=j.from.numbers[$]||0):(Qe=j.to.numbers[$],Oe=j.from.numbers[$]||0):E(!0,(He=c.parent)==null?void 0:He.rewind,c.rewind,(Ke=c.parent)==null?void 0:Ke.reversePlayback,c.reversePlayback)?(Oe=j.to.numbers[$],Qe=j.from.numbers[$]||0):(Qe=j.to.numbers[$],Oe=j.from.numbers[$]||0),j.isPath?se=hGe(j.value,J*Qe):se=Oe+J*(Qe-Oe),X&&(j.isColor&&$>2||(se=Math.round(se*X)/X)),W.push(se)}var fe=F.length;if(!fe)Y=W[0];else{Y=F[0];for(var te=0;te<fe;te++){F[te];var de=F[te+1],le=W[te];isNaN(le)||(de?Y+=le+de:Y+=le+" ")}}die[P.type](U.target,P.property,Y,U.transforms),P.currentValue=Y,I++}}function b(T){c[T]&&!c.passThrough&&c[T](c)}function A(){c.remaining&&c.remaining!==!0&&c.remaining--}let w={0:!1,1:!0,2:!1,3:!0,4:!1,5:!1,6:!1,7:!1,8:!1,9:!0,10:!0,11:!1,12:!1,13:!1,14:!0,15:!0,16:!1,17:!0,18:!0,19:!1,20:!1,21:!1,22:!0,23:!0,24:!1,25:!0,26:!1,27:!0,28:!1,29:!1,30:!1,31:!1};function E(T,I,R,O,P){return w[T<<4|I<<3|R<<2|O<<1|P]}function D(T,I=!1){var H;var R=c.duration;let O=c.delay,P=R-c.endDelay;(H=c.parent)!=null&&H.reversed&&c.direction==="alternate"&&(O=c.endDelay,P=R-c.delay);var U=d(T);if(c.progress=Yu(U/R*100,0,100),I||(c.reversePlayback=U<c.currentTime),a&&x(U,I),!c.began&&c.currentTime>=0&&(c.began=!0,b("begin")),!c.loopBegan&&c.currentTime>0&&(c.loopBegan=!0,b("loopBegin")),(c.reversed||U>=0)&&U<=O&&c.currentTime!==0&&(y(0),b("change")),(U>=P&&c.currentTime!==R+c.pingPongDelayCorrection||!R)&&(y(R),b("change")),U>O&&U<P?(c.changeBegan||(c.changeBegan=!0,c.changeCompleted=!1,b("changeBegin")),y(U),b("change")):c.changeBegan?(c.changeCompleted=!0,c.changeBegan=!1,b("change"),a&&b("timelineChangeComplete")):c.began&&U>P&&b("changeComplete"),c.currentTime=Yu(U,0,R+c.pingPongDelayCorrection),c.began&&b("update"),T>=R)if(A(),!c.remaining)c.paused=!0,c.completed||(c.completed=!0,b("loopComplete"),b("complete"),!c.passThrough&&"Promise"in window&&(o(),l(c)));else{a?t+=c.duration/fs.speed:t+=c.duration;for(let V of s)V.setStartTime(0),V.remaining=V.loop;b("loopComplete"),c.loopBegan=!1,c.direction==="alternate"?u():a&&h()}}return c.reset=function(){var T=c.direction;c.passThrough=!1,c.currentTime=0,c.progress=0,c.paused=!0,c.began=!1,c.loopBegan=!1,c.changeBegan=!1,c.completed=!1,c.changeCompleted=!1,c.reversePlayback=!1,c.reversed=T==="reverse",c.remaining=c.loop,s=c.children,a=s.length;for(var I=a;I--;)c.children[I].reset();y(c.reversed?c.duration:0)},c.setStartTime=function(T){t=T},c.set=function(T,I){return fie(T,I),c},c.tick=function(T){n=T,t||(t=n),D((n+(i-t))*fs.speed)},c.seek=function(T,I=!1){D(T-t,I)},c.pause=function(T){c.paused=!0,a&&(r=T??performance.now())},c.play=function(T){!c.paused||(c.completed&&c.reset(),c.paused=!1,Qc.push(c),a&&r!==void 0&&(t+=(T??performance.now())-r),qC||bGe())},c.reverse=function(){u(),c.completed=!c.reversed,p()},c.restart=function(){c.reset(),c.play()},c.reset(),c.autoplay&&c.play(),c}function pX(e,t){for(var i=t.length;i--;)eV(e,t[i].animatable.target)&&t.splice(i,1)}function _Ge(e){for(var t=uie(e),i=Qc.length;i--;){var n=Qc[i],r=n.animations,s=n.children;pX(t,r);for(var a=s.length;a--;){var o=s[a],l=o.animations;pX(t,l),!l.length&&!o.children.length&&s.splice(a,1)}!r.length&&!s.length&&n.pause()}}function AGe(e,t){t===void 0&&(t={});var i=t.direction||"normal",n=t.easing?$5(t.easing):null,r=t.grid,s=t.axis,a=t.from||0,o=a==="first",l=a==="center",c=a==="last",u=Ti.arr(e),h=parseFloat(u?e[0]:e),d=u?parseFloat(e[1]):0,p=Qf(u?e[1]:e)||0,g=t.start||0+(u?h:0),x=[],y=0;return function(b,A,w){if(o&&(a=0),l&&(a=(w-1)/2),c&&(a=w-1),!x.length){for(var E=0;E<w;E++){if(!r)x.push(Math.abs(a-E));else{var D=l?(r[0]-1)/2:a%r[0],T=l?(r[1]-1)/2:Math.floor(a/r[0]),I=E%r[0],R=Math.floor(E/r[0]),O=D-I,P=T-R,U=Math.sqrt(O*O+P*P);s==="x"&&(U=-O),s==="y"&&(U=-P),x.push(U)}y=Math.max.apply(Math,x)}n&&(x=x.map(function(V){return n(V/y)*y})),i==="reverse"&&(x=x.map(function(V){return s?V<0?V*-1:-V:Math.abs(y-V)}))}var H=u?(d-h)/y:h;return g+H*(Math.round(x[A]*100)/100)+p}}function wGe(e){e===void 0&&(e={});var t=fs(e);return t.duration=0,t.add=function(i,n){var r=Qc.indexOf(t),s=t.children;r>-1&&Qc.splice(r,1);function a(d){d.passThrough=!0}for(var o=0;o<s.length;o++)a(s[o]);var l=pP(i,Pz(Z5,e));l.targets=l.targets||e.targets;var c=t.duration;l.autoplay=!1,l.timelineOffset=Ti.und(n)?c:sV(n,c),a(t);var u=fs(l);a(u),s.push(u),u.parent=t;var h=pie(s,e);return t.delay=h.delay,t.endDelay=h.endDelay,t.duration=h.duration,u.loop===!0&&(t.duration=1/0),t.seek(0),t.reset(),t.autoplay&&t.play(),t},t}fs.version="3.2.0";fs.speed=1;fs.running=Qc;fs.remove=_Ge;fs.get=rV;fs.set=fie;fs.convertPx=iV;fs.path=uGe;fs.setDashoffset=lGe;fs.stagger=AGe;fs.timeline=wGe;fs.easing=$5;fs.penner=iie;fs.random=function(e,t){return Math.floor(Math.random()*(t-e+1))+e};var mie=fs,mX=new G,gX=new G,vX=new Ei;function MGe(e,t,i,n){if(n===0)return i.copy(e);if(n===1)return i.copy(t);let r=e.w*t.w+e.x*t.x+e.y*t.y+e.z*t.z;if(r>=1)return i.copy(e);let s=1-r*r;if(s<=Number.EPSILON){let u=1-n;return i.w=u*e.w+n*t.w,i.x=u*e.x+n*t.x,i.y=u*e.y+n*t.y,i.z=u*e.z+n*t.z,i.normalize(),i}let a=Math.sqrt(s),o=Math.atan2(a,r),l=Math.sin((1-n)*o)/a,c=Math.sin(n*o)/a;return i.w=e.w*l+t.w*c,i.x=e.x*l+t.x*c,i.y=e.y*l+t.y*c,i.z=e.z*l+t.z*c,i}function Va(e,t,i,n,r,s){let a=i[e]!==void 0?i[e]:void 0,o=n[e];if(o==null)return;let l=a!=null?typeof a=="string"?Number(r.getVariable(a)??0):a:t[e],c=typeof o=="string"?Number(r.getVariable(o)??0):o;if(l!==c)return{update:u=>{let h=qt.lerp(l,c,u);s?t[e]=Math.trunc(h):t[e]=h},start:()=>{t[e]=l},end:()=>{t[e]=c}}}function oV(e,t,i,n,r,s){let a=i[e]?i[e]:void 0,o=n[e];if(!o)return;let l=t[e],c=[...a??l].map(h=>typeof h=="string"?Number(r.getVariable(h)??0):h),u=[...o].map(h=>typeof h=="string"?Number(r.getVariable(h)??0):h);if(!(c.length!==u.length||o5(c,u)))return{update:h=>{c.forEach((d,p)=>{let g=qt.lerp(d,u[p],h);t[e][p]=s?Math.trunc(g):g})},start:()=>{Object.assign(t[e],c)},end:()=>{Object.assign(t[e],u)}}}function K3(e,t,i){return t.forEach((n,r)=>{e.setComponent(r,typeof n=="string"?Number(i.getVariable(n)??0):n)}),e}function yX(e,t,i,n,r){let s=i[e]?i[e]:void 0,a=n[e];if(!a)return;let o=t[e],l=s?K3(new G,s,r):o.clone(),c=K3(new G,a,r);if(!l.equals(c))return{update:u=>{o.lerpVectors(l,c,u)},start:()=>{o.copy(l)},end:()=>{o.copy(c)}}}function xX(e,t,i){return t.forEach((n,r)=>{e.setComponent(r,typeof n=="string"?Number(i.getVariable(n)??0):n)}),e}function J3(e,t,i,n,r){let s=i[e]?i[e]:void 0,a=n[e];if(!a)return;let o=t[e],l=!(o instanceof Ae),c=o instanceof Ae?o:new Ae().fromArray(o),u=s?xX(new Ae,s,r):c.clone(),h=xX(new Ae,a,r);if(!u.equals(h))return{update:d=>{c.lerpVectors(u,h,d),l&&(t[e]=c.toArray())},start:()=>{c.copy(u),l&&(t[e]=c.toArray())},end:()=>{c.copy(h),l&&(t[e]=c.toArray())}}}function EGe(e,t,i,n){let r=i[e]?i[e]:void 0,s=n[e];if(!s)return;let a=t[e],o=r?new Bt().fromArray(r):a.clone(),l=new G,c=new Ei,u=new G;o.decompose(l,c,u);let h=new Bt().fromArray(s),d=new G,p=new Ei,g=new G;if(h.decompose(d,p,g),!o.equals(h))return{update:x=>{vX.slerpQuaternions(c,p,x),mX.lerpVectors(l,d,x),gX.lerpVectors(u,g,x),a.compose(mX,vX,gX)},start:()=>{a.compose(l,c,u)},end:()=>{a.compose(d,p,g)}}}function TGe(e,t,i,n,r){let s=i[e]?i[e]:void 0,a=n[e];if(!a)return;let o=t[e],l=s?typeof s=="string"?r.getColor(s).clone():new gi().setRGB(s.r,s.g,s.b):o.clone(),c=typeof a=="string"?r.getColor(a).clone():new gi().setRGB(a.r,a.g,a.b);if(l.equals(c))return;let u=o.clone();return{update:h=>{var d,p;u.lerpColors(l,c,h),(p=(d=t[e])==null?void 0:d.copy)==null||p.call(d,u)},start:()=>{u.copy(l)},end:()=>{u.copy(c)}}}function mC(e,t,i,n,r){let s=i[e]?i[e]:void 0,a=n[e];if(!a)return;let o=t[e],l=new Qa(o.r,o.g,o.b,o.a),c=s?typeof s=="string"?r.getColor(s).clone():new Qa(s.r,s.g,s.b,s.a):l.clone(),u=typeof a=="string"?r.getColor(a).clone():new Qa(a.r,a.g,a.b,a.a);if(!c.equals(u))return{update:h=>{l.lerpColors(c,u,h);let d=qt.lerp(c.a,u.a,h);l.a=d,t[e]={r:l.r,g:l.g,b:l.b,a:l.a}},start:()=>{l.copy(c)},end:()=>{l.copy(u)}}}function vg(e,t,i,n,r){if(typeof t[e]=="number")return Va(e,t,i??{},n,r);if(Array.isArray(t[e]))return oV(e,t,i??{},n,r)}function CGe(e,t,i,n){var o,l,c,u;let r=[],s=e.cameraType==="OrthographicCamera"?(o=t.orthographic)==null?void 0:o.zoom:(l=t.perspective)==null?void 0:l.zoom,a=e.cameraType==="OrthographicCamera"?(c=i.orthographic)==null?void 0:c.zoom:(u=i.perspective)==null?void 0:u.zoom;if(a!==void 0){let h=s??e.zoom,d=a;h!==d&&r.push({update:p=>{e.zoom=qt.lerp(h,d,p),e.updateProjectionMatrix()},start:()=>{e.zoom=h,e.updateProjectionMatrix()},end:()=>{e.zoom=d,e.updateProjectionMatrix()}})}if(i.targetOffset!==void 0){let h=Va("targetOffset",e,t,i,n);h&&r.push(h)}return r}function DGe(e,t,i,n){if(i.scaleBaked===void 0)return;let r=(t.scaleBaked??e.data.geometry.scaleBaked).map(o=>typeof o=="string"?Number(n.getVariable(o)??0):o),s=i.scaleBaked.map(o=>typeof o=="string"?Number(n.getVariable(o)??0):o);if(A0.isEqual(r,s))return;let a=[];return a.push({update:o=>{e.updateGeometryInteractions({scaleBaked:[qt.lerp(r[0],s[0],o),qt.lerp(r[1],s[1],o),qt.lerp(r[2],s[2],o)]},n),e.invalidateDownstreamBooleanData(),e.refreshAttachedClonersInteractions()},start:()=>{e.updateGeometryInteractions({scaleBaked:r},n),e.invalidateDownstreamBooleanData(),e.refreshAttachedClonersInteractions()},end:()=>{e.updateGeometryInteractions({scaleBaked:s},n),e.invalidateDownstreamBooleanData(),e.refreshAttachedClonersInteractions()}}),a}function RGe(e,t,i,n){if(!i.extrusion)return;let r=e.extrusion,s=t.extrusion??{},a=i.extrusion,o=[];return X$.forEach(l=>{let c=vg(l,r,s,a,n);c&&o.push(c)}),o}function PGe(e,t,i,n){let r=[];if(!("geometry"in i))return r;let s=e.geometry.userData.parameters,a="geometry"in t?t.geometry:{},o=i.geometry;if(e instanceof Iw){let l=DGe(e,a,o,n);l&&r.push(...l)}else{let l={};if(Object.assign(l,gd(s,EI),gd(a,EI)),EI.forEach(c=>{let u=vg(c,l,a,o,n);u&&r.push(u)}),e instanceof W5){Object.assign(l,{extrusion:{...s.extrusion}});let c=RGe(l,a,o,n);c&&r.push(...c)}r.length&&r.push({update:c=>{e.updateGeometryInteractions(l,n),e.updateGeometryGroupsIfNeeded(),e.refreshAttachedClonersInteractions()},start:c=>{e.updateGeometryInteractions(l,n),e.updateGeometryGroupsIfNeeded(),e.refreshAttachedClonersInteractions()},end:c=>{e.updateGeometryInteractions(l,n),e.updateGeometryGroupsIfNeeded(),e.refreshAttachedClonersInteractions()}})}return r}function OGe(e,t,i,n){let r=[];if(i.intensity!==void 0){let s=Va("intensity",e,t,i,n);s&&r.push(s)}if(i.color!==void 0){let s=TGe("color",e,t,i,n);s&&r.push(s)}return r}function BGe(e,t,i,n){let r=[];if(Array.isArray(e.material)){if(!("materials"in i&&i.materials))return r;let s="materials"in t&&t.materials?t.materials:[],a=i.materials;e.material.forEach((o,l)=>{if(!a[l])return;let c=s[l]??{},u=a[l];typeof c=="string"||typeof u=="string"||r.push(...bX(o,c,u,n))})}else{if(!("material"in i&&i.material))return r;let s="material"in t&&t.material?t.material:{},a=i.material;if(typeof s=="string"||typeof a=="string")return r;r.push(...bX(e.material,s,a,n))}return r}function bX(e,t,i,n){var a;let r=[],s=y1(i,n)||!!t.layers&&y1(t,n);r.push(GGe(e,s));for(let o of e.layers){let l=(a=t.layers)==null?void 0:a.data(o.uuid),c=i.layers.data(o.uuid);if(!c||o.type!=="light"&&(!(o.visible??!0)||!(c.visible??!0)))continue;let u=o.getNames().filter(h=>!k$.some(d=>h.includes(d)));for(let h of u)try{let d=o.getValue(h),p;if(h==="colors")p=VGe(o,l,c,h);else if(Array.isArray(d))h==="steps"&&(p=FGe(o,l,c,h));else if(typeof d=="number")p=IGe(o,l,c,h,n);else{if(typeof d=="boolean")continue;d instanceof Ae?p=LGe(o,l,c,h):d instanceof G?p=UGe(o,l,c,h,n):d instanceof Qa?p=zGe(o,l,c,h,n):d instanceof gi?p=NGe(o,l,c,h,n):"isTexture"in d&&(p=HGe(o,l,c,h))}p&&(Array.isArray(p)?r.push(...p):r.push(p))}catch(d){console.error(`lerpMaterial: unexpected material layer for ${h}`,d)}}return r}function IGe(e,t,i,n,r){if(!e.hasValue(n)||!(n in i))return;let s=t?t[n]:e.getValue(n),a=i[n],o=typeof s=="string"?Number(r.getVariable(s)??0):s,l=typeof a=="string"?Number(r.getVariable(a)??0):a;if(o!==l)return{update:c=>{e.setValue(n,qt.lerp(o,l,c))},start:()=>{e.setValue(n,o)},end:()=>{e.setValue(n,l)}}}function LGe(e,t,i,n){if(!e.hasValue(n)||!(n in i))return;let r=e.getValue(n),s=t?new Ae().fromArray(t[n]):r.clone(),a=new Ae().fromArray(i[n]);if(!s.equals(a))return{update:o=>{r.lerpVectors(s,a,o)},start:()=>{r.copy(s)},end:()=>{r.copy(a)}}}function UGe(e,t,i,n,r){if(!e.hasValue(n)||!(n in i))return;let s=e.getValue(n),a=t?t[n]:void 0,o=i[n],l=a?K3(new G,a,r):s.clone(),c=K3(new G,o,r);if(!l.equals(c))return{update:u=>{s.lerpVectors(l,c,u)},start:()=>{s.copy(l)},end:()=>{s.copy(c)}}}function NGe(e,t,i,n,r){if(!e.hasValue(n)||!(n in i))return;let s=t?t[n]:void 0,a=i[n],o=e.getValue(n),l=s?typeof s=="string"?r.getColor(s).clone():new gi().setRGB(s.r,s.g,s.b):o.clone(),c=typeof a=="string"?r.getColor(a).clone():new gi().setRGB(a.r,a.g,a.b);if(l.equals(c))return;let u=o.clone();return{update:h=>{e.getValue(n)!==u&&e.setValue(n,u),u.lerpColors(l,c,h)},start:()=>{u.copy(l)},end:()=>{u.copy(c)}}}function zGe(e,t,i,n,r){if(!e.hasValue(n)||!(n in i))return;let s=t?t[n]:void 0,a=i[n],o=e.getValue(n),l=s?typeof s=="string"?r.getColor(s).clone():new gi().setRGB(s.r,s.g,s.b):o.clone(),c=typeof a=="string"?r.getColor(a).clone():new Qa(a.r,a.g,a.b,a.a);if(l.equals(c))return;let u=o.clone();return{update:h=>{e.getValue(n)!==u&&e.setValue(n,u),u.lerpColors(l,c,h)},start:()=>{u.copy(l)},end:()=>{u.copy(c)}}}function FGe(e,t,i,n="steps"){if(!e.hasValue(n)||!(n in i))return;let r=[],s=e.getValue(n),a=t?t[n]:s,o=i[n];return o5(a,o)||r.push({update:l=>{let c=[...s];for(let u=0;u<s.length;++u){let h=a[u],d=o[u];c[u]=qt.lerp(h,d,l)}e.setValue(n,c)},start:()=>{e.setValue(n,a)},end:()=>{e.setValue(n,o)}}),r.length?r:void 0}function VGe(e,t,i,n="colors"){if(!e.hasValue(n)||!(n in i))return;let r=[],s=e.getValue(n),a=t?t[n]:s.map(l=>l.toArray()),o=i[n];for(let l=0;l<s.length;++l){let c=[...a[l]],u=[...o[l]];_3.isEqual(c,u)||r.push({update:h=>{s[l].fromArray(_3.lerp(c,u,h))},start:()=>{s[l].fromArray(c)},end:()=>{s[l].fromArray(u)}})}return r.length?r:void 0}function HGe(e,t,i,n="texture"){var y,b;if(!e.hasValue(n)||!(n in i))return;let r=e.getNode("rotation"),s=((y=t==null?void 0:t[n])==null?void 0:y.rotation)??0,a=((b=i[n])==null?void 0:b.rotation)??0;if(r&&s!==a)return{update:A=>{r.value=qt.lerp(s,a,A)*qt.DEG2RAD},start:()=>{r.value=s*qt.DEG2RAD},end:()=>{r.value=a*qt.DEG2RAD}};let o=e.getNode("mat");if(!o)return;let l=t?t[n]:o,c=i[n],u=[...l.repeat],h=[...l.offset],d=[...c.repeat],p=[...c.offset],g=l.rotation??0,x=c.rotation??0;if(!Gf.isEqual(u,d)||!Gf.isEqual(h,p)||g!==x)return{update:A=>{o.repeat=Gf.lerp(u,d,A),o.offset=Gf.lerp(h,p,A),o.rotation=qt.lerp(g,x,A),o.updateMatrix()},start:()=>{o.repeat=[...u],o.offset=[...h],o.rotation=g,o.updateMatrix()},end:()=>{o.repeat=[...d],o.offset=[...p],o.rotation=x,o.updateMatrix()}}}function GGe(e,t){return{update:()=>{e.transparent=t}}}var SL=new G,SX=new qs;function kGe(e,t,i,n,r){var g,x,y,b,A,w;let s=[],a,o,l,c,u,h,d,p;if(e instanceof _a?(a=J3("position",e,t,i,r),a&&s.push(a),l=Va("rotation",e,t,i,r),l&&s.push(l),c=J3("shear",e,t,i,r),c&&s.push(c)):(p={slide:((g=t.pathSnapping)==null?void 0:g.slide)??((x=e.updatedPathSnapping)==null?void 0:x.slide)??((y=e.dataPatched.pathSnapping)==null?void 0:y.slide)??0,offset:((b=t.pathSnapping)==null?void 0:b.offset)??((A=e.updatedPathSnapping)==null?void 0:A.offset)??((w=e.dataPatched.pathSnapping)==null?void 0:w.offset)??0},h=Va("slide",p,t.pathSnapping??e.updatedPathSnapping??e.dataPatched.pathSnapping,i.pathSnapping??e.dataPatched.pathSnapping,r),h&&s.push(h),d=Va("offset",p,t.pathSnapping??e.updatedPathSnapping??e.dataPatched.pathSnapping,i.pathSnapping??e.dataPatched.pathSnapping,r),d&&s.push(d),!h&&!d&&(a=yX("position",e,t,i,r),a&&s.push(a),o=yX("scale",e,t,i,r),o&&s.push(o),l=jGe(e,t,i,n,r),l&&s.push(l),u=EGe("hiddenMatrix",e,t,i),u&&s.push(u))),a||o||l||u||h||d){let E=e instanceof _a?()=>{e.updateWorldMatrix(!0,!1,!0),e.resetBBoxNeedsUpdate()}:()=>{var D;e.updateMatrix(),e.hasNonUniformScale&&(e.updateMatrixWorld(),e.updateMatrixWorldSVD()),(D=e.parent)!=null&&D.matrixWorldFusedFalse&&(e.matrixWorld.multiplyMatrices(e.parent.matrixWorldFusedFalse,e.matrix),e.matrixWorldNeedsUpdate=!1),ku(e)&&kf(e.parent)&&e.invalidateDownstreamBooleanData(!0),e.updatePathSnapping(Object.assign({},t.pathSnapping,p))};s.push({update:E,start:E,end:E})}return s}function jGe(e,t,i,n,r){var u;let s=t!=null&&t.rotation?t.rotation.map(h=>(typeof h=="string"?Number(r.getVariable(h)??0):h)*qt.DEG2RAD):void 0,a=(u=i.rotation)==null?void 0:u.map(h=>(typeof h=="string"?Number(r.getVariable(h)??0):h)*qt.DEG2RAD);if(!a)return;let o=s?new G().fromArray(s):new G().setFromEuler(e.rotation),l=new G().fromArray(a);if(o.equals(l))return;let c=SL.subVectors(l,o);if(n&&c.toArray().every(h=>Math.abs(h)<2*Math.PI)){let h=new Ei().setFromEuler(SX.setFromVector3(o)),d=new Ei().setFromEuler(SX.setFromVector3(l));return{update:p=>{MGe(h,d,e.quaternion,p)},start:()=>{e.rotation.setFromVector3(o)},end:()=>{e.rotation.setFromVector3(l)}}}else return{update:h=>{SL.lerpVectors(o,l,h),e.rotation.setFromVector3(SL)},start:()=>{e.rotation.setFromVector3(o)},end:()=>{e.rotation.setFromVector3(l)}}}function WGe(e,t,i,n){let r=[];if(!("cloner"in i)||!e.cloner)return r;let s=e.cloner,a="cloner"in t?t.cloner:{},o=i.cloner;N$.forEach(p=>{let g;p==="count"?g=Va("count",s.parameters,a,o,n,!0):g=vg(p,s.parameters,a??{},o,n),g&&r.push(g)});let l=XGe(s,a,o,n);l!=null&&l.length&&r.push(...l);let c=qGe(s,a,o,n);c!=null&&c.length&&r.push(...c);let u=YGe(s,a,o,n);u!=null&&u.length&&r.push(...u);let h=QGe(s,a,o,n);h!=null&&h.length&&r.push(...h);let d=KGe(s,a,o,n);return d!=null&&d.length&&r.push(...d),r.length&&r.push({update:()=>{s.update()}}),r}function XGe(e,t,i,n){if(e.parameters.type!=="radial")return;let r=t.radial,s=i.radial;if(!s)return;let a=e.parameters.radial,o=[];return z$.forEach(l=>{let c=vg(l,a,r??{},s,n);c&&o.push(c)}),o}function qGe(e,t,i,n){if(e.parameters.type!=="linear")return;let r=t.linear,s=i.linear;if(!s)return;let a=[],o=e.parameters.linear;return F$.forEach(l=>{let c=vg(l,o,r??{},s,n);c&&a.push(c)}),a}function YGe(e,t,i,n){if(e.parameters.type!=="grid")return;let r=t.grid,s=i.grid;if(!s)return;let a=[],o=e.parameters.grid;return V$.forEach(l=>{let c;l==="count"?c=oV(l,o,r??{},s,n,!0):c=vg(l,o,r??{},s,n),c&&a.push(c)}),a}function QGe(e,t,i,n){if(e.parameters.type!=="toObject")return;let r=t.toObject,s=i.toObject;if(!s)return;let a=[],o=e.parameters.toObject;return H$.forEach(l=>{let c;l==="count"?c=Va(l,o,r??{},s,n,!0):c=vg(l,o,r??{},s,n),c&&a.push(c)}),a}function KGe(e,t,i,n){if(!e.parameters.randomness)return;let r=t.randomnessObject,s=i.randomnessObject;if(!s)return;let a=[],o=e.parameters.randomnessObject;return G$.forEach(l=>{let c=vg(l,o,r??{},s,n);c&&a.push(c)}),a}function JGe(e,t){return{update:()=>{e instanceof pa&&(e.fill.enabled=t)}}}function ZGe(e,t){return{update:()=>{e instanceof pa&&(e.stroke.enabled=t)}}}function $Ge(e,t){return{update:()=>{e instanceof pa&&(e.dropShadow.enabled=t)}}}function eke(e,t){return{update:()=>{e instanceof pa&&(e.innerShadow.enabled=t)}}}function tke(e,t){return{update:()=>{e instanceof pa&&(e.backgroundBlur.enabled=t)}}}function ike(e,t){return{update:()=>{e instanceof pa&&(e.layerBlur.enabled=t)}}}function nke(e,t,i,n,r){let s=[],a,o,l,c,u,h,d,p,g,x,y,b,A,w,E;if("width"in e&&(a=Va("width",e,t,i,r),a&&s.push(a)),"height"in e&&(o=Va("height",e,t,i,r),o&&s.push(o)),e instanceof pa||e instanceof yd){let D={...t.fill},T={...i.fill};D.enabled!==void 0&&D.enabled!==T.enabled&&(s.push(JGe(e,!0)),D.enabled||Object.assign(D,{enabled:!0,color:{...D.color,a:0}}),T.enabled||Object.assign(T,{enabled:!0,color:{...T.color,a:0}})),l=mC("color",e.fill,D,T,r),l&&s.push(l)}if(e instanceof pa){let D={...t.stroke},T={...i.stroke};(D.enabled||T.enabled)&&(s.push(ZGe(e,!0)),D.enabled||Object.assign(D,{enabled:!0,color:{...D.color,a:0}}),T.enabled||Object.assign(T,{enabled:!0,color:{...T.color,a:0}})),c=mC("color",e.stroke,D,T,r),c&&s.push(c),u=Va("thickness",e.stroke,D,T,r),u&&s.push(u)}if(e instanceof pa){let D={...t.dropShadow},T={...i.dropShadow};(D.enabled||T.enabled)&&(s.push($Ge(e,!0)),D.enabled||Object.assign(D,{enabled:!0,color:{...D.color,a:0}}),T.enabled||Object.assign(T,{enabled:!0,color:{...T.color,a:0}})),h=mC("color",e.dropShadow,D,T,r),h&&s.push(h),d=Va("blurRadius",e.dropShadow,D,T,r),d&&s.push(d),g=Va("spread",e.dropShadow,D,T,r),g&&s.push(g),p=J3("offset",e.dropShadow,D,T,r),p&&s.push(p)}if(e instanceof pa){let D={...t.innerShadow},T={...i.innerShadow};(D.enabled||T.enabled)&&(s.push(eke(e,!0)),D.enabled||Object.assign(D,{enabled:!0,color:{...D.color,a:0}}),T.enabled||Object.assign(T,{enabled:!0,color:{...T.color,a:0}})),x=mC("color",e.innerShadow,D,T,r),x&&s.push(x),y=Va("blurRadius",e.innerShadow,D,T,r),y&&s.push(y),A=Va("spread",e.innerShadow,D,T,r),A&&s.push(A),b=J3("offset",e.innerShadow,D,T,r),b&&s.push(b)}if(e instanceof pa||e instanceof yd){let D={...t.backgroundBlur},T={...i.backgroundBlur};(D.enabled||T.enabled)&&(s.push(tke(e,!0)),D.enabled||Object.assign(D,{enabled:!0,radius:0}),T.enabled||Object.assign(T,{enabled:!0,radius:0})),w=Va("radius",e.backgroundBlur,D,T,r),w&&s.push(w)}if(e instanceof pa){let D={...t.layerBlur},T={...i.layerBlur};(D.enabled||T.enabled)&&(s.push(ike(e,!0)),D.enabled||Object.assign(D,{enabled:!0,radius:0}),T.enabled||Object.assign(T,{enabled:!0,radius:0})),E=Va("radius",e.layerBlur,D,T,r),E&&s.push(E)}if(e instanceof yd||e instanceof xM){let D=oV("cornerRadius",e,t,i,r);D&&s.push(D)}return s}function _X(e,t,i,n,r){let s=[];return e.data.visible&&s.push(...kGe(e,t,i,r,n)),e instanceof _a?s.push(...nke(e,t,i,r,n)):(e.data.visible&&s.push(...WGe(e,t,i,n)),ku(e)?(e instanceof Ds&&e.data.visible&&s.push(...PGe(e,t,i,n)),e.data.visible&&s.push(...BGe(e,t,i,n))):GFe(e)?e.data.visible&&s.push(...OGe(e,t,i,n)):HFe(e)&&s.push(...CGe(e,t,i,n))),s.length?{update:a=>{s.forEach(o=>o.update(a))},start:a=>{s.forEach(o=>{var l;return(l=o.start)==null?void 0:l.call(o,a)})},end:a=>{s.forEach(o=>{var l;return(l=o.end)==null?void 0:l.call(o,a)})}}:void 0}var AX=new G;function lV(e,t,i=!1){var s;let n=[],r=a=>{let o=a.data;delete a.states,a.currentState=null,a.reversibleToState=null,a.currentTransitionEvent=null;for(let l of o.states){let c={...l.data};a.states||(a.states={}),a.states[l.id]=c0.patch(o,c)}MX(e.scene,a,null,t,o.events.find(l=>l.data.type==="Follow"||l.data.type==="LookAt")!==void 0),wX(e)};e.scene.traverse2D(r),e.traverseChildren(a=>{var u,h,d,p,g,x;if(i&&((u=a.rigidBody)==null||u.setTranslation(a.position0,!0),(h=a.rigidBody)==null||h.setRotation(a.rotation0,!0),(d=a.rigidBody)==null||d.setLinvel(AX,!0),(p=a.rigidBody)==null||p.setAngvel(AX,!0)),!dn.is(a))return;let o=a.uuid,l=a.data;if(delete a.states,a.uuid===Fb)return;let c=!1;n.some(y=>{var b;return(b=e.scene.find(o))==null?void 0:b.isDescendantOf(y)})?c=!0:((g=l.physics)==null?void 0:g.fusedBody)===!0&&l.physics.rigidBody==="dynamic"&&n.push(o),a.data=l,a.currentState=null,a.reversibleToState=null,a.currentTransitionEvent=null;for(let y of l.states){let b={...y.data};e.data.globalPhysics.usePhysics===!0&&l.physics&&(l.physics.rigidBody==="dynamic"||c)&&(y.data.position!==void 0&&delete b.position,y.data.rotation!==void 0&&delete b.rotation,y.data.hiddenMatrix!==void 0&&delete b.hiddenMatrix),a.states||(a.states={}),a.states[y.id]=a0.patch(l,b)}MX(e.scene,a,null,t,l.events.find(y=>y.data.type==="Follow"||y.data.type==="LookAt")!==void 0),a instanceof mo&&a.frame&&(a.frame.traverse(y=>r(y)),(x=a.uiCanvas)==null||x.applySize())}),wX(e),e.frame&&(e.frame.traverse(a=>r(a)),(s=e.uiCanvas)==null||s.applySize())}function wX(e){e.traverseEntity(t=>{for(let i of t.data.events){let n=[];switch(i.data.type){case"Follow":case"MouseHover":case"Scroll":case"MouseDown":case"MouseUp":case"MousePress":case"KeyUp":case"KeyDown":case"KeyPress":case"Collision":n.push(...i.data.actions);break;case"GameControl":for(let r of Object.values(i.data.gameActions))n.push(...r);break;case"DragDrop":n.push(...i.data.dragDropActions.drag,...i.data.dragDropActions.drop);break;case"Conditional":n.push(...i.data.inActions,...i.data.outActions);break}for(let r of n)if(r.data.type==="Create"&&r.data.hideBase==="Yes"){let s=e.scene.find(r.data.object);s&&(s.visible=!1)}}})}function MX(e,t,i,n,r=!1){if(t instanceof Ds&&!(t instanceof H0)&&t.removeInteractionGeometry(n),t instanceof _a?t.changeSelectedState(i,{shared:n},r):t.changeSelectedState(i,{scene:e,shared:n},r),t instanceof Ds&&t.updateGeometryGroupsIfNeeded(),t instanceof xo&&t.updateCameraState(t.dataPatched,{scene:e,shared:n}),!(t instanceof _a)){if(t.cloner)for(let s of t.cloner.children)s.playModeVisible=void 0;t.updateVisible()}}function gie(e){let t;if(e.easing===5){let{control1:i,control2:n}=e;t=`cubicBezier(
			${i[0]}, ${i[1]}, ${n[0]}, ${n[1]}
		)`}else if(e.easing===6){let{mass:i,stiffness:n,damping:r,velocity:s}=e;t=`spring( ${i}, ${n}, ${r}, ${s} )`}else{let i;switch(e.easing){case 0:i=Em.linear;break;case 1:i=Em.ease;break;case 2:i=Em.easeIn;break;case 3:i=Em.easeOut;break;case 4:i=Em.easeInOut;break;default:i=Em.linear}let[n,r,s,a]=i;t=`cubicBezier( ${n}, ${r}, ${s}, ${a} )`}return{duration:Math.max(e.duration,1e-4),easing:t}}function Bz(e){let t={delay:0,loop:e.repeat===-1?!0:e.repeat+1};if(e.repeat===0)t.direction="normal",t.rewind=!1;else switch(e.direction){case"pingpong":t.direction="alternate",t.rewind=!1;break;case"pingpong-rewind":t.direction="alternate",t.rewind=!0;break;default:t.direction="normal",t.rewind=!1;break}switch(t.delay=0,t.endDelay=0,t.startOnceDelay=0,t.pingPongDelayCorrection=0,t.pingPongEndDelayCorrection=0,e.delayDirection){case"start-once":t.startOnceDelay=e.delay;break;case"start":t.delay=e.delay;break;case"end":t.endDelay=e.delay;break;case"start-end":case void 0:t.delay=e.delay,t.endDelay=e.delay;break}return t.direction==="alternate"&&(t.delay/=2,t.endDelay/=2,e.delayDirection==="start"?(t.pingPongDelayCorrection=t.delay,typeof t.loop=="number"&&t.loop%2===0&&(t.pingPongEndDelayCorrection=t.delay)):e.delayDirection==="end"?typeof t.loop=="number"&&t.loop%2!==0&&(t.pingPongEndDelayCorrection=t.endDelay):e.delayDirection==="start-end"&&(t.pingPongDelayCorrection=t.delay,t.pingPongEndDelayCorrection=t.endDelay)),t}var rke={type:"beginState"},ske={type:"completeState",isfromEntity:!1},EX=class{constructor(e,t,i,n,r,s){if(this.object=e,this.data=n,this.sharedAssets=r,this.allowSlerp=s,this.targets={t:0},this.firstLoop=!0,this._changeBegan=!1,this._changeCompleted=!0,this.onChange=()=>{this.callback&&(this.callback.update(this.targets.t),this.object.requestRender()),this.targets.t===0||this.targets.t===1?this._changeCompleted||(this._changeCompleted=!0,this._changeBegan=!1,this.onChangeComplete()):(this._changeCompleted&&(this._changeCompleted=!1),this._changeBegan||(this._changeBegan=!0,this.onChangeBegin()))},this.onChangeBegin=()=>{this.object.reversibleToState=this.to.id;let a=this.targets.t>.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=a,this.object.dispatchEvent({type:"beginState",state:a}),this.object instanceof _a||this.object.traverseEntity(o=>{o!==this.object&&o instanceof xo&&o.dispatchEvent(rke)})},this.onChangeComplete=()=>{this.firstLoop&&(this.onFirstLoop(),this.firstLoop=!1),this.object.reversibleToState=this.to.id;let a=this.targets.t<.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=a,this.object.dispatchEvent({type:"completeState",state:a}),this.object instanceof _a||this.object.traverseEntity(o=>{o!==this.object&&o instanceof xo&&o.dispatchEvent(ske)})},this.onFirstLoop=()=>{this.useCurrentState&&(this.callback=_X(this.object,this.from.data,this.to.data,this.sharedAssets,this.allowSlerp))},t===void 0){let a=YC(this.object,this.object.currentState===i?this.object.prevState:this.object.currentState);if(!a)throw new Error("Missing property");this.from=a}else{let a=YC(this.object,t);if(!a)throw new Error("Missing property");this.from=a}if(i===void 0)throw new Error("Missing property");{let a=YC(this.object,i);if(!a)throw new Error("Missing property");this.to=a}this.useCurrentState=t===void 0||i===void 0,this.params={targets:this.targets,t:1,autoplay:!1,...Bz(n),...gie(n),change:this.onChange},this.callback=_X(this.object,t===void 0?{}:this.from.data,i===void 0?{}:this.to.data,this.sharedAssets,this.allowSlerp)}get changeBegan(){return this._changeBegan}get changeCompleted(){return this._changeCompleted}},vie=class extends Ka{constructor(e,t,i,n,r){var a;if(super(),this.eventType=e,this.data=t,this.page=i,this.shared=n,this.condition=r,this.toggleIsForward=!1,this.timelineNeedsRebuild=!1,this.hasPlayedOnce=!1,this.onTimelineChangeComplete=()=>{var o;this.data.tweens[0].data.direction!=="normal"&&(this.toggleIsForward=!this.toggleIsForward),this.timelineNeedsRebuild!==!1&&((o=this.timeline)==null||o.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!1,isRebuild:!0}),this.timeline.play())},!t.object)throw new Error("Missing property");let s=this.page.scene.find(t.object)??((a=this.page.uiCanvas)==null?void 0:a.find(t.object))??this.page.scene.find2DInUIObjects(t.object);if(!s)throw new Error("Missing property");if(!s.states)throw new Error("Missing property");if(this.object=s,t.tweens.length<2)throw new Error("Missing property");this.tweens=Array(this.data.tweens.length-1),this.startOnceDelay=t.tweens[0].data.delayDirection==="start-once"?t.tweens[0].data.delay:0,this.init()}get playing(){var e;return((e=this.timeline)==null?void 0:e.paused)===!1}get changeBegan(){return this.tweens.some(e=>e.changeBegan)??!1}init(){this.initialCurrentState=YC(this.object,this.object.currentState).id,this.toggleIsForward=!1}get currentState(){return this.data.runMode==="Toggle"&&S9(this.eventType)?this.initialCurrentState:this.object.currentState}buildTimeline({isForward:e=!0,needsRebuild:t=!1,isRebuild:i=!1}={}){var n,r,s,a;try{let o=Bz(this.data.tweens[0].data);i&&typeof o.loop=="number"&&o.loop--,(n=this.timeline)==null||n.pause(),this.timeline=mie.timeline({autoplay:!1,...o,...o.loop===!0||o.loop>1?{timelineChangeComplete:this.onTimelineChangeComplete}:{}});let l=this.tweens.findIndex(c=>c==null?void 0:c.changeBegan);if(t===!0&&(this.timelineNeedsRebuild=!0),e){let c=l===-1?0:l;for(let u=c;u<this.data.tweens.length-1;u++){let h=this.data.tweens[u],d=this.data.tweens[u+1],p;u===c&&(this.object.wasMovedByUser===!0||((r=this.object.previousAction)==null?void 0:r.changeBegan)===!0)?(p=void 0,this.object instanceof xo&&(this.object.wasMovedByUser=!1)):p=h.data.state===void 0?this.currentState:h.data.state;let g=new EX(this.object,p,d.data.state===void 0?this.currentState:d.data.state,d.data,this.shared,this.data.allowSlerp??!1);l!==-1&&u===c&&Object.assign(g.params,{startOnceDelay:0}),this.tweens[u]=g,this.timeline.add(g.params,this.timeline.duration+(u===c?o.delay:0))}this.timeline.duration+=o.endDelay}else{let c=l===-1?this.data.tweens.length-1:l+1;for(let u=c;u>0;u--){let h=this.data.tweens[u],d=this.data.tweens[u-1],p;u===c&&(this.object.wasMovedByUser===!0||((s=this.object.previousAction)==null?void 0:s.changeBegan)===!0)?(p=void 0,this.object instanceof xo&&(this.object.wasMovedByUser=!1)):p=h.data.state===void 0?this.currentState:h.data.state;let g=new EX(this.object,p,d.data.state===void 0?this.currentState:d.data.state,h.data,this.shared,this.data.allowSlerp??!1);l!==-1&&u===c&&Object.assign(g.params,{startOnceDelay:0}),this.tweens[u-1]=g,this.timeline.add(g.params,this.timeline.duration+(u===c?o.endDelay:0))}this.timeline.duration+=o.delay}}catch(o){o instanceof Error&&console.error(o.message)}((a=this.object.previousAction)==null?void 0:a.playing)===!0&&this.object.previousAction.pause(),this.object.previousAction=this}play(){if(yr(this.shared,this.condition)===!1||S9(this.eventType)&&this.data.runMode==="Once"&&this.hasPlayedOnce||(this.hasPlayedOnce=!0,this.playing))return!1;clearTimeout(this.timeoutId);let e=Bz(this.data.tweens[0].data).pingPongDelayCorrection;this.timeoutId=window.setTimeout(()=>{try{this.buildTimeline(),this.timeline.play()}catch(t){t instanceof Error&&console.error(t.message)}},this.startOnceDelay+e)}pause(){var e;(e=this.timeline)==null||e.pause(),clearTimeout(this.timeoutId),this.tweens=Array(this.data.tweens.length-1),delete this.timeoutId}stop(){this.pause();let e=this.data.tweens[0].data.state===void 0?this.initialCurrentState:this.data.tweens[0].data.state;this.object instanceof _a?this.object.changeSelectedState(e,{shared:this.shared}):this.object.changeSelectedState(e,{scene:this.page.scene,shared:this.shared}),this.object.currentState=e}seek(e){var t;if(yr(this.shared,this.condition)===!1)return!1;this.timeline===void 0&&this.buildTimeline(),(t=this.timeline)==null||t.seek(e*this.timeline.duration,!0)}toggle(e){var t;if(yr(this.shared,this.condition)===!1)return!1;clearTimeout(this.timeoutId),this.toggleIsForward=e??!this.toggleIsForward,this.playing?((t=this.timeline)==null||t.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!0}),this.timeline.play()):this.timeoutId=window.setTimeout(()=>{var i;(i=this.timeline)==null||i.pause(),this.buildTimeline({isForward:this.toggleIsForward}),this.timeline.play()},this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause()}};function YC(e,t){var r;let i,n;if(typeof t=="string"?(i=t,n=(r=e.states)==null?void 0:r[i]):t===null&&(i=null,n=e.data),!(i===void 0||n===void 0))return{id:i,data:n}}var ake={type:"beginState"},TX={type:"completeState",isfromEntity:!1},CX={type:"requestRender"},yie=class extends Ka{constructor(e,t,i,n){super(),this.data=e,this.page=t,this.shared=i,this.condition=n,this.toggleIsForward=!1,this.posStart=new G,this.posEnd=new G,this.qStart=new Ei,this.qEnd=new Ei,this.zoomStart=1,this.zoomEnd=1}init(){}get playing(){return this.animation&&this.animation.began&&!this.animation.completed}buildAnimation(e=!1){if(!this.data.animate)return;let t=this.page.scene.find(this.data.targetCamera);if(!t||!t.visible)throw new ReferenceError("Target camera not founded or not visible");let i={t:0};this.posStart.copy(this.page.activeCamera.position),this.qStart.copy(this.page.activeCamera.quaternion),this.zoomStart=this.page.activeCamera.zoom,this.animation=mie({targets:i,t:1,...gie(this.data),update:()=>{i.t===0&&(this.data.runMode==="Toggle"&&!this.toggleIsForward?this.fromCamera&&(this.posEnd.copy(this.fromCamera.position),this.qEnd.copy(this.fromCamera.quaternion),this.zoomEnd=this.fromCamera.zoom,this.switchCamera(this.fromCamera.uuid)):(this.posEnd.copy(t.position),this.qEnd.copy(t.quaternion),this.zoomEnd=t.zoom,this.fromCamera=this.page.activeCamera,this.switchCamera(t.uuid)),this.page.activeCamera.dispatchEvent(ake));let n=this.page.activeCamera;n.position.lerpVectors(this.posStart,this.posEnd,i.t),n.quaternion.slerpQuaternions(this.qStart,this.qEnd,i.t),n.zoom=this.zoomStart+(this.zoomEnd-this.zoomStart)*i.t,n.wasMovedBySwitchCameraAction=!0,n.updateMatrix(),n.updateMatrixWorld(),n.updateProjectionMatrix(),n.dispatchEvent(CX),i.t===1&&n.dispatchEvent(TX)}})}switchCamera(e){let t=this.page.activeCamera,i=this.page.scene.find(e);if(!i||!i.visible)throw new ReferenceError("Target camera not founded or not visible");this.page.switchActiveCamera(i),t.dispatchEvent({type:"cameraChange",camera:i})}play(){if(yr(this.shared,this.condition)===!1)return!1;if(!this.playing&&this.page.activeCamera.uuid!==this.data.targetCamera)try{clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{var e;delete this.timeoutId,this.data.animate?(this.buildAnimation(),(e=this.animation)==null||e.play()):this.switchCamera(this.data.targetCamera)},this.data.delay*1e3)}catch{}}pause(){var e;(e=this.animation)==null||e.pause(),clearTimeout(this.timeoutId),delete this.timeoutId}toggle(e){var t,i;if(yr(this.shared,this.condition)===!1)return!1;if(window.clearTimeout(this.timeoutId),delete this.timeoutId,e!==this.toggleIsForward)try{this.playing?((t=this.animation)==null||t.pause(),this.toggleIsForward=e??!this.toggleIsForward,this.buildAnimation(!0),(i=this.animation)==null||i.play()):this.timeoutId=window.setTimeout(()=>{var n,r;this.toggleIsForward=e??!this.toggleIsForward,this.data.animate?((n=this.animation)==null||n.pause(),this.buildAnimation(),(r=this.animation)==null||r.play()):(this.toggleIsForward?(this.fromCamera=this.page.activeCamera,this.switchCamera(this.data.targetCamera)):this.fromCamera&&this.switchCamera(this.fromCamera.uuid),this.page.activeCamera.dispatchEvent(TX),this.page.activeCamera.dispatchEvent(CX))},this.data.delay*1e3)}catch{}}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause(),this.toggleIsForward=!1}};function xie(e){let t=e==null?void 0:e.tracks.filter(i=>i.ValueTypeName==="vector"||i.ValueTypeName==="quaternion").map(i=>i.times.length);if(t!=null&&t.length){let i=IOe(t);return i&&i>2?i:2}return 2}var bie=class extends Ka{constructor(e,t,i,n,r){var l,c,u;super(),this.data=e,this.page=t,this.animationControls=i,this.shared=n,this.condition=r,this.startOnceDelay=0,this.toggleIsForward=!1;let s=e.object,a=t.scene.find(e.object);a&&Array.isArray(a.identity)&&(s=a.identity[0]),this.data={...e,object:s};let o=this.animationControls.clipIdToAction[e.clipId+"/"+s];if(this.duration=((l=o==null?void 0:o.getClip())==null?void 0:l.duration)??1,this.data.crop2){let h=xie(o==null?void 0:o.getClip());this.leftFrameTime=this.data.crop2[0]/(h-1)*this.duration,this.rightFrameTime=this.data.crop2[1]/(h-1)*this.duration}else{let h=(u=(c=o==null?void 0:o.getClip())==null?void 0:c.tracks[0])==null?void 0:u.times.length;h&&h>1?(this.leftFrameTime=this.data.crop[0]/h*this.duration,this.rightFrameTime=this.data.crop[1]/h*this.duration):(this.leftFrameTime=0,this.rightFrameTime=this.duration)}this.startOnceDelay=e.delay}get playing(){var e;return((e=this.threeAnimAction)==null?void 0:e.isRunning())??!1}play(e=!1){if(yr(this.shared,this.condition)===!1)return!1;window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{var i;if(this.threeAnimAction=this.animationControls.play(this.data),!this.threeAnimAction)return;this.threeAnimAction.reset(),this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime;let t=this.data.object;Object.entries(this.animationControls.clipIdToAction).forEach(([n,r])=>{let s=n.split("/")[1];this.threeAnimAction!==r&&s===t&&r.isRunning()&&(e?r.fadeOut(.2):r.stop())}),e&&((i=this.threeAnimAction)==null||i.fadeIn(.2))},this.startOnceDelay)}pause(){this.threeAnimAction&&(this.threeAnimAction.paused=!0),window.clearTimeout(this.timeoutId),delete this.timeoutId}stop(){var e;(e=this.threeAnimAction)==null||e.fadeOut(.2)}seek(e){this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction&&(this.threeAnimAction.paused=!0,this.threeAnimAction.time=qt.clamp(this.threeAnimAction.time+1/60*e,this.leftFrameTime,this.rightFrameTime-16e-5),this.animationControls.needsUpdate=!0,this.animationControls.requestRender())}toggle(e,t=!1){if(yr(this.shared,this.condition)===!1)return!1;this.toggleIsForward=e??!this.toggleIsForward,this.threeAnimAction&&(this.threeAnimAction._loopCount=0),this.playing?this.threeAnimAction&&(this.threeAnimAction.timeScale=this.toggleIsForward?1:-1,this.toggleIsForward?(this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime)):this.timeoutId=window.setTimeout(()=>{var i;if(this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction){this.toggleIsForward?(this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction.time=this.rightFrameTime,this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime),this.threeAnimAction.paused=!1,this.threeAnimAction.timeScale=this.toggleIsForward?1:-1;let n=this.data.clipId.split("/")[1];Object.entries(this.animationControls.clipIdToAction).forEach(([r,s])=>{let a=r.split("/")[1];this.threeAnimAction!==s&&a===n&&s.isRunning()&&(t?s.fadeOut(.2):s.stop())}),t&&((i=this.threeAnimAction)==null||i.fadeIn(.2))}},this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){var t;let e=(t=this.animationControls.clipIdToAction[this.data.clipId+"/"+this.data.object])==null?void 0:t.getClip();e&&(e.duration=this.duration),this.pause()}},Sie=class{constructor(e,t,i,n,r){this.data=e,this.page=t,this.eventManager=i,this.shared=n,this.condition=r,this.timeOutId=-1,this.scene=t.scene}dispatch(){if(yr(this.shared,this.condition)===!1)return!1;this.data.target!==this.page.uuid&&(window.clearTimeout(this.timeOutId),this.timeOutId=window.setTimeout(()=>{this.play()},this.data.delay*1e3))}dispose(){window.clearTimeout(this.timeOutId)}play(){if(this.scene.children.every(t=>t.uuid!==this.data.target||t.data.uiScene))return;this.data.transition==="fade"&&this.data.duration>0&&this.eventManager.eventContext.renderer.renderFromSceneForSceneTransitionPass(this.scene,this.scene.activeCamera,this.data.duration*1e3),this.eventManager.deactivate(),this.eventManager.controlsManager.deactivate();let e=this.scene.activeCamera;this.scene.updatePage(this.data.target),this.scene.traverseVisibleEntity(t=>{t.type==="ParticleSystem"&&(t.sleep(),t.wakeUp(),t.data.autoPlay?t.start():t.stop())}),this.scene.activePage.switchToPlayCamera(),this.scene.activeCamera.copyViewPlaneSize(e),lV(this.scene.activePage,this.shared),this.eventManager.activate(),this.eventManager.controlsManager.activate(this.eventManager)}},_ie=class{constructor(e,t,i,n){this.data=e,this.page=t,this.shared=i,this.condition=n,this.evaluatedCondition=!1}checkConditions(){this.evaluatedCondition=yr(this.shared,this.condition)}dispatch(){if(this.evaluatedCondition===!1)return!1;let e=this.shared.getVariable(this.data.variableId),t=Aee(this.data.expression,this.shared,Xa.typeOfVariable(e));t!==void 0&&this.shared.updateVariable(this.data.variableId,typeof t=="string"?{textValue:t}:t)}dispose(){}},Aie=class{constructor(e,t,i,n){this.data=e,this.page=t,this.shared=i,this.condition=n,this.timeoutId=null}dispatchInner(){if(yr(this.shared,this.condition)===!1)return!1;let e=this.shared.getDynamicVariablePlayState(this.data.variableId);if(this.data.mode==="PlayPause")this.shared.getDynamicVariableToggleIsForward(this.data.variableId)===void 0&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,e==="Playing"?"Paused":"Playing");else if(this.data.mode==="Play"&&e!=="Playing")this.shared.getDynamicVariableToggleIsForward(this.data.variableId)===void 0&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing");else if(this.data.mode==="Stop"&&e!=="Stopped")this.shared.setDynamicVariablePlayState(this.data.variableId,"Stopped");else if(this.data.mode==="Pause"&&e!=="Paused")this.shared.setDynamicVariablePlayState(this.data.variableId,"Paused");else if(this.data.mode==="Restart")this.shared.setDynamicVariablePlayState(this.data.variableId,"Restarted");else if(this.data.mode==="Toggle"){let t=this.shared.getDynamicVariableToggleIsForward(this.data.variableId);e==="Playing"?this.shared.setDynamicVariableToggleIsForward(this.data.variableId,t===void 0?!1:!t):(this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!t),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing"))}}dispatch(){let e=this.data.delay,t=this.shared.getDynamicVariablePlayState(this.data.variableId);this.data.mode==="PlayPause"&&t==="Playing"&&(e=this.data.pauseDelay),e!==0?(this.timeoutId&&window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{this.timeoutId=null,this.dispatchInner()},e)):this.dispatchInner()}dispose(){this.timeoutId&&window.clearTimeout(this.timeoutId)}},oke=class{constructor(e,t,i,n){this.data=e,this.page=t,this.shared=i,this.condition=n}dispatch(){if(yr(this.shared,this.condition)===!1)return!1;(this.data.target==="single"?this.data.variableId?[this.data.variableId]:[]:Object.keys(this.shared.getVariables())).forEach(e=>{var i;this.shared.getVariable(e);let t=(i=this.shared.data.variables.data(e))==null?void 0:i.value;t!==void 0&&this.shared.updateVariable(e,t),this.shared.enableLocalStorageForPersistentVariables&&localStorage.removeItem(hz(e))})}dispose(){}},lke=class{constructor(e,t,i,n){this.data=e,this.page=t,this.shared=i,this.condition=n}dispatch(){var e;if(yr(this.shared,this.condition)===!1)return!1;this.data.userAPIId&&((e=this.shared.getUserAPI(this.data.userAPIId))==null||e.callUserAPI(this.shared))}dispose(){}};function yr(e,t){if(t===void 0)return!0;if(t.expression.length===0)return!1;let i=Aee(t.expression,e,"boolean");return t.negate?!i:!!i}function Os(e,t,i,n,r,s){let a={Audio:[],Video:[],Particles:[],Link:[],Destroy:[],Create:[],Reset:[],Transition:[],SwitchCamera:[],Animation:[],SceneTransition:[],SetVariable:[],DynamicVariablePlay:[],ClearLocalStorage:[],UserAPI:[]},o=l=>({id:c,data:u})=>{try{u.type==="Audio"?uo[e.type].includes("Audio")&&a.Audio.push(new Qte(c,u,s,n,l)):u.type==="Video"&&!(s instanceof _a)?uo[e.type].includes("Video")&&a.Video.push(new Mie(c,u,s,n,l)):u.type==="Particles"?uo[e.type].includes("Particles")&&a.Particles.push(new Kte(u,i,n,l)):u.type==="Link"?uo[e.type].includes("Link")&&a.Link.push(new YHe(u,r.controlsManager,n,l)):u.type==="Create"?uo[e.type].includes("Create")&&a.Create.push(new Eie(u,i,r.controlsManager,n,l)):u.type==="Destroy"?uo[e.type].includes("Destroy")&&a.Destroy.push(new Jte(u,i,r.controlsManager,n,l)):u.type==="Reset"?uo[e.type].includes("Reset")&&a.Reset.push(new Zte(u,i,n,r,l)):u.type==="Transition"?uo[e.type].includes("Transition")&&a.Transition.push(new vie(e.type,u,i,n,l)):u.type==="SwitchCamera"?uo[e.type].includes("SwitchCamera")&&a.SwitchCamera.push(new yie(u,i,n,l)):u.type==="SceneTransition"?uo[e.type].includes("SceneTransition")&&a.SceneTransition.push(new Sie(u,i,r,n,l)):u.type==="Animation"?uo[e.type].includes("Animation")&&a.Animation.push(new bie(u,i,r.animationControls,n,l)):u.type==="SetVariable"?uo[e.type].includes("SetVariable")&&a.SetVariable.push(new _ie(u,i,n,l)):u.type==="DynamicVariablePlay"?uo[e.type].includes("DynamicVariablePlay")&&a.DynamicVariablePlay.push(new Aie(u,i,n,l)):u.type==="Conditional"?uo[e.type].includes("Conditional")&&(u.ifActions.forEach(o({expression:u.condition,negate:!1})),u.elseActions.forEach(o({expression:u.condition,negate:!0}))):u.type==="ClearLocalStorage"?uo[e.type].includes("ClearLocalStorage")&&a.ClearLocalStorage.push(new oke(u,i,n,l)):u.type==="UserAPI"&&uo[e.type].includes("UserAPI")&&a.UserAPI.push(new lke(u,i,n,l))}catch{}};return t.forEach(o()),a}function ya(e){Object.values(e).forEach(t=>{t.forEach(i=>{(i instanceof Qte||i instanceof Mie||i instanceof Kte||i instanceof bie||i instanceof vie||i instanceof Eie||i instanceof Jte||i instanceof yie||i instanceof Sie||i instanceof Zte||i instanceof _ie||i instanceof Aie)&&i.dispose()})})}function cke(e,t){let i;if("material"in e){let n=e.material;Array.isArray(n)?i=e.material[0].layers.find(r=>r.uuid===t):i=e.material.layers.find(r=>r.uuid===t)}if(i)return i.color.texture.image.img instanceof HTMLVideoElement?i.color.texture.image.img:void 0}var wie=new Map,WA=new Map,N1=class{constructor(e,t,i){this.data=t,this.delay=0,this.status="stopped";let{layerId:n,loop:r,volume:s,delay:a}=t;if(this.object=i,n===void 0)throw new Error("Missing property");let o=cke(i,n);o&&(this.videoElement=o,this.videoElement.loop=r===1/0,dM&&(this.videoElement.autoplay=!0),s!==void 0&&(this.videoElement.volume=s)),a!==void 0&&(this.delay=a),WA.has(i.uuid)?WA.get(i.uuid).push(this):WA.set(i.uuid,[this]),wie.set(e,this),this.pause()}mute(){!this.videoElement||(this.videoElement.muted=!0)}unMute(){!this.videoElement||(this.videoElement.muted=!1)}play(e){if(!this.videoElement)return;let t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);e?(this.mute(),this.delay+=150):t?(this.mute(),window.setTimeout(()=>{this.unMute()},100)):this.unMute(),this.delayTimerId=window.setTimeout(()=>{if(!this.videoElement)return;let i=this.videoElement.play();i!==void 0&&i.then(n=>{}).catch(n=>{this.play()}),this.clearDelay()},this.delay),this.status="playing"}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}pause(){!this.videoElement||(this.videoElement.pause(),this.status="paused")}stop(){!this.videoElement||(this.videoElement.pause(),this.videoElement.currentTime=0,this.status="stopped",this.clearDelay())}playByToggle(){this.data.toggle==="stop"?this.status==="playing"?this.stop():(this.stop(),this.play()):this.data.toggle==="pause"?this.status==="playing"?this.pause():this.play():(this.stop(),this.play())}dispose(){!this.videoElement||(this.stop(),this.videoElement.muted=!0)}},Iz=class{constructor(e){this.data=e}dispatch(){this.data.playVideo?this.pauseVideo(this.data.playVideo):this.data.object?this.pauseAllVideosFromObject(this.data.object):this.pauseAllVideos()}pauseVideo(e){let t=wie.get(e);!t||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t[this.data.interaction](),this.disposeDelay()},this.data.delay)):t[this.data.interaction]())}pauseAllVideosFromObject(e){let t=WA.get(e);!(t!=null&&t.length)||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.forEach(i=>i[this.data.interaction]()),this.disposeDelay()},this.data.delay)):t.forEach(i=>i[this.data.interaction]()))}pauseAllVideos(){let e=[...WA.values()];!e.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e.forEach(t=>{t.forEach(i=>{i[this.data.interaction]()})}),this.disposeDelay()},this.data.delay)):e.forEach(t=>{t.forEach(i=>{i[this.data.interaction]()})}))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},Mie=class{constructor(e,t,i,n,r){if(this.data=t,this.shared=n,this.condition=r,t.interaction==="play")this.interaction=new N1(e,t,i);else if(t.interaction==="pause"||t.interaction==="stop")this.interaction=new Iz(t);else throw new Error("Missing property")}dispatchBasic(){if(yr(this.shared,this.condition)===!1)return!1;this.interaction instanceof N1?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if(yr(this.shared,this.condition)===!1)return!1;this.interaction instanceof N1?this.interaction.play():this.interaction.dispatch()}dispose(){this.interaction.dispose()}},DX=(()=>{let e,t,i,n;function r(o){!e&&!RX()&&(t==null?void 0:t.sharedGameControlGlobals.createdObjects.length)>0&&(e=requestAnimationFrame(s)),o&&(t=o,n=o.requestRender)}function s(o){let l=i?o-i:0,c=t.sharedGameControlGlobals.createdObjects,u=t.sharedGameControlGlobals.nCreatedPerAction,h=c.length,d=0;for(;d<h;){let p=c[d];p.userData.createdTime===void 0&&(p.userData.createdTime=o),p.userData.lifetime===void 0&&p.userData.quantity===void 0||p.userData.lifetime&&o-p.userData.createdTime<p.userData.lifetime||p.userData.quantity&&u[p.userData.actionId]<=p.userData.quantity?(p.userData.velocity&&(p.position.addScaledVector(p.userData.velocity,l/1e3),p.updateMatrix(),n()),d++):(u[p.userData.actionId]>p.userData.quantity&&u[p.userData.actionId]--,c.splice(d,1),p.removeFromParent(),t.sharedGameControlGlobals.rapierWorld&&p.rigidBody?(t.sharedGameControlGlobals.colliderToEntity.delete(p.rigidBody.collider(0).handle),t.sharedGameControlGlobals.rapierWorld.removeRigidBody(p.rigidBody)):(p.bvhGeometry=void 0,t.sharedGameControlGlobals.entitiesWithTransformAnim=t.sharedGameControlGlobals.entitiesWithTransformAnim.filter(g=>g.bvhGeometry!==void 0)),h--,n())}e=d>0?requestAnimationFrame(s):void 0,i=d>0?o:void 0}function a(){RX()?e&&(cancelAnimationFrame(e),e=void 0,i=void 0):r()}return typeof document<"u"&&document.addEventListener("visibilitychange",a),r})();function RX(){return!!document&&document.hidden}var PX=new Ei,uke=new G,hke=new G,Eie=class{constructor(e,t,i,n,r){this.data=e,this.page=t,this.controlsManager=i,this.shared=n,this.condition=r,this.intervalId=null,this.timeoutIdQueue=[],this.uniqueId=qt.generateUUID(),this.dispatch=()=>{if(yr(this.shared,this.condition)===!1)return!1;this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3)):this.dispatchInner()},this.dispatchFromStart=()=>{if(yr(this.shared,this.condition)===!1)return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3))},this.dispatchThrottled=ZOe(this.dispatch,1e3/this.data.creationSpeed),this.dispatchStart=()=>{this.intervalId===null&&(this.intervalId=window.setInterval(this.dispatch,1e3/this.data.creationSpeed))},this.dispatchStop=()=>{this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null)},this.dispatchInner=()=>{this.timeoutIdQueue.shift();let a=new qa(this.object);if(a.playModeVisible=!0,a.expand(),this.data.coordinateSystem!=="world"){let l=this.data.coordinateSystem,c=this.page.scene.find(l);c&&(c.updateMatrixWorldSVD(),a.hiddenMatrix.copy(c.matrixWorldRigid))}a.scale.copy(this.object.scale),a.position.fromArray(this.data.position),a.rotation.fromArray(this.data.rotation),a.updateMatrix(),this.page.add(a);let o=this.controlsManager.sharedGameControlGlobals;o.createdObjects.push(a),o.nCreatedPerAction[this.uniqueId]===void 0?o.nCreatedPerAction[this.uniqueId]=1:o.nCreatedPerAction[this.uniqueId]++,a.updateWorldMatrix(!0,!0),a.traverseObject(this.traverseObjectCB),DX(),this.controlsManager.requestRender()},this.traverseObjectCB=a=>{var u,h,d,p;a.hasNonUniformScale&&a.updateMatrixWorldSVD();let o;if(this.controlsManager.sharedGameControlGlobals.rapierWorld){if(a instanceof Wc)if(a.objectForSample){if(a.objectForSample.dataPatched.physics.fusedBody)return;o=a.object}else return a.object.dataPatched.physics.fusedBody===!0&&a.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(a instanceof qa)o=a.object;else if(o=a,(u=o.dataPatched.cloner)==null?void 0:u.hideBase)return!0}else{if(a instanceof Wc)return;a instanceof qa?o=a.object:o=a}this.data.destroy==="Time"?a.userData.lifetime=this.data.lifetime*1e3:this.data.destroy==="Quantity"&&(a.userData.quantity=this.data.destroyAfterQuantity,a.userData.actionId=this.uniqueId);let l=new G().fromArray(this.data.velocity),c=o.dataPatched;if(!(c.physics.enabled==="visibility"?!c.visible:!c.physics.enabled)&&(this.controlsManager.sharedGameControlGlobals.rapierWorld?(this.controlsManager.addRigidBody(a,o,{fromCreate:!0,dynamic:this.data.dynamic}),this.data.destroy==="Collision"&&((h=a.rigidBody)==null||h.collider(0).setActiveEvents(1),a.userData.hasCollisionDestroy=!0),a.matrixWorld.decompose(uke,PX,hke),l.applyQuaternion(PX),this.data.velocity.some(g=>g!==0)&&this.data.dynamic&&((d=a.rigidBody)==null||d.setLinvel(l.divideScalar(this.controlsManager.pixelsPerMeter),!0))):("geometry"in a.object&&this.controlsManager.addBoundsTree(a),this.data.velocity.some(g=>g!==0)&&this.data.dynamic&&(a.userData.velocity=l)),((p=o.dataPatched.physics)==null?void 0:p.fusedBody)===!0))return!0};let s=this.page.scene.find(this.data.object);if(!s)throw new Error("Missing Property");if(this.object=s,this.data.coordinateSystem!=="world"&&!this.page.scene.find(this.data.coordinateSystem))throw new Error("Missing Property");DX(i)}dispose(){this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null),this.timeoutIdQueue.forEach(e=>window.clearTimeout(e)),this.dispatchThrottled.cancel(),this.page.remove(...this.controlsManager.sharedGameControlGlobals.createdObjects),this.controlsManager.sharedGameControlGlobals.createdObjects=[]}},Tie=200,_L=.02,AL=.3,dke=65;new G;var OX=new G,BX=new G,fke=new G,ko=new G,xl=new G,Sm=new G,wL=new Bt,IX=new Bt,pke=new Bt;new Bt;var Uu=new Ei,gf=new Ei,Kh=new qs(0,0,0,"YXZ"),mke=new G(1,0,0),Nu=new G(0,1,0),gke=new G(0,0,1),LX=new G(1,1,1);new Ol;var vke=1,yke=.025,xke=16e-6,UX=12,bke=20,ua=new Yc,Pc=new ps,Ske={type:"requestRender"},_ke={type:"updateMatrix"},NX=Math.PI/6,Lz=class extends Ka{constructor(e,t,i,n,r,s,a,o,l){var g;super(),this.object=e,this.domElement=t,this.data=i,this.gloabalPhysics=n,this.controlsManager=r,this.cameraFollow=s,this.camera=a,this.page=o,this.sharedAssets=l,this.enableDamping=!0,this.hiddenMatrix0=new Bt,this.target0=new G,this.zoom0=1,this.rotForce=1,this.moveForce=1,this.pixelsPerMeter=Tie,this.euler0=new qs(0,0,0,"YXZ"),this.position0Cam=new G,this.quat0Cam=new Ei,this.scale0Cam=new G,this.hiddenMatrix0Cam=new Bt,this.threshEndTranslate=.01,this.threshEndRotate=1e-8,this.threshEndRotVel=.005,this.collider={type:"capsule",radius:40,segment:new Yc(new G(0,-40,0),new G(0,40,0)),matrix:new Bt,position:new G,rotation:new Ei},this.euler=new qs(0,0,0,"YXZ"),this.eulerDelta=new G,this.lastPosition=new G,this.lastCameraQuaternion=new Ei,this.lastCameraPosition=new G,this.PI_2=Math.PI/2,this.prevMouse=new Ae,this.velocityTarget=new G,this.velocity=new G,this.directionXZ=new G,this.rotVelocityStick=new G,this.rotVelocityTarget=new G,this.rotVelocity=new G,this.rotDirection=new G,this.nonColliderRotOffset=new Bt,this.nonColliderPosOffset=new Bt,this.firstPointerId=-1,this.rot=new G,this.path=[],this.movementState={moveNegZ:0,movePosZ:0,moveNegX:0,movePosX:0,moveNegY:0,movePosY:0,rotPosX:0,rotNegX:0,rotPosY:0,rotNegY:0,jump:0,run:0},this.vrEulerYOffset=0,this.onObject=!1,this.actionState={},this.keyAssignments=[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX","ArrowUp"],["rotPosY","ArrowLeft"],["rotNegX","ArrowDown"],["rotNegY","ArrowRight"],["jump"," "]],this.collisionEnabled=!0,this.offsetMatrix=new Bt,this.objectToTarget=new G,this.objectToTarget0=new G,this.objectToCamXZ=new G,this.objectToCamXZ0=new G,this.targetToCamera=new G,this.targetToCamera0=new G,this.cameraPolarAxis0=new G,this.targetPos=new G,this.targetQuat=new Ei,this.lerpFactorPos=new G().setScalar(.3),this.lerpFactorPosStart=.3,this.lerpFactorPosEnd=.3,this.lerpFactorRotStart=.3,this.lerpFactorRotEnd=.3,this.lerpFactorPosCamera=.3,this.lerpFactorRotCamera=.3,this.objXZQuat=new Ei,this.objXZQuatInv=new Ei,this.objXZRotMat=new Bt,this.isFirstPerson=!1,this.didHit=!1,this.groundVelocity=new G,this.pushedVelocity=new G,this.groundYRotation=0,this.objectRealQuat=new Ei,this.colliderWorldQuat=new Ei,this.groundNormal=new G,this.groundTilt=new Ei,this.groundTiltInv=new Ei,this.lastHitObj=null,this.isFirstFrame=!0,this.rotationAccumWhenOrientWithCamera=0,this.navMeshPathDest=null,this.position=new G,this.quaternion=new Ei,this.scale=new G,this.initialAction=!0,this.onPointerDown=x=>{var y;!(x.target===this.domElement||x.target instanceof HTMLElement&&x.target.tagName==="SPLINE-VIEWER"&&((y=x.target.shadowRoot)!=null&&y.contains(this.domElement)))||this.firstPointerId!==-1||(this.firstPointerId=x.pointerId,this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),this.rotBy!=="keys"&&!ec&&!a9&&this.domElement.requestPointerLock(),this.prevMouse.set(x.clientX,x.clientY))},this.onPointerUp=x=>{this.firstPointerId=-1,this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),x.pointerType==="mouse"&&this.domElement.ownerDocument.exitPointerLock()},this.onPointerMove=x=>{if(x.pointerId!==this.firstPointerId)return;let y=x.clientX-this.prevMouse.x,b=x.clientY-this.prevMouse.y;this.prevMouse.set(x.clientX,x.clientY),x.pointerType==="mouse"&&this.rotBy!=="keys"&&(a9&&lBe<15.5&&!ec?(this.eulerDelta.y=-y*this.mouseOrbitSensitivity,this.eulerDelta.x=-b*this.mouseOrbitSensitivity):(this.eulerDelta.y=-x.movementX*this.mouseOrbitSensitivity,this.eulerDelta.x=-x.movementY*this.mouseOrbitSensitivity)),x.pointerType!=="mouse"&&this.rotByTouch==="drag"&&(this.eulerDelta.y=-y*this.mouseOrbitSensitivity*5,this.eulerDelta.x=-b*this.mouseOrbitSensitivity*5),this.controlsManager.requestRender()},this.onPointerlockChange=x=>{this.domElement.ownerDocument.pointerLockElement===this.domElement?Lz.isLocked=!0:Lz.isLocked=!1},this.onPointerlockError=()=>{console.error("SPE.GameControls: Unable to use Pointer Lock API")},this.handleVisibilityChange=()=>{if(document!=null&&document.hidden)for(let x in this.movementState)this.movementState[x]=0},this.onKeyDown=x=>{!(x.target instanceof HTMLInputElement)&&(x.code==="ArrowLeft"||x.code==="ArrowUp"||x.code==="ArrowRight"||x.code==="ArrowDown"||x.code==="Space")&&x.preventDefault();for(let y of this.keyAssignments)if(x.key.toUpperCase()===y[1]||x.key===y[1]){this.movementState[y[0]]=1;break}this.controlsManager.requestRender()},this.onKeyUp=x=>{for(let y of this.keyAssignments)if(x.key.toUpperCase()===y[1]||x.key===y[1]||x.code.slice(3,x.code.length).toUpperCase()===y[1]){this.movementState[y[0]]=0;break}},this.copyVRGamePadValues=(x,y)=>{for(let b=2;b<4;b++){let A=x.axes[b];y===0?b===2?this.movementState.movePosX=A:this.movementState.movePosZ=A:(x.buttons[3].pressed?this.movementState.jump=1:this.movementState.jump=0,b===2?(Math.abs(this.movementState.rotPosY)<.3&&Math.abs(A)>=.3&&(this.vrEulerYOffset+=A<0?1:-1),this.movementState.rotPosY=A):this.moveMode==="fly"&&(this.movementState.moveNegY=A))}},this.sharedGameControlGlobals=r.sharedGameControlGlobals,e===a&&(this.isFirstPerson=!0),this.hiddenMatrix0.copy(this.object.hiddenMatrix),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.euler0.setFromQuaternion(this.quaternion,"YXZ");let c=this.euler0.clone(),u=c.y;if(this.objectRealQuat.copy(this.quaternion),c.y=0,this.quaternion.setFromEuler(c),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),c.set(0,u,0),this.quaternion.setFromEuler(c),this.rot.setFromEuler(c),this.object.matrixAutoUpdate=!1,(this.isFirstPerson||this.cameraFollow===!0)&&(this.target0.copy(this.camera.getTarget()),this.zoom0=this.camera.zoom),this.cameraFollow===!0){this.position0Cam.copy(this.camera.position),this.quat0Cam.copy(this.camera.quaternion),this.scale0Cam.copy(this.camera.scale),this.hiddenMatrix0Cam.copy(this.camera.hiddenMatrix),this.camera.parent?(this.camera.hiddenMatrix.copy((g=this.camera)==null?void 0:g.parent.matrixWorld),this.camera.matrix.copy(this.camera.matrixWorld)):this.camera.hiddenMatrix.identity(),this.camera.matrix.copy(this.camera.matrixWorld),this.camera.matrix.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.matrixAutoUpdate=!1,this.offsetMatrix.copy(this.object.matrix).invert().multiply(this.camera.matrix);let x=new G(0,0,-1).applyQuaternion(this.camera.quaternion),y=new G().subVectors(this.position,this.camera.position);this.objectToCamXZ.copy(y),this.objectToCamXZ.y=0,this.objectToCamXZ0.copy(this.objectToCamXZ);let b,A;Math.abs(x.y)<1e-6?(y.y=0,x.y=0,A=y.projectOnVector(x)):y.y/x.y>0?A=x.multiplyScalar(y.y/x.y):A=x.multiplyScalar(y.length()),this.targetToCamera0.copy(A).negate(),b=this.camera.position.clone().add(A),this.objectToTarget0.subVectors(b,this.position);let w=new qs().setFromQuaternion(this.camera.quaternion,"YXZ");this.cameraPolarOffset=-w.x,w.x=0,w.z=0,w.y-=Math.PI/2,this.cameraPolarAxis0.set(0,0,-1).applyEuler(w)}if(this.object instanceof xo&&(this.object.matrixAutoUpdate=!1),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.rotByTouch=i.rotByTouch??"joystick",this.rotBy=i.rotBy??"keys",this.rotationMode=i.rotationMode??"normal",this.moveMode=i.moveMode??"walk",this.collisionEnabled=i.collisionEnabled,this.speedTranslate=(i.speedTranslate??250)*vke,this.speedOrbit=(i.speedRotate??100)*yke,this.mouseOrbitSensitivity=(i.speedRotate??100)*xke,this.keyAssignments=i.keyAssignments.map(x=>{let y=[x[0],x[1]];return y[1]===""?y[1]="ArrowUp":y[1]===""?y[1]="ArrowLeft":y[1]===""?y[1]="ArrowDown":y[1]===""?y[1]="ArrowRight":y[1]===""?y[1]="Shift":y[1]===""?y[1]="Enter":y[1]==="Space"?y[1]=" ":y[1]===""?y[1]="Meta":y[1]==="Ctrl"?y[1]="Control":y[1]==="Esc"&&(y[1]="Escape"),y}),i.rotBy==="mouse"){let x;x=this.keyAssignments.findIndex(y=>y[0]==="rotNegX"),x!==-1&&(this.keyAssignments[x][1]=""),x=this.keyAssignments.findIndex(y=>y[0]==="rotPosX"),x!==-1&&(this.keyAssignments[x][1]=""),x=this.keyAssignments.findIndex(y=>y[0]==="rotPosY"),x!==-1&&(this.keyAssignments[x][1]=""),x=this.keyAssignments.findIndex(y=>y[0]==="rotNegY"),x!==-1&&(this.keyAssignments[x][1]="")}this.lerpFactorPosStart=1-.02**(1/((i.delayPos[0]??.3)*60)),this.lerpFactorPosEnd=1-.02**(1/((i.delayPos[1]??.3)*60)),this.lerpFactorPos.setScalar(this.lerpFactorPosStart),this.lerpFactorRotStart=1-.02**(1/((i.delayRot[0]??.3)*60)),this.lerpFactorRotEnd=1-.02**(1/((i.delayRot[1]??.3)*60)),this.lerpFactorPosCamera=1-.02**(1/((i.delayPosCamera??.3)*60)),this.lerpFactorRotCamera=1-.02**(1/((i.delayRotCamera??.3)*60)),this.gravity=(this.gloabalPhysics.gravity??lb.defaultData.gravity)*UX,this.usePhysics=this.gloabalPhysics.usePhysics??lb.defaultData.usePhysics,this.jumpPower=i.jumpPower*bke,this.resetYPosition=this.position.y+Math.abs(i.resetYPosition)*(this.gravity>0?1:-1),this.alignToGround=i.alignToGround??!1,this.orientMode=i.autoOrientMove?i.orientMode:"none",this.orientWith=i.orientWith??O3.defaultDataThirdPerson.orientWith,this.slopeThresh=dke*Math.PI/180,i.collider.type==="capsule"?(this.collider.radius=i.collider.radius,this.collider.segment.start.y=i.collider.height/2-i.collider.radius,this.collider.segment.end.y=-this.collider.segment.start.y,this.offset=i.collider.height*_L/this.pixelsPerMeter,this.stepThresh=i.collider.height*AL/this.pixelsPerMeter,this.colliderHeight=i.collider.height):i.collider.type==="sphere"?(this.collider.radius=i.collider.radius,this.collider.segment.start.y=0,this.collider.segment.end.y=0,this.offset=2*i.collider.radius*_L/this.pixelsPerMeter,this.stepThresh=2*i.collider.radius*AL/this.pixelsPerMeter,this.colliderHeight=i.collider.radius*2):(this.offset=i.collider.height*_L/this.pixelsPerMeter,this.stepThresh=i.collider.height*AL/this.pixelsPerMeter,this.colliderHeight=i.collider.height),this.collider.type=i.collider.type;let h=new G().fromArray(i.collider.position),d=new Ei().setFromEuler(new qs().fromArray([...i.collider.rotation,"XYZ"]));this.collider.position.copy(h).multiply(this.scale),this.collider.rotation.copy(d),this.collider.matrix.compose(h,d,LX),i.cameraXAxis!==void 0&&(this.cameraXAxis=i.cameraXAxis,this.cameraYAxis=i.cameraYAxis,this.minPolarAngle=i.cameraRotXLimits[0],this.maxPolarAngle=i.cameraRotXLimits[1],this.minAzimuthAngleRel=i.cameraRotYLimits[0],this.maxAzimuthAngleRel=i.cameraRotYLimits[1]),this.forwardDir=i.forwardDirection??"-z",this.isFirstPerson&&(this.forwardDir="-z"),this.runMultiplier=i.runMultiplier??2;let p=i.navmesh.destinationHelperRadius*2;if(p>0){let x=new ri;x.push({fi:0,data:{...da.defaultData("light","phong"),alpha:0},id:"layer1"}),x.push({fi:0,data:{...da.defaultData("color"),color:i.navmesh.destinationHelperColor,alpha:i.navmesh.destinationHelperColor.a},id:"layer2"});let y=new B5({layers:x},{scene:this.page.scene,shared:this.sharedAssets});this.navMeshPathDest=new fr(tee.create({parameters:{width:p,height:p/10,hollow:.7}}),y),this.navMeshPathDest.material.userData.opacity0=i.navmesh.destinationHelperColor.a}this.activate()}reset(e=!1){if(this.object.hiddenMatrix.copy(this.hiddenMatrix0),e){this.object.updateMatrix(),this.object.updateMatrixWorld(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity();let t=new qs().setFromQuaternion(this.quaternion,"YXZ"),i=t.y;this.objectRealQuat.copy(this.quaternion),t.y=0,this.quaternion.setFromEuler(t),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),t.set(0,i,0),this.quaternion.setFromEuler(t),this.rot.setFromEuler(t),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.velocityTarget.set(0,0,0),this.velocity.set(0,0,0)}else this.object instanceof xo?this.object.matrixAutoUpdate=!0:this.object.updateMatrix();this.cameraFollow===!0&&(this.camera.quaternion.copy(this.quat0Cam),this.camera.position.copy(this.position0Cam),this.camera.scale.copy(this.scale0Cam),this.camera.hiddenMatrix.copy(this.hiddenMatrix0Cam),this.camera.matrixAutoUpdate=!0),this.controlsManager.requestRender()}activate(){this.instantiateActions(),this.domElement.ownerDocument.addEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.addEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.addEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.addEventListener("visibilitychange",this.handleVisibilityChange)}deactivate(){this.disposeActions(),this.domElement.ownerDocument.removeEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.removeEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.removeEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.removeEventListener("visibilitychange",this.handleVisibilityChange)}dispose(){var e;this.deactivate(),(e=this.navMeshPathDest)!=null&&e.parent&&this.page.remove(this.navMeshPathDest)}instantiateActions(){let e=this.data,t=this.sharedAssets;e.gameActions!==void 0&&(this.actions={},P3.list.forEach(i=>{this.actions[i]=Os({...e,disabled:!1,type:"GameControl"},e.gameActions[i],this.page,t,this.controlsManager.eventManager,this.object)})),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"),this.initialAction&&(this.initialAction=!1)}disposeActions(){this.initialAction=!1,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),ya(this.actions.idle),ya(this.actions.move),ya(this.actions.run),ya(this.actions.jump)}dispatchStartEvent(e){this.actions[e]!==void 0&&(this.actionState[e]||(this.actionState[e]=!0,this.actions[e].Transition.forEach(t=>{t.play()}),this.actions[e].Animation.forEach(t=>{t.play(this.initialAction===!1)}),this.actions[e].Create.forEach(t=>{t.dispatchStart()}),this.actions[e].Audio.forEach(t=>{t.dispatchGameControl("start")}),this.actions[e].Particles.forEach(t=>{t.dispatchGameControl("start")})))}dispatchStopEvent(e){this.actions[e]!==void 0&&(!this.actionState[e]||(this.actionState[e]=!1,this.actions[e].Transition.forEach(t=>{t.stop(),t.object.currentState!==null&&t.object.changeSelectedState(null,{scene:this.page.scene,shared:this.sharedAssets})}),this.actions[e].Create.forEach(t=>{t.dispatchStop()}),this.actions[e].Audio.forEach(t=>{t.dispatchGameControl("stop")}),this.actions[e].Particles.forEach(t=>{t.dispatchGameControl("stop")})))}get colliderWorldPosition(){return ko.copy(this.collider.position).applyQuaternion(this.objectRealQuat).add(this.position)}update(e,t,i){var o,l,c,u,h,d,p,g,x;if(this.gravity<0?this.position.y<this.resetYPosition:this.position.y>this.resetYPosition)return this.reset(!0),!0;this.sharedGameControlGlobals.gamePads.forEach(this.copyVRGamePadValues);let n=(this.isFirstFrame?16.6:e)/1e3;this.isFirstFrame&&(this.isFirstFrame=!1);let r=n*60,s=!1;if(this.usePhysics&&this.collisionEnabled){let y=xl.set(0,(this.velocity.y===0?this.pixelsPerMeter*Math.max(Math.abs(this.gravity)/(10*UX),1)*(this.gravity>0?1:-1):this.velocity.y)*n,0).divideScalar(this.pixelsPerMeter),b=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter),this.colliderWorldQuat,y,(o=this.object.rigidBody)==null?void 0:o.collider(0).shape,1,!1,16,void 0,void 0,this.object.rigidBody);if(b){this.onObject=!0,this.groundNormal.set(b.normal2.x,b.normal2.y,b.normal2.z).applyQuaternion(this.colliderWorldQuat).negate(),this.alignToGround&&this.groundTiltAdjustment(this.groundNormal),Math.acos(this.groundNormal.y)<this.slopeThresh&&(s=!0),((l=b.collider.parent())==null?void 0:l.bodyType())===0&&Math.acos(this.groundNormal.y)*(180/Math.PI)>45&&(this.onObject=!1);let A=b.collider.parent();this.groundYRotation=0,this.groundVelocity.set(0,0,0);for(let w of this.sharedGameControlGlobals.entitiesWithTransformAnim)if(w.rigidBody===A&&w.userData.isFollowingObj!==this.object.uuid){(w.hasNonUniformScale?w.matrixWorldRigid:w.matrixWorld).decompose(ko,gf,xl),this.groundVelocity.subVectors(ko,w.prevT),this.object.getWorldPosition(xl).add(this.collider.position).sub(ko),this.groundYRotation=Kh.setFromQuaternion(gf).y-w.prevR.y,Sm.copy(xl).applyAxisAngle(Nu,this.groundYRotation),this.groundVelocity.add(Sm.sub(xl)).divideScalar(n);break}}else this.onObject=!1}if(this.moveMode==="walk"&&this.collisionEnabled&&(this.movementState.jump===1&&this.onObject&&(this.velocityTarget.y=this.jumpPower,this.movementState.jump=0,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("jump"),this.onObject=!1),this.onObject?this.velocityTarget.y/=2:this.velocityTarget.y+=this.gravity*r),this.moveMode==="fly"&&(this.velocityTarget.y=(this.movementState.movePosY-this.movementState.moveNegY)*this.speedTranslate),this.directionXZ.z=this.movementState.movePosZ-this.movementState.moveNegZ,this.directionXZ.x=this.movementState.movePosX-this.movementState.moveNegX,this.forwardDir==="+z"&&this.directionXZ.multiplyScalar(-1),this.directionXZ.manhattanLength()>0&&(this.path=[]),this.navMeshPathDest){let y=this.navMeshPathDest.material;if(this.moveMode==="walk"&&this.path.length>1){this.navMeshPathDest.position.copy(this.path[this.path.length-1]),this.navMeshPathDest.parent||this.page.add(this.navMeshPathDest);let b=ko.subVectors(this.path[1],this.position),A=xl.subVectors(this.path[1],this.path[0]);b.dot(A)<0?this.path.shift():(this.directionXZ.x=A.x,this.directionXZ.z=A.z),y.opacity=y.userData.opacity0}else y.opacity-=.05*y.userData.opacity0,this.navMeshPathDest.material.opacity<=0&&this.navMeshPathDest.parent&&this.page.remove(this.navMeshPathDest)}this.directionXZ.normalize(),this.movementState.run?this.moveForce=this.runMultiplier:this.moveForce=1,this.velocityTarget.z=this.directionXZ.z*this.speedTranslate*this.moveForce,this.velocityTarget.x=this.directionXZ.x*this.speedTranslate*this.moveForce,(this.moveMode==="walk"?this.velocityTarget.x+this.velocityTarget.z===0:this.velocityTarget.manhattanLength()===0)?this.lerpFactorPos.setScalar(this.lerpFactorPosEnd):this.lerpFactorPos.setScalar(this.lerpFactorPosStart),this.moveMode==="walk"&&(this.lerpFactorPos.y=1),this.didHit===!1&&this.pushedVelocity.manhattanLength()===0||this.usePhysics===!1?(this.velocity.x+=(this.velocityTarget.x-this.velocity.x)*(1-(1-this.lerpFactorPos.x)**r),this.velocity.y+=(this.velocityTarget.y-this.velocity.y)*(1-(1-this.lerpFactorPos.y)**r),this.velocity.z+=(this.velocityTarget.z-this.velocity.z)*(1-(1-this.lerpFactorPos.z)**r)):this.velocity.copy(this.velocityTarget),(this.moveMode==="walk"?this.velocity.x**2+this.velocity.z**2<this.speedTranslate:this.velocity.lengthSq()<this.speedTranslate)?(this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.onObject&&(this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"))):(this.dispatchStopEvent("idle"),this.onObject&&(this.dispatchStopEvent("jump"),this.movementState.run?(this.dispatchStopEvent("move"),this.dispatchStartEvent("run")):(this.dispatchStopEvent("run"),this.dispatchStartEvent("move"))));let a=fke.copy(this.velocity);if(this.orientMode!=="none"&&this.isFirstPerson===!1){let y=xl.copy(a);y.y=0,a.set(0,a.y,y.length()*(this.forwardDir==="+z"?1:-1))}if(this.directionXZ.manhattanLength()>0&&this.orientMode!=="none"&&this.isFirstPerson===!1)if(this.orientWith==="camera"&&this.path.length<=1){let y=ko;this.camera.getWorldDirection(y);let b=Sm.copy(Nu).multiplyScalar(y.dot(Nu));y.sub(b);let A=xl.copy(this.directionXZ);A.x*=-1,this.rot.y=y.angleTo(A)*(y.cross(A).y>0?-1:1)+this.rotationAccumWhenOrientWithCamera}else this.rot.y=(this.path.length>1?0:this.euler.y)+Math.atan2(-this.directionXZ.z,this.directionXZ.x)+Math.PI/2*(this.forwardDir==="+z"?1:-1);if(Kh.setFromVector3(this.rot),this.moveMode==="walk"&&(Kh.x=0),a.applyEuler(Kh),s&&(gf.setFromUnitVectors(Nu,this.groundNormal),a.applyQuaternion(gf)),i){let y=Kh.set(0,this.vrEulerYOffset*NX,0);i.applyEuler(y),a.x+=i.x,a.z+=i.z,this.nonColliderPosOffset.elements[13]+=i.y*n}if(this.usePhysics===!0){let y=xl;this.pushedVelocity.set(0,0,0);for(let b of this.sharedGameControlGlobals.entitiesWithTransformAnim){let A=Sm.setFromMatrixPosition(b.matrixWorld).sub(b.prevT).divideScalar(n).divideScalar(this.pixelsPerMeter),w=b.rigidBody.collider(0).castCollider(A,this.object.rigidBody.collider(0),ko.copy(a).divideScalar(this.pixelsPerMeter),n,!1);A.multiplyScalar(this.pixelsPerMeter);let E=dn.is(b)?b:b.object;if(w!==null&&this.lastHitObj!==E){let D;b instanceof qa&&(D=b);let T=this.sharedGameControlGlobals.entityToCollisionEvents[E.uuid];if(T)for(let I of T)I.data.target==="character"&&(I.dispatch(D),E.dispatchEvent(Nz));this.lastHitObj=E}if(w!==null){this.pushedVelocity.copy(A),y.copy(w.normal1).applyQuaternion(b.quaternion);break}}if(this.pushedVelocity.manhattanLength()!==0){let b=y.dot(a);b<0&&a.addScaledVector(y,-b),a.add(this.pushedVelocity)}else a.add(this.groundVelocity)}if(this.rotDirection.y=Number(this.movementState.rotPosY)-Number(this.movementState.rotNegY),this.rotDirection.x=Number(this.movementState.rotPosX)-Number(this.movementState.rotNegX),this.rotDirection.normalize(),this.rotationMode==="normal"&&(this.movementState.rotPosX||this.movementState.rotNegX)||this.rotationMode==="steer"&&(this.movementState.rotPosX||this.movementState.rotNegX)&&(this.movementState.movePosZ||this.movementState.moveNegZ||this.moveMode==="walk")?this.rotVelocityStick.x=-this.rotDirection.x*this.speedOrbit*this.rotForce:this.rotVelocityStick.x=0,this.rotationMode==="normal"&&(this.movementState.rotPosY||this.movementState.rotNegY)||this.rotationMode==="steer"&&(this.movementState.rotPosY||this.movementState.rotNegY)&&(this.movementState.movePosZ||this.movementState.moveNegZ)?this.rotVelocityStick.y=-this.rotDirection.y*this.speedOrbit*this.rotForce:this.rotVelocityStick.y=0,this.rotVelocityTarget.subVectors(this.eulerDelta.divideScalar(n),this.rotVelocityStick),this.rotVelocityTarget.manhattanLength()===0?this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotEnd)**r):this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotStart)**r),this.euler.x+=this.rotVelocity.x*n,this.euler.y+=this.rotVelocity.y*n+this.groundYRotation,this.rotVelocityTarget.y===0&&this.directionXZ.manhattanLength()===0?this.rotationAccumWhenOrientWithCamera=0:(this.cameraFollow===!1||this.cameraYAxis==="Locked")&&(this.rotationAccumWhenOrientWithCamera+=this.rotVelocity.y*n),this.isFirstPerson===!1&&this.orientMode!=="none"&&this.directionXZ.manhattanLength()>0){if(this.orientMode==="radial"){this.objectToCamXZ.copy(this.objectToCamXZ0).applyAxisAngle(Nu,this.euler.y-this.euler0.y);let y=xl.copy(this.objectToCamXZ).normalize(),b=Sm.copy(a).multiplyScalar(n);b.y=0;let A=b.sub(ko.copy(y).multiplyScalar(b.dot(y))).cross(y).y;this.euler.y-=Math.atan2(A,this.objectToCamXZ.length())}}else this.rot.y+=this.rotVelocity.y*n+this.groundYRotation,this.rotVelocityTarget.y!==0&&(this.cameraFollow===!1||this.cameraYAxis==="Locked")&&(this.euler.y=this.rot.y);if(this.cameraFollow===!0&&(this.moveMode==="walk"?this.cameraXAxis==="Limit"?this.euler.x=qt.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):this.euler.x=qt.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset,this.PI_2+this.cameraPolarOffset):this.cameraXAxis==="Limit"&&(this.euler.x=qt.clamp(this.euler.x,-this.PI_2,this.PI_2))),this.moveMode==="fly"?this.rot.x=this.euler.x:this.isFirstPerson&&(t?(Kh.copy(t),Kh.y=0):(Kh.copy(this.euler),Kh.y=0),this.nonColliderRotOffset.makeRotationFromEuler(Kh)),t&&(this.moveMode==="walk"?(this.rot.y=t.y,this.rot.x=0,this.rot.z=0):this.rot.setFromEuler(t),this.rot.y+=this.vrEulerYOffset*NX),Uu.setFromAxisAngle(mke,this.rot.x),gf.setFromAxisAngle(Nu,this.rot.y),gf.multiply(Uu),Uu.setFromAxisAngle(gke,this.rot.z),gf.multiply(Uu),this.quaternion.copy(gf),this.objectRealQuat.multiplyQuaternions(this.quaternion,this.objXZQuat),this.colliderWorldQuat.copy(this.objectRealQuat).multiply(this.collider.rotation),this.collisionEnabled)if(this.usePhysics){let y=xl.copy(a).multiplyScalar(n/this.pixelsPerMeter),b=null;this.didHit=!1;let A=new G;for(let w=0;w<5;w++){let E=y.length(),D=Sm.copy(y).normalize();if(b=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(A),this.colliderWorldQuat,D,(c=this.object.rigidBody)==null?void 0:c.collider(0).shape,E,!1,24,void 0,void 0,this.object.rigidBody),b!==null){this.didHit=!0;let T=this.sharedGameControlGlobals.colliderToEntity.get(b.collider.handle);if(T!==this.lastHitObj&&w===0){this.lastHitObj=T;let P=this.sharedGameControlGlobals.entityToCollisionEvents[T==null?void 0:T.uuid];if(P){for(let U of P)if(U.data.target==="character"){let H=((u=this.sharedGameControlGlobals.rapierWorld)==null?void 0:u.getCollider(b.collider.handle))._parent,V;if(T.cloner){for(let j of T.cloner.children)if(j.rigidBody===H){V=j;break}}U.dispatch(V),T.dispatchEvent(Nz)}}}let I=OX.set(b.normal2.x,b.normal2.y,b.normal2.z).applyQuaternion(this.colliderWorldQuat),R=BX.copy(D).multiplyScalar(b.toi).dot(I),O=b.toi;if(O===0&&(this.position.y+=this.offset*this.pixelsPerMeter),R>this.offset&&(O=b.toi*(R-this.offset)/R,A.addScaledVector(D,O)),y.copy(D).multiplyScalar(E-O),Math.acos(-I.y)>this.slopeThresh){let P=this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(A),U=Sm.copy(b.witness2).applyQuaternion(this.colliderWorldQuat);U.y=0;let H=P.add(U);H.y+=this.stepThresh;let V=this.sharedGameControlGlobals.rapierWorld.castShape(H,this.colliderWorldQuat,y,(h=this.object.rigidBody)==null?void 0:h.collider(0).shape,1,!1,24,void 0,void 0,this.object.rigidBody);V!==null&&V.toi===0&&(I.y=0,I.normalize())}y.addScaledVector(I,-y.dot(I))}else{w===0&&this.directionXZ.manhattanLength()!==0&&(this.lastHitObj=null),A.add(y);break}}this.position.addScaledVector(A,this.pixelsPerMeter),(d=this.object.rigidBody)==null||d.setTranslation(ko.copy(this.position).divideScalar(this.pixelsPerMeter),!0),(p=this.object.rigidBody)==null||p.setRotation(Uu.copy(this.quaternion).premultiply(this.groundTilt).multiply(this.objXZQuat),!0)}else{let y=this.onObject?1:5,b=a.multiplyScalar(n/y);for(let A=0;A<y;A++)this.position.add(b),this.collisionAdjustment(n/y)}else this.position.addScaledVector(a,n);if(this.moveMode==="walk"&&this.onObject&&(this.velocityTarget.y=0,this.velocity.y=0),this.quaternion.premultiply(this.groundTilt).multiply(this.objXZQuat),this.object.matrix.compose(this.position,this.quaternion,this.scale),this.object.matrixWorldNeedsUpdate=!0,this.object.matrix.multiply(this.nonColliderPosOffset).multiply(this.nonColliderRotOffset),this.quaternion.premultiply(this.groundTiltInv).multiply(this.objXZQuatInv),this.cameraFollow===!0){this.updateFollowArms();let y=this.objectToTarget.add(this.position),b=this.targetToCamera.add(y);wL.lookAt(b,y,Nu).setPosition(b),wL.decompose(this.targetPos,this.targetQuat,ko),this.camera.quaternion.slerp(this.targetQuat,1-(1-this.lerpFactorRotCamera)**r),this.camera.position.lerp(this.targetPos,1-(1-this.lerpFactorPosCamera)**r),this.camera.updateMatrix(),this.camera.updateMatrixWorld(),this.cameraYAxis==="Limit"&&this.orientMode==="cartesian"&&(this.euler.y=qt.clamp(this.euler.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel)),this.euler.x=qt.clamp(this.euler.x,-this.PI_2+(this.cameraPolarOffset<0?this.cameraPolarOffset:0),this.PI_2+(this.cameraPolarOffset>0?this.cameraPolarOffset:0))}return this.eulerDelta.set(0,0,0),this.object.dispatchEvent(_ke),this.path.length<2&&this.lastPosition.distanceToSquared(this.position)<this.threshEndTranslate&&Math.abs(this.rotVelocity.x)<this.threshEndRotVel&&Math.abs(this.rotVelocity.y)<this.threshEndRotVel&&(this.camera===void 0||this.isFirstPerson||this.lastCameraPosition.distanceToSquared(this.camera.position)<this.threshEndTranslate&&8*(1-this.lastCameraQuaternion.dot(this.camera.quaternion))<this.threshEndRotate)&&(this.moveMode==="fly"||this.onObject===!0||this.collisionEnabled===!1)&&(this.navMeshPathDest===null||this.navMeshPathDest.material.opacity<-.04*((x=(g=this.navMeshPathDest)==null?void 0:g.material)==null?void 0:x.userData.opacity0))?!1:(this.camera&&(this.lastCameraPosition.copy(this.camera.position),this.lastCameraQuaternion.copy(this.camera.quaternion)),this.lastPosition.copy(this.position),this.object.dispatchEvent(Ske),!0)}updateFollowArms(){this.objectToTarget.copy(this.objectToTarget0),this.targetToCamera.copy(this.targetToCamera0);let e=Uu.setFromAxisAngle(Nu,this.cameraYAxis==="Limit"&&this.orientMode!=="radial"?qt.clamp(this.euler.y-this.euler0.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel):this.euler.y-this.euler0.y);(this.cameraYAxis!=="Locked"||this.orientMode==="radial")&&this.objectToTarget.applyQuaternion(e);let t;this.cameraXAxis==="Limit"?t=qt.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):t=qt.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset+1e-6,this.PI_2+this.cameraPolarOffset-1e-6);let i=ko.copy(this.cameraPolarAxis0);(this.cameraYAxis!=="Locked"||this.orientMode==="radial")&&i.applyQuaternion(e);let n=gf.setFromAxisAngle(i,t);this.cameraYAxis!=="Locked"&&this.targetToCamera.applyQuaternion(e),this.cameraXAxis!=="Locked"&&this.targetToCamera.applyQuaternion(n)}groundTiltAdjustment(e){Nu.angleTo(e)*180/Math.PI<15||Nu.angleTo(e)*180/Math.PI>85?Uu.identity():Uu.setFromUnitVectors(Nu,e),this.groundTilt.slerp(Uu,.06),this.groundTiltInv.copy(this.groundTilt).invert()}collisionAdjustment(e){var r;let t=BX.set(0,0,0);this.object.matrix.compose(this.position,this.quaternion,this.scale);let i=wL.multiplyMatrices(this.object.matrix,this.objXZRotMat).multiply(this.collider.matrix).decompose(ko,Uu,xl).compose(ko,Uu,LX);this.sharedGameControlGlobals.entitiesWithTransformAnim.forEach(s=>{if(s===this.object||s.isDescendantOf(this.object))return;Pc.makeEmpty(),s.updateMatrixWorldSVD();let a=s.matrixWorldRigid,o=IX.copy(a).invert(),l=pke.copy(IX).multiply(i);ua.copy(this.collider.segment),ua.start.applyMatrix4(l),ua.end.applyMatrix4(l);let c=OX.copy(this.position).applyMatrix4(o);Pc.expandByPoint(ua.start),Pc.expandByPoint(ua.end),Pc.min.addScalar(-this.collider.radius),Pc.max.addScalar(this.collider.radius),s.bvhGeometry.boundsTree.shapecast({traverseBoundsOrder(u){return u.distanceToPoint(ua.end)},intersectsBounds:u=>u.intersectsBox(Pc),intersectsTriangle:u=>{let h=ko,d=xl,p=u.closestPointToSegment(ua,h,d);if(p<this.collider.radius){let g=this.collider.radius-p,x=d.sub(h).normalize(),y=Sm.copy(c);y.addScaledVector(x,g);let b=y.applyMatrix4(a).sub(this.position);t.add(b),ua.start.addScaledVector(x,g),ua.end.addScaledVector(x,g)}}})}),Pc.makeEmpty(),ua.copy(this.collider.segment),ua.start.applyMatrix4(i),ua.end.applyMatrix4(i),Pc.expandByPoint(ua.start),Pc.expandByPoint(ua.end),Pc.min.addScalar(-this.collider.radius),Pc.max.addScalar(this.collider.radius),(r=this.sharedGameControlGlobals.staticMeshBVH)==null||r.shapecast({traverseBoundsOrder(s){return s.distanceToPoint(ua.end)},intersectsBounds:s=>s.intersectsBox(Pc),intersectsTriangle:s=>{let a=ko,o=xl,l=s.closestPointToSegment(ua,a,o);if(l<this.collider.radius){let c=this.collider.radius-l,u=o.sub(a).normalize();this.alignToGround&&this.groundTiltAdjustment(u),t.addScaledVector(u,c),ua.start.addScaledVector(u,c),ua.end.addScaledVector(u,c)}}}),this.onObject=Math.abs(t.y)>Math.abs(e*this.velocity.y*.25),this.onObject&&this.dispatchStopEvent("jump");let n=Math.max(0,t.length()-1e-5);t.normalize().multiplyScalar(n),this.position.add(t)}},Cie=Lz;Cie.isLocked=!1;var Ake=pg(OJ());function Die(e){let t=e.elements,i=t[0]**2+t[1]**2+t[2]**2,n=t[4]**2+t[5]**2+t[6]**2,r=t[8]**2+t[9]**2+t[10]**2,s=t[0]**2+t[4]**2+t[8]**2,a=t[1]**2+t[5]**2+t[9]**2,o=t[2]**2+t[6]**2+t[10]**2,l=1e-8;return i<l||n<l||r<l||s<l||a<l||o<l}function Df(e,t){let i=new ii;if(t&&Die(t))return i.setAttribute("position",new Gt([],3)),i.setIndex([]),i;if(!e.getAttribute("position"))return i.setAttribute("position",new Gt([],3)),i.setIndex([]),i;let{positions:n,triIndices:r}=lP(e.getAttribute("position"),e.getIndex());return i.setAttribute("position",new Gt(n,3)),i.setIndex(r),t&&i.applyMatrix4(t),i}var wke=new Bt,Mke=new Bt,Jh=[[0,0,0],[0,0,0],[0,0,0]];function Rie(e){let t=e.elements;Jh[0][0]=t[0],Jh[0][1]=t[4],Jh[0][2]=t[8],Jh[1][0]=t[1],Jh[1][1]=t[5],Jh[1][2]=t[9],Jh[2][0]=t[2],Jh[2][1]=t[6],Jh[2][2]=t[10];let{u:i,v:n}=(0,Ake.SVD)(Jh),r=wke.set(i[0][0],i[0][1],i[0][2],0,i[1][0],i[1][1],i[1][2],0,i[2][0],i[2][1],i[2][2],0,0,0,0,1),s=Mke.set(n[0][0],n[0][1],n[0][2],0,n[1][0],n[1][1],n[1][2],0,n[2][0],n[2][1],n[2][2],0,0,0,0,1);return r.multiply(s.transpose())}var Eke=class extends MZ{constructor(){super(),this.layers.enable(3),this.layers.enable(8),this.layers.enable(9)}setFromCamera(e,t){t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,-1).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):t.isPerspectiveCamera?(this.ray.origin.set(e.x,e.y,-1).unproject(t),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):console.error("Raycaster: Unsupported camera type.")}intersectVisibleObjects(e,t=!0,i=[]){return e.forEach(n=>{n.visible&&this.intersectObject(n,t,i)}),i}createRaycastLineHelper(){let e=new gg({color:65280,linewidth:10}),t=new G(this.ray.origin.x,this.ray.origin.y,this.ray.origin.z),i=new G(this.ray.direction.x,this.ray.direction.y,this.ray.direction.z),n=this.camera.far-this.camera.near,r=new G().addVectors(t,i.multiplyScalar(n)),s=new ii;return s.setFromPoints([t,r]),new t3(s,e)}},Pie=e=>e instanceof L1||e instanceof U1;function Tke(e,t){return e.distance-t.distance}function Oie(e,t,i){if(!(!Cf(t)||!t.visible)){ku(t)&&t.raycast(e,i);for(let n of t.children)Oie(e,n,i)}}function QC(e,t,i,n=!1){if(!n&&!i.some(s=>Z3(e,s)!==void 0))return[];let r=[];return t.children.forEach(s=>Oie(e,s,r)),r.sort(Tke),r}function Uz(e){let t=[];if(e.length){let i=e[0].object;Cf(i)&&t.push(i);let n=i.parent;for(;n;)Pie(n)&&t.push(n),n=n.parent}return t}function Rf(e,t,i,n){let r=e.frame;if(r){let s=t[0]*r.width,a=(1-t[1])*r.height;for(let o of i){let l=o===r.uuid?r:r.find(o);if(l!=null&&l.intersects(s,a))return n(l),!0}}return!1}function Z3(e,t){if(ku(t)){if(t.visible){let i=[];return t.raycast(e,i),i.length?i[0]:void 0}}else if(Pie(t))return Bie(e,t)}function Bie(e,t){if(!(!Cf(t)||!t.visible)){if(ku(t)){let i=[];if(t.raycast(e,i),i.length)return i[0]}for(let i of t.children){let n=Bie(e,i);if(n)return n}}}function Cke(e,t,i){return{x:(e-(i.left+window.scrollX))/i.width*2-1,y:-((t-(i.top+window.scrollY))/i.height)*2+1}}function Dke(e,t,i){return{x:(e-(i.left+window.scrollX))/i.width,y:1-(t-(i.top+window.scrollY))/i.height}}var Rke=class{constructor(e,t,i,n,r,s,a,o){this.renderer=e,this.publish=t,this.scene=i,this.getCamera=n,this.sharedAssets=r,this.requestRender=s,this.isExport=a,this.frame=o,this.raycaster=new Eke,this._useWindowEvents=!1,this.pointerWorld={x:0,y:0},this.pointerScreen={x:0,y:0},this._useWindowEvents=t.mouseEventTarget==="window",this.domElement=e.domElement,this.eventElement=this._useWindowEvents?window:e.domElement,this._domRect=this.domElement.getBoundingClientRect()}get stopRaycast(){return this.publish.stopRaycast}get page(){return this.scene.activePage}set useWindowEvents(e){this._useWindowEvents=e,this.eventElement=e?window:this.renderer.domElement}get useWindowEvents(){return this._useWindowEvents}set domRect(e){this._domRect=e}get domRect(){return this._domRect}updateRaycaster(e){var n;let{pageX:t,pageY:i}=((n=e.touches)==null?void 0:n.length)>0?e.touches[0]:e;this.pointerWorld=Cke(t,i,this._domRect),this.pointerScreen=Dke(t,i,this._domRect),this.raycaster.setFromCamera(this.pointerWorld,this.getCamera())}},Ao=class{constructor(e){this.eventContext=e,this.domEventsNeeded=new Set,this.hasVideoAction=!1}connect(){}disconnect(){}},cV=[["start","Start"],["keyDown","KeyDown"],["keyUp","KeyUp"],["mouseDown","MouseDown"],["mouseUp","MouseUp"],["mouseHover","MouseHover"],["collision","Collision"],["lookAt","LookAt"],["follow","Follow"],["scroll","Scroll"]],Iie=e=>{var t;return(t=cV.find(([i,n])=>n===e))==null?void 0:t[0]},bM=e=>{var t;return(t=cV.find(([i])=>i===e))==null?void 0:t[1]},Pke=(e,t)=>{let i=Iie(e);if(i){let n=new CustomEvent(i,{bubbles:!0});return Object.defineProperty(n,"target",{writable:!1,value:t}),n}},Oke=class extends Ao{constructor(){super(...arguments),this.objectsPerEvents=new Map,this.splineEvents={},this.onBeginEvent=e=>{var n;if(!e.eventName||!e.target||e.eventName==="Scroll")return;let t=(n=this.splineEvents[Iie(e.eventName)])==null?void 0:n[e.target.uuid];if(!t)return;e.eventName==="Scroll"&&e.deltaY!==void 0&&Object.assign(t,{deltaY:e.deltaY});let{domElement:i}=this.eventContext;i.dispatchEvent(t)}}connect(){let{page:e}=this.eventContext;e.traverseEntity(t=>{var i,n;if((i=t.data)!=null&&i.events.length){for(let[r,s]of cV)if(t.data.events.some(a=>a.data.type===s&&!a.data.disabled)){this.objectsPerEvents.has(r)?(n=this.objectsPerEvents.get(r))==null||n.push(t):this.objectsPerEvents.set(r,[t]);let a={id:t.uuid,name:t.name},o=Pke(s,a),l=this.splineEvents[r];l?l[t.uuid]=o:this.splineEvents[r]={[t.uuid]:o}}}}),this.objectsPerEvents.forEach(t=>{t.forEach(i=>{i.addEventListener("beginEvent",this.onBeginEvent)})})}disconnect(){this.objectsPerEvents.forEach(e=>{e.forEach(t=>{t.removeEventListener("beginEvent",this.onBeginEvent)})})}},Bke=class{constructor(e,t,i,n,r,s){if(this.id=e,this.data=t,this.object=i,this.entered=!1,(t.type==="KeyDown"||t.type==="KeyUp"||t.type==="KeyPress")&&!t.key)throw new Error("Missing property");this.actions=Os(t,t.actions,n,r,s,i)}disconnect(){ya(this.actions)}dispatchHeld(e){this.actions.Create.forEach(t=>{e&&t.dispatchThrottled.cancel(),t.dispatchThrottled()})}dispatch(e=!1){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),this.data.type==="MousePress"||this.data.type==="KeyPress"?this.entered||(this.entered=!0,this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent()),this.actions.Create.forEach(t=>t.dispatchStart())):(this.actions.Transition.some(t=>t.playing&&t.data.runMode!=="Toggle")||this.actions.Transition.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()}),this.actions.SwitchCamera.some(t=>t.playing&&t.data.runMode!=="Toggle")||this.actions.SwitchCamera.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()}),this.actions.Animation.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()})),this.actions.Link.forEach(t=>{t.dispatch()}),this.actions.SceneTransition.forEach(t=>{t.dispatch()}),e===!1&&this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Audio.forEach(t=>{t.dispatchBasic()}),this.actions.Video.forEach(t=>{t.dispatchBasic()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()}),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}dispatchRelease(){this.entered&&(this.entered=!1,this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.Particles.forEach(e=>e.reverseFromCurrent()),this.actions.Animation.forEach(e=>e.reverseFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.reverseFromCurrent()),this.actions.Create.forEach(e=>e.dispatchStop()))}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent())),this.actions.Link.forEach(t=>{t.dispatch()}),this.actions.SceneTransition.forEach(t=>{t.dispatch()}),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Audio.forEach(t=>{t.dispatchBasic()}),this.actions.Video.forEach(t=>{t.dispatchBasic()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()}),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}},Ike=class extends Ao{constructor(e,t,i){super(e),this.eventManager=t,this.useForRaycastProperty=i,this.objectsPerTypes={MouseDown:[],MouseUp:[],MousePress:[],KeyDown:[],KeyUp:[],KeyPress:[]},this.canvasMouseEvents=[],this.eventsPerObjects={MouseDown:{},MouseUp:{},MousePress:{},KeyDown:{},KeyUp:{},KeyPress:{}},this.heldKeys={},this.heldKeysPress={},this._prevObjects=[],this.sceneInterects=null,this.onCanvasRaycast=n=>{if(this.useForRaycastProperty===!0&&this.sceneInterects===null){this.eventContext.updateRaycaster(n);let{raycaster:r,page:s}=this.eventContext,a=QC(r,s,[],!0);this.sceneInterects=a,a.length&&(this.eventContext.sharedAssets.raycastProperty={x:a[0].point.x,y:a[0].point.y,z:a[0].point.z,objX:a[0].object.matrixWorld.elements[12],objY:a[0].object.matrixWorld.elements[13],objZ:a[0].object.matrixWorld.elements[14]})}},this.onCanvasMouseDown=n=>{(n.target===this.eventContext.domElement||n.target.tagName==="SPLINE-VIEWER")&&this.canvasMouseEvents.forEach(r=>{(r.data.type==="MouseDown"||r.data.type==="MousePress")&&(this.onCanvasRaycast(n),r.dispatch())})},this.onCanvasMouseUp=n=>{(n.target===this.eventContext.domElement||n.target.tagName==="SPLINE-VIEWER")&&this.canvasMouseEvents.forEach(r=>{r.data.type==="MouseUp"?(this.onCanvasRaycast(n),r.dispatch()):r.data.type==="MousePress"&&r.dispatchRelease()})},this.onMouseDown=n=>{Si.length>1||(this.eventContext.updateRaycaster(n),this.handleMouseEvent("MouseDown"))},this.onMouseUp=n=>{Si.length>1||(this.eventContext.updateRaycaster(n),this.handleMouseEvent("MouseUp"))},this.onMousePressDown=n=>{Si.length>1||(this.eventContext.updateRaycaster(n),this.handleMousePressEvent())},this.onMousePressRelease=n=>{Si.length>1||(this.eventContext.updateRaycaster(n),this.handleMousePressEvent(!0))},this.onKeyDown=n=>{this.heldKeys[n.key]||(this.handleKeyEvent(n,"KeyDown"),this.handleKeyEventHeld(n,"KeyDown",!0)),this.heldKeys[n.key]=!0},this.onKeyUp=n=>{this.handleKeyEvent(n,"KeyUp"),this.handleKeyEventHeld(n,"KeyUp",!0)},this.onKeyPressDown=n=>{this.heldKeysPress[n.key]?this.handleKeyEventHeld(n,"KeyPress"):(this.handleKeyEvent(n,"KeyPress"),this.handleKeyEventHeld(n,"KeyPress",!0)),this.heldKeysPress[n.key]=!0},this.onKeyPressUp=n=>{this.handleKeyEvent(n,"KeyPress",!0)},this.releaseHeldKey=n=>{delete this.heldKeys[n.key]},this.releaseHeldKeyPress=n=>{delete this.heldKeysPress[n.key]},this._onUserEvent=({eventName:n,target:r,reverse:s})=>{var o,l,c,u;if(!n||!r)return;let a=bM(n);a&&(a==="MouseDown"||a==="MouseUp"||a==="MousePress"?(r.dispatchEvent({type:"beginEvent",eventName:a}),(l=(o=this.eventsPerObjects[a])==null?void 0:o[r.uuid])==null||l.forEach(h=>{h.dispatchUserEvent(s)})):(a==="KeyDown"||a==="KeyUp"||a==="KeyPress")&&(r.dispatchEvent({type:"beginEvent",eventName:a}),(u=(c=this.eventsPerObjects[a])==null?void 0:c[r.uuid])==null||u.forEach(h=>{h.dispatchUserEvent()})))}}connect(){var r,s,a,o,l,c;let{page:e,sharedAssets:t,domElement:i}=this.eventContext,n=(u,h)=>{var p,g;if(!((p=u.data)!=null&&p.events.length))return;let d=["MouseDown","MouseUp","MousePress","KeyDown","KeyUp","KeyPress"];for(let x of d){let y=this.eventsPerObjects[x];if(u.data.events.filter(({data:b})=>b.type===x&&b.disabled!==!0).forEach(({id:b,data:A})=>{try{let w=new Bke(b,A,u,e,t,this.eventManager);w.actions.Video.length&&(this.hasVideoAction=!0),(A.type==="MouseDown"||A.type==="MouseUp"||A.type==="MousePress")&&(A.mode==="Canvas"||A.mode==="Window")?this.canvasMouseEvents.push(w):(y[u.uuid]?y[u.uuid].some(E=>E.id===w.id)||y[u.uuid].push(w):y[u.uuid]=[w],u instanceof H0&&u.traverseChildren(E=>{var D;if(!E.visible)return!0;E instanceof Ds&&((D=E.data.geometry.shapeBlendNode)==null?void 0:D.operation)!==2&&(y[E.uuid]?y[E.uuid].push(w):y[E.uuid]=[w])}))}catch{}}),((g=y[u.uuid])==null?void 0:g.length)&&(this.objectsPerTypes[x].push(u instanceof _a&&(x==="MouseDown"||x==="MouseUp"||x==="MousePress")?h:u),u instanceof H0)){let b=this.objectsPerTypes[x];u.traverseChildren(A=>{if(!A.visible)return!0;A instanceof Ds&&b.indexOf(A)===-1&&b.push(A)})}}};e.traverseEntity(u=>{var h;(u instanceof mo||u instanceof fa)&&((h=u.frame)==null||h.traverse(d=>{n(d,u)})),n(u)}),this.heldKeys={},this.heldKeysPress={},this.domEventsNeeded.clear(),i.addEventListener("pointerdown",this.onCanvasMouseDown),i.addEventListener("pointerup",this.onCanvasMouseUp),((r=this.objectsPerTypes.MouseDown)!=null&&r.length||this.useForRaycastProperty)&&(this.domEventsNeeded.add("pointerdown"),i.addEventListener("pointerdown",this.onMouseDown)),(s=this.objectsPerTypes.MouseUp)!=null&&s.length&&(this.domEventsNeeded.add("pointerup"),i.addEventListener("pointerup",this.onMouseUp)),(a=this.objectsPerTypes.MousePress)!=null&&a.length&&(this.domEventsNeeded.add("pointerdown"),i.addEventListener("pointerdown",this.onMousePressDown),this.domEventsNeeded.add("pointerup"),i.addEventListener("pointerup",this.onMousePressRelease)),(o=this.objectsPerTypes.KeyDown)!=null&&o.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.releaseHeldKey)),(l=this.objectsPerTypes.KeyUp)!=null&&l.length&&(this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyUp)),(c=this.objectsPerTypes.KeyPress)!=null&&c.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyPressDown),document.addEventListener("keyup",this.releaseHeldKeyPress),this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyPressUp)),Object.entries(this.objectsPerTypes).forEach(([u,h])=>{h.forEach(d=>{d.addEventListener("userEvent",this._onUserEvent)})})}disconnect(){let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),this.heldKeys={},this.heldKeysPress={},e.removeEventListener("pointerdown",this.onCanvasMouseDown),e.removeEventListener("pointerup",this.onCanvasMouseUp),e.removeEventListener("pointerdown",this.onMouseDown),e.removeEventListener("pointerdown",this.onMousePressDown),e.removeEventListener("pointerup",this.onMouseUp),e.removeEventListener("pointerup",this.onMousePressRelease),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),document.removeEventListener("keydown",this.onKeyPressDown),document.removeEventListener("keyup",this.onKeyPressUp),document.removeEventListener("keyup",this.releaseHeldKey),Object.values(this.eventsPerObjects).forEach(t=>{Object.values(t).forEach(i=>{i.forEach(n=>{n.disconnect()})})}),this.canvasMouseEvents.forEach(t=>{t.disconnect()}),Object.entries(this.objectsPerTypes).forEach(([t,i])=>{i.forEach(n=>{n.removeEventListener("userEvent",this._onUserEvent)})})}handleMouseEvent(e){var o,l,c,u;let{stopRaycast:t,raycaster:i,page:n,pointerScreen:r}=this.eventContext,s=this.objectsPerTypes[e],a=s.filter(h=>!(h instanceof _a));if(!(!s.length&&!this.useForRaycastProperty)&&!(n.uiCanvas&&Rf(n,[r.x,r.y],Object.keys(this.eventsPerObjects[e]),h=>{this.handleObjectMouseEventDispatch(h,e)}))){if(t||this.useForRaycastProperty){let h;if(this.sceneInterects===null?h=QC(i,n,a,this.useForRaycastProperty):(h=this.sceneInterects,this.sceneInterects=null),this.useForRaycastProperty&&h.length&&(this.eventContext.sharedAssets.raycastProperty={x:h[0].point.x,y:h[0].point.y,z:h[0].point.z,objX:h[0].object.matrixWorld.elements[12],objY:h[0].object.matrixWorld.elements[13],objZ:h[0].object.matrixWorld.elements[14]}),t){let d=[((l=(o=h[0])==null?void 0:o.uv)==null?void 0:l.x)??0,((u=(c=h[0])==null?void 0:c.uv)==null?void 0:u.y)??0];Uz(h).forEach(p=>{p instanceof mo&&Rf(p,d,Object.keys(this.eventsPerObjects[e]),g=>{this.handleObjectMouseEventDispatch(g,e)}),this.eventsPerObjects[e][p.uuid]&&this.handleObjectMouseEventDispatch(p,e)})}}t||a.forEach(h=>{var p,g;let d=Z3(i,h);d&&(this.handleObjectMouseEventDispatch(h,e),h instanceof mo&&Rf(h,[((p=d==null?void 0:d.uv)==null?void 0:p.x)??0,((g=d==null?void 0:d.uv)==null?void 0:g.y)??0],Object.keys(this.eventsPerObjects[e]),x=>{this.handleObjectMouseEventDispatch(x,e)}))})}}handleMousePressEvent(e=!1){let t="MousePress",i=this.objectsPerTypes[t],n=i.filter(s=>!(s instanceof _a)),r=[];if(i.length){if(!e){let{stopRaycast:s,raycaster:a,page:o,pointerScreen:l}=this.eventContext,c=!1;if(o.uiCanvas&&(c=Rf(o,[l.x,l.y],Object.keys(this.eventsPerObjects[t]),u=>{r.push(u)})),s&&!c){let u=QC(a,o,n);r=Uz(u),u.forEach(h=>{var d,p;h.object instanceof mo&&Rf(h.object,[((d=h==null?void 0:h.uv)==null?void 0:d.x)??0,((p=h==null?void 0:h.uv)==null?void 0:p.y)??0],Object.keys(this.eventsPerObjects[t]),g=>{r.push(g)})})}else n.forEach(u=>{var d,p;let h=Z3(a,u);h&&(r.push(u),u instanceof mo&&Rf(u,[((d=h==null?void 0:h.uv)==null?void 0:d.x)??0,((p=h==null?void 0:h.uv)==null?void 0:p.y)??0],Object.keys(this.eventsPerObjects[t]),g=>{r.push(g)}))})}this._prevObjects.length&&this._prevObjects.forEach(s=>{r.includes(s)||this.handleObjectMouseEventDispatchRelease(s,t)}),r.length&&r.forEach(s=>{this.handleObjectMouseEventDispatch(s,t)}),this._prevObjects=r}}handleObjectMouseEventDispatch(e,t){var i,n;e.dispatchEvent({type:"beginEvent",eventName:t}),(n=(i=this.eventsPerObjects[t])==null?void 0:i[e.uuid])==null||n.forEach(r=>{r.dispatch()})}handleObjectMouseEventDispatchRelease(e,t){var i,n;e.dispatchEvent({type:"beginEvent",eventName:t}),(n=(i=this.eventsPerObjects[t])==null?void 0:i[e.uuid])==null||n.forEach(r=>{r.dispatchRelease()})}handleKeyEvent(e,t,i=!1){this.objectsPerTypes[t].forEach(n=>{let r=this.eventsPerObjects[t][n.uuid];r.some(({data:s})=>"key"in s&&s.key===e.key)&&n.dispatchEvent({type:"beginEvent",eventName:t}),r.forEach(s=>{"key"in s.data&&s.data.key===e.key&&(i?s.dispatchRelease():s.dispatch(!0))})})}handleKeyEventHeld(e,t,i=!1){this.objectsPerTypes[t].forEach(n=>{this.eventsPerObjects[t][n.uuid].forEach(r=>{"key"in r.data&&r.data.key===e.key&&r.dispatchHeld(i)})})}},Lke=new G,Uke=new G,Lie=class{constructor(e,t,i,n,r){this.actionsIn=Os(e,e.inActions,i,n,r,t),this.actionsOut=Os(e,e.outActions,i,n,r,t)}disconnect(){ya(this.actionsIn),ya(this.actionsOut)}},Nke=class extends Lie{constructor(e,t,i,n,r,s){super(t,i,n,r,s),this.id=e,this.data=t,this.object=i,this.stage="out",this.objects=[],this.onUpdateMatrixWorld=()=>{for(let d of this.objects)if(!d.visible)return;let c=Lke.setFromMatrixPosition(this.objects[0].matrixWorld),u=Uke.setFromMatrixPosition(this.objects[1].matrixWorld),h=c.distanceTo(u)<=this.distance?"in":"out";if(this.stage!==h){this.stage=h;let d=h==="in"?this.actionsIn:this.actionsOut;d.Audio.forEach(p=>p.dispatchConditional()),d.Particles.forEach(p=>p.dispatchConditional()),d.Video.forEach(p=>p.dispatchConditional()),d.Link.forEach(p=>p.dispatch()),d.Create.forEach(p=>p.dispatch()),d.Destroy.forEach(p=>p.dispatch()),d.Reset.forEach(p=>p.dispatch()),d.Transition.forEach(p=>{p.object.currentTransitionEvent!==this&&(p.object.currentTransitionEvent=this),p.init()}),d.Transition.forEach(p=>p.play()),d.Animation.forEach(p=>p.play()),d.SwitchCamera.forEach(p=>p.play()),d.SceneTransition.forEach(p=>p.dispatch()),d.SetVariable.forEach(p=>p.checkConditions()),d.SetVariable.forEach(p=>p.dispatch()),d.DynamicVariablePlay.forEach(p=>p.dispatch()),d.ClearLocalStorage.forEach(p=>p.dispatch()),d.UserAPI.forEach(p=>p.dispatch())}};let{distance:a,fromObject:o,toObject:l}=t.condition;this.distance=a;for(let c of[o,l]){if(!c)throw new Error("Missing property");let u=n.find(c);if(!u)throw new Error("Missing property");this.objects.push(u)}}connect(){window.setTimeout(()=>{this.objects.forEach(e=>{e.addEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)}),this.onUpdateMatrixWorld()},0)}disconnect(){super.disconnect(),this.stage="out",this.objects.forEach(e=>{e.removeEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)})}},zke=class extends Lie{constructor(e,t,i,n,r,s){var l;super(t,i,n,r,s),this.id=e,this.data=t,this.object=i,this.onBegin=({target:c,state:u})=>{this.toState!==u&&(this.actionsOut.Audio.forEach(h=>h.dispatchConditional()),this.actionsOut.Particles.forEach(h=>h.dispatchConditional()),this.actionsOut.Video.forEach(h=>h.dispatchConditional()),this.actionsOut.Link.forEach(h=>h.dispatch()),this.actionsOut.Create.forEach(h=>h.dispatch()),this.actionsOut.Destroy.forEach(h=>h.dispatch()),this.actionsOut.Reset.forEach(h=>h.dispatch()),this.actionsIn.Transition.forEach(h=>h.pause()),this.object.currentTransitionEvent=this,this.actionsOut.Transition.forEach(h=>h.play()),this.actionsOut.Animation.forEach(h=>h.play()),this.actionsIn.SwitchCamera.forEach(h=>h.pause()),this.actionsOut.SwitchCamera.forEach(h=>h.play()),this.actionsOut.SceneTransition.forEach(h=>h.dispatch()),this.actionsOut.SetVariable.forEach(h=>h.checkConditions()),this.actionsOut.SetVariable.forEach(h=>h.dispatch()),this.actionsOut.DynamicVariablePlay.forEach(h=>h.dispatch()),this.actionsOut.ClearLocalStorage.forEach(h=>h.dispatch()),this.actionsOut.UserAPI.forEach(h=>h.dispatch()))},this.onComplete=({target:c,state:u})=>{this.toState===u&&(this.actionsIn.Audio.forEach(h=>h.dispatchConditional()),this.actionsIn.Particles.forEach(h=>h.dispatchConditional()),this.actionsIn.Video.forEach(h=>h.dispatchConditional()),this.actionsIn.Link.forEach(h=>h.dispatch()),this.actionsIn.Create.forEach(h=>h.dispatch()),this.actionsIn.Destroy.forEach(h=>h.dispatch()),this.actionsIn.Reset.forEach(h=>h.dispatch()),this.actionsOut.Transition.forEach(h=>h.pause()),this.actionsOut.Transition.forEach(h=>h.pause()),this.object.currentTransitionEvent=this,this.actionsIn.Transition.forEach(h=>h.play()),this.actionsIn.Animation.forEach(h=>h.play()),this.actionsOut.SwitchCamera.forEach(h=>h.pause()),this.actionsIn.SwitchCamera.forEach(h=>h.play()),this.actionsIn.SceneTransition.forEach(h=>h.dispatch()),this.actionsIn.SetVariable.forEach(h=>h.checkConditions()),this.actionsIn.SetVariable.forEach(h=>h.dispatch()),this.actionsIn.DynamicVariablePlay.forEach(h=>h.dispatch()),this.actionsOut.ClearLocalStorage.forEach(h=>h.dispatch()),this.actionsOut.UserAPI.forEach(h=>h.dispatch()))};let{condition:a}=t;if(!a.object)throw new Error("Missing property");let o=n.find(a.object)??n.scene.find2D(a.object);if(!o)throw new Error("Missing property");if(this.toObject=o,a.state&&!((l=this.toObject.states)!=null&&l[a.state]))throw new Error("Missing property");this.toState=a.state}connect(){s0(this.actionsOut).forEach(e=>{var t;(t=this.actionsOut[e])!=null&&t.length&&this.toObject.addEventListener("beginState",this.onBegin)}),s0(this.actionsIn).forEach(e=>{var t;(t=this.actionsIn[e])!=null&&t.length&&this.toObject.addEventListener("completeState",this.onComplete)})}disconnect(){super.disconnect(),s0(this.actionsOut).forEach(e=>{var t;(t=this.actionsIn[e])!=null&&t.length&&this.toObject.removeEventListener("beginState",this.onBegin)}),s0(this.actionsIn).forEach(e=>{var t;(t=this.actionsIn[e])!=null&&t.length&&this.toObject.removeEventListener("completeState",this.onComplete)})}},Fke=class extends Ao{constructor(e,t){super(e),this.eventManager=t,this.eventsPerConditions={Comparison:[],Distance:[],State:[]},this.hasVideoAction=!1}connect(){super.connect();let{page:e,sharedAssets:t}=this.eventContext;e.traverseEntity(i=>{var n;if((n=i.data)!=null&&n.events.length){for(let{id:r,data:s}of i.data.events)if(!s.disabled&&s.type==="Conditional")try{let a;s.condition.type==="Comparison"||(s.condition.type==="Distance"?a=new Nke(r,s,i,e,t,this.eventManager):s.condition.type==="State"&&(a=new zke(r,s,i,e,t,this.eventManager))),a&&(this.eventsPerConditions[s.condition.type].push(a),(a.actionsIn.Video.length||a.actionsOut.Video.length)&&(this.hasVideoAction=!0))}catch{}}}),Object.values(this.eventsPerConditions).forEach(i=>i.forEach(n=>n.connect()))}disconnect(){super.disconnect(),Object.values(this.eventsPerConditions).forEach(e=>e.forEach(t=>t.disconnect()))}},Y_=new G,_m=new G,Pv=new G,zX=new _l,Vke=.01,zn=new G,Ws=new G,FX=new G,d0=new Ei,ML=new qs,Hke=new Bt,EL=new Cs,Yx=new G,Zh=new G,TL=.2;function CL(e,t){!t||(t[0]<t[1]&&(e.x=Math.min(Math.max(e.x,t[0]),t[1])),t[2]<t[3]&&(e.y=Math.min(Math.max(e.y,t[2]),t[3])),t[4]<t[5]&&(e.z=Math.min(Math.max(e.z,t[4]),t[5])))}var Gke=function(){let e=new Bt;return(t,i,n)=>{let r=t.obj;e.copy(r.hiddenMatrix),r.parent!==null&&e.premultiply(r.parent.matrixWorld),e.invert(),r.position.copy(i),t.reference==="global"&&CL(r.position,t.limits),r.position.applyMatrix4(e),t.reference==="parent"?CL(r.position,t.limits):t.reference==="local"&&(d0.copy(t.quat0).invert(),r.position.sub(t.position0),r.position.applyQuaternion(d0),CL(r.position,t.limits),d0.invert(),r.position.applyQuaternion(d0),r.position.add(t.position0)),e.multiply(n??r.matrixWorld).decompose(zn,r.quaternion,Ws),r.updateMatrix(),r.hasNonUniformScale&&(r.updateMatrixWorld(),r.updateMatrixWorldSVD()),r instanceof nl&&kf(r.parent)&&r.invalidateDownstreamBooleanData(!0)}}(),kke=class{constructor(e,t,i,n,r,s,a){this.object=e,this.id=t,this.data=i,this.dropDestIds=[],this.activeIdx=null,this.wasDragEventTriggered=!1,this.resetDampingFactor=this.data.resetSpeed===0?1:8/this.data.resetSpeed+1,this.snapDampingFactor=this.data.snapSpeed===0?1:8/this.data.snapSpeed+1,this.actionsDrag=Os(i,i.dragDropActions.drag,n,r,s,this.object),this.actionsDrop=Os(i,i.dragDropActions.drop,n,r,s,this.object);let o=[];this.data.objects.forEach(l=>{let c=n.find(l);!c||c.data.visible!==!1&&(o.push(c),a[c.uuid]&&a[c.uuid].forEach(u=>{let h=n.find(u);!h||h.data.visible!==!1&&o.push(h)}))}),this.data.dropDestinations.forEach(l=>{let c=n.find(l);!c||c.data.visible!==!1&&(this.dropDestIds.push(c.uuid),a[c.uuid]&&a[c.uuid].forEach(u=>{let h=n.find(u);!h||h.data.visible!==!1&&this.dropDestIds.push(h.uuid)}))}),this.dragItems=o.map(l=>(this.data.planeMode==="locked"&&(l.userData.lockedPlane=!0),l.userData.worldPosition0=new G().setFromMatrixPosition(l.matrixWorld),{obj:l,fromPosition:new G().setFromMatrixPosition(l.matrixWorld),pointStart:new G,pointEnd:new G,paused:!0,currentDampingFactor:this.data.dampingFactor,reset:!1,position0:new G().copy(l.position),quat0:new Ei().copy(l.quaternion),snapped:!1,orientationMatrix:new Bt,limits:this.data.limits,reference:this.data.referenceFrame}))}get activeDragItem(){return this.activeIdx!==null?this.dragItems[this.activeIdx]:null}dispose(){ya(this.actionsDrag),ya(this.actionsDrop),this.dragItems.forEach(e=>{e.fromPosition.copy(e.obj.userData.worldPosition0),e.pointStart.copy(e.fromPosition),e.pointEnd.copy(e.pointStart),e.obj.recursiveBBoxNeedsUpdate=!0,e.obj.userData.lockedPlane=void 0,e.obj.position.copy(e.position0),e.obj.quaternion.copy(e.quat0),e.obj.updateMatrix()})}},jke=class extends Ao{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.lastDropDestination=null,this.dragTimeout=null,this.onPointerDown=i=>{var a;if(Si.length>1)return;this.eventContext.updateRaycaster(i);let{raycaster:n,page:r}=this.eventContext,s=r.raycastWithClones(n);if(this.lastDropDestination=null,s.length===0){this.activeEvent=null;return}for(let o of this.events){let l=0;for(let{obj:c,pointEnd:u,pointStart:h}of o.dragItems){if(c===s[0].object||c===s[0].object.object||dn.is(c)&&c.isAncestorOf(s[0].object.uuid)){if(o.activeIdx=l,o.activeDragItem.reset=!1,o.activeDragItem.currentDampingFactor=o.data.dampingFactor,o.activeDragItem.snapped=!1,o.data.cursor==="hand"&&this.setCursor("grabbing"),this.eventManager.controlsManager.usePhysics){o.activeDragItem.obj.rigidBody&&o.activeDragItem.obj.rigidBody.setBodyType(2,!0);let d=o.activeDragItem.obj;c.hasNonUniformScale&&c.updateMatrixWorldSVD(),(d.hasNonUniformScale?d.matrixWorldRigid:d.matrixWorld).decompose(zn,d0,Ws),ML.setFromQuaternion(d0),d.prevR===void 0?(d.prevR=ML.clone(),d.prevT=zn.clone()):(d.prevR.copy(ML),d.prevT.copy(zn)),this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.push(o.activeDragItem.obj)}this.calcPlaneIntersectPos(c,h,o.data.plane,o.data.referenceFrame),u.copy(h),(this.eventManager.controlsManager.usePhysics&&((a=c.data.physics)==null?void 0:a.rigidBody)==="dynamic"||o.data.drop===!1||o.data.resetOnSnapFail===!1)&&o.activeDragItem.fromPosition.setFromMatrixPosition(o.activeDragItem.obj.matrixWorld),this.activeEvent=o,this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!1);return}l++}}this.activeEvent=null},this.onPointerMove=i=>{var a,o,l,c;if(Si.length>1)return;this.eventContext.updateRaycaster(i);let{raycaster:n,page:r}=this.eventContext,s=r.raycastWithClones(n);if(Si.length===0){let u=!1;for(let h of this.events){for(let{obj:d}of h.dragItems)if(d===((a=s[0])==null?void 0:a.object)||d===((l=(o=s[0])==null?void 0:o.object)==null?void 0:l.object)||dn.is(d)&&d.isAncestorOf((c=s[0])==null?void 0:c.object.uuid)){switch(u=!0,h.data.cursor){case"hand":this.setCursor("grab");break;case"move":this.setCursor("move");break}break}if(u)break}u||this.setCursor("default");return}if(this.activeEvent&&this.activeEvent.activeDragItem){let u=this.activeEvent.activeDragItem;u.snapped=!1;let h;if(this.activeEvent.data.drop&&(h=s.filter(d=>u.obj!==d.object&&!u.obj.isAncestorOf(d.object.uuid)&&!(d.object instanceof L1)&&(this.activeEvent.data.dropOn==="all"||this.activeEvent.dropDestIds.some(p=>p===d.object.uuid||r.scene.find(p).isAncestorOf(d.object.uuid))))[0]),h){let d=FX.copy(h.face.normal).applyMatrix3(EL.getNormalMatrix(h.object.matrixWorld));if(this.activeEvent.data.snapTo==="center")u.fromPosition.setFromMatrixPosition(h.object.matrixWorld);else if(this.activeEvent.data.snapTo==="surface"){if(u.fromPosition.copy(h.point),this.activeEvent.data.snapSurfaceMode==="bbox"){zn.copy(d).applyMatrix3(EL.setFromMatrix4(u.obj.matrixWorld).transpose());let p=u.obj;zn.x>TL?Ws.x=-p.recursiveBBox.min.x:zn.x<-.2&&(Ws.x=-p.recursiveBBox.max.x),zn.y>TL?Ws.y=-p.recursiveBBox.min.y:zn.y<-.2&&(Ws.y=-p.recursiveBBox.max.y),zn.z>TL?Ws.z=-p.recursiveBBox.min.z:zn.z<-.2&&(Ws.z=-p.recursiveBBox.max.z),Ws.applyMatrix3(EL.invert())}else Ws.copy(d).multiplyScalar(this.activeEvent.data.snapSurfaceOffset);u.fromPosition.add(Ws)}this.activeEvent.data.autoOrient&&(zn.set(0,1,0).cross(d),zn.length()<1e-4&&zn.set(-1,0,0).cross(d),Ws.crossVectors(FX,zn),u.orientationMatrix.makeBasis(zn,Ws,d)),u.pointStart.copy(u.fromPosition),u.pointEnd.copy(u.pointStart),u.currentDampingFactor=this.activeEvent.snapDampingFactor,u.snapped=!0,this.lastDropDestination!==h.object&&(this.lastDropDestination=h.object,this.activeEvent.actionsDrop.Transition.forEach(p=>{p.play()}),this.activeEvent.actionsDrop.Animation.forEach(p=>{p.play()}),this.activeEvent.actionsDrop.Audio.forEach(p=>{p.dispatchGameControl("start")}),this.activeEvent.actionsDrop.Particles.forEach(p=>{p.dispatchGameControl("start")}),this.activeEvent.actionsDrop.Create.forEach(p=>{p.dispatchThrottled()}))}else u.orientationMatrix.makeRotationFromQuaternion(u.quat0),this.lastDropDestination=null,u.currentDampingFactor=this.activeEvent.data.dampingFactor,this.calcPlaneIntersectPos(u.obj,u.pointEnd,this.activeEvent.data.plane,this.activeEvent.data.referenceFrame),this.activeEvent.actionsDrop.Transition.forEach(d=>{d.stop(),d.object.currentState!==null&&d.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrop.Animation.forEach(d=>{d.stop()}),this.activeEvent.actionsDrop.Audio.forEach(d=>{d.dispatchGameControl("stop")}),this.activeEvent.actionsDrop.Particles.forEach(d=>{d.dispatchGameControl("stop")});this.activeEvent.actionsDrag.Create.forEach(d=>{d.dispatchThrottled()}),this.activeEvent.actionsDrag.SetVariable.forEach(d=>d.checkConditions()),this.activeEvent.actionsDrag.SetVariable.forEach(d=>d.dispatch()),this.activeEvent.actionsDrag.DynamicVariablePlay.forEach(d=>d.dispatch()),this.activeEvent.actionsDrag.ClearLocalStorage.forEach(d=>d.dispatch()),this.activeEvent.actionsDrag.UserAPI.forEach(d=>d.dispatch()),this.activeEvent.wasDragEventTriggered===!1&&(this.activeEvent.wasDragEventTriggered=!0,this.activeEvent.actionsDrag.Transition.forEach(d=>{d.play()}),this.activeEvent.actionsDrag.Animation.forEach(d=>{d.play()}),this.activeEvent.actionsDrag.Audio.forEach(d=>{d.dispatchGameControl("start")}),this.activeEvent.actionsDrag.Particles.forEach(d=>{d.dispatchGameControl("start")})),this.dragTimeout&&window.clearTimeout(this.dragTimeout),this.dragTimeout=window.setTimeout(()=>{!this.activeEvent||(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Audio.forEach(d=>{d.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Particles.forEach(d=>{d.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Transition.forEach(d=>{d.stop(),d.object.currentState!==null&&d.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrag.Animation.forEach(d=>{d.stop()}))},500),this.updateDragItem(u),u.obj.dispatchEvent({type:"requestRender"})}},this.onPointerUp=i=>{var n;if(this.activeEvent&&this.activeEvent.activeDragItem){this.activeEvent.data.cursor==="hand"&&this.setCursor("grab");let r=((n=this.activeEvent.activeDragItem.obj.data.physics)==null?void 0:n.rigidBody)==="dynamic";this.activeEvent.activeDragItem.snapped===!1&&this.activeEvent.data.drop&&this.activeEvent.data.resetOnSnapFail&&(this.eventManager.controlsManager.usePhysics===!1||!r)&&(this.activeEvent.activeDragItem.reset=this.activeEvent.data.resetOnSnapFail,this.activeEvent.activeDragItem.paused=!1,this.activeEvent.activeDragItem.currentDampingFactor=this.activeEvent.resetDampingFactor),this.eventManager.controlsManager.usePhysics&&r&&(this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.pop(),this.activeEvent.activeDragItem.obj.rigidBody.setBodyType(0,!0),this.activeEvent.activeDragItem.paused=!0),this.activeEvent.wasDragEventTriggered===!0&&(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Transition.forEach(s=>{s.stop(),s.object.currentState!==null&&s.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrag.Animation.forEach(s=>{s.stop()}),this.activeEvent.actionsDrag.Audio.forEach(s=>{s.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Particles.forEach(s=>{s.dispatchGameControl("stop")}),this.activeEvent.actionsDrop.SetVariable.forEach(s=>s.checkConditions()),this.activeEvent.actionsDrop.SetVariable.forEach(s=>s.dispatch()),this.activeEvent.actionsDrop.DynamicVariablePlay.forEach(s=>s.dispatch()),this.activeEvent.actionsDrop.ClearLocalStorage.forEach(s=>s.dispatch()),this.activeEvent.actionsDrop.UserAPI.forEach(s=>s.dispatch())),this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!0)}}}connect(){let e={};if(this.eventContext.page.traverseEntity(i=>{i.component&&(e[i.component.uuid]?e[i.component.uuid].push(i.uuid):e[i.component.uuid]=[i.uuid])}),this.eventContext.page.traverseEntity(i=>{var n;(n=i.data)==null||n.events.filter(r=>r.data.type==="DragDrop"&&!r.data.disabled).forEach(r=>{this.events.push(new kke(i,r.id,r.data,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager,e))})}),!this.events.length)return;this.domEventsNeeded.clear(),this.domEventsNeeded.add("pointerdown");let t=this.eventContext.domElement;t.addEventListener("pointerdown",this.onPointerDown),t.addEventListener("pointermove",this.onPointerMove),t.addEventListener("pointerup",this.onPointerUp),this.domEventsNeeded.add("pointermove")}disconnect(){if(!this.events.length)return;this.domEventsNeeded.clear();let e=this.eventContext.domElement;e.removeEventListener("pointerdown",this.onPointerDown),e.removeEventListener("pointermove",this.onPointerMove),e.removeEventListener("pointerup",this.onPointerUp),this.events.forEach(t=>t.dispose())}setCursor(e){this.eventContext.domElement.style.cursor=e}onAnimationFrameDamping(){for(let e of this.events)for(let t of e.dragItems)t.paused||this.updateDragItem(t,!0)}calcPlaneIntersectPos(e,t,i,n){let{getCamera:r,raycaster:s}=this.eventContext;r().getWorldDirection(_m),_m.negate();let a=d0.identity();switch(n==="parent"?Hke.multiplyMatrices(e.parent.matrixWorld,e.hiddenMatrix).decompose(zn,a,Ws):n==="local"&&e.matrixWorld.decompose(zn,a,Ws),i){case"x":zn.set(1,0,0).applyQuaternion(a),Yx.copy(_m).cross(zn),Zh.copy(zn).cross(Yx);break;case"y":zn.set(0,1,0).applyQuaternion(a),Yx.copy(_m).cross(zn),Zh.copy(zn).cross(Yx);break;case"z":zn.set(0,0,1).applyQuaternion(a),Yx.copy(_m).cross(zn),Zh.copy(zn).cross(Yx);break;case"xy":Zh.set(0,0,1).applyQuaternion(a);break;case"yz":Zh.set(1,0,0).applyQuaternion(a);break;case"xz":Zh.set(0,1,0).applyQuaternion(a);break;case"adaptive":_m.angleTo(Ws.set(0,1,0))>Math.PI/6?(zn.crossVectors(Ws.set(0,1,0),_m),Zh.crossVectors(zn,Ws)):Zh.set(0,1,0);break;default:Zh.copy(_m);break}Pv.setFromMatrixPosition(e.matrixWorld);let o=e.userData.lockedPlane?e.userData.worldPosition0:Pv;if(zX.setFromNormalAndCoplanarPoint(Zh,o),!!s.ray.intersectPlane(zX,t)&&(i==="x"||i==="y"||i==="z")){let l=Ws.subVectors(t,o).dot(zn);t.copy(o).addScaledVector(zn,l)}}updateDragItem(e,t=!1){var i,n;Pv.setFromMatrixPosition(e.obj.matrixWorld),e.reset==="current"?Y_.subVectors(e.fromPosition,Pv).divideScalar(e.currentDampingFactor):e.reset==="original"?(Y_.subVectors(e.obj.userData.worldPosition0,Pv).divideScalar(e.currentDampingFactor),e.fromPosition.copy(e.obj.userData.worldPosition0),e.pointStart.copy(e.fromPosition),e.pointEnd.copy(e.pointStart)):Y_.subVectors(e.pointEnd,e.pointStart).add(e.fromPosition).sub(Pv).divideScalar(e.currentDampingFactor),e.paused=e.currentDampingFactor>1?Y_.length()<Vke:!0,(this.activeEvent&&this.activeEvent.data.dampingFactor===1||t)&&Gke(e,Y_.add(Pv),(i=this.activeEvent)!=null&&i.data.drop&&((n=this.activeEvent)!=null&&n.data.autoOrient)?e.orientationMatrix:null),e.obj.dispatchEvent({type:"beginEvent",eventName:"DragDrop"}),this.eventManager.requestRender()}},Qx=new G,DL=new G,vf=new G,yf=new G,VX=new _l,Wke=.01,Xke={type:"requestRender"},qke=function(){let e=new G,t=new G;return(i,n,r)=>r>0?(e.subVectors(i,n),e.length()<=r?i:t.copy(n).add(e.normalize().multiplyScalar(r))):n}(),HX=function(){let e=new Bt;return(t,i)=>{t.position.copy(i),t.parent!==null&&(e.copy(t.parent.matrixWorld).invert(),t.position.applyMatrix4(e)),e.copy(t.hiddenMatrix).invert(),t.position.applyMatrix4(e),t.updateMatrix(),t.hasNonUniformScale&&(t.updateMatrixWorld(),t.updateMatrixWorldSVD()),t instanceof nl&&kf(t.parent)&&t.invalidateDownstreamBooleanData(!0)}}(),Yke=class{constructor(e,t,i,n,r,s){this.data=e,this.id=t,this.object=i,this.paused=!1,this.currentDampingFactor=1,this.snapComplete=!1,this.isReset=!1,this.worldPosition0=new G,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data={...fN.defaultData,...e,...e.resetOnPointerLeave===void 0&&{resetOnPointerLeave:!1}},e.target===void 0||e.target==="cursor"||(this.target=n.find(e.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.resetDampingFactor=80/this.data.resetSpeed+1,this.object.getWorldPosition(this.worldPosition0),this.actions=Os(e,e.actions,n,r,s,i)}},Qke=class extends Ao{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.pairOfEventListeners=[],this.onMouseMove=i=>{if(!(Si.length>1)){this.eventContext.updateRaycaster(i);for(let n of this.events)n.target===void 0&&this.updateSingleEvent(n)}},this.onMouseEnter=i=>{for(let n of this.events)n.target===void 0&&(n.isReset=!1,n.currentDampingFactor=n.data.dampingFactor)},this.onMouseLeave=i=>{for(let n of this.events)n.target===void 0&&(n.data.resetOnPointerLeave&&(n.isReset=!0,n.currentDampingFactor=n.resetDampingFactor),this.updateSingleEvent(n))},this.onTargetChange=i=>()=>{this.updateSingleEvent(i)}}connect(){let{page:e}=this.eventContext;if(e.traverseEntity(n=>{var s,a;let r=(s=n.data)==null?void 0:s.events.find(o=>o.data.type==="Follow"&&!o.data.disabled);r&&(!e.data.globalPhysics.usePhysics||((a=n.dataPatched.physics)==null?void 0:a.rigidBody)!=="dynamic")&&this.events.push(new Yke(r.data,r.id,n,e,this.eventContext.sharedAssets,this.eventManager))}),!this.events.length)return;let{domElement:t,eventElement:i}=this.eventContext;this.domEventsNeeded.clear(),ec&&(this.domEventsNeeded.add("pointerdown"),t.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),i.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents||(t.addEventListener("pointerenter",this.onMouseEnter),t.addEventListener("pointerleave",this.onMouseLeave));for(let n of this.events)if(n.target!==void 0){let r=n.target,s=this.onTargetChange(n);this.pairOfEventListeners.push([r,s]),r.addEventListener("requestRender",s)}}disconnect(){if(!this.events.length)return;let{domElement:e,eventElement:t}=this.eventContext;this.domEventsNeeded.clear(),ec&&e.removeEventListener("pointerdown",this.onMouseMove),t.removeEventListener("pointermove",this.onMouseMove),e.removeEventListener("pointerenter",this.onMouseEnter),e.removeEventListener("pointerleave",this.onMouseLeave);for(let[i,n]of this.pairOfEventListeners)i.removeEventListener("requestRender",n);for(let i of this.events)i.paused=!0,i.isReset=!1,ya(i.actions)}onAnimationFrameDamping(){for(let e of this.events)e.paused||this.updateSingleEvent(e,!0)}updateSingleEvent(e,t=!1){var a;this.events.forEach(o=>{o.actions.Create.forEach(l=>{l.dispatchThrottled()})});let{plane:i,limitDistance:n,limitDistanceEnabled:r}=e.data;if(e.object.getWorldPosition(vf),e.isReset)yf.copy(e.worldPosition0);else if(e.target)e.target.getWorldPosition(yf);else{let{getCamera:o,raycaster:l}=this.eventContext;if(i==="custom"?(o().getWorldDirection(DL),DL.negate(),Qx.copy(DL)):i==="xy"?Qx.set(0,0,1):i==="xz"?Qx.set(0,1,0):i==="yz"&&Qx.set(1,0,0),VX.setFromNormalAndCoplanarPoint(Qx,vf),!l.ray.intersectPlane(VX,yf))return}if(!e.isReset){if(yf.distanceTo(e.worldPosition0)>n&&r&&e.target)if(e.snapComplete=!1,e.data.snapDelay&&(e.delayFinished=!1,typeof window<"u"&&e.timeoutId!==null&&(window.clearTimeout(e.timeoutId),e.timeoutId=null)),e.wasOutside=!0,e.data.resetAfterDistanceLimit)yf.copy(e.worldPosition0),e.currentDampingFactor=e.resetDampingFactor;else return;else if(e.wasOutside&&(e.data.snapDelay&&typeof window<"u"&&(e.timeoutId=window.setTimeout(()=>{e.delayFinished=!0,e.paused=!1,this.updateSingleEvent(e)},e.data.snapDelay*1e3)),e.currentDampingFactor=e.data.dampingFactor,e.wasOutside=!1),e.delayFinished===!1)return}e.data.enabledTranslation[0]===!1&&(yf.x=vf.x),e.data.enabledTranslation[1]===!1&&(yf.y=vf.y),e.data.enabledTranslation[2]===!1&&(yf.z=vf.z);let s=qke(vf,yf,e.wasOutside?0:e.data.maxDelta);if(e.currentDampingFactor>1){let o=Qx.subVectors(s,vf).divideScalar(e.currentDampingFactor);vf.add(o),t&&HX(e.object,vf),e.paused=o.length()<Wke}else HX(e.object,s),e.paused=!0;(a=e.object)==null||a.dispatchEvent({type:"beginEvent",eventName:"Follow"}),e.object.dispatchEvent(Xke)}},Q_=new G,gC=new G,K_=new Bt,Kx=new Ei,Am=new Ei,J_=new G,Z_=new G,Ov=new G,xf=new G,RL=new _l,Kke=1e-6,Jke={type:"requestRender"},Zke={type:"changeRotation"},GX=function(){let e=new Bt;return function(t,i){t.parent!==null?e.multiplyMatrices(t.parent.matrixWorld,t.hiddenMatrix):e.copy(t.hiddenMatrix),i.premultiply(Rie(e).invert()),t.rotation.setFromRotationMatrix(i),t.updateMatrix(),t instanceof nl&&kf(t.parent)&&t.invalidateDownstreamBooleanData(!0)}}(),$ke=class{constructor(e,t,i,n){this.id=t,this.object=i,this.paused=!1,this.currentDampingFactor=1,this.isReset=!1,this.worldQuaternion0=new Ei,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data={...pN.defaultData,...e,...e.resetOnPointerLeave===void 0&&{resetOnPointerLeave:!1}},e.target===void 0||e.target==="cursor"||(this.target=n.find(e.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.object.getWorldQuaternion(this.worldQuaternion0),this.resetDampingFactor=80/this.data.resetSpeed+1}},e6e=class extends Ao{constructor(){super(...arguments),this.events=[],this.pairOfEventListeners=[],this.pairOfUserEventListeners=[],this.onMouseMove=e=>{if(!(Si.length>1)){this._lastMouseEvent=e,this.eventContext.updateRaycaster(e);for(let t of this.events)t.target===void 0&&this.updateSingleEvent(t)}},this.onMouseEnter=e=>{for(let t of this.events)t.target===void 0&&(t.isReset=!1,t.currentDampingFactor=t.data.dampingFactor)},this.onMouseLeave=e=>{for(let t of this.events)t.target===void 0&&(t.data.resetOnPointerLeave&&(t.isReset=!0,t.currentDampingFactor=t.resetDampingFactor),this.updateSingleEvent(t))},this.onScroll=e=>{if(this._lastMouseEvent){let t=new PointerEvent("pointermove",{clientX:this._lastMouseEvent.clientX,clientY:this._lastMouseEvent.clientY,bubbles:!0,cancelable:!0,view:window});this.eventContext.eventElement.dispatchEvent(t)}},this.onTargetChange=e=>()=>{this.updateSingleEvent(e)},this.createUserEventListener=e=>({eventName:t,target:i})=>{if(!t||!i)return;let n=bM(t);n&&n==="LookAt"&&this.updateSingleEvent(e)}}connect(){let{page:e}=this.eventContext;if(e.traverseEntity(n=>{var s,a;let r=(s=n.data)==null?void 0:s.events.find(o=>o.data.type==="LookAt"&&!o.data.disabled);r&&(!e.data.globalPhysics.usePhysics||((a=n.dataPatched.physics)==null?void 0:a.rigidBody)!=="dynamic")&&this.events.push(new $ke(r.data,r.id,n,e))}),!this.events.length)return;let{domElement:t,eventElement:i}=this.eventContext;this.domEventsNeeded.clear(),ec&&(this.domEventsNeeded.add("pointerdown"),t.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),i.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents?i.addEventListener("scroll",this.onScroll):(t.addEventListener("pointerenter",this.onMouseEnter),t.addEventListener("pointerleave",this.onMouseLeave));for(let n of this.events){if(n.target!==void 0){let a=this.onTargetChange(n),o=n.target;this.pairOfEventListeners.push([o,a]),o.addEventListener("requestRender",a)}let r=this.createUserEventListener(n),s=n.object;this.pairOfUserEventListeners.push([s,r]),s.addEventListener("userEvent",r)}}disconnect(){if(!this.events.length)return;let{domElement:e,eventElement:t}=this.eventContext;this.domEventsNeeded.clear(),ec&&e.removeEventListener("pointerdown",this.onMouseMove),t.removeEventListener("pointermove",this.onMouseMove),e.removeEventListener("pointerenter",this.onMouseEnter),e.removeEventListener("pointerleave",this.onMouseLeave),t.removeEventListener("scroll",this.onScroll);for(let[i,n]of this.pairOfEventListeners)i.removeEventListener("requestRender",n);for(let[i,n]of this.pairOfUserEventListeners)i.removeEventListener("userEvent",n);for(let i of this.events)i.paused=!0,i.isReset=!1}onAnimationFrameDamping(){for(let e of this.events)e.paused||this.updateSingleEvent(e)}updateSingleEvent(e){var d;let{tilt:t,axis:i,distance:n,plane:r,limitDistance:s,enabledRotation:a,limitDistanceEnabled:o}=e.data,{getCamera:l,raycaster:c}=this.eventContext,{object:u,target:h}=e;if(u.getWorldPosition(J_),!e.isReset)if(e.target)e.target.getWorldPosition(Z_);else{if(r==="custom"?(l().getWorldDirection(gC),gC.negate(),RL.setFromNormalAndCoplanarPoint(gC,J_)):(r==="xy"?Q_.set(0,0,1):r==="xz"?Q_.set(0,1,0):r==="yz"&&Q_.set(1,0,0),RL.setFromNormalAndCoplanarPoint(Q_,J_)),!c.ray.intersectPlane(RL,Z_))return;n>0&&(r==="custom"||r===void 0)&&Z_.addScaledVector(gC,n)}if(e.isReset||(h?t==="target"?Ov.copy(h.up).applyMatrix4(K_.extractRotation(h.matrixWorld)).normalize():a.some(p=>p===!1)?(i==="x"?(xf.set(0,0,1),a[2]===!1&&xf.set(0,1,0)):i==="y"?(xf.set(1,0,0),a[0]===!1&&xf.set(0,0,1)):(xf.set(0,1,0),a[1]===!1&&xf.set(1,0,0)),Ov.copy(xf).applyQuaternion(e.worldQuaternion0).normalize()):Ov.set(0,1,0):r==="custom"?Ov.set(0,1,0):Ov.copy(Q_)),e.isReset)Am.copy(e.worldQuaternion0);else if(J_.distanceTo(Z_)>s&&o&&h)if(e.data.snapDelay&&(e.delayFinished=!1,typeof window<"u"&&e.timeoutId!==null&&(window.clearTimeout(e.timeoutId),e.timeoutId=null)),e.wasOutside=!0,e.data.resetAfterDistanceLimit)Am.copy(e.worldQuaternion0),e.currentDampingFactor=e.resetDampingFactor;else return;else{if(e.wasOutside&&(e.data.snapDelay&&typeof window<"u"&&(e.timeoutId=window.setTimeout(()=>{e.delayFinished=!0,e.paused=!1,this.updateSingleEvent(e)},e.data.snapDelay*1e3)),e.currentDampingFactor=e.data.dampingFactor,e.wasOutside=!1),e.delayFinished===!1)return;t6e(K_,Z_,J_,Ov,i,xf),Am.setFromRotationMatrix(K_),Kx.setFromUnitVectors(xf.applyQuaternion(Am),Ov),a.some(p=>p===!1)&&t!=="target"&&Am.premultiply(Kx).normalize()}e.currentDampingFactor>1?(u.updateWorldMatrix(!0,!1),Kx.setFromRotationMatrix(Rie(u.matrixWorld)),Kx.slerp(Am,1/e.currentDampingFactor),GX(u,K_.makeRotationFromQuaternion(Kx)),e.paused=8*(1-Kx.dot(Am))<Kke):(GX(u,K_.makeRotationFromQuaternion(Am)),e.paused=!0),(d=e.object)==null||d.dispatchEvent({type:"beginEvent",eventName:"LookAt"}),u.dispatchEvent(Jke),u.dispatchEvent(Zke)}},Oc=new G,js=new G,cs=new G;function t6e(e,t,i,n,r,s){let a=e.elements;cs.subVectors(t,i),cs.lengthSq()===0&&(cs.z=1),cs.normalize(),js.crossVectors(n,cs),js.lengthSq()===0&&(Math.abs(n.z)===1?cs.x+=1e-4:cs.z+=1e-4,cs.normalize(),js.crossVectors(n,cs)),js.normalize(),Oc.crossVectors(cs,js),r==="x"?s.z===1?[js,Oc,cs]=[cs,js,Oc]:(js.negate(),[js,cs]=[cs,js]):r==="y"?s.x===1?[js,Oc,cs]=[Oc,cs,js]:(js.negate(),[Oc,cs]=[cs,Oc]):s.x===1&&(js.negate(),[js,Oc]=[Oc,js]),a[0]=js.x,a[4]=Oc.x,a[8]=cs.x,a[1]=js.y,a[5]=Oc.y,a[9]=cs.y,a[2]=js.z,a[6]=Oc.z,a[10]=cs.z}var i6e=class{constructor(e,t,i,n,r,s){this.id=e,this.data=t,this.object=i,this.entered=!1,this.actions=Os(t,t.actions,n,r,s,i)}disconnect(){ya(this.actions)}dispatchEnter(){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.entered||(this.entered=!0,this.actions.Transition.forEach(e=>e.playFromCurrent()),this.actions.Animation.forEach(e=>e.play()),this.actions.Create.forEach(e=>e.dispatchStart()),this.actions.Particles.forEach(e=>e.dispatchBasic()),this.actions.Destroy.forEach(e=>e.dispatch()),this.actions.SwitchCamera.forEach(e=>e.playFromCurrent()),this.actions.SceneTransition.forEach(e=>e.dispatch()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch()))}dispatchLeave(){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.entered&&(this.entered=!1,this.actions.Create.forEach(e=>e.dispatchStop()),this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.Particles.forEach(e=>e.reverseFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.reverseFromCurrent()))}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Particles.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.Create.forEach(t=>t.dispatch()),this.actions.Particles.forEach(t=>t.dispatchBasic()),this.actions.Destroy.forEach(t=>t.dispatch()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent())),this.actions.SceneTransition.forEach(t=>t.dispatch()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}},n6e=class extends Ao{constructor(e,t){super(e),this.eventManager=t,this.eventsPerObjects={},this.objects=[],this.objects2D=[],this._prevObjects=[],this.onMouseDown=i=>{Si.length>1||(this.eventContext.updateRaycaster(i),this.handleMouseHoverEvent())},this.onMouseUp=i=>{Si.length>1||this.handleMouseHoverEvent(!0)},this.onMouseMove=i=>{Si.length>1||(this.eventContext.updateRaycaster(i),this.handleMouseHoverEvent())},this.onUserEvent=({eventName:i,target:n,reverse:r})=>{var a;if(!i||!n)return;let s=bM(i);s&&s==="MouseHover"&&(n.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),(a=this.eventsPerObjects[n.uuid])==null||a.forEach(o=>o.dispatchUserEvent(r)))}}connect(){let{page:e,sharedAssets:t}=this.eventContext,i=(r,s)=>{var a,o;if(!(!r.visible||!((a=r.data)!=null&&a.events.length))){for(let{id:l,data:c}of r.data.events)if(!c.disabled&&c.type==="MouseHover")try{let u=new i6e(l,c,r,e,t,this.eventManager);this.eventsPerObjects[r.uuid]?this.eventsPerObjects[r.uuid].push(u):this.eventsPerObjects[r.uuid]=[u]}catch{}(o=this.eventsPerObjects[r.uuid])!=null&&o.length&&this.objects.push(r instanceof _a?s:r)}};if(e.traverseEntity(r=>{var s;(r instanceof mo||r instanceof fa)&&((s=r.frame)==null||s.traverse(a=>{i(a,r)})),i(r)}),!this.objects.length)return;let{domElement:n}=this.eventContext;this.domEventsNeeded.clear(),ec&&(this.domEventsNeeded.add("pointerdown"),n.addEventListener("pointerdown",this.onMouseDown),this.domEventsNeeded.add("pointerup"),n.addEventListener("pointerup",this.onMouseUp)),this.domEventsNeeded.add("pointermove"),n.addEventListener("pointermove",this.onMouseMove),this.objects.forEach(r=>{r.addEventListener("userEvent",this.onUserEvent)})}disconnect(){if(!this.objects.length)return;let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),ec&&(e.removeEventListener("pointerdown",this.onMouseDown),e.removeEventListener("pointerup",this.onMouseUp)),e.removeEventListener("pointermove",this.onMouseMove),Object.values(this.eventsPerObjects).forEach(t=>{t.forEach(i=>{i.disconnect()})}),this.objects.forEach(t=>{t.removeEventListener("userEvent",this.onUserEvent)})}handleMouseHoverEvent(e=!1){let t=[];if(!e){let{stopRaycast:i,raycaster:n,page:r,pointerScreen:s}=this.eventContext,a=!1;if(r.uiCanvas&&(a=Rf(r,[s.x,s.y],Object.keys(this.eventsPerObjects),o=>{t.push(o)})),i&&!a){let o=QC(n,r,this.objects);t=Uz(o),o.forEach(l=>{var c,u;l.object instanceof mo&&Rf(l.object,[((c=l==null?void 0:l.uv)==null?void 0:c.x)??0,((u=l==null?void 0:l.uv)==null?void 0:u.y)??0],Object.keys(this.eventsPerObjects),h=>{t.push(h)})})}else this.objects.forEach(o=>{var c,u;let l=Z3(n,o);l&&(t.push(o),o instanceof mo&&Rf(o,[((c=l==null?void 0:l.uv)==null?void 0:c.x)??0,((u=l==null?void 0:l.uv)==null?void 0:u.y)??0],Object.keys(this.eventsPerObjects),h=>{t.push(h)}))})}this._prevObjects.length&&this._prevObjects.forEach(i=>{var n;t.includes(i)||(i.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),(n=this.eventsPerObjects[i.uuid])==null||n.forEach(r=>r.dispatchLeave()))}),t.length&&t.forEach(i=>{var n;i.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),(n=this.eventsPerObjects[i.uuid])==null||n.forEach(r=>r.dispatchEnter())}),this._prevObjects=t}},r6e=class{constructor(e,t,i,n,r,s){this.id=e,this.data=t,this.object=i,this.scrollCounter=0,this.actions=Os(t,t.actions,n,r,s,i)}connect(){this.scrollCounter=0}disconnect(){ya(this.actions)}dispatch(e){this.actions.Transition.forEach(n=>{n.object.currentTransitionEvent!==this&&(n.object.currentTransitionEvent=this,n.init())});let t=e>0?1:-1;this.scrollCounter+=t,this.scrollCounter=Math.min(Math.max(this.scrollCounter,0),this.data.steps);let i=this.scrollCounter/this.data.steps;this.actions.Transition.forEach(n=>n.seek(i)),this.actions.Animation.forEach(n=>n.seek(t)),this.actions.Create.forEach(n=>n.dispatchThrottled()),this.actions.SetVariable.forEach(n=>n.checkConditions()),this.actions.SetVariable.forEach(n=>n.dispatch()),this.actions.DynamicVariablePlay.forEach(n=>n.dispatch()),this.actions.ClearLocalStorage.forEach(n=>n.dispatch()),this.actions.UserAPI.forEach(n=>n.dispatch())}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>{t.playFromCurrent()}),this.actions.Animation.forEach(t=>{t.playFromCurrent()})),this.actions.Create.forEach(t=>t.dispatchThrottled()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}},s6e=class{constructor(e,t,i,n,r,s,a){this.id=e,this.data=t,this.object=i,this.domElement=s,this.eventManager=a,this.scrollStart=0,this.scrollEnd=0,this.actions=Os(t,t.actions,n,r,a,i)}getStickyParentElement(){let e=this.domElement;for(;e;){if(window.getComputedStyle(e).position==="sticky")return e;e=e.parentElement}return null}computeScrollBounds(){let e=this.getStickyParentElement(),t=e==null?void 0:e.parentElement,i=this.domElement.getBoundingClientRect(),n={top:i.top,bottom:i.bottom,left:i.left,right:i.right,width:i.width,height:i.height};if(t){let c=t.getBoundingClientRect(),u=window.getComputedStyle(e),h=parseFloat(u.marginTop)+parseFloat(u.marginBottom),d=parseFloat(u.top),p=parseFloat(u.bottom),g=c.height-h;if(!isNaN(d))i.top===d?(n.top+=c.top-d,n.bottom+=c.top-d):i.top<0&&(n.top-=g-i.height,n.bottom-=g-i.height);else if(!isNaN(p)){let x=document.body.clientHeight??window.innerHeight,y=window.innerWidth-(document.documentElement.clientWidth??window.innerWidth);i.bottom===x-p?(n.top+=c.top-i.height+p+y,n.bottom+=c.top-i.height+p+y):i.bottom<x-p&&(n.top-=g-i.height,n.bottom-=g-i.height)}}let r=document.body,s=document.documentElement,a=window.pageYOffset||s.scrollTop||r.scrollTop,o=s.clientTop||r.clientTop||0,l=Math.round(n.top+a-o);if(this.data.startFrom==="enter"){let c=window.innerHeight,u=n.height,h=this.data.enterAnchor,d=h==="top"?c:h==="bottom"?c-u:c-u*.5;this.scrollStart=l-d}else this.scrollStart=0;this.scrollStart+=this.data.startOffset??0,this.scrollEnd=this.scrollStart+(this.data.endAfter??400),this.box=n,this.computeScroll({x:window.scrollX,y:window.scrollY})}connect(){this.computeScrollBounds()}disconnect(){ya(this.actions)}handleResize(){this.computeScrollBounds()}get isInvalidBox(){return this.box===void 0||this.box.width===0&&this.box.height===0&&this.box.top===0&&this.box.bottom===0}computeScroll({x:e,y:t}){this.actions.Transition.forEach(r=>{r.object.currentTransitionEvent!==this&&(r.object.currentTransitionEvent=this,r.init())});let i=this.scrollEnd-this.scrollStart,n=Math.min(1,Math.max(0,(t-this.scrollStart)/i));this.actions.Transition.forEach(r=>r.seek(n)),this.actions.Animation.forEach(r=>r.seek(n)),this.actions.Create.forEach(r=>r.dispatchThrottled()),this.actions.SetVariable.forEach(r=>r.checkConditions()),this.actions.SetVariable.forEach(r=>r.dispatch()),this.actions.DynamicVariablePlay.forEach(r=>r.dispatch()),this.actions.ClearLocalStorage.forEach(r=>r.dispatch()),this.actions.UserAPI.forEach(r=>r.dispatch())}dispatch(e){this.isInvalidBox&&this.computeScrollBounds(),this.computeScroll(e)}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>{t.playFromCurrent()}),this.actions.Animation.forEach(t=>{t.playFromCurrent()})),this.actions.Create.forEach(t=>t.dispatchThrottled()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}},a6e=class extends Ao{constructor(e,t){super(e),this.managers=t,this.wheelEventsPerObject=new Map,this.scrollEventsPerObject=new Map,this.isInview=!0,this.handleResize=()=>{[...this.scrollEventsPerObject.entries()].forEach(([i,n])=>{n.forEach(r=>r.handleResize())})},this.onScroll=i=>{if(!this.isInview)return;let n={y:window.scrollY,x:window.scrollX};[...this.scrollEventsPerObject.entries()].forEach(([r,s])=>{r.dispatchEvent({type:"beginEvent",eventName:"Scroll",scroll:n}),s.forEach(a=>a.dispatch(n))})},this.onWheel=i=>{!this.isInview||i.ctrlKey||[...this.wheelEventsPerObject.entries()].forEach(([n,r])=>{n.dispatchEvent({type:"beginEvent",eventName:"Scroll",deltaY:i.deltaY}),r.forEach(s=>s.dispatch(i.deltaY))})},this.onUserEvent=({eventName:i,target:n,reverse:r})=>{var a;if(!i||!n)return;let s=bM(i);s&&s==="Scroll"&&(n.dispatchEvent({type:"beginEvent",eventName:"Scroll"}),(a=this.wheelEventsPerObject.get(n))==null||a.forEach(o=>{o.dispatchUserEvent(r)}))}}connect(){let{page:e,sharedAssets:t,domElement:i,isExport:n}=this.eventContext,r=s=>{var a,o,l;if((a=s.data)!=null&&a.events.length){for(let{id:c,data:u}of s.data.events)if(!u.disabled&&u.type==="Scroll")if(u.trigger==="load"||!n){let h=new r6e(c,u,s,e,t,this.managers);this.wheelEventsPerObject.has(s)?(o=this.wheelEventsPerObject.get(s))==null||o.push(h):this.wheelEventsPerObject.set(s,[h])}else{let h=new s6e(c,u,s,e,t,i,this.managers);this.scrollEventsPerObject.has(s)?(l=this.scrollEventsPerObject.get(s))==null||l.push(h):this.scrollEventsPerObject.set(s,[h])}}};e.traverseEntity(s=>{var a;(s instanceof mo||s instanceof fa)&&((a=s.frame)==null||a.traverse(o=>{r(o)})),r(s)}),this.intersectionObserver=new IntersectionObserver(s=>{let a=s[0];a&&(this.isInview=a.isIntersecting)},{root:null}),this.intersectionObserver.observe(this.eventContext.domElement),[...this.wheelEventsPerObject.entries()].forEach(([s,a])=>{a.forEach(o=>o.connect()),s.addEventListener("userEvent",this.onUserEvent)}),[...this.scrollEventsPerObject.entries()].forEach(([s,a])=>{a.forEach(o=>o.connect()),s.addEventListener("userEvent",this.onUserEvent)}),[...this.wheelEventsPerObject.values()].some(s=>s.length)&&(this.domEventsNeeded.add("wheel"),window.addEventListener("wheel",this.onWheel)),[...this.scrollEventsPerObject.values()].some(s=>s.length)&&(this.domEventsNeeded.add("scroll"),window.addEventListener("scroll",this.onScroll),window.addEventListener("resize",this.handleResize))}disconnect(){window.removeEventListener("wheel",this.onWheel),window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.handleResize),this.intersectionObserver.unobserve(this.eventContext.domElement),this.domEventsNeeded.clear(),[...this.wheelEventsPerObject.entries()].forEach(([e,t])=>{t.forEach(i=>i.disconnect()),e.removeEventListener("userEvent",this.onUserEvent)}),[...this.scrollEventsPerObject.entries()].forEach(([e,t])=>{t.forEach(i=>i.disconnect()),e.removeEventListener("userEvent",this.onUserEvent)})}},o6e=class{constructor(e,t,i,n,r,s){this.id=e,this.data=t,this.object=i,this.actions=Os(t,t.actions,n,r,s,i)}disconnect(){ya(this.actions)}dispatch(){this.actions.Transition.forEach(e=>{e.play()}),this.actions.Animation.forEach(e=>{e.play()}),this.actions.SwitchCamera.forEach(e=>{e.play()}),this.actions.SceneTransition.forEach(e=>{e.dispatch()}),this.actions.Reset.forEach(e=>e.dispatch()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch()),this.actions.Create.forEach(e=>{e.dispatchFromStart()}),this.actions.Destroy.forEach(e=>{e.dispatchFromStart()})}dispatchAfter(e){this.actions.Audio.forEach(t=>{(t.interaction.data.triggerAfter??"any")===e&&(t.interaction instanceof h0?t.interaction.audioPlayer.play():t.interaction instanceof Rz&&t.interaction.dispatch())}),this.actions.Video.forEach(t=>{let i=t.interaction.data.triggerAfter??"autoplay";i===e&&(t.interaction instanceof N1?t.interaction.play(i==="autoplay"):t.interaction instanceof Iz&&t.interaction.dispatch())}),this.actions.Particles.forEach(t=>{(t.data.triggerAfter??"any")===e&&t.dispatchBasic()})}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent())),this.actions.SceneTransition.forEach(t=>t.dispatch()),this.actions.Reset.forEach(t=>t.dispatch()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch()),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch()}),this.actions.Audio.forEach(t=>{t.interaction instanceof h0?t.interaction.audioPlayer.play():t.interaction instanceof Rz&&t.interaction.dispatch()}),this.actions.Video.forEach(t=>{t.interaction instanceof N1?t.interaction.play():t.interaction instanceof Iz&&t.interaction.dispatch()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()})}},l6e=class extends Ao{constructor(e,t){super(e),this.eventManager=t,this.eventsPerObject=new Map,this.eventsAfterPerObject=new Map,this.onMouseDown=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,n])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),n.forEach(r=>{r.dispatchAfter("mouseDown")})})},this.onKeyDown=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,n])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),n.forEach(r=>{r.dispatchAfter("keyDown")})})},this.onAny=()=>{let{domElement:i,isExport:n}=this.eventContext,r=n?document:i;r.removeEventListener("pointerdown",this.onAny),r.removeEventListener("mousedown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([s,a])=>{s.dispatchEvent({type:"beginEvent",eventName:"Start"}),a.forEach(o=>{o.dispatchAfter("any")})})},this.onSceneTransitionAudioVideoPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,n])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),n.forEach(r=>{r.actions.Audio.forEach(s=>{s.interaction instanceof h0&&s.interaction.audioPlayer.play()}),r.actions.Video.forEach(s=>{let a=s.interaction.data.triggerAfter??"autoplay";s.interaction instanceof N1&&s.interaction.play(a==="autoplay")}),r.actions.Particles.forEach(s=>{s.dispatchBasic()})})})},this.onPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,n])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),n.forEach(r=>{r.dispatchAfter("autoplay")})})},this.onUserEvent=({eventName:i,target:n,reverse:r})=>{var a,o;if(!i||!n)return;let s=bM(i);s&&s==="Start"&&(n instanceof _a||n.dispatchEvent({type:"beginEvent",eventName:"Start"}),(a=this.eventsPerObject.get(n))==null||a.forEach(l=>{l.dispatchUserEvent(r)}),(o=this.eventsAfterPerObject.get(n))==null||o.forEach(l=>{l.dispatchUserEvent(r)}))}}connect(){let{sharedAssets:e,page:t}=this.eventContext,i=n=>{var r,s,a,o,l;if((r=n.data)!=null&&r.events.length)for(let{id:c,data:u}of n.data.events){if(u.disabled||u.type!=="Start")continue;let h=new o6e(c,u,n,t,e,this.eventManager);(h.actions.Transition.length||h.actions.Animation.length||h.actions.SwitchCamera.length||h.actions.Create.length||h.actions.Destroy.length||h.actions.SceneTransition.length||h.actions.Reset.length||h.actions.SetVariable.length||h.actions.DynamicVariablePlay.length||h.actions.ClearLocalStorage.length||h.actions.UserAPI.length)&&(this.eventsPerObject.has(n)?(s=this.eventsPerObject.get(n))==null||s.push(h):this.eventsPerObject.set(n,[h])),h.actions.Audio.length&&(this.eventsAfterPerObject.has(n)?(a=this.eventsAfterPerObject.get(n))==null||a.push(h):this.eventsAfterPerObject.set(n,[h])),h.actions.Video.length&&(this.hasVideoAction=!0,this.eventsAfterPerObject.has(n)?(o=this.eventsAfterPerObject.get(n))==null||o.push(h):this.eventsAfterPerObject.set(n,[h])),h.actions.Particles.length&&(this.eventsAfterPerObject.has(n)?(l=this.eventsAfterPerObject.get(n))==null||l.push(h):this.eventsAfterPerObject.set(n,[h]))}};if(t.traverseEntity(n=>{var r;(n instanceof mo||n instanceof fa)&&((r=n.frame)==null||r.traverse(s=>{i(s)})),i(n)}),[...this.eventsAfterPerObject.values()].some(n=>n.length)){if(this.eventManager.activateCount===0){let{domElement:n,isExport:r}=this.eventContext,s=r?document:n;s.addEventListener("pointerdown",this.onMouseDown,{once:!0}),s.addEventListener("mousedown",this.onMouseDown,{once:!0}),document.addEventListener("keydown",this.onKeyDown,{once:!0}),s.addEventListener("pointerdown",this.onAny),s.addEventListener("mousedown",this.onAny),document.addEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([a,o])=>{a.addEventListener("userEvent",this.onUserEvent)})}else this.onSceneTransitionAudioVideoPlay();this.onPlay()}[...this.eventsPerObject.entries()].forEach(([n,r])=>{n.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(s=>s.dispatch()),n.addEventListener("userEvent",this.onUserEvent)})}disconnect(){if([...this.eventsAfterPerObject.values()].some(e=>e.length)){let{domElement:e,isExport:t}=this.eventContext,i=t?document:e;i.removeEventListener("pointerdown",this.onMouseDown),i.removeEventListener("mousedown",this.onMouseDown),document.removeEventListener("keydown",this.onKeyDown),i.removeEventListener("pointerdown",this.onAny),i.removeEventListener("mousedown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([n,r])=>{n.removeEventListener("userEvent",this.onUserEvent),r.forEach(s=>s.disconnect())})}[...this.eventsPerObject.entries()].forEach(([e,t])=>{e.removeEventListener("userEvent",this.onUserEvent),t.forEach(i=>i.disconnect())}),this.eventsPerObject.clear(),this.eventsAfterPerObject.clear()}},c6e=class{constructor(e,t,i,n,r,s){this.id=e,this.data=t,this.object=i,this.initialDisabled=!1,this.actions=Os(t,t.actions,n,r,s,i),this.target=t.target}disconnect(){ya(this.actions)}dispatch(e){this.initialDisabled||(this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),this.object.dispatchEvent({type:"beginEvent",eventName:"Collision"}),this.actions.Transition.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()}),this.actions.Animation.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Link.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch(e??!1)}),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.Audio.forEach(t=>{t.dispatchBasic()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()}),this.actions.Video.forEach(t=>{t.dispatchBasic()}),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch()))}},u6e=class extends Ao{constructor(e,t,i,n,r){super(e),this.sharedVariables=t,this.eventManager=i,this.needsMouse=n,this.needsRaycast=r,this.dynamicVars=[],this.variablesToWatch=[],this.prevMouseProperty=null,this.prevRaycastProperty=null,this.pauseTime=0,this.isOutOfFocus=!1,this.events=[],this.onFrame=s=>{let a=this.eventContext.sharedAssets;if(this.rafId=window.requestAnimationFrame(this.onFrame),this.isOutOfFocus)return;let o=new Date,l=[],c=[];for(let d=0;d<this.propertiesToWatch.length;d++){let{objectId:p,property:g,prevValue:x}=this.propertiesToWatch[d],y=this.eventContext.scene.find(p),b=gN.propertyPaths[g];if(b[0]==="width"||b[0]==="height"||b[0]==="depth")y=y.geometry.userData.parameters[b[0]];else for(let A=0;A<b.length;A++)y=y[b[A]];x===null?this.propertiesToWatch[d].prevValue=y instanceof G?y.clone():y:(y instanceof G?!y.equals(x):x!==y)&&(c.push({objId:p,property:g}),y instanceof G?this.propertiesToWatch[d].prevValue.copy(y):this.propertiesToWatch[d].prevValue=y)}for(let d=0;d<this.variablesToWatch.length;d++){let{id:p,prevValue:g}=this.variablesToWatch[d],x=a.getVariable(p);x!==g&&(l.push(p),this.variablesToWatch[d].prevValue=x)}for(let d=0;d<this.dynamicVars.length;d++){let{id:p,expectedTime:g,last:x,data:y,timerSeconds:b,startValue:A}=this.dynamicVars[d],w=1e3;if((y.dynamicVariableType==="timer"||y.dynamicVariableType==="stopwatch")&&y.format==="number3decimal"?w=1:y.dynamicVariableType==="counter"?w=y.updateInterval:y.dynamicVariableType==="random"&&(w=y.isStatic?1/0:y.updateInterval),g===-1){this.dynamicVars[d].last=s,this.dynamicVars[d].expectedTime=s+w;continue}if(!((a.getDynamicVariablePlayState(p)==="Stopped"||a.getDynamicVariablePlayState(p)==="Restarted")&&(this.dynamicVars[d].last=s,this.dynamicVars[d].expectedTime=s+w,y.dynamicVariableType==="counter"&&a.getVariable(p)!==A&&(a.updateVariable(p,A),this.eventManager.requestRender()),(y.dynamicVariableType==="timer"||y.dynamicVariableType==="stopwatch")&&this.dynamicVars[d].timerSeconds!==A&&(this.dynamicVars[d].timerSeconds=A,a.updateVariable(p,zc.getFormattedTimerTime(A,y)),this.eventManager.requestRender()),a.getDynamicVariablePlayState(p)==="Restarted"&&a.setDynamicVariablePlayState(p,"Playing"),a.getDynamicVariablePlayState(p)==="Stopped"))){if(a.getDynamicVariablePlayState(p)==="Paused"){this.dynamicVars[d].deltaToExpectedTime===void 0&&(this.dynamicVars[d].deltaToExpectedTime=Math.max(this.dynamicVars[d].expectedTime-s,0)),this.dynamicVars[d].last=s-(w-this.dynamicVars[d].deltaToExpectedTime),this.dynamicVars[d].expectedTime=s+this.dynamicVars[d].deltaToExpectedTime;continue}else this.dynamicVars[d].deltaToExpectedTime=void 0;if(s>=g)if(this.dynamicVars[d].last=s,this.dynamicVars[d].expectedTime+=w,y.dynamicVariableType==="random"){let E=y.min+Math.random()*(y.max-y.min),D=y.decimals;E=Math.round(E*Math.pow(10,D))/Math.pow(10,D),a.updateVariable(p,E),l.push(p),this.eventManager.requestRender()}else if(y.dynamicVariableType==="counter"){let E=a.getVariable(p),D=a.getDynamicVariableToggleIsForward(p)??!0,T=a.getVariable(p)+y.increment*(D?1:-1);y.hasEnd&&(T=y.increment>0?qt.clamp(T,A,y.endValue):qt.clamp(T,y.endValue,A),T===A&&a.setDynamicVariableToggleIsForward(p,void 0),y.repeat?T===y.endValue&&(T=A):(T===A||T===y.endValue)&&a.setDynamicVariablePlayState(p,"Paused")),T!==E&&(l.push(p),a.updateVariable(p,T),this.eventManager.requestRender())}else if(y.dynamicVariableType==="time"){let E=a.getVariable(p),D=t7(o,y);if(typeof E=="object"&&"textValue"in E&&typeof D=="object"&&"textValue"in D){if(Array.isArray(E.textValue)&&Array.isArray(D.textValue)){if(E.textValue.every((T,I)=>T===D.textValue[I]))continue}else if(E.textValue===D.textValue)continue}else if(E===D)continue;a.updateVariable(p,D),l.push(p),this.eventManager.requestRender()}else{let E=Xa.isTextValue(y.endValue)?kX(y.endValue.textValue):y.endValue,D=a.getDynamicVariableToggleIsForward(p)??!0,T=b+(s-x)/1e3*(y.dynamicVariableType==="timer"?-1:1)*(D?1:-1);T=Math.max(T,0),y.hasEnd&&(T=y.dynamicVariableType==="stopwatch"?qt.clamp(T,A,E):qt.clamp(T,E,A),T===A&&a.setDynamicVariableToggleIsForward(p,void 0),y.repeat?Math.abs(T-E)<(y.format==="number3decimal"?1e-4:.1)&&(T=A):(Math.abs(T-A)<(y.format==="number3decimal"?1e-4:.1)||Math.abs(T-E)<(y.format==="number3decimal"?1e-4:.1))&&a.setDynamicVariablePlayState(p,"Paused")),T!==b&&(l.push(p),this.dynamicVars[d].timerSeconds=T,a.updateVariable(p,zc.getFormattedTimerTime(T,y)),this.eventManager.requestRender())}}}let u=!1;a.mouseProperty!==this.prevMouseProperty&&(this.prevMouseProperty=a.mouseProperty,u=!0);let h=!1;a.raycastProperty!==this.prevRaycastProperty&&(this.prevRaycastProperty=a.raycastProperty,h=!0),this.events.forEach(d=>{(l.includes(d.data.variableId)||c.find(p=>p.objId===d.data.objectId&&p.property===d.data.property)||d.data.variableId==="mouseProperty"&&u||d.data.variableId==="raycastProperty"&&h)&&(d.dispatch(),this.eventManager.requestRender())})},this.onBlur=()=>{this.pause()},this.onFocus=()=>{this.resume()}}pause(){this.isOutOfFocus||(this.isOutOfFocus=!0,this.pauseTime=Date.now())}resume(){if(!this.isOutOfFocus)return;this.isOutOfFocus=!1;let e=Date.now()-this.pauseTime;for(let t=0;t<this.dynamicVars.length;t++)this.dynamicVars[t].last+=e,this.dynamicVars[t].expectedTime+=e}connect(){this.eventContext.page.traverseEntity(t=>{var i;(i=t.data)==null||i.events.filter(n=>n.data.type==="VariableChange"&&!n.data.disabled).forEach(n=>{this.events.push(new h6e(n.id,n.data,t,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),this.propertiesToWatch=this.events.filter(t=>t.data.variableId==="objectProperty"&&t.data.objectId!==null).map(t=>({objectId:t.data.objectId,property:t.data.property,prevValue:null}));let e=this.eventContext.sharedAssets;this.sharedVariables.forEach(({id:t,data:i})=>{if(!("dynamicVariableType"in i)){this.events.find(r=>r.data.variableId===t)&&this.variablesToWatch.push({id:t,prevValue:e.getVariable(t)});return}let n;if(i.dynamicVariableType==="timer"||i.dynamicVariableType==="stopwatch"){let r;if(Xa.isTextValue(i.value)&&Array.isArray(i.value.textValue)){let s=i.value.textValue;s.length===3?r=s[2]+s[1]*60+s[0]*3600:r=s[1]+s[0]*60}else r=i.value;n=r,this.dynamicVars.push({id:t,last:-1,expectedTime:-1,data:i,timerSeconds:r,startValue:n})}else i.dynamicVariableType==="time"&&e.updateVariable(t,t7(new Date,i)),i.dynamicVariableType==="counter"&&(n=Xa.isTextValue(i.value)?kX(i.value.textValue):i.value),this.dynamicVars.push({id:t,last:-1,expectedTime:-1,data:i,startValue:n})}),this.rafId=window.requestAnimationFrame(this.onFrame),window.addEventListener("blur",this.onBlur),window.addEventListener("focus",this.onFocus)}disconnect(){window.removeEventListener("blur",this.onBlur),window.removeEventListener("focus",this.onFocus),this.rafId&&(window.cancelAnimationFrame(this.rafId),this.rafId=void 0),this.events.forEach(e=>e.dispose())}},h6e=class{constructor(e,t,i,n,r,s){this.id=e,this.data=t,this.object=i,this.actions=Os(t,t.actions,n,r,s,i)}dispatch(){let e=this.actions;e.Audio.forEach(t=>t.dispatchConditional()),e.Particles.forEach(t=>t.dispatchConditional()),e.Video.forEach(t=>t.dispatchConditional()),e.Create.forEach(t=>t.dispatch()),e.Destroy.forEach(t=>t.dispatch()),e.Reset.forEach(t=>t.dispatch()),e.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()}),e.Transition.forEach(t=>t.play()),e.Animation.forEach(t=>t.play()),e.SwitchCamera.forEach(t=>t.play()),e.SceneTransition.forEach(t=>t.dispatch()),e.SetVariable.forEach(t=>t.checkConditions()),e.SetVariable.forEach(t=>t.dispatch()),e.DynamicVariablePlay.forEach(t=>t.dispatch()),e.ClearLocalStorage.forEach(t=>t.dispatch()),e.UserAPI.forEach(t=>t.dispatch())}dispose(){ya(this.actions)}};function kX(e){return e.length===3?e[2]+e[1]*60+e[0]*3600:e[1]+e[0]*60}var d6e="https://unpkg.com/@splinetool/runtime@1.10.2/build/",f6e="https://unpkg.com/@splinetool/navmesh-wasm@1.10.2/build/",p6e=`
(async function() {
	const [wasmImport, wasmBinary] = await Promise.all([
		import('${d6e}' + 'navmesh.js'),
		fetch('${f6e}' + 'navmesh.wasm').then((res) => res.arrayBuffer()),
	]);
	const wasmModule = wasmImport.default;
	self.module = await wasmModule({ wasmBinary });
	postMessage('ready');
})();
`,m6e=`
(async function() {
	const [wasmImport, wasmBinary] = await Promise.all([
		import(self.location.origin + '/_libraries/navmesh.js'),
		fetch(self.location.origin + '/_libraries/navmesh.wasm').then((res) => res.arrayBuffer()),
	]);
	const wasmModule = wasmImport.default;
	self.module = await wasmModule({ wasmBinary });
	postMessage('ready');
})();
`,g6e=`

onmessage = function(messageEvent) {
	const meshData = messageEvent.data;
	const positions = meshData[0];
	const offset = meshData[1];
	const indices = meshData[2];
	const indicesLength = meshData[3];
	const parameters = meshData[4];

	const module = self.module;
	const rc = new module.rcConfig();
	rc.cs = parameters.cs;
	rc.ch = parameters.ch;
	rc.borderSize = parameters.borderSize ? parameters.borderSize : 0;
	rc.tileSize = parameters.tileSize ? parameters.tileSize : 0;
	rc.walkableSlopeAngle = parameters.walkableSlopeAngle;
	rc.walkableHeight = parameters.walkableHeight;
	rc.walkableClimb = parameters.walkableClimb;
	rc.walkableRadius = parameters.walkableRadius;
	rc.maxEdgeLen = parameters.maxEdgeLen;
	rc.maxSimplificationError = parameters.maxSimplificationError;
	rc.minRegionArea = parameters.minRegionArea;
	rc.mergeRegionArea = parameters.mergeRegionArea;
	rc.maxVertsPerPoly = parameters.maxVertsPerPoly;
	rc.detailSampleDist = parameters.detailSampleDist;
	rc.detailSampleMaxError = parameters.detailSampleMaxError;

	if (!self.navMesh) {
		self.navMesh = new module.NavMesh();
	}
	self.navMesh.build(positions, offset, indices, indicesLength, rc);

	const navmeshData = navMesh.getNavmeshData();
	const arrView = new Uint8Array(module.HEAPU8.buffer, navmeshData.dataPointer, navmeshData.size);
	const ret = new Uint8Array(navmeshData.size);
	ret.set(arrView);
	navMesh.freeNavmeshData(navmeshData);

	postMessage(ret);
}
`,v6e=.001,y6e={cs:6,ch:2,walkableSlopeAngle:90,walkableHeight:20,walkableClimb:5,walkableRadius:0,maxEdgeLen:12,maxSimplificationError:1.3,minRegionArea:8,mergeRegionArea:20,maxVertsPerPoly:6,detailSampleDist:6,detailSampleMaxError:1},Uie,cn,Ua;fBe.then(e=>{Uie=e,cn=new e.Vec3,Ua=new e.Vec3});var x6e=new G,b6e=class{constructor(e=!1,t=!1){this.usePhysics=e,this.isExport=t,this.onPointerDown=i=>{if(Si.length!==1)return;let{raycaster:n,page:r}=this.eventContext;this.eventContext.updateRaycaster(i);let s=r.raycastWithClones(n);if(s.length!==0){if(this.gameControl){let a=x6e.copy(this.gameControl.colliderWorldPosition);a.y-=this.gameControl.colliderHeight/2,this.gameControl.path=this.computePath(a,s[0].point)}this.eventContext.requestRender()}},this.traverseWithPhysics=(i,n)=>r=>{var d,p,g,x,y,b,A;let s;if(r instanceof Wc)if(r.objectForSample){if(r.objectForSample.dataPatched.physics.fusedBody)return;s=r.object}else return r.object.dataPatched.physics.fusedBody===!0&&r.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(r instanceof qa)s=r.object;else if(s=r,((d=s.dataPatched.cloner)==null?void 0:d.disabled)===!1&&((p=s.dataPatched.cloner)==null?void 0:p.hideBase)&&((g=s.dataPatched.physics)==null?void 0:g.fusedBody)!==!0)return!0;if(n&&!s.userData.navmesh)return;let a=s.dataPatched;if(!a.visible&&((x=a.physics)==null?void 0:x.enabled)!==!0)return!0;r.updateMatrixWorldSVD();let o=$3(a),l=s.userData.hasDestroy,c=s.userData.hasDrag,u=!1,h=!1;for(let w of a.events)w.data.disabled!==!0&&(w.data.type==="GameControl"?u=!0:w.data.type==="Follow"&&(h=!0));if(u||o||h||l||c)return!0;if(this.usePhysics&&((y=a.physics)==null?void 0:y.rigidBody)==="dynamic"){if(this.usePhysics&&((b=a.physics)!=null&&b.fusedBody))return!0}else if("geometry"in r&&r.geometry&&i.push(Df(r.geometry,r.matrixWorld)),this.usePhysics&&((A=a.physics)==null?void 0:A.fusedBody))return r.traverseObject((w,E)=>{var I,R;if(E===0)return;let D;if(w instanceof Wc)if(w.objectForSample){if(w.objectForSample.dataPatched.physics.fusedBody)return;D=w.object}else return w.object.dataPatched.physics.fusedBody===!0&&w.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(w instanceof qa)D=w.object;else if(D=w,(I=w.dataPatched.cloner)==null?void 0:I.hideBase)return!0;let T=D.dataPatched;if(!T.visible&&((R=T.physics)==null?void 0:R.enabled)!==!0)return!0;"geometry"in w&&w.geometry&&i.push(Df(w.geometry,w.matrixWorld))}),!0},this.traverseNoPhysics=(i,n)=>r=>{let s;if(r instanceof Wc)return;r instanceof qa?s=r.object:s=r;let a=s.dataPatched;if(a.physics.enabled==="visibility"?!a.visible:!a.physics.enabled)return!0;if(n&&!s.userData.navmesh)return;let o=r.geometry,l=s.userData.hasDestroy===!0,c=s.userData.hasDrag===!0;if($3(a)||l||c||s.dataPatched.events.some(u=>u.data.disabled!==!0&&u.data.type==="GameControl"))return!0;o&&i.push(Df(o,r.matrixWorld))},this.navmeshWasm=Uie,this.navMesh=new this.navmeshWasm.NavMesh,this._workerURL=URL.createObjectURL(new Blob([(t?p6e:m6e)+g6e])),this._worker=new Worker(this._workerURL)}init(e,t,i){this.gameControl=t,this.eventContext=i,this.setDefaultQueryExtent(new G().setScalar(e.ch*e.walkableRadius*1.2)),this._worker.onmessage=()=>{this.createNavMesh(i.page,e,n=>{this.buildFromNavmeshData(n.data)})},this.eventContext.renderer.domElement.addEventListener("pointerdown",this.onPointerDown)}createNavMesh(e,t,i){t.objects.forEach(l=>{var u;let c=e.scene.find(l);c.traverseEntity(h=>{h.userData.navmesh=!0}),(u=c.cloner)==null||u.traverseObject(h=>{h.userData.navmesh=!0})});let n=[],r=(this.usePhysics?this.traverseWithPhysics:this.traverseNoPhysics)(n,t.zones==="custom");if(e.traverseChildren(r),t.objects.forEach(l=>{var u;let c=e.scene.find(l);c.traverseEntity(h=>{h.userData.navmesh=void 0}),(u=c.cloner)==null||u.traverseObject(h=>{h.userData.navmesh=void 0})}),n.length===0)return!1;let s=u0(n),{positions:a,triIndices:o}=lP(s.getAttribute("position"),s.getIndex());return this._worker.postMessage([a,a.length/3,o,o.length,{...y6e,...t}]),this._worker.onmessage=i,!0}createDebugNavGeometry(){let e,t,i=this.navMesh.getDebugNavMesh(),n=i.getTriangleCount(),r=new Uint32Array(n*3),s=new Float32Array(n*3*3);for(e=0;e<n*3;e++)r[e]=e;for(e=0;e<n;e++)for(t=0;t<3;t++){let o=i.getTriangle(e).getPoint(t);s[e*9+t*3+0]=o.x,s[e*9+t*3+1]=o.y,s[e*9+t*3+2]=o.z}let a=new ii;return a.setIndex(new vi(r,1)),a.setAttribute("position",new vi(s,3)),a}getClosestPoint(e){return cn.x=e.x,cn.y=e.y,cn.z=e.z,this.navMesh.getClosestPoint(cn)}getClosestPointToRef(e,t){cn.x=e.x,cn.y=e.y,cn.z=e.z;let i=this.navMesh.getClosestPoint(cn);t.set(i.x,i.y,i.z)}getRandomPointAround(e,t){return cn.x=e.x,cn.y=e.y,cn.z=e.z,this.navMesh.getRandomPointAround(cn,t)}getRandomPointAroundToRef(e,t,i){cn.x=e.x,cn.y=e.y,cn.z=e.z;let n=this.navMesh.getRandomPointAround(cn,t);i.set(n.x,n.y,n.z)}moveAlong(e,t){return cn.x=e.x,cn.y=e.y,cn.z=e.z,Ua.x=t.x,Ua.y=t.y,Ua.z=t.z,this.navMesh.moveAlong(cn,Ua)}moveAlongToRef(e,t,i){return cn.x=e.x,cn.y=e.y,cn.z=e.z,Ua.x=t.x,Ua.y=t.y,Ua.z=t.z,this.navMesh.moveAlong(cn,Ua)}computePath(e,t){let i=this.getClosestPoint(t);if(Ua.x=i.x,Ua.y=i.y,Ua.z=i.z,Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)+Math.pow(t.z-i.z,2))>this.getDefaultQueryExtent().y)return[];this.getClosestPoint(e);let n=this.navMesh.computePath(cn,Ua),r=n.getPointCount(),s=[];for(let a=0;a<r;a++){let o=n.getPoint(a);s.push(new G(o.x,o.y,o.z))}return s}createCrowd(e,t){return new S6e(this,e,t)}setDefaultQueryExtent(e){cn.x=e.x,cn.y=e.y,cn.z=e.z,this.navMesh.setDefaultQueryExtent(cn)}getDefaultQueryExtent(){return this.navMesh.getDefaultQueryExtent()}buildFromNavmeshData(e){let t=e.length*e.BYTES_PER_ELEMENT,i=this.navmeshWasm._malloc(t),n=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,i,t);n.set(e);let r=new this.navmeshWasm.NavmeshData;r.dataPointer=n.byteOffset,r.size=e.length,this.navMesh.buildFromNavmeshData(r),this.navmeshWasm._free(n.byteOffset)}getNavmeshData(){let e=this.navMesh.getNavmeshData(),t=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,e.dataPointer,e.size),i=new Uint8Array(e.size);return i.set(t),this.navMesh.freeNavmeshData(e),i}getDefaultQueryExtentToRef(e){let t=this.navMesh.getDefaultQueryExtent();e.set(t.x,t.y,t.z)}dispose(){var e;this.navMesh.destroy(),this._worker.terminate(),URL.revokeObjectURL(this._workerURL),(e=this.eventContext)==null||e.renderer.domElement.removeEventListener("pointerdown",this.onPointerDown)}addCylinderObstacle(e,t,i){return cn.x=e.x,cn.y=e.y,cn.z=e.z,this.navMesh.addCylinderObstacle(cn,t,i)}addBoxObstacle(e,t,i){return cn.x=e.x,cn.y=e.y,cn.z=e.z,Ua.x=t.x,Ua.y=t.y,Ua.z=t.z,this.navMesh.addBoxObstacle(cn,Ua,i)}removeObstacle(e){this.navMesh.removeObstacle(e)}isSupported(){return this.navmeshWasm!==void 0}},S6e=class{constructor(e,t,i){this.navmeshWasmWrapper=e,this.transforms=[],this.agents=new Array,this.reachRadii=new Array,this._agentDestinationArmed=new Array,this._agentDestination=new Array,this.crowd=new this.navmeshWasmWrapper.navmeshWasm.Crowd(t,i,this.navmeshWasmWrapper.navMesh.getNavMesh())}onReachTarget(e,t){}addAgent(e,t,i){let n=new this.navmeshWasmWrapper.navmeshWasm.dtCrowdAgentParams;n.radius=t.radius,n.height=t.height,n.maxAcceleration=t.maxAcceleration,n.maxSpeed=t.maxSpeed,n.collisionQueryRange=t.collisionQueryRange,n.pathOptimizationRange=t.pathOptimizationRange,n.separationWeight=t.separationWeight,n.updateFlags=7,n.obstacleAvoidanceType=0,n.queryFilterType=0,n.userData=0;let r=this.crowd.addAgent(new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z),n);return this.transforms.push(i),this.agents.push(r),this.reachRadii.push(t.reachRadius?t.reachRadius:t.radius),this._agentDestinationArmed.push(!1),this._agentDestination.push(new G(0,0,0)),r}getAgentPosition(e){return this.crowd.getAgentPosition(e)}getAgentPositionToRef(e,t){let i=this.crowd.getAgentPosition(e);t.set(i.x,i.y,i.z)}getAgentVelocity(e){return this.crowd.getAgentVelocity(e)}getAgentVelocityToRef(e,t){let i=this.crowd.getAgentVelocity(e);t.set(i.x,i.y,i.z)}getAgentNextTargetPath(e){return this.crowd.getAgentNextTargetPath(e)}getAgentNextTargetPathToRef(e,t){let i=this.crowd.getAgentNextTargetPath(e);t.set(i.x,i.y,i.z)}getAgentState(e){return this.crowd.getAgentState(e)}overOffmeshConnection(e){return this.crowd.overOffmeshConnection(e)}agentGoto(e,t){this.crowd.agentGoto(e,new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x,t.y,t.z));let i=this.agents.indexOf(e);i>-1&&(this._agentDestinationArmed[i]=!0,this._agentDestination[i].set(t.x,t.y,t.z))}agentTeleport(e,t){this.crowd.agentTeleport(e,new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x,t.y,t.z))}updateAgentParameters(e,t){let i=this.crowd.getAgentParameters(e);t.radius!==void 0&&(i.radius=t.radius),t.height!==void 0&&(i.height=t.height),t.maxAcceleration!==void 0&&(i.maxAcceleration=t.maxAcceleration),t.maxSpeed!==void 0&&(i.maxSpeed=t.maxSpeed),t.collisionQueryRange!==void 0&&(i.collisionQueryRange=t.collisionQueryRange),t.pathOptimizationRange!==void 0&&(i.pathOptimizationRange=t.pathOptimizationRange),t.separationWeight!==void 0&&(i.separationWeight=t.separationWeight),this.crowd.setAgentParameters(e,i)}removeAgent(e){this.crowd.removeAgent(e);let t=this.agents.indexOf(e);t>-1&&(this.agents.splice(t,1),this.transforms.splice(t,1),this.reachRadii.splice(t,1),this._agentDestinationArmed.splice(t,1),this._agentDestination.splice(t,1))}getAgents(){return this.agents}update(e){if(this.navmeshWasmWrapper.navMesh.update(),e<=v6e)return;let t=1/60,i=10;{let n=Math.floor(e/t);n>i&&(n=i),n<1&&(n=1);let r=e/n;for(let s=0;s<n;s++)this.crowd.update(r)}for(let n=0;n<this.agents.length;n++){let r=this.agents[n],s=this.getAgentPosition(r);if(this.transforms[n].copy(s),this._agentDestinationArmed[n]){let a=s.x-this._agentDestination[n].x,o=s.z-this._agentDestination[n].z,l=this.reachRadii[n],c=this._agentDestination[n].y-this.reachRadii[n],u=this._agentDestination[n].y+this.reachRadii[n],h=a*a+o*o;s.y>c&&s.y<u&&h<l*l&&(this.onReachTarget(r,this._agentDestination[n]),this._agentDestinationArmed[n]=!1)}}}setDefaultQueryExtent(e){let t=new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z);this.crowd.setDefaultQueryExtent(t)}getDefaultQueryExtent(){return this.crowd.getDefaultQueryExtent()}getDefaultQueryExtentToRef(e){let t=this.crowd.getDefaultQueryExtent();e.set(t.x,t.y,t.z)}getCorners(e){let t,i=this.crowd.getCorners(e),n=i.getPointCount(),r=[];for(t=0;t<n;t++){let s=i.getPoint(t);r.push(new G(s.x,s.y,s.z))}return r}dispose(){this.crowd.destroy()}};function _6e(e){let t=!1;return e.scene.objects.forEach(i=>{i.data.type==="Page"&&!t&&i.data.publish.gameControlObject&&Tw.traverseModuleInstances(e,i.id,(n,r,s)=>{for(let a of s)a.data.type==="GameControl"&&a.data.navmesh.enabled&&(t=!0)})}),t}var A6e={type:"change"},jX={type:"changeZoom"},w6e={type:"changePan"},Bv={type:"start"},Iv={type:"end",changed:!0},M6e={type:"end",changed:!1},PL=new Ei,WX=new Ae,E6e=2*Math.PI,T6e=1e-8,C6e=.01,OL=new G,vC=new Ae,BL=new G,yC=new Ei,XX=new Bt,D6e={type:"requestRender"},Nie=class extends Ka{constructor(e,t,i={isPlayMode:!1,isExport:!1}){super(),this.object=e,this.domElement=t,this.options=i,this.enabled=!0,this.useKeyEvents=!0,this.enableDamping=!1,this.enableZoom=!0,this.enableRotate=!0,this.enablePan=!0,this.autoRotate=!1,this.rotationLimitsMode=0,this.panLimitsMode=0,this.rotationSoftLimit=2,this.panSoftLimit=2,this.hoverRotatePanMode=0,this.zoomLimitsEnabled=!1,this.mouseButtons=[0,5],this.mouseButtonsPlay=[3,4,5],this.touches=[null,Tc.DOLLY_ROTATE,Tc.PAN],this.offset=new G,this.eye=new G,this.lastPosition=new G,this.lastQuaternion=new Ei,this.current=new Ae,this.overShoot=new Ae,this.overRatio=new Ae,this.spherical=new yj,this.sphericalDelta=new yj,this.panOffset=new G,this.panLeftV=new G,this.panUpV=new G,this.panV=new G,this.rotateStart=new Ae,this.rotateEnd=new Ae,this.rotateDelta=new Ae,this.panStart=new Ae,this.panEnd=new Ae,this.panDelta=new Ae,this.dollyStart=new Ae,this.dollyEnd=new Ae,this.dollyDelta=new Ae,this.rotationRangeFactor=new Ae,this.panRangeFactor=new Ae,this.state=-1,this.zoomChanged=!1,this.isPointerDown=!1,this.isThetaFlipped=!1,this.prevScale=0,this.scale=1,this.gesture=!1,this.timer=-1,this.timerHover=-1,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPhi=0,this.maxPhi=Math.PI,this.minTheta=-1/0,this.maxTheta=1/0,this.minH=0,this.maxH=Math.PI,this.minV=-1/0,this.maxV=1/0,this.autoRotateClockwise=!0,this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.resetHoverEffectOnPointerLeave=!1,this.hasChange=!1,this.useWindowEvents=!1,this.isTouchZoom=!0,this.autoRotateSpeed=2,this.dampingFactor=.125,this.zoomSpeed=2,this.rotateSpeed=1,this.panSpeed=1,this.hoverRotatePanStrength=.1,this.hoverRotateDamping=this.dampingFactor,this.thetaIsFree=!1,this.phiIsFree=!1,this.needsUpdate=!0,this.onCameraChange=n=>{this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange),this.object=n.camera,this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)},this.update=()=>{this.object.updateWorldMatrix(!0,!1),this.object.matrixWorld.decompose(BL,yC,OL),this.offset.copy(BL).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.autoRotate&&this.state===-1&&this.rotateLeft((this.autoRotateClockwise===!0?1:-1)*this.getAutoRotationAngle()),this.rotationLimitsMode!==0&&this.applyLimits(this.sphericalDelta,this.rotationLimitsMode,this.rotationSoftLimit,this.maxTheta,this.minTheta,this.maxPhi,this.minPhi,this.rotationRangeFactor),this.rotationLimitsMode!==2&&(this.spherical.phi+=this.sphericalDelta.phi),(this.rotationLimitsMode!==1||this.autoRotate===!0)&&(this.spherical.theta+=this.sphericalDelta.theta),this.spherical.radius*=this.scale,this.zoomLimitsEnabled&&this.object.isPerspectiveCamera&&(this.spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this.spherical.radius))),this.panLimitsMode!==0&&(this.target.applyQuaternion(PL.copy(yC).invert()),this.panOffset.applyQuaternion(PL),this.applyLimits(this.panOffset,this.panLimitsMode,this.panSoftLimit,this.maxH,this.minH,this.maxV,this.minV,this.panRangeFactor),this.target.applyQuaternion(yC),this.panOffset.applyQuaternion(yC)),this.panLimitsMode===2&&(this.panOffset.y=0),this.panLimitsMode===1&&(this.panOffset.x=0),this.state===-1&&!this.gesture?(this.panOffset.multiplyScalar(1-this.dampingFactor),this.target.add(this.panOffset)):(this.target.add(this.panOffset),this.panOffset.set(0,0,0)),this.offset.setFromSpherical(this.spherical),BL.copy(this.target).add(this.offset),this.object.position.copy(this.target).add(this.offset),this.object.parent&&(XX.copy(this.object.parent.matrixWorld).invert(),this.object.position.applyMatrix4(XX));let n=this.spherical.phi%E6e;if(this.eye.copy(this.offset).normalize(),this.object.up.copy(kn.DEFAULT_UP).applyAxisAngle(this.eye,this.object.angleOffsetFromUp),n>0&&n>Math.PI||n<0&&n>-Math.PI?(this.object.up.negate(),this.object.lookAt(this.target),this.object.isUpVectorFlipped=!0):(this.object.lookAt(this.target),this.object.isUpVectorFlipped=!1),this.state===-1||this.enableDamping===!0){let r=this.hoverRotatePanMode===1?this.hoverRotateDamping:this.dampingFactor;this.sphericalDelta.theta*=1-r,this.sphericalDelta.phi*=1-r}else this.sphericalDelta.set(0,0,0);return this.scale=1,this.zoomChanged||this.lastPosition.distanceToSquared(this.object.position)>C6e||8*(1-this.lastQuaternion.dot(this.object.quaternion))>T6e?(this.dispatchEvent(A6e),this.object.dispatchEvent(D6e),this.lastPosition.copy(this.object.position),this.lastQuaternion.copy(this.object.quaternion),this.zoomChanged=!1,!0):(this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.object.wasMovedBySwitchCameraAction=!1,this.sphericalDelta.set(0,0,0),this.panOffset.set(0,0,0),!1)},this.onPointerDown=n=>{this.enabled!==!1&&(n.pointerType==="touch"||n.pointerType==="pen"&&ec?this.onPointerDownTouch(n):this.onPointerDownMouse(n),this.state!==-1&&(this.isPointerDown=!0,this.dispatchEvent(Bv),this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerup",this.onPointerUp),n.stopPropagation(),n.pointerType==="touch"||n.pointerType==="pen"&&ec||this.domElement.setPointerCapture(n.pointerId)))},this.onPointerLeave=n=>{this.resetHoverEffectOnPointerLeave&&!this.useWindowEvents?(this.hoverRotatePanMode===1?(this.sphericalDelta.theta=-this.spherical.theta,this.sphericalDelta.phi=-this.spherical.phi,OL.subVectors(this.position0,this.target0),this.spherical.setFromVector3(OL),this.sphericalDelta.theta+=this.spherical.theta,this.sphericalDelta.phi+=this.spherical.phi,this.sphericalDelta.theta/=8,this.sphericalDelta.phi/=8):this.hoverRotatePanMode===2&&this.panOffset.subVectors(this.target0,this.target).divideScalar(8),this.update()):this.pointerLeaveEvent=n},this.onPointerEnter=n=>{this.resetHoverEffectOnPointerLeave||this.pointerLeaveEvent===void 0?vC.set(n.clientX-this.domElement.clientWidth/2,n.clientY-this.domElement.clientHeight/2):vC.set(n.clientX-this.pointerLeaveEvent.clientX,n.clientY-this.pointerLeaveEvent.clientY),this.hoverRotatePanMode===1?(this.rotateDelta.copy(vC).multiplyScalar(this.rotateSpeed*this.hoverRotatePanStrength).rotateAround(WX,-this.object.angleOffsetFromUp),this.rotateLeft(2*Math.PI*this.rotateDelta.x/this.domElement.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/this.domElement.clientHeight),this.rotateStart.set(n.clientX,n.clientY)):this.hoverRotatePanMode===2&&(this.panDelta.copy(vC).multiplyScalar(this.panSpeed*this.hoverRotatePanStrength),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.set(n.clientX,n.clientY)),this.update()},this.onPointerMove=n=>{this.enabled!==!1&&(this.checkRaycastLock()||(n.pointerType==="touch"||n.pointerType==="pen"&&ec?this.onPointerMoveTouch(n):this.onPointerMoveMouse(n),n.stopPropagation()))},this.onPointerUp=n=>{this.isPointerDown=!1,Si.length===0&&(this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)),Si.length>1&&n.preventDefault(),this.hasChange?this.dispatchEvent(Iv):this.dispatchEvent(M6e),this.state=-1,n&&(n.stopPropagation(),n.pointerType==="touch"||n.pointerType==="pen"&&ec||this.domElement.releasePointerCapture(n.pointerId))},this.onPointerDownMouse=n=>{let r;switch(this.useKeyEvents?r=this.mouseButtons[n.button]:r=this.mouseButtonsPlay[n.button],r){case 0:if(n.altKey===!0&&!n.shiftKey&&!DT(n)){if(this.enableRotate===!1)return;this.handleMouseDownRotate(n),this.state=0}else if(this.key===" "){if(this.enablePan===!1)return;this.handleMouseDownPan(n),this.state=2}break;case 4:if(this.enablePan===!1)return;this.handleMouseDownPan(n),this.state=2;break;case 3:if(DT(n)||n.shiftKey){if(this.enablePan===!1)return;this.handleMouseDownPan(n),this.state=2}else{if(this.enableRotate===!1)return;this.handleMouseDownRotate(n),this.state=0}break;case 5:if(DT(n)||n.shiftKey){if(this.enableRotate===!1)return;this.handleMouseDownRotate(n),this.state=0}else{if(this.enablePan===!1)return;this.handleMouseDownPan(n),this.state=2}break;default:this.state=-1}},this.onPointerMoveMouse=n=>{switch(this.state){case 0:if(this.enableRotate===!1)return;this.handleMouseMoveRotate(n);break;case 1:if(this.enableZoom===!1)return;this.handleMouseMoveDolly(n);break;case 2:if(this.enablePan===!1)return;this.handleMouseMovePan(n);break}this.object.wasMovedByUser=!0},this.onPointerDownTouch=n=>{switch(Si.length>1&&n.preventDefault(),this.touches[Si.length-1]){case Tc.ROTATE:if(this.enableRotate===!1){this.state=-1;return}this.handleTouchStartRotate(),this.state=3;break;case Tc.PAN:if(this.enablePan===!1){this.state=-1;return}this.handleTouchStartPan(),this.state=4;break;case Tc.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this.handleTouchStartDollyPan(),this.state=5;break;case Tc.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this.handleTouchStartDollyRotate(),this.state=6;break;default:this.state=-1}},this.onPointerMoveTouch=n=>{switch(Si.length>1&&n.preventDefault(),this.state){case 3:if(this.enableRotate===!1)return;this.handleTouchMoveRotate(n),this.update();break;case 4:if(this.enablePan===!1)return;this.handleTouchMovePan(n),this.update();break;case 5:if(this.enableZoom===!1&&this.enablePan===!1)return;this.handleTouchMoveDollyPan(n),this.update();break;case 6:if(this.enableZoom===!1&&this.enableRotate===!1)return;this.handleTouchMoveDollyRotate(n),this.update();break;default:this.state=-1}this.object.wasMovedByUser=!0},this.dispatchEndDebounced=_w(()=>this.dispatchEvent(Iv),33),this.onMouseWheel=n=>{this.enabled===!1||this.enableZoom===!1&&this.enablePan===!1||this.checkRaycastLock()||(!this.options.isExport&&this.domElement.clientHeight===document.body.clientHeight&&this.domElement.clientWidth===document.body.clientWidth&&n.preventDefault(),this.dispatchEvent(Bv),this.handleMouseWheel(n),this.dispatchEndDebounced(),this.object.wasMovedByUser=!0)},this.onGesture=n=>{if(n.preventDefault(),this.enabled!==!1&&!this.checkRaycastLock()&&!dM)if(n.type==="gesturechange"){if(this.enableZoom===!1||this.isTouchZoom===!1)return;this.dispatchEvent(Bv),n.scale>this.prevScale?this.dollyIn(this.getZoomScale()):n.scale<this.prevScale&&this.dollyOut(this.getZoomScale()),this.prevScale=n.scale,this.update(),this.object.wasMovedByUser=!0}else this.dispatchEvent(Iv)},this.onContextMenu=n=>{n.preventDefault()},this.onTouchEnd=n=>{n.preventDefault()},this.onKeyDown=n=>{this.enabled!==!1&&(this.key=n.key,n.key===" "&&this.dispatchEvent(Bv))},this.onKeyUp=n=>{this.enabled!==!1&&(this.key=void 0,this.state!==-1&&n.key==="Alt"&&this.onPointerUp(Si[0]),n.key===" "&&this.dispatchEvent(Iv))},this.onPointerHover=n=>{n.pointerType!=="mouse"||this.enabled===!1||this.state!==-1||this.hoverRotatePanMode===2&&this.isPanOverShoot||this.hoverRotatePanMode===1&&this.isRotateOverShoot||(this.isPointerDown=!0,this.hoverRotatePanMode===2?this.handleMouseMovePan(n,this.hoverRotatePanStrength):this.hoverRotatePanMode===1&&this.handleMouseMoveRotate(n,this.hoverRotatePanStrength))},this.onBeginState=()=>{this.enabled=!1,this.needsUpdate=!1},this.onCompleteState=n=>{n.isfromEntity&&this.options.isPlayMode||(this.enabled=!0,this.needsUpdate=!0,this.object.updateUp(),this.object.getTarget(this.target))},this.target=this.object.getTarget(),this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.quat0=this.object.quaternion.clone(),this.isUpVectorFlipped0=this.object.isUpVectorFlipped,this.offset.copy(this.object.position).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.initialSphericalRadius=this.spherical.radius,this.addEventListenersToCamera()}dispatchEvent(e){e.type==="start"?this.hasChange=!1:this.hasChange=!0,super.dispatchEvent(e)}addEventListenersToCamera(){this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)}removeEventListenersFromCamera(){this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange)}updateUseWindowEvents(e){if(window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("pointermove",this.onPointerHover),this.useWindowEvents=e,this.hoverRotatePanMode!==0&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover)),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),this.hoverRotatePanMode!==0&&!this.useWindowEvents){let t=this.useWindowEvents?window:this.domElement;t.addEventListener("pointerleave",this.onPointerLeave),t.addEventListener("pointerenter",this.onPointerEnter)}}fromJSON(e,t){this.setEnableDampingSpeed(e.enableDamping),this.enablePan=e.enablePan,this.enableZoom=e.enableZoom,this.enableRotate=e.enableRotate,this.rotationLimitsMode=e.rotationLimitsMode,this.thetaIsFree=e.rotationHorizontalOffset.min===e.rotationHorizontalOffset.max&&e.rotationHorizontalOffset.min===Math.PI,this.phiIsFree=e.rotationVerticalOffset.min===e.rotationVerticalOffset.max&&e.rotationVerticalOffset.min===Math.PI,this.panLimitsMode=e.panLimitsMode,this.panSoftLimit=e.panSoftLimit,this.rotationSoftLimit=e.rotationSoftLimit,this.hoverRotatePanMode=e.hoverRotatePanMode,this.hoverRotateDamping=e.hoverRotateDamping??this.dampingFactor,this.useWindowEvents=t==="window",this.hoverRotatePanMode!==0&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover));let i=e.hoverRotatePanStrength/100;this.hoverRotatePanStrength=i**2,this.zoomLimitsEnabled=e.zoomLimitsEnabled,this.minZoom=e.zoomLimits.min,this.maxZoom=Math.max(e.zoomLimits.min,e.zoomLimits.max),this.minDistance=1e3/this.maxZoom,this.maxDistance=Math.max(this.minDistance,1e3/e.zoomLimits.min),this.autoRotate=e.autoRotate,this.autoRotateSpeed=e.autoRotateSpeed,this.autoRotateClockwise=e.autoRotateClockwise;let n=this.object.getTarget().applyQuaternion(PL.copy(this.object.quaternion).invert());this.minV=-e.panVerticalOffset.min+n.y,this.maxV=e.panVerticalOffset.max+n.y,this.minH=-e.panHorizontalOffset.min+n.x,this.maxH=e.panHorizontalOffset.max+n.x,this.panRangeFactor.set(this.maxH-this.minH,this.maxV-this.minV).divideScalar(2),this.rotationRangeFactor.setScalar(Math.PI).divideScalar(4),this.minPhi=$h(this.spherical.phi-e.rotationVerticalOffset.min),this.maxPhi=$h(this.spherical.phi+e.rotationVerticalOffset.max),this.minTheta=$h($h(this.spherical.theta)-e.rotationHorizontalOffset.min),this.maxTheta=$h($h(this.spherical.theta)+e.rotationHorizontalOffset.max),this.isThetaFlipped=this.minTheta>this.maxTheta,e.orbitTouches===1&&(this.touches[0]=Tc.ROTATE),e.panTouches===1&&(this.touches[0]=Tc.PAN),e.orbitTouches===2&&(this.touches[1]=Tc.DOLLY_ROTATE),e.panTouches===2&&(this.touches[1]=Tc.DOLLY_PAN),e.orbitTouches===3&&(this.touches[2]=Tc.ROTATE),e.panTouches===3&&(this.touches[2]=Tc.PAN),this.isTouchZoom=e.isTouchZoom,this.resetHoverEffectOnPointerLeave=e.resetHoverEffectOnPointerLeave??!1}connect(){if(this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("wheel",this.onMouseWheel),window.addEventListener("keydown",this.onKeyDown,!1),window.addEventListener("keyup",this.onKeyUp,!1),this.domElement.addEventListener("gesturestart",this.onGesture),this.domElement.addEventListener("gesturechange",this.onGesture),this.domElement.addEventListener("gestureend",this.onGesture),this.domElement.addEventListener("touchend",this.onTouchEnd),this.hoverRotatePanMode!==0&&!this.useWindowEvents){let e=this.useWindowEvents?window:this.domElement;e.addEventListener("pointerleave",this.onPointerLeave),e.addEventListener("pointerenter",this.onPointerEnter)}this.pointerLeaveEvent=void 0}dispose(){this.removeEventListenersFromCamera(),this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("wheel",this.onMouseWheel),window.removeEventListener("keydown",this.onKeyDown,!1),window.removeEventListener("keyup",this.onKeyUp,!1),this.domElement.removeEventListener("pointermove",this.onPointerHover),window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("gesturestart",this.onGesture),this.domElement.removeEventListener("gesturechange",this.onGesture),this.domElement.removeEventListener("gestureend",this.onGesture),this.domElement.removeEventListener("touchend",this.onTouchEnd),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)}applyLimits(e,t,i,n,r,s,a,o){this.overShoot.set(0,0);let l,c,u;e instanceof G?(l=e.x,c=e.y,this.current.set(this.target.x,this.target.y),u=!0):(l=e.theta,c=e.phi,this.current.set($h(this.spherical.theta),$h(this.spherical.phi)),u=!1),i===0&&(this.current.x+=l,this.current.y+=c),(t===3||t===2)&&(!u&&this.isThetaFlipped?this.current.x>n&&this.current.x<0?this.overShoot.x=n-this.current.x:this.current.x<r&&this.current.x>0&&(this.overShoot.x=r-this.current.x):this.current.x>n?this.overShoot.x=n-this.current.x:this.current.x<r&&(this.overShoot.x=r-this.current.x)),(t===3||t===1)&&(this.current.y>s?this.overShoot.y=s-this.current.y:this.current.y<a&&(this.overShoot.y=a-this.current.y)),u||(this.overShoot.x=$h(this.overShoot.x),this.overShoot.y=$h(this.overShoot.y)),i!==0?(this.overRatio.copy(this.overShoot).divide(o),this.overRatio.x=Math.min(Math.abs(this.overRatio.x),1),this.overRatio.y=Math.min(Math.abs(this.overRatio.y),1),i===1&&(this.overRatio.x=qX(Math.abs(this.overRatio.x)),this.overRatio.y=qX(Math.abs(this.overRatio.y))),this.isPointerDown||i===1?i===2&&(this.overRatio.x>.9&&!this.thetaIsFree||this.overRatio.y>.9&&!this.phiIsFree)?this.isPointerDown=!1:(l*this.overShoot.x<0&&!this.thetaIsFree&&(l*=1-this.overRatio.x),c*this.overShoot.y<0&&!this.phiIsFree&&(c*=1-this.overRatio.y)):i===2&&(!u&&(this.overRatio.x>.002&&!this.thetaIsFree||this.overRatio.y>.002&&!this.phiIsFree)||u&&(Math.abs(this.overShoot.x)>2||Math.abs(this.overShoot.y)>2)?(this.thetaIsFree||(l=this.overShoot.x*.05),this.phiIsFree||(c=this.overShoot.y*.05),u?this.isPanOverShoot=!0:this.isRotateOverShoot=!0):u?this.isPanOverShoot=!1:this.isRotateOverShoot=!1)):(l+=this.overShoot.x,c+=this.overShoot.y),e instanceof G?(e.x=l,e.y=c):(this.thetaIsFree||(e.theta=l),this.phiIsFree||(e.phi=c))}setEnableDampingSpeed(e){this.enableDamping=e,this.rotateSpeed=e===!0?.2:1}stopDamping(){this.sphericalDelta.theta=0,this.sphericalDelta.phi=0}getAutoRotationAngle(){return 2*Math.PI/60/60*this.autoRotateSpeed}getZoomScale(){return Math.pow(.95,this.zoomSpeed)}rotateLeft(e){this.sphericalDelta.theta-=e}rotateUp(e){this.sphericalDelta.phi-=e}panLeft(e,t){this.panLeftV.setFromMatrixColumn(t,0),this.panLeftV.multiplyScalar(-e),this.panOffset.add(this.panLeftV)}panUp(e,t){this.panUpV.setFromMatrixColumn(t,1),this.panUpV.multiplyScalar(e),this.panOffset.add(this.panUpV)}pan(e,t){let i=this.domElement;if(i&&this.object.isPerspectiveCamera){let n=this.object.position;this.panV.copy(n).sub(this.target);let r=this.panV.length();r*=Math.tan(this.object.fov/2*Math.PI/180),this.panLeft(2*e*r/i.clientHeight,this.object.matrixWorld),this.panUp(2*t*r/i.clientHeight,this.object.matrixWorld)}else i&&this.object.isOrthographicCamera&&(this.panLeft(e*(this.object.right-this.object.left)/this.object.zoom/i.clientWidth,this.object.matrixWorld),this.panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/i.clientHeight,this.object.matrixWorld));this.dispatchEvent(w6e)}dollyOut(e){this.object.isPerspectiveCamera?this.scale/=e:this.object.isOrthographicCamera&&(this.object.zoom*=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(jX)}dollyIn(e){this.object.isPerspectiveCamera?this.scale*=e:this.object.isOrthographicCamera&&(this.object.zoom/=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(jX)}zoomOut(e=this.getZoomScale()){this.dispatchEvent(Bv),this.dollyOut(e),this.dispatchEvent(Iv)}zoomIn(e=this.getZoomScale()){this.dispatchEvent(Bv),this.dollyIn(e),this.dispatchEvent(Iv)}setZoom(e){if(this.dispatchEvent(Bv),this.object.isPerspectiveCamera){let t=this.initialSphericalRadius/e/this.spherical.radius;this.scale=t}else this.object.isOrthographicCamera&&(this.object.zoom=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0);this.dispatchEvent(Iv)}handleMouseDownRotate(e){this.rotateStart.set(e.clientX,e.clientY)}handleMouseDownDolly(e){this.dollyStart.set(e.clientX,e.clientY)}handleMouseDownPan(e){this.panStart.set(e.clientX,e.clientY)}handleMouseMoveRotate(e,t=1){e.movementX!==void 0?this.rotateDelta.set(e.movementX,e.movementY):(this.rotateEnd.set(e.clientX,e.clientY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart),this.rotateStart.copy(this.rotateEnd)),this.rotateDelta.multiplyScalar(this.rotateSpeed*t).rotateAround(WX,-this.object.angleOffsetFromUp);let i=this.domElement,n=this.useWindowEvents?window.innerHeight:i.clientHeight,r=2*Math.PI*this.rotateDelta.x/n,s=2*Math.PI*this.rotateDelta.y/n;this.rotateLeft(r),this.rotateUp(s),this.update()}handleMouseMoveDolly(e){this.dollyEnd.set(e.clientX,e.clientY),this.dollyDelta.subVectors(this.dollyEnd,this.dollyStart),this.dollyDelta.y>0?this.dollyOut(this.getZoomScale()):this.dollyDelta.y<0&&this.dollyIn(this.getZoomScale()),this.dollyStart.copy(this.dollyEnd),this.update()}handleMouseMovePan(e,t=1){e.movementX!==void 0?this.panDelta.set(e.movementX,e.movementY):(this.panEnd.set(e.clientX,e.clientY),this.panDelta.subVectors(this.panEnd,this.panStart),this.panStart.copy(this.panEnd)),this.panDelta.multiplyScalar(this.panSpeed*t),this.pan(this.panDelta.x,this.panDelta.y),this.update()}handleMouseWheel(e){if(oBe===!1&&DT(e)===!1&&cBe(e)===!0){if(this.enablePan===!1)return;this.gesture?(this.panDelta.set(-e.deltaX,-e.deltaY).multiplyScalar(this.panSpeed),this.panDelta.x=Math.min(Math.abs(this.panDelta.x),100)*(this.panDelta.x<0?-1:1),this.panDelta.y=Math.min(Math.abs(this.panDelta.y),100)*(this.panDelta.y<0?-1:1),e.altKey?this.pan(0,this.panDelta.y):e.shiftKey?this.pan(this.panDelta.x,0):this.pan(this.panDelta.x,this.panDelta.y),this.update()):(this.gesture=!0,this.isPointerDown=!0),window.clearTimeout(this.timer),this.timer=window.setTimeout(()=>{this.gesture=!1,this.isPointerDown=!1},30)}else{if(this.enableZoom===!1||this.gesture)return;e.deltaY===0?e.deltaX<0?this.dollyIn(this.getZoomScale()):e.deltaX>0&&this.dollyOut(this.getZoomScale()):e.deltaY<0?this.dollyIn(this.getZoomScale()):e.deltaY>0&&this.dollyOut(this.getZoomScale()),this.update(),this.gesture=!1,this.isPointerDown=!1}}handleTouchStartRotate(){if(Si.length===2){let e=.5*(Si[0].pageX+Si[1].pageX),t=.5*(Si[0].pageY+Si[1].pageY);this.rotateStart.set(e,t)}else this.rotateStart.set(Si[0].pageX,Si[0].pageY)}handleTouchStartPan(){if(Si.length===2){let e=.5*(Si[0].pageX+Si[1].pageX),t=.5*(Si[0].pageY+Si[1].pageY);this.panStart.set(e,t)}else this.panStart.set(Si[0].pageX,Si[0].pageY)}handleTouchStartDolly(){let e=Si[0].pageX-Si[1].pageX,t=Si[0].pageY-Si[1].pageY,i=Math.sqrt(e*e+t*t);this.dollyStart.set(0,i)}handleTouchStartDollyPan(){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchStartDolly(),this.enablePan&&this.handleTouchStartPan()}handleTouchStartDollyRotate(){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchStartDolly(),this.enableRotate&&this.handleTouchStartRotate()}handleTouchMoveRotate(e){if(Si.length===2){let i=SI(e),n=.5*(e.pageX+i.x),r=.5*(e.pageY+i.y);this.rotateEnd.set(n,r)}else{if(e.pointerId!==Si[0].pointerId)return;this.rotateEnd.set(e.pageX,e.pageY)}this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart).multiplyScalar(this.rotateSpeed);let t=this.domElement;t&&(this.rotateLeft(2*Math.PI*this.rotateDelta.x/t.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/t.clientHeight)),this.rotateStart.copy(this.rotateEnd)}handleTouchMovePan(e){if(Si.length===2){let t=SI(e),i=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);this.panEnd.set(i,n)}else{if(e.pointerId!==Si[0].pointerId)return;this.panEnd.set(e.pageX,e.pageY)}this.panDelta.subVectors(this.panEnd,this.panStart).multiplyScalar(this.panSpeed),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.copy(this.panEnd)}handleTouchMoveDolly(e){let t=SI(e),i=e.pageX-t.x,n=e.pageY-t.y,r=Math.sqrt(i*i+n*n);this.dollyEnd.set(0,r),this.dollyDelta.set(0,Math.pow(this.dollyEnd.y/this.dollyStart.y,this.zoomSpeed)),this.dollyOut(this.dollyDelta.y),this.dollyStart.copy(this.dollyEnd)}handleTouchMoveDollyPan(e){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchMoveDolly(e),this.enablePan&&this.handleTouchMovePan(e)}handleTouchMoveDollyRotate(e){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchMoveDolly(e),this.enableRotate&&this.handleTouchMoveRotate(e)}checkRaycastLock(){var e;if(this.object.data.raycastLock){if(this.options.isPlayMode)return!1;{let t=(e=this.options)==null?void 0:e.showCameraLock;return t&&t(),!0}}else return!1}};function $h(e){let t=Math.PI*2;for(;e<=-Math.PI;)e+=t;for(;e>Math.PI;)e-=t;return e}function qX(e){return 1-Math.pow(1-e,4)}var YX=class{constructor(e,t,i,n,r,s){this.id=e,this.data=t,this.object=i,this.page=n,this.currentIntersectedObjects=[],this.actions=Os(t,t.actions,n,r,s,i),this.target=t.target,this.triggeringObjects=[];for(let a of t.triggeringObjects){let o=n.scene.find(a);o&&this.triggeringObjects.push(o)}}isValidTriggeringObject(e){return this.target==="all"?!0:this.triggeringObjects.some(t=>t===e||t.isAncestorOf(e.uuid)||e.isAncestorOf(t.uuid))}disconnect(){ya(this.actions)}dispatch(){this.object.destroyedInAction||(this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.object.dispatchEvent({type:"beginEvent",eventName:"Trigger"}),this.actions.Transition.forEach(e=>{e.data.runMode==="Toggle"?e.toggle():e.play()}),this.actions.SwitchCamera.forEach(e=>{e.data.runMode==="Toggle"?e.toggle():e.play()}),this.actions.Link.forEach(e=>{e.dispatch()}),this.actions.Reset.forEach(e=>{e.dispatch()}),this.actions.Create.forEach(e=>{e.dispatch()}),this.actions.Destroy.forEach(e=>{e.dispatch(!1)}),this.actions.Audio.forEach(e=>{e.dispatchBasic()}),this.actions.Particles.forEach(e=>{e.dispatchBasic()}),this.actions.Video.forEach(e=>{e.dispatchBasic()}),this.actions.SceneTransition.forEach(e=>{e.dispatch()}),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch()))}},bn;mBe.then(e=>bn=e);var Ms=new G,zu=new Ei,wm=new G,IL=new qs(0,0,0,"YXZ"),QX=new qs(0,0,0,"XYZ"),Fu=new G,LL=new G,UL=new G(1,1,1),Jx=new Ei,xC=new Bt,KX=new Bt,R6e={type:"updateMatrix"},JX=new Ei,NL=new Ol,Nz={type:"beginEvent",eventName:"Collision"},P6e={type:"beginEvent",eventName:"Trigger"};function O6e(e){if(Tw.physicsEnabled(e.scene.objects))return!0;let t=!1;return e.scene.objects.traverse((i,n)=>{if(n.events){if(Array.isArray(n.events)){for(let r of n.events)if(r.data.disabled!==!0&&r.data.type==="GameControl"&&r.data.collisionEnabled){t=!0;break}}else for(let r of Object.values(n.events))if(r.disabled!==!0&&r.type==="GameControl"&&r.collisionEnabled){t=!0;break}}}),t}var $3=e=>e.states.some(t=>t.data.position!==void 0||t.data.rotation!==void 0||t.data.hiddenMatrix!==void 0||t.data.cloner!==void 0||t.data.pathSnapping!==void 0),B6e=class{constructor(e){this.eventContext=e,this.isEnabled=!1,this.gameControl=null,this.joysticks=[],this.joystickToGameControls=[],this.sharedGameControlGlobals={entitiesWithTransformAnim:[],entityToCollisionEvents:{},colliderToEntity:new Map,triggers:[],gamePads:[],createdObjects:[],nCreatedPerAction:{}},this.sensorToTriggerEvent={},this.eventManager=void 0,this.needsCollisionDetection=!1,this.initializationCounter=-1,this.rigidBodyToMesh=new Map,this.nActiveRigidBodies=0,this.collisionEvents=[],this.isExport=!1,this.processRigidBody=t=>{if(t.bodyType()!==bn.RigidBodyType.Dynamic)return;t.isSleeping()||this.nActiveRigidBodies++;let[i,n,r]=this.rigidBodyToMesh.get(t.handle);if(Ms.copy(t.translation()).multiplyScalar(this.pixelsPerMeter),zu.copy(t.rotation()),i.matrixWorld.compose(Ms,zu,n),i.hasNonUniformScale&&i.matrixWorld.multiply(i.shearScale),i.dispatchEvent(R6e),r){let s=i.cloner;if(s&&s.objectForSample===void 0){s.matrixWorld.copy(i.matrixWorld);for(let a of s.children)a.updateMatrixWorld(!0)}for(let a of i.children)a.updateMatrixWorld(!0)}},this.accumulator=0,this.handleCollisionEvents=(t,i,n)=>{var a,o,l,c;if(n===!1)return;let r,s;if(this.sensorToTriggerEvent[t]?(r=this.sensorToTriggerEvent[t],s=this.sharedGameControlGlobals.colliderToEntity.get(i)):this.sensorToTriggerEvent[i]&&(r=this.sensorToTriggerEvent[i],s=this.sharedGameControlGlobals.colliderToEntity.get(t)),r&&s&&r.isValidTriggeringObject(s)){r.dispatch();return}for(let u=this.sharedGameControlGlobals.createdObjects.length-1;u>=0;u--){let h=this.sharedGameControlGlobals.createdObjects[u];if(h.userData.hasCollisionDestroy&&(((a=h.rigidBody)==null?void 0:a.collider(0).handle)===t||((o=h.rigidBody)==null?void 0:o.collider(0).handle)===i)){this.sharedGameControlGlobals.createdObjects.splice(u,1),h.removeFromParent(),requestAnimationFrame(()=>{var d;return(d=this.sharedGameControlGlobals.rapierWorld)==null?void 0:d.removeRigidBody(h.rigidBody)});break}}if(((l=this.gameControl)==null?void 0:l.object)!==void 0&&this.gameControl.object===this.sharedGameControlGlobals.colliderToEntity.get(t)){let u=this.sharedGameControlGlobals.colliderToEntity.get(i),h=this.sharedGameControlGlobals.entityToCollisionEvents[u.uuid];if(h===void 0)return;for(let d of h)d.data.target==="character"&&this.dispatchCollisionEvent(d,u,i)}else if(((c=this.gameControl)==null?void 0:c.object)!==void 0&&this.gameControl.object===this.sharedGameControlGlobals.colliderToEntity.get(i)){let u=this.sharedGameControlGlobals.colliderToEntity.get(t),h=this.sharedGameControlGlobals.entityToCollisionEvents[u.uuid];if(h===void 0)return;for(let d of h)d.data.target==="character"&&this.dispatchCollisionEvent(d,u,t)}else{let u=this.sharedGameControlGlobals.colliderToEntity.get(t),h=this.sharedGameControlGlobals.entityToCollisionEvents[u.uuid];if(h!==void 0)for(let g of h)g.data.target==="scene"&&this.dispatchCollisionEvent(g,u,t);let d=this.sharedGameControlGlobals.colliderToEntity.get(i),p=this.sharedGameControlGlobals.entityToCollisionEvents[d==null?void 0:d.uuid];if(p!==void 0)for(let g of p)g.data.target==="scene"&&this.dispatchCollisionEvent(g,d,i)}},this.isExport=e.isExport,this.sharedAssets=e.sharedAssets,this.renderer=e.renderer,this.requestRender=e.requestRender,this.domElement=this.renderer.domElement,this.pixelsPerMeter=Tie,this.gravity=this.page.data.globalPhysics.gravity}get page(){return this.eventContext.page}attachVRControllers(e){e.forEach(t=>{t.addEventListener("connected",i=>{"gamepad"in i.data&&"axes"in i.data.gamepad&&this.sharedGameControlGlobals.gamePads.push(i.data.gamepad)})})}markIsDestroyTarget(){this.page.traverseVisibleEntity(e=>{var i,n;let t=e.dataPatched;for(let r of t.events){if(r.data.disabled===!0)continue;let s=(n=(i=r.data.actions)==null?void 0:i.find(a=>a.data.type==="Destroy"))==null?void 0:n.data;if(s)for(let a of s.objects){let o=this.page.scene.find(a);o&&(o.userData.hasDestroy=!0)}}})}markIsDragObject(){this.page.traverseVisibleEntity(e=>{let t=e.dataPatched;for(let i of t.events)if(!(i.data.disabled===!0||i.data.type!=="DragDrop"))for(let n of i.data.objects){let r=this.page.scene.find(n);r&&(r.userData.hasDrag=!0)}})}initBVH(){let e=[];if(this.page.traverseChildren(t=>{var c,u;let i,n=t instanceof VA,r=t instanceof HA;if(t instanceof Wc||n||r)return;t instanceof qa?i=t.object:i=t;let s=i.dataPatched;if(((c=s.physics)==null?void 0:c.enabled)==="visibility"?!s.visible:!((u=s.physics)!=null&&u.enabled))return!0;let a=t.geometry,o=i.userData.hasDestroy===!0,l=i.userData.hasDrag===!0;if($3(s)||o||l||i.dataPatched.events.some(h=>h.data.disabled!==!0&&(h.data.type==="GameControl"||h.data.type==="Follow")))return t.updateMatrixWorldSVD(),this.addBoundsTree(t),!0;a&&e.push(Df(a,t.matrixWorld))}),e.length>0){let t=u0(e,!1);this.sharedGameControlGlobals.staticMeshBVH=new zA(t)}}addRigidBody(e,t,i){if(Die(e.matrixWorld))return;let n=[],r="geometry"in e?e.geometry:void 0,s=t.dataPatched;if((r==null?void 0:r.getAttribute("position"))!==void 0&&n.push(Df(r,e.shearScale)),s.physics.fusedBody){let a=this.gatherChildrenGeom(e,n);e.traverseObject(a),e.children.forEach(l=>l.updateMatrixWorld(!0));let o=e.cloner;o&&o.objectForSample===void 0&&s.physics.rigidBody==="dynamic"&&(o.traverseObject(a),o.children.forEach(l=>l.updateMatrixWorld(!0)))}if(n.length>0){let a,o=!i.fromCreate&&s.physics.rigidBody==="dynamic"||i.fromCreate&&i.dynamic;o?(a=bn.RigidBodyDesc.dynamic(),a.setLinearDamping(s.physics.damping).setAngularDamping(s.physics.damping).setAdditionalMass(1e-9).setGravityScale(s.physics.gravityScale).enabledRotations(...s.physics.enabledRotation).enabledTranslations(...s.physics.enabledTranslation)):(i.hasTransformAnim||i.hasFollow||i.hasDrag)&&!i.fromCreate?(a=bn.RigidBodyDesc.kinematicPositionBased(),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(e)):a=bn.RigidBodyDesc.fixed();let l=u0(n);(e.hasNonUniformScale?e.matrixWorldRigid:e.matrixWorld).decompose(Ms,zu,wm),e.position0=Ms.clone().divideScalar(this.pixelsPerMeter),e.rotation0=zu.clone(),Ms.divideScalar(this.pixelsPerMeter),a.setTranslation(Ms.x,Ms.y,Ms.z).setRotation(zu),r?l==null||l.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter):l==null||l.scale(wm.x/this.pixelsPerMeter,wm.y/this.pixelsPerMeter,wm.z/this.pixelsPerMeter);let c=this.sharedGameControlGlobals.rapierWorld.createRigidBody(a);o&&this.rigidBodyToMesh.set(c.handle,[e,wm.clone(),s.physics.fusedBody]);let u=!(s.geometry===void 0||s.geometry.type==="SubdivGeometry"||s.geometry.type==="NonParametricGeometry"||s.geometry.type==="BooleanGeometry"||s.geometry.type==="VectorGeometry"||s.geometry.type==="StarGeometry"||s.geometry.type==="RectangleGeometry"||s.geometry.type==="EllipseGeometry"||s.geometry.type==="TriangleGeometry"||s.geometry.type==="TorusGeometry"||s.geometry.type==="HelixGeometry");try{this.addCollider(c,s.physics,l,t,u)}catch{try{this.addCollider(c,s.physics,l,t,!1)}catch(h){console.error(h)}}e.rigidBody=c}}addBoundsTree(e){var i,n;let t=[];if(((i=e.geometry)==null?void 0:i.getAttribute("position"))!==void 0&&((n=e.geometry)==null?void 0:n.getAttribute("position").count)>0&&t.push(Df(e.geometry,e.shearScale)),e.traverseObject(this.gatherChildrenGeom(e,t)),e.children.forEach(r=>r.updateMatrixWorld(!0)),t.length>0){let r=u0(t,!1);e.bvhGeometry=r,r.getAttribute("position").count>0&&(e.bvhGeometry.boundsTree=new zA(r),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(e))}}addCollider(e,t,i,n,r=!0){var o,l;if((i==null?void 0:i.getAttribute("position").count)===0||((o=i==null?void 0:i.getIndex())==null?void 0:o.count)===0)return;let s;i&&(t.colliderType==="trimesh"?s=bn.ColliderDesc.trimesh(i.getAttribute("position").array,i.getIndex().array):s=bn.ColliderDesc.convexMesh(i.getAttribute("position").array,r?i.getIndex().array:void 0)),s.setFrictionCombineRule(bn.CoefficientCombineRule.Average).setRestitutionCombineRule(bn.CoefficientCombineRule.Average).setDensity(t.density).setFriction(t.friction).setRestitution(t.restitution);let a=this.sharedGameControlGlobals.rapierWorld.createCollider(s,e);this.sharedGameControlGlobals.colliderToEntity.set(a.handle,n),(l=this.sharedGameControlGlobals.entityToCollisionEvents[n.uuid])!=null&&l.some(c=>c.target==="scene")&&a.setActiveEvents(bn.ActiveEvents.COLLISION_EVENTS)}gatherChildrenGeom(e,t){return(i,n)=>{var o;if(n===0)return;let r;if(i instanceof Wc)if(i.objectForSample){if(i.objectForSample.dataPatched.physics.fusedBody)return;r=i.object}else return i.object.dataPatched.physics.fusedBody===!0&&i.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(i instanceof qa)r=i.object;else if(r=i,(o=r.dataPatched.cloner)==null?void 0:o.hideBase)return!0;let s=r.dataPatched;if(s.physics.enabled==="visibility"?!s.visible:!s.physics.enabled)return!0;n===1?e.hasNonUniformScale?i.matrixWorld.multiplyMatrices(e.shearScale,i.hiddenMatrix):i.matrixWorld.copy(i.hiddenMatrix):i.matrixWorld.multiplyMatrices(i.parent.matrixWorld,i.hiddenMatrix),i.matrixWorld.multiply(i.matrix);let a=i.geometry;(a==null?void 0:a.getAttribute("position"))!==void 0&&t.push(Df(a,i.matrixWorld))}}activate(e){var d,p;if(this.isEnabled)return;this.isEnabled=!0,this.eventManager=e,this.usePhysics=this.page.data.globalPhysics.usePhysics;let t=this.page.playCamera,i=!1,n=5,r=8,s=9,a="drag",o=this.page.data.publish.gameControlObject,l=o!==null?this.page.find(o):null,c=null;if(l)for(let g of l.data.events){if(g.data.disabled||g.data.type!=="GameControl")continue;let x=l;for(;this.usePhysics&&((d=x=x.parent)==null?void 0:d.parent)!==null;)(p=x.data.physics)==null||p.fusedBody;g.data.collisionEnabled&&(this.needsCollisionDetection=!0),c===null&&(c=g.data)}if(this.page.traverseEntity(g=>{for(let x of g.dataPatched.events)if(x.data.disabled===!1&&x.data.type==="Trigger")return this.needsCollisionDetection=!0,!0}),l&&c&&(l.data.visible===!0||l.data.physics.enabled===!0)){i=i||c.camera===t.uuid||l.uuid===t.uuid;let g=new Cie(l,this.renderer.domElement,c,this.eventContext.page.data.globalPhysics,this,l.uuid!==t.uuid&&c.camera===t.uuid,t,this.page,this.sharedAssets);this.gameControl=g,n=c.joystickPosLoc,r=c.joystickRotLoc,s=c.jumpTouchButtonLoc,a=c.rotByTouch,ec&&c.touchControl&&(this.joystickToGameControls[n]="pos",c.moveMode==="walk"&&(this.joystickToGameControls[s]="jmp"),a==="joystick"&&(this.joystickToGameControls[r]="rot"))}if(this.gameControl&&this.gameControl.data.navmesh.enabled){let g=this.gameControl.data;if(!this.navigationMeshWrapper){this.navigationMeshWrapper=new b6e(this.usePhysics,this.isExport);let x;g.collider.type==="sphere"?x=g.collider.radius*2:x=g.collider.height,x=Math.floor(x/g.navmesh.ch-1),this.navigationMeshWrapper.init({...g.navmesh,walkableHeight:x},this.gameControl,this.eventContext)}}if(i===!1){let{enableRotate:g,enablePan:x,enableZoom:y,autoRotate:b,hoverRotatePanMode:A}=this.eventManager.publish.orbitControls;(g||x||y||b||A!==0)&&(this.orbitControls=new Nie(t,this.renderer.domElement,{isExport:this.isExport,isPlayMode:!0}),this.orbitControls.addEventListener("change",this.requestRender),this.orbitControls.addEventListener("end",this.requestRender),this.orbitControls.addEventListener("start",this.requestRender),this.orbitControls.fromJSON(this.eventManager.publish.orbitControls,this.eventManager.publish.mouseEventTarget),this.orbitControls.useKeyEvents=!1,this.orbitControls.addEventListenersToCamera(),this.orbitControls.connect(),this.orbitControls.update())}let u=this.renderer.domElement.width/this.renderer.getPixelRatio(),h=this.renderer.domElement.height/this.renderer.getPixelRatio();this.joystickToGameControls.forEach((g,x)=>{let y=document.body.appendChild(document.createElement("div")),[b,A,w]=this.eventManager.eventContext.publish.joystickSizeAndXYOffset[x],E=(u-5*b)/4+b,D={},T=g==="jmp",I=T?0:b;x<10?(x<5?D.top=I/2:D.bottom=I/2,D.left=I/2+x%5*E):x===10?(D.left=I/2,D.top=h/2):(D.right=I/2,D.top=h/2),D.top?D.top-=A[1]:D.bottom+=A[1],D.left?D.left+=A[0]:D.right-=A[0];for(let P in D)D[P]+="px";if(T){let P=y.appendChild(document.createElement("div"));Object.assign(P.style,D,{position:"absolute",width:b+"px",height:b+"px",backgroundColor:`rgba(255,255,255,${w==="show"?.4:0})`,zIndex:"9999",borderRadius:b+"px",border:w==="show"?"solid 2px rgba(0, 0, 0, .1)":"none",display:"flex",alignItems:"center",justifyContent:"center",touchAction:"none"});let U=b/16*16*.4;w==="show"&&(P.innerHTML=`
						<svg width="${U}" height="${b*.4}" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path d="M2 10L8 4L14 10" stroke="black" stroke-opacity="40%" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
						</svg>
					`),P.addEventListener("pointerdown",()=>{this.gameControl.movementState.jump=1,this.requestRender()}),P.addEventListener("touchend",H=>H.preventDefault()),this.joysticks[x]=[void 0,y];return}let R={zone:y,mode:"static",position:D,size:b};w==="hide"&&(R.restOpacity=0);let O=kHe.create(R);O.on("move",(P,U)=>{let H=this.gameControl;g==="pos"?U.force<.2?H.moveForce=0:(H.movementState.movePosZ=Math.sin(-U.angle.radian),H.movementState.movePosX=Math.cos(-U.angle.radian),U.force>1.2?H.movementState.run=1:H.movementState.run=0,U.force<.3?H.moveForce=(U.force-.2)/.1:H.moveForce=1):g==="rot"&&(U.force<.2?H.rotForce=0:(H.movementState.rotPosX=U.vector.y,H.movementState.rotPosY=-U.vector.x,U.force<.3?H.rotForce=(U.force-.2)/.1:H.rotForce=1)),this.requestRender()}),O.on("end",(P,U)=>{let H=this.gameControl;g==="pos"?(H.movementState.movePosZ=0,H.movementState.movePosX=0,H.moveForce=1):g==="rot"&&(H.movementState.rotPosX=0,H.movementState.rotPosY=0,H.rotForce=1)}),this.joysticks[x]=[O,y]}),this.markIsDestroyTarget(),this.markIsDragObject(),this.rebuildBVH(),this.initializationCounter++,window.setTimeout(()=>{this.collisionEvents.forEach(g=>g.initialDisabled=!1)},80)}initPhysics(){var a;(a=this.sharedGameControlGlobals.rapierWorld)==null||a.free(),this.sharedGameControlGlobals.rapierWorld=new bn.World(new bn.Vector3(0,this.gravity,0)),this.events=new bn.EventQueue(!0);let e=[],t=[];if(this.page.traverseChildren(o=>{var b,A,w,E;let l;if(o instanceof Wc)if(o.objectForSample){if(o.objectForSample.dataPatched.physics.fusedBody)return;l=o.object}else return o.object.dataPatched.physics.fusedBody===!0&&o.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(o instanceof qa)l=o.object;else{if(o instanceof HA||o instanceof VA)return;if(l=o,((b=l.dataPatched.cloner)==null?void 0:b.disabled)===!1&&((A=l.dataPatched.cloner)==null?void 0:A.hideBase)&&((w=l.dataPatched.physics)==null?void 0:w.fusedBody)!==!0)return!0}let c=l.dataPatched,u;for(let D of c.events)D.data.disabled!==!0&&D.data.type==="GameControl"&&(u=D.data);if(!c.physics||(c.physics.enabled==="visibility"?!c.visible:!c.physics.enabled))return!0;o.updateMatrixWorldSVD();let h=$3(c),d=!1,p=l.userData.hasDestroy,g=l.userData.hasDrag,x=!1;for(let D of c.events)if(D.data.disabled!==!0){if(D.data.type==="Collision"){d=!0;let T=new c6e(D.id,D.data,l,this.page,this.sharedAssets,this.eventManager);T.initialDisabled=!0,this.collisionEvents.push(T),this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid]&&this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid].every(I=>I.id!==D.id)?this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid].push(T):this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid]=[T]}else if(D.data.type==="Follow"){x=!0;let T=D.data.target;o.traverseVisible(I=>{I.userData.isFollowingObj=T})}}c.physics.rigidBody==="dynamic"&&c.physics.fusedBody===!1&&(o.matrixWorldFusedFalse=o.matrixWorld.clone());let y=o.geometry;if(u!==void 0){let D=bn.RigidBodyDesc.kinematicPositionBased();(o.hasNonUniformScale?o.matrixWorldRigid:o.matrixWorld).decompose(Ms,zu,wm),o.position0=Ms.clone().divideScalar(this.pixelsPerMeter),o.rotation0=zu.clone(),Ms.divideScalar(this.pixelsPerMeter),D.setTranslation(Ms.x,Ms.y,Ms.z).setRotation(zu);let T=this.sharedGameControlGlobals.rapierWorld.createRigidBody(D);o.rigidBody=T;let I;u.collider.type==="sphere"?I=bn.ColliderDesc.ball(u.collider.radius/this.pixelsPerMeter):u.collider.type==="capsule"?I=bn.ColliderDesc.capsule((u.collider.height/2-u.collider.radius)/this.pixelsPerMeter,u.collider.radius/this.pixelsPerMeter):I=bn.ColliderDesc.cuboid(u.collider.width/this.pixelsPerMeter/2,u.collider.height/this.pixelsPerMeter/2,u.collider.depth/this.pixelsPerMeter/2),I.setFrictionCombineRule(bn.CoefficientCombineRule.Average).setRestitutionCombineRule(bn.CoefficientCombineRule.Average).setDensity(c.physics.density).setFriction(c.physics.friction).setRestitution(c.physics.restitution);let R=this.sharedGameControlGlobals.rapierWorld.createCollider(I,T);this.sharedGameControlGlobals.colliderToEntity.set(R.handle,l),Ms.fromArray(u.collider.position).multiply(wm.setFromMatrixScale(l.matrixWorld)).divideScalar(this.pixelsPerMeter),R.setTranslationWrtParent(Ms);let O=new Ei().setFromEuler(new qs().setFromVector3(new G().fromArray(u.collider.rotation)));R.setRotationWrtParent(O),R.setActiveEvents(bn.ActiveEvents.COLLISION_EVENTS),this.generateSensorColliderDescs(l,!0)}else c.physics.rigidBody==="dynamic"||h||x||p||g||d?(this.addRigidBody(o,l,{hasFollow:x,hasTransformAnim:h,hasDrag:g}),this.generateSensorColliderDescs(l,c.physics.fusedBody)):(y&&e.push(Df(y,o.matrixWorld)),c.physics.fusedBody&&o.traverseObject((D,T)=>{var P;if(T===0)return;let I;if(D instanceof Wc)if(D.objectForSample){if(D.objectForSample.dataPatched.physics.fusedBody)return;I=D.object}else return D.object.dataPatched.physics.fusedBody===!0&&D.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else{if(D instanceof HA||D instanceof VA)return;if(D instanceof qa)I=D.object;else if(I=D,(P=I.dataPatched.cloner)==null?void 0:P.hideBase)return!0}let R=I.dataPatched;if(R.physics.enabled==="visibility"?!R.visible:!R.physics.enabled)return!0;let O=D.geometry;(O==null?void 0:O.getAttribute("position"))!==void 0&&e.push(Df(O,D.matrixWorld))}),this.generateSensorColliderDescs(l,c.physics.fusedBody,t));if(((E=c.physics)==null?void 0:E.fusedBody)===!0||u)return!0}),e.length===0)return;let i=u0(e);i.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter);let n=bn.RigidBodyDesc.fixed(),r=this.sharedGameControlGlobals.rapierWorld.createRigidBody(n),s=bn.ColliderDesc.trimesh(i.getAttribute("position").array,i.getIndex().array).setFrictionCombineRule(bn.CoefficientCombineRule.Multiply).setRestitutionCombineRule(bn.CoefficientCombineRule.Multiply).setFriction(1).setRestitution(1);this.sharedGameControlGlobals.rapierWorld.createCollider(s,r);for(let[o,l]of t){let c=this.sharedGameControlGlobals.rapierWorld.createCollider(o,r);this.sensorToTriggerEvent[c.handle]=l}}updatePositions(){return this.nActiveRigidBodies=0,this.sharedGameControlGlobals.rapierWorld.forEachRigidBody(this.processRigidBody),this.nActiveRigidBodies>0}rebuildBVH(){this.usePhysics?this.initPhysics():(this.page.traverseEntity(e=>{for(let t of e.dataPatched.events)if(t.data.type==="Trigger"&&t.data.disabled!==!0){let i=new YX(t.id,t.data,e,this.page,this.sharedAssets,this.eventManager),n=new Bt().compose(Fu.fromArray(t.data.position),Jx.setFromEuler(QX.fromArray(t.data.rotation)),UL);if(t.data.triggerZone==="box"){let r=new ps;r.min.fromArray(t.data.size).multiplyScalar(-.5),r.max.fromArray(t.data.size).multiplyScalar(.5),this.sharedGameControlGlobals.triggers.push([r,n,e,i])}else this.sharedGameControlGlobals.triggers.push([t.data.radius,n,e,i])}}),this.needsCollisionDetection&&this.initBVH())}disconnectEvents(){this.collisionEvents.forEach(e=>e.disconnect()),this.sharedGameControlGlobals.triggers.forEach(e=>e[3].disconnect()),this.sharedGameControlGlobals.triggers.length=0}deactivate(){var e,t,i,n;if(this.isEnabled){this.isEnabled=!1,this.page.traverse(r=>{let s=r;s.matrixWorldFusedFalse&&(s.matrixWorldFusedFalse=void 0),s.rigidBody&&(s.rigidBody=void 0),s.position0&&(s.position0=void 0),s.rotation0&&(s.rotation0=void 0)}),(e=this.sharedGameControlGlobals.rapierWorld)==null||e.free(),this.sharedGameControlGlobals.rapierWorld=void 0,this.sharedGameControlGlobals.staticMeshBVH=void 0,this.accumulator=0,this.sharedGameControlGlobals.entitiesWithTransformAnim=[],this.disconnectEvents(),(t=this.gameControl)==null||t.reset(),(i=this.gameControl)==null||i.dispose(),this.gameControl=null,this.initializationCounter=-1,this.joysticks.forEach(([r,s])=>{r==null||r.destroy(),s.remove()}),this.joystickToGameControls=[],this.joysticks=[],this.orbitControls&&(this.orbitControls.dispose(),this.orbitControls=void 0),(n=this.navigationMeshWrapper)==null||n.dispose(),this.navigationMeshWrapper=void 0;for(let r of Object.values(this.sharedGameControlGlobals.entityToCollisionEvents))r.forEach(s=>s.disconnect());this.sharedGameControlGlobals.entityToCollisionEvents={},this.page.updateMatrixWorld(!0)}}update(e,t,i){if(!this.isEnabled)return!0;let n=!0;if(this.orbitControls!==void 0&&this.orbitControls.needsUpdate&&(n=!this.orbitControls.update()),this.initializationCounter>=0&&this.initializationCounter<2?(this.initializationCounter++,n=!1):this.initializationCounter===2&&this.gameControl&&(n=!this.gameControl.update(e,t,i)&&n),this.usePhysics===!1&&this.checkTrigger(),this.usePhysics){let r=.016666666666666666;if(e===0)n=this.stepPhysics()&&n;else{let s=e/1e3;s<r&&s>r*.55&&(s=r),this.accumulator+=s;let a=performance.now(),o=0,l=6;for(;this.accumulator>=r&&o<l&&(n=this.stepPhysics()&&n,this.accumulator-=r,o++,!(performance.now()-a>r*1e3)););this.accumulator=this.accumulator%r}}return n}stepPhysics(){var e;for(let t of this.sharedGameControlGlobals.entitiesWithTransformAnim){(t.hasNonUniformScale?t.matrixWorldRigid:t.matrixWorld).decompose(Ms,zu,wm),IL.setFromQuaternion(zu);let i=t;i.prevR===void 0?(i.prevR=IL.clone(),i.prevT=Ms.clone()):(i.prevR.copy(IL),i.prevT.copy(Ms)),t.rigidBody&&(t.rigidBody.setNextKinematicTranslation(Ms.divideScalar(this.pixelsPerMeter)),t.rigidBody.setNextKinematicRotation(zu))}return this.sharedGameControlGlobals.rapierWorld.step(this.events),(e=this.events)==null||e.drainCollisionEvents(this.handleCollisionEvents),!this.updatePositions()}dispatchCollisionEvent(e,t,i){var s;let n=((s=this.sharedGameControlGlobals.rapierWorld)==null?void 0:s.getCollider(i))._parent,r;if(t.cloner){for(let a of t.cloner.children)if(a.rigidBody===n){r=a;break}}e.dispatch(r),t.dispatchEvent(Nz)}updateUseWindowEvents(e){var t;(t=this.orbitControls)==null||t.updateUseWindowEvents(e)}generateSensorColliderDescs(e,t,i){let n=KX.copy(e.matrixWorld).invert();e.traverseEntity((r,s)=>{if(t===!1&&s===1)return!0;for(let a of r.dataPatched.events)if(a.data.type==="Trigger"&&a.data.disabled!==!0){let o=new YX(a.id,a.data,r,this.page,this.sharedAssets,this.eventManager),l;if(a.data.triggerZone==="box"?l=bn.ColliderDesc.cuboid(...a.data.size.map(c=>c/(2*this.pixelsPerMeter))):l=bn.ColliderDesc.ball(a.data.radius/this.pixelsPerMeter),l.setDensity(0).setSensor(!0).setActiveEvents(bn.ActiveEvents.COLLISION_EVENTS),Fu.fromArray(a.data.position),Jx.setFromEuler(QX.fromArray(a.data.rotation)),xC.compose(Fu,Jx,UL).premultiply(r.matrixWorld),i?(xC.decompose(Fu,Jx,LL),l.setActiveCollisionTypes(bn.ActiveCollisionTypes.KINEMATIC_FIXED|bn.ActiveCollisionTypes.DYNAMIC_FIXED)):(xC.premultiply(n).decompose(Fu,Jx,LL),e.rigidBody.bodyType()===bn.RigidBodyType.Dynamic||(e.rigidBody.bodyType()===bn.RigidBodyType.Fixed?l.setActiveCollisionTypes(bn.ActiveCollisionTypes.KINEMATIC_FIXED|bn.ActiveCollisionTypes.DYNAMIC_FIXED):l.setActiveCollisionTypes(bn.ActiveCollisionTypes.KINEMATIC_KINEMATIC|bn.ActiveCollisionTypes.DYNAMIC_KINEMATIC))),Fu.divideScalar(this.pixelsPerMeter),l.setTranslation(Fu.x,Fu.y,Fu.z),l.setRotation(Jx),i)i.push([l,o]);else{let c=this.sharedGameControlGlobals.rapierWorld.createCollider(l,e.rigidBody);this.sensorToTriggerEvent[c.handle]=o}}})}checkTrigger(){let e;for(let t=0;t<this.sharedGameControlGlobals.triggers.length;t++){let[i,n,r,s]=this.sharedGameControlGlobals.triggers[t];for(let a=0;a<this.sharedGameControlGlobals.entitiesWithTransformAnim.length;a++){let o=this.sharedGameControlGlobals.entitiesWithTransformAnim[a];if(r===o||s.isValidTriggeringObject(dn.is(o)?o:o.object)===!1)continue;let l=KX.copy(r.matrixWorld).decompose(Fu,JX,LL).compose(Fu,JX,UL).multiply(n),c=xC.copy(o.matrixWorld).invert().multiply(l);i instanceof ps?e=o.bvhGeometry.boundsTree.intersectsBox(i,c):(NL.radius=i,NL.center.setFromMatrixPosition(c),e=o.bvhGeometry.boundsTree.intersectsSphere(NL)),e?s.currentIntersectedObjects.indexOf(o)===-1&&(s.currentIntersectedObjects.push(o),s.dispatch(),r.dispatchEvent(P6e)):s.currentIntersectedObjects=s.currentIntersectedObjects.filter(u=>u!==o)}}}};function I6e(e){let t=this._clip.duration,i=this._clip.start??0,n=this.loop,r=this.time+e,s=this._loopCount,a=n===C4;if(e===0)return s===-1?r:a&&(s&1)===1?t-(r-i):r;if(n===VJ){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else if(r<0)r=0;else{this.time=r;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(s===-1&&(e>=0?(s=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),r>=t||r<i){let o=Math.floor((r-i)/(t-i));r-=(t-i)*o,s+=Math.abs(o);let l=this.repetitions-s;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,a||(r=e>0?t:i,this.repetitions===1&&(r=t)),this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){let c=e<0;this._setEndings(c,!c,a)}else this._setEndings(!1,!1,a);this._loopCount=s,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=r;if(a&&(s&1)===1)return t-(r-i)}return r}var ZX=!1,L6e=class{constructor(e,t,i,n){this.scene=e,this.requestRender=t,this.updateDisplayProgress=i,this.animationInspectorState=n,this.clipIdToAction={},this.activeClip=null,this.needsUpdate=!1,this.addClip=r=>{r.data.type==="Empty"&&r.data.animations&&r.data.animations.forEach((s,a)=>{let o=s[0]+"/";if(Array.isArray(r.identity)?o+=r.identity[0]:o+=r.uuid,this.clipIdToAction[o])return;let l=QU.parse(JSON.parse(s[2]));r.animations[a]=l;let c=this.mixer.clipAction(l,r);ZX===!1&&(Object.getPrototypeOf(c)._updateTime=I6e,ZX=!0),c.clampWhenFinished=!0,this.clipIdToAction[o]=c})},this.mixer=new CEe(e),this.scene.traverseEntity(this.addClip)}deleteClip(e,t){let i=this.scene.find(t);if(!i)return;let n=i.animations.find(s=>s.uuid===e);if(!n)return;let r=this.clipIdToAction[e];!r||(r.stop(),this.mixer.uncacheClip(n),delete this.clipIdToAction[e],i.animations=i.animations.filter(s=>s.uuid!==e))}get isPlaying(){return Object.values(this.clipIdToAction).some(e=>e.isRunning())}playFromInspector(e){this.mixer.stopAllAction();let t=this.clipIdToAction[e];!t||(t.play(),this.activeClip=t.getClip(),this.requestRender())}onExitPlayMode(){Object.values(this.clipIdToAction).forEach(e=>{e.repetitions=1/0,e.loop=HJ}),this.mixer.stopAllAction(),this.requestRender()}play(e){let t=e.clipId+"/"+e.object,i=this.clipIdToAction[t];if(i)return e&&(e.repeat>=0&&(i.repetitions=e.repeat+1),e.direction==="pingpong"&&e.repeat!==0&&(i.loop=C4)),i.play(),i.paused=!1,this.requestRender(),i}resumeFromInspector(e){let t=this.clipIdToAction[e];!t||(t.play(),t.paused=!1,this.requestRender())}pauseFromInspector(e){let t=this.clipIdToAction[e];!t||(t.paused=!0)}stop(){this.mixer.stopAllAction(),this.requestRender()}update(e){var t;if(this.needsUpdate)this.needsUpdate=!1;else if(this.isPlaying===!1||(t=this.animationInspectorState)!=null&&t.isScrubbing)return;this.mixer.update(e/1e3),this.activeClip&&this.updateDisplayProgress(Math.round(this.mixer.time/this.activeClip.duration*(this.maxFrames-1)%(this.maxFrames-1))),this.requestRender()}get maxFrames(){return xie(this.activeClip??void 0)}setProgressFromInspector(e,t){if(!this.clipIdToAction[t])return;this.activeClip!==this.clipIdToAction[t].getClip()&&this.playFromInspector(t);let i=this.clipIdToAction[t].paused;this.clipIdToAction[t].paused=!1,this.mixer.setTime(Math.min(e/(this.maxFrames-1),.9999)*this.activeClip.duration),this.requestRender(),i&&(this.clipIdToAction[t].paused=!0)}},zL=new WeakMap,U6e=class extends lM{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,i,n){let r=new KU(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,s=>{this.decodeDracoFile(s,t).catch(n)},i,n)}decodeDracoFile(e,t,i,n){let r={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!i};return this.decodeGeometry(e,r).then(t)}decodeGeometry(e,t){let i=JSON.stringify(t);if(zL.has(e)){let o=zL.get(e);if(o.key===i)return o.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let n,r=this.workerNextTaskID++,s=e.byteLength,a=this._getWorker(r,s).then(o=>(n=o,new Promise((l,c)=>{n._callbacks[r]={resolve:l,reject:c},n.postMessage({type:"decode",id:r,taskConfig:t,buffer:e},[e])}))).then(o=>this._createGeometry(o.geometry));return a.catch(()=>!0).then(()=>{n&&r&&this._releaseTask(n,r)}),zL.set(e,{key:i,promise:a}),a}_createGeometry(e){let t=new ii;e.index&&t.setIndex(new vi(e.index.array,1));for(let i=0;i<e.attributes.length;i++){let n=e.attributes[i],r=n.name,s=n.array,a=n.itemSize;t.setAttribute(r,new vi(s,a))}return t}_loadLibrary(e,t){let i=new KU(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),i.setWithCredentials(this.withCredentials),new Promise((n,r)=>{i.load(e,n,void 0,r)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;let e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(i=>{let n=i[0];e||(this.decoderConfig.wasmBinary=i[1]);let r=N6e.toString(),s=["/* draco decoder */",n,"","/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([s]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){let n=new Worker(this.workerSourceURL);n._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",decoderConfig:this.decoderConfig}),n.onmessage=function(r){let s=r.data;switch(s.type){case"decode":n._callbacks[s.id].resolve(s);break;case"error":n._callbacks[s.id].reject(s);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+s.type+'"')}},this.workerPool.push(n)}else this.workerPool.sort(function(n,r){return n._taskLoad>r._taskLoad?-1:1});let i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}};function N6e(){let e,t;onmessage=function(a){let o=a.data;switch(o.type){case"init":e=o.decoderConfig,t=new Promise(function(u){e.onModuleLoaded=function(h){u({draco:h})},DracoDecoderModule(e)});break;case"decode":let l=o.buffer,c=o.taskConfig;t.then(u=>{let h=u.draco,d=new h.Decoder,p=new h.DecoderBuffer;p.Init(new Int8Array(l),l.byteLength);try{let g=i(h,d,p,c),x=g.attributes.map(y=>y.array.buffer);g.index&&x.push(g.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:g},x)}catch(g){console.error(g),self.postMessage({type:"error",id:o.id,error:g.message})}finally{h.destroy(p),h.destroy(d)}});break}};function i(a,o,l,c){let u=c.attributeIDs,h=c.attributeTypes,d,p,g=o.GetEncodedGeometryType(l);if(g===a.TRIANGULAR_MESH)d=new a.Mesh,p=o.DecodeBufferToMesh(l,d);else if(g===a.POINT_CLOUD)d=new a.PointCloud,p=o.DecodeBufferToPointCloud(l,d);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!p.ok()||d.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+p.error_msg());let x={index:null,attributes:[]};for(let y in u){let b=self[h[y]],A,w;if(c.useUniqueIDs)w=u[y],A=o.GetAttributeByUniqueId(d,w);else{if(w=o.GetAttributeId(d,a[u[y]]),w===-1)continue;A=o.GetAttribute(d,w)}x.attributes.push(r(a,o,d,y,b,A))}return g===a.TRIANGULAR_MESH&&(x.index=n(a,o,d)),a.destroy(d),x}function n(a,o,l){let c=l.num_faces()*3,u=c*4,h=a._malloc(u);o.GetTrianglesUInt32Array(l,u,h);let d=new Uint32Array(a.HEAPF32.buffer,h,c).slice();return a._free(h),{array:d,itemSize:1}}function r(a,o,l,c,u,h){let d=h.num_components(),p=l.num_points()*d,g=p*u.BYTES_PER_ELEMENT,x=s(a,u),y=a._malloc(g);o.GetAttributeDataArrayForAllPoints(l,h,x,g,y);let b=new u(a.HEAPF32.buffer,y,p).slice();return a._free(y),{name:c,array:b,itemSize:d}}function s(a,o){switch(o){case Float32Array:return a.DT_FLOAT32;case Int8Array:return a.DT_INT8;case Int16Array:return a.DT_INT16;case Int32Array:return a.DT_INT32;case Uint8Array:return a.DT_UINT8;case Uint16Array:return a.DT_UINT16;case Uint32Array:return a.DT_UINT32}}}var jm;function z6e(){return jm||(jm=new U6e,jm.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.2/").preload()),jm.decoderPending}async function F6e(e){if(jm){let t={attributeIDs:jm.defaultAttributeIDs,attributeTypes:jm.defaultAttributeTypes,useUniqueIDs:!1},i;try{i=await jm.decodeGeometry(new Int8Array(e).buffer,t)}catch(n){console.error(n)}if(i)return{index:i.index?{array:i.index.array}:void 0,attributes:Object.entries(i.attributes).map(([n,r])=>({name:n,itemSize:r.itemSize,array:r.array}))}}return null}async function V6e(e,t){let[i,n]=w$(hN.deserialize(new Uint8Array(e)));return Q$(i),n.result().data}function H6e(e){let t=[];return e.scene.objects.traverse((i,n)=>{n.type==="Mesh"&&n.geometry.type==="NonParametricGeometry"&&n.geometry.data.draco!==void 0&&t.push(n)}),t}async function G6e(e){for(let t of e){let i=await F6e(t.geometry.data.draco);if(i){let n=t.geometry.data;i.index&&(n.index={array:i.index.array,itemSize:1,normalized:!1,type:"Uint32Array"});let r={};i.attributes.forEach(({name:s,array:a,itemSize:o})=>{r[s]={array:a,itemSize:o,type:"Float32Array",normalized:!1}}),n.attributes=r,n.draco=void 0}}}var k6e=class{constructor(){this._clickCount=0,this._lastTime=0,this._lastPosition=[0,0],this._delay=500,this._distance=2,this._onMouseDown=e=>{let t=[e.clientX,e.clientY],i=new Date().getTime();if(this._clickCount>0){let n=t[0]-this._lastPosition[0],r=t[1]-this._lastPosition[1];Math.sqrt(n*n+r*r)>this._distance&&(this._clickCount=0)}this._lastPosition=t,this._clickCount=i-this._lastTime>this._delay?1:this._clickCount+1,this._lastTime=i},this._onMouseUp=e=>{}}start(e,t=500,i=2){this._target&&this.stop(),this.reset(),this._delay=t,this._distance=i,this._target=e,this._target.addEventListener("pointerdown",this._onMouseDown,!1),this._target.addEventListener("pointerup",this._onMouseUp,!1)}stop(){this._target&&(this._target.removeEventListener("pointerdown",this._onMouseDown,!1),this._target.removeEventListener("pointerup",this._onMouseUp,!1),this._target=void 0)}get clickCount(){return this._clickCount}reset(){this._clickCount=0,this._lastTime=0,this._lastPosition=[0,0]}},j6e=class{constructor(e,t,i,n,r,s,a,o){this.eventId=e,this.id=t,this.data=i,this.dataEvent=n,this.object=r,this.stage=!1,this.actions=Os(n,i.actions,s,a,o,r)}disconnect(){ya(this.actions)}dispatchIn(){this.actions.Audio.forEach(e=>e.dispatchBasic()),this.actions.Particles.forEach(e=>e.dispatchBasic()),this.actions.Video.forEach(e=>e.dispatchBasic()),this.actions.Create.forEach(e=>e.dispatch()),this.actions.Destroy.forEach(e=>e.dispatch()),this.actions.Reset.forEach(e=>e.dispatch()),this.actions.Link.forEach(e=>e.dispatch()),this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.actions.Transition.forEach(e=>e.toggle()),this.actions.Animation.forEach(e=>e.play()),this.actions.SwitchCamera.forEach(e=>e.play()),this.actions.SceneTransition.forEach(e=>e.dispatch()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch())}dispatchOut(){this.actions.Transition.forEach(e=>{e.toggle()})}},W6e=class extends Ao{constructor(e,t){super(e),this.eventManager=t,this.breakpoints=[],this.resize=(i,n)=>{this.breakpoints.forEach(r=>{let s=mN.deviceToSize(r.data.size),a=r.dataEvent.orientation==="horizontal"?i:n,o;switch(r.data.operator){case"<":o=a<s[0];break;case">":o=a>s[0];break;case"<>":o=a>s[0]&&a<s[1];break}r.stage!==o&&(r.stage=o,r.stage?r.dispatchIn():r.dispatchOut())})},this.onResizeObserver=new ResizeObserver(i=>{for(let n of i){let{width:r,height:s}=n.contentRect;this.resize(r,s)}})}connect(){let{page:e,sharedAssets:t,domElement:i}=this.eventContext;this.onResizeObserver.observe(i);let n=r=>{var s;if(!(!r.visible||!((s=r.data)!=null&&s.events.length)))for(let{data:a,id:o}of r.data.events)a.disabled||a.type==="Resize"&&a.breakpoints.forEach(({data:l,id:c})=>{try{let u=new j6e(o,c,l,a,r,e,t,this.eventManager);this.breakpoints.push(u)}catch{}})};e.traverseEntity(r=>{var s;(r instanceof mo||r instanceof fa)&&((s=r.frame)==null||s.traverse(a=>{n(a)})),n(r)})}disconnect(){this.onResizeObserver.disconnect(),this.breakpoints.forEach(e=>{e.disconnect()}),this.breakpoints=[]}},X6e=class extends Ao{constructor(e,t){super(e),this.eventManager=t,this.userAPIs={},this.events=[],this.onSuccess=({userAPIId:i})=>{this.events.forEach(n=>{n.data.userAPIId===i&&n.dispatchSuccess()})},this.onError=({userAPIId:i})=>{this.events.forEach(n=>{n.data.userAPIId===i&&n.dispatchError()})},this.userAPIs=e.sharedAssets.getUserAPIs()}connect(){this.eventContext.page.traverseEntity(e=>{var t;(t=e.data)==null||t.events.filter(i=>i.data.type==="API"&&!i.data.disabled).forEach(i=>{this.events.push(new q6e(i.id,i.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),Object.entries(this.userAPIs).forEach(([e,t])=>{t.on("success",this.onSuccess),t.on("error",this.onError),t.autostart&&t.callUserAPI(this.eventContext.sharedAssets)})}disconnect(){Object.entries(this.userAPIs).forEach(([e,t])=>{t.off("success",this.onSuccess),t.off("error",this.onError)})}},q6e=class{constructor(e,t,i,n,r,s){this.id=e,this.data=t,this.object=i,this.successActions=Os(t,t.successActions,n,r,s,i),this.errorActions=Os(t,t.errorActions,n,r,s,i)}dispatchSuccess(){this.dispatchActions(this.successActions)}dispatchError(){this.dispatchActions(this.errorActions)}dispatchActions(e){e.Audio.forEach(t=>t.dispatchConditional()),e.Particles.forEach(t=>t.dispatchConditional()),e.Video.forEach(t=>t.dispatchConditional()),e.Create.forEach(t=>t.dispatch()),e.Destroy.forEach(t=>t.dispatch()),e.Reset.forEach(t=>t.dispatch()),e.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()}),e.Transition.forEach(t=>t.play()),e.Animation.forEach(t=>t.play()),e.SwitchCamera.forEach(t=>t.play()),e.SceneTransition.forEach(t=>t.dispatch()),e.SetVariable.forEach(t=>t.checkConditions()),e.SetVariable.forEach(t=>t.dispatch()),e.DynamicVariablePlay.forEach(t=>t.dispatch()),e.ClearLocalStorage.forEach(t=>t.dispatch()),e.UserAPI.forEach(t=>t.dispatch())}},Y6e=class extends Ao{constructor(e,t){super(e),this.eventManager=t,this.userWebhooks={},this.events=[],this.onMessage=({userWebhookId:i})=>{this.events.forEach(n=>{n.data.userWebhookId===i&&n.dispatch()})},this.userWebhooks=e.sharedAssets.getUserWebhooks()}connect(){this.eventContext.page.traverseEntity(e=>{var t;(t=e.data)==null||t.events.filter(i=>i.data.type==="WEBHOOK"&&!i.data.disabled).forEach(i=>{this.events.push(new Q6e(i.id,i.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),Object.entries(this.userWebhooks).forEach(([e,t])=>{t.connect(),t.on("message",this.onMessage)})}disconnect(){Object.entries(this.userWebhooks).forEach(([e,t])=>{t.off("message",this.onMessage),t.disconnect()})}},Q6e=class{constructor(e,t,i,n,r,s){this.id=e,this.data=t,this.object=i,this.actions=Os(t,t.actions,n,r,s,i)}dispatch(){let e=this.actions;e.Audio.forEach(t=>t.dispatchConditional()),e.Particles.forEach(t=>t.dispatchConditional()),e.Video.forEach(t=>t.dispatchConditional()),e.Create.forEach(t=>t.dispatch()),e.Destroy.forEach(t=>t.dispatch()),e.Reset.forEach(t=>t.dispatch()),e.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()}),e.Transition.forEach(t=>t.play()),e.Animation.forEach(t=>t.play()),e.SwitchCamera.forEach(t=>t.play()),e.SceneTransition.forEach(t=>t.dispatch()),e.SetVariable.forEach(t=>t.checkConditions()),e.SetVariable.forEach(t=>t.dispatch()),e.DynamicVariablePlay.forEach(t=>t.dispatch()),e.ClearLocalStorage.forEach(t=>t.dispatch()),e.UserAPI.forEach(t=>t.dispatch())}};function K6e(){let e=document.createElement("textarea");return e.style.position="fixed",e.style.top="200px",e.style.left="400px",e.style.zIndex="-1",e.style.border="1px solid rgba(255,0,0,0.5)",e.style.width="10px",e.style.height="500px",e.style.color="white",e.style.opacity="0.5",e.style.background="transparent",e.style.display="none",e.style.margin="0px",e.style.padding="0px",e.style.boxSizing="content-box",e.style.pointerEvents="none",e}var J6e=new G(0,0,1),$X=new G,eq=new G,tq=new Cs,Z6e=class{constructor(e,t,i,n,r){this.containerScene=e,this.raycaster=t,this.sharedAssets=i,this.requestRender=n,this.onExit=r,this.htmlInput=null,this.virtualInput=null,this.helper=new wte,this.doubleClickHandler=new k6e,this.isDragging=!1,this.plane=new _l,this.caretInterval=0,this.planeIntersection=new G,this.projected=new Ae,this._lastIndex=0,this._isFirstDragMove=!1,this.selectionOnDragStart=0,this.onTextMaterialChanged=()=>{var a;let s=(a=this.virtualInput)==null?void 0:a.data;if(this.virtualInput!==void 0&&s){let o=s.material,l=typeof o=="string"?this.sharedAssets.data.materials[o]:o,c=sVe(l,this.sharedAssets);this.helper.setCaretColor(c)}},this.stopAnimateTextCursor=()=>{clearInterval(this.caretInterval),this.helper&&(this.helper.caretMesh.visible=!1)},this.startAnimateTextCursor=()=>{this.stopAnimateTextCursor(),this.helper&&(this.helper.caretMesh.visible=!0,this.caretInterval=setInterval(()=>{this.helper&&(this.helper.caretMesh.visible=!this.helper.caretMesh.visible),this.requestRender()},600))},this.handleCaretUpdate=s=>{if(!this.htmlInput||!this.virtualInput)return;let a=this.helper,o=(s==null?void 0:s.key)==="ArrowLeft"||(s==null?void 0:s.key)==="ArrowRight",l=(s==null?void 0:s.key)==="ArrowUp"||(s==null?void 0:s.key)==="ArrowDown";this.htmlInput.selectionStart===this.htmlInput.selectionEnd?(a.setCaretPosition(this.htmlInput.selectionStart,{horizontalKeyMove:o,verticalKeyMove:l}),this.startAnimateTextCursor()):a.setSelection(this.htmlInput.selectionStart,this.htmlInput.selectionEnd),this.requestRender()},this.containerScene.add(this.helper)}createInput(){return this.htmlInput=K6e(),this.htmlInput}connect(){}disconnect(){var e;this.stopAnimateTextCursor(),this.helper.hide(),(e=this.htmlInput)==null||e.remove(),this.doubleClickHandler.stop()}handleMouseDown(){var s,a;if(!this.htmlInput||!this.virtualInput)return!0;this.getPointOnPlane();let e=this.doubleClickHandler.clickCount,{index:t,lineIndex:i,characterIndex:n}=this.helper.getSelectionFromPosition(this.projected.x,this.projected.y,e>1?"inside":"previous")??{index:0,lineIndex:0,characterIndex:0};(a=(s=this.virtualInput)==null?void 0:s.wrappedText)!=null&&a.length&&this.virtualInput.wrappedText[i][Math.max(0,n-1)]===`
`&&(t--,n--),this._lastIndex=t,this._isFirstDragMove=!0;let r=this.checkClickedObject();if(e===1){if(r===null)return this.onExit(this.virtualInput),!0;this.selectionOnDragStart=t,this.isDragging=!0,this.setInputSelection(t)}else r===this.virtualInput&&(e===2?this.selectClosestWord(i,n):e>2&&(this.setInputSelection(0,this.htmlInput.value.length),this.doubleClickHandler.reset()))}handleMouseUp(){this.applyRangeToTextInput(),this.isDragging=!1,this._isFirstDragMove=!1}handleMouseMove(){!this.virtualInput||(this._isFirstDragMove&&this.doubleClickHandler.clickCount>1&&(this.selectionOnDragStart=this._lastIndex,this.isDragging=!0,this.setInputSelection(this._lastIndex)),this._isFirstDragMove=!1,this.getPointOnPlane(),this.applyRangeToTextInput())}focus(e){var t;if(this.virtualInput=e,this.updateTextInputStyles(),this.htmlInput)if(e){let i=(t=this.data)==null?void 0:t.geometry.text;this.htmlInput.value=typeof i=="string"?"":(i==null?void 0:i.textValue.toString())??""}else this.htmlInput.value=""}blur(){}get data(){let{virtualInput:e}=this;if(e)return e.dataPatched}applyRangeToTextInput(){var r;if(!this.isDragging||!this.virtualInput||!this.htmlInput)return;let e=this.selectionOnDragStart,{index:t,lineIndex:i,characterIndex:n}=this.helper.getSelectionFromPosition(this.projected.x,this.projected.y,this.doubleClickHandler.clickCount>2?"inside":"previous")??{index:0};i!==void 0&&n!==void 0&&((r=this.virtualInput)==null?void 0:r.wrappedText[i][n-1])===`
`&&t--,this.htmlInput.setSelectionRange(Math.min(e,t),Math.max(e,t))}checkClickedObject(){if(this.virtualInput){let e=this.raycaster.intersectObject(this.virtualInput,!1);if(e.length>0){let t=e[0];if(t.object instanceof X5)return t.object}}return null}selectClosestWord(e,t){if(!this.virtualInput)return;let i=this.virtualInput.wrappedText,n=i[e],r=t+1,s=t;n[t]!==" "&&(r=this.findNextCharOccurence(n,t,"forward"," "),s=this.findNextCharOccurence(n,t,"backward"," "),s>0&&s++,r>=n.length-1&&e===i.length-1&&r++);let a=this.helper,o=a.getGlobalIndexFromLineAndCharIndexes(i,e,s),l=a.getGlobalIndexFromLineAndCharIndexes(i,e,r);this.setInputSelection(o,l)}findNextCharOccurence(e,t,i,n=" "){let r=Math.max(0,e.length-1),s=i==="forward"?r:0,a=i==="forward"?1:-1,o=Math.max(Math.min(t,r),0);for(;o!==s;)if(o+=a,e.charAt(o)===n)return o;return s}getPointOnPlane(){var t;let e=(t=this.virtualInput)==null?void 0:t.data;if(!(!this.virtualInput||!e)&&this.raycaster.ray.intersectsPlane(this.plane)){this.planeIntersection===null&&(this.planeIntersection=new G);let i=this.raycaster.ray.intersectPlane(this.plane,this.planeIntersection);if(i){this.planeIntersection.copy(this.virtualInput.worldToLocal(i));let n=typeof e.geometry.width=="number"?e.geometry.width:1,r=typeof e.geometry.height=="number"?e.geometry.height:1;this.projected.set(i.x+n*.5,i.y-r*.5)}}}updatePlane(){var t;let e=(t=this.virtualInput)==null?void 0:t.data;this.virtualInput&&e&&(tq.getNormalMatrix(this.virtualInput.matrixWorld),$X.copy(J6e).applyMatrix3(tq).normalize(),this.virtualInput.localToWorld(eq.set(0,0,e.geometry.depth)),this.plane.setFromNormalAndCoplanarPoint($X,eq))}setInputSelection(e,t=e){var i;(i=this.htmlInput)==null||i.setSelectionRange(e,t),setTimeout(()=>{var n;(n=this.htmlInput)==null||n.focus()})}updateTextInputStyles(){var t;let e=(t=this.virtualInput)==null?void 0:t.data;this.virtualInput&&e&&this.htmlInput&&(this.htmlInput.style.fontSize=e.geometry.fontSize+"px",this.htmlInput.style.letterSpacing=e.geometry.letterSpacing*e.geometry.fontSize+"px",this.htmlInput.style.lineHeight=e.geometry.fontSize*e.geometry.lineHeight+"px",this.htmlInput.style.width=e.geometry.width+"px",this.htmlInput.style.height=e.geometry.height+"px",this.htmlInput.style.textAlign=$6e(e.geometry.horizontalAlign))}};function $6e(e){return e===4?"justify":e===2?"right":e===3?"center":"left"}var zie=(e,t)=>{if(typeof e=="string"){let i=t.data(e);if(i)return zie(i.value,t)}return Xa.getDisplayedValue(e)};function iq(e,t){let i=e.text,n="";if(typeof i=="string"){let r=t.variables.data(n);r&&(n=zie(r.value,t.variables))}else n=i.textValue.toString();return n}var e8e=class extends Ao{constructor(e,t){super(e),this.eventManager=t,this._textInputs=[],this.sceneHelpers=new Pl,this.helper=new wte,this._onMouseDownFocusIn=i=>{if(Si.length>1)return;this.eventContext.updateRaycaster(i);let n=null;if(this.eventContext.raycaster){for(let r of this._textInputs)if(this.eventContext.raycaster.intersectObject(r,!0).length>0){n=r;break}}this.focusOnTextInput(n),this._onCaretUpdate(),this._onMouseUp(),this.textInputManager.doubleClickHandler.start(this.eventContext.domElement),this.textInputManager.doubleClickHandler._onMouseDown(i),this._onMouseDown(i)},this.onExit=()=>{let{virtualInput:i}=this.textInputManager;if(i===null)return;let n=this.textInputManager.htmlInput;this.helper.hide(),n==null||n.setSelectionRange(n.value.length,n.value.length),this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!0);let{domElement:r}=this.eventContext;r.removeEventListener("pointerdown",this._onMouseDown,!1),r.removeEventListener("pointerup",this._onMouseUp,!1),r.removeEventListener("pointermove",this._onMouseMove,!1),window.removeEventListener("keydown",this._onKeyPress),this.textInputManager.doubleClickHandler.reset(),r.addEventListener("pointerdown",this._onMouseDownFocusIn),this.eventContext.renderer.sceneHelpersOnTop=void 0,this.eventContext.renderer.pipeline.disableHelpers()},this._onMouseDown=i=>{this.eventContext.updateRaycaster(i),this.textInputManager.handleMouseDown(),this.textInputManager.virtualInput&&this.eventContext.raycaster.intersectObject(this.textInputManager.virtualInput,!0).length>0&&this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!1)},this._onMouseUp=()=>{this.textInputManager.handleMouseUp(),this.eventManager.controlsManager.orbitControls&&!this.eventManager.controlsManager.orbitControls.enabled&&(this.eventManager.controlsManager.orbitControls.enabled=!0)},this._onMouseMove=i=>{this.eventContext.updateRaycaster(i),this.textInputManager.handleMouseMove()},this._onTextEdit=i=>{let{htmlInput:n,virtualInput:r,helper:s}=this.textInputManager;if(!n||!r)return;let a=n.value;r.textGeometry.setText(a).then(()=>{this.eventContext.requestRender()});let o=r.data;s.update();let l=o.geometry.text;if(typeof l=="string"){let c=l;this.eventContext.sharedAssets.updateVariable(c,{textValue:a})}this.textInputManager.updateTextInputStyles(),this._onCaretUpdate()},this._onCaretUpdate=i=>{this.textInputManager.handleCaretUpdate(i)},this._onKeyPress=i=>{i.key==="Escape"&&this.onExit()},this.textInputManager=new Z6e(this.sceneHelpers,e.raycaster,e.sharedAssets,e.requestRender,this.onExit)}connect(){let e=[];if(this.eventContext.scene.traverseEntity(n=>{n instanceof X5&&e.push(n)}),this._textInputs=e,e.length===0)return;let{domElement:t}=this.eventContext;t.addEventListener("pointerdown",this._onMouseDownFocusIn),this.textInputManager.connect();let i=this.textInputManager.createInput();document.body.appendChild(i),i.style.display="none",i.addEventListener("keyup",this._onCaretUpdate),i.addEventListener("keydown",this._onCaretUpdate),i.addEventListener("beforeinput",this._onCaretUpdate),i.addEventListener("paste",this._onCaretUpdate),i.addEventListener("cut",this._onCaretUpdate),i.addEventListener("select",this._onCaretUpdate),i.addEventListener("selectstart",this._onCaretUpdate)}disconnect(){let e=this.textInputManager.htmlInput,{domElement:t}=this.eventContext;t.removeEventListener("pointerdown",this._onMouseDownFocusIn),e==null||e.removeEventListener("keyup",this._onCaretUpdate),e==null||e.removeEventListener("keydown",this._onCaretUpdate),e==null||e.removeEventListener("beforeinput",this._onCaretUpdate),e==null||e.removeEventListener("paste",this._onCaretUpdate),e==null||e.removeEventListener("cut",this._onCaretUpdate),e==null||e.removeEventListener("select",this._onCaretUpdate),e==null||e.removeEventListener("selectstart",this._onCaretUpdate),this._textInputs.forEach(i=>{let n=iq(i.data.geometry,this.eventContext.sharedAssets.data);i.textGeometry.setText(n)}),t.removeEventListener("pointerdown",this._onMouseDown,!1),t.removeEventListener("pointerup",this._onMouseUp,!1),t.removeEventListener("pointermove",this._onMouseMove,!1),window.addEventListener("keydown",this._onKeyPress),this.eventContext.renderer.sceneHelpersOnTop=void 0,this.eventContext.renderer.pipeline.disableHelpers(),this.textInputManager.disconnect()}focusOnTextInput(e){this.textInputManager.focus(e),this.textInputManager.onTextMaterialChanged();let t=this.textInputManager.htmlInput;if(!t||e===null)return;this.textInputManager.updateTextInputStyles(),this.eventContext.renderer.sceneHelpersOnTop=this.sceneHelpers,this.eventContext.renderer.pipeline.enableHelpers(),this.textInputManager.isDragging=!1;let i=iq(e.textGeometry.userData.parameters,this.eventContext.sharedAssets.data);t.value=i,t.setSelectionRange(0,0),this.textInputManager.helper.show(e),t.style.display="block",t.addEventListener("input",this._onTextEdit),this.textInputManager.updatePlane();let{domElement:n}=this.eventContext;n.removeEventListener("pointerdown",this._onMouseDownFocusIn),n.addEventListener("pointerdown",this._onMouseDown,!1),n.addEventListener("pointerup",this._onMouseUp,!1),n.addEventListener("pointermove",this._onMouseMove,!1),window.addEventListener("keydown",this._onKeyPress)}},t8e=class extends Ao{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.onVoice=({value:i,frequencies:n})=>{this.events.forEach(r=>{r.dispatch()})}}connect(){this.openAIRealtime=this.eventContext.sharedAssets.openAIRealtime,this.openAIRealtime&&(this.eventContext.page.traverseEntity(e=>{var t;(t=e.data)==null||t.events.filter(i=>i.data.type==="AIAssistantListener"&&!i.data.disabled).forEach(i=>{this.events.push(new i8e(i.id,i.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),this.openAIRealtime.on("voice",this.onVoice))}disconnect(){var e;(e=this.openAIRealtime)==null||e.off("voice",this.onVoice)}},i8e=class{constructor(e,t,i,n,r,s){this.id=e,this.data=t,this.object=i,this.actions=Os(t,t.actions,n,r,s,i)}dispatch(){this.dispatchActions(this.actions)}dispatchActions(e){e.Audio.forEach(t=>t.dispatchConditional()),e.Particles.forEach(t=>t.dispatchConditional()),e.Video.forEach(t=>t.dispatchConditional()),e.Create.forEach(t=>t.dispatch()),e.Destroy.forEach(t=>t.dispatch()),e.Reset.forEach(t=>t.dispatch()),e.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()}),e.Transition.forEach(t=>t.play()),e.Animation.forEach(t=>t.play()),e.SwitchCamera.forEach(t=>t.play()),e.SceneTransition.forEach(t=>t.dispatch()),e.SetVariable.forEach(t=>t.checkConditions()),e.SetVariable.forEach(t=>t.dispatch()),e.DynamicVariablePlay.forEach(t=>t.dispatch()),e.ClearLocalStorage.forEach(t=>t.dispatch()),e.UserAPI.forEach(t=>t.dispatch())}},n8e=class extends Ao{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.onTriggerEvent=({description:i,direction:n})=>{let r=this.events.find(s=>s.data.description===i);r&&(n==="backward"?r.dispatchReverse():r.dispatch())}}connect(){this.openAIRealtime=this.eventContext.sharedAssets.openAIRealtime,this.openAIRealtime&&(this.eventContext.page.traverseEntity(e=>{var t;(t=e.data)==null||t.events.filter(i=>i.data.type==="AIAssistantTrigger"&&!i.data.disabled).forEach(i=>{this.events.push(new r8e(i.id,i.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),this.openAIRealtime.on("trigger_event",this.onTriggerEvent))}disconnect(){var e;(e=this.openAIRealtime)==null||e.off("trigger_event",this.onTriggerEvent)}},r8e=class{constructor(e,t,i,n,r,s){this.id=e,this.data=t,this.object=i,this.actions=Os(t,t.actions,n,r,s,i)}dispatch(){let e=this.actions;e.Audio.forEach(t=>t.dispatchConditional()),e.Particles.forEach(t=>t.dispatchConditional()),e.Video.forEach(t=>t.dispatchConditional()),e.Create.forEach(t=>t.dispatch()),e.Destroy.forEach(t=>t.dispatch()),e.Reset.forEach(t=>t.dispatch()),e.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()}),e.Transition.forEach(t=>t.play()),e.Animation.forEach(t=>t.play()),e.SwitchCamera.forEach(t=>t.play()),e.SceneTransition.forEach(t=>t.dispatch()),e.SetVariable.forEach(t=>t.checkConditions()),e.SetVariable.forEach(t=>t.dispatch()),e.DynamicVariablePlay.forEach(t=>t.dispatch()),e.ClearLocalStorage.forEach(t=>t.dispatch()),e.UserAPI.forEach(t=>t.dispatch())}dispatchReverse(){let e=this.actions;e.Transition.forEach(t=>t.reverseFromCurrent()),e.Particles.forEach(t=>t.reverseFromCurrent()),e.Animation.forEach(t=>t.reverseFromCurrent()),e.SwitchCamera.forEach(t=>t.reverseFromCurrent()),e.Create.forEach(t=>t.dispatchStop())}},s8e=class{constructor(e,t,i,n,r){this.publish=e,this.controlsManager=t,this.animationControls=i,this.eventContext=n,this.sharedVariables=r,this.isEnabled=!1,this.activateCount=0,this.needsMouse=!1,this.needsRaycast=!1,this.onTouchMovePreventScroll=s=>{let a=window.parent!==window,o=document.documentElement.scrollHeight>document.documentElement.clientHeight||document.documentElement.scrollWidth>document.documentElement.clientWidth;(s.touches.length>1||this.preventTouchScroll||a===!1&&o===!1)&&s.preventDefault()},this.onMouseWheelPreventScroll=s=>{this.preventScroll&&s.preventDefault()},this.onMouseMove=s=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(s),pressed:s.buttons>0}},this.onMouseDown=s=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(s),pressed:!0}},this.onMouseUp=s=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(s),pressed:!1}},this.getMousePosition=s=>{var c;let{domRect:a}=this.eventContext,{pageX:o,pageY:l}=((c=s.touches)==null?void 0:c.length)>0?s.touches[0]:s;return{x:o-(a.left+window.scrollX),y:l-(a.top+window.scrollY)}},this.stopRaycast=e.stopRaycast,this.preventScroll=e.preventScroll,this.preventTouchScroll=e.preventTouchScroll,this.hideCursor=e.hideCursor,this.requestRender=n.requestRender}activate(e=!1){var n;if(this.isEnabled)return;this.isEnabled=!0,this.initializeActionsDependentStates(),this.needsMouse&&(this.eventContext.domElement.addEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.addEventListener("pointerdown",this.onMouseDown)),this.handlers={Spline:new Oke(this.eventContext),VariableChange:new u6e(this.eventContext,this.sharedVariables,this,this.needsMouse,this.needsRaycast),API:new X6e(this.eventContext,this),WEBHOOK:new Y6e(this.eventContext,this),AIAssistantListener:new t8e(this.eventContext,this),AIAssistantTrigger:new n8e(this.eventContext,this),Conditional:new Fke(this.eventContext,this),Start:new l6e(this.eventContext,this),Basic:new Ike(this.eventContext,this,this.needsRaycast),MouseHover:new n6e(this.eventContext,this),Scroll:new a6e(this.eventContext,this),Follow:new Qke(this.eventContext,this),DragDrop:new jke(this.eventContext,this),LookAt:new e6e(this.eventContext),Resize:new W6e(this.eventContext,this),Textfields:new e8e(this.eventContext,this)};let{page:t,domElement:i}=this.eventContext;this.hideCursor&&(i.style.cursor="none"),t.traverseEntity(r=>{r.addEventListener("requestRender",this.requestRender)}),Object.values(this.handlers).forEach(r=>r.connect()),i.addEventListener("wheel",this.onMouseWheelPreventScroll),i.addEventListener("touchmove",this.onTouchMovePreventScroll),this.activateCount++,e||((n=this.eventContext.sharedAssets.openAIRealtime)==null||n.connect())}deactivate(e=!1){var n,r;if(!this.isEnabled)return;this.isEnabled=!1,this.eventContext.domElement.removeEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.removeEventListener("pointerdown",this.onMouseDown),this.eventContext.domElement.removeEventListener("pointerup",this.onMouseUp),this.eventContext.sharedAssets.mouseProperty=null,this.eventContext.sharedAssets.raycastProperty=null;let{page:t,domElement:i}=this.eventContext;i.style.cursor="",Object.values(this.handlers).forEach(s=>s.disconnect()),(n=this.controlsManager.gameControl)==null||n.disposeActions(),this.controlsManager.disconnectEvents(),t.traverseEntity(s=>{s.removeEventListener("requestRender",this.requestRender),s.destroyedInAction=!1}),i.removeEventListener("touchmove",this.onTouchMovePreventScroll),i.removeEventListener("wheel",this.onMouseWheelPreventScroll),this.animationControls.onExitPlayMode(),e||((r=this.eventContext.sharedAssets.openAIRealtime)==null||r.disconnect())}get isPaused(){return this.isEnabled}pause(){this.deactivate()}resume(){this.activate()}reset(){this.deactivate(!0),this.activate(!0),this.controlsManager.deactivate(),this.controlsManager.activate(this),this.controlsManager.page.updateMatrixWorld(!0),this.controlsManager.rebuildBVH()}updateUseWindowEvents(e){let t=this.isEnabled;t&&this.deactivate(),this.eventContext.useWindowEvents=e,t&&this.activate()}initializeActionsDependentStates(){let e=this.eventContext.sharedAssets;e.resetDynamicVariablePlayState();let t=i=>{if(i.data.type==="Conditional"&&(i.data.ifActions.forEach(t),i.data.elseActions.forEach(t)),i.data.type==="Conditional"||i.data.type==="SetVariable")for(let n of i.data.type==="Conditional"?i.data.condition:i.data.expression)"id"in n&&Array.isArray(n.id)&&(n.id[0]==="mouse"&&(this.needsMouse=!0),n.id[0]==="raycast"&&(this.needsRaycast=!0));i.data.type==="DynamicVariablePlay"&&i.data.variableId!==""&&(i.data.mode==="Play"||i.data.mode==="PlayPause"||i.data.mode==="Toggle")&&e.setDynamicVariablePlayState(i.data.variableId,"Stopped")};this.eventContext.page.traverseEntity(i=>{var n;if((n=i.data)!=null&&n.events.length)for(let r of i.data.events)if(r.data.type==="VariableChange"&&(r.data.variableId==="mouseProperty"&&(this.needsMouse=!0),r.data.variableId==="raycastProperty"&&(this.needsRaycast=!0)),r.data.type==="Conditional")for(let s of["inActions","outActions"])r.data[s].forEach(t);else if(r.data.type==="DragDrop")for(let s of["drag","drop"])r.data.dragDropActions[s].forEach(t);else if(r.data.type==="GameControl")for(let s of["idle","move","jump","run"])r.data.gameActions[s].forEach(t);else if(r.data.type==="Resize")for(let s of r.data.breakpoints)s.data.actions.forEach(t);else r.data.type==="LookAt"||r.data.type==="API"||r.data.actions.forEach(t)})}},a8e=class{constructor(e,t,i,n,r){this._aspect=1,this.enableResponsive=!1,this._renderer=e,this._camera=t,this._frameSize=new Ae().copy(i),this._editorSize=new Ae().copy(n),this._aspect=t.aspect,this._fov=r??t.fov}set frameSize(e){this._frameSize.copy(e)}updateRenderer(){!this._renderer||this._renderer.setSize(this._frameSize.x,this._frameSize.y)}updateViewport(){if(!this._renderer||!this._camera||this._camera.cameraType!=="PerspectiveCamera")return;let e=this._frameSize.x,t=this._frameSize.y,i=this._editorSize.y;this._aspect=e/t,t<=i&&(this._camera.zoom*=i/t),this._renderer.setViewport(0,0,e,t)}updateCamera(e=!0){if(this._camera)if(this._camera.cameraType==="PerspectiveCamera"){let t=this._frameSize.y,i=this._editorSize.y,n=this._fov;if(e&&t>i){let r=o8e(t,1080,2160,1,15)/100;n*=t/i,n*=1-r}this._camera.aspect=this._aspect,this._camera.fov=n,this._camera.updateProjectionMatrix()}else this._camera.setViewplaneSize(this._frameSize.x,this._frameSize.y,this.enableResponsive)}setCamera(e){this._camera=e,this._aspect=e.aspect,this._fov=e.fov}revert(){let e=window.innerWidth,t=window.innerHeight;this._renderer&&(this._renderer.setViewport(0,0,e,t),this._renderer.setSize(e,t)),this._camera&&(this._camera.aspect=e/t,this._camera.fov=this._fov,this._camera.setViewplaneSize(e,t,this.enableResponsive),this._camera.updateProjectionMatrix())}};function o8e(e,t,i,n,r){return(e-t)/(i-t)*(r-n)+n}var l8e=class{get sharedAssets(){return this.shared}constructor(e,t={},i=!0){this.shared=new L5(e.shared,t,!0,i),this.scene=new Q5(e.scene,this.sharedAssets),this.shared.setEntityOpContext({scene:this.scene,shared:this.shared})}reset(e,t){this.scene.clearScene(),this.sharedAssets.reset(e.shared),this.scene.resetAfterClear(e.scene,this.sharedAssets)}resetPersonalCameraFromDocumentData(){for(let e of this.scene.children)e instanceof fa&&!e.uiScene&&e.personalCamera.updateState(e.data.camera,{scene:this.scene,shared:this.shared})}dispose(){this.scene.dispose(),this.shared.dispose()}gc(){this.shared.geometryCache.startGc(),this.shared.geometryCache2.startGc(),this.scene.traverseEntity(e=>{e instanceof Ds&&e.markGeometryAsReachable(this.shared)}),this.shared.geometryCache.endGc(),this.shared.geometryCache2.endGc()}},c8e=class{constructor({x:e=10,y:t=10}){this._startTime=0;let i=document.getElementById("spe-perfs");i?this.element=i:(this.element=document.createElement("div"),document.body.appendChild(this.element),this.element.style.position="absolute",this.element.style.zIndex="10000",this.element.style.fontFamily="monospace",this.element.style.background="black",this.element.style.color="white",this.element.style.padding="10px",this.element.style.opacity="0.5",this.element.style.fontSize="11px",this.element.setAttribute("id","spe-perfs")),this.element.style.left=`${e}px`,this.element.style.top=`${t}px`}dispose(){var e;(e=this.element.parentElement)==null||e.removeChild(this.element)}start(){this._startTime=performance.now()}end(){let e=performance.now()-this._startTime;this.element.innerHTML=e.toFixed(3)+" ms"}};function u8e(e){let t;if(e.index)for(let i=0;i<e.index.array.length;i+=3)t=e.index.array[i],e.index.array[i]=e.index.array[i+2],e.index.array[i+2]=t}function XA(e){return e instanceof Iw?"SubdivObject":e.geometry.type==="NonParametricGeometry"?"NonParametric":"Mesh"}function h8e(e,t){let i={};return e.traverseEntity(n=>{var l;if(!n.visible||!(n instanceof nl)||n.type!=="Mesh"||Array.isArray(n.material)||n.states&&Object.keys(n.states).length)return;let r=n.parent;for(;r;){if(r instanceof nl&&n.states&&Object.keys(n.states).length)return;r=r.parent}let s=n.material.uuid,a=t.shared.materials[s];if(a){if(!ga.isMergable(a))return}else{let c=(l=t.scene.objects.get(n.uuid))==null?void 0:l.data;if(c&&"material"in c&&typeof c.material!="string"){if(!ga.isMergable(c.material))return;s=ga.getHash(c.material)}}i[s]||(i[s]={});let o=i[s][XA(n)];if(o){if(o.push(n),n.cloner)for(let c of n.cloner.children)o.push(c)}else if(i[s][XA(n)]=[n],n.cloner)for(let c of n.cloner.children)i[s][XA(n)].push(c)}),i}function d8e(e){let t=0;return Object.values(e).forEach(i=>{Object.values(i).forEach(n=>{let r=n.length;r>t&&(t=r)})}),t}function f8e(e,t){let i=h8e(t,e),n=d8e(i),r=new Array(n),s=0,a=new Array(n),o=0,l=new Array(n),c=0,u=new Array(n),h=0;for(let[d,p]of Object.entries(i))for(let g of Object.values(p)){if(o=0,c=0,g.forEach(y=>{y instanceof nl&&(a[o++]=y.geometry.clone(),l[c++]=y)}),c<2)continue;for(let y=0;y<c;y++)l[y].updateWorldMatrix(!0,!1),a[y].applyMatrix4(l[y].matrixWorld),l[y].matrixWorld.determinant()<0&&u8e(a[y]);let x=u0(a.slice(0,o),!1);if(x){let y;switch(d){case"SubdivObject":{console.warn("Turning subdiv object into mesh"),y=new fr(x,l[0].material);break}default:{y=new fr(x,l[0].material);break}}y.castShadow=l[0].castShadow,y.receiveShadow=l[0].receiveShadow,t.add(y);let b=A=>{h=0;for(let w of A)w.children&&b(w.children),w instanceof nl&&(Array.isArray(w.material)||i[w.material.uuid]&&i[w.material.uuid][XA(w)]&&i[w.material.uuid][XA(w)].length>1||(u[h++]=w));for(let w=0;w<h;w++)t.attach(u[w])};for(let A=0;A<c;A++){let w=l[A];b(w.children),r[s++]=w}}}for(let d=0;d<s;d++)r[d].removeFromParent()}var p8e=pg(d1e(),1),m8e=new Ae;function g8e(e){let t="The Spline Runtime only accepts .splinecode files that are generated from Spline export panel.";e.endsWith(".spline")?console.warn(t+" The .spline files are only meant to be used by the Editor."):e.endsWith(".splinecode")||console.warn(t)}var v8e=class{constructor(e,{renderOnDemand:t,renderMode:i="auto"}={}){this._viewportMode=1,this._viewportWidth=window.innerWidth,this._viewportHeight=window.innerHeight,this._proxyObjectCache=new Map,this._variablesCache=new Map,this._isPaused=!1,this._renderRequested=!1,this._skipRender=!1,this.time=performance.now(),this.dt=0,this.currentTAAFrame=0,this.disposed=!1,this._requestRenderAutoMode=()=>{this._skipRender=!1},this.requestRender=()=>{this._renderRequested=!0},this.render=n=>{var r,s,a,o,l,c,u,h,d,p,g,x,y;if(this.time=n,this._lastTime&&(this.dt=this.time-this._lastTime),this._lastTime=this.time,(r=this._perfs)==null||r.start(),!this._renderer){(s=this._perfs)==null||s.end();return}if(!this._isPaused&&(this.renderMode==="manual"&&!this._renderRequested||this.renderMode==="auto"&&this._skipRender)){(a=this._perfs)==null||a.end();return}if(this._renderRequested=!1,this._skipRender=!0,this._controls&&(this._skipRender=this._controls.update(this.dt)),this._eventManager&&((o=this._eventManager.handlers)!=null&&o.Start.hasVideoAction||(l=this._eventManager.handlers)!=null&&l.Basic.hasVideoAction||(c=this._eventManager.handlers)!=null&&c.Conditional.hasVideoAction)&&(this._skipRender=!1),(u=this._animationControls)==null||u.update(this.dt),this._skipRender?(this.currentTAAFrame++,this.currentTAAFrame<32?this._skipRender=!1:this.currentTAAFrame=0):this.currentTAAFrame=0,(h=this._scene)==null||h.traverseVisibleEntity(b=>{b.type==="ParticleSystem"&&(b.update(this.dt),this._skipRender=!1)}),this._scene&&this._scene.activeCamera!==this._camera&&(this._camera=this._scene.activeCamera),(d=this._eventManager)!=null&&d.isEnabled&&(((p=this._eventManager.handlers)==null?void 0:p.Follow).onAnimationFrameDamping(),((g=this._eventManager.handlers)==null?void 0:g.LookAt).onAnimationFrameDamping(),((x=this._eventManager.handlers)==null?void 0:x.DragDrop).onAnimationFrameDamping()),this._scene&&this._camera){if(this._scene.pathConstraints.applyConstraints(this._scene),this._renderer.sceneTransitionTimeRemaining>0){this._renderer.sceneTransitionTimeRemaining-=this.dt;let b=1-this._renderer.sceneTransitionTimeRemaining/this._renderer.sceneTransitionDuration;this._renderer.pipeline.sceneTransitionPass.uniforms.mixRatio.value=b,this._skipRender=!1}else this._renderer.pipeline.sceneTransitionFromTexture=null;this._renderer.renderSplineScene(this._scene,this._camera)}this.canvas.dispatchEvent(this._renderedEvent),(y=this._perfs)==null||y.end()},this._resize=n=>{var r,s,a,o,l,c,u,h,d,p;if(this._renderer){if(this._viewportMode===1&&this._frameView&&(this._frameView.frameSize=m8e.set(this._viewportWidth,this._viewportHeight)),n){let g=this._viewportWidth,x=this._viewportHeight;this._renderer.setSize(g-1,x-1,!1),this._renderer.setSize(g,x,!1)}else this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1);if(this._camera=(r=this._scene)==null?void 0:r.activeCamera,(u=this._scene)==null||u.updateViewPlaneSize(((a=(s=this._frameView)==null?void 0:s.frameSize)==null?void 0:a.x)??this._viewportWidth,((l=(o=this._frameView)==null?void 0:o.frameSize)==null?void 0:l.y)??this._viewportHeight,((c=this._frameView)==null?void 0:c.enableResponsive)??!1),this._camera){let g=Object.values(((h=this._data)==null?void 0:h.frames)??{})[0].preset??"fullscreen";(d=this._frameView)==null||d.setCamera(this._camera),(p=this._frameView)==null||p.updateCamera(g!=="fullscreen"),this._camera.cameraType==="PerspectiveCamera"&&(this._camera.aspect=this._viewportWidth/this._viewportHeight),this._camera.updateProjectionMatrix()}this.eventManager&&(this.eventManager.eventContext.domRect=this.canvas.getBoundingClientRect()),this._requestRenderAutoMode()}},this._debouncedResize=_w(this._resize,10),this._onScroll=n=>{this.eventManager&&(this.eventManager.eventContext.domRect=this.canvas.getBoundingClientRect())},this.canvas=e,this.renderMode=t?"auto":i,this._renderedEvent=new CustomEvent("rendered",{bubbles:!0}),Object.defineProperty(this._renderedEvent,"target",{writable:!1,value:this}),window.location.search.includes("perfs")&&(this._perfs=new c8e({x:10,y:10})),hBe(e)}async load(e,t,i){g8e(e),this.disposed=!1;let n=await(await fetch(e,i)).arrayBuffer();await this.start(n,{variables:t})}async start(e,{interactive:t=!0,variables:i}={}){var l,c,u,h;if(this.disposed)return;let n=await V6e(e);this._data=n;let r=H6e(n);n.version&&(0,p8e.default)(n.version,"1.10.2")>0&&console.warn("Your .splinecode file is more recent than the library. Please upgrade @splinetool/runtime to the latest version."),await Promise.all([r.length&&z6e(),E7(n)&&mNe(),bFe(n)&&hNe(),Tw.physicsEnabled(n.scene.objects)&&gBe(),S7(n)&&Kze(),iX(n)&&PHe(),Yze(n)&&qze(),q7(n)&&vVe(),_6e(n)&&pBe()].filter(Boolean)),r.length&&await G6e(r),(l=this._eventManager)==null||l.deactivate(),(c=this._controls)==null||c.deactivate(),(u=this._scene)==null||u.dispose();let s=new l8e(n);if(s.resetPersonalCameraFromDocumentData(),this._scene=s.scene,this._sharedAssetsManager=s.sharedAssets,this._camera=this._scene.activeCamera,window.location.search.includes("merge-geometries")){let d=performance.now();f8e(n,s.scene);let p=performance.now();console.log("Merged geometries in ",p-d," ms")}E7(n)&&this._scene.traverse(d=>{kf(d)&&d.recomputeBoolean()}),this._sharedAssetsManager.setRequestRender(()=>{var d;this._requestRenderAutoMode(),(d=this._scene)==null||d.traverse(p=>{p instanceof Wc&&p.pendingMediaLoad&&p.update()})}),(h=this._scene)==null||h.traverse(d=>{d.type==="ParticleSystem"&&(d.wakeUp(),d.data.autoPlay?d.start():d.stop())});let a=Object.keys(n.shared.fonts).map(d=>this._sharedAssetsManager.getFont(d).loadingPromise);if(Promise.all(a).then(()=>{s.scene.markNeedsUpdateRendererDirty(),this._requestRenderAutoMode()}),S7(n)&&O6e(n)&&await Promise.all(a),q7(n)){let d=[];this._scene.traverseEntity(p=>{(p instanceof mo||p instanceof fa)&&p.uiCanvas&&d.push(p.uiCanvas)}),await Promise.all(d.map(p=>p.promise))}if(this._scene.rewriteEventsBeforeGoToPlayMode(),lV(this._scene.activePage,this._sharedAssetsManager),!this._renderer&&(this._renderer=new nVe({canvas:this.canvas,antialias:!1,alpha:!0,stencil:!1,depth:!1,powerPreference:"high-performance"}),this._renderer.hdTransmission=n.scene.publish.hdTransmission===!0,this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.pipeline.enableUIOverlay(),this._renderer.pipeline.addEventListener("smaaloaded",this._requestRenderAutoMode),n.shared.images.SplineWatermark)){let d=this._sharedAssetsManager.getImage("SplineWatermark");await d.loadPromise;let p=d.getTexture(1001);this._renderer.pipeline.setWatermark(p)}iX(n)&&this._scene.initializeSplatViewer(),n.scene.blueNoiseTextureData!==void 0&&this._renderer.pipeline.updateBlueNoiseTexture(n.scene.blueNoiseTextureData);let o=Object.values(n.frames)[0];if(this._frameView?this._frameView.setCamera(this._camera):(o.preset==="fullscreen"?(this._viewportMode=1,this.canvas.style.display="block",this.canvas.parentElement&&(this._viewportWidth=this.canvas.parentElement.clientWidth||300,this.canvas.style.width="100%"),this.canvas.parentElement&&(this._viewportHeight=this.canvas.parentElement.clientHeight||150,this.canvas.style.height="100%")):(this._viewportMode=2,this._viewportWidth=o.size[0],this._viewportHeight=o.size[1],this.canvas.style.width=`${this._viewportWidth}px`,this.canvas.style.height=`${this._viewportHeight}px`),this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1),this._frameView=new a8e(this._renderer,this._camera,new Ae(this._viewportWidth,this._viewportHeight),new Ae(window.innerWidth,window.innerHeight)),this._frameView.enableResponsive=(o.allowResponsive??!1)&&o.preset==="fullscreen"),t){let d=new Rke(this._renderer,this.data.scene.publish,this._scene,()=>this._scene.activeCamera,this._sharedAssetsManager,this._requestRenderAutoMode,!0,o);this._scene.updateMatrixWorld(!0),this._controls=new B6e(d),this._animationControls=new L6e(this._scene,this._requestRenderAutoMode),this._eventManager=new s8e(n.scene.publish,this._controls,this._animationControls,d,n.shared.variables),this._eventManager.activate(),this._controls.activate(this._eventManager)}this._resize(),this._scene.activePage.data.postprocessing.depthOfField.enabled&&Promise.all(this._sharedAssetsManager.getImageLoadPromises()).then(()=>{this._resize(!0)}),i!==void 0&&this.setVariables(i),this.dt===0&&(this.render(performance.now()),setTimeout(()=>{var d;(d=this._renderer)==null||d.setAnimationLoop(this.render)},0)),this._resizeObserverTimeout=setTimeout(()=>{!this._resizeObserver&&this.canvas.parentElement&&(this._resizeObserver=new ResizeObserver(()=>{this._viewportWidth=this.canvas.clientWidth,this._viewportHeight=this.canvas.clientHeight,this._debouncedResize()}),this._resizeObserver.observe(this.canvas.parentElement))},300),document.addEventListener("scroll",this._onScroll)}setVariables(e){if(this._data!==void 0){let t=Object.entries(e);for(let[i,n]of t)this.setVariable(i,n)}}setVariable(e,t){var n;let i=this._getVariableByName(e);if(i&&!("dynamicVariableType"in i.data)){let r=t;typeof i.data.value=="number"?r=typeof t=="number"?t:typeof t=="boolean"?t===!0?1:0:parseFloat(t):typeof i.data.value=="boolean"?r=typeof t=="number"?!!t:typeof t=="boolean"?t:t.toLocaleLowerCase()==="false"?!1:!!t:typeof i.data.value!="string"&&i.data.value.textValue!==void 0&&(r=t.toString());let s=typeof r=="string"?{textValue:r}:r;(n=this._sharedAssetsManager)==null||n.updateVariable(i.id,s),this.requestRender(),this._requestRenderAutoMode()}else i===void 0?console.warn(`No variable named ${e} was found in your Spline file. Make sure to create it from Spline editor.`):"dynamicVariableType"in i.data&&console.warn(`Dynamic variables like ${e} cannot be updated from code.`)}getVariables(){let e={};return this._data&&this._data.shared.variables.forEach(t=>{e[t.data.name]===void 0&&(e[t.data.name]=this._getVariableValue(this._sharedAssetsManager.getVariable(t.id)))}),e}getVariable(e){let t=this._getVariableByName(e);if(t){let i=this._sharedAssetsManager.getVariable(t.id);return this._getVariableValue(i)}}_getVariableValue(e){return typeof e!="string"&&Xa.isTextValue(e)?Xa.getDisplayedValue(e):e}_getVariableByName(e){if(this._data){if(this._variablesCache.has(e))return this._variablesCache.get(e);let t=this._data.shared.variables.find(i=>i.data.name===e);return t&&this._variablesCache.set(e,t),t}}findObjectById(e){var i;let t=(i=this._scene)==null?void 0:i.getObjectByProperty("uuid",e);return this._createProxyObject(t)}findObjectByName(e){var i;let t=(i=this._scene)==null?void 0:i.getObjectByName(e);return this._createProxyObject(t)}getAllObjects(){var t;let e=[];return(t=this._scene)==null||t.traverseEntity(i=>{if(i.uuid!==Fb&&!this._scene.isInvisibleObjects(i)&&!(i instanceof fa)){let n=this._createProxyObject(i);n&&e.push(n)}}),e}getSplineEvents(){var e,t;return((t=(e=this._eventManager)==null?void 0:e.handlers)==null?void 0:t.Spline).splineEvents}emitEvent(e,t){var i;(i=this.findObjectById(t)||this.findObjectByName(t))==null||i.emitEvent(e)}emitEventReverse(e,t){var i;(i=this.findObjectById(t)||this.findObjectByName(t))==null||i.emitEventReverse(e)}addEventListener(e,t){this.canvas.addEventListener(e,t)}removeEventListener(e,t){this.canvas.removeEventListener(e,t)}setZoom(e){var t,i;((t=this._controls)==null?void 0:t.orbitControls)instanceof Nie&&((i=this._controls)==null||i.orbitControls.setZoom(e))}get eventManager(){return this._eventManager}get controls(){return this._controls}setSize(e,t){this._viewportWidth=e,this._viewportHeight=t,this._viewportMode=2,this._resize()}setBackgroundColor(e){var a;let{r:t,g:i,b:n,a:r}={r:0,g:0,b:0,a:1},s=new Qa(t,i,n,r);try{s.setStyle(e)}catch{console.error("This is not a valid css color",e)}(a=this._scene)==null||a.activePage.setBackgroundColor(s),this._requestRenderAutoMode()}dispose(){var e,t,i,n,r,s,a;this.disposed=!0,(e=this._eventManager)==null||e.deactivate(),(t=this._scene)==null||t.dispose(),(i=this._sharedAssetsManager)==null||i.dispose(),this._proxyObjectCache.forEach(o=>{Cj.unsubscribe(o)}),this._variablesCache.clear(),(n=this._renderer)==null||n.setAnimationLoop(null),(r=this._renderer)==null||r.dispose(),this._renderer=void 0,(s=this._sharedAssetsManager)==null||s.dispose(),this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=void 0),this._resizeObserverTimeout!==void 0&&clearTimeout(this._resizeObserverTimeout),this.canvas.style.width="",this.canvas.style.height="",this.canvas.removeAttribute("width"),this.canvas.removeAttribute("height"),this._frameView&&(this._frameView=void 0),(a=this._controls)==null||a.deactivate(),this.dt=0,dBe(this.canvas),document.removeEventListener("scroll",this._onScroll)}get isStopped(){return this._isPaused}stop(){var e,t,i;this._isPaused||((e=this._renderer)==null||e.setAnimationLoop(null),this._isPaused=!0,(t=this._eventManager)==null||t.pause(),(i=this._controls)!=null&&i.orbitControls&&(this._controls.orbitControls.enabled=!1))}play(){var e,t,i;!this._isPaused||(this._isPaused=!1,(e=this._eventManager)==null||e.resume(),(t=this._controls)!=null&&t.orbitControls&&(this._controls.orbitControls.enabled=!0),(i=this._renderer)==null||i.setAnimationLoop(this.render))}setGlobalEvents(e){var t;(t=this._eventManager)==null||t.updateUseWindowEvents(e)}get data(){return this._data}_createProxyObject(e){var r;if(e==null)return;if(this._proxyObjectCache.has(e.uuid))return this._proxyObjectCache.get(e.uuid);let t;e.traverseAncestors(s=>{s instanceof fa&&(t=s.name)});let i={name:e.name,uuid:e.uuid,visible:e.visible,intensity:e.intensity,position:e.position,rotation:e.rotation,scale:e.scale,type:e.data.type,page:t,parentUuid:e.parent instanceof fa||e instanceof Q5||(r=e.parent)==null?void 0:r.uuid,emitEvent(s){e.dispatchEvent({type:"userEvent",eventName:s})},emitEventReverse(s){e.dispatchEvent({type:"userEvent",eventName:s,reverse:!0})}},n=Cj(i,(s,a)=>{var o;typeof e[s]!="object"&&((o=Object.getOwnPropertyDescriptor(e,s))!=null&&o.writable)&&(e[s]=a),this._requestRenderAutoMode(),e.updateMatrix()});return this._proxyObjectCache.set(e.uuid,n),n}setUIWasmUrl(e){nte.skiaWasmUrl=e}},FL,nq;function y8e(){if(nq)return FL;nq=1;var e="Expected a function",t=NaN,i="[object Symbol]",n=/^\s+|\s+$/g,r=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,a=/^0o[0-7]+$/i,o=parseInt,l=typeof KE=="object"&&KE&&KE.Object===Object&&KE,c=typeof self=="object"&&self&&self.Object===Object&&self,u=l||c||Function("return this")(),h=Object.prototype,d=h.toString,p=Math.max,g=Math.min,x=function(){return u.Date.now()};function y(D,T,I){var R,O,P,U,H,V,j=0,J=!1,F=!1,X=!0;if(typeof D!="function")throw new TypeError(e);T=E(T)||0,b(I)&&(J=!!I.leading,F="maxWait"in I,P=F?p(E(I.maxWait)||0,T):P,X="trailing"in I?!!I.trailing:X);function W(_e){var be=R,we=O;return R=O=void 0,j=_e,U=D.apply(we,be),U}function ne(_e){return j=_e,H=setTimeout(se,T),J?W(_e):U}function Y(_e){var be=_e-V,we=_e-j,Me=T-be;return F?g(Me,P-we):Me}function $(_e){var be=_e-V,we=_e-j;return V===void 0||be>=T||be<0||F&&we>=P}function se(){var _e=x();if($(_e))return fe(_e);H=setTimeout(se,Y(_e))}function fe(_e){return H=void 0,X&&R?W(_e):(R=O=void 0,U)}function te(){H!==void 0&&clearTimeout(H),j=0,R=V=O=H=void 0}function de(){return H===void 0?U:fe(x())}function le(){var _e=x(),be=$(_e);if(R=arguments,O=this,V=_e,be){if(H===void 0)return ne(V);if(F)return H=setTimeout(se,T),W(V)}return H===void 0&&(H=setTimeout(se,T)),U}return le.cancel=te,le.flush=de,le}function b(D){var T=typeof D;return!!D&&(T=="object"||T=="function")}function A(D){return!!D&&typeof D=="object"}function w(D){return typeof D=="symbol"||A(D)&&d.call(D)==i}function E(D){if(typeof D=="number")return D;if(w(D))return t;if(b(D)){var T=typeof D.valueOf=="function"?D.valueOf():D;D=b(T)?T+"":T}if(typeof D!="string")return D===0?D:+D;D=D.replace(n,"");var I=s.test(D);return I||a.test(D)?o(D.slice(2),I?2:8):r.test(D)?t:+D}return FL=y,FL}var x8e=y8e();const b8e=Uw(x8e);function S8e(e){return t=>{e.forEach(i=>{typeof i=="function"?i(t):i!=null&&(i.current=t)})}}const _8e=[],A8e={width:"100%",height:"100%"},w8e=ge.forwardRef(function({className:e,children:t,debounceTime:i=300,ignoreDimensions:n=_8e,parentSizeStyles:r,enableDebounceLeadingCall:s=!0,resizeObserverPolyfill:a,...o},l){const c=ge.useRef(null),u=ge.useRef(0),[h,d]=ge.useState({width:0,height:0,top:0,left:0}),p=ge.useMemo(()=>{const g=Array.isArray(n)?n:[n];return b8e(x=>{d(y=>Object.keys(y).filter(b=>y[b]!==x[b]).every(b=>g.includes(b))?y:x)},i,{leading:s})},[i,s,n]);return ge.useEffect(()=>{const g=a||window.ResizeObserver,x=new g(y=>{y.forEach(b=>{const{left:A,top:w,width:E,height:D}=(b==null?void 0:b.contentRect)??{};u.current=window.requestAnimationFrame(()=>{p({width:E,height:D,top:w,left:A})})})});return c.current&&x.observe(c.current),()=>{window.cancelAnimationFrame(u.current),x.disconnect(),p.cancel()}},[p,a]),ke.jsx("div",{style:{...A8e,...r},ref:S8e([l,c]),className:e,...o,children:t({...h,ref:c.current,resize:p})})}),M8e=ge.forwardRef(({scene:e,style:t,onSplineMouseDown:i,onSplineMouseUp:n,onSplineMouseHover:r,onSplineKeyDown:s,onSplineKeyUp:a,onSplineStart:o,onSplineLookAt:l,onSplineFollow:c,onSplineScroll:u,onLoad:h,renderOnDemand:d=!0,children:p,...g},x)=>{const y=ge.useRef(null),[b,A]=ge.useState(!0),[w,E]=ge.useState();if(w)throw w;return ge.useEffect(()=>{A(!0);let D;const T=[{name:"mouseDown",cb:i},{name:"mouseUp",cb:n},{name:"mouseHover",cb:r},{name:"keyDown",cb:s},{name:"keyUp",cb:a},{name:"start",cb:o},{name:"lookAt",cb:l},{name:"follow",cb:c},{name:"scroll",cb:u}];if(y.current){D=new v8e(y.current,{renderOnDemand:d});async function I(){await D.load(e);for(let R of T)R.cb&&D.addEventListener(R.name,R.cb);A(!1),h==null||h(D)}I().catch(R=>{E(R)})}return()=>{for(let I of T)I.cb&&D.removeEventListener(I.name,I.cb);D.dispose()}},[e]),ke.jsx(w8e,{ref:x,parentSizeStyles:{overflow:"hidden",...t},debounceTime:50,...g,children:()=>ke.jsxs(ke.Fragment,{children:[b&&p,ke.jsx("canvas",{ref:y,style:{display:b?"none":"block"}})]})})}),E8e=()=>ke.jsxs("section",{className:"relative w-full h-screen mx-auto",children:[ke.jsxs("div",{className:`absolute inset-0 top-[120px]  max-w-7xl mx-auto ${ja.paddingX} flex flex-row items-start gap-5`,children:[ke.jsxs("div",{className:"flex flex-col justify-center items-center mt-5",children:[ke.jsx("div",{className:"w-5 h-5 rounded-full bg-[#F44336]"}),ke.jsx("div",{className:"w-1 sm:h-80 h-40 red-gradient"})]}),ke.jsxs("div",{children:[ke.jsxs("h1",{className:`${ja.heroHeadText} text-white`,children:["Hi, I'm ",ke.jsx("span",{className:"text-[#F44336]",children:"Josue"})]}),ke.jsxs("p",{className:`${ja.heroSubText} mt-2`,style:{WebkitTextStroke:"1px #000",color:"#fff"},children:["I engineer, analyze, clean, and visualize data ",ke.jsx("br",{className:"sm:block hidden"}),"to power business solutions."]})]})]}),ke.jsx(M8e,{scene:"https://prod.spline.design/ILC60nJiv3MVNbzE/scene.splinecode"})]}),T8e="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20version='1.1'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20xmlns:svgjs='http://svgjs.dev/svgjs'%20width='1000'%20height='750'%20viewBox='0%200%201000%20750'%3e%3crect%20width='1000'%20height='750'%20fill='%23000000'%3e%3c/rect%3e%3cg%20transform='matrix(0.6058091286307054,0,0,0.6058091286307054,197.4340805304803,83.23644910646982)'%3e%3csvg%20viewBox='0%200%20256%20247'%20data-background-color='%23ca3433'%20preserveAspectRatio='xMidYMid%20meet'%20height='964'%20width='1000'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cg%20id='tight-bounds'%20transform='matrix(1,0,0,1,-0.14310296170211245,-0.09999498407873375)'%3e%3csvg%20viewBox='0%200%20256.2862059234042%20247.2'%20height='247.2'%20width='256.2862059234042'%3e%3cg%3e%3csvg%20viewBox='0%200%20256.2862059234043%20247.20000000000002'%20height='247.2'%20width='256.2862059234042'%3e%3cg%3e%3csvg%20viewBox='0%200%20122.32893617021276%20247.20000000000002'%20height='247.20000000000002'%20width='122.32893617021276'%3e%3cg%3e%3csvg%20viewBox='0%200%20122.32893617021276%20247.20000000000002'%20height='247.20000000000002'%20width='122.32893617021276'%3e%3cg%3e%3csvg%20viewBox='0%200%20122.32893617021276%20247.20000000000002'%20height='247.20000000000002'%20width='122.32893617021276'%3e%3cg%20transform='matrix(1,0,0,1,0,0)'%3e%3csvg%20width='122.32893617021276'%20viewBox='1.4934210777282715%20-37.099998474121094%2018.606578826904297%2037.599998474121094'%20height='247.20000000000002'%20data-palette-color='%23ffffff'%3e%3cpath%20d='M20.1-10.15L20.1-10.15Q20.1-4.35%2017.3-1.93%2014.5%200.5%208.95%200.5L8.95%200.5Q7.3%200.5%205.83%200.3%204.35%200.1%202.85-0.2L2.85-0.2Q2.1-0.35%201.78-0.78%201.45-1.2%201.5-2.1L1.5-2.1%201.95-7.25Q2.05-8.4%203.05-8.25L3.05-8.25Q3.65-8.15%204.38-7.98%205.1-7.8%206.05-7.8L6.05-7.8Q7.95-7.8%208.97-8.88%2010-9.95%2010-12.6L10-12.6%2010-36.05Q10-37.1%2010.9-37.1L10.9-37.1%2019.25-37.1Q20.1-37.1%2020.1-36.15L20.1-36.15%2020.1-10.15Z'%20opacity='1'%20transform='matrix(1,0,0,1,0,0)'%20fill='%23ffffff'%20class='undefined-text-0'%20data-fill-palette-color='primary'%20id='text-0'%3e%3c/path%3e%3c/svg%3e%3c/g%3e%3c/svg%3e%3c/g%3e%3c/svg%3e%3c/g%3e%3c/svg%3e%3c/g%3e%3cg%20transform='matrix(1,0,0,1,180.68692337021275,80.40040996960488)'%3e%3csvg%20viewBox='0%200%2075.59928255319149%2086.39918006079027'%20height='86.39918006079027'%20width='75.59928255319149'%3e%3cg%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20version='1.1'%20x='0'%20y='0'%20viewBox='0%200%2028%2032'%20style='enable-background:new%200%200%2028%2032;'%20xml:space='preserve'%20height='86.39918006079027'%20width='75.59928255319149'%20class='icon-icon-0'%20data-fill-palette-color='accent'%20id='icon-0'%3e%3cg%20fill='%23ffffff'%20data-fill-palette-color='accent'%3e%3cg%20fill='%23ffffff'%20data-fill-palette-color='accent'%3e%3cg%20fill='%23ffffff'%20data-fill-palette-color='accent'%3e%3cpolygon%20points='9.815,21.969%2011.702,21.969%2010.798,19.994%20'%20fill='%23ffffff'%20data-fill-palette-color='accent'%3e%3c/polygon%3e%3cpath%20d='M23%2015H1c-0.55%200-1%200.45-1%201v10c0%200.55%200.45%201%201%201h22c0.551%200%201-0.45%201-1V16C24%2015.45%2023.551%2015%2023%2015zM12.622%2023.729l-0.353-0.704h-2.95l-0.344%200.704C8.847%2024%208.551%2024.057%208.264%2024c-0.256-0.145-0.416-0.432-0.256-0.768l2.294-4.485c0.216-0.424%200.792-0.44%200.992%200l2.254%204.485C13.876%2023.855%2012.909%2024.352%2012.622%2023.729zM15.559%2023.512c0%200.664-1.055%200.68-1.055%200v-4.564c0-0.656%201.055-0.68%201.055%200V23.512z'%20fill='%23ffffff'%20data-fill-palette-color='accent'%3e%3c/path%3e%3c/g%3e%3cpath%20d='M27%207.586L20.414%201C19.836%200.42%2018.82%200%2018%200H7C5.346%200%204%201.346%204%203v10c0%200.553%200.447%201%201%201s1-0.447%201-1V3c0-0.551%200.448-1%201-1h9c1.105%200%202%200.896%202%202v3.75C18%208.988%2019.014%2010%2020.25%2010H24c1.105%200%202%200.896%202%202v17c0%200.551-0.447%201-1%201H7c-0.552%200-1-0.449-1-1%200-0.553-0.447-1-1-1s-1%200.447-1%201c0%201.654%201.346%203%203%203h18c1.654%200%203-1.346%203-3V10C28%209.181%2027.58%208.165%2027%207.586z'%20fill='%23ffffff'%20data-fill-palette-color='accent'%3e%3c/path%3e%3c/g%3e%3c/g%3e%3c/svg%3e%3c/g%3e%3c/svg%3e%3c/g%3e%3c/svg%3e%3c/g%3e%3cdefs%3e%3c/defs%3e%3c/svg%3e%3crect%20width='256.2862059234042'%20height='247.2'%20fill='none'%20stroke='none'%20visibility='hidden'%3e%3c/rect%3e%3c/g%3e%3c/svg%3e%3c/g%3e%3c/svg%3e",C8e="/assets/backend-hTXvHAtb.png",D8e="/assets/creator-B3dXWOt8.png",R8e="/assets/mobile-DOyYxxYf.png",P8e="/assets/web-08ko_qNY.png",O8e="/assets/github-BUfx7uqA.png",B8e="data:image/svg+xml,%3csvg%20width='20'%20height='12'%20viewBox='0%200%2020%2012'%20fill='%23FFF'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M9%202L19%202C19.2652%202%2019.5196%201.89464%2019.7071%201.70711C19.8946%201.51957%2020%201.26522%2020%201C20%200.734784%2019.8946%200.480429%2019.7071%200.292892C19.5196%200.105356%2019.2652%200%2019%200L9%200C8.73478%200%208.48043%200.105356%208.29289%200.292892C8.10536%200.480429%208%200.734784%208%201C8%201.26522%208.10536%201.51957%208.29289%201.70711C8.48043%201.89464%208.73478%202%209%202ZM19%2010L1%2010C0.734784%2010%200.480429%2010.1054%200.292892%2010.2929C0.105356%2010.4804%200%2010.7348%200%2011C0%2011.2652%200.105356%2011.5196%200.292892%2011.7071C0.480429%2011.8946%200.734784%2012%201%2012L19%2012C19.2652%2012%2019.5196%2011.8946%2019.7071%2011.7071C19.8946%2011.5196%2020%2011.2652%2020%2011C20%2010.7348%2019.8946%2010.4804%2019.7071%2010.2929C19.5196%2010.1054%2019.2652%2010%2019%2010V10ZM1%207L19%207C19.2652%207%2019.5196%206.89464%2019.7071%206.70711C19.8946%206.51957%2020%206.26522%2020%206C20%205.73478%2019.8946%205.48043%2019.7071%205.29289C19.5196%205.10536%2019.2652%205%2019%205L1%205C0.734784%205%200.480429%205.10536%200.292892%205.29289C0.105356%205.48043%200%205.73478%200%206C0%206.26522%200.105356%206.51957%200.292892%206.70711C0.480429%206.89464%200.734784%207%201%207Z'%20fill='%23FFFFFF'/%3e%3c/svg%3e",I8e="data:image/svg+xml,%3csvg%20width='18'%20height='18'%20viewBox='0%200%2018%2018'%20fill='%23FFF'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M10.4099%209L16.7099%202.71C16.8982%202.5217%2017.004%202.2663%2017.004%202C17.004%201.7337%2016.8982%201.47831%2016.7099%201.29C16.5216%201.1017%2016.2662%200.995911%2015.9999%200.995911C15.7336%200.995911%2015.4782%201.1017%2015.2899%201.29L8.99994%207.59L2.70994%201.29C2.52164%201.1017%202.26624%200.995911%201.99994%200.995911C1.73364%200.995911%201.47824%201.1017%201.28994%201.29C1.10164%201.47831%200.995847%201.7337%200.995847%202C0.995847%202.2663%201.10164%202.5217%201.28994%202.71L7.58994%209L1.28994%2015.29C1.19621%2015.383%201.12182%2015.4936%201.07105%2015.6154C1.02028%2015.7373%200.994141%2015.868%200.994141%2016C0.994141%2016.132%201.02028%2016.2627%201.07105%2016.3846C1.12182%2016.5064%201.19621%2016.617%201.28994%2016.71C1.3829%2016.8037%201.4935%2016.8781%201.61536%2016.9289C1.73722%2016.9797%201.86793%2017.0058%201.99994%2017.0058C2.13195%2017.0058%202.26266%2016.9797%202.38452%2016.9289C2.50638%2016.8781%202.61698%2016.8037%202.70994%2016.71L8.99994%2010.41L15.2899%2016.71C15.3829%2016.8037%2015.4935%2016.8781%2015.6154%2016.9289C15.7372%2016.9797%2015.8679%2017.0058%2015.9999%2017.0058C16.132%2017.0058%2016.2627%2016.9797%2016.3845%2016.9289C16.5064%2016.8781%2016.617%2016.8037%2016.7099%2016.71C16.8037%2016.617%2016.8781%2016.5064%2016.9288%2016.3846C16.9796%2016.2627%2017.0057%2016.132%2017.0057%2016C17.0057%2015.868%2016.9796%2015.7373%2016.9288%2015.6154C16.8781%2015.4936%2016.8037%2015.383%2016.7099%2015.29L10.4099%209Z'%20fill='%23FFFFFF'/%3e%3c/svg%3e",L8e="/assets/css-DbNBFoFd.png",U8e="/assets/docker-DrQKSZ7f.png",N8e="/assets/figma-CqQ-WOLT.png",z8e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPAAAADwCAYAAAA+VemSAAAACXBIWXMAAAsTAAALEwEAmpwYAAANG0lEQVR4nO2dX6xcRR2AD9QYgpYElEDv3fltqdUSHtSISNWIiIE09vbuzMKa+GBq4p/4hoIGEx/qSxOiL1T62Adj4kN90gegSXnQxAdCIiYkloQKSKKQpo3c7szeikrXzPZCW3r39uzdc2bOzPm+5Jc0t7t7dn4z386cc+bMFAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQFs415cdVqtHrJZjzqgTToudhFEn/N/8//nXxP6eAHAJIy13Oi3HnZFxqdBy3L+HJAJEZLy/e5016og1cr60vGvh3+Pf6z+DSgQIzGhZLVgjz80q7hUia/XC6mCHUIEAgfDCWS2vzCvvJRK/zrkxQILyIjFA4vIiMUDi8iIxQOLyIjFA4vIiMUDi8iIxQOLyIjFA4vIiMUDi8iIxQOLyIjFA4vIiMUDi8iIxQOLyIjFA4vIiMbSe1OVFYmgtuciLxNBKnJE/xJaucomNeu1cr7s9dm4Baie3HpieGFoHEgMkDhIDJA4SAyQOEgMkDhIDNASn5YDV8vis70NigMg4LT++eFsFibnFBMngjPzoynujSIzE0Hhsv/vo9AkOSIzE0Fj8vrtXn6WExEgMjcMa9cPyUw2RGImhMVijfjD7fGEkRmKIjtXq4c1P+kdiJIZojLR8z+9wP9+TO0iMxBAcp+W788qLxDyKCBFwRr5TlbxIjMQQENeTb1st71QpLxIjMSQ2bJ4qsVE/m/V7+SVs/FI2l/8YqDeslmecVof9ebYPp9Uhq9VTTqtTdZahwlywPA80v+etSmJn5EVn5Aln5DPjorhm2mvHB4prR8uLd1stB61Wb8YWFYmhVlxPfSuUvPNcnd4M46Vt1zsjjzmj3oot6/RcqNfP9WVHiHxAZjit9oeWN7TEntGgs2i1PB9bViSGynB9+WYseecZTs/ZGx+NLesGueCcGMphtfq6NfLfRjTcgD3xeFBssUY9HbvM03PBcBqugjUyaIq8MSRe2Ss3Oi0vxy4zEsPMDI081DR5Y0g87KkvxS4vEkOyw+ZpMdTdfqhqndxHbkCZp/6gcU4MKfS8lzTYf9t9t90SqtZGpnNX7DIjMVwV36tZrf7T/MYqvwtdnc7IycbnRXNhq7WMTNekIK+PkVbfD50fp9UvY5e73I+b4hZT2xhp1bNavR278ZUWeHnx7tA5clqWYpcbieEKRj21LyV5fQwHt94cuipX9nV2xi43EsNlONPZY7U6F7uxzRrjwR0fDF2Vp5d3bY1d7pkl1pwTZ4vrd7/mr+bGbmSbEnhp2/Wh8+VnZsUu96YkNpwTZ4fT6oEUe953Y7W3oELn7MyenTfELvemJdb0xNmQurwTgXX386Hz5h/ji13uuSQ29MTJY42632pZjd2Y5m6MWj0S42Jf7HIjcYuxPflqDvJeEFh+Hzx/Wv0idrmRuKXYfvcr1sgoduOpTmD1dsiplH5ZnhRmYrmy+WM4nQ621703J3nfC61+GvJ2W/TyInH7GPbli06Ljd1Y6gl11hnZFiKPq4MdYrW8Er/M1Ybl6nRzmTzHmq28a6HVb0Llc70la3MIy3C6eZztyRecUcPYjSNIA9Tq4VB5pSeG2mmTvBcElv9Z3flGqKZFTwy1MTLd3WvnhtHFCiqx3yVCq59stIh7lSAxVI7fhcAZ+VdsmaKGlj8Ol+WOEM2L4TRUvORLc3cUCH6PWKtfj3Tnc3U3MXpimJvRg+qzyLu+zGVz6Iz81hn1Vy/krPlHYtg0rtf9tDNyJnav19Qoncc59x5iOA0zg7zVC4zEst4pCRuqVY0z2z9Fz1uPwEgsSFwn9sHFTzojp2MPT3MWGIkFietg2O/e3vSNqHMRGIkFiZE3bYGRWJC4Cs4ub99ltXojdo/WRoGRWJAYedMWGIkFiTfV8+qFT1gj/4zdk6UaVQqMxILEM8nbX/w48jZLYCQWJEbedHvgeR+CX2/apb+2Mdl/WKvDfuNyH06rQ1arp5xWp2KPYlyN+cgSvweP1fKP2JWSQ5TNechG69/jjLzojDzhnyDb6BHI8YHiWr+Rm9VysOm3Dy0SF8Vqf3s3x2VbchQ49DRDv52MM/JYkx9csW2edom86Qkco9GOBp1Fq+X52LK6huSjEZzbJ7f5gsdOfm5RNv+pDR/XeuOjsfPrGpKPqIyW1QLD5rQFjiLxl4sPOC3HY8vqNsiHb9tFzoz3d6+zRp6Lnexco2w9pDp8XNkrNzotL8fOs5uejz/H2Ao2GNaoI7GTnHOUrYdKG23gntjvvBE7z27jfBwpcn0g32p5J3aCc47SdVF1ow3cE0/uIzcg3269XBg5P9JyZ5EbTT5/ySVK10Utx+/sKYIuahg/31NDy/EiJ1LfLDqVKFsfNRz7ZKg1qt/FGvVq7HxvFFndWrL97qOxE9qGKFsfVR/XGvXzelvQOmXQ6lDsfDdtU/basFqOxU5oG6JsfVR93FFP7au3Ba1TBi1LsfO9Ufg2X+SC0+ql2AltQ5SujwyGi34OvWtAzqeGVi8VudCmzcdiRvn6qPa4p5d3bS0C44/pGpDz6aGGRS4gcN4CjwfFliIw/pguuqRtEZghdN4C33/Lh4rAJNADnyhygYtYeQvMObDkfRHLX1KP/4uYf5StjxqOvbfeFpTiVWiVz22ktVUZoic19yhbH5UfW6tD9bag9cqgnoyd79ZM5PAwlTJfgf2sqCIwjZ6JpTObSunxE7z9RO/oyc04ytZFHcf285OLQDR5LrTN9WEGD48T5iuwf0KoCESzn0ZSeT5O6OGB/nwFXut97qt/w7vOPbEldW19oN/Dkjr5CuyfSloZdG6qq+34z3ZG/hZbVNfWJXXeZXWwQ6yWV2InPbcom/96v4d61q9fVcfMK2vU07Fz7NaJdq5Muc6q/UQOAk/iaJVDySavSmnbtCLl+6EnrrYxlc17oIb9F7/2d87rQts29rzvB4nzFHgSWqzf++jMnp03zNou/PzqJu/MYJH3IgynMxX4YmN/0+93NDLd3X7/ow33RjLd3U3fG8m2edg8DSTOV+DLQqtTk4tRl+9OeHjtb43fndAi73QYTrdA4ITDMmy+OkiMwLFFdcg7H0hMDxxbWEfPi8ShG1rZjMcWIqWwDJvpiRE4vogOeePAcJoeGHkTB4kZQtPzJg4Scw7MsDlxkJiLWJzzJg4ScxWaC1aJw7TL99/qkHesVk+VzZ9/LZuty8X8MT0yPEh8YQE1a+RXK1p9bNb8+ff497Z9oUGLvPFos8RWq7/bXvfeeXPoP8N/VuzyIG9LaeM58eQB90H31qpyOFza9lGn1Z/alUPFw/hNoU09sV/p4tTg5g9XnUP/mf6zW5LD13iet2G0QWL/kPtqb0HVlUP/2U1+kB55Myf34fTQyEN159AaGWQrr2bY3Hiy7YkD7reT4z5WlmFzOuTYE1uj7g+VP6fVA1nlTtPzJkdmPfHJcVFcEyp3/lj+mFnIa7hglSwZ9cRPhM6d3/M3eXk1PW/y5CDxsCcPhs6bv2AWu9zIC1kMp4f97u2hq9IfM3a5NxuWYXN+pNwTn9ULHwmdr8nsrBTl1QybsyXVnriO3f6uhj9mcvIaLlhlT4o9sd8nKHSeTi/v2pqUvJqetzWk1hPH2AFvZV9nZzLyGnre1pGYxHtD58dpWWpAuZEXMhhOa3UodD06o56MXu6rhGXYDClI7B+4D11T1qhXY5cbeSGb4fTIdO4KVZ3+WI2Wl3NeSK0ntlqeCVVrVsux5uaBq82QqsRG7qu78ob9zj2xy4m8kKXE/rzUz5Cqq3pXBp2bmvoUEj0vZCGxM+rZOmZmjQfFFmvU0/HLh7yQ/4Wto+OlbddXVdH+s/xnNqBcVwQXrCDLntivILna396dt3pHg87iZJnaJpaRC1aQs8ROi7VaHj+zZ+cNs5bLz692Rh5zRr0VvRzICy0eTk+Wm7VaDo5Md/f4QHHttHL4//Ov8a9t8vKxDJuhdRK/F1qdmlyM0uqw7519TP594W+non8/5IVYNHo4nUFwzgu1g8TIC4mDxPS8kDhIzLAZEgeJOeeFxEFiLlhB4iAxV5shcZCYW0WQOEjMfV5IHCRmkgYkDhIzwwoSB4mZHgmJ03aJmdsMydNWiZEXsqFtEiMvZEdbJEZeyJbcJUZeyJ5cJUZeaA25SYy80DpykRh5obWkLjHyQutJVWLkBUhUYuQFSFRi5AVIVGLkBUhUYuQFSFRi5AVIVGLkBUhUYuQFSFRi5AVIVGLkBUhUYuQFSFRi5AVIVGLkBUhUYuQFCMxoWS1YI89VIO8L/geBCgQIzHh/9zpr1BFr5PzM4ho579/rP4OKA4jISMudTsvx0gJrOe7fQ6UBNIhzfdlhtXrEajnmjDrhtNhJGHXC/83/n39N7O8JAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFCE4v/t8177cNMPugAAAABJRU5ErkJggg==",F8e="/assets/html-BlhLRGzY.png",V8e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPAAAADwCAYAAAA+VemSAAAACXBIWXMAAAsTAAALEwEAmpwYAAAOgElEQVR4nO2dCdCVZRXHz8Pnwi4groElmijuK6m4YCqJpZmJqJla40qGWjgYZZQL5p4GJZlboKKTGzoouWSAiQsuqONY42Q1LVrZYlpZnebcy51B6uO7977LeZ/7/H4z/wGGmfve5zznf577vu+ziAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAtIW+JIqIQafkgKSGd8ARMVAMjIEpBBQCZQQmCSgEceeApIZ3wBExUAyMgSkEFAJlBCYJKARx54CkhnfAETFQDIyBKQQUAmUEJgkoBHHngKSGd8ARMVAMjIEpBBQCZQQmCSgEceeApIZ3wBExUAyMgSkEFAJlBCYJKARx54CkhnfAETFQDIyBKQQUAmUEJgkoBHHngKSGd8ARMVAMjIEpBBQCZQQmCSgEceeApIZ3wBExUAyMgSkEFAJlBCYJKARx54CkhnfAETFQDIyBKQQUAmUEJgkoBHHngKSGd8ARMVAMjIEpBBQCZQQmCSgEceeApIZ3wBExUAyMgSkEFAJlBCYJKARx54CkhnfAETFQDIyBKQQUAmUEJgkoBHHngKSGd8ARMVAMjIEpBBQCZQQmCSgEceeApIZ3wBExUAyMgSkEFAJlBCYJKARx54CkhnfAETFQDIyBKQQUAmUEJgkoBHHngKSGd8ARMVAMjIEpBBQCZQQmCSgEceeApIZ3wBExUAyMgSkEFAJlBCYJKARx54CkhnfAETFQDIyBKQQUAmUEJgkoBHHngKSGd8ARMVAMjIEpBBQCZQQmCSgEceeApIZ3wBExUAyMgSkEFAJlBCYJKARx54CkhnfAETFQDIyBKQQUAmUEJgkoBHHngKSGd8ARMVAMjIEpBBQCZQQmCSgEceeApIZ3wBExUAyMgSkEFAJlBCYJKARx54CkhnfAETFQDIyBKQQUAmUEJgkoBHHngKSGd8ARMVAMjIEpBBQCZQQmCSgEceeApIZ3wBExUAyMgSkEFAJlBCYJKARx54CkhnfAETFQDIyB/Sp+yKQJHwmlft+3l4kumiN62dmixx8WdJ9dg246LOjggUH79A4aQv3v79sg6Oab1P//pAlBL50iev9s0b8tq3bBkdTwDnjsisHA7zwj+v1viB62f9C+vbN9395rBx03JuhV00TfXFrF/kgM74DHriob+A8/EZ16YtChg7N9x+40oF/QyccGfXVhlfojMbwDHruqaOB3l4teMkV00IBijLuq1loz6PRJov94rgr9kRjeAY9dVTPwy/eJ7rZtOcZdVVtvHvSp2737IzG8DRC7qmTghdeWN+p2p769g94zEwNj4AqYMyYDz7tcdI0uX/PKCtn3mP01r/5IDG8DxK4qGPjumdUxr6yQvY6aezEGxsAVMGmVDWz3vAP7+xtWunnltGRu2f2RGN4GiF2eBranvttu4W9UWY3WHxL0tYcwMAaugFmrZuDzJ2e/fhkaN6a82WaSGt4GiF1eBv79Y6L9+/qbs1ndcCEGxsAVMGxVDDztZH9TtqIh64Ra0Sm+PxLD2wCxy8PANtNqw6H+pmxWgwcGvWZ6Wf2RGN4GiF0eBr732/nd+24/MugVU0WfuUP09cX11Ub259J5oldPE917l/oroXY//9hDgr6xpMz+SAxvA8QuDwNPOjq7cfv1qd+X/ufFnq9nr4J22LK1z990WKgtPyy/PxLD2wCxy8PANuc46/vZR29qfR3xxPE9f3ZXV9Azjwv61tNe/ZEY3gaIXWUb+O/PSs0kWa553ufba+u/losefuDqf44/eZt3fySGtwFiV9kGfnF+tmvarht/far99trIOmqz//3MGWeK/vP5KvRHYngHPHaVbeAHr8t2zQP2yD6pwh54NeZejx0d9JUFVeqPxPAOeOwq28C2cCHL9T57eD6zor46SfTa85p7CKal9kdieAc8dpVt4NuvzHZN28ius/sjMbwDHrvKNnDWd8AH7omBOwpvA8Susg38yA2S+f2v7VLZuf2RGN4Bj11lG9geGGW95qxzO7k/EsM74LGrbAPb6NmrV7Zrrjso6E/v79T+SAzvgMeusg1s2nJEtmuaRgwPtd08Oq8/EsM74LHLw8C2QCDrdU22Fc+NM6r3Kkgz9UdieAc8dnkY+KaL8t2Jw1YcPXZzp/RHYngHPHZ5GNiOTFlzjfwM3JAdZLZgduz9kRjeAY9dHgY2fXI1iwqyasetgt5yaTXmNmvL/ZEY3gGPXV4GtuWARRm4ITti1FYu/XZRTP2RGN4Bj11eBjbZrKqiTWxae62gnz406LN3xtAfieEd8NjlaeDn75LayYBlmHjl1UwPfLe6T64lNbwDHrs8DWz6+uk+e0NvNzLozZeI/vsF/z54b38khnfAY5e3gc1AB+9TvoEbsu19bruiSv2RGN4Bj13eBja9uVRqI6KXiUWCfvhD/mcDY+AKGCI2VcHApt8tzr7ZXVZ1dQX94gm+q50kNbwNELuqYmDTHx+X2mQMTxOLBN1qRNAnnDa3k9TwNkDsqpKBGycW2iiYdcVSVq3RFfSCM8p/Wi2p4W2A2FU1Azf0w+9JbSKG92h81MGhthUuBsbA7maNycAmO0zshMP8R+OD9irvvlhSw9sAsavKBl55G9j9Rvua+JCxobYxPAbGwO6mjc3ADc2fJbrLNn4mPuv44tsqqeFtgNgVk4EbWjRH9KP7Zjt1sB2FEGq7ahbbH4nhbYDYFaOBG3ruzvo9sh12VpaJN14/29EuPfdHYngbIHbFbOCVZ3JdeY7o+zcux8TnnlZcmyU1vJMndnWCgRt6d7norZeJ7jSqWAMP7B/0z08U1R+J4Z00sauTDLyyFl4rtfnNRZn4m18qqj8SwztRYlenGrghO+93/93zN/Do7Yppt6SGd4LErk43cEN3Xi26wbr5GbhXr6C/frSI/kgM78SIXakY2GR7Y+21c34mnnd5Ef2RGN5JEbtSMrDpradF99gxHwN/4YT82y6p4Z0QMcvm96ZmYNNrD0ntlMOsbT94HwyMgR0T+fXF1TSwLWIouu02LTJr27f5IAbGwE0m3M8flNrWqLboPa8kthP+sibxkQeFXN/jXnhGfXRcOq9YAy+Zm73t6w3BwBi4h0Sz0wVmnCnat3c9aU6ekF/S3Ped7El83Mfz+T7L737vQoVRmxW7DtemQ2Zte78+GBgD93CavW3vsuqE+rtn5pPENtplTeJTJ4bMo+75k6W2+fqqn33OScXeX2e9D+7qwsAYuJvXHXYEZ3erbQYPDPri/OwJvOdO2e8Dp3wm28buq5v2aNva2ESMIsxra3vt87O0vX9fDIyBV9kjeda5UjNoT8lj281kOaX+hXvy2VDdFhG0c1tgG7o3cyrDpsOCvrEkfwO/ujB7+zdaDwNj4BUJZXsS79riYvWhg4P+6Mb2Rp8xOYy+pjuuau3adj6RnR7YyjXGjs7/fvjqadkNvN1IDJy8gf+0VPRzx9Tvp9qd0jfp6FA7c7eZxH17mdQ2asvDvCZbk9vsqDt9UvvnAo/fO799qexzNt8ke9uPGIeBkzbw3ItFNxyaj5HsKfVJE0LtyfJfnnzvdWxr1JfvE71iqtR+kuZlXrumPYTqqZ3LfiC6fQ4nL9i+WLYBfNa4n35MddcFS2p4m7Bd/eyB7A9RVie7jx4xPOjwDetGK+Ia9hCsmbbuvkN+17T7zgWz24u5/QyffGx+3+XB6/LPC0kNbyNmkY2YRRm4DH3l1OYMvHiO5L5/1d671I8JbWanSNss/pZLpfZuOa/r9+1dzHtqSQ1vE2aRLUfLY06ul1o5DGzi+OJ+adi9qE12ue4CqW06d89M0RtnSO1khUP3C7ruoPyvO3E864GTN7Al9mVn+5yPm1X287yVY0dsAYFtReP9vfPSw9cXU9QlNbxH0awyE4wb45+QrcoKT6tttZ+x3t87D+00qrXihYE72MCm3/xYdP0h/onZrGwktddf7bT1xCP8v38VH17pCklqeJsvz3nPZe5vnEUXndV+O+09dB6vlLw0oeD1z5Ia3sbLU3d9q9hXS3nIJkBkffpqvzi2+IB/W1rVsA3yXc6JgTvMwCZ7elr2kSHNymZR5bVO95cP5zuppGj171vOod+SGt6GK0L2sKdPQZMvsuiqafkvKLCn2d7tkh5kSx3vb3PyCAZO0MAmq/Z2Do938jY07eRi7v1spZFNyvBun3SjQQPaWzCCgRMegRv61SP5rNnNIvs5bxMiimynzaf+8intL+goStuPDPrSveX2uaSGt8nKWCN8zfTm1gjnLZvBZBuil9XWx28t/lyjZrTWmkGnnljslj4YOBEDr7xLx6c+Vl8+WMaoa69L7Jplt9PmNl9/gc+9ca9eQT9xQNBXFvj1s6SGt7HKlu2kYdvt/L89pLLKfsIeMra1Oc5FydYP28O8Mu6P1xkQ9JQjQ23JpXe7JTW8A+4l2zvZTsjbd7f63lFZRh3bCcS2uPnFw/7t6u5p9SVT6mbOa7KLvdO1bXptR5F3ctooIA9JangHvAqyA65tIf9XJ4kefmDQnbcOtamZNrJYstpobffQm2xUX8NrezmbYefPqm/u7v39W5GZbdGc+t5hpx1VPx1hhy1DbWMEa2OjmA3oV//3ZsNDbfsgWz1kC/Bvv7K+Ftu7HdqNJDW8A46IgWJgDEwhoBAoIzBJQCGIOwckNbwDjoiBYmAMTCGgECgjMElAIYg7ByQ1vAOOiIFiYAxMIaAQKCMwSUAhiDsHJDW8A46IgWJgDEwhoBAoIzBJQCGIOwckNbwDjoiBYmAMTCGgECgjMElAIYg7ByQ1vAOOiIFiYAxMIaAQKCMwSUAhiDsHJDW8A46IgWJgDEwhoBBoiiMwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEg+/BceiofdqS/+vQAAAABJRU5ErkJggg==",H8e="/assets/mongodb-DnU9EL9s.png",G8e="/assets/nodejs-BctxLIqp.png",k8e="/assets/reactjs-LYxsbuPE.png",j8e="/assets/redux-BgiCOxBH.png",W8e="/assets/tailwind-CLR6e3yI.png",X8e="/assets/typescript-DZguP06n.png",q8e="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20fill='none'%20stroke-linecap='square'%20stroke-miterlimit='10'%20version='1.1'%20viewBox='0%200%20226.77%20226.77'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20transform='translate(8.964%204.2527)'%20fill-rule='evenodd'%20stroke='%23000'%20stroke-linecap='butt'%20stroke-linejoin='round'%20stroke-width='4'%3e%3cpath%20d='m63.02%20200.61-43.213-174.94%20173.23%2049.874z'/%3e%3cpath%20d='m106.39%2050.612%2021.591%2087.496-86.567-24.945z'/%3e%3cpath%20d='m84.91%20125.03-10.724-43.465%2043.008%2012.346z'/%3e%3cpath%20d='m63.458%2038.153%2010.724%2043.465-43.008-12.346z'/%3e%3cpath%20d='m149.47%2062.93%2010.724%2043.465-43.008-12.346z'/%3e%3cpath%20d='m84.915%20125.06%2010.724%2043.465-43.008-12.346z'/%3e%3c/g%3e%3c/svg%3e",Y8e="/assets/meta-XrKFwPjh.jpg",Q8e="/assets/tesla-voDL24WZ.png",K8e="/assets/starbucks-LxG_1qb8.png",KC="/assets/tesla-voDL24WZ.png",J8e="/assets/webdev-B9g8yLVV.jpg",Z8e="/assets/data_analysis-DBU1bwJD.jpg",$8e="/assets/powerbi-DAd_Vnf5.jpg",eje="/assets/data_science-BNpVSRB2.jpg",rq=[{id:"about",title:"About"},{id:"work",title:"Work"},{id:"contact",title:"Contact"}],tje=[{title:"Data Analyst",icon:P8e},{title:"Data Integration",icon:R8e},{title:"Data Scientist",icon:C8e},{title:"Data Engineer",icon:D8e}],ije=[{name:"HTML 5",icon:F8e},{name:"CSS 3",icon:L8e},{name:"JavaScript",icon:V8e},{name:"TypeScript",icon:X8e},{name:"React JS",icon:k8e},{name:"Redux Toolkit",icon:j8e},{name:"Tailwind CSS",icon:W8e},{name:"Node JS",icon:G8e},{name:"MongoDB",icon:H8e},{name:"Three JS",icon:q8e},{name:"git",icon:z8e},{name:"figma",icon:N8e},{name:"docker",icon:U8e}],nje=[{title:"Student",company_name:"UCSD",icon:K8e,iconBg:"#383E56",date:"July 2016 - December 2020",points:["The B.S. in Cognitive Science offers a specialization in Machine Learning and Neural Computation.","It focuses on computational and mathematical modeling of cognition and cognitive systems.","Ideal for students interested in theoretical neuroscience, software engineering, or data science.","Electives include advanced courses in neural networks, AI, and computer science."]},{title:"Logistics Analyst",company_name:"HHSA - County of San Diego",icon:KC,iconBg:"#E6DEDD",date:"January 2021 - June 2022",points:["Automated clinical supply tracking and coordination using Microsoft 365 to support nurses and site managers.","Cleaned, integrated, and analyzed large datasets using Python, R, Power BI, and Excel to optimize inventory and supply chain decisions.","Built data-driven dashboards with KPIs and maintained clear communication across departments and with clients.","Managed team schedules, IT logistics, and daily operations to ensure seamless field and supply chain execution."]},{title:"Data Scientist",company_name:"BHS - County of San Diego",icon:Q8e,iconBg:"#383E56",date:"July 2022 - Present",points:["Skilled in Power BI data modeling, integration, and automation using Power Query (M), DAX, and ETL processes from SharePoint, Dataflows, and SQL databases.","Proficient in merging datasets, feature engineering, and creating interactive dashboards for effective data visualization and decision-making.","Experienced in automating workflows to enhance process efficiency and data pipeline optimization.","Strong communicator with experience in client-focused reporting and local LLM implementation using Ollama3 for advanced analytics and insights."]},{title:"Part Time - Data Analysis & Data Processing",company_name:"RSG Inc",icon:Y8e,iconBg:"#E6DEDD",date:"November 2023 - June 2024",points:["Develop and maintain Python-based environments for efficient data cleaning and preprocessing.","Utilize custom Python applications to automate survey validation, ensuring data accuracy and consistency through integrated software tools.","Support the analytics team by contributing to special projects involving data preparation, quality checks, and reporting automation."]}],rje=[{testimonial:"He is cooperative and professional when interacting with co-workers and has evolved into a productive and reliable member of the team.",name:"Antonio Mendez Serrano",designation:"Senior Facilities Analyst",company:"San Diego County",image:KC},{testimonial:"Thank you for your commitment and contributions to the health and safety of our community.",name:"Ryan Clabo",designation:"Chief Medical Care Services",company:"Behavioral Health Services",image:KC},{testimonial:"Excelled in integrating complex data, cleaning it, and designing interactive, user-friendly dashboards while fostering collaboration and feedback with cross-functional teams.",name:"Scott Ritzma",designation:"Senior Data & Research Analyst",company:"HHSA Public Health",image:KC}],sje=[{name:"Personal Website",description:"Web-based portfolio that showcases work history, achievements and personal capabilities. Technologies include javascript, html, css, tailwindcss, domains, and hosting. Scroll up and  Right or Left Click on 3D model!",tags:[{name:"react",color:"blue-text-gradient"},{name:"spline",color:"green-text-gradient"},{name:"tailwind",color:"pink-text-gradient"}],image:J8e,source_code_link:"https://github.com/jayalaoc/jtech_portfolio"},{name:"Data Modeling/Analysis",description:"Advanced analytics that make predictions about future outcomes using historical data combined with statistical modeling, data mining techniques and machine learning. Visit my github for detailed examples.",tags:[{name:"python",color:"blue-text-gradient"},{name:"Anaconda Env.",color:"green-text-gradient"},{name:"Github",color:"pink-text-gradient"}],image:Z8e,source_code_link:"https://github.com/jayalaoc/Data-Modeling-and-Analysis"},{name:"PowerBI Market Analysis",description:"Power BI is a unified, scalable platform for self-service and enterprise business intelligence (BI). Connect to and visualize any data, and seamlessly infuse the visuals into the apps you use every day.",tags:[{name:"PowerBI",color:"blue-text-gradient"},{name:"Power Query",color:"green-text-gradient"},{name:"DAX",color:"pink-text-gradient"}],image:$8e,source_code_link:"https://github.com/jayalaoc/PowerBI-Dashboards"},{name:"Data Science Projects",description:"Leveraging advanced analytics, computer science, statistics, cognitive science, psychology, data visualization, and machine learning to engage in experimental challenges.",tags:[{name:"python",color:"blue-text-gradient"},{name:"Anaconda Env.",color:"green-text-gradient"},{name:"Github",color:"pink-text-gradient"}],image:eje,source_code_link:"https://github.com/jayalaoc/Data-Science"}],aje=()=>{const[e,t]=ge.useState(""),[i,n]=ge.useState(!1),[r,s]=ge.useState(!1);return ge.useEffect(()=>{const a=()=>{window.scrollY>100?s(!0):s(!1)};return window.addEventListener("scroll",a),()=>window.removeEventListener("scroll",a)},[]),ke.jsx("nav",{className:`${ja.paddingX} w-full flex items-center py-5 fixed top-0 z-20 ${r?"bg-primary":"bg-transparent"}`,children:ke.jsxs("div",{className:"w-full flex justify-between items-center max-w-7xl mx-auto",children:[ke.jsxs(Xz,{to:"/",className:"flex items-center gap-2",onClick:()=>{t(""),window.scrollTo(0,0)},children:[ke.jsx("img",{src:T8e,alt:"logo",className:"w-9 h-9 object-contain"}),ke.jsxs("p",{className:"text-white text-[18px] font-bold cursor-pointer flex ",children:["Tech ",ke.jsx("span",{className:"sm:block hidden",children:" | Portfolio"})]})]}),ke.jsx("ul",{className:"list-none hidden sm:flex flex-row gap-10",children:rq.map(a=>ke.jsx("li",{className:`${e===a.title?"text-white":"text-secondary"} hover:text-white text-[18px] font-medium cursor-pointer`,onClick:()=>t(a.title),children:ke.jsx("a",{href:`#${a.id}`,children:a.title})},a.id))}),ke.jsxs("div",{className:"sm:hidden flex flex-1 justify-end items-center",children:[ke.jsx("img",{src:i?I8e:B8e,alt:"menu",className:"w-[28px] h-[28px] object-contain",onClick:()=>n(!i)}),ke.jsx("div",{className:`${i?"flex":"hidden"} p-6 black-gradient absolute top-20 right-0 mx-4 my-2 min-w-[140px] z-10 rounded-xl`,children:ke.jsx("ul",{className:"list-none flex justify-end items-start flex-1 flex-col gap-4",children:rq.map(a=>ke.jsx("li",{className:`font-poppins font-medium cursor-pointer text-[16px] ${e===a.title?"text-white":"text-secondary"}`,onClick:()=>{n(!i),t(a.title)},children:ke.jsx("a",{href:`#${a.id}`,children:a.title})},a.id))})})]})]})})},sq=(e,t,i,n)=>{e.style.transition=`${t} ${i}ms ${n}`},Pf=(e,t,i)=>Math.min(Math.max(e,t),i);class oje{constructor(t,i){this.glareAngle=0,this.glareOpacity=0,this.calculateGlareSize=a=>{const{width:o,height:l}=a,c=Math.sqrt(o**2+l**2);return{width:c,height:c}},this.setSize=a=>{const o=this.calculateGlareSize(a);this.glareEl.style.width=`${o.width}px`,this.glareEl.style.height=`${o.height}px`},this.update=(a,o,l,c)=>{this.updateAngle(a,o.glareReverse),this.updateOpacity(a,o,l,c)},this.updateAngle=(a,o)=>{const{xPercentage:l,yPercentage:c}=a,u=180/Math.PI,h=l?Math.atan2(c,-l)*u:0;this.glareAngle=h-(o?180:0)},this.updateOpacity=(a,o,l,c)=>{const{xPercentage:u,yPercentage:h}=a,{glarePosition:d,glareReverse:p,glareMaxOpacity:g}=o,x=l?-1:1,y=c?-1:1,b=p?-1:1;let A=0;switch(d){case"top":A=-u*x*b;break;case"right":A=h*y*b;break;case"bottom":case void 0:A=u*x*b;break;case"left":A=-h*y*b;break;case"all":A=Math.hypot(u,h)}const w=Pf(A,0,100);this.glareOpacity=w*g/100},this.render=a=>{const{glareColor:o}=a;this.glareEl.style.transform=`rotate(${this.glareAngle}deg) translate(-50%, -50%)`,this.glareEl.style.opacity=this.glareOpacity.toString(),this.glareEl.style.background=`linear-gradient(0deg, rgba(255,255,255,0) 0%, ${o} 100%)`},this.glareWrapperEl=document.createElement("div"),this.glareEl=document.createElement("div"),this.glareWrapperEl.appendChild(this.glareEl),this.glareWrapperEl.className="glare-wrapper",this.glareEl.className="glare";const n={position:"absolute",top:"0",left:"0",width:"100%",height:"100%",overflow:"hidden",borderRadius:i,WebkitMaskImage:"-webkit-radial-gradient(white, black)",pointerEvents:"none"},r=this.calculateGlareSize(t),s={position:"absolute",top:"50%",left:"50%",transformOrigin:"0% 0%",pointerEvents:"none",width:`${r.width}px`,height:`${r.height}px`};Object.assign(this.glareWrapperEl.style,n),Object.assign(this.glareEl.style,s)}}class lje{constructor(){this.glareAngle=0,this.glareOpacity=0,this.tiltAngleX=0,this.tiltAngleY=0,this.tiltAngleXPercentage=0,this.tiltAngleYPercentage=0,this.update=(t,i)=>{this.updateTilt(t,i),this.updateTiltManualInput(t,i),this.updateTiltReverse(i),this.updateTiltLimits(i)},this.updateTilt=(t,i)=>{const{xPercentage:n,yPercentage:r}=t,{tiltMaxAngleX:s,tiltMaxAngleY:a}=i;this.tiltAngleX=n*s/100,this.tiltAngleY=r*a/100*-1},this.updateTiltManualInput=(t,i)=>{const{tiltAngleXManual:n,tiltAngleYManual:r,tiltMaxAngleX:s,tiltMaxAngleY:a}=i;(n!==null||r!==null)&&(this.tiltAngleX=n!==null?n:0,this.tiltAngleY=r!==null?r:0,t.xPercentage=100*this.tiltAngleX/s,t.yPercentage=100*this.tiltAngleY/a)},this.updateTiltReverse=t=>{const i=t.tiltReverse?-1:1;this.tiltAngleX=i*this.tiltAngleX,this.tiltAngleY=i*this.tiltAngleY},this.updateTiltLimits=t=>{const{tiltAxis:i}=t;this.tiltAngleX=Pf(this.tiltAngleX,-90,90),this.tiltAngleY=Pf(this.tiltAngleY,-90,90),i&&(this.tiltAngleX=i==="x"?this.tiltAngleX:0,this.tiltAngleY=i==="y"?this.tiltAngleY:0)},this.updateTiltAnglesPercentage=t=>{const{tiltMaxAngleX:i,tiltMaxAngleY:n}=t;this.tiltAngleXPercentage=this.tiltAngleX/i*100,this.tiltAngleYPercentage=this.tiltAngleY/n*100},this.render=t=>{t.style.transform+=`rotateX(${this.tiltAngleX}deg) rotateY(${this.tiltAngleY}deg) `}}}const cje={scale:1,perspective:1e3,flipVertically:!1,flipHorizontally:!1,reset:!0,transitionEasing:"cubic-bezier(.03,.98,.52,.99)",transitionSpeed:400,trackOnWindow:!1,gyroscope:!1,tiltEnable:!0,tiltReverse:!1,tiltAngleXInitial:0,tiltAngleYInitial:0,tiltMaxAngleX:20,tiltMaxAngleY:20,tiltAxis:void 0,tiltAngleXManual:null,tiltAngleYManual:null,glareEnable:!1,glareMaxOpacity:.7,glareColor:"#ffffff",glarePosition:"bottom",glareReverse:!1,glareBorderRadius:"0"};class uV extends ge.PureComponent{constructor(){super(...arguments),this.wrapperEl={node:null,size:{width:0,height:0,left:0,top:0},clientPosition:{x:null,y:null,xPercentage:0,yPercentage:0},updateAnimationId:null,scale:1},this.tilt=null,this.glare=null,this.addDeviceOrientationEventListener=async()=>{if(!window.DeviceOrientationEvent)return;const t=DeviceOrientationEvent.requestPermission;typeof t=="function"?await t()==="granted"&&window.addEventListener("deviceorientation",this.onMove):window.addEventListener("deviceorientation",this.onMove)},this.setSize=()=>{this.setWrapperElSize(),this.glare&&this.glare.setSize(this.wrapperEl.size)},this.mainLoop=t=>{this.wrapperEl.updateAnimationId!==null&&cancelAnimationFrame(this.wrapperEl.updateAnimationId),this.processInput(t),this.update(t.type),this.wrapperEl.updateAnimationId=requestAnimationFrame(this.renderFrame)},this.onEnter=t=>{const{onEnter:i}=this.props;this.setSize(),this.wrapperEl.node.style.willChange="transform",this.setTransitions(),i&&i({event:t})},this.onMove=t=>{this.mainLoop(t),this.emitOnMove(t)},this.onLeave=t=>{const{onLeave:i}=this.props;if(this.setTransitions(),i&&i({event:t}),this.props.reset){const n=new CustomEvent("autoreset");this.onMove(n)}},this.processInput=t=>{const{scale:i}=this.props;switch(t.type){case"mousemove":this.wrapperEl.clientPosition.x=t.pageX,this.wrapperEl.clientPosition.y=t.pageY,this.wrapperEl.scale=i;break;case"touchmove":this.wrapperEl.clientPosition.x=t.touches[0].pageX,this.wrapperEl.clientPosition.y=t.touches[0].pageY,this.wrapperEl.scale=i;break;case"deviceorientation":this.processInputDeviceOrientation(t),this.wrapperEl.scale=i;break;case"autoreset":{const{tiltAngleXInitial:n,tiltAngleYInitial:r,tiltMaxAngleX:s,tiltMaxAngleY:a}=this.props,o=r/a*100;this.wrapperEl.clientPosition.xPercentage=Pf(n/s*100,-100,100),this.wrapperEl.clientPosition.yPercentage=Pf(o,-100,100),this.wrapperEl.scale=1;break}}},this.processInputDeviceOrientation=t=>{if(!t.gamma||!t.beta||!this.props.gyroscope)return;const{tiltMaxAngleX:i,tiltMaxAngleY:n}=this.props,r=t.gamma;this.wrapperEl.clientPosition.xPercentage=t.beta/i*100,this.wrapperEl.clientPosition.yPercentage=r/n*100,this.wrapperEl.clientPosition.xPercentage=Pf(this.wrapperEl.clientPosition.xPercentage,-100,100),this.wrapperEl.clientPosition.yPercentage=Pf(this.wrapperEl.clientPosition.yPercentage,-100,100)},this.update=t=>{const{tiltEnable:i,flipVertically:n,flipHorizontally:r}=this.props;t!=="autoreset"&&t!=="deviceorientation"&&t!=="propChange"&&this.updateClientInput(),i&&this.tilt.update(this.wrapperEl.clientPosition,this.props),this.updateFlip(),this.tilt.updateTiltAnglesPercentage(this.props),this.glare&&this.glare.update(this.wrapperEl.clientPosition,this.props,n,r)},this.updateClientInput=()=>{const{trackOnWindow:t}=this.props;let i,n;if(t){const{x:r,y:s}=this.wrapperEl.clientPosition;i=s/window.innerHeight*200-100,n=r/window.innerWidth*200-100}else{const{size:{width:r,height:s,left:a,top:o},clientPosition:{x:l,y:c}}=this.wrapperEl;i=(c-o)/s*200-100,n=(l-a)/r*200-100}this.wrapperEl.clientPosition.xPercentage=Pf(i,-100,100),this.wrapperEl.clientPosition.yPercentage=Pf(n,-100,100)},this.updateFlip=()=>{const{flipVertically:t,flipHorizontally:i}=this.props;t&&(this.tilt.tiltAngleX+=180,this.tilt.tiltAngleY*=-1),i&&(this.tilt.tiltAngleY+=180)},this.renderFrame=()=>{this.resetWrapperElTransform(),this.renderPerspective(),this.tilt.render(this.wrapperEl.node),this.renderScale(),this.glare&&this.glare.render(this.props)}}componentDidMount(){if(this.tilt=new lje,this.initGlare(),this.setSize(),this.addEventListeners(),typeof CustomEvent>"u")return;const t=new CustomEvent("autoreset");this.mainLoop(t);const i=new CustomEvent("initial");this.emitOnMove(i)}componentWillUnmount(){this.wrapperEl.updateAnimationId!==null&&cancelAnimationFrame(this.wrapperEl.updateAnimationId),this.removeEventListeners()}componentDidUpdate(){const t=new CustomEvent("propChange");this.mainLoop(t),this.emitOnMove(t)}addEventListeners(){const{trackOnWindow:t,gyroscope:i}=this.props;window.addEventListener("resize",this.setSize),t&&(window.addEventListener("mouseenter",this.onEnter),window.addEventListener("mousemove",this.onMove),window.addEventListener("mouseout",this.onLeave),window.addEventListener("touchstart",this.onEnter),window.addEventListener("touchmove",this.onMove),window.addEventListener("touchend",this.onLeave)),i&&this.addDeviceOrientationEventListener()}removeEventListeners(){const{trackOnWindow:t,gyroscope:i}=this.props;window.removeEventListener("resize",this.setSize),t&&(window.removeEventListener("mouseenter",this.onEnter),window.removeEventListener("mousemove",this.onMove),window.removeEventListener("mouseout",this.onLeave),window.removeEventListener("touchstart",this.onEnter),window.removeEventListener("touchmove",this.onMove),window.removeEventListener("touchend",this.onLeave)),i&&window.DeviceOrientationEvent&&window.removeEventListener("deviceorientation",this.onMove)}setWrapperElSize(){const t=this.wrapperEl.node.getBoundingClientRect();this.wrapperEl.size.width=this.wrapperEl.node.offsetWidth,this.wrapperEl.size.height=this.wrapperEl.node.offsetHeight,this.wrapperEl.size.left=t.left+window.scrollX,this.wrapperEl.size.top=t.top+window.scrollY}initGlare(){const{glareEnable:t,glareBorderRadius:i}=this.props;t&&(this.glare=new oje(this.wrapperEl.size,i),this.wrapperEl.node.appendChild(this.glare.glareWrapperEl))}emitOnMove(t){const{onMove:i}=this.props;if(!i)return;let n=0,r=0;this.glare&&(n=this.glare.glareAngle,r=this.glare.glareOpacity),i({tiltAngleX:this.tilt.tiltAngleX,tiltAngleY:this.tilt.tiltAngleY,tiltAngleXPercentage:this.tilt.tiltAngleXPercentage,tiltAngleYPercentage:this.tilt.tiltAngleYPercentage,glareAngle:n,glareOpacity:r,event:t})}resetWrapperElTransform(){this.wrapperEl.node.style.transform=""}renderPerspective(){const{perspective:t}=this.props;this.wrapperEl.node.style.transform+=`perspective(${t}px) `}renderScale(){const{scale:t}=this.wrapperEl;this.wrapperEl.node.style.transform+=`scale3d(${t},${t},${t})`}setTransitions(){const{transitionSpeed:t,transitionEasing:i}=this.props;sq(this.wrapperEl.node,"all",t,i),this.glare&&sq(this.glare.glareEl,"opacity",t,i)}render(){const{children:t,className:i,style:n}=this.props;return ke.jsx("div",{ref:r=>{this.wrapperEl.node=r},onMouseEnter:this.onEnter,onMouseMove:this.onMove,onMouseLeave:this.onLeave,onTouchStart:this.onEnter,onTouchMove:this.onMove,onTouchEnd:this.onLeave,className:i,style:n,children:t})}}uV.defaultProps=cje;const mP=e=>({hidden:{y:-50,opacity:0},show:{y:0,opacity:1,transition:{type:"spring",duration:1.25,delay:e}}}),SM=(e,t,i,n)=>({hidden:{x:e==="left"?100:e==="right"?-100:0,y:e==="up"?100:e==="down"?-100:0,opacity:0},show:{x:0,y:0,opacity:1,transition:{type:t,delay:i,duration:n,ease:"easeOut"}}}),aq=(e,t,i,n)=>({hidden:{x:e==="left"?"-100%":e==="right"?"100%":0,y:e==="up"||e==="down"?"100%":0},show:{x:0,y:0,transition:{type:t,delay:i,duration:n,ease:"easeOut"}}}),uje=(e,t)=>({hidden:{},show:{transition:{staggerChildren:e,delayChildren:t||0}}}),jb=(e,t)=>function(){return ke.jsxs(Jc.section,{variants:uje(),initial:"hidden",whileInView:"show",viewport:{once:!0,amount:.25},className:`${ja.padding} max-w-7xl mx-auto relative z-0`,children:[ke.jsx("span",{className:"hash-span",id:t,children:""}),ke.jsx(e,{})]})},hje=({index:e,title:t,icon:i})=>ke.jsx(uV,{className:"xs:w-[250px] w-full",children:ke.jsx(Jc.div,{variants:SM("right","spring",e*.5,.75),className:"w-full green-pink-gradient p-[1px] rounded-[20px] shadow-card",children:ke.jsxs("div",{options:{max:45,scale:1,speed:450},className:"bg-tertiary rounded-[20px] py-5 px-12 min-h-[280px] flex justify-evenly items-center flex-col",children:[ke.jsx("img",{src:i,alt:"web-development",className:"w-16 h-16 object-contain"}),ke.jsx("h3",{className:"text-white text-[20px] font-bold text-center",children:t})]})})}),dje=()=>ke.jsxs(ke.Fragment,{children:[ke.jsxs(Jc.div,{variants:mP(),children:[ke.jsx("p",{className:ja.sectionSubText,children:"Introduction"}),ke.jsx("h2",{className:ja.sectionHeadText,children:"Overview."})]}),ke.jsx(Jc.p,{variants:SM("","",.1,1),className:"mt-4 text-secondary text-[17px] max-w-3xl leading-[30px]",children:"I'm a skilled software developer with experience in TypeScript and JavaScript, and expertise in frameworks like React, Node.js, and Three.js. I'm a quick learner and collaborate closely with clients to create efficient, scalable, and user-friendly solutions that solve real-world problems. Let's work together to bring your ideas to life!"}),ke.jsx("div",{className:"mt-20 flex flex-wrap gap-10",children:tje.map((e,t)=>ke.jsx(hje,{index:t,...e},e.title))})]}),fje=jb(dje,"about"),pje=()=>ke.jsx("div",{className:"flex flex-row flex-wrap justify-center gap-10",children:ije.map(e=>ke.jsx("div",{className:"w-28 h-28",children:ke.jsx(mge,{icon:e.icon})},e.name))}),mje=jb(pje,"");var $_={},VL={exports:{}},HL,oq;function gje(){if(oq)return HL;oq=1;var e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return HL=e,HL}var GL,lq;function vje(){if(lq)return GL;lq=1;var e=gje();function t(){}function i(){}return i.resetWarningCache=t,GL=function(){function n(a,o,l,c,u,h){if(h!==e){var d=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw d.name="Invariant Violation",d}}n.isRequired=n;function r(){return n}var s={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:r,element:n,elementType:n,instanceOf:r,node:n,objectOf:r,oneOf:r,oneOfType:r,shape:r,exact:r,checkPropTypes:i,resetWarningCache:t};return s.PropTypes=s,s},GL}var cq;function Fie(){return cq||(cq=1,VL.exports=vje()()),VL.exports}var kL={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/var uq;function Vie(){return uq||(uq=1,function(e){(function(){var t={}.hasOwnProperty;function i(){for(var s="",a=0;a<arguments.length;a++){var o=arguments[a];o&&(s=r(s,n(o)))}return s}function n(s){if(typeof s=="string"||typeof s=="number")return s;if(typeof s!="object")return"";if(Array.isArray(s))return i.apply(null,s);if(s.toString!==Object.prototype.toString&&!s.toString.toString().includes("[native code]"))return s.toString();var a="";for(var o in s)t.call(s,o)&&s[o]&&(a=r(a,o));return a}function r(s,a){return a?s?s+" "+a:s+a:s}e.exports?(i.default=i,e.exports=i):window.classNames=i})()}(kL)),kL.exports}var hq;function yje(){if(hq)return $_;hq=1,$_.__esModule=!0,$_.default=void 0;var e=n(og()),t=n(Fie()),i=n(Vie());function n(a){return a&&a.__esModule?a:{default:a}}const r=({animate:a=!0,className:o="",layout:l="2-columns",lineColor:c="#FFF",children:u})=>(typeof window=="object"&&document.documentElement.style.setProperty("--line-color",c),e.default.createElement("div",{className:(0,i.default)(o,"vertical-timeline",{"vertical-timeline--animate":a,"vertical-timeline--two-columns":l==="2-columns","vertical-timeline--one-column-left":l==="1-column"||l==="1-column-left","vertical-timeline--one-column-right":l==="1-column-right"})},u));r.propTypes={children:t.default.oneOfType([t.default.arrayOf(t.default.node),t.default.node]).isRequired,className:t.default.string,animate:t.default.bool,layout:t.default.oneOf(["1-column-left","1-column","2-columns","1-column-right"]),lineColor:t.default.string};var s=r;return $_.default=s,$_}var eA={};function zz(){return zz=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},zz.apply(this,arguments)}function xje(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Fz(e,t)}function Fz(e,t){return Fz=Object.setPrototypeOf||function(n,r){return n.__proto__=r,n},Fz(e,t)}function bje(e,t){if(e==null)return{};var i={},n=Object.keys(e),r,s;for(s=0;s<n.length;s++)r=n[s],!(t.indexOf(r)>=0)&&(i[r]=e[r]);return i}var Vz=new Map,bC=new WeakMap,dq=0,Hie=void 0;function Sje(e){Hie=e}function _je(e){return e?(bC.has(e)||(dq+=1,bC.set(e,dq.toString())),bC.get(e)):"0"}function Aje(e){return Object.keys(e).sort().filter(function(t){return e[t]!==void 0}).map(function(t){return t+"_"+(t==="root"?_je(e.root):e[t])}).toString()}function wje(e){var t=Aje(e),i=Vz.get(t);if(!i){var n=new Map,r,s=new IntersectionObserver(function(a){a.forEach(function(o){var l,c=o.isIntersecting&&r.some(function(u){return o.intersectionRatio>=u});e.trackVisibility&&typeof o.isVisible>"u"&&(o.isVisible=c),(l=n.get(o.target))==null||l.forEach(function(u){u(c,o)})})},e);r=s.thresholds||(Array.isArray(e.threshold)?e.threshold:[e.threshold||0]),i={id:t,observer:s,elements:n},Vz.set(t,i)}return i}function hV(e,t,i,n){if(i===void 0&&(i={}),n===void 0&&(n=Hie),typeof window.IntersectionObserver>"u"&&n!==void 0){var r=e.getBoundingClientRect();return t(n,{isIntersecting:n,target:e,intersectionRatio:typeof i.threshold=="number"?i.threshold:0,time:0,boundingClientRect:r,intersectionRect:r,rootBounds:r}),function(){}}var s=wje(i),a=s.id,o=s.observer,l=s.elements,c=l.get(e)||[];return l.has(e)||l.set(e,c),c.push(t),o.observe(e),function(){c.splice(c.indexOf(t),1),c.length===0&&(l.delete(e),o.unobserve(e)),l.size===0&&(o.disconnect(),Vz.delete(a))}}var Mje=["children","as","triggerOnce","threshold","root","rootMargin","onChange","skip","trackVisibility","delay","initialInView","fallbackInView"];function fq(e){return typeof e.children!="function"}var eR=function(e){xje(t,e);function t(n){var r;return r=e.call(this,n)||this,r.node=null,r._unobserveCb=null,r.handleNode=function(s){r.node&&(r.unobserve(),!s&&!r.props.triggerOnce&&!r.props.skip&&r.setState({inView:!!r.props.initialInView,entry:void 0})),r.node=s||null,r.observeNode()},r.handleChange=function(s,a){s&&r.props.triggerOnce&&r.unobserve(),fq(r.props)||r.setState({inView:s,entry:a}),r.props.onChange&&r.props.onChange(s,a)},r.state={inView:!!n.initialInView,entry:void 0},r}var i=t.prototype;return i.componentDidUpdate=function(r){(r.rootMargin!==this.props.rootMargin||r.root!==this.props.root||r.threshold!==this.props.threshold||r.skip!==this.props.skip||r.trackVisibility!==this.props.trackVisibility||r.delay!==this.props.delay)&&(this.unobserve(),this.observeNode())},i.componentWillUnmount=function(){this.unobserve(),this.node=null},i.observeNode=function(){if(!(!this.node||this.props.skip)){var r=this.props,s=r.threshold,a=r.root,o=r.rootMargin,l=r.trackVisibility,c=r.delay,u=r.fallbackInView;this._unobserveCb=hV(this.node,this.handleChange,{threshold:s,root:a,rootMargin:o,trackVisibility:l,delay:c},u)}},i.unobserve=function(){this._unobserveCb&&(this._unobserveCb(),this._unobserveCb=null)},i.render=function(){if(!fq(this.props)){var r=this.state,s=r.inView,a=r.entry;return this.props.children({inView:s,entry:a,ref:this.handleNode})}var o=this.props,l=o.children,c=o.as,u=bje(o,Mje);return ge.createElement(c||"div",zz({ref:this.handleNode},u),l)},t}(ge.Component);eR.displayName="InView";eR.defaultProps={threshold:0,triggerOnce:!1,initialInView:!1};function Eje(e){var t=e===void 0?{}:e,i=t.threshold,n=t.delay,r=t.trackVisibility,s=t.rootMargin,a=t.root,o=t.triggerOnce,l=t.skip,c=t.initialInView,u=t.fallbackInView,h=ge.useRef(),d=ge.useState({inView:!!c}),p=d[0],g=d[1],x=ge.useCallback(function(b){h.current!==void 0&&(h.current(),h.current=void 0),!l&&b&&(h.current=hV(b,function(A,w){g({inView:A,entry:w}),w.isIntersecting&&o&&h.current&&(h.current(),h.current=void 0)},{root:a,rootMargin:s,threshold:i,trackVisibility:r,delay:n},u))},[Array.isArray(i)?i.toString():i,a,s,o,l,r,u,n]);ge.useEffect(function(){!h.current&&p.entry&&!o&&!l&&g({inView:!!c})});var y=[x,p.inView,p.entry];return y.ref=y[0],y.inView=y[1],y.entry=y[2],y}const Tje=Object.freeze(Object.defineProperty({__proto__:null,InView:eR,default:eR,defaultFallbackInView:Sje,observe:hV,useInView:Eje},Symbol.toStringTag,{value:"Module"})),Cje=Une(Tje);var pq;function Dje(){if(pq)return eA;pq=1,eA.__esModule=!0,eA.default=void 0;var e=r(og()),t=r(Fie()),i=r(Vie()),n=Cje;function r(o){return o&&o.__esModule?o:{default:o}}const s=({children:o="",className:l="",contentArrowStyle:c=null,contentStyle:u=null,date:h="",dateClassName:d="",icon:p=null,iconClassName:g="",iconOnClick:x=null,onTimelineElementClick:y=null,iconStyle:b=null,id:A="",position:w="",style:E=null,textClassName:D="",intersectionObserverProps:T={rootMargin:"0px 0px -40px 0px",triggerOnce:!0},visible:I=!1})=>e.default.createElement(n.InView,T,({inView:R,ref:O})=>e.default.createElement("div",{ref:O,id:A,className:(0,i.default)(l,"vertical-timeline-element",{"vertical-timeline-element--left":w==="left","vertical-timeline-element--right":w==="right","vertical-timeline-element--no-children":o===""}),style:E},e.default.createElement(e.default.Fragment,null,e.default.createElement("span",{style:b,onClick:x,className:(0,i.default)(g,"vertical-timeline-element-icon",{"bounce-in":R||I,"is-hidden":!(R||I)})},p),e.default.createElement("div",{style:u,onClick:y,className:(0,i.default)(D,"vertical-timeline-element-content",{"bounce-in":R||I,"is-hidden":!(R||I)})},e.default.createElement("div",{style:c,className:"vertical-timeline-element-content-arrow"}),o,e.default.createElement("span",{className:(0,i.default)(d,"vertical-timeline-element-date")},h)))));s.propTypes={children:t.default.oneOfType([t.default.arrayOf(t.default.node),t.default.node]),className:t.default.string,contentArrowStyle:t.default.shape({}),contentStyle:t.default.shape({}),date:t.default.node,dateClassName:t.default.string,icon:t.default.element,iconClassName:t.default.string,iconStyle:t.default.shape({}),iconOnClick:t.default.func,onTimelineElementClick:t.default.func,id:t.default.string,position:t.default.string,style:t.default.shape({}),textClassName:t.default.string,visible:t.default.bool,intersectionObserverProps:t.default.shape({root:t.default.object,rootMargin:t.default.string,threshold:t.default.number,triggerOnce:t.default.bool})};var a=s;return eA.default=a,eA}var jL,mq;function Rje(){return mq||(mq=1,jL={VerticalTimeline:yje().default,VerticalTimelineElement:Dje().default}),jL}var Gie=Rje();const Pje=({experience:e})=>ke.jsxs(Gie.VerticalTimelineElement,{contentStyle:{background:"#000000",color:"#fff",border:"1px solid #fff",borderRadius:"10px"},contentArrowStyle:{borderRight:"7px solid  #FFFFFF"},date:e.date,iconStyle:{background:e.iconBg},icon:ke.jsx("div",{className:"flex justify-center items-center w-full h-full",children:ke.jsx("img",{src:e.icon,alt:e.company_name,className:"w-[60%] h-[60%] object-contain"})}),children:[ke.jsxs("div",{children:[ke.jsx("h3",{className:"text-white text-[24px] font-bold",children:e.title}),ke.jsx("p",{className:"text-secondary text-[16px] font-semibold",style:{margin:0},children:e.company_name})]}),ke.jsx("ul",{className:"mt-5 list-disc ml-5 space-y-2",children:e.points.map((t,i)=>ke.jsx("li",{className:"text-white-100 text-[14px] pl-1 tracking-wider",children:t},`experience-point-${i}`))})]}),Oje=()=>ke.jsxs(ke.Fragment,{children:[ke.jsxs(Jc.div,{variants:mP(),children:[ke.jsx("p",{className:`${ja.sectionSubText} text-center`,children:"What I have done so far"}),ke.jsx("h2",{className:`${ja.sectionHeadText} text-center`,children:"Work Experience."})]}),ke.jsx("div",{className:"mt-20 flex flex-col",children:ke.jsx(Gie.VerticalTimeline,{children:nje.map((e,t)=>ke.jsx(Pje,{experience:e},`experience-${t}`))})})]}),Bje=jb(Oje,"work"),Ije=({index:e,name:t,description:i,tags:n,image:r,source_code_link:s})=>ke.jsx(Jc.div,{variants:SM("up","spring",e*.5,.75),children:ke.jsxs(uV,{options:{max:45,scale:1,speed:450},className:"bg-tertiary black-gradient p-5 rounded-2xl sm:w-[360px] w-full",children:[ke.jsxs("div",{className:"relative w-full h-[230px]",children:[ke.jsx("img",{src:r,alt:"project_image",className:"w-full h-full object-cover rounded-2xl"}),ke.jsx("div",{className:"absolute inset-0 flex justify-end m-3 card-img_hover",children:ke.jsx("div",{onClick:()=>window.open(s,"_blank"),className:"black-gradient w-10 h-10 rounded-full flex justify-center items-center cursor-pointer",children:ke.jsx("img",{src:O8e,alt:"source code",className:"w-1/2 h-1/2 object-contain"})})})]}),ke.jsxs("div",{className:"mt-5",children:[ke.jsx("h3",{className:"text-white font-bold text-[24px]",children:t}),ke.jsx("p",{className:"mt-2 text-secondary text-[14px]",children:i})]}),ke.jsx("div",{className:"mt-4 flex flex-wrap gap-2",children:n.map(a=>ke.jsxs("p",{className:`text-[14px] ${a.color}`,children:["#",a.name]},`${t}-${a.name}`))})]})}),Lje=()=>ke.jsxs(ke.Fragment,{children:[ke.jsxs(Jc.div,{variants:mP(),children:[ke.jsx("p",{className:`${ja.sectionSubText} `,children:"My work"}),ke.jsx("h2",{className:`${ja.sectionHeadText}`,children:"Projects."})]}),ke.jsx("div",{className:"w-full flex",children:ke.jsx(Jc.p,{variants:SM("","",.1,1),className:"mt-3 text-secondary text-[17px] max-w-3xl leading-[30px]",children:"Following projects showcases my skills and experience through real-world examples of my work. Each project is briefly described with links to code repositories and live demos in it. It reflects my ability to solve complex problems, work with different technologies, and manage projects effectively."})}),ke.jsx("div",{className:"mt-20 flex flex-wrap gap-7",children:sje.map((e,t)=>ke.jsx(Ije,{index:t,...e},`project-${t}`))})]}),Uje=jb(Lje,""),Nje=({index:e,testimonial:t,name:i,designation:n,company:r,image:s})=>ke.jsxs(Jc.div,{variants:SM("","spring",e*.5,.75),className:"bg-black-200 p-10 rounded-3xl xs:w-[320px] w-full",children:[ke.jsx("p",{className:"text-white font-black text-[48px]",children:'"'}),ke.jsxs("div",{className:"mt-1",children:[ke.jsx("p",{className:"text-white tracking-wider text-[18px]",children:t}),ke.jsxs("div",{className:"mt-7 flex justify-between items-center gap-1",children:[ke.jsxs("div",{className:"flex-1 flex flex-col",children:[ke.jsxs("p",{className:"text-white font-medium text-[16px]",children:[ke.jsx("span",{className:"blue-text-gradient",children:"@"})," ",i]}),ke.jsxs("p",{className:"mt-1 text-secondary text-[12px]",children:[n," of ",r]})]}),ke.jsx("img",{src:s,alt:`feedback_by-${i}`,className:"w-10 h-10 rounded-full object-cover"})]})]})]}),zje=()=>ke.jsxs("div",{className:"mt-12 bg-black-100 rounded-[20px]",children:[ke.jsx("div",{className:`bg-tertiary rounded-2xl ${ja.padding} min-h-[300px]`,children:ke.jsxs(Jc.div,{variants:mP(),children:[ke.jsx("p",{className:ja.sectionSubText,children:"What others say"}),ke.jsx("h2",{className:ja.sectionHeadText,children:"Testimonials."})]})}),ke.jsx("div",{className:`-mt-20 pb-14 ${ja.paddingX} flex flex-wrap gap-7`,children:rje.map((e,t)=>ke.jsx(Nje,{index:t,...e},e.name))})]}),Fje=jb(zje,"");class _M{constructor(t=0,i="Network Error"){this.status=t,this.text=i}}const Vje=()=>{if(!(typeof localStorage>"u"))return{get:e=>Promise.resolve(localStorage.getItem(e)),set:(e,t)=>Promise.resolve(localStorage.setItem(e,t)),remove:e=>Promise.resolve(localStorage.removeItem(e))}},Ga={origin:"https://api.emailjs.com",blockHeadless:!1,storageProvider:Vje()},dV=e=>e?typeof e=="string"?{publicKey:e}:e.toString()==="[object Object]"?e:{}:{},Hje=(e,t="https://api.emailjs.com")=>{if(!e)return;const i=dV(e);Ga.publicKey=i.publicKey,Ga.blockHeadless=i.blockHeadless,Ga.storageProvider=i.storageProvider,Ga.blockList=i.blockList,Ga.limitRate=i.limitRate,Ga.origin=i.origin||t},kie=async(e,t,i={})=>{const n=await fetch(Ga.origin+e,{method:"POST",headers:i,body:t}),r=await n.text(),s=new _M(n.status,r);if(n.ok)return s;throw s},jie=(e,t,i)=>{if(!e||typeof e!="string")throw"The public key is required. Visit https://dashboard.emailjs.com/admin/account";if(!t||typeof t!="string")throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!i||typeof i!="string")throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates"},Gje=e=>{if(e&&e.toString()!=="[object Object]")throw"The template params have to be the object. Visit https://www.emailjs.com/docs/sdk/send/"},Wie=e=>e.webdriver||!e.languages||e.languages.length===0,Xie=()=>new _M(451,"Unavailable For Headless Browser"),kje=(e,t)=>{if(!Array.isArray(e))throw"The BlockList list has to be an array";if(typeof t!="string")throw"The BlockList watchVariable has to be a string"},jje=e=>{var t;return!((t=e.list)!=null&&t.length)||!e.watchVariable},Wje=(e,t)=>e instanceof FormData?e.get(t):e[t],qie=(e,t)=>{if(jje(e))return!1;kje(e.list,e.watchVariable);const i=Wje(t,e.watchVariable);return typeof i!="string"?!1:e.list.includes(i)},Yie=()=>new _M(403,"Forbidden"),Xje=(e,t)=>{if(typeof e!="number"||e<0)throw"The LimitRate throttle has to be a positive number";if(t&&typeof t!="string")throw"The LimitRate ID has to be a non-empty string"},qje=async(e,t,i)=>{const n=Number(await i.get(e)||0);return t-Date.now()+n},Qie=async(e,t,i)=>{if(!t.throttle||!i)return!1;Xje(t.throttle,t.id);const n=t.id||e;return await qje(n,t.throttle,i)>0?!0:(await i.set(n,Date.now().toString()),!1)},Kie=()=>new _M(429,"Too Many Requests"),Yje=async(e,t,i,n)=>{const r=dV(n),s=r.publicKey||Ga.publicKey,a=r.blockHeadless||Ga.blockHeadless,o=r.storageProvider||Ga.storageProvider,l={...Ga.blockList,...r.blockList},c={...Ga.limitRate,...r.limitRate};return a&&Wie(navigator)?Promise.reject(Xie()):(jie(s,e,t),Gje(i),i&&qie(l,i)?Promise.reject(Yie()):await Qie(location.pathname,c,o)?Promise.reject(Kie()):kie("/api/v1.0/email/send",JSON.stringify({lib_version:"4.4.1",user_id:s,service_id:e,template_id:t,template_params:i}),{"Content-type":"application/json"}))},Qje=e=>{if(!e||e.nodeName!=="FORM")throw"The 3rd parameter is expected to be the HTML form element or the style selector of the form"},Kje=e=>typeof e=="string"?document.querySelector(e):e,Jje=async(e,t,i,n)=>{const r=dV(n),s=r.publicKey||Ga.publicKey,a=r.blockHeadless||Ga.blockHeadless,o=Ga.storageProvider||r.storageProvider,l={...Ga.blockList,...r.blockList},c={...Ga.limitRate,...r.limitRate};if(a&&Wie(navigator))return Promise.reject(Xie());const u=Kje(i);jie(s,e,t),Qje(u);const h=new FormData(u);return qie(l,h)?Promise.reject(Yie()):await Qie(location.pathname,c,o)?Promise.reject(Kie()):(h.append("lib_version","4.4.1"),h.append("service_id",e),h.append("template_id",t),h.append("user_id",s),kie("/api/v1.0/email/send-form",h))},Zje={init:Hje,send:Yje,sendForm:Jje,EmailJSResponseStatus:_M},$je=()=>{const e=ge.useRef(),[t,i]=ge.useState({name:"",email:"",message:""}),[n,r]=ge.useState(!1),s=o=>{const{target:l}=o,{name:c,value:u}=l;i({...t,[c]:u})},a=o=>{o.preventDefault(),r(!0),Zje.send(void 0,void 0,{from_name:t.name,to_name:"Josue Ayala",from_email:t.email,to_email:"jayalaoc@gmail.com",message:t.message},void 0).then(()=>{r(!1),alert("Thank you. I will get back to you as soon as possible."),i({name:"",email:"",message:""})},l=>{r(!1),console.error(l),alert("Ahh, something went wrong. Please try again.")})};return ke.jsxs("div",{className:"xl:mt-12 flex xl:flex-row flex-col-reverse gap-10 overflow-hidden",children:[ke.jsxs(Jc.div,{variants:aq("left","tween",.2,1),className:"flex-[0.75] bg-black-100 p-8 rounded-2xl",children:[ke.jsx("p",{className:ja.sectionSubText,children:"Get in touch"}),ke.jsx("h3",{className:ja.sectionHeadText,children:"Contact."}),ke.jsxs("form",{ref:e,onSubmit:a,className:"mt-12 flex flex-col gap-8",children:[ke.jsxs("label",{className:"flex flex-col",children:[ke.jsx("span",{className:"text-white font-medium mb-4",children:"Your Name"}),ke.jsx("input",{type:"text",name:"name",value:t.name,onChange:s,placeholder:"What's your name?",className:"bg-tertiary py-4 px-6 placeholder:text-secondary text-white rounded-lg outline-none border-none font-medium"})]}),ke.jsxs("label",{className:"flex flex-col",children:[ke.jsx("span",{className:"text-white font-medium mb-4",children:"Your email"}),ke.jsx("input",{type:"email",name:"email",value:t.email,onChange:s,placeholder:"What's your email address?",className:"bg-tertiary py-4 px-6 placeholder:text-secondary text-white rounded-lg outline-none border-none font-medium"})]}),ke.jsxs("label",{className:"flex flex-col",children:[ke.jsx("span",{className:"text-white font-medium mb-4",children:"Your Message"}),ke.jsx("textarea",{rows:7,name:"message",value:t.message,onChange:s,placeholder:"Any comments or questions?",className:"bg-tertiary py-4 px-6 placeholder:text-secondary text-white rounded-lg outline-none border-none font-medium"})]}),ke.jsx("button",{type:"submit",className:"bg-tertiary py-3 px-8 rounded-xl outline-none w-fit text-white font-bold shadow-md shadow-primary",children:n?"Sending...":"Send"})]})]}),ke.jsx(Jc.div,{variants:aq("right","tween",.2,1),className:"xl:flex-1 xl:h-auto md:h-[550px] h-[350px]",children:ke.jsx(fge,{})})]})},e9e=jb($je,"contact"),t9e=()=>ke.jsx(ose,{children:ke.jsxs("div",{className:"relative z-0 bg-primary",children:[ke.jsxs("div",{className:"bg-hero-pattern bg-cover bg-no-repeat bg-center",children:[ke.jsx(aje,{}),ke.jsx(E8e,{})]}),ke.jsx(fje,{}),ke.jsx(Bje,{}),ke.jsx(mje,{}),ke.jsx(Uje,{}),ke.jsx(Fje,{}),ke.jsxs("div",{className:"relative z-0",children:[ke.jsx(e9e,{}),ke.jsx(vge,{})]})]})});Xne.createRoot(document.getElementById("root")).render(ke.jsx(JC.StrictMode,{children:ke.jsx(t9e,{})}));export{KE as c,Uw as g};
